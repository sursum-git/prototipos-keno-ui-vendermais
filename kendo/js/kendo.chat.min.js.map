{"version":3,"file":"kendo.chat.min.js","names":["STRING","UNDEFINED","STRING","FUNCTION","UNDEFINED","cssPropertiesNames","licensing","DATE_OBJECT","objectToString","NS","ICONS","STYLES","REFERENCES","EVENTS","CLICK","INPUT","KEYDOWN","FOCUS","BLUR","CHANGE","DOT","NS","STYLES","FOCUS","BLUR","CLICK","REFERENCES","CLICK","DOT","STYLES","ICONS","DOT","STYLES","STYLES","REFERENCES","ICONS","STYLES","REFERENCES","ICONS","DOT","COMMA","STYLES","REFERENCES","ICONS","STYLES","REFERENCES","ICONS","renderHeader","DOT","STYLES","STYLES","REFERENCES","ICONS","NS","CLICK","DOT","REFERENCES","STYLES","DOT","EVENTS","STYLES","CLICK","NS","DOT","REFERENCES","ICONS","DOT","DOT","DEFAULT_MESSAGES","DEFAULT_MESSAGES","EVENTS","STYLES","REFERENCES","CLICK","NS","DOT","DOT","STYLES","REFERENCES","EVENTS","EVENTS","CLICK","NS","REFERENCES","DOT","STYLES","KEYDOWN","ICONS","EVENTS","REFERENCES","STYLES","renderHeader","CHANGE","DOT","STRING","STRING","STRING","FUNCTION"],"sources":["../../src/core/models/dependency-container.ts","../../src/core/service-container.ts","../../src/core/services/kendo-jquery.service.ts","../../src/core/base/class.ts","../../src/core/base/observable.ts","../../src/core/services/dom-utils.service.ts","../../src/core/services/utils.service.ts","../../src/core/services/css-properties.service.ts","../../src/core/base/widget.ts","../../src/core/services/html.service.ts","../../src/core/services/date-parser.service.ts","../../src/chat/collaborators/data-manager.collaborator.ts","../../src/chat/constants.ts","../../src/chat/collaborators/accessibility-manager.collaborator.ts","../../src/chat/collaborators/message-toolbar.collaborator.ts","../../src/chat/collaborators/file-menu.collaborator.ts","../../src/core/services/file-utils.service.ts","../../src/chat/templates/common.template.ts","../../src/chat/templates/file.template.ts","../../src/core/services/number-formatter.service.ts","../../src/core/services/formatter.service.ts","../../src/core/models/date-utils.ts","../../src/core/services/date-utils.service.ts","../../src/chat/templates/message.template.ts","../../src/chat/templates/suggestions.template.ts","../../src/chat/collaborators/chat-view/message-renderer.ts","../../src/chat/collaborators/chat-view/scroll-manager.ts","../../src/chat/collaborators/chat-view/suggestion-renderer.ts","../../src/chat/collaborators/chat-view.collaborator.ts","../../src/promptbox/constants.ts","../../src/promptbox/templates/promptbox.template.ts","../../src/promptbox/collaborators/accessibility-manager.collaborator.ts","../../src/promptbox/collaborators/action-button-manager.collaborator.ts","../../src/promptbox/collaborators/speech-handler.collaborator.ts","../../src/promptbox/collaborators/file-handler.collaborator.ts","../../src/promptbox/collaborators/input-manager.collaborator.ts","../../src/promptbox/promptbox.widget.ts","../../src/promptbox/index.ts","../../src/chat/collaborators/message-box.collaborator.ts","../../src/chat/collaborators/message-menu.collaborator.ts","../../src/chat/helpers/command-handler.ts","../../src/chat/helpers/event-wiring.ts","../../src/chat/chat.widget.ts","../../src/core/models/dom-utils.ts","../../src/core/base/databound-widget.ts","../../src/core/services/culture.service.ts","../../src/core/services/date-formatter.service.ts","../../src/core/services/number-parser.service.ts","../../src/core/services/kendo-culture-to-intl.service.ts","../../src/core/services/template.service.ts","../../src/core/services/support.service.ts","../../src/core/services/effects.service.ts","../../src/core/services/focus-utils.service.ts","../../src/core/services/property-access.service.ts","../../src/core/services/input.service.ts","../../src/core/services/color.service.ts","../../src/core/services/selector.service.ts","../../src/core/services/timezone.service.ts","../../src/core/services/type-utils.service.ts","../../src/core/services/mouse-event-normalizer.service.ts","../../src/core/services/event-map.service.ts","../../src/core/services/defaults.service.ts","../../src/core/services/widget-registry.service.ts","../../src/core/services/widget-utils.service.ts","../../src/core/services/namespace.service.ts","../../src/kendo.chat.js"],"sourcesContent":["/**\n * Service Container Models\n * \n * Simple DI container for Kendo widgets. Services can be:\n * - Singleton: one instance shared everywhere\n * - Scoped: new instance created per resolution\n */\n\nexport enum ServiceLifetime {\n    Singleton = \"singleton\",\n    Scoped = \"scoped\"\n}\n\n/** Constructor type for class-based injection */\nexport type Constructor<T = any> = new (...args: any[]) => T;\n\nexport interface IServiceRegistration<T = any> {\n    /** The class constructor (used as token) */\n    ctor: Constructor<T>;\n    /** Factory to create the service */\n    factory: () => T;\n    /** Service lifetime */\n    lifetime: ServiceLifetime;\n    /** Cached instance (for singletons) */\n    instance?: T;\n}\n\nexport interface IServiceContainer {\n    /**\n     * Register a class as a singleton service.\n     */\n    singleton<T>(ctor: Constructor<T>, factory?: () => T): void;\n\n    /**\n     * Register an existing instance as a singleton.\n     */\n    singletonInstance<T>(ctor: Constructor<T>, instance: T): void;\n\n    /**\n     * Register a class as a scoped service.\n     */\n    scoped<T>(ctor: Constructor<T>, factory?: () => T): void;\n\n    /**\n     * Resolve a service by its class constructor.\n     */\n    resolve<T>(ctor: Constructor<T>): T;\n\n    /**\n     * Try to resolve a service, returns undefined if not registered.\n     */\n    tryResolve<T>(ctor: Constructor<T>): T | undefined;\n\n    /**\n     * Check if a service is registered.\n     */\n    has<T>(ctor: Constructor<T>): boolean;\n\n    /**\n     * Get the lifetime of a registered service.\n     */\n    getLifetime<T>(ctor: Constructor<T>): ServiceLifetime | undefined;\n}\n","/**\n * Service Container\n * \n * A minimal DI container for resolving services in widget constructors.\n * Uses class constructors as tokens for type-safe injection.\n * \n * Usage:\n * ```ts\n * // Registration (during kendo.core.js init)\n * serviceContainer.singleton(UtilsService);\n * serviceContainer.scoped(SomeScopedService);\n * \n * // Or register an existing instance\n * serviceContainer.singletonInstance(UtilsService, existingUtilsService);\n * \n * // In widgets - use inject() with default parameter\n * class Chat extends Widget {\n *     constructor(\n *         element: HTMLElement,\n *         options: ChatOptions,\n *         utils = inject(UtilsService)\n *     ) {\n *         super(element, options);\n *         this.utils = utils;\n *     }\n * }\n * ```\n */\n\nimport { \n    ServiceLifetime, \n    Constructor, \n    IServiceContainer, \n    IServiceRegistration \n} from \"./models/dependency-container\";\n\nclass ServiceContainer implements IServiceContainer {\n    /** Map from constructor to registration */\n    private registrations = new Map<Constructor, IServiceRegistration>();\n\n    /**\n     * Register a class as a singleton service.\n     * One instance will be created and shared everywhere.\n     */\n    singleton<T>(ctor: Constructor<T>, factory?: () => T): void {\n        this.registrations.set(ctor, {\n            ctor,\n            factory: factory ?? (() => new ctor()),\n            lifetime: ServiceLifetime.Singleton,\n            instance: undefined\n        });\n    }\n\n    /**\n     * Register an existing instance as a singleton.\n     * Useful when the instance is already created (e.g., during kendo.core.js init).\n     */\n    singletonInstance<T>(ctor: Constructor<T>, instance: T): void {\n        this.registrations.set(ctor, {\n            ctor,\n            factory: () => instance,\n            lifetime: ServiceLifetime.Singleton,\n            instance\n        });\n    }\n\n    /**\n     * Register a class as a scoped service.\n     * A new instance will be created each time it's resolved.\n     */\n    scoped<T>(ctor: Constructor<T>, factory?: () => T): void {\n        this.registrations.set(ctor, {\n            ctor,\n            factory: factory ?? (() => new ctor()),\n            lifetime: ServiceLifetime.Scoped,\n            instance: undefined\n        });\n    }\n\n    /**\n     * Resolve a service by its class constructor.\n     * - Singleton: returns cached instance (creates on first call)\n     * - Scoped: creates new instance each time\n     */\n    resolve<T>(ctor: Constructor<T>): T {\n        const registration = this.registrations.get(ctor);\n        \n        if (!registration) {\n            throw new Error(`Service ${ctor.name} is not registered`);\n        }\n\n        if (registration.lifetime === ServiceLifetime.Singleton) {\n            // Return cached instance or create and cache\n            if (registration.instance === undefined) {\n                registration.instance = registration.factory();\n            }\n            return registration.instance as T;\n        }\n\n        // Scoped: always create new instance\n        return registration.factory() as T;\n    }\n\n    /**\n     * Try to resolve a service, returns undefined if not registered.\n     */\n    tryResolve<T>(ctor: Constructor<T>): T | undefined {\n        if (!this.has(ctor)) {\n            return undefined;\n        }\n        return this.resolve(ctor);\n    }\n\n    /**\n     * Check if a service is registered.\n     */\n    has<T>(ctor: Constructor<T>): boolean {\n        return this.registrations.has(ctor);\n    }\n\n    /**\n     * Get the lifetime of a registered service.\n     */\n    getLifetime<T>(ctor: Constructor<T>): ServiceLifetime | undefined {\n        return this.registrations.get(ctor)?.lifetime;\n    }\n}\n\n/** Global service container instance */\nexport const serviceContainer = new ServiceContainer();\n\n/**\n * Inject a service by its class constructor.\n * Use as default parameter value in constructors.\n * \n * @example\n * class Chat extends Widget {\n *     constructor(\n *         element: HTMLElement,\n *         options: ChatOptions,\n *         utils = inject(UtilsService)\n *     ) {\n *         this.utils = utils;\n *     }\n * }\n */\nexport function inject<T>(ctor: Constructor<T>): T {\n    return serviceContainer.resolve(ctor);\n}\n","/**\n * KendoJQuery Service\n * \n * Provides a jQuery wrapper with Kendo-specific functionality:\n * - Event namespacing with automatic cleanup\n * - Handler context binding  \n * - Touch/mouse event normalization\n * - Keyboard event handling\n *\n \n *\n * @module core-v2/services/kendo-jquery.service\n */\n\nimport type { ISupportService } from \"../models/support\";\nimport type { IMouseEventNormalizerService } from \"../models/mouse-event-normalizer\";\nimport type { IUtilsService } from \"../models/utils\";\nimport type { \n    IKendoJQueryService, \n    IKendoJQueryStatic, \n    IKendoJQuery,\n    IKeyboardWidget,\n    IKeyDownEvent\n} from \"../models/kendo-jquery\";\nimport type { IEventMapService } from \"../models/event-map\";\n\n// Constants\nconst STRING = \"string\";\nconst UNDEFINED = \"undefined\";\n\n/**\n * KendoJQuery Service\n * Creates and manages the KendoJQuery wrapper around jQuery\n */\nexport class KendoJQueryService implements IKendoJQueryService {\n    private kendoJQuery: IKendoJQueryStatic;\n    private rootjQuery: IKendoJQuery;\n    private originalOn: JQuery[\"on\"];\n\n    constructor(\n        private $: JQueryStatic,\n        private support: ISupportService,\n        private mouseEventNormalizer: IMouseEventNormalizerService,\n        private eventMapService: IEventMapService,\n        private utils: IUtilsService,\n        noDeprecateExtend: (deep: boolean, target: any, ...sources: any[]) => any\n    ) {\n        this.originalOn = $.fn.on;\n        this.kendoJQuery = this.createKendoJQuery(noDeprecateExtend);\n        this.rootjQuery = this.kendoJQuery(document);\n    }\n\n    /**\n     * Create the KendoJQuery constructor and prototype\n     */\n    private createKendoJQuery(noDeprecateExtend: (deep: boolean, target: any, ...sources: any[]) => any): IKendoJQueryStatic {\n        const $ = this.$;\n        const self = this;\n\n        // Create the kendoJQuery function\n        const kendoJQuery: any = function(selector: any, context?: any) {\n            return new kendoJQuery.fn.init(selector, context);\n        };\n\n        // Copy all jQuery static properties/methods (without deprecated warnings)\n        noDeprecateExtend(true, kendoJQuery, $);\n\n        // Set up prototype chain - inherit from jQuery\n        // TypeScript doesn't like `new $()` but this is valid jQuery pattern\n        kendoJQuery.fn = kendoJQuery.prototype = new ($ as any)();\n        kendoJQuery.fn.constructor = kendoJQuery;\n\n        // Override init to use kendoJQuery for context\n        kendoJQuery.fn.init = function(selector: any, context?: any) {\n            if (context && context instanceof $ && !(context instanceof kendoJQuery)) {\n                context = kendoJQuery(context);\n            }\n            // $.fn.init exists on jQuery but TypeScript types don't expose it\n            return ($.fn as any).init.call(this, selector, context, self.rootjQuery);\n        };\n\n        kendoJQuery.fn.init.prototype = kendoJQuery.fn;\n\n        // Add Kendo-specific methods\n        $.extend(kendoJQuery.fn, {\n            handler: function(this: IKendoJQuery, handler: object): IKendoJQuery {\n                this.data(\"handler\", handler);\n                return this;\n            },\n\n            autoApplyNS: function(this: IKendoJQuery, ns?: string): IKendoJQuery {\n                this.data(\"kendoNS\", ns || self.utils.guid());\n                return this;\n            },\n\n            on: function(this: IKendoJQuery, ...args: any[]): IKendoJQuery {\n                const that = this;\n                const ns = that.data(\"kendoNS\");\n                const on = self.originalOn;\n\n                // Support for event map signature (single object argument)\n                if (args.length === 1) {\n                    return on.call(that, args[0]) as IKendoJQuery;\n                }\n\n                let context: any = that;\n                const argsCopy = args.slice();\n\n                // Remove trailing undefined arguments\n                if (typeof argsCopy[argsCopy.length - 1] === UNDEFINED) {\n                    argsCopy.pop();\n                }\n\n                const callback = argsCopy[argsCopy.length - 1];\n                const events = self.eventMapService.applyEventMap(argsCopy[0], ns);\n\n                // Setup mouse trap for touch/mouse normalization\n                if (self.support.mouseAndTouchPresent && \n                    events.search(/mouse|click/) > -1 && \n                    this[0] !== document.documentElement) {\n                    \n                    self.mouseEventNormalizer.setupMouseMute();\n\n                    const selector = argsCopy.length === 2 ? null : argsCopy[1];\n                    const bustClick = events.indexOf(\"click\") > -1 && events.indexOf(\"touchend\") > -1;\n\n                    on.call(this,\n                        {\n                            touchstart: (e: JQuery.Event) => self.mouseEventNormalizer.muteMouse(e as any),\n                            touchend: () => self.mouseEventNormalizer.unMuteMouse()\n                        },\n                        selector,\n                        {\n                            bustClick: bustClick\n                        }\n                    );\n                }\n\n                // Handle keydown with widget keyboard navigation\n                if (argsCopy[0].indexOf(\"keydown\") !== -1 && argsCopy[1] && argsCopy[1].options) {\n                    argsCopy[0] = events;\n                    const widget = argsCopy[1] as IKeyboardWidget;\n                    const keyDownCallback = argsCopy[argsCopy.length - 1];\n                    \n                    argsCopy[argsCopy.length - 1] = function(e: IKeyDownEvent) {\n                        if (self.keyDownHandler(e, widget)) {\n                            return keyDownCallback.apply(this, [e]);\n                        }\n                    };\n                    \n                    on.apply(that, argsCopy as any);\n                    return that;\n                }\n\n                // Handle string callback (method name on handler object)\n                if (typeof callback === STRING) {\n                    context = that.data(\"handler\");\n                    const callbackFn = (context as any)[callback];\n\n                    argsCopy[argsCopy.length - 1] = function(e: JQuery.Event) {\n                        callbackFn.call(context, e);\n                    };\n                }\n\n                argsCopy[0] = events;\n                on.apply(that, argsCopy as any);\n\n                return that;\n            },\n\n            kendoDestroy: function(this: IKendoJQuery, ns?: string): IKendoJQuery {\n                ns = ns || this.data(\"kendoNS\");\n\n                if (ns) {\n                    this.off(\".\" + ns);\n                }\n\n                return this;\n            }\n        });\n\n        return kendoJQuery as IKendoJQueryStatic;\n    }\n\n    /**\n     * Get the KendoJQuery constructor function\n     */\n    getConstructor(): IKendoJQueryStatic {\n        return this.kendoJQuery;\n    }\n\n    /**\n     * Create a KendoJQuery wrapper\n     */\n    create(selector: any, context?: any): IKendoJQuery {\n        return this.kendoJQuery(selector, context);\n    }\n\n    /**\n     * Handle keydown events for a widget\n     * Executes all kendoKeydown handlers and checks if event should be prevented\n     */\n    keyDownHandler(e: IKeyDownEvent, widget: IKeyboardWidget): boolean {\n        const events = widget._events.kendoKeydown;\n\n        if (!events) {\n            return true;\n        }\n\n        // Clone the events array to prevent modification during iteration\n        const eventsCopy = events.slice();\n        e.sender = widget;\n        e.preventKendoKeydown = false;\n\n        for (let idx = 0, length = eventsCopy.length; idx < length; idx++) {\n            eventsCopy[idx].call(widget, e);\n        }\n\n        return !e.preventKendoKeydown;\n    }\n}\n","/**\n * Kendo UI Base Class\n *\n * This is the foundational class for the entire Kendo UI inheritance system.\n * It's implemented as an actual ES6 class but also provides the legacy extend()\n * static method for backwards compatibility.\n *\n * Supports both patterns:\n * - ES6: class MyClass extends Class { }\n * - Legacy: var MyClass = Class.extend({ init: function() { } })\n *\n \n *\n * @example\n * // ES6 class inheritance\n * class Animal extends Class {\n *     constructor(name) {\n *         super();\n *         this.name = name;\n *     }\n *     speak() {\n *         console.log(this.name + ' makes a sound.');\n *     }\n * }\n *\n * @example\n * // Legacy extend pattern\n * const Animal = Class.extend({\n *     init: function(name) {\n *         this.name = name;\n *     },\n *     speak: function() {\n *         console.log(this.name + ' makes a sound.');\n *     }\n * });\n *\n * const Dog = Animal.extend({\n *     speak: function() {\n *         console.log(this.name + ' barks.');\n *     }\n * });\n *\n * const dog = new Dog('Rex');\n * dog.speak(); // \"Rex barks.\"\n */\n\nimport type { IClass, ClassConstructor } from \"../models/class\";\nimport { inject } from \"../service-container\";\nimport { KendoJQueryService } from \"../services/kendo-jquery.service\";\n\n/**\n * Base Class for Kendo UI.\n * All Kendo classes inherit from this base class.\n */\nexport class Class implements IClass {\n    /**\n     * Static reference to prototype (jQuery-like pattern used throughout Kendo)\n     */\n    static fn: Class;\n\n    /**\n     * Options object - used by widgets and other classes\n     */\n    options?: Record<string, any>;\n\n    /**\n     * Initialization method - called by legacy extend pattern.\n     */\n    init?(..._args: any[]): void;\n\n    /**\n     * Initialize options by deep extending with the provided options.\n     */\n    _initOptions?(options?: Record<string, any>): void;\n\n    /**\n     * Creates a subclass with the given prototype.\n     * This is the legacy extend pattern used throughout Kendo UI.\n     *\n     * This method:\n     * 1. Creates a new constructor function that extends the current class\n     * 2. Copies all properties from proto to the new prototype\n     * 3. For plain object members, performs deep merge with base class members using $.extend\n     * 4. Sets up the extend method on the subclass for further inheritance\n     *\n     * @param proto - Object containing methods and properties for the subclass\n     * @returns New constructor function for the subclass\n     *\n     * @example\n     * var MyClass = Class.extend({\n     *     init: function(options) {\n     *         this.options = options;\n     *     },\n     *     myMethod: function() {\n     *         return this.options;\n     *     }\n     * });\n     *\n     * var instance = new MyClass({ foo: 'bar' });\n     */\n    static extend<T extends Partial<IClass>>(proto?: T): ClassConstructor<IClass & T> {\n        const that = this;\n\n        // Create a temp base for prototype chain setup (matches original pattern)\n        const base = function (): void { };\n        base.prototype = that.prototype;\n\n        // Create the subclass constructor\n        // If proto has init, use it; otherwise create a constructor that calls parent's init (if any)\n        // Note: Original uses `that.apply(this, arguments)` but ES6 classes can't be called with apply.\n        // Instead, we call the parent's init method directly from the prototype chain.\n        const subclass: any = proto && proto.init ? proto.init : function (this: any, ...args: any[]) {\n            // Call parent's init if it exists (this mimics `that.apply(this, arguments)`)\n            if (that.prototype.init) {\n                that.prototype.init.apply(this, args);\n            }\n        };\n\n        // Set up prototype chain: subclass.prototype inherits from base class prototype\n        const fn = subclass.fn = subclass.prototype = new (base as any)();\n\n        // Copy all members from proto to the new prototype\n        if (proto) {\n            for (const member in proto) {\n                if (proto[member] != null && proto[member].constructor === Object) {\n                    // For plain object members, deep merge with base class member\n                    // Uses jQuery's extend(true, ...) - exactly as original\n                    fn[member] = inject(KendoJQueryService).getConstructor().extend(true, {}, (base.prototype as any)[member], proto[member]);\n                } else {\n                    // For other members (functions, primitives, arrays, etc.), direct assignment\n                    fn[member] = proto[member];\n                }\n            }\n        }\n\n        // Set constructor reference for instanceof checks\n        fn.constructor = subclass;\n\n        // Allow subclass to be further extended\n        subclass.extend = that.extend;\n\n        return subclass as ClassConstructor<IClass & T>;\n    }\n}\n\n// Initialize static fn reference\nClass.fn = Class.prototype;\n\n/**\n * Define init and _initOptions on the prototype as ENUMERABLE properties.\n * \n * ES6 class methods are non-enumerable by default, which breaks the\n * legacy extend() pattern because when we do:\n *   base.prototype = that.prototype;\n *   fn = new base();\n * \n * The inherited methods from the ES6 class prototype don't appear in\n * for...in loops or when the object is logged/inspected. This causes\n * issues when deepExtend copies class instances - the non-enumerable\n * methods are not properly inherited through the prototype chain.\n * \n * By defining these methods directly on the prototype (like the original\n * Kendo Class did), we ensure they're enumerable and properly inherited.\n */\n\n// Base init method - does nothing by default, override in subclasses\nClass.prototype.init = function (this: Class, ..._args: any[]): void {\n    // Base init does nothing - override in subclasses\n};\n\n// Initialize options by deep extending with the provided options\nClass.prototype._initOptions = function (this: Class, options?: Record<string, any>): void {\n    // Use jQuery's extend directly to match original behavior exactly\n    this.options = inject(KendoJQueryService).getConstructor().extend(true, {}, this.options, options);\n};\n\n// Re-export types for convenience\nexport type { IClass, ClassConstructor } from \"../models/class\";\n","/**\n * Kendo UI Observable Class\n *\n * Provides event binding, unbinding, and triggering functionality.\n * This is the foundation for all event-driven components in Kendo UI.\n *\n * Extends Class and supports both ES6 and legacy extend() patterns.\n *\n \n *\n * @example\n * // ES6 class inheritance\n * class MyComponent extends Observable {\n *     doSomething() {\n *         this.trigger(\"change\", { value: 42 });\n *     }\n * }\n *\n * @example\n * // Legacy extend pattern\n * const MyComponent = Observable.extend({\n *     init: function() {\n *         Observable.fn.init.call(this);\n *         this.value = 0;\n *     },\n *     setValue: function(val) {\n *         this.value = val;\n *         this.trigger(\"change\", { value: val });\n *     }\n * });\n *\n * const component = new MyComponent();\n * component.bind(\"change\", function(e) {\n *     console.log(\"Value changed to:\", e.value);\n * });\n * component.setValue(42);\n */\n\nimport { Class } from \"./class\";\nimport type {\n    IObservable,\n    IObservableEvent,\n    IEventMap,\n    IHandlerMap,\n    EventHandler,\n    IWrappedEventHandler\n} from \"../models/observable\";\n\n// Type constants for typeof checks\nconst STRING = \"string\";\nconst FUNCTION = \"function\";\n\n/**\n * preventDefault helper function.\n * Called on event object to prevent default action.\n * Uses regular function to preserve `this` context (the event object).\n */\nfunction preventDefault(this: IObservableEvent): void {\n    this._defaultPrevented = true;\n}\n\n/**\n * isDefaultPrevented helper function.\n * Called on event object to check if default was prevented.\n * Uses regular function to preserve `this` context (the event object).\n */\nfunction isDefaultPrevented(this: IObservableEvent): boolean {\n    return this._defaultPrevented === true;\n}\n\n/**\n * Observable class for event handling.\n * All Kendo UI widgets and data components inherit from this class.\n */\nexport class Observable extends Class implements IObservable {\n    /**\n     * Static reference to prototype (jQuery-like pattern used throughout Kendo)\n     */\n    static fn: Observable;\n\n    /**\n     * Internal storage for event handlers.\n     */\n    _events!: IEventMap;\n\n    /**\n     * Constructor - initializes the Observable's _events storage.\n     */\n    constructor() {\n        super();\n        this._events = {};\n    }\n\n    /**\n     * Initialize the Observable instance.\n     * Sets up the internal _events storage.\n     * Accepts any arguments to allow subclasses to override with different signatures.\n     * \n     * Note: For direct Observable usage, this is called by the constructor.\n     * For subclasses, they should call Observable.fn.init.call(this) in their init.\n     */\n    init(..._args: any[]): void {\n        this._events = {};\n    }\n\n    /**\n     * Binds one or more event handlers to the observable.\n     * \n     * Supports multiple calling patterns:\n     * - bind(\"event\", handler)\n     * - bind([\"event1\", \"event2\"], handler)\n     * - bind({ event1: handler1, event2: handler2 })\n     * - bind(\"event\", handler, true) // one-time binding\n     * \n     * @param eventName - Event name, array of names, or object map\n     * @param handlers - Handler function or map of handlers\n     * @param one - If true, handler is removed after first invocation\n     * @returns this for chaining\n     */\n    bind(\n        eventName: string | string[] | IHandlerMap,\n        handlers?: EventHandler | IHandlerMap,\n        one?: boolean\n    ): this {\n        const that = this;\n        let idx: number | string;\n        let length: number;\n        let original: EventHandler;\n        let handler: EventHandler | IWrappedEventHandler | undefined;\n        const handlersIsFunction = typeof handlers === FUNCTION;\n        let events: IWrappedEventHandler[];\n\n        // Handle object syntax: bind({ change: handler, update: handler })\n        if (handlers === undefined) {\n            const eventMap = eventName as IHandlerMap;\n            for (idx in eventMap) {\n                that.bind(idx, eventMap[idx]);\n            }\n            return that;\n        }\n\n        // Convert single event name to array\n        const eventNames: string[] = typeof eventName === STRING\n            ? [eventName as string]\n            : eventName as string[];\n\n        for (idx = 0, length = eventNames.length; idx < length; idx++) {\n            const currentEventName = eventNames[idx];\n\n            handler = handlersIsFunction\n                ? handlers as EventHandler\n                : (handlers as IHandlerMap)[currentEventName];\n\n            if (handler) {\n                if (one) {\n                    // Wrap handler for one-time binding\n                    // IMPORTANT: Use IIFE to capture currentEventName and handler in closure\n                    original = handler;\n                    handler = (function (evtName: string, originalHandler: EventHandler) {\n                        const wrappedHandler: IWrappedEventHandler = function (this: Observable) {\n                            that.unbind(evtName, wrappedHandler);\n                            originalHandler.apply(that, arguments as any);\n                        };\n                        wrappedHandler.original = originalHandler;\n                        return wrappedHandler;\n                    })(currentEventName, original);\n                }\n                events = that._events[currentEventName] = that._events[currentEventName] || [];\n                events.push(handler as IWrappedEventHandler);\n            }\n        }\n\n        return that;\n    }\n\n    /**\n     * Binds an event handler that will be removed after first invocation.\n     * \n     * @param eventNames - Event name or array of names\n     * @param handlers - Handler function or map of handlers\n     * @returns this for chaining\n     */\n    one(eventNames: string | string[], handlers: EventHandler | IHandlerMap): this {\n        return this.bind(eventNames, handlers, true);\n    }\n\n    /**\n     * Binds an event handler at the beginning of the handler list.\n     * The handler will be invoked before other handlers.\n     * \n     * @param eventName - Event name or array of names\n     * @param handlers - Handler function or map of handlers\n     * @returns this for chaining\n     */\n    first(eventName: string | string[], handlers: EventHandler | IHandlerMap): this {\n        const that = this;\n        let idx: number;\n        const eventNames: string[] = typeof eventName === STRING\n            ? [eventName as string]\n            : eventName as string[];\n        const length = eventNames.length;\n        let handler: EventHandler | undefined;\n        const handlersIsFunction = typeof handlers === FUNCTION;\n        let events: IWrappedEventHandler[];\n\n        for (idx = 0; idx < length; idx++) {\n            const currentEventName = eventNames[idx];\n\n            handler = handlersIsFunction\n                ? handlers as EventHandler\n                : (handlers as IHandlerMap)[currentEventName];\n\n            if (handler) {\n                events = that._events[currentEventName] = that._events[currentEventName] || [];\n                events.unshift(handler as IWrappedEventHandler);\n            }\n        }\n\n        return that;\n    }\n\n    /**\n     * Triggers an event, invoking all bound handlers.\n     * \n     * @param eventName - Name of the event to trigger\n     * @param e - Optional event data object\n     * @returns true if preventDefault() was called, false otherwise\n     */\n    trigger(eventName: string, e?: Partial<IObservableEvent> | Record<string, any>): boolean {\n        const that = this;\n        let events = that._events[eventName];\n        let idx: number;\n        const length = events ? events.length : 0;\n\n        if (events) {\n            // Create or extend event object\n            const eventObj: IObservableEvent = (e || {}) as IObservableEvent;\n\n            eventObj.sender = that;\n            eventObj._defaultPrevented = false;\n            eventObj.preventDefault = preventDefault;\n            eventObj.isDefaultPrevented = isDefaultPrevented;\n\n            // Clone array to allow modifications during iteration\n            // (e.g., unbinding in a handler)\n            events = events.slice();\n\n            for (idx = 0; idx < length; idx++) {\n                events[idx].call(that, eventObj);\n            }\n\n            // Check if preventDefault was called by a handler\n            return (eventObj as { _defaultPrevented: boolean })._defaultPrevented === true;\n        }\n\n        return false;\n    }\n\n    /**\n     * Unbinds event handlers.\n     * \n     * - unbind() - removes all handlers for all events\n     * - unbind(\"event\") - removes all handlers for specific event\n     * - unbind(\"event\", handler) - removes specific handler\n     * \n     * @param eventName - Optional event name\n     * @param handler - Optional specific handler to remove\n     * @returns this for chaining\n     */\n    unbind(eventName?: string, handler?: EventHandler): this {\n        const that = this;\n        const events = eventName ? that._events[eventName] : undefined;\n        let idx: number;\n\n        if (eventName === undefined) {\n            // Unbind all events\n            that._events = {};\n        } else if (events) {\n            if (handler) {\n                // Unbind specific handler (iterate backwards for safe removal)\n                for (idx = events.length - 1; idx >= 0; idx--) {\n                    if (events[idx] === handler || events[idx].original === handler) {\n                        events.splice(idx, 1);\n                    }\n                }\n            } else {\n                // Unbind all handlers for this event\n                that._events[eventName] = [];\n            }\n        }\n\n        return that;\n    }\n}\n\n/**\n * Make Observable methods ENUMERABLE by deleting and reassigning them.\n * \n * ES6 class methods are non-enumerable by default, which breaks legacy patterns\n * like `$.extend({}, observableInstance, ...)` which copies properties using\n * for...in loops. By deleting and reassigning, we create enumerable properties.\n */\nconst proto = Observable.prototype;\nconst methods = ['init', 'bind', 'one', 'first', 'trigger', 'unbind'] as const;\nmethods.forEach(method => {\n    const fn = proto[method];\n    Object.defineProperty(proto, method, {\n        value: fn,\n        writable: true,\n        configurable: true,\n        enumerable: true\n    });\n});\n\n// Set up static fn reference (jQuery-like pattern)\nObservable.fn = Observable.prototype;\n\n// Re-export types for convenience\nexport type {\n    IObservable,\n    IObservableEvent,\n    IEventMap,\n    IHandlerMap,\n    EventHandler,\n    IWrappedEventHandler,\n    ObservableConstructor\n} from \"../models/observable\";\n","import {\n    IDomUtilsService,\n    ElementOffset,\n    HiddenDimensions,\n    ParsedEffects,\n    ShadowDimensions,\n    ScrollResult,\n    VerticalScrollResult,\n    VerticalScrollOptions,\n    ScrollToElementOptions,\n    ProgressOptions,\n    DragToScrollOptions,\n    DragToScrollHandler\n} from \"../models/dom-utils\";\nimport { ISupportService } from \"../models/support\";\nimport { IUtilsService } from \"../models/utils\";\nimport { INamespaceService } from \"../models/namespace\";\n\n// Constants\nconst PERCENT_REGEXP = /%/;\nconst BOX_SHADOW_REGEXP = /(\\d+(?:\\.?)\\d*)px\\s*(\\d+(?:\\.?)\\d*)px\\s*(\\d+(?:\\.?)\\d*)px\\s*(\\d+)?/i;\n\n/**\n * Service providing DOM utility functions\n */\nexport class DomUtilsService implements IDomUtilsService {\n    private animationQueue: Array<() => void> = [];\n    private animationFrameFn: (callback: FrameRequestCallback) => void;\n\n    constructor(\n        private supportService: ISupportService,\n        private $: JQueryStatic,\n        private namespaceService: INamespaceService,\n        private utils: IUtilsService,\n        private kendo?: any // Optional kendo namespace for progress messages\n    ) {\n        // Set up requestAnimationFrame with fallbacks\n        const win = window as any;\n        this.animationFrameFn =\n            win.requestAnimationFrame ||\n            win.webkitRequestAnimationFrame ||\n            win.mozRequestAnimationFrame ||\n            win.oRequestAnimationFrame ||\n            win.msRequestAnimationFrame ||\n            ((callback: FrameRequestCallback) => { setTimeout(callback, 1000 / 60); });\n    }\n\n    isElement(element: any): boolean {\n        return element instanceof Element || element instanceof HTMLDocument;\n    }\n\n    /**\n     * Get outer width of element\n     */\n    outerWidth(element: HTMLElement | JQuery | Window, includeMargin?: boolean, calculateFromHidden?: boolean): number {\n        const $element = this.$(element as any);\n        if (calculateFromHidden) {\n            return this.getHiddenDimensions($element, includeMargin).width;\n        }\n        return $element.outerWidth(includeMargin || false) || 0;\n    }\n\n    /**\n     * Get outer height of element\n     */\n    outerHeight(element: HTMLElement | JQuery | Window, includeMargin?: boolean, calculateFromHidden?: boolean): number {\n        const $element = this.$(element as any);\n        if (calculateFromHidden) {\n            return this.getHiddenDimensions($element, includeMargin).height;\n        }\n        return $element.outerHeight(includeMargin || false) || 0;\n    }\n\n    /**\n     * Get computed styles for an element\n     */\n    getComputedStyles(element: HTMLElement, properties?: string[]): Record<string, string> {\n        const styles: Record<string, string> = {};\n        let computedStyle: any;\n\n        if (document.defaultView && document.defaultView.getComputedStyle) {\n            computedStyle = document.defaultView.getComputedStyle(element, \"\");\n\n            if (properties) {\n                this.$.each(properties, (_idx: number, value: string) => {\n                    styles[value] = computedStyle.getPropertyValue(value);\n                });\n            }\n        } else {\n            // IE fallback\n            computedStyle = (element as any).currentStyle;\n\n            if (properties) {\n                this.$.each(properties, (_idx: number, value: string) => {\n                    styles[value] = computedStyle[this.utils.toCamelCase(value)];\n                });\n            }\n        }\n\n        if (!this.utils.size(styles)) {\n            return computedStyle;\n        }\n\n        return styles;\n    }\n\n    /**\n     * Check if an element is scrollable\n     */\n    isScrollable(element: HTMLElement): boolean {\n        const dataset = element.dataset as any;\n        if (dataset[this.namespaceService.ns + \"scrollable\"] === \"false\") {\n            return false;\n        }\n\n        if (typeof element?.className === \"string\" &&\n            element.className.indexOf(\"k-auto-scrollable\") > -1) {\n            return true;\n        }\n\n        const overflow = this.getComputedStyles(element, [\"overflow\"]).overflow || \"\";\n        return overflow.indexOf(\"auto\") > -1 || overflow.indexOf(\"scroll\") > -1;\n    }\n\n    /**\n     * Get or set scroll left position (RTL-aware)\n     */\n    scrollLeft(element: HTMLElement | JQuery, value?: number): number | void {\n        const webkit = this.supportService.browser.webkit;\n        const mozilla = this.supportService.browser.mozilla;\n        const browserVersion = this.supportService.browser.version;\n\n        // Handle jQuery collection\n        if (element instanceof this.$ && value !== undefined) {\n            (element as JQuery).each((_i: number, e: HTMLElement) => {\n                this.scrollLeft(e, value);\n            });\n            return;\n        }\n\n        const el: HTMLElement = element instanceof this.$ ? (element as JQuery)[0] : element as HTMLElement;\n\n        if (!el) {\n            return;\n        }\n\n        const isRtl = this.supportService.isRtl(element);\n\n        if (value !== undefined) {\n            if (isRtl && webkit && (browserVersion < 85 || this.supportService.browser.safari)) {\n                el.scrollLeft = el.scrollWidth - el.clientWidth - value;\n            } else if (isRtl && (mozilla || webkit) && value > 0) {\n                el.scrollLeft = -value;\n            } else {\n                el.scrollLeft = value;\n            }\n        } else if (isRtl && webkit && (browserVersion < 85 || this.supportService.browser.safari)) {\n            return el.scrollWidth - el.clientWidth - el.scrollLeft;\n        } else {\n            return Math.abs(el.scrollLeft);\n        }\n    }\n\n    /**\n     * Get element offset position\n     */\n    getOffset(element: JQuery, type: string = \"offset\", positioned?: boolean): ElementOffset {\n        const offset = (element as any)[type]();\n\n        // Clone ClientRect object to JS object (jQuery3)\n        const result: ElementOffset = {\n            top: offset.top,\n            right: offset.right,\n            bottom: offset.bottom,\n            left: offset.left\n        };\n\n        // IE10 touch zoom is living in a separate viewport\n        if (this.supportService.browser.msie && (this.supportService.pointers || this.supportService.msPointers) && !positioned) {\n            const sign = this.supportService.isRtl(element) ? 1 : -1;\n\n            result.top -= (window.pageYOffset - (document.documentElement.scrollTop));\n            result.left -= (window.pageXOffset + (sign * document.documentElement.scrollLeft));\n        }\n\n        return result;\n    }\n\n    /**\n     * Get dimensions of a hidden element by temporarily cloning and showing it\n     */\n    getHiddenDimensions(element: JQuery, includeMargin?: boolean): HiddenDimensions {\n        const clone = element.clone();\n        clone.css(\"display\", \"\");\n        clone.css(\"visibility\", \"hidden\");\n        clone.appendTo(this.$(\"body\"));\n\n        const width = clone.outerWidth(includeMargin || false);\n        const height = clone.outerHeight(includeMargin || false);\n\n        clone.remove();\n\n        return {\n            width: width || 0,\n            height: height || 0\n        };\n    }\n\n    /**\n     * Parse effects string into object\n     */\n    parseEffects(input: string | string[]): ParsedEffects {\n        const effects: ParsedEffects = {};\n        const items = typeof input === \"string\" ? input.split(\" \") : input;\n\n        this.$.each(items, function (this: string, idx: number) {\n            effects[idx] = this;\n        });\n\n        return effects;\n    }\n\n    /**\n     * Remove whitespace text nodes from an element\n     */\n    stripWhitespace(element: HTMLElement): void {\n        if (document.createNodeIterator) {\n            const iterator = document.createNodeIterator(\n                element,\n                NodeFilter.SHOW_TEXT,\n                (node: Node) => {\n                    return node.parentNode === element\n                        ? NodeFilter.FILTER_ACCEPT\n                        : NodeFilter.FILTER_REJECT;\n                }\n            );\n\n            while (iterator.nextNode()) {\n                const refNode = (iterator as any).referenceNode;\n                if (refNode && !refNode.textContent?.trim()) {\n                    refNode.parentNode?.removeChild(refNode);\n                }\n            }\n        }\n    }\n\n    /**\n     * Request animation frame wrapper\n     */\n    animationFrame(callback: FrameRequestCallback): void {\n        this.animationFrameFn.call(window, callback);\n    }\n\n    /**\n     * Queue an animation callback\n     */\n    queueAnimation(callback: () => void): void {\n        this.animationQueue.push(callback);\n        if (this.animationQueue.length === 1) {\n            this.runNextAnimation();\n        }\n    }\n\n    /**\n     * Run the next animation in queue\n     */\n    runNextAnimation(): void {\n        this.animationFrame(() => {\n            if (this.animationQueue[0]) {\n                this.animationQueue.shift()!();\n                if (this.animationQueue[0]) {\n                    this.runNextAnimation();\n                }\n            }\n        });\n    }\n\n    /**\n     * Parse query string parameters from URL\n     */\n    parseQueryStringParams(url: string): Record<string, string> {\n        const queryString = url.split(\"?\")[1] || \"\";\n        const params: Record<string, string> = {};\n        const paramParts = queryString.split(/&|=/);\n        const length = paramParts.length;\n\n        for (let idx = 0; idx < length; idx += 2) {\n            if (paramParts[idx] !== \"\") {\n                params[decodeURIComponent(paramParts[idx])] = decodeURIComponent(paramParts[idx + 1]);\n            }\n        }\n\n        return params;\n    }\n\n    /**\n     * Get element under cursor position\n     */\n    elementUnderCursor(e: { x: { client?: number }; y: { client?: number } }): Element | null {\n        if (typeof e.x.client !== \"undefined\") {\n            return document.elementFromPoint(e.x.client!, e.y.client!);\n        }\n        return null;\n    }\n\n    /**\n     * Get wheel delta Y from jQuery event\n     */\n    wheelDeltaY(jQueryEvent: JQuery.MouseEventBase): number | undefined {\n        const e = jQueryEvent.originalEvent as WheelEvent & {\n            wheelDelta?: number;\n            wheelDeltaY?: number;\n            axis?: number;\n            VERTICAL_AXIS?: number;\n        };\n        const deltaY = e.wheelDeltaY;\n        let delta: number | undefined;\n\n        if (e.wheelDelta) {\n            // Webkit and IE\n            if (deltaY === undefined || deltaY) {\n                // IE does not have deltaY, thus always scroll\n                delta = e.wheelDelta;\n            }\n        } else if (e.detail && e.axis === e.VERTICAL_AXIS) {\n            // Firefox and Opera\n            delta = (-e.detail) * 10;\n        }\n\n        return delta;\n    }\n\n    /**\n     * Get box-shadow dimensions from an element\n     */\n    getShadows(element: JQuery): ShadowDimensions {\n        const shadow = element.css(\"box-shadow\");\n        const radius = shadow\n            ? BOX_SHADOW_REGEXP.exec(shadow) || [0, 0, 0, 0, 0]\n            : [0, 0, 0, 0, 0];\n        const blur = Math.max(+radius[3], +(radius[4] || 0));\n\n        return {\n            left: (-radius[1]) + blur,\n            right: (+radius[1]) + blur,\n            bottom: (+radius[2]) + blur\n        };\n    }\n\n    /**\n     * Wrap element with animation container\n     */\n    wrap(\n        element: JQuery,\n        autosize?: boolean,\n        resize?: boolean,\n        shouldCorrectWidth: boolean = true,\n        autowidth?: boolean\n    ): JQuery {\n        let parent = element.parent();\n        const windowOuterWidth = this.outerWidth(window);\n\n        parent.parent().removeClass(\"k-animation-container-sm\");\n\n        if (!parent.hasClass(\"k-child-animation-container\")) {\n            const width = element[0].style.width;\n            const height = element[0].style.height;\n            const percentWidth = PERCENT_REGEXP.test(width);\n            const percentHeight = PERCENT_REGEXP.test(height);\n            const forceDimensions = element.hasClass(\"k-tooltip\") || element.is(\".k-menu-horizontal.k-context-menu\");\n            const calculateFromHidden = element.hasClass(\"k-tooltip\");\n\n            const percentage = percentWidth || percentHeight;\n\n            let computedWidth: string | number = width;\n            let computedHeight: string | number = height;\n\n            if (!percentWidth && (!autosize || (autosize && width) || forceDimensions)) {\n                computedWidth = autosize\n                    ? this.outerWidth(element, false, calculateFromHidden) + 1\n                    : this.outerWidth(element, false, calculateFromHidden);\n            }\n            if (!percentHeight && (!autosize || (autosize && height)) || forceDimensions) {\n                computedHeight = this.outerHeight(element, false, calculateFromHidden);\n            }\n\n            element.wrap(\n                this.$(\"<div/>\")\n                    .addClass(\"k-child-animation-container\")\n                    .css({\n                        width: autowidth ? \"auto\" : computedWidth,\n                        height: computedHeight\n                    })\n            );\n            parent = element.parent();\n\n            parent.wrap(\n                this.$(\"<div/>\")\n                    .addClass(\"k-animation-container\")\n                    .attr(\"role\", \"region\")\n            );\n\n            if (percentage) {\n                element.css({\n                    width: \"100%\",\n                    height: \"100%\"\n                });\n            }\n        } else {\n            this.wrapResize(element, autosize, shouldCorrectWidth);\n        }\n\n        parent = parent.parent();\n\n        if (windowOuterWidth < this.outerWidth(parent)) {\n            parent.addClass(\"k-animation-container-sm\");\n            resize = true;\n        }\n\n        if (resize) {\n            this.wrapResize(element, autosize, shouldCorrectWidth);\n        }\n\n        return parent;\n    }\n\n    /**\n     * Resize wrapped element\n     */\n    wrapResize(element: JQuery, autosize?: boolean, shouldCorrectWidth: boolean = true): void {\n        const parent = element.parent();\n        const wrapper = element.closest(\".k-animation-container\");\n        const calculateFromHidden = element.hasClass(\"k-tooltip\");\n        const visible = element.is(\":visible\");\n        const wrapperStyle = parent[0].style;\n        const elementHeight = element[0].style.height;\n\n        if (wrapper.is(\":hidden\")) {\n            wrapper.css({\n                display: \"\",\n                position: \"\"\n            });\n        }\n\n        const percentage = PERCENT_REGEXP.test(wrapperStyle.width) || PERCENT_REGEXP.test(wrapperStyle.height);\n\n        if (!percentage) {\n            if (!visible) {\n                element.add(parent).show();\n            }\n            if (shouldCorrectWidth) {\n                parent.css(\"width\", \"\"); // Needed to get correct width dimensions\n            }\n            parent.css({\n                width: autosize\n                    ? this.outerWidth(element, false, calculateFromHidden) + 1\n                    : this.outerWidth(element, false, calculateFromHidden),\n            });\n\n            if (elementHeight === \"auto\") {\n                element.css({ height: this.outerHeight(parent) });\n            } else {\n                parent.css({\n                    height: this.outerHeight(element)\n                });\n            }\n\n            if (!visible) {\n                element.hide();\n            }\n        }\n    }\n\n    /**\n     * Scroll element horizontally by a delta\n     */\n    scrollByDelta(element: JQuery, delta: number): ScrollResult {\n        const isRtl = this.supportService.isRtl(element);\n        const srcOffset = isRtl ? -this.scrollLeft(element) : this.scrollLeft(element) as number;\n        const scrollDestination = srcOffset + delta;\n        const scrollWidth = element[0].scrollWidth - element[0].clientWidth;\n\n        const animationProps = { \"scrollLeft\": scrollDestination };\n\n        element.finish().animate(animationProps, \"fast\", \"linear\");\n\n        const maxScroll = isRtl ? -scrollWidth : scrollWidth;\n        const newScrollLeft = isRtl\n            ? Math.max(Math.min(scrollDestination, 0), maxScroll)\n            : Math.min(Math.max(scrollDestination, 0), maxScroll);\n\n        return {\n            atStart: newScrollLeft === 0,\n            atEnd: newScrollLeft === maxScroll\n        };\n    }\n\n    /**\n     * Scroll element vertically by a delta\n     */\n    scrollVerticalByDelta(\n        element: JQuery,\n        delta: number,\n        options: VerticalScrollOptions = {}\n    ): VerticalScrollResult {\n        const { duration = 'fast', easing = 'linear' } = options;\n        const currentScrollTop = element.scrollTop() || 0;\n        const targetScrollTop = currentScrollTop + delta;\n\n        const animationProps = { \"scrollTop\": targetScrollTop };\n\n        element.finish().animate(animationProps, duration as number, easing);\n\n        const maxScroll = element[0].scrollHeight - element[0].clientHeight;\n        const newScrollTop = Math.min(Math.max(targetScrollTop, 0), maxScroll);\n\n        return {\n            atTop: newScrollTop === 0,\n            atBottom: newScrollTop >= maxScroll\n        };\n    }\n\n    /**\n     * Smoothly scroll to a specific element within a container\n     */\n    scrollToElement(\n        container: JQuery,\n        targetElement: JQuery,\n        options: ScrollToElementOptions = {}\n    ): boolean {\n        if (!container.length || !targetElement.length) {\n            return false;\n        }\n\n        const {\n            duration = 0,\n            easing = 'linear',\n            position = 'center',\n            offset = 0,\n            onComplete\n        } = options;\n\n        const containerHeight = container.height() || 0;\n        const containerScrollTop = container.scrollTop() || 0;\n        const containerOffset = container.offset()!;\n        const targetOffset = targetElement.offset()!;\n        const targetHeight = targetElement.outerHeight() || 0;\n\n        const relativeTop = targetOffset.top - containerOffset.top + containerScrollTop;\n\n        let targetScrollTop: number;\n\n        switch (position) {\n            case 'top':\n                targetScrollTop = relativeTop + offset;\n                break;\n            case 'bottom':\n                targetScrollTop = relativeTop - containerHeight + targetHeight + offset;\n                break;\n            case 'center':\n            default:\n                targetScrollTop = relativeTop - (containerHeight / 2) + (targetHeight / 2) + offset;\n                break;\n        }\n\n        const maxScroll = container[0].scrollHeight - container[0].clientHeight;\n        targetScrollTop = Math.min(Math.max(targetScrollTop, 0), maxScroll);\n\n        container.finish().animate({\n            scrollTop: targetScrollTop\n        }, duration, easing, onComplete);\n\n        return true;\n    }\n\n    /**\n     * Add a value to an element's attribute, avoiding duplicates\n     * If the value already exists in the attribute, it won't be added again\n     */\n    addAttribute(element: JQuery, attribute: string, value: string): void {\n        const current = element.attr(attribute) || \"\";\n\n        if (current.indexOf(value) < 0) {\n            element.attr(attribute, (current + \" \" + value).trim());\n        }\n    }\n\n    /**\n     * Remove an attribute from an element\n     */\n    removeAttribute(element: JQuery, attribute: string): void {\n        element.removeAttr(attribute);\n    }\n\n    /**\n     * Toggle an attribute value on an element\n     * For regular attributes: adds if not present, removes if present\n     * For disabled/readonly: adds only when value is truthy\n     */\n    toggleAttribute(element: JQuery, attribute: string, value: string): void {\n        const doesNotHaveAttribute = (element.attr(attribute) || \"\").indexOf(value) < 0;\n        const disabledReadonly = [\"disabled\", \"readonly\"].indexOf(attribute) > -1;\n\n        if (doesNotHaveAttribute && !disabledReadonly) {\n            this.addAttribute(element, attribute, value);\n        } else if (disabledReadonly && value) {\n            this.addAttribute(element, attribute, value);\n        } else {\n            this.removeAttribute(element, attribute);\n        }\n    }\n\n    /**\n     * Bind a callback to the window resize event.\n     * On Android, the callback is delayed by 600ms to handle orientation changes properly.\n     * @param callback - Function to call on resize\n     * @returns The handler function (may be wrapped on Android)\n     */\n    onResize(callback: () => void): () => void {\n        let handler = callback;\n\n        if (this.supportService.mobileOS && this.supportService.mobileOS.android) {\n            handler = function () {\n                setTimeout(callback, 600);\n            };\n        }\n\n        this.$(window).on(this.supportService.resize, handler);\n        return handler;\n    }\n\n    /**\n     * Unbind a resize callback from the window.\n     * @param callback - The handler returned from onResize\n     */\n    unbindResize(callback: () => void): void {\n        this.$(window).off(this.supportService.resize, callback);\n    }\n\n    /**\n     * Get a data attribute value from an element using kendo namespace.\n     * @param element - jQuery element\n     * @param key - Attribute key (without kendo namespace prefix)\n     * @returns The attribute value\n     */\n    attrValue(element: JQuery, key: string): any {\n        return element.data(this.namespaceService.ns + key);\n    }\n\n    /**\n     * Get the kendo data attribute name with namespace prefix.\n     * @param value - The attribute name without prefix\n     * @returns The full attribute name (e.g., \"data-kendo-role\" or \"data-role\")\n     */\n    attr(value: string): string {\n        return \"data-\" + this.namespaceService.ns + value;\n    }\n\n    /**\n     * Get or set element dimensions.\n     * @param element - jQuery element\n     * @param dimensions - Optional dimensions to set\n     * @returns Object with width and height\n     */\n    dimensions(element: JQuery, dimensions?: { width?: number | string; height?: number | string }): { width: number; height: number } {\n        const domElement = element[0] as HTMLElement;\n\n        if (dimensions) {\n            element.css(dimensions);\n        }\n\n        return { width: domElement.offsetWidth, height: domElement.offsetHeight };\n    }\n\n    /**\n     * Check if an event was triggered by an input element\n     * @param e - Event object\n     * @returns True if event target is a form input element\n     */\n    triggeredByInput(e: Event | { target: HTMLElement }): boolean {\n        return (/^(label|input|textarea|select)$/i).test((e.target as HTMLElement).tagName);\n    }\n\n    /**\n     * Apply inline styles from kendo data attributes to elements\n     * @param element - Container element to search within\n     * @param styleProps - Array of CSS property names to apply\n     */\n    applyStylesFromKendoAttributes(element: JQuery, styleProps: string[]): void {\n        const $ = this.$;\n\n        const selector = styleProps.map(styleProp => `[${this.attr(`style-${styleProp}`)}]`).join(\",\");\n        element.find(selector).addBack(selector).each((_: number, currentElement: HTMLElement) => {\n            const $currentElement = $(currentElement);\n            styleProps.forEach((styleProp: string) => {\n                const kendoAttr = this.attr(`style-${styleProp}`);\n                if ($currentElement.attr(kendoAttr)) {\n                    $currentElement.css(styleProp, $currentElement.attr(kendoAttr)!);\n                    $currentElement.removeAttr(kendoAttr);\n                }\n            });\n        });\n    }\n\n    /**\n     * Show or hide a loading mask on a container element\n     * @param container - Container element for the mask\n     * @param toggle - Whether to show (true) or hide (false) the mask\n     * @param options - Optional configuration for the mask\n     */\n    progress(container: JQuery, toggle: boolean, options?: ProgressOptions): void {\n        let mask = container.find(\".k-loading-mask\");\n        const browser = this.supportService.browser;\n\n        const opts = this.$.extend({}, {\n            width: \"100%\",\n            height: \"100%\",\n            top: container.scrollTop(),\n            opacity: false\n        }, options);\n\n        const cssClass = opts.opacity ? \"k-loading-mask k-opaque\" : \"k-loading-mask\";\n\n        if (toggle) {\n            if (!mask.length) {\n                const isRtl = this.supportService.isRtl(container);\n                const leftRight = isRtl ? \"right\" : \"left\";\n                const containerScrollLeft = this.scrollLeft(container) as number;\n                let webkitCorrection = 0;\n                if (browser.webkit && isRtl) {\n                    webkitCorrection = container[0].scrollWidth - (container.width() || 0) - 2 * containerScrollLeft;\n                }\n\n                // Note: The loading text message is set via kendo.ui.progress.messages.loading\n                // which should be accessed from the calling code\n                const loadingText = (this.kendo.ui?.progress?.messages?.loading) || \"Loading...\";\n\n                this.$(`<div class='${cssClass}'><span role='alert' aria-live='polite' class='k-loading-text'>${loadingText}</span><div class='k-loading-image'></div><div class='k-loading-color'></div></div>`)\n                    .width(opts.width!)\n                    .height(opts.height!)\n                    .css(\"top\", opts.top!)\n                    .css(leftRight, Math.abs(containerScrollLeft) + webkitCorrection)\n                    .prependTo(container);\n            }\n        } else if (mask) {\n            mask.remove();\n        }\n    }\n\n    /**\n     * Get the actual target element from an event, handling touch events.\n     * For touch events, uses document.elementFromPoint with touch coordinates.\n     * @param e - Event object (mouse or touch)\n     * @returns The target element\n     */\n    eventTarget(e: Event | JQuery.Event): EventTarget | null {\n        if (!this.supportService.touch) {\n            return (e as Event).target;\n        }\n\n        // Handle touch events - get element at touch point\n        const originalEvent = (e as JQuery.TouchEventBase).originalEvent as TouchEvent | undefined;\n        const touches = originalEvent?.changedTouches || (e as unknown as TouchEvent).changedTouches;\n\n        if (touches && touches.length > 0) {\n            return document.elementFromPoint(touches[0].clientX, touches[0].clientY);\n        }\n\n        return (e as Event).target;\n    }\n\n    /**\n     * Create a drag-to-scroll handler for horizontal scrolling via mouse/touch drag.\n     * Encapsulates the drag state and event handling for scrollable containers.\n     * @param scrollContainer - The element that will be scrolled (or parent for delegation)\n     * @param options - Configuration options including namespace, capture element, and delegate selector\n     * @returns Handler with attach() and destroy() methods\n     */\n    createDragToScrollHandler(scrollContainer: JQuery, options: DragToScrollOptions): DragToScrollHandler {\n        return new DragToScrollHandlerImpl(this.$, scrollContainer, options);\n    }\n}\n\nclass DragToScrollHandlerImpl implements DragToScrollHandler {\n    private static readonly DRAG_THRESHOLD = 5;\n\n    private $: JQueryStatic;\n    private scrollContainer: JQuery;\n    private namespace: string;\n    private captureElement?: JQuery;\n    private delegateSelector?: string;\n\n    private isDragging = false;\n    private hasDragged = false;\n    private dragStartX = 0;\n    private scrollStartLeft = 0;\n    private currentDragTarget: HTMLElement | null = null;\n\n    constructor($: JQueryStatic, scrollContainer: JQuery, options: DragToScrollOptions) {\n        this.$ = $;\n        this.scrollContainer = scrollContainer;\n        this.namespace = options.namespace;\n        this.captureElement = options.captureElement;\n        this.delegateSelector = options.delegateSelector;\n\n        this.onDragStart = this.onDragStart.bind(this);\n        this.onDragMove = this.onDragMove.bind(this);\n        this.onDragEnd = this.onDragEnd.bind(this);\n        this.preventClickOnce = this.preventClickOnce.bind(this);\n    }\n\n    attach(): void {\n        if (!this.captureElement) {\n            return;\n        }\n\n        if (this.delegateSelector) {\n            this.scrollContainer\n                .on(\"mousedown\" + this.namespace, this.delegateSelector, this.onDragStart)\n                .on(\"touchstart\" + this.namespace, this.delegateSelector, this.onDragStart);\n        } else {\n            this.scrollContainer\n                .on(\"mousedown\" + this.namespace, this.onDragStart)\n                .on(\"touchstart\" + this.namespace, this.onDragStart);\n        }\n\n        this.bindCaptureEvents();\n    }\n\n    destroy(): void {\n        this.scrollContainer.off(this.namespace);\n        if (this.captureElement) {\n            this.unbindCaptureEvents();\n        }\n        this.scrollContainer[0].removeEventListener(\"click\", this.preventClickOnce, true);\n    }\n\n    private getClientX(e: any): number {\n        if (e.type.indexOf(\"touch\") !== -1) {\n            const touch = e.originalEvent?.touches?.[0] || e.originalEvent?.changedTouches?.[0];\n            return touch ? touch.clientX : 0;\n        }\n        return e.clientX || e.originalEvent?.clientX || 0;\n    }\n\n    private preventClickOnce(e: MouseEvent): void {\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n        this.scrollContainer[0].removeEventListener(\"click\", this.preventClickOnce, true);\n    }\n\n    private onDragStart(e: any): void {\n        const target = this.$(e.currentTarget);\n        if (!target.length) {\n            return;\n        }\n\n        this.isDragging = true;\n        this.hasDragged = false;\n        this.currentDragTarget = target[0];\n        this.dragStartX = this.getClientX(e);\n        this.scrollStartLeft = target[0].scrollLeft;\n\n        target.css(\"cursor\", \"grabbing\");\n        target.css(\"user-select\", \"none\");\n    }\n\n    private onDragMove(e: any): void {\n        if (!this.isDragging || !this.currentDragTarget) {\n            return;\n        }\n\n        const clientX = this.getClientX(e);\n        const deltaX = this.dragStartX - clientX;\n\n        if (!this.hasDragged && Math.abs(deltaX) >= DragToScrollHandlerImpl.DRAG_THRESHOLD) {\n            this.hasDragged = true;\n        }\n\n        if (this.hasDragged) {\n            e.preventDefault();\n            this.currentDragTarget.scrollLeft = this.scrollStartLeft + deltaX;\n        }\n    }\n\n    private onDragEnd(): void {\n        if (!this.isDragging) {\n            return;\n        }\n\n        if (this.currentDragTarget) {\n            const target = this.$(this.currentDragTarget);\n            target.css(\"cursor\", \"\");\n            target.css(\"user-select\", \"\");\n        }\n\n        if (this.hasDragged) {\n            this.scrollContainer[0].addEventListener(\"click\", this.preventClickOnce, true);\n        }\n\n        this.isDragging = false;\n        this.hasDragged = false;\n        this.currentDragTarget = null;\n    }\n\n    private bindCaptureEvents(): void {\n        if (!this.captureElement) {\n            return;\n        }\n\n        // Bind all events to document so dragging continues when cursor leaves component\n        this.$(document)\n            .on(\"mousemove\" + this.namespace, this.onDragMove)\n            .on(\"touchmove\" + this.namespace, this.onDragMove)\n            .on(\"mouseup\" + this.namespace, this.onDragEnd)\n            .on(\"touchend\" + this.namespace, this.onDragEnd);\n    }\n\n    private unbindCaptureEvents(): void {\n        this.$(document).off(this.namespace);\n    }\n}","import { \n    IUtilsService, \n    ThrottledFunction,\n    Cloneable,\n    KendoDataNamespace,\n    KeyboardKeys,\n    DaysOfWeek\n} from \"../models/utils\";\n\n// Constants\nconst OBJECT = \"object\";\nconst UNDEFINED = \"undefined\";\n\n/**\n * Utility service providing general helper functions.\n \n */\nexport class UtilsService implements IUtilsService {\n    /**\n     * Keyboard key codes for handling keyboard events.\n     * Maps common key names to their numeric key codes.\n     */\n    readonly keys: KeyboardKeys = {\n        INSERT: 45,\n        DELETE: 46,\n        BACKSPACE: 8,\n        TAB: 9,\n        ENTER: 13,\n        ESC: 27,\n        LEFT: 37,\n        UP: 38,\n        RIGHT: 39,\n        DOWN: 40,\n        END: 35,\n        HOME: 36,\n        SPACEBAR: 32,\n        PAGEUP: 33,\n        PAGEDOWN: 34,\n        F2: 113,\n        F10: 121,\n        F12: 123,\n        SHIFT: 16,\n        NUMPAD_PLUS: 107,\n        NUMPAD_MINUS: 109,\n        NUMPAD_DOT: 110\n    };\n\n    /**\n     * Days of the week mapping.\n     * Sunday = 0, Saturday = 6 (matches JavaScript Date.getDay())\n     */\n    readonly days: DaysOfWeek = {\n        Sunday: 0,\n        Monday: 1,\n        Tuesday: 2,\n        Wednesday: 3,\n        Thursday: 4,\n        Friday: 5,\n        Saturday: 6\n    };\n\n    constructor(\n        private kendo: { data: KendoDataNamespace }\n    ) {\n        // kendo.data is accessed at call time, not construction time,\n        // because data types (ObservableArray, DataSource, etc.) are\n        // defined later in kendo.data.js\n    }\n\n    /**\n     * Get kendo.data namespace (accessed at call time for lazy loading)\n     */\n    private get kendoData(): KendoDataNamespace {\n        return this.kendo.data || {};\n    }\n\n    /**\n     * Convert camelCase to hyphen-case\n     */\n    toHyphens(str: string): string {\n        return str.replace(/([a-z][A-Z])/g, (g) => {\n            return g.charAt(0) + \"-\" + g.charAt(1).toLowerCase();\n        });\n    }\n\n    /**\n     * Convert hyphen-case to camelCase\n     */\n    toCamelCase(str: string): string {\n        return str.replace(/\\-(\\w)/g, (_strMatch, g1) => {\n            return g1.toUpperCase();\n        });\n    }\n\n    /**\n     * Count properties in an object (excluding toJSON for IE7 compat)\n     */\n    size(obj: object): number {\n        let result = 0;\n        for (const key in obj) {\n            if (Object.prototype.hasOwnProperty.call(obj, key) && key !== \"toJSON\") {\n                result++;\n            }\n        }\n        return result;\n    }\n\n    /**\n     * Deep extend an object with one or more source objects.\n     * \n     * IMPORTANT BEHAVIOR NOTES:\n     * - Does NOT copy properties with undefined values (matches jQuery.extend behavior)\n     * - Handles Date objects by creating new Date instances\n     * - Handles objects with clone() method by calling clone()\n     * - Skips Kendo special types: ObservableArray, LazyObservableArray, DataSource, HierarchicalDataSource\n     * - Skips Array, RegExp, ArrayBuffer, and HTMLElement instances\n     * - Protects against prototype pollution (__proto__, constructor, prototype)\n     */\n    deepExtend<T extends object>(destination: T, ...sources: object[]): T {\n        for (let i = 0; i < sources.length; i++) {\n            this.deepExtendOne(destination, sources[i]);\n        }\n        return destination;\n    }\n\n    /**\n     * Deep extend destination with a single source object.\n     * This is the core implementation that handles all the special cases.\n     */\n    deepExtendOne<T extends object>(destination: T, source: object): T {\n        const ObservableArray = this.kendoData.ObservableArray;\n        const LazyObservableArray = this.kendoData.LazyObservableArray;\n        const DataSource = this.kendoData.DataSource;\n        const HierarchicalDataSource = this.kendoData.HierarchicalDataSource;\n\n        for (const property in source) {\n            // Protect against prototype pollution\n            if (property === \"__proto__\" || property === \"constructor\" || property === \"prototype\") {\n                continue;\n            }\n\n            const propValue = (source as any)[property];\n            const propType = typeof propValue;\n            let propInit: (new (...args: any[]) => any) | null = null;\n\n            if (propType === OBJECT && propValue !== null) {\n                propInit = propValue.constructor;\n            }\n\n            let isRegExp = propInit?.name === 'RegExp';\n            let isArrayBuffer = propInit?.name === 'ArrayBuffer';\n            let isDate = propInit?.name === 'Date';\n\n            if (propInit &&\n                !Array.isArray(propValue) && \n                propInit !== ObservableArray && \n                propInit !== LazyObservableArray &&\n                propInit !== DataSource && \n                propInit !== HierarchicalDataSource && \n                !isRegExp &&\n                (!this.isFunction((window as any).ArrayBuffer) || !isArrayBuffer) && \n                !(propValue instanceof HTMLElement)) {\n\n                if (isDate) {\n                    // Clone Date objects\n                    (destination as any)[property] = new Date(propValue.getTime());\n                } else if (this.isCloneable(propValue)) {\n                    // Use clone() method if available\n                    (destination as any)[property] = propValue.clone();\n                } else {\n                    // Recursively extend plain objects\n                    const destProp = (destination as any)[property];\n                    if (typeof destProp === OBJECT) {\n                        (destination as any)[property] = destProp || {};\n                    } else {\n                        (destination as any)[property] = {};\n                    }\n                    this.deepExtendOne((destination as any)[property], propValue);\n                }\n            } else if (propType !== UNDEFINED) {\n                // Only copy if value is not undefined\n                // This is critical - it matches jQuery.extend behavior\n                // and differs from spread operator which copies undefined\n                (destination as any)[property] = propValue;\n            }\n        }\n\n        return destination;\n    }\n\n    /**\n     * Check if an object has a clone method\n     */\n    private isCloneable(obj: any): obj is Cloneable {\n        return typeof obj.clone === \"function\";\n    }\n\n    /**\n     * Create a throttled version of a function.\n     * The throttled function will only execute at most once per delay period.\n     * Includes a cancel() method to clear any pending execution.\n     * \n     * If delay is falsy (0, null, undefined), returns the original function unchanged.\n     */\n    throttle<T extends (...args: any[]) => any>(fn: T, delay: number): ThrottledFunction<T> | T {\n        if (!delay || delay <= 0) {\n            // Return the original function unchanged when delay is falsy\n            return fn;\n        }\n\n        let timeout: ReturnType<typeof setTimeout> | undefined;\n        let lastExecTime = 0;\n\n        const throttled = function(this: any, ...args: Parameters<T>): ReturnType<T> | void {\n            const that = this;\n            const elapsed = +new Date() - lastExecTime;\n\n            function exec(): ReturnType<T> {\n                const result = fn.apply(that, args);\n                lastExecTime = +new Date();\n                return result;\n            }\n\n            // First execution\n            if (!lastExecTime) {\n                return exec();\n            }\n\n            if (timeout) {\n                clearTimeout(timeout);\n            }\n\n            if (elapsed > delay) {\n                return exec();\n            } else {\n                timeout = setTimeout(exec, delay - elapsed);\n            }\n        } as ThrottledFunction<T>;\n\n        throttled.cancel = function(): void {\n            if (timeout) {\n                clearTimeout(timeout);\n                timeout = undefined;\n            }\n        };\n\n        return throttled;\n    }\n\n    /**\n     * Generate a UUID.\n     * Uses crypto.randomUUID() when available (HTTPS only),\n     * falls back to crypto.getRandomValues().\n     */\n    guid(): string {\n        const cryptoObj = window.crypto;\n        \n        try {\n            // crypto.randomUUID() is available only in secure contexts (HTTPS)\n            return cryptoObj.randomUUID();\n        } catch (e) {\n            // Fallback using crypto.getRandomValues()\n            const randomValues = cryptoObj.getRandomValues(new Uint8Array(16));\n            return randomValues.reduce((acc: string, curr: number, i: number) => {\n                if (i === 4 || i === 6 || i === 8 || i === 10) {\n                    acc += \"-\";\n                }\n                acc += curr.toString(16).padStart(2, \"0\");\n                return acc;\n            }, \"\");\n        }\n    }\n\n    /**\n     * Trim whitespace from a value.\n     * Converts to string first, returns empty string for falsy values.\n     */\n    trim(value: any): string {\n        if (value) {\n            return value.toString().trim();\n        }\n        return \"\";\n    }\n\n    /**\n     * Check if a value is present (not null and not undefined)\n     */\n    isPresent(value: any): boolean {\n        return value !== null && value !== undefined;\n    }\n\n    /**\n     * Check if a value is blank (null or undefined)\n     */\n    isBlank(value: any): boolean {\n        return value === null || value === undefined;\n    }\n\n    /**\n     * Check if a value is empty (has length 0)\n     */\n    isEmpty(value: { length: number }): boolean {\n        return value.length === 0;\n    }\n\n    /**\n     * Check if a value is a string\n     */\n    isString(value: any): value is string {\n        return typeof value === \"string\";\n    }\n\n    /**\n     * Check if a value is an integer\n     */\n    isInteger(value: any): value is number {\n        return Number.isInteger(value);\n    }\n\n    /**\n     * Check if a value is numeric\n     */\n    isNumeric(value: any): boolean {\n        return !isNaN(value - parseFloat(value));\n    }\n\n    /**\n     * Check if a value is a Date object\n     */\n    isDate(value: any): value is Date {\n        return value && value.getTime;\n    }\n\n    /**\n     * Check if a value is a function\n     */\n    isFunction(value: any): value is Function {\n        return typeof value === \"function\";\n    }\n\n    /**\n     * Check if a value is an object (and not null)\n     */\n    isObject(value: any): value is object {\n        return value !== null && typeof value === OBJECT;\n    }\n\n    /**\n     * Log a message to the console.\n     * Respects kendo.suppressLog setting.\n     * @param message - The message to log\n     * @param type - Console method to use (\"log\", \"warn\", \"error\", etc.). Defaults to \"log\"\n     */\n    logToConsole(message: string, type?: string): void {\n        const console = window.console;\n        const kendo = this.kendo as any;\n\n        if (!kendo.suppressLog && typeof console !== \"undefined\" && console.log) {\n            (console as any)[type || \"log\"](message);\n        }\n    }\n\n    /**\n     * Wait for all promises to resolve, similar to Promise.all but for jQuery Deferreds.\n     * Unlike $.when(), this handles failures gracefully and reports all results.\n     * \n     * Influenced from: https://gist.github.com/fearphage/4341799\n     * \n     * @param array - Array of deferreds/promises, or multiple arguments\n     * @returns A jQuery Promise that resolves when all inputs resolve, or rejects if any fail\n     */\n    whenAll<T = any>(array: JQueryPromise<T>[] | JQueryPromise<T>): JQueryPromise<T[]> {\n        const $ = (window as any).jQuery;\n        const resolveValues: any[] = arguments.length === 1 && Array.isArray(array) \n            ? array \n            : Array.prototype.slice.call(arguments);\n        const length = resolveValues.length;\n        let remaining = length;\n        const deferred = $.Deferred();\n        let i = 0;\n        let failed = 0;\n        const rejectContexts: any[] = new Array(length);\n        const rejectValues: any[] = new Array(length);\n        const resolveContexts: any[] = new Array(length);\n        let value: any;\n\n        const updateFunc = (index: number, contexts: any[], values: any[]) => {\n            return function(this: any) {\n                if (values !== resolveValues) {\n                    failed++;\n                }\n\n                deferred.notifyWith(\n                    contexts[index] = this,\n                    values[index] = Array.prototype.slice.call(arguments)\n                );\n\n                if (!(--remaining)) {\n                    deferred[(!failed ? \"resolve\" : \"reject\") + \"With\"](contexts, values);\n                }\n            };\n        };\n\n        for (; i < length; i++) {\n            value = resolveValues[i];\n            if (value && this.isFunction(value.promise)) {\n                value.promise()\n                    .done(updateFunc(i, resolveContexts, resolveValues))\n                    .fail(updateFunc(i, rejectContexts, rejectValues));\n            } else {\n                deferred.notifyWith(this, value);\n                --remaining;\n            }\n        }\n\n        if (!remaining) {\n            deferred.resolveWith(resolveContexts, resolveValues);\n        }\n\n        return deferred.promise();\n    }\n\n    /**\n     * Check if a URL is local (doesn't start with a protocol)\n     * @param url - URL to check\n     * @returns True if the URL is local\n     */\n    isLocalUrl(url: string): boolean {\n        return url && !/^([a-z]+:)?\\/\\//i.test(url);\n    }\n\n    /**\n     * Get all method names (static and instance) from a class\n     * @param targetClass - The class to inspect\n     * @returns Array of method names\n     */\n    getAllMethods(targetClass: new (...args: any[]) => any): string[] {\n        const allStatic = Object.getOwnPropertyNames(targetClass)\n            .filter(prop => typeof (targetClass as any)[prop] === \"function\");\n        const allNonStatic = Object.getOwnPropertyNames(Object.getPrototypeOf(new targetClass({})))\n            .filter(prop => prop !== \"constructor\");\n\n        return allStatic.concat(allNonStatic);\n    }\n\n    /**\n     * Get the base class (parent class) of a given class\n     * @param targetClass - The class to get the parent of\n     * @returns The parent class or null if none\n     */\n    getBaseClass(targetClass: Function): Function | null {\n        if (targetClass instanceof Function) {\n            const baseClass = targetClass;\n            const newBaseClass = Object.getPrototypeOf(baseClass);\n\n            if (newBaseClass && newBaseClass !== Object && newBaseClass.name) {\n                return newBaseClass;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Create a proxy member on a prototype that delegates to an instance\n     * @param proto - The prototype object to add the member to\n     * @param name - The name of the member to create\n     */\n    createProxyMember(proto: { fn: Record<string, Function> }, name: string): void {\n        proto.fn[name] = function(this: { _instance?: Record<string, Function> }) {\n            const instance = this._instance;\n            if (instance) {\n                return instance[name].apply(instance, arguments);\n            }\n        };\n    }\n\n    /**\n     * Convert a native Promise to a jQuery Deferred\n     * @param promise - The native Promise to convert\n     * @returns A jQuery Promise\n     */\n    convertPromiseToDeferred<T = any>(promise: Promise<T>): JQueryPromise<T> {\n        const deferred = $.Deferred<T>();\n\n        (promise.finally as any)(deferred.always).then(deferred.resolve).catch(deferred.reject);\n\n        return deferred.promise();\n    }\n}\n","import { \n    ICssPropertiesService, \n    CssValueDefinition, \n    RegisterValuesArg, \n    GetValidClassArgs,\n    DefaultValuesDictionary,\n    PropertyDictionary\n} from \"../models/css-properties\";\n\n// Constant for the prefix key in property dictionary\nconst PREFIX = \"prefix\";\n\n/**\n * Service for managing CSS class properties for widgets\n * Extracted from kendo.cssProperties in kendo.core.js\n */\nexport class CssPropertiesService implements ICssPropertiesService {\n    /**\n     * Predefined theme color values\n     */\n    readonly themeColorValues: CssValueDefinition[] = [\n        'base', 'primary', 'secondary', 'tertiary', 'inherit', \n        'info', 'success', 'warning', 'error', 'dark', 'light', 'inverse'\n    ];\n\n    /**\n     * Predefined fill mode values\n     */\n    readonly fillModeValues: CssValueDefinition[] = ['solid', 'outline', 'flat'];\n\n    /**\n     * Predefined shape values\n     */\n    readonly shapeValues: CssValueDefinition[] = ['rectangle', 'square'];\n\n    /**\n     * Predefined size values\n     */\n    readonly sizeValues: CssValueDefinition[] = [\n        ['small', 'sm'], ['medium', 'md'], ['large', 'lg']\n    ];\n\n    /**\n     * Predefined rounded values\n     */\n    readonly roundedValues: CssValueDefinition[] = [\n        ['small', 'sm'], ['medium', 'md'], ['large', 'lg'], ['full', 'full'], ['none', 'none']\n    ];\n\n    /**\n     * Predefined position mode values\n     */\n    readonly positionModeValues: CssValueDefinition[] = [\n        'fixed', 'static', 'sticky', 'absolute'\n    ];\n\n    /**\n     * Predefined resize values\n     */\n    readonly resizeValues: CssValueDefinition[] = [\n        ['both', 'resize'], ['horizontal', 'resize-x'], ['vertical', 'resize-y']\n    ];\n\n    /**\n     * Predefined overflow values\n     */\n    readonly overflowValues: CssValueDefinition[] = [\n        'auto', 'hidden', 'visible', 'scroll', 'clip'\n    ];\n\n    /**\n     * Predefined layout flow values\n     */\n    readonly layoutFlowValues: CssValueDefinition[] = [\n        ['vertical', '!k-flex-col'], ['horizontal', '!k-flex-row']\n    ];\n\n    /**\n     * Default values dictionary\n     */\n    defaultValues: DefaultValuesDictionary = {};\n\n    /**\n     * Widget property dictionary\n     */\n    propertyDictionary: PropertyDictionary = {};\n\n    /**\n     * Legacy property to CSS class map (for BottomNavigation compatibility)\n     * TODO: delete after implementing new styles and classes for BottomNavigation\n     */\n    propertyToCssClassMap: Record<string, Record<string, string>> = {};\n\n    constructor() {\n        // Register default CSS classes\n        this.registerDefaultCssClasses(\"themeColor\", this.themeColorValues);\n        this.registerDefaultCssClasses(\"fillMode\", this.fillModeValues);\n        this.registerDefaultCssClasses(\"shape\", this.shapeValues);\n        this.registerDefaultCssClasses(\"size\", this.sizeValues);\n        this.registerDefaultCssClasses(\"positionMode\", this.positionModeValues);\n        this.registerDefaultCssClasses(\"rounded\", this.roundedValues);\n        this.registerDefaultCssClasses(\"resize\", this.resizeValues);\n        this.registerDefaultCssClasses(\"overflow\", this.overflowValues);\n        this.registerDefaultCssClasses(\"layoutFlow\", this.layoutFlowValues);\n\n        // Register legacy CSS classes (for BottomNavigation compatibility)\n        this.registerCssClasses(\"themeColor\", this.themeColorValues);\n        this.registerCssClasses(\"fill\", this.fillModeValues);\n        this.registerCssClasses(\"shape\", this.shapeValues);\n        this.registerCssClasses(\"size\", this.sizeValues);\n        this.registerCssClasses(\"positionMode\", this.positionModeValues);\n    }\n\n    /**\n     * Register a CSS prefix for a widget\n     */\n    registerPrefix(widget: string, prefix: string): void {\n        if (!this.propertyDictionary[widget]) {\n            this.propertyDictionary[widget] = {};\n        }\n\n        this.propertyDictionary[widget][PREFIX] = prefix;\n    }\n\n    /**\n     * Register CSS values for a widget\n     */\n    registerValues(widget: string, args: RegisterValuesArg[]): void {\n        let i: number;\n        let j: number;\n        let prop: string;\n        let values: Record<string, string>;\n        let newValues: CssValueDefinition[];\n        let currentValue: CssValueDefinition;\n\n        if (!this.propertyDictionary[widget]) {\n            this.propertyDictionary[widget] = {};\n        }\n\n        for (i = 0; i < args.length; i++) {\n            prop = args[i].prop;\n            newValues = args[i].values;\n\n            if (!this.propertyDictionary[widget][prop]) {\n                this.propertyDictionary[widget][prop] = {};\n            }\n\n            values = this.propertyDictionary[widget][prop] as Record<string, string>;\n\n            for (j = 0; j < newValues.length; j++) {\n                currentValue = newValues[j];\n\n                if (Array.isArray(currentValue)) {\n                    values[(currentValue as [string, string])[0]] = (currentValue as [string, string])[1];\n                } else {\n                    values[currentValue as string] = currentValue as string;\n                }\n            }\n        }\n    }\n\n    /**\n     * Get a valid CSS class for a widget property\n     */\n    getValidClass(args: GetValidClassArgs): string {\n        const widget = args.widget;\n        const propName = args.propName;\n        const value = args.value;\n        const overridePrefix = args.prefix;\n\n        const defaultVals = this.defaultValues[propName];\n        const widgetProperties = this.propertyDictionary[widget];\n\n        if (!widgetProperties) {\n            return \"\";\n        }\n\n        const widgetValues = widgetProperties[propName] as Record<string, string>;\n        const validValue = widgetValues \n            ? (widgetValues[value] || (defaultVals && defaultVals[value])) \n            : (defaultVals && defaultVals[value]);\n\n        if (validValue) {\n            let prefix: string;\n\n            if (propName === \"themeColor\") {\n                prefix = widgetProperties[PREFIX] as string;\n            } else if (propName === \"positionMode\") {\n                prefix = \"k-pos-\";\n            } else if (propName === \"rounded\") {\n                prefix = \"k-rounded-\";\n            } else if (propName === \"resize\") {\n                prefix = \"k-\";\n            } else if (propName === \"overflow\") {\n                prefix = \"k-overflow-\";\n            } else if (propName === \"layoutFlow\") {\n                prefix = \"\";\n            } else {\n                prefix = widgetProperties[PREFIX] as string;\n            }\n\n            prefix = overridePrefix || prefix;\n\n            return prefix + validValue;\n        } else {\n            return \"\";\n        }\n    }\n\n    /**\n     * Register a single CSS class (internal for defaultValues)\n     */\n    private registerDefaultCssClass(propName: string, value: string, shorthand?: string): void {\n        if (!this.defaultValues[propName]) {\n            this.defaultValues[propName] = {};\n        }\n\n        this.defaultValues[propName][value] = shorthand || value;\n    }\n\n    /**\n     * Register multiple CSS classes for a property (internal for defaultValues)\n     */\n    private registerDefaultCssClasses(propName: string, arr: CssValueDefinition[]): void {\n        for (let i = 0; i < arr.length; i++) {\n            if (Array.isArray(arr[i])) {\n                const tuple = arr[i] as [string, string];\n                this.registerDefaultCssClass(propName, tuple[0], tuple[1]);\n            } else {\n                this.registerDefaultCssClass(propName, arr[i] as string);\n            }\n        }\n    }\n\n    // Legacy CSS class methods (for BottomNavigation compatibility)\n    // TODO: delete after implementing new styles and classes for BottomNavigation\n\n    /**\n     * Register a single legacy CSS class\n     */\n    registerCssClass(propName: string, value: string, shorthand?: string): void {\n        if (!this.propertyToCssClassMap[propName]) {\n            this.propertyToCssClassMap[propName] = {};\n        }\n\n        this.propertyToCssClassMap[propName][value] = shorthand || value;\n    }\n\n    /**\n     * Register multiple legacy CSS classes\n     */\n    registerCssClasses(propName: string, arr: CssValueDefinition[]): void {\n        for (let i = 0; i < arr.length; i++) {\n            if (Array.isArray(arr[i])) {\n                const tuple = arr[i] as [string, string];\n                this.registerCssClass(propName, tuple[0], tuple[1]);\n            } else {\n                this.registerCssClass(propName, arr[i] as string);\n            }\n        }\n    }\n\n    /**\n     * Get a valid legacy CSS class\n     */\n    getValidCssClass(prefix: string, propName: string, value: string): string | undefined {\n        if (value === undefined) {\n            return \"\";\n        }\n\n        const validValue = this.propertyToCssClassMap[propName]?.[value];\n\n        if (validValue) {\n            return prefix + validValue;\n        }\n\n        return undefined;\n    }\n}\n","/**\n * Kendo UI Widget Class\n *\n * Base widget class for all Kendo UI components.\n * Extends Observable to provide event handling and adds:\n * - Element binding and management\n * - Options handling with deep extend\n * - Resize management\n * - CSS class application based on options\n * - ARIA accessibility support\n * - Licensing watermark support\n *\n \n *\n * @example\n * // ES6 class inheritance\n * class MyWidget extends Widget {\n *     init(element, options) {\n *         super.init(element, options);\n *         // widget-specific initialization\n *     }\n * }\n *\n * @example\n * // Legacy extend pattern\n * const MyWidget = Widget.extend({\n *     init: function(element, options) {\n *         Widget.fn.init.call(this, element, options);\n *         // widget-specific initialization\n *     },\n *     options: {\n *         name: \"MyWidget\"\n *     }\n * });\n */\n\nimport { Observable } from \"./observable\";\nimport type {\n    IWidget,\n    IWidgetOptions,\n    IWidgetSize,\n    IComponentTypes\n} from \"../models/widget\";\nimport type { IKendoJQuery } from \"../models/kendo-jquery\";\nimport { inject } from \"../service-container\";\nimport { KendoJQueryService } from \"../services/kendo-jquery.service\";\nimport { DomUtilsService } from \"../services/dom-utils.service\";\nimport { UtilsService } from \"../services/utils.service\";\nimport { CssPropertiesService } from \"../services/css-properties.service\";\nimport * as licensing from \"../../kendo.licensing.js\";\nimport { WidgetPropertyEntry } from \"../models\";\n\n// CSS property names that can be applied to widgets\nconst cssPropertiesNames = [\"themeColor\", \"fillMode\", \"shape\", \"size\", \"rounded\", \"positionMode\"];\n\n// ARIA constants\nconst ARIA_LABELLEDBY = \"aria-labelledby\";\nconst ARIA_LABEL = \"aria-label\";\nconst LABELIDPART = \"_label\";\n\n/**\n * Base Widget class for Kendo UI components.\n */\nexport class Widget<TOptions extends IWidgetOptions = IWidgetOptions> extends Observable implements IWidget<TOptions> {\n    /**\n     * Static reference to prototype (jQuery-like pattern used throughout Kendo)\n     */\n    static fn: Widget;\n\n    /**\n     * Static call method to support legacy pattern: Widget.call(this, element, options)\n     * \n     * ES6 classes cannot be invoked with Function.prototype.call(), but some legacy\n     * code uses `kendo.ui.Widget.call(this, element, options)` instead of the proper\n     * `Widget.fn.init.call(this, element, options)` pattern.\n     * \n     * By defining a static `call` method, we intercept these calls and route them\n     * to the init method, maintaining backward compatibility.\n     * \n     * @param thisArg - The context (this) to call init on\n     * @param element - The DOM element to bind the widget to\n     * @param options - Widget configuration options\n     */\n    static call(thisArg: any, element?: HTMLElement | IKendoJQuery, options?: Partial<IWidgetOptions>): void {\n        Widget.fn.init.call(thisArg, element, options);\n    }\n\n    /**\n     * Static apply method to support legacy pattern: Widget.apply(this, arguments)\n     * \n     * Similar to call(), this intercepts Function.prototype.apply() calls.\n     * \n     * @param thisArg - The context (this) to call init on\n     * @param args - Array of arguments [element, options]\n     */\n    static apply(thisArg: any, args?: [HTMLElement | IKendoJQuery, Partial<IWidgetOptions>?] | IArguments): void {\n        Widget.fn.init.apply(thisArg, args as any);\n    }\n\n    /**\n     * The wrapped element for this widget\n     */\n    element!: IKendoJQuery;\n\n    /**\n     * The wrapper element (may differ from element for some widgets)\n     */\n    wrapper?: IKendoJQuery;\n\n    /**\n     * Widget options - defined on prototype, not instance.\n     * Subclasses override this on their prototype via extend().\n     */\n    declare options: TOptions;\n\n    /**\n     * Default options for the widget\n     */\n    defaults?: Partial<IWidgetOptions>;\n\n    /**\n     * Component type variations\n     */\n    componentTypes?: IComponentTypes;\n\n    /**\n     * Array of event names this widget can trigger.\n     * Defined on prototype, not instance.\n     */\n    declare events: string[];\n\n    /**\n     * Internal size cache\n     */\n    _size?: IWidgetSize;\n\n    /**\n     * Watermark overlay function (set when license validation fails)\n     */\n    _showWatermarkOverlay?: (element: HTMLElement) => void;\n\n    /**\n     * Constructor - receives element and options and calls init().\n     * This mirrors the legacy extend() pattern where the constructor IS the init function.\n     * \n     * @param element - The DOM element to bind the widget to\n     * @param options - Widget configuration options\n     */\n    constructor(element?: HTMLElement | IKendoJQuery, options?: Partial<TOptions>) {\n        super();\n        // Call init with the provided arguments\n        if (element !== undefined) {\n            this.init(element, options);\n        }\n    }\n\n    /**\n     * Initialize the widget\n     * @param element - The DOM element to bind to\n     * @param options - Widget configuration options\n     */\n    init(element: HTMLElement | IKendoJQuery, options?: Partial<TOptions>): void {\n        const that = this;\n\n        // Check licensing\n        if (!licensing.validatePackage()) {\n            that._showWatermarkOverlay = licensing.addWatermarkOverlayAndBanner;\n        }\n\n        // Wrap element with KendoJQuery and bind handler\n        const kendoJQuery = inject(KendoJQueryService).getConstructor();\n        that.element = kendoJQuery(element).handler(that) as IKendoJQuery;\n\n        // Initialize Observable\n        Observable.fn.init.call(that);\n\n        // Handle dataSource special case - avoid deep cloning\n        let dataSource = options ? (options as any).dataSource : null;\n        let props: Partial<IWidgetOptions> | undefined;\n\n        if (options) {\n            props = (that.componentTypes || {})[options.componentType as string];\n        }\n\n        if (dataSource) {\n            // Avoid deep cloning the data source\n            options = kendoJQuery.extend({}, options, { dataSource: {} });\n        }\n\n        options = that.options = kendoJQuery.extend(true, {}, that.options, that.defaults, props || {}, options) as TOptions;\n\n        // Restore dataSource reference\n        if (dataSource) {\n            (options as any).dataSource = dataSource;\n        }\n\n        // Set data-role attribute if not present\n        const roleAttr = inject(DomUtilsService).attr(\"role\");\n        if (!that.element.attr(roleAttr)) {\n            that.element.attr(roleAttr, (options.name || \"\").toLowerCase());\n        }\n\n        // Store widget instance on element\n        that.element.data(\"kendo\" + options.prefix + options.name, that);\n\n        // Bind events from options\n        that.bind(that.events, options);\n    }\n\n    /**\n     * Check if the element has a MVVM binding target\n     * @returns true if the element has a bindingTarget\n     */\n    _hasBindingTarget(): boolean {\n        return !!(this.element[0] as any).kendoBindingTarget;\n    }\n\n    /**\n     * Set up tabindex on target element\n     * @param target - Target element (defaults to wrapper)\n     */\n    _tabindex(target?: IKendoJQuery): void {\n        target = target || this.wrapper;\n\n        const element = this.element;\n        const TABINDEX = \"tabindex\";\n        const tabindex = target!.attr(TABINDEX) || element.attr(TABINDEX);\n\n        element.removeAttr(TABINDEX);\n\n        target!.attr(TABINDEX, !isNaN(tabindex as any) ? tabindex : 0);\n    }\n\n    /**\n     * Update widget options\n     * @param options - New options to merge\n     */\n    setOptions(options: Partial<TOptions>): void {\n        this._clearCssClasses(options);\n        this._setEvents(options);\n        inject(KendoJQueryService).getConstructor().extend(this.options, options);\n        this._applyCssClasses();\n    }\n\n    /**\n     * Internal method to update event bindings when options change\n     * @param options - New options containing event handlers\n     */\n    _setEvents(options: Partial<TOptions>): void {\n        const that = this;\n        let idx = 0;\n        const length = that.events.length;\n        let e: string;\n\n        for (; idx < length; idx++) {\n            e = that.events[idx];\n            if (that.options[e] && options[e]) {\n                that.unbind(e, that.options[e]);\n                if (that._events && that._events[e]) {\n                    delete that._events[e];\n                }\n            }\n        }\n\n        that.bind(that.events, options);\n    }\n\n    /**\n     * Handle resize events\n     * @param force - Force resize even if size hasn't changed\n     */\n    resize(force?: boolean): void {\n        const size = this.getSize();\n        const currentSize = this._size;\n\n        if (force || (size.width > 0 || size.height > 0) && (!currentSize || size.width !== currentSize.width || size.height !== currentSize.height)) {\n            this._size = size;\n            this._resize(size, force);\n            this.trigger(\"resize\", size);\n        }\n    }\n\n    /**\n     * Get current widget dimensions\n     * @returns Size object with width and height\n     */\n    getSize(): IWidgetSize {\n        return inject(DomUtilsService).dimensions(this.element as any);\n    }\n\n    /**\n     * Get or set widget size\n     * @param size - Optional size to set\n     * @returns Current size if no argument, undefined if setting\n     */\n    size(size?: IWidgetSize): IWidgetSize | void {\n        if (!size) {\n            return this.getSize();\n        } else {\n            this.setSize(size);\n        }\n    }\n\n    /**\n     * Set widget size (override in subclasses)\n     * @param size - Size to set\n     */\n    setSize(_size: IWidgetSize): void {\n        // noop - override in subclasses\n    }\n\n    /**\n     * Internal resize handler (override in subclasses)\n     * @param size - New size\n     * @param force - Whether resize was forced\n     */\n    _resize(_size: IWidgetSize, _force?: boolean): void {\n        // noop - override in subclasses\n    }\n\n    /**\n     * Destroy the widget and clean up resources\n     */\n    destroy(): void {\n        const that = this;\n\n        that.element.removeData(\"kendo\" + that.options.prefix + that.options.name);\n        that.element.removeData(\"handler\");\n        that.unbind();\n    }\n\n    /**\n     * Internal destroy method\n     */\n    _destroy(): void {\n        this.destroy();\n    }\n\n    /**\n     * Apply CSS classes based on widget options\n     * @param element - Optional element to apply classes to\n     */\n    _applyCssClasses(element?: IKendoJQuery): void {\n        const protoOptions = (this as any).__proto__.options;\n        const options = this.options;\n        const el = element || this.wrapper || this.element;\n        const classes: string[] = [];\n        let i: number;\n        let prop: string;\n        let widgetName: string;\n        let widgetProperties: WidgetPropertyEntry;\n\n        const cssProps = inject(CssPropertiesService);\n\n        widgetName = this.options._altname || protoOptions.name;\n        widgetProperties = cssProps.propertyDictionary[widgetName];\n\n        if (!cssProps || !widgetProperties) {\n            return;\n        }\n\n        for (i = 0; i < cssPropertiesNames.length; i++) {\n            prop = cssPropertiesNames[i];\n            widgetName = this.options._altname || protoOptions.name;\n\n            if ((prop in protoOptions) || (prop in options)) {\n                classes.push(cssProps.getValidClass({\n                    widget: widgetName,\n                    propName: prop,\n                    value: options[prop as keyof TOptions]\n                }));\n            }\n        }\n\n        el.addClass(classes.join(\" \"));\n    }\n\n    /**\n     * Set up ARIA label for accessibility\n     * @param target - Target element to apply ARIA attributes to\n     */\n    _ariaLabel(target: IKendoJQuery): void {\n        const that = this;\n        const inputElm = that.element;\n        const inputId = inputElm.attr(\"id\");\n        const $ = inject(KendoJQueryService).getConstructor();\n        const labelElm = $(\"label[for=\\\"\" + inputId + \"\\\"]\");\n        const ariaLabel = inputElm.attr(ARIA_LABEL);\n        const ariaLabelledBy = inputElm.attr(ARIA_LABELLEDBY);\n        let labelId: string;\n\n        if (target[0] === inputElm[0]) {\n            return;\n        }\n\n        if (ariaLabel) {\n            target.attr(ARIA_LABEL, ariaLabel);\n        } else if (ariaLabelledBy) {\n            target.attr(ARIA_LABELLEDBY, ariaLabelledBy);\n        } else if (labelElm.length) {\n            // Use utils.guid() for generating unique IDs\n            const guid = inject(UtilsService).guid();\n            labelId = labelElm.attr(\"id\") || that._generateLabelId(labelElm, inputId || guid);\n            target.attr(ARIA_LABELLEDBY, labelId);\n        }\n    }\n\n    /**\n     * Clear CSS classes before updating options\n     * @param newOptions - New options being applied\n     * @param element - Optional element to clear classes from\n     */\n    _clearCssClasses(newOptions: Partial<IWidgetOptions>, element?: IKendoJQuery): void {\n        const protoOptions = (this as any).__proto__.options;\n        const currentOptions = this.options;\n        const el = element || this.wrapper || this.element;\n        let i: number;\n        let prop: string;\n        let widgetName: string;\n        let widgetProperties: WidgetPropertyEntry;\n\n        const cssProps = inject(CssPropertiesService);\n\n        widgetName = this.options._altname || protoOptions.name;\n        widgetProperties = cssProps.propertyDictionary[widgetName];\n\n        if (!cssProps || !widgetProperties) {\n            return;\n        }\n\n        for (i = 0; i < cssPropertiesNames.length; i++) {\n            prop = cssPropertiesNames[i];\n\n            if (((prop in protoOptions) || (prop in currentOptions)) && newOptions.hasOwnProperty(prop)) {\n                if (prop === \"themeColor\") {\n                    el.removeClass(cssProps.getValidClass({\n                        widget: widgetName,\n                        propName: prop,\n                        value: currentOptions[prop],\n                        fill: currentOptions.fillMode\n                    }));\n                } else {\n                    if (prop === \"fillMode\") {\n                        el.removeClass(cssProps.getValidClass({\n                            widget: widgetName,\n                            propName: \"themeColor\",\n                            value: currentOptions.themeColor,\n                            fill: currentOptions.fillMode\n                        }));\n                    }\n\n                    el.removeClass(cssProps.getValidClass({\n                        widget: widgetName,\n                        propName: prop,\n                        value: currentOptions[prop]\n                    }));\n                }\n            }\n        }\n    }\n\n    /**\n     * Generate a unique label ID for ARIA\n     * @param label - Label element\n     * @param inputId - Input element ID\n     * @returns Generated label ID\n     */\n    _generateLabelId(label: IKendoJQuery, inputId: string): string {\n        const labelId = inputId + LABELIDPART;\n\n        label.attr(\"id\", labelId);\n\n        return labelId;\n    }\n}\n\n// Set up static fn reference (jQuery-like pattern)\nWidget.fn = Widget.prototype;\n\n// Define options and events on prototype (like original Kendo extend pattern)\n// This is critical for the legacy extend() pattern to work correctly\nWidget.prototype.options = {\n    prefix: \"\"\n};\nWidget.prototype.events = [];\n\n// Re-export types for convenience\nexport type {\n    IWidget,\n    IWidgetOptions,\n    IWidgetSize,\n    IComponentTypes,\n    WidgetConstructor\n} from \"../models/widget\";\n","import { IHtmlService } from \"../models/html\";\n\n// Regex patterns for HTML encoding\nconst ampRegExp = /&/g;\nconst ltRegExp = /</g;\nconst quoteRegExp = /\"/g;\nconst aposRegExp = /'/g;\nconst gtRegExp = />/g;\n\n// Allowed protocols for sanitized links\nconst ALLOWED_PROTOCOLS = [\"http:\", \"https:\"];\n\n/**\n * Service for HTML encoding, decoding, and sanitization\n */\nexport class HtmlService implements IHtmlService {\n    /**\n     * Decode HTML entities to their character equivalents\n     */\n    decode(value: string): string {\n        const entities: { [key: string]: string } = {\n            '&amp;': '&',\n            '&lt;': '<',\n            '&gt;': '>',\n            '&quot;': '\"',\n            '&#39;': \"'\"\n        };\n\n        return value.replace(/&(?:amp|lt|gt|quot|#39);/g, function(match) {\n            return entities[match];\n        });\n    }\n\n    /**\n     * Encode special characters to HTML entities\n     */\n    encode(value: string, shouldDecode?: boolean): string {\n        if (shouldDecode === true) {\n            value = this.decode(value);\n        }\n\n        return (\"\" + value)\n            .replace(ampRegExp, \"&amp;\")\n            .replace(ltRegExp, \"&lt;\")\n            .replace(gtRegExp, \"&gt;\")\n            .replace(quoteRegExp, \"&quot;\")\n            .replace(aposRegExp, \"&#39;\");\n    }\n\n    /**\n     * Sanitize a URL to prevent XSS attacks\n     * Only allows http: and https: protocols\n     */\n    sanitizeLink(value: string): string {\n        let link = \"\";\n\n        try {\n            // Use the default origin in case the value is a relative URL.\n            const url = new URL(value, window.location.origin);\n            if (ALLOWED_PROTOCOLS.includes(url.protocol)) {\n                link = value;\n            } else {\n                throw new Error(\"Invalid protocol\");\n            }\n        } catch {\n            link = \"#INVALIDLINK\";\n        }\n\n        return this.encode(link);\n    }\n\n    /**\n     * Convert text URLs to clickable HTML links\n     */\n    convertTextUrlToLink(text: string, skipSanitization?: boolean): string {\n        const urlRegex = /((https?:\\/\\/[^\\s\"'<>]+)|(www\\.[^\\s\"'<>]+))/gi;\n        const processedText = skipSanitization ? text : this.encode(text);\n\n        return processedText.replace(urlRegex, (match, _p1, _p2, _p3, offset, fullString) => {\n            const lastTagClose = fullString.lastIndexOf('>', offset - 1);\n            const beforeMatch = fullString.substring(lastTagClose + 1, offset);\n\n            if (/\\w+\\s*=\\s*[\"']$/.test(beforeMatch)) {\n                return match;\n            }\n\n            let url = match.trim();\n            const displayText = match.trim();\n\n            if (/^www\\./i.test(url)) {\n                url = 'https://' + url;\n            }\n\n            try {\n                url = new URL(url).href;\n\n                const target = '_blank';\n                const rel = 'noopener noreferrer';\n\n                return `<a href=\"${url}\" target=\"${target}\"${rel ? ` rel=\"${rel}\"` : ''}>${displayText}</a>`;\n            } catch (e) { //NOSONAR - No need to handle/log the error here.\n                // If URL is invalid, return original text\n                return match;\n            }\n        });\n    }\n\n    /**\n     * Unescape URL-encoded strings\n     */\n    unescape(value: string): string {\n        let template: string;\n\n        try {\n            template = window.decodeURIComponent(value);\n        } catch (error) {\n            // If the string contains Unicode characters\n            // the decodeURIComponent() will throw an error.\n            // Therefore: convert to UTF-8 character\n            template = value.replace(/%u([\\dA-F]{4})|%([\\dA-F]{2})/gi, function (_, m1, m2) {\n                return String.fromCharCode(parseInt(\"0x\" + (m1 || m2), 16));\n            });\n        }\n\n        return template;\n    }\n}\n","import { Culture, ICultureService, CalendarStandard } from \"../models/culture\";\nimport { IDateParserService } from \"../models/parser\";\n\nconst DATE_OBJECT = \"[object Date]\";\nconst objectToString = {}.toString;\n\nconst SHORT_TIMEZONE_REGEX = /[+|\\-]\\d{1,2}/;\nconst LONG_TIMEZONE_REGEX = /[+|\\-]\\d{1,2}:?\\d{2}/;\nconst MICROSOFT_DATE_REGEX = /^\\/Date\\((.*?)\\)\\/$/;\nconst OFFSET_REGEX = /[+-]\\d*/;\n\nconst FORMATS_SEQUENCE = [[], [\"G\", \"g\", \"F\"], [\"D\", \"d\", \"y\", \"m\", \"T\", \"t\"]];\nconst STANDARD_FORMATS = [\n    [\n        \"yyyy-MM-ddTHH:mm:ss.fffffffzzz\",\n        \"yyyy-MM-ddTHH:mm:ss.fffffff\",\n        \"yyyy-MM-ddTHH:mm:ss.fffzzz\",\n        \"yyyy-MM-ddTHH:mm:ss.fff\",\n        \"ddd MMM dd yyyy HH:mm:ss\",\n        \"yyyy-MM-ddTHH:mm:sszzz\",\n        \"yyyy-MM-ddTHH:mmzzz\",\n        \"yyyy-MM-ddTHH:mmzz\",\n        \"yyyy-MM-ddTHH:mm:ss\",\n        \"yyyy-MM-dd HH:mm:ss\",\n        \"yyyy/MM/dd HH:mm:ss\"\n    ],\n    [\n        \"yyyy-MM-ddTHH:mm\",\n        \"yyyy-MM-dd HH:mm\",\n        \"yyyy/MM/dd HH:mm\"\n    ],\n    [\n        \"yyyy/MM/dd\",\n        \"yyyy-MM-dd\",\n        \"HH:mm:ss\",\n        \"HH:mm\"\n    ]\n];\n\nconst NUMBER_REGEX: { [key: string]: RegExp } = {\n    2: /^\\d{1,2}/,\n    3: /^\\d{1,3}/,\n    4: /^\\d{4}/,\n    exact3: /^\\d{3}/\n};\n\ninterface TimezoneService {\n    apply(date: Date, offset: number): Date;\n    convert(date: Date, fromOffset: number, toOffset: number): Date;\n}\n\nexport class DateParserService implements IDateParserService {\n    private timezoneService: TimezoneService | null = null;\n\n    constructor(\n        private cultureService: ICultureService,\n        private roundFn: (value: number, precision: number) => string\n    ) {}\n\n    /**\n     * Set the timezone service (injected later due to circular dependency)\n     */\n    setTimezoneService(timezoneService: TimezoneService): void {\n        this.timezoneService = timezoneService;\n    }\n\n    /**\n     * Parse a date string according to specified formats and culture\n     */\n    parseDate(\n        value: string | Date | null | undefined,\n        formats?: string | string[],\n        culture?: string | Culture,\n        shouldUnpadZeros?: boolean\n    ): Date | null {\n        return this.internalParseDate(value, formats, culture, false, shouldUnpadZeros);\n    }\n\n    /**\n     * Parse a date string using exact format matching\n     */\n    parseExactDate(\n        value: string | Date | null | undefined,\n        formats?: string | string[],\n        culture?: string | Culture\n    ): Date | null {\n        return this.internalParseDate(value, formats, culture, true);\n    }\n\n    private internalParseDate(\n        value: string | Date | null | undefined,\n        formats: string | string[] | undefined,\n        culture: string | Culture | undefined,\n        strict: boolean,\n        shouldUnpadZeros?: boolean\n    ): Date | null {\n        if (objectToString.call(value) === DATE_OBJECT) {\n            return value as Date;\n        }\n\n        if (!value) {\n            return null;\n        }\n\n        const strValue = String(value);\n        let date: Date | null = null;\n        let tzoffset: RegExpExecArray | null;\n\n        // Handle Microsoft JSON date format: /Date(milliseconds)/\n        if (strValue.indexOf(\"/D\") === 0) {\n            const dateMatch = MICROSOFT_DATE_REGEX.exec(strValue);\n            if (dateMatch) {\n                let dateStr = dateMatch[1];\n                tzoffset = OFFSET_REGEX.exec(dateStr.substring(1));\n\n                date = new Date(parseInt(dateStr, 10));\n\n                if (tzoffset && this.timezoneService) {\n                    const offset = this.parseMicrosoftFormatOffset(tzoffset[0]);\n                    date = this.timezoneService.apply(date, 0);\n                    date = this.timezoneService.convert(date, 0, -1 * offset);\n                }\n\n                return date;\n            }\n        }\n\n        const resolvedCulture = this.cultureService.getCulture(culture);\n\n        let formatArray: string[];\n        if (!formats) {\n            formatArray = this.getDefaultFormats(resolvedCulture);\n        } else {\n            formatArray = Array.isArray(formats) ? formats : [formats];\n        }\n\n        for (let idx = 0; idx < formatArray.length; idx++) {\n            date = this.parseExact(strValue, formatArray[idx], resolvedCulture, strict, shouldUnpadZeros);\n            if (date) {\n                return date;\n            }\n        }\n\n        return date;\n    }\n\n    private parseExact(\n        value: string,\n        format: string,\n        culture: Culture,\n        strict: boolean,\n        shouldUnpadZeros?: boolean\n    ): Date | null {\n        if (!value) {\n            return null;\n        }\n\n        const calendar = culture.calendars.standard;\n        let idx = 0;\n        let valueIdx = 0;\n\n        const lookAhead = (match: string): number => {\n            let i = 0;\n            while (format[idx] === match) {\n                i++;\n                idx++;\n            }\n            if (i > 0) {\n                idx -= 1;\n            }\n            return i;\n        };\n\n        const getNumber = (size: number): number | null => {\n            let part = \"\";\n            if (size === 2) {\n                for (let i = 0; i <= size; i++) {\n                    part += value[valueIdx + i] || \"\";\n                }\n            }\n\n            // If the value comes in the form of 021, 022, 023 we must trim the leading zero\n            if (shouldUnpadZeros && part.match(NUMBER_REGEX.exact3) && Number.isInteger(Number(part)) && Number(part) > 0) {\n                part = this.unpadZero(part);\n            } else {\n                part = value.substr(valueIdx, size);\n            }\n\n            const rg = NUMBER_REGEX[size] || new RegExp('^\\\\d{1,' + size + '}');\n            const match = part.match(rg);\n\n            if (match) {\n                const matchStr = match[0];\n                valueIdx += matchStr.length;\n                return parseInt(matchStr, 10);\n            }\n            return null;\n        };\n\n        const getIndexByName = (names: string[], lower: boolean, subLength?: number): number | null => {\n            let matchLength = 0;\n            let matchIdx = 0;\n\n            for (let i = 0; i < names.length; i++) {\n                const name = names[i];\n                const nameLength = name.length;\n                let subValue = value.substr(valueIdx, subLength || nameLength);\n\n                if (lower) {\n                    subValue = subValue.toLowerCase();\n                }\n\n                if (subValue === name && nameLength > matchLength) {\n                    matchLength = nameLength;\n                    matchIdx = i;\n                }\n            }\n\n            if (matchLength) {\n                valueIdx += matchLength;\n                return matchIdx + 1;\n            }\n\n            return null;\n        };\n\n        const checkLiteral = (): boolean => {\n            if (value.charAt(valueIdx) === format[idx]) {\n                valueIdx++;\n                return true;\n            }\n            return false;\n        };\n\n        let year: number | null = null;\n        let month: number | null = null;\n        let day: number | null = null;\n        let hours: number | null = null;\n        let minutes: number | null = null;\n        let seconds: number | null = null;\n        let milliseconds: number | null = null;\n        let literal = false;\n        const date = new Date();\n        const twoDigitYearMax = calendar.twoDigitYearMax || 2029;\n        const defaultYear = date.getFullYear();\n        let pmHour: number | null = null;\n        let UTC: boolean | undefined;\n        let hoursOffset: number | null = null;\n        let minutesOffset: number | null = null;\n\n        if (!format) {\n            format = \"d\";\n        }\n\n        // If format is part of the patterns get real format\n        const pattern = (calendar.patterns as any)[format];\n        if (pattern) {\n            format = pattern;\n        }\n\n        const formatChars = format.split(\"\");\n        const length = formatChars.length;\n\n        // Ensure lower case versions exist\n        if (!(calendar as any)._lowerDays) {\n            (calendar as any)._lowerDays = this.lowerLocalInfo(calendar.days);\n        }\n        if (!(calendar as any)._lowerMonths) {\n            (calendar as any)._lowerMonths = this.lowerLocalInfo(calendar.months);\n        }\n\n        for (; idx < length; idx++) {\n            const ch = formatChars[idx];\n\n            if (literal) {\n                if (ch === \"'\") {\n                    literal = false;\n                } else {\n                    checkLiteral();\n                }\n            } else {\n                if (ch === \"d\") {\n                    const count = lookAhead(\"d\");\n\n                    if (day !== null && count > 2) {\n                        continue;\n                    }\n\n                    day = count < 3\n                        ? getNumber(2)\n                        : getIndexByName((calendar as any)._lowerDays[count === 3 ? \"namesAbbr\" : \"names\"], true);\n\n                    if (day === null || this.outOfRange(day, 1, 31)) {\n                        return null;\n                    }\n                } else if (ch === \"M\") {\n                    const count = lookAhead(\"M\");\n\n                    month = count < 3\n                        ? getNumber(2)\n                        : getIndexByName((calendar as any)._lowerMonths[count === 3 ? \"namesAbbr\" : \"names\"], true);\n\n                    if (month === null || this.outOfRange(month, 1, 12)) {\n                        return null;\n                    }\n                    month -= 1; // Month is zero based\n                } else if (ch === \"y\") {\n                    const count = lookAhead(\"y\");\n                    year = getNumber(count);\n\n                    if (year === null) {\n                        return null;\n                    }\n\n                    if (count === 2) {\n                        let maxYear = twoDigitYearMax;\n                        if (typeof maxYear === \"string\") {\n                            maxYear = defaultYear + parseInt(maxYear, 10);\n                        }\n\n                        year = (defaultYear - defaultYear % 100) + year;\n                        if (year > maxYear) {\n                            year -= 100;\n                        }\n                    }\n                } else if (ch === \"h\") {\n                    lookAhead(\"h\");\n                    hours = getNumber(2);\n                    if (hours === 12) {\n                        hours = 0;\n                    }\n                    if (hours === null || this.outOfRange(hours, 0, 11)) {\n                        return null;\n                    }\n                } else if (ch === \"H\") {\n                    lookAhead(\"H\");\n                    hours = getNumber(2);\n                    if (hours === null || this.outOfRange(hours, 0, 23)) {\n                        return null;\n                    }\n                } else if (ch === \"m\") {\n                    lookAhead(\"m\");\n                    minutes = getNumber(2);\n                    if (minutes === null || this.outOfRange(minutes, 0, 59)) {\n                        return null;\n                    }\n                } else if (ch === \"s\") {\n                    lookAhead(\"s\");\n                    seconds = getNumber(2);\n                    if (seconds === null || this.outOfRange(seconds, 0, 59)) {\n                        return null;\n                    }\n                } else if (ch === \"f\") {\n                    const count = lookAhead(\"f\");\n                    const match = value.substr(valueIdx, count).match(NUMBER_REGEX[3]);\n                    milliseconds = getNumber(count);\n\n                    if (milliseconds !== null && match) {\n                        let ms = parseFloat(\"0.\" + match[0]);\n                        ms = parseFloat(this.roundFn(ms, 3));\n                        milliseconds = ms * 1000;\n                    }\n\n                    if (milliseconds === null || this.outOfRange(milliseconds, 0, 999)) {\n                        return null;\n                    }\n                } else if (ch === \"t\") {\n                    const count = lookAhead(\"t\");\n                    let amDesignators = calendar.AM;\n                    let pmDesignators = calendar.PM;\n\n                    if (count === 1) {\n                        amDesignators = this.mapDesignators(amDesignators);\n                        pmDesignators = this.mapDesignators(pmDesignators);\n                    }\n\n                    pmHour = getIndexByName(pmDesignators, false, this.longestStringLength(pmDesignators));\n                    if (!pmHour && !getIndexByName(amDesignators, false, this.longestStringLength(amDesignators))) {\n                        return null;\n                    }\n                } else if (ch === \"z\") {\n                    UTC = true;\n                    const count = lookAhead(\"z\");\n\n                    if (value.substr(valueIdx, 1) === \"Z\") {\n                        checkLiteral();\n                        continue;\n                    }\n\n                    const matches = value.substr(valueIdx, 6).match(count > 2 ? LONG_TIMEZONE_REGEX : SHORT_TIMEZONE_REGEX);\n\n                    if (!matches) {\n                        return null;\n                    }\n\n                    const matchParts = matches[0].split(\":\");\n                    let hoursOffsetStr = matchParts[0];\n                    let minutesOffsetStr = matchParts[1];\n\n                    if (!minutesOffsetStr && hoursOffsetStr.length > 3) {\n                        valueIdx = hoursOffsetStr.length - 2;\n                        minutesOffsetStr = hoursOffsetStr.substring(valueIdx);\n                        hoursOffsetStr = hoursOffsetStr.substring(0, valueIdx);\n                    }\n\n                    hoursOffset = parseInt(hoursOffsetStr, 10);\n                    if (this.outOfRange(hoursOffset, -12, 13)) {\n                        return null;\n                    }\n\n                    if (count > 2) {\n                        minutesOffsetStr = matchParts[0][0] + minutesOffsetStr;\n                        minutesOffset = parseInt(minutesOffsetStr, 10);\n                        if (isNaN(minutesOffset) || this.outOfRange(minutesOffset, -59, 59)) {\n                            return null;\n                        }\n                    }\n                } else if (ch === \"'\") {\n                    literal = true;\n                    checkLiteral();\n                } else if (!checkLiteral()) {\n                    return null;\n                }\n            }\n        }\n\n        // If more characters follow, assume wrong format (strict mode)\n        if (strict && !/^\\s*$/.test(value.substr(valueIdx))) {\n            return null;\n        }\n\n        const hasTime = hours !== null || minutes !== null || seconds !== null;\n\n        if (year === null && month === null && day === null && hasTime) {\n            year = defaultYear;\n            month = date.getMonth();\n            day = date.getDate();\n        } else {\n            if (year === null) {\n                year = defaultYear;\n            }\n            if (day === null) {\n                day = 1;\n            }\n        }\n\n        if (pmHour && hours !== null && hours < 12) {\n            hours += 12;\n        }\n\n        let result: Date;\n        if (UTC) {\n            if (hoursOffset && hours !== null) {\n                hours += -hoursOffset;\n            }\n            if (minutesOffset && minutes !== null) {\n                minutes += -minutesOffset;\n            }\n            result = new Date(Date.UTC(year!, month ?? 0, day, hours ?? 0, minutes ?? 0, seconds ?? 0, milliseconds ?? 0));\n        } else {\n            result = new Date(year!, month ?? 0, day, hours ?? 0, minutes ?? 0, seconds ?? 0, milliseconds ?? 0);\n            this.adjustDST(result, hours);\n        }\n\n        if (year! < 100) {\n            result.setFullYear(year!);\n        }\n\n        if (result.getDate() !== day && UTC === undefined) {\n            return null;\n        }\n\n        return result;\n    }\n\n    private parseMicrosoftFormatOffset(offset: string): number {\n        const sign = offset.substr(0, 1) === \"-\" ? -1 : 1;\n        offset = offset.substring(1);\n        const result = (parseInt(offset.substr(0, 2), 10) * 60) + parseInt(offset.substring(2), 10);\n        return sign * result;\n    }\n\n    private getDefaultFormats(culture: Culture): string[] {\n        const length = Math.max(FORMATS_SEQUENCE.length, STANDARD_FORMATS.length);\n        const calendar = culture.calendar || culture.calendars.standard;\n        const patterns = calendar.patterns;\n        const formats: string[] = [];\n\n        for (let idx = 0; idx < length; idx++) {\n            const cultureFormats = FORMATS_SEQUENCE[idx] || [];\n            for (let formatIdx = 0; formatIdx < cultureFormats.length; formatIdx++) {\n                formats.push((patterns as any)[cultureFormats[formatIdx]]);\n            }\n            formats.push(...(STANDARD_FORMATS[idx] || []));\n        }\n\n        return formats;\n    }\n\n    private outOfRange(value: number, start: number, end: number): boolean {\n        return !(value >= start && value <= end);\n    }\n\n    private adjustDST(date: Date, hours: number | null): void {\n        if (!hours && date.getHours() === 23) {\n            date.setHours(date.getHours() + 2);\n        }\n    }\n\n    private lowerLocalInfo(data: { names: string[]; namesAbbr: string[] }): { names: string[]; namesAbbr: string[] } {\n        return {\n            names: data.names.map(s => s.toLowerCase()),\n            namesAbbr: data.namesAbbr.map(s => s.toLowerCase())\n        };\n    }\n\n    private unpadZero(value: string): string {\n        return value.replace(/^0*/, '');\n    }\n\n    private mapDesignators(designators: string[]): string[] {\n        return designators.map(d => d.charAt(0));\n    }\n\n    private longestStringLength(strings: string[]): number {\n        return strings.reduce((max, s) => Math.max(max, s.length), 0);\n    }\n}\n","import \"../../kendo.data.js\"; // Stiil required until kendo.data is modularized\nimport { IKendoJQueryStatic } from \"../../core/index.js\";\nimport type { UtilsService } from \"../../core/services/utils.service.js\";\nimport type { IMessage, IChatOptions } from \"../models/index.js\";\nimport type { IFile } from \"../../upload\";\n\ndeclare const kendo: any;\ndeclare const $: IKendoJQueryStatic;\n\n/**\n * Data source schema configuration for chat messages.\n */\ninterface IDataSourceSchema {\n    model: {\n        id: string;\n        fields: Record<string, {\n            type?: string;\n            defaultValue?: any;\n            from?: string;\n            parse?: (value: any) => any;\n        }>;\n    };\n}\n\n/**\n * Internal options for the data collaborator.\n */\ninterface IDataManagerOptions {\n    autoSync: boolean;\n    autoAssignId?: boolean;\n    schema: IDataSourceSchema;\n    data?: any[];\n}\n\nexport interface IChatDataContext {\n    chatOptions: Partial<IChatOptions>;\n    utilsService: UtilsService;\n}\n\n/**\n * DataManager handles all data operations for the Chat component.\n * Manages message storage, retrieval, updates, and data source configuration.\n *\n * This is an internal collaborator - not a shared service.\n */\nexport class DataManager {\n    /** Default configuration options */\n    private static readonly DEFAULT_OPTIONS: IDataManagerOptions = {\n        autoSync: true,\n        schema: {\n            model: {\n                id: \"id\",\n                fields: {\n                    id: { type: \"string\" },\n                    text: { type: \"string\" },\n                    authorId: { type: \"string\" },\n                    authorName: { type: \"string\" },\n                    authorImageUrl: { type: \"string\" },\n                    authorImageAltText: { type: \"string\" },\n                    replyToId: { type: \"string\", defaultValue: null },\n                    isDeleted: { type: \"boolean\", defaultValue: false },\n                    isPinned: { type: \"boolean\", defaultValue: false },\n                    isTyping: { type: \"boolean\", defaultValue: false },\n                    timestamp: { type: \"date\" },\n                    files: { parse: (value: any) => value || [] }\n                }\n            }\n        }\n    };\n\n    /** Field mapping from chat options to data source fields */\n    private static readonly FIELD_MAP: Record<string, string> = {\n        text: \"textField\",\n        authorId: \"authorIdField\",\n        authorName: \"authorNameField\",\n        authorImageUrl: \"authorImageUrlField\",\n        authorImageAltText: \"authorImageAltTextField\",\n        id: \"idField\",\n        timestamp: \"timestampField\",\n        files: \"filesField\",\n        replyToId: \"replyToIdField\",\n        isDeleted: \"isDeletedField\",\n        isPinned: \"isPinnedField\",\n        isTyping: \"isTypingField\"\n    };\n\n    private dataSource: any; // kendo.data.DataSource\n    private options: IDataManagerOptions;\n    private context: IChatDataContext;\n\n    /**\n     * Constructs a new DataManager instance.\n     * @param context - Context with chat options and services\n     */\n    constructor(context: IChatDataContext) {\n        this.context = context;\n        this.options = this.buildOptions(context.chatOptions);\n        this.dataSource = this.createDataSource(context.chatOptions);\n    }\n\n    /**\n     * Builds internal options from chat options.\n     */\n    private buildOptions(chatOptions: Partial<IChatOptions>): IDataManagerOptions {\n        let options: IDataManagerOptions;\n\n        if (chatOptions.dataSource instanceof kendo.data.DataSource) {\n            options = $.extend(true, {}, DataManager.DEFAULT_OPTIONS, chatOptions.dataSource.options);\n        } else if (Array.isArray(chatOptions.dataSource)) {\n            options = $.extend(true, {}, DataManager.DEFAULT_OPTIONS, { data: chatOptions.dataSource });\n        } else {\n            options = $.extend(true, {}, DataManager.DEFAULT_OPTIONS, chatOptions.dataSource);\n        }\n\n        options.autoAssignId = chatOptions.autoAssignId;\n        this.mapFields(options.schema.model.fields, chatOptions);\n\n        return options;\n    }\n\n    /**\n     * Creates and configures a data source for the chat component.\n     */\n    private createDataSource(chatOptions: Partial<IChatOptions>): any {\n        if (chatOptions.dataSource instanceof kendo.data.DataSource) {\n            return chatOptions.dataSource;\n        }\n\n        return kendo.data.DataSource.create(this.options);\n    }\n\n    /**\n     * Maps field configuration from chat options to data source field definitions.\n     */\n    private mapFields(\n        fields: Record<string, any>,\n        chatOptions: Partial<IChatOptions>\n    ): void {\n        for (const key in fields) {\n            if (Object.prototype.hasOwnProperty.call(fields, key) && DataManager.FIELD_MAP[key]) {\n                const optionKey = DataManager.FIELD_MAP[key] as keyof IChatOptions;\n                fields[key].from = chatOptions[optionKey];\n            }\n        }\n    }\n\n    /**\n     * Gets the data source instance.\n     */\n    getDataSource(): any {\n        return this.dataSource;\n    }\n\n    /**\n     * Gets the current data source view.\n     */\n    getView(): IMessage[] {\n        return this.dataSource.view();\n    }\n\n    /**\n     * Gets the last message in the data source view.\n     */\n    getLastMessage(): IMessage | null {\n        const view = this.getView();\n        return view.length ? view[view.length - 1] : null;\n    }\n\n    /**\n     * Gets a message by ID from the data source.\n     */\n    getMessageById(id: string | number): IMessage | null {\n        if (!id) {\n            return null;\n        }\n        return this.dataSource.get(id);\n    }\n\n    /**\n     * Gets a message by UID from the data source.\n     */\n    getMessageByUid(uid: string): IMessage | null {\n        return this.dataSource.getByUid(uid);\n    }\n\n    /**\n     * Gets a file by UID from a message's files array.\n     */\n    getFileByUid(message: IMessage, uid: string): IFile | null {\n        if (!message || !uid) {\n            return null;\n        }\n        return message.files.find(file => file.uid === uid) || null;\n    }\n\n    /**\n     * Gets the currently pinned message.\n     */\n    getPinnedMessage(): IMessage | null {\n        return this.dataSource.data().find((m: IMessage) => m.isPinned) || null;\n    }\n\n    /**\n     * Adds a new message to the data source.\n     */\n    postMessage(message: string | Partial<IMessage>, currentUserId: string): IMessage {\n        const messageInput = typeof message === \"string\" ? { text: message } : message;\n\n        const messageData: Partial<IMessage> = {\n            id: this.options.autoAssignId ? this.context.utilsService.guid() : undefined,\n            timestamp: new Date(),\n            files: [],\n            ...messageInput,\n            authorId: messageInput.authorId?.toString() || currentUserId\n        };\n\n        return this.dataSource.add(messageData);\n    }\n\n    /**\n     * Updates a message in the data source.\n     */\n    updateMessage(message: IMessage | Partial<IMessage>, newData: Partial<IMessage>): IMessage | null {\n        if (!message) {\n            return null;\n        }\n\n        let targetMessage = message;\n        if (!(message instanceof kendo.data.ObservableObject)) {\n            targetMessage = this.getMessageById((message as IMessage).id)!;\n        }\n\n        if (!targetMessage) {\n            return null;\n        }\n\n        for (const key in newData) {\n            if (Object.prototype.hasOwnProperty.call(newData, key)) {\n                (targetMessage as any).set(key, (newData as any)[key]);\n            }\n        }\n\n        return targetMessage as IMessage;\n    }\n\n    /**\n     * Marks a message as deleted.\n     */\n    removeMessage(message: IMessage): boolean {\n        if (!message) {\n            return false;\n        }\n\n        (message as any).set(\"isDeleted\", true);\n        return true;\n    }\n\n    /**\n     * Pins a message.\n     */\n    pinMessage(message: IMessage): IMessage | false {\n        if (!message) {\n            return false;\n        }\n\n        // Unpin any currently pinned message\n        const pinnedMessage = this.getPinnedMessage();\n        if (pinnedMessage) {\n            (pinnedMessage as any).set(\"isPinned\", false);\n        }\n\n        (message as any).set(\"isPinned\", true);\n        return message;\n    }\n\n    /**\n     * Clears the currently pinned message.\n     */\n    clearPinnedMessage(): void {\n        const pinnedMessage = this.getPinnedMessage();\n        if (pinnedMessage) {\n            (pinnedMessage as any).set(\"isPinned\", false);\n        }\n    }\n}\n","/**\n * Chat component constants\n *\n * This module contains all constants used throughout the Chat widget\n * and its collaborators.\n */\n\n/** Namespace for event binding */\nexport const NS = \".kendoChat\";\n\n/** Message width display modes */\nexport const MESSAGE_WIDTH_MODE = {\n    STANDARD: \"standard\",\n    FULL: \"full\"\n} as const;\n\n/** Message status values */\nexport const MESSAGE_STATUS = {\n    SENT: \"sent\",\n    DELIVERED: \"delivered\",\n    SEEN: \"seen\",\n    FAILED: \"failed\"\n} as const;\n\n/** Files layout modes */\nexport const FILES_LAYOUT_MODE = {\n    HORIZONTAL: \"horizontal\",\n    VERTICAL: \"vertical\",\n    WRAP: \"wrap\"\n} as const;\n\n/** Suggested actions layout modes */\nexport const SUGGESTED_ACTIONS_LAYOUT_MODE = {\n    SCROLL: \"scroll\",\n    WRAP: \"wrap\",\n    SCROLLBUTTONS: \"scrollbuttons\"\n} as const;\n\n/** Icon identifiers used in the Chat component */\nexport const ICONS = {\n    attachment: \"paperclip-outline-alt-right\",\n    attachmentMenu: \"more-vertical\",\n    checkCircle: \"check-circle\",\n    chevronDown: \"chevron-down\",\n    chevronLeft: \"chevron-left\",\n    chevronRight: \"chevron-right\",\n    chevronUp: \"chevron-up\",\n    download: \"download\",\n    fileError: \"file-error\",\n    filePdf: \"file-pdf\",\n    microphoneOutline: \"microphone-outline\",\n    pin: \"pin\",\n    undo: \"undo\",\n    copy: \"copy\",\n    trash: \"trash\",\n    send: \"paper-plane\",\n    stop: \"stop-sm\",\n    upload: \"upload\",\n    x: \"x\",\n    arrowDown: \"arrow-down\",\n    retry: \"arrow-rotate-cw\"\n} as const;\n\n/** Command identifiers for menu actions */\nexport const COMMANDS = {\n    reply: \"reply\",\n    copy: \"copy\",\n    pin: \"pin\",\n    delete: \"delete\",\n    download: \"download\"\n} as const;\n\n/** CSS class names used in the Chat component */\nexport const STYLES = {\n    // State classes\n    active: \"k-active\",\n    selected: \"k-selected\",\n    focus: \"k-focus\",\n    expanded: \"k-expanded\",\n    disabled: \"k-disabled\",\n    hidden: \"k-hidden\",\n    generating: \"k-generating\",\n    noAvatar: \"k-no-avatar\",\n\n    // Files\n    file: \"k-file-box\",\n    fileInfo: \"k-file-info\",\n    fileName: \"k-file-name\",\n    fileSize: \"k-file-size\",\n    fileWrapper: \"k-file-box-wrapper\",\n    fileWrapperScrollableStart: \"k-file-box-wrapper-scrollable-start\",\n    filesScroll: \"k-files-scroll\",\n    filesVertical: \"k-files-vertical\",\n    filesWrap: \"k-files-wrap\",\n\n    // Avatar\n    avatar: \"k-avatar\",\n\n    // Bubble styles\n    bubble: \"k-bubble\",\n    bubbleContent: \"k-bubble-content\",\n    bubbleExpandable: \"k-bubble-expandable\",\n    bubbleExpandableIndicator: \"k-bubble-expandable-indicator\",\n    chatBubble: \"k-chat-bubble\",\n    chatBubbleText: \"k-chat-bubble-text\",\n\n    // Buttons\n    button: \"k-button\",\n    buttonDefaults: \"k-button-md k-rounded-md k-button-solid k-button-solid-base\",\n    buttonIcon: \"k-button-icon\",\n    buttonPrimary: \"k-button-md k-rounded-md k-button-flat k-button-flat-primary\",\n    iconButton: \"k-icon-button\",\n    menuButton: \"k-menu-button\",\n    chatSend: \"k-chat-send\",\n    chatUpload: \"k-chat-upload\",\n    downloadButton: \"k-chat-download-button\",\n    downloadButtonWrapper: \"k-chat-download-button-wrapper\",\n\n    // Cards\n    canvas: \"k-chat-canvas\",\n    card: \"k-card\",\n    cardAction: \"k-card-action\",\n    cardActions: \"k-card-actions\",\n    cardActionsVertical: \"k-actions-vertical\",\n    cardBody: \"k-card-body\",\n    cardDeck: \"k-card-deck\",\n    cardDeckScrollWrap: \"k-card-deck-scrollwrap\",\n    cardList: \"k-card-list\",\n    cardMedia: \"k-card-media\",\n    cardRich: \"k-card-type-rich\",\n    cardSubtitle: \"k-card-subtitle\",\n    cardTitle: \"k-card-title\",\n    cardWrapper: \"k-card-container\",\n\n    // Dropzone\n    dropzoneHint: \"k-dropzone-hint\",\n    dropzoneIcon: \"k-dropzone-icon\",\n    dropzoneInner: \"k-dropzone-inner\",\n    externalDropzone: \"k-external-dropzone\",\n\n    // Header\n    header: \"k-chat-header\",\n\n    // Message structure\n    message: \"k-message\",\n    messageAuthor: \"k-message-author\",\n    messageGroup: \"k-message-group\",\n    messageGroupContent: \"k-message-group-content\",\n    messageGroupFullWidth: \"k-message-group-full-width\",\n    messageGroupReceiver: \"k-message-group-receiver\",\n    messageGroupSender: \"k-message-group-sender\",\n    messageListContent: \"k-message-list-content\",\n    messageRemoved: \"k-message-removed\",\n    messageStatus: \"k-message-status\",\n    messageTime: \"k-message-time\",\n    messageInfo: \"k-message-info\",\n    messageFailed: \"k-message-failed\",\n    messageToolbar: \"k-chat-message-toolbar\",\n    messageRetryButton: \"k-message-retry-button\",\n\n    // Message reference (reply/pin)\n    messagePinned: \"k-message-pinned\",\n    messageReference: \"k-message-reference\",\n    messageReferenceContent: \"k-message-reference-content\",\n    messageReferenceReceiver: \"k-message-reference-receiver\",\n    messageReferenceSender: \"k-message-reference-sender\",\n\n    // Scroll buttons\n    scrollButtonIconLeft: \"chevron-left\",\n    scrollButtonIconRight: \"chevron-right\",\n\n    // Suggestions\n    suggestion: \"k-suggestion\",\n    suggestionGroup: \"k-suggestion-group\",\n    suggestionGroupScrollable: \"k-suggestion-group-scrollable\",\n    suggestionGroupWrap: \"k-suggestion-group-wrap\",\n    suggestionsScroll: \"k-suggestions-scroll\",\n    suggestionScrollWrap: \"k-suggestion-scrollwrap\",\n    suggestionScrollWrapGradient: \"k-suggestion-scrollwrap-gradient\",\n\n    // Timestamp\n    timestamp: \"k-timestamp\",\n\n    // Typing indicator\n    typingIndicator: \"k-typing-indicator\",\n\n    // Wrapper and layout\n    viewWrapper: \"k-message-list\",\n    wrapper: \"k-chat\",\n\n    // Message box\n    messageBox: \"k-message-box\",\n    messageBoxWrapper: \"k-message-box-wrapper\",\n\n    // Spacer\n    spacer: \"k-spacer\",\n\n    // Scroll to bottom FAB\n    scrollFab: \"k-chat-scroll-fab\",\n    fab: \"k-fab\"\n} as const;\n\n/** Data attribute references for element selection */\nexport const REFERENCES = {\n    fileButton: \"ref-chat-file-button\",\n    fileMenuButton: \"ref-chat-file-menu-button\",\n    fileWrapper: \"ref-chat-file-wrapper\",\n    fileCloseButton: \"ref-chat-file-close-button\",\n    bubbleExpandableIndicator: \"ref-chat-bubble-expandable-indicator\",\n    messageReferencePinWrapper: \"ref-chat-message-reference-pin-wrapper\",\n    messageReferenceReplyWrapper: \"ref-chat-message-reference-reply-wrapper\",\n    pinnedMessageCloseButton: \"ref-chat-pinned-message-close-button\",\n    replyMessageCloseButton: \"ref-chat-reply-message-close-button\",\n    leftScrollButton: \"ref-chat-left-scroll-button\",\n    rightScrollButton: \"ref-chat-right-scroll-button\",\n    sendButton: \"ref-chat-message-box-send-button\",\n    speechToTextButton: \"ref-chat-message-box-speech-to-text-button\",\n    suggestionGroup: \"ref-chat-suggestion-group\",\n    fileUploadInput: \"ref-chat-file-upload-input\",\n    viewWrapper: \"ref-chat-view-wrapper\",\n    scrollToBottomButton: \"ref-chat-scroll-to-bottom-button\",\n    retryButton: \"ref-chat-message-retry-button\"\n} as const;\n\n/** Event names triggered by the Chat component */\nexport const EVENTS = {\n    sendMessage: \"sendMessage\",\n    suggestionClick: \"suggestionClick\",\n    unpin: \"unpin\",\n    input: \"input\",\n    toolbarAction: \"toolbarAction\",\n    fileMenuAction: \"fileMenuAction\",\n    contextMenuAction: \"contextMenuAction\",\n    download: \"download\",\n    fileSelect: \"fileSelect\",\n    fileRemove: \"fileRemove\",\n    /** @internal */\n    executeAction: \"executeAction\",\n    /** @internal */\n    resendMessage: \"resendMessage\",\n    suggestedActionClick: \"suggestedActionClick\",\n    messageToolbarExecute: \"messageToolbarExecute\",\n    fileMenuExecute: \"fileMenuExecute\",\n    downloadAllFiles: \"downloadAllFiles\",\n    expandableToggle: \"expandableToggle\",\n    replyMessageCloseButtonClick: \"replyMessageCloseButtonClick\"\n} as const;\n\n/** Common DOM event names */\nexport const CLICK = \"click\";\nexport const INPUT = \"input\";\nexport const KEYDOWN = \"keydown\";\nexport const FOCUS = \"focus\";\nexport const BLUR = \"blur\";\nexport const CHANGE = \"change\";\nexport const SCROLL = \"scroll\";\n\n/** Text direction constants */\nexport const LTR = \"ltr\";\nexport const RTL = \"rtl\";\nexport const K_RTL = \"k-rtl\";\n\n/** CSS selector prefix */\nexport const DOT = \".\";\n\n/** Scrolling delta for suggestion navigation */\nexport const SCROLLING_DELTA = 200;\n\n/** Scroll to bottom threshold in pixels */\nexport const SCROLL_TO_BOTTOM_THRESHOLD = 100;\n\n// Type exports for const objects\nexport type MessageWidthModeValue = typeof MESSAGE_WIDTH_MODE[keyof typeof MESSAGE_WIDTH_MODE];\nexport type MessageStatusValue = typeof MESSAGE_STATUS[keyof typeof MESSAGE_STATUS];\nexport type FilesLayoutModeValue = typeof FILES_LAYOUT_MODE[keyof typeof FILES_LAYOUT_MODE];\nexport type SuggestedActionsLayoutModeValue = typeof SUGGESTED_ACTIONS_LAYOUT_MODE[keyof typeof SUGGESTED_ACTIONS_LAYOUT_MODE];\nexport type IconName = typeof ICONS[keyof typeof ICONS];\nexport type CommandName = typeof COMMANDS[keyof typeof COMMANDS];\nexport type StyleClass = typeof STYLES[keyof typeof STYLES];\nexport type ReferenceAttr = typeof REFERENCES[keyof typeof REFERENCES];\nexport type EventName = typeof EVENTS[keyof typeof EVENTS];","import { IKendoJQueryStatic, IKendoJQuery } from \"../../core\";\nimport type { UtilsService } from \"../../core/services/utils.service\";\nimport { NS, STYLES, REFERENCES, CLICK, FOCUS, BLUR } from \"../constants\";\nimport type { IChatOptions, IChatMessages } from \"../models\";\n\ndeclare const $: IKendoJQueryStatic;\n\nconst NAVIGATION_NS = `${NS}navigation`;\n\n// Module-level state for keyboard navigation\nlet isKeyEvent: boolean | null = null;\nlet isShiftKey = false;\n\nexport interface IChatAccessibilityContext {\n    wrapper: IKendoJQuery;\n    getOptions: () => Partial<IChatOptions>;\n    utilsService: UtilsService;\n}\n\n/**\n * AccesibilityManager handles ARIA attributes and keyboard navigation\n * for the Chat component according to WCAG 2.1 AA compliance.\n *\n * This is an internal collaborator - not a shared service.\n */\nexport class AccesibilityManager {\n    private context: IChatAccessibilityContext;\n\n    /**\n     * Constructs a new AccesibilityManager instance.\n     * @param context - Context with wrapper, options, and services\n     */\n    constructor(context: IChatAccessibilityContext) {\n        this.context = context;\n    }\n\n    /**\n     * Sets up ARIA attributes for the Chat component.\n     */\n    setupAriaAttributes(): void {\n        const options = this.context.getOptions();\n        const messages = options.messages as IChatMessages;\n\n        // Message list\n        const messageList = this.context.wrapper.find(`.${STYLES.viewWrapper}`);\n        if (messageList.length) {\n            messageList\n                .attr(\"role\", \"log\")\n                .attr(\"aria-live\", \"polite\")\n                .attr(\"aria-label\", messages.messageListLabel);\n        }\n\n        this.setupBubbleTabNavigation();\n        this.setupSuggestionAccessibility();\n        this.setupButtonAccessibility(messages);\n        this.setupExpandableIndicators();\n        this.setupScrollButtonsAria();\n        this.setupMessageBoxAria(messages);\n    }\n\n    /**\n     * Sets up tabindex navigation for chat bubbles.\n     */\n    setupBubbleTabNavigation(): void {\n        const allBubbles = this.context.wrapper.find(`.${STYLES.bubble}`);\n\n        const interactableBubbles = allBubbles.filter(function() {\n            return $(this).find(`.${STYLES.typingIndicator}`).length === 0;\n        });\n\n        const typingIndicatorBubbles = allBubbles.filter(function() {\n            return $(this).find(`.${STYLES.typingIndicator}`).length > 0;\n        });\n\n        interactableBubbles.attr(\"tabindex\", \"0\");\n        typingIndicatorBubbles.attr(\"tabindex\", \"-1\");\n\n        // Set up focus/blur/click handlers\n        interactableBubbles\n            .off(`${FOCUS}${NAVIGATION_NS} ${BLUR}${NAVIGATION_NS} ${CLICK}${NAVIGATION_NS}`)\n            .on(`${FOCUS}${NAVIGATION_NS}`, function() {\n                const $this = $(this);\n\n                if (isKeyEvent) {\n                    allBubbles.removeClass(STYLES.selected);\n                }\n\n                allBubbles.removeClass(STYLES.focus);\n\n                if (isKeyEvent) {\n                    $this.addClass(STYLES.selected);\n                }\n\n                $this.addClass(STYLES.focus);\n                isKeyEvent = false;\n            })\n            .on(`${BLUR}${NAVIGATION_NS}`, function() {\n                if (isKeyEvent && !isShiftKey) {\n                    $(this).removeClass(STYLES.selected);\n                }\n                $(this).removeClass(STYLES.focus);\n            })\n            .on(`${CLICK}${NAVIGATION_NS}`, function(e: any) {\n                if ($(e.target).closest(REFERENCES.fileMenuButton)) {\n                    return;\n                }\n                $(this).trigger(FOCUS);\n            });\n    }\n\n    /**\n     * Sets up accessibility for suggestion groups.\n     */\n    private setupSuggestionAccessibility(): void {\n        const suggestionGroups = this.context.wrapper.find(`.${STYLES.suggestionGroup}`);\n        suggestionGroups.each((_index: number, element: HTMLElement) => {\n            const $group = $(element);\n            $group.attr(\"role\", \"group\");\n\n            const suggestions = $group.find(`.${STYLES.suggestion}`);\n            suggestions.each((_suggestionIndex: number, suggestionElement: HTMLElement) => {\n                const $suggestion = $(suggestionElement);\n                $suggestion\n                    .attr(\"role\", \"button\")\n                    .attr(\"tabindex\", \"0\");\n            });\n        });\n    }\n\n    /**\n     * Sets up accessibility for various buttons.\n     */\n    private setupButtonAccessibility(messages: IChatMessages): void {\n        // Suffix buttons\n        const suffixButtons = this.context.wrapper.find(\".k-input-suffix > .k-button\");\n        suffixButtons.each((_index: number, element: HTMLElement) => {\n            const $button = $(element);\n\n            if (!$button.attr(\"role\") && element.nodeName.toLowerCase() !== \"button\") {\n                $button.attr(\"role\", \"button\");\n            }\n\n            if (!$button.attr(\"aria-label\") && !$button.attr(\"title\")) {\n                if ($button.hasClass(STYLES.chatSend)) {\n                    $button.attr(\"aria-label\", messages.actionButton || messages.sendButton);\n                } else if ($button.hasClass(\"k-chat-upload\")) {\n                    $button.attr(\"aria-label\", messages.fileButton);\n                }\n            }\n\n            if ($button.hasClass(STYLES.chatSend) && $button.hasClass(\"k-disabled\")) {\n                $button.attr(\"aria-disabled\", \"true\");\n            }\n        });\n\n        // Download buttons\n        const downloadButtons = this.context.wrapper.find(`.${STYLES.downloadButton}`);\n        downloadButtons.each((_index: number, element: HTMLElement) => {\n            const $button = $(element);\n            if (!$button.attr(\"role\") && element.nodeName.toLowerCase() !== \"button\") {\n                $button.attr(\"role\", \"button\");\n            }\n            if (!$button.attr(\"aria-label\") && !$button.attr(\"title\")) {\n                $button.attr(\"aria-label\", messages.downloadAll);\n            }\n        });\n\n        // Pinned message close button\n        this.setupCloseButtonAria(REFERENCES.pinnedMessageCloseButton, messages.pinnedMessageCloseButton);\n\n        // Reply message close button\n        this.setupCloseButtonAria(REFERENCES.replyMessageCloseButton, messages.replyMessageCloseButton);\n\n        // File menu buttons\n        const fileMenuButtons = this.context.wrapper.find(`[${REFERENCES.fileMenuButton}]`);\n        fileMenuButtons.each((_index: number, element: HTMLElement) => {\n            const $button = $(element);\n            $button.attr(\"aria-label\", messages.fileMenuButton);\n            $button.attr(\"title\", messages.fileMenuButton);\n        });\n    }\n\n    /**\n     * Sets up ARIA attributes for close buttons.\n     */\n    private setupCloseButtonAria(reference: string, label: string): void {\n        const buttons = this.context.wrapper.find(`[${reference}]`);\n        buttons.each((_index: number, element: HTMLElement) => {\n            const $button = $(element);\n            if (!$button.attr(\"role\") && element.nodeName.toLowerCase() !== \"button\") {\n                $button.attr(\"role\", \"button\");\n            }\n            if (!$button.attr(\"aria-label\") && !$button.attr(\"title\")) {\n                $button.attr(\"aria-label\", label);\n                $button.attr(\"title\", label);\n            }\n        });\n    }\n\n    /**\n     * Sets up ARIA attributes for expandable indicators.\n     */\n    private setupExpandableIndicators(): void {\n        const expandableIndicators = this.context.wrapper.find(`.${STYLES.bubbleExpandableIndicator}`);\n        expandableIndicators.each((_index: number, element: HTMLElement) => {\n            const $indicator = $(element);\n            $indicator\n                .attr(\"role\", \"button\")\n                .attr(\"tabindex\", \"0\");\n\n            const bubble = $indicator.closest(`.${STYLES.bubble}`);\n            const isExpanded = bubble.hasClass(STYLES.expanded);\n            const label = isExpanded ? \"Collapse message\" : \"Expand message\";\n            $indicator.attr(\"aria-label\", label);\n        });\n    }\n\n    /**\n     * Sets up ARIA attributes for scroll buttons.\n     */\n    private setupScrollButtonsAria(): void {\n        const dir = this.context.getOptions().dir;\n        const leftScrollButton = this.context.wrapper.find(`[${REFERENCES.leftScrollButton}]`);\n        const rightScrollButton = this.context.wrapper.find(`[${REFERENCES.rightScrollButton}]`);\n\n        const leftText = dir === \"rtl\" ? \"Scroll Right\" : \"Scroll Left\";\n        const rightText = dir === \"rtl\" ? \"Scroll Left\" : \"Scroll Right\";\n\n        leftScrollButton.attr(\"aria-label\", leftText);\n        leftScrollButton.attr(\"title\", leftText);\n\n        rightScrollButton.attr(\"aria-label\", rightText);\n        rightScrollButton.attr(\"title\", rightText);\n    }\n\n    /**\n     * Sets up ARIA attributes for the message box.\n     */\n    private setupMessageBoxAria(messages: IChatMessages): void {\n        const messageBox = this.context.wrapper.find(`.${STYLES.messageBox}`);\n        messageBox.find(\"textarea\").attr(\"aria-label\", messages.messageBoxLabel);\n    }\n\n    /**\n     * Sets up ARIA attributes for file close buttons.\n     */\n    setFileCloseButtonAria(container: IKendoJQuery): void {\n        const fileCloseButton = container.find(`[${REFERENCES.fileCloseButton}]`);\n        fileCloseButton.each((_index: number, element: HTMLElement) => {\n            const $button = $(element);\n            if (!$button.attr(\"role\") && element.nodeName.toLowerCase() !== \"button\") {\n                $button.attr(\"role\", \"button\");\n            }\n            if (!$button.attr(\"aria-label\") && !$button.attr(\"title\")) {\n                $button.attr(\"aria-label\", \"Remove selected file\");\n                $button.attr(\"title\", \"Remove selected file\");\n            }\n        });\n    }\n\n    /**\n     * Updates ARIA attributes for expandable indicators when their state changes.\n     */\n    updateExpandableIndicatorAria(indicator: IKendoJQuery, isExpanded: boolean): void {\n        const label = isExpanded ? \"Collapse message\" : \"Expand message\";\n        indicator.attr(\"aria-label\", label);\n    }\n\n    /**\n     * Handles keyboard navigation for the Chat component.\n     */\n    handleKeyDown(e: KeyboardEvent, messageBox: any): any {\n        if (!$(e.target).closest(this.context.wrapper).length) {\n            return null;\n        }\n\n        const target = $(e.target);\n        const key = e.keyCode || e.which;\n\n        isKeyEvent = true;\n        isShiftKey = e.shiftKey;\n\n        if (target.hasClass(STYLES.bubble)) {\n            this.handleBubbleKeyDown(e, key);\n        }\n\n        if (target.hasClass(STYLES.suggestion)) {\n            this.handleClickableElementKeyDown(e, key);\n        }\n\n        if (target.hasClass(STYLES.bubbleExpandableIndicator)) {\n            this.handleExpandableIndicatorKeyDown(e, key, target);\n        }\n\n        if (target.hasClass(\"k-input-inner\")) {\n            this.handleMessageInputKeyDown(e, key, messageBox);\n        }\n\n        if (target.closest(\".k-input-suffix .k-button\").length) {\n            this.handleClickableElementKeyDown(e, key);\n        }\n\n        return null;\n    }\n\n    /**\n     * Handles keyboard navigation within bubbles.\n     */\n    private handleBubbleKeyDown(e: KeyboardEvent, key: number): void {\n        const currentBubble = $(e.target);\n\n        if (currentBubble.find(`.${STYLES.typingIndicator}`).length > 0) {\n            return;\n        }\n\n        const allBubbles = this.context.wrapper.find(`.${STYLES.bubble}`);\n        const bubbles = allBubbles.filter(function() {\n            return $(this).find(`.${STYLES.typingIndicator}`).length === 0;\n        }) as IKendoJQuery;\n\n        const currentIndex = bubbles.index(currentBubble);\n        const keys = this.context.utilsService.keys;\n\n        switch (key) {\n            case keys.UP:\n                e.preventDefault();\n                this.focusBubbleAtIndex(bubbles, currentIndex - 1);\n                break;\n            case keys.DOWN:\n                e.preventDefault();\n                this.focusBubbleAtIndex(bubbles, currentIndex + 1);\n                break;\n            case keys.HOME:\n                e.preventDefault();\n                this.focusBubbleAtIndex(bubbles, 0);\n                break;\n            case keys.END:\n                e.preventDefault();\n                this.focusBubbleAtIndex(bubbles, bubbles.length - 1);\n                break;\n        }\n    }\n\n    /**\n     * Focuses a bubble at the specified index.\n     */\n    private focusBubbleAtIndex(bubbles: IKendoJQuery, index: number): void {\n        if (bubbles.length === 0 || index < 0 || index >= bubbles.length) {\n            return;\n        }\n\n        const targetBubble = bubbles.eq(index);\n        targetBubble.attr(\"data-keyboard-focus\", \"true\");\n        targetBubble.focus();\n        targetBubble.removeAttr(\"data-keyboard-focus\");\n    }\n\n    /**\n     * Handles keyboard events for expandable indicators.\n     */\n    private handleExpandableIndicatorKeyDown(e: KeyboardEvent, key: number, target: IKendoJQuery): void {\n        const keys = this.context.utilsService.keys;\n\n        if (key === keys.ENTER || key === keys.SPACEBAR) {\n            e.preventDefault();\n            target.trigger(CLICK);\n            const bubble = target.closest(`.${STYLES.bubble}`);\n            const isExpanded = bubble.hasClass(STYLES.expanded);\n            this.updateExpandableIndicatorAria(target, !isExpanded);\n        }\n    }\n\n    /**\n     * Handles keyboard events for the message input.\n     * Note: Enter key handling is delegated to PromptBox component.\n     */\n    private handleMessageInputKeyDown(e: KeyboardEvent, key: number, messageBox: any): void {\n    }\n\n    /**\n     * Handles keyboard events for clickable elements (suggestions, buttons).\n     */\n    private handleClickableElementKeyDown(e: KeyboardEvent, key: number): void {\n        const keys = this.context.utilsService.keys;\n\n        if (key === keys.ENTER || key === keys.SPACEBAR) {\n            e.preventDefault();\n            $(e.target).trigger(CLICK);\n        }\n    }\n}\n","import \"../../kendo.toolbar.js\"; // Still required until kendo.ui is modularized\nimport { IKendoJQueryStatic, IKendoJQuery } from \"../../core/index.js\";\nimport { Widget } from \"../../core/base/widget.js\";\nimport { STYLES, DOT, CLICK } from \"../constants.js\";\n\ndeclare const kendo: any;\ndeclare const $: IKendoJQueryStatic;\n\n/**\n * MessageToolbar provides toolbar functionality for chat messages.\n * Handles quick actions that can be performed on messages through toolbar buttons.\n *\n * This is an internal collaborator that extends Widget for event handling.\n */\nexport class MessageToolbar extends Widget {\n    static options = {\n        name: \"MessageToolbar\"\n    };\n\n    private toolbar: any;\n\n    /**\n     * Constructs a new MessageToolbar instance.\n     */\n    constructor(element: IKendoJQuery, options: any) {\n        super(element, $.extend(true, {}, MessageToolbar.options, options));\n\n        this.extendItemsConfig();\n        this.create();\n        this.attachEvents();\n    }\n\n    /**\n     * Creates the underlying Kendo UI ToolBar.\n     */\n    private create(): void {\n        const existingToolBar = this.element.data(\"kendoToolBar\");\n        if (existingToolBar) {\n            existingToolBar.destroy();\n        }\n\n        const toolbarOptions = $.extend({}, this.options, {\n            fillMode: \"flat\"\n        });\n        delete toolbarOptions.name;\n\n        this.toolbar = new kendo.ui.ToolBar(this.element, toolbarOptions);\n    }\n\n    /**\n     * Extends items configuration with default properties.\n     */\n    private extendItemsConfig(): void {\n        const items = (this.options as any).items;\n        if (items) {\n            items.forEach((item: any) => {\n                item.attributes = item.attributes || {};\n\n                const ariaLabel = item.attributes[\"aria-label\"];\n\n                item.attributes[\"data-command\"] = item.name.toLowerCase();\n                item.attributes[\"aria-label\"] = ariaLabel ?? item.name;\n                item.type = \"button\";\n                item.fillMode = \"flat\";\n                item.overflow = \"never\";\n            });\n        }\n    }\n\n    /**\n     * Attaches event handlers to the toolbar.\n     */\n    private attachEvents(): void {\n        this.toolbar.bind(CLICK, this.onClick.bind(this));\n    }\n\n    /**\n     * Handles toolbar button clicks.\n     */\n    private onClick(e: any): void {\n        const message = e.target.closest(DOT + STYLES.message);\n        const command = e.target.data(\"command\");\n\n        if (command) {\n            this.executeCommand(command, e.target, message);\n        }\n    }\n\n    /**\n     * Executes a command from the toolbar.\n     */\n    private executeCommand(command: string, item: IKendoJQuery, message: IKendoJQuery): void {\n        this.trigger(\"execute\", { type: command, item, message });\n    }\n\n    destroy(): void {\n        if (this.toolbar) {\n            this.toolbar.destroy();\n            this.toolbar = null;\n        }\n\n        this.element.empty();\n    }\n}\n","import \"../../kendo.dropdownbutton.js\"; // Still required until kendo.ui is modularized\nimport { IKendoJQueryStatic, IKendoJQuery } from \"../../core/index.js\";\nimport { Widget } from \"../../core/base/widget.js\";\nimport { ICONS, STYLES, DOT } from \"../constants.js\";\n\ndeclare const kendo: any;\ndeclare const $: IKendoJQueryStatic;\n\n/**\n * FileMenu provides dropdown button functionality for file attachments.\n * Handles actions like download, preview, and delete for individual files.\n *\n * This is an internal collaborator that extends Widget for event handling.\n */\nexport class FileMenu extends Widget {\n    static options = {\n        name: \"ChatFileMenu\",\n        items: [] as any[]\n    };\n\n    private dropdownButton: any;\n\n    /**\n     * Constructs a new FileMenu instance.\n     */\n    constructor(element: IKendoJQuery, options: any) {\n        super(element, $.extend(true, {}, FileMenu.options, options));\n\n        this.setCommandAttributes();\n        this.createDropdownButton();\n    }\n\n    /**\n     * Creates a dropdown button on the element.\n     */\n    private createDropdownButton(): void {\n        this.dropdownButton = new kendo.ui.DropDownButton(this.element, {\n            items: (this.options as any).items,\n            fillMode: \"flat\",\n            icon: ICONS.attachmentMenu\n        });\n\n        this.dropdownButton\n            .bind(\"click\", this.onClick.bind(this))\n            .bind(\"open\", this.onOpen.bind(this))\n            .bind(\"close\", this.onClose.bind(this));\n    }\n\n    /**\n     * Sets command attributes on menu items for identification.\n     */\n    private setCommandAttributes(): void {\n        (this.options as any).items.forEach((item: any) => {\n            item.attributes = item.attributes || {};\n            item.attributes[\"data-command\"] = item.name.toLowerCase();\n            item.id = item.name.toLowerCase();\n        });\n    }\n\n    /**\n     * Handles dropdown button item click.\n     */\n    private onClick(e: any): void {\n        const command = e.id;\n        const file = $(e.sender.element).closest(DOT + STYLES.file);\n        const message = $(e.sender.element).closest(DOT + STYLES.message);\n\n        if (command) {\n            this.executeCommand(command, $(e.sender.element), file, message);\n        }\n    }\n\n    /**\n     * Handles dropdown open event.\n     */\n    private onOpen(e: any): void {\n        let setActive = true;\n        const target = $(e.sender.element);\n\n        if (target.closest(DOT + STYLES.messageRemoved).length || target.find(DOT + STYLES.typingIndicator).length) {\n            e.preventDefault();\n            setActive = false;\n        }\n\n        this.setActive(target, setActive);\n    }\n\n    /**\n     * Handles dropdown close event.\n     */\n    private onClose(e: any): void {\n        const target = $(e.sender.element);\n        const message = target.closest(DOT + STYLES.message);\n        this.setActive(target, false);\n        this.trigger(\"close\", { message });\n    }\n\n    /**\n     * Executes a command from the file menu.\n     */\n    private executeCommand(command: string, item: JQuery, file: JQuery, message: JQuery): void {\n        this.trigger(\"execute\", { type: command, item, file, message });\n    }\n\n    /**\n     * Sets the active state for a target element.\n     */\n    private setActive(target: JQuery, active: boolean): void {\n        const bubble = target.closest(DOT + STYLES.bubble);\n\n        if (active) {\n            bubble.addClass(STYLES.active);\n        } else {\n            bubble.removeClass(STYLES.active);\n        }\n    }\n\n    destroy(): void {\n        if (this.dropdownButton) {\n            this.dropdownButton.destroy();\n            this.dropdownButton = null;\n        }\n\n        super.destroy();\n    }\n}\n","import { \n    IFileUtilsService, \n    FileGroupMap,\n    SaveAsOptions\n} from \"../models/file-utils\";\nimport { ISupportService } from \"../models/support\";\nimport { IInputService } from \"../models/input\";\n\n/**\n * File Utils Service - provides file-related utilities\n \n */\nexport class FileUtilsService implements IFileUtilsService {\n    private _fileGroupMap: FileGroupMap;\n    private fileSaver: HTMLAnchorElement;\n    private downloadAttribute: boolean;\n\n    constructor(\n        private $: JQueryStatic,\n        private support: ISupportService,\n        private inputService: IInputService\n    ) {\n        this._fileGroupMap = this.createFileGroupMap();\n        this.fileSaver = document.createElement(\"a\");\n        this.downloadAttribute = \"download\" in this.fileSaver && !this.support.browser.edge;\n    }\n\n    /**\n     * Create the default file group mapping\n     */\n    private createFileGroupMap(): FileGroupMap {\n        return {\n            audio: [\".aif\", \".iff\", \".m3u\", \".m4a\", \".mid\", \".mp3\", \".mpa\", \".wav\", \".wma\", \".ogg\", \".wav\", \".wma\", \".wpl\"],\n            video: [\".3g2\", \".3gp\", \".avi\", \".asf\", \".flv\", \".m4u\", \".rm\", \".h264\", \".m4v\", \".mkv\", \".mov\", \".mp4\", \".mpg\",\n                    \".rm\", \".swf\", \".vob\", \".wmv\"],\n            image: [\".ai\", \".dds\", \".heic\", \".jpe\", \"jfif\", \".jif\", \".jp2\", \".jps\", \".eps\", \".bmp\", \".gif\", \".jpeg\",\n                    \".jpg\", \".png\", \".ps\", \".psd\", \".svg\", \".svgz\", \".tif\", \".tiff\"],\n            txt: [\".doc\", \".docx\", \".log\", \".pages\", \".tex\", \".wpd\", \".wps\", \".odt\", \".rtf\", \".text\", \".txt\", \".wks\"],\n            presentation: [\".key\", \".odp\", \".pps\", \".ppt\", \".pptx\"],\n            data: [\".xlr\", \".xls\", \".xlsx\"],\n            programming: [\".tmp\", \".bak\", \".msi\", \".cab\", \".cpl\", \".cur\", \".dll\", \".dmp\", \".drv\", \".icns\", \".ico\", \".link\",\n                          \".sys\", \".cfg\", \".ini\", \".asp\", \".aspx\", \".cer\", \".csr\", \".css\", \".dcr\", \".htm\", \".html\", \".js\",\n                          \".php\", \".rss\", \".xhtml\"],\n            pdf: [\".pdf\"],\n            config: [\".apk\", \".app\", \".bat\", \".cgi\", \".com\", \".exe\", \".gadget\", \".jar\", \".wsf\"],\n            zip: [\".7z\", \".cbr\", \".gz\", \".sitx\", \".arj\", \".deb\", \".pkg\", \".rar\", \".rpm\", \".tar.gz\", \".z\", \".zip\", \".zipx\"],\n            \"disc-image\": [\".dmg\", \".iso\", \".toast\", \".vcd\", \".bin\", \".cue\", \".mdf\"]\n        };\n    }\n\n    /**\n     * Get the file group mapping\n     */\n    get fileGroupMap(): FileGroupMap {\n        return this._fileGroupMap;\n    }\n\n    /**\n     * Get file group/type based on extension\n     */\n    getFileGroup(extension: string | undefined, withPrefix?: boolean): string {\n        const fileTypeMap = this._fileGroupMap;\n        const groups = Object.keys(fileTypeMap);\n        const type = \"file\";\n\n        if (extension === undefined || !extension.length) {\n            return type;\n        }\n\n        let normalizedExt = extension.toLowerCase();\n        if (!normalizedExt.startsWith(\".\")) {\n            normalizedExt = \".\" + normalizedExt;\n        }\n\n        for (let i = 0; i < groups.length; i += 1) {\n            const extensions = fileTypeMap[groups[i]];\n\n            if (extensions.indexOf(normalizedExt) > -1) {\n               return withPrefix ? \"file-\" + groups[i] : groups[i];\n            }\n        }\n\n        return type;\n    }\n\n    /**\n     * Get human-readable file size message\n     */\n    getFileSizeMessage(size: number): string {\n        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n\n        if (size === 0) {\n            return '0 Byte';\n        }\n\n        const i = parseInt(String(Math.floor(Math.log(size) / Math.log(1024))), 10);\n        return Math.round(size / Math.pow(1024, i)) + ' ' + sizes[i];\n    }\n\n    /**\n     * Post data to a proxy URL\n     */\n    private postToProxy(dataURI: string, fileName: string, proxyURL: string, proxyTarget?: string): void {\n        const $ = this.$;\n        const form = $(\"<form>\").attr({\n            action: proxyURL,\n            method: \"POST\",\n            target: proxyTarget\n        });\n\n        const data: Record<string, string> = this.inputService.antiForgeryTokens();\n        data.fileName = fileName;\n\n        const parts = dataURI.split(\";base64,\");\n        data.contentType = parts[0].replace(\"data:\", \"\");\n        data.base64 = parts[1];\n\n        for (const name in data) {\n            if (Object.prototype.hasOwnProperty.call(data, name)) {\n                $('<input>').attr({\n                    value: data[name],\n                    name: name,\n                    type: \"hidden\"\n                }).appendTo(form);\n            }\n        }\n\n        form.appendTo(\"body\").submit().remove();\n    }\n\n    /**\n     * Save using msSaveBlob (IE)\n     */\n    private saveAsBlob(dataURI: string | Blob, fileName: string): void {\n        let blob: Blob = dataURI as Blob; // could be a Blob object\n\n        if (typeof dataURI === \"string\") {\n            const parts = dataURI.split(\";base64,\");\n            const contentType = parts[0];\n            const base64 = atob(parts[1]);\n            const array = new Uint8Array(base64.length);\n\n            for (let idx = 0; idx < base64.length; idx++) {\n                array[idx] = base64.charCodeAt(idx);\n            }\n            blob = new Blob([array.buffer], { type: contentType });\n        }\n\n        (navigator as any).msSaveBlob(blob, fileName);\n    }\n\n    /**\n     * Save using data URI and download attribute\n     */\n    private saveAsDataURI(dataURI: string | Blob, fileName: string): void {\n        let uri: string = dataURI as string;\n\n        if (window.Blob && dataURI instanceof Blob) {\n            uri = URL.createObjectURL(dataURI);\n        }\n\n        this.fileSaver.download = fileName;\n        this.fileSaver.href = uri;\n\n        const e = document.createEvent(\"MouseEvents\");\n        e.initMouseEvent(\"click\", true, false, window,\n            0, 0, 0, 0, 0, false, false, false, false, 0, null);\n\n        this.fileSaver.dispatchEvent(e);\n        setTimeout(function() {\n            URL.revokeObjectURL(uri);\n        });\n    }\n\n    /**\n     * Save data as a file download\n     */\n    saveAs(options: SaveAsOptions): void {\n        type SaveFn = (dataURI: string | Blob, fileName: string, proxyURL?: string, proxyTarget?: string) => void;\n        let save: SaveFn = this.postToProxy.bind(this);\n\n        if (!options.forceProxy) {\n            if (this.downloadAttribute) {\n                save = this.saveAsDataURI.bind(this);\n            } else if ((navigator as any).msSaveBlob) {\n                save = this.saveAsBlob.bind(this);\n            }\n        }\n\n        save(options.dataURI, options.fileName, options.proxyURL, options.proxyTarget);\n    }\n}\n","import \"../../kendo.button.js\"; // Still required until kendo.ui is modularized\nimport \"../../kendo.avatar.js\";\nimport \"../../kendo.icons.js\";\nimport { inject } from \"../../core/service-container\";\nimport { HtmlService } from \"../../core/services/html.service\";\nimport { FileUtilsService } from \"../../core/services/file-utils.service\";\nimport { STYLES, REFERENCES, ICONS } from \"../constants\";\nimport type { IFile } from \"../../upload\";\n\ndeclare const kendo: any;\n\n/**\n * Renders an avatar element for a message author.\n */\nexport const renderAvatar = (\n    url: string,\n    altText?: string,\n    htmlService = inject(HtmlService)\n): string => {\n    return new kendo.ui.Avatar(\"<div>\", {\n        type: \"image\",\n        image: url,\n        alt: htmlService.encode(altText ?? \"\")\n    }).wrapper[0].outerHTML;\n};\n\n/**\n * Renders a typing indicator animation.\n */\nexport const renderTypingIndicator = (): string => {\n    return `<div class=\"${STYLES.typingIndicator}\">\n        <span></span>\n        <span></span>\n        <span></span>\n    </div>`;\n};\n\n/**\n * Renders a single file attachment item.\n * Uses small-sized buttons for menu/download actions per Chat v3 spec.\n */\nexport const renderFile = (\n    file: IFile,\n    closeButton: boolean,\n    fileMenuButton = true,\n    htmlService = inject(HtmlService),\n    fileUtilsService = inject(FileUtilsService)\n): string => {\n    const closeButtonHtml = closeButton\n        ? new kendo.ui.Button(`<button class=\"\" ${REFERENCES.fileCloseButton}>`, {\n            icon: ICONS.x,\n            fillMode: \"flat\",\n            size: \"small\"\n        }).wrapper[0].outerHTML\n        : \"\";\n\n    // Use small size for file menu button\n    const fileMenuButtonHtml = fileMenuButton && !closeButton\n        ? new kendo.ui.Button(`<button class=\"${STYLES.menuButton}\" ${REFERENCES.fileMenuButton}>`, {\n            icon: ICONS.attachmentMenu,\n            fillMode: \"flat\",\n            size: \"small\"\n        }).wrapper[0].outerHTML\n        : \"\";\n\n    return `<li class=\"${STYLES.file}\" data-uid=\"${htmlService.encode(file.uid)}\">\n        ${kendo.ui.icon({ icon: fileUtilsService.getFileGroup(file.extension, true), size: \"xlarge\" })}\n        <div class=\"${STYLES.fileInfo}\">\n            <span class=\"${STYLES.fileName}\">${htmlService.encode(file.name)}</span>\n            <span class=\"${STYLES.fileSize}\">${htmlService.encode(fileUtilsService.getFileSizeMessage(file.size))}</span>\n        </div>\n        ${closeButtonHtml}\n        ${fileMenuButtonHtml}\n    </li>`;\n};\n","import \"../../kendo.button.js\"; // Still required until kendo.ui is modularized\nimport \"../../kendo.icons.js\";\nimport { inject } from \"../../core/service-container\";\nimport { HtmlService } from \"../../core/services/html.service\";\nimport { STYLES, REFERENCES, ICONS, FILES_LAYOUT_MODE } from \"../constants\";\nimport type { IChatMessages, FilesLayoutMode } from \"../models\";\nimport type { IFile } from \"../../upload\";\nimport { renderFile } from \"./common.template\";\n\ndeclare const kendo: any;\n\n/**\n * Renders a list of file attachments with layout mode support.\n * Uses small-sized buttons per Chat v3 spec.\n */\nexport const renderFiles = (\n    files: IFile[] | undefined,\n    downloadAll: boolean,\n    messages: IChatMessages,\n    closeButton?: boolean,\n    layoutMode: FilesLayoutMode = FILES_LAYOUT_MODE.VERTICAL\n): string => {\n    if (!files?.length) {\n        return \"\";\n    }\n\n    let fileItems = \"\";\n    files.forEach(file => {\n        fileItems += renderFile(file, closeButton ?? false, true);\n    });\n\n    let layoutClass = \"\";\n    if (layoutMode === FILES_LAYOUT_MODE.VERTICAL) {\n        layoutClass = ` ${STYLES.filesVertical}`;\n    } else if (layoutMode === FILES_LAYOUT_MODE.WRAP) {\n        layoutClass = ` ${STYLES.filesWrap}`;\n    }\n\n    let html = `<ul class=\"${STYLES.fileWrapper}${layoutClass}\" ${REFERENCES.fileWrapper}>`;\n\n    if (layoutMode === FILES_LAYOUT_MODE.HORIZONTAL) {\n        html += `<div class=\"${STYLES.filesScroll}\">${fileItems}</div>`;\n    } else {\n        html += fileItems;\n    }\n\n    html += \"</ul>\";\n\n    if (downloadAll && files.length > 1 && messages?.downloadAll) {\n        html += `<div class=\"${STYLES.downloadButtonWrapper}\">\n            ${new kendo.ui.Button(`<button class=\"${STYLES.downloadButton}\">${messages.downloadAll}</button>`, {\n                icon: ICONS.download,\n                fillMode: \"flat\",\n                size: \"small\"\n            }).wrapper[0].outerHTML}\n        </div>`;\n    }\n\n    return html;\n};\n\n/**\n * Renders a list of file attachments with the specified layout mode.\n * Uses small-sized buttons per Chat v3 spec.\n * @param files - Array of files to render\n * @param downloadAll - Whether to show a \"download all\" button\n * @param messages - Localization messages\n * @param closeButton - Whether to show close buttons on files\n * @param layoutMode - Layout mode: \"horizontal\" | \"vertical\" | \"wrap\"\n */\nexport const renderFilesWithLayout = (\n    files: IFile[] | undefined,\n    downloadAll: boolean,\n    messages: IChatMessages,\n    closeButton?: boolean,\n    layoutMode: FilesLayoutMode = FILES_LAYOUT_MODE.HORIZONTAL\n): string => {\n    if (!files?.length) {\n        return \"\";\n    }\n\n    let fileItems = \"\";\n    files.forEach(file => {\n        fileItems += renderFile(file, closeButton ?? false, true);\n    });\n\n    let layoutClass = \"\";\n    if (layoutMode === FILES_LAYOUT_MODE.VERTICAL) {\n        layoutClass = ` ${STYLES.filesVertical}`;\n    } else if (layoutMode === FILES_LAYOUT_MODE.WRAP) {\n        layoutClass = ` ${STYLES.filesWrap}`;\n    }\n\n    let html = `<ul class=\"${STYLES.fileWrapper}${layoutClass}\" ${REFERENCES.fileWrapper}>`;\n\n    if (layoutMode === FILES_LAYOUT_MODE.HORIZONTAL) {\n        html += `<div class=\"${STYLES.filesScroll}\">${fileItems}</div>`;\n    } else {\n        html += fileItems;\n    }\n\n    html += \"</ul>\";\n\n    if (downloadAll && files.length > 1) {\n        html += `<div class=\"${STYLES.downloadButtonWrapper}\">\n            ${new kendo.ui.Button(`<button class=\"${STYLES.downloadButton}\">${messages.downloadAll}</button>`, {\n                icon: ICONS.download,\n                fillMode: \"flat\",\n                size: \"small\"\n            }).wrapper[0].outerHTML}\n        </div>`;\n    }\n\n    return html;\n};\n\n/**\n * Renders a message reference (for reply or pinned messages).\n */\nexport const renderMessageReference = (\n    context: {\n        text?: string;\n        files?: IFile[];\n        isOwnMessage?: boolean;\n        isPinMessage?: boolean;\n        isDeleted?: boolean;\n        renderCloseButton?: boolean;\n        renderFileMenuButton?: boolean;\n        messages?: IChatMessages;\n    },\n    htmlService = inject(HtmlService)\n): string => {\n    const {\n        text,\n        files,\n        isOwnMessage,\n        isPinMessage,\n        isDeleted,\n        renderCloseButton,\n        renderFileMenuButton,\n        messages\n    } = context;\n\n    const messageReferenceSenderStyle = isOwnMessage\n        ? STYLES.messageReferenceSender\n        : STYLES.messageReferenceReceiver;\n    const pinMessageReferenceStyle = isPinMessage ? STYLES.messagePinned : \"\";\n    const closeButtonReference = isPinMessage\n        ? REFERENCES.pinnedMessageCloseButton\n        : REFERENCES.replyMessageCloseButton;\n    const wrapperReference = isPinMessage\n        ? REFERENCES.messageReferencePinWrapper\n        : REFERENCES.messageReferenceReplyWrapper;\n\n    let content = htmlService.convertTextUrlToLink(text || \"\");\n\n    if (!content) {\n        content = files?.length ? renderFile(files[0], false, renderFileMenuButton ?? false) : \"\";\n    }\n\n    if (isDeleted && messages) {\n        content = isOwnMessage\n            ? htmlService.encode(messages.selfMessageDeleted)\n            : htmlService.encode(messages.otherMessageDeleted);\n    }\n\n    return `<div class=\"${STYLES.messageReference} ${messageReferenceSenderStyle} ${pinMessageReferenceStyle}\" ${wrapperReference}>\n        ${isPinMessage ? kendo.ui.icon({ icon: ICONS.pin, size: \"xlarge\" }) : \"\"}\n        <div class=\"${STYLES.messageReferenceContent}\">${content}</div>\n        <span class=\"${STYLES.spacer}\"></span>\n        ${renderCloseButton ? new kendo.ui.Button(`<button ${closeButtonReference}>`, {\n            icon: ICONS.x,\n            fillMode: \"flat\"\n        }).wrapper[0].outerHTML : \"\"}\n    </div>`;\n};\n","import { Culture, ICultureService } from \"../models/culture\";\nimport { INumberFormatter } from \"../models/formatter\";\n\nconst DOT = \".\";\nconst COMMA = \",\";\nconst SHARP = \"#\";\nconst ZERO = \"0\";\nconst PLACEHOLDER = \"??\";\nconst EMPTY = \"\";\n\nconst STANDARD_FORMAT_REGEX = /^(n|c|p|e)(\\d*)$/i;\nconst LITERAL_REGEX = /(\\\\.)|(googol)|(['][^']*[']?)|([\"][^\"]*[\"]?)/g;\nconst COMMA_REGEX = /\\,/g;\n\n/**\n * Represents a number format that can be the main format or a sub-format (currency/percent)\n */\ninterface NumberFormatInfo {\n    pattern: string[];\n    decimals: number;\n    \",\": string;\n    \".\": string;\n    groupSize: number[];\n    symbol?: string;\n    percent?: NumberFormatInfo;\n    currency?: NumberFormatInfo;\n}\n\nexport class NumberFormatterService implements INumberFormatter {\n    constructor(private cultureService: ICultureService) {}\n\n    format(number: number, format: string, culture?: string | Culture): string {\n        const resolvedCulture = culture \n            ? this.cultureService.getCulture(culture) \n            : this.cultureService.culture();\n\n        let numberFormat: NumberFormatInfo = resolvedCulture.numberFormat as NumberFormatInfo;\n        let decimal = numberFormat[DOT];\n        let precision = numberFormat.decimals;\n        let pattern = numberFormat.pattern[0];\n        const literals: string[] = [];\n        let symbol: string | undefined;\n        let isCurrency: boolean;\n        let isPercent: boolean;\n        let customPrecision: string;\n        let formatAndPrecision: RegExpExecArray | null;\n        let negative = number < 0;\n        let integer: string;\n        let fraction: string;\n        let integerLength: number;\n        let value: string = EMPTY;\n        let length: number;\n        let hasGroup: boolean;\n        let hasNegativeFormat: boolean;\n        let decimalIndex: number;\n        let zeroIndex: number;\n        let start = -1;\n        let end: number;\n\n        // Return empty string if no number\n        if (number === undefined) {\n            return EMPTY;\n        }\n\n        if (!isFinite(number)) {\n            return String(number);\n        }\n\n        // If no format then return number.toString() or number.toLocaleString() if culture.name is not defined\n        if (!format) {\n            return resolvedCulture.name.length ? number.toLocaleString() : number.toString();\n        }\n\n        formatAndPrecision = STANDARD_FORMAT_REGEX.exec(format);\n\n        // Standard formatting\n        if (formatAndPrecision) {\n            format = formatAndPrecision[1].toLowerCase();\n\n            isCurrency = format === \"c\";\n            isPercent = format === \"p\";\n\n            if (isCurrency || isPercent) {\n                // Get specific number format information if format is currency or percent\n                numberFormat = isCurrency ? numberFormat.currency : numberFormat.percent;\n                decimal = numberFormat[DOT];\n                precision = numberFormat.decimals;\n                symbol = numberFormat.symbol;\n                pattern = numberFormat.pattern[negative ? 0 : 1];\n            }\n\n            customPrecision = formatAndPrecision[2];\n\n            if (customPrecision) {\n                precision = +customPrecision;\n            }\n\n            // Return number in exponential format\n            if (format === \"e\") {\n                const exp = customPrecision ? number.toExponential(precision) : number.toExponential();\n                return exp.replace(DOT, numberFormat[DOT]);\n            }\n\n            // Multiply if format is percent\n            if (isPercent) {\n                number *= 100;\n            }\n\n            const rounded = this.round(number, precision);\n            negative = parseFloat(rounded) < 0;\n            const parts = rounded.split(DOT);\n\n            integer = parts[0];\n            fraction = parts[1];\n\n            // Exclude \"-\" if number is negative\n            if (negative) {\n                integer = integer.substring(1);\n            }\n\n            value = this.groupInteger(integer, 0, integer.length, numberFormat);\n\n            if (fraction) {\n                value += decimal + fraction;\n            }\n\n            if (format === \"n\" && !negative) {\n                return value;\n            }\n\n            let result = EMPTY;\n\n            for (let idx = 0, len = pattern.length; idx < len; idx++) {\n                const ch = pattern.charAt(idx);\n\n                if (ch === \"n\") {\n                    result += value;\n                } else if (ch === \"$\" || ch === \"%\") {\n                    result += symbol;\n                } else {\n                    result += ch;\n                }\n            }\n\n            return result;\n        }\n\n        // Custom formatting\n        // Separate format by sections\n        format = this.extractLiterals(format, literals);\n\n        const formatSections = format.split(\";\");\n        const formatSectionResult = this.selectFormatSection(formatSections, negative, number);\n        format = formatSectionResult.format;\n        hasNegativeFormat = formatSectionResult.hasNegativeFormat;\n        \n        if (formatSectionResult.isZeroFormat) {\n            return format;\n        }\n\n        let percentIndex = format.indexOf(\"%\");\n        let currencyIndex = format.indexOf(\"$\");\n\n        isPercent = percentIndex !== -1;\n        isCurrency = currencyIndex !== -1;\n\n        // Multiply number if the format has percent\n        if (isPercent) {\n            number *= 100;\n        }\n\n        if (isCurrency && format[currencyIndex - 1] === \"\\\\\") {\n            format = format.split(\"\\\\\").join(\"\");\n            isCurrency = false;\n        }\n\n        if (isCurrency || isPercent) {\n            // Get specific number format information if format is currency or percent\n            numberFormat = isCurrency ? numberFormat.currency : numberFormat.percent;\n            decimal = numberFormat[DOT];\n            precision = numberFormat.decimals;\n            symbol = numberFormat.symbol;\n        }\n\n        hasGroup = format.indexOf(COMMA) > -1;\n        if (hasGroup) {\n            format = format.replace(COMMA_REGEX, EMPTY);\n        }\n\n        const decimalResult = this.calculateDecimalPrecision(format, number, negative);\n        format = decimalResult.format;\n        decimalIndex = decimalResult.decimalIndex;\n        length = decimalResult.length;\n        const roundedNumber = decimalResult.number;\n\n        const positionResult = this.findPlaceholderPositions(format);\n        start = positionResult.start;\n        end = positionResult.end;\n        zeroIndex = positionResult.zeroIndex;\n\n        if (start === length) {\n            end = start;\n        }\n\n        if (start !== -1) {\n            const valueParts = roundedNumber.toString().split(DOT);\n            integer = valueParts[0];\n            fraction = valueParts[1] || EMPTY;\n\n            integerLength = integer.length;\n\n            if (negative && (parseFloat(roundedNumber) * -1) >= 0) {\n                negative = false;\n            }\n\n            let result = this.applyPatternToNumber(\n                format, start, end, length, negative, hasNegativeFormat, \n                decimalIndex, integer, fraction, decimal, zeroIndex\n            );\n\n            if (hasGroup) {\n                result = this.groupInteger(\n                    result, \n                    start + (negative && !hasNegativeFormat ? 1 : 0), \n                    Math.max(end, (integerLength + start)), \n                    numberFormat\n                );\n            }\n\n            if (end >= start) {\n                result += format.substring(end + 1);\n            }\n\n            if (isCurrency || isPercent) {\n                result = this.replaceSymbols(result, symbol!);\n            }\n\n            if (literals.length) {\n                result = this.replaceLiterals(result, literals);\n            }\n\n            return result;\n        }\n\n        return String(roundedNumber);\n    }\n\n    private replaceSymbols(number: string, symbol: string): string {\n        let value = EMPTY;\n        for (let idx = 0, len = number.length; idx < len; idx++) {\n            const ch = number.charAt(idx);\n            value += (ch === \"$\" || ch === \"%\") ? symbol : ch;\n        }\n        return value;\n    }\n\n    private replaceLiterals(number: string, literals: string[]): string {\n        for (let idx = 0; idx < literals.length; idx++) {\n            number = number.replace(PLACEHOLDER, literals[idx]);\n        }\n        return number;\n    }\n\n    private applyPatternToNumber(\n        format: string, start: number, end: number, length: number, \n        negative: boolean, hasNegativeFormat: boolean, decimalIndex: number, \n        integer: string, fraction: string, decimal: string, zeroIndex: number\n    ): string {\n        let number = format.substring(0, start);\n        let replacement = EMPTY;\n        const integerLength = integer.length;\n\n        if (negative && !hasNegativeFormat) {\n            number += \"-\";\n        }\n\n        let idx = start;\n        while (idx < length) {\n            const ch = format.charAt(idx);\n\n            if (decimalIndex === -1) {\n                if (end - idx < integerLength) {\n                    number += integer;\n                    break;\n                }\n            } else {\n                if (zeroIndex !== -1 && zeroIndex < idx) {\n                    replacement = EMPTY;\n                }\n\n                if ((decimalIndex - idx) <= integerLength && decimalIndex - idx > -1) {\n                    number += integer;\n                    idx = decimalIndex;\n                }\n\n                if (decimalIndex === idx) {\n                    number += (fraction ? decimal : EMPTY) + fraction;\n                    idx += end - decimalIndex + 1;\n                    continue;\n                }\n            }\n\n            if (ch === ZERO) {\n                number += ch;\n                replacement = ch;\n            } else if (ch === SHARP) {\n                number += replacement;\n            }\n            idx++;\n        }\n\n        return number;\n    }\n\n    private selectFormatSection(\n        formatSections: string[], negative: boolean, number: number\n    ): { format: string; hasNegativeFormat: boolean; isZeroFormat: boolean } {\n        let format: string;\n        let hasNegativeFormat = false;\n        let isZeroFormat = false;\n\n        if (negative && formatSections[1]) {\n            format = formatSections[1];\n            hasNegativeFormat = true;\n        } else if (number === 0 && formatSections[2]) {\n            format = formatSections[2];\n            if (format.indexOf(SHARP) === -1 && format.indexOf(ZERO) === -1) {\n                isZeroFormat = true;\n            }\n        } else {\n            format = formatSections[0];\n        }\n\n        return { format, hasNegativeFormat, isZeroFormat };\n    }\n\n    private calculateDecimalPrecision(\n        format: string, number: number, negative: boolean\n    ): { format: string; decimalIndex: number; length: number; number: string } {\n        let decimalIndex = format.indexOf(DOT);\n        let idx = 0;\n        let length = format.length;\n        let fraction: string;\n        let zeroIndex: number;\n        let sharpIndex: number;\n        let hasZero: boolean;\n        let hasSharp: boolean;\n        let rounded: string;\n\n        if (decimalIndex !== -1) {\n            const expParts = number.toString().split(\"e\");\n            if (expParts[1]) {\n                fraction = this.round(number, Math.abs(parseInt(expParts[1], 10)));\n            } else {\n                fraction = expParts[0];\n            }\n            fraction = fraction.split(DOT)[1] || EMPTY;\n            zeroIndex = format.lastIndexOf(ZERO) - decimalIndex;\n            sharpIndex = format.lastIndexOf(SHARP) - decimalIndex;\n            hasZero = zeroIndex > -1;\n            hasSharp = sharpIndex > -1;\n            idx = fraction.length;\n\n            if (!hasZero && !hasSharp) {\n                format = format.substring(0, decimalIndex) + format.substring(decimalIndex + 1);\n                length = format.length;\n                decimalIndex = -1;\n                idx = 0;\n            }\n\n            if (hasZero && zeroIndex > sharpIndex) {\n                idx = zeroIndex;\n            } else if (sharpIndex > zeroIndex) {\n                if (hasSharp && idx > sharpIndex) {\n                    rounded = this.round(number, sharpIndex, negative);\n\n                    while (rounded.charAt(rounded.length - 1) === ZERO && sharpIndex > 0 && sharpIndex > zeroIndex) {\n                        sharpIndex--;\n                        rounded = this.round(number, sharpIndex, negative);\n                    }\n\n                    idx = sharpIndex;\n                } else if (hasZero && idx < zeroIndex) {\n                    idx = zeroIndex;\n                }\n            }\n        }\n\n        const resultNumber = this.round(number, idx, negative);\n\n        return { format, decimalIndex, length, number: resultNumber };\n    }\n\n    private findPlaceholderPositions(format: string): { start: number; end: number; zeroIndex: number } {\n        let sharpIndex = format.indexOf(SHARP);\n        const startZeroIndex = format.indexOf(ZERO);\n        let start: number;\n        let end: number;\n        let zeroIndex: number;\n\n        if (sharpIndex === -1 && startZeroIndex !== -1) {\n            start = startZeroIndex;\n        } else if (sharpIndex !== -1 && startZeroIndex === -1) {\n            start = sharpIndex;\n        } else {\n            start = sharpIndex > startZeroIndex ? startZeroIndex : sharpIndex;\n        }\n\n        sharpIndex = format.lastIndexOf(SHARP);\n        zeroIndex = format.lastIndexOf(ZERO);\n\n        if (sharpIndex === -1 && zeroIndex !== -1) {\n            end = zeroIndex;\n        } else if (sharpIndex !== -1 && zeroIndex === -1) {\n            end = sharpIndex;\n        } else {\n            end = sharpIndex > zeroIndex ? sharpIndex : zeroIndex;\n        }\n\n        return { start, end, zeroIndex };\n    }\n\n    private extractLiterals(format: string, literals: string[]): string {\n        if (format.indexOf(\"'\") > -1 || format.indexOf('\"') > -1 || format.indexOf(\"\\\\\") > -1) {\n            format = format.replace(LITERAL_REGEX, (match) => {\n                const quoteChar = match.charAt(0).replace(\"\\\\\", \"\");\n                const literal = match.slice(1).replace(quoteChar, \"\");\n                literals.push(literal);\n                return PLACEHOLDER;\n            });\n        }\n        return format;\n    }\n\n    private groupInteger(number: string, start: number, end: number, numberFormat: NumberFormatInfo): string {\n        const decimalIndex = number.indexOf(numberFormat[DOT]);\n        const groupSizes = numberFormat.groupSize.slice();\n        let groupSize = groupSizes.shift()!;\n        let integer: string;\n        let integerLength: number;\n        let idx: number;\n        let parts: string[];\n        let value: string;\n        let newGroupSize: number | undefined;\n\n        end = decimalIndex !== -1 ? decimalIndex : end + 1;\n\n        integer = number.substring(start, end);\n        integerLength = integer.length;\n\n        if (integerLength >= groupSize) {\n            idx = integerLength;\n            parts = [];\n\n            while (idx > -1) {\n                value = integer.substring(idx - groupSize, idx);\n                if (value) {\n                    parts.push(value);\n                }\n                idx -= groupSize;\n                newGroupSize = groupSizes.shift();\n                groupSize = newGroupSize !== undefined ? newGroupSize : groupSize;\n\n                if (groupSize === 0) {\n                    if (idx > 0) {\n                        parts.push(integer.substring(0, idx));\n                    }\n                    break;\n                }\n            }\n\n            integer = parts.reverse().join(numberFormat[COMMA]);\n            number = number.substring(0, start) + integer + number.substring(end);\n        }\n\n        return number;\n    }\n\n    /**\n     * Round a number to specified precision\n     */\n    round(value: number, precision: number, negative?: boolean): string {\n        return NumberFormatterService.round(value, precision, negative);\n    }\n\n    /**\n     * Static method for rounding numbers (used externally by other components)\n     */\n    static round(value: number, precision: number, negative?: boolean): string {\n        precision = precision || 0;\n\n        let parts = value.toString().split('e');\n        let rounded = Math.round(+(parts[0] + 'e' + (parts[1] ? (+parts[1] + precision) : precision)));\n\n        if (negative) {\n            rounded = -rounded;\n        }\n\n        parts = rounded.toString().split('e');\n        const result = +(parts[0] + 'e' + (parts[1] ? (+parts[1] - precision) : -precision));\n\n        return result.toFixed(Math.min(precision, 20));\n    }\n}\n","import { Culture } from \"../models/culture\";\nimport { IFormatterService, INumberFormatter, IDateFormatter, ToStringResult } from \"../models/formatter\";\nimport { NumberFormatterService } from \"./number-formatter.service\";\n\nconst DATE_OBJECT = \"[object Date]\";\nconst FORMAT_REGEX = /\\{(\\d+)(:[^\\}]+)?\\}/g;\nconst objectToString = {}.toString;\n\nexport class FormatterService implements IFormatterService {\n    constructor(\n        private numberFormatter: INumberFormatter,\n        private dateFormatter: IDateFormatter\n    ) {}\n\n    /**\n     * Format a value to string, or return it as-is if no format specified.\n     * The loose return type matches original kendo.toString behavior where\n     * unformatted values pass through (e.g., null stays null for jQuery .val())\n     */\n    toString(value: Date | number | null | undefined, format?: string, culture?: string | Culture): ToStringResult {\n        if (format) {\n            if (objectToString.call(value) === DATE_OBJECT) {\n                return this.dateFormatter.format(value as Date, format, culture);\n            } else if (typeof value === \"number\") {\n                return this.numberFormatter.format(value, format, culture);\n            }\n        }\n\n        // Match original behavior: return value as-is (not String(value))\n        // This allows jQuery .val(null) to work correctly (clears input)\n        return value !== undefined ? value : \"\";\n    }\n\n    format(fmt: string, ...values: unknown[]): string {\n        return fmt.replace(FORMAT_REGEX, (_, index, placeholderFormat) => {\n            const value = values[parseInt(index, 10)];\n            const result = this.toString(\n                value as Date | number | undefined, \n                placeholderFormat ? placeholderFormat.substring(1) : \"\"\n            );\n            // Let JS coerce to string (null becomes \"null\", undefined becomes \"undefined\")\n            // This matches original behavior where String.replace does implicit coercion\n            return String(result);\n        });\n    }\n\n    extractFormat(format: string): string {\n        if (format.slice(0, 3) === \"{0:\") {\n            format = format.slice(3, format.length - 1);\n        }\n        return format;\n    }\n\n    /**\n     * Get the number formatter instance (for direct access)\n     */\n    getNumberFormatter(): INumberFormatter {\n        return this.numberFormatter;\n    }\n\n    /**\n     * Get the date formatter instance (for direct access)\n     */\n    getDateFormatter(): IDateFormatter {\n        return this.dateFormatter;\n    }\n\n    /**\n     * Static round method exposed for external use (matches kendo._round)\n     */\n    static round(value: number, precision: number, negative?: boolean): string {\n        return NumberFormatterService.round(value, precision, negative);\n    }\n}\n","/**\n * Date utility type definitions\n */\n\n/**\n * Date field mapping for format parsing\n */\nexport const DATE_FIELD_MAP: Record<string, string> = {\n    \"G\": \"era\",\n    \"y\": \"year\",\n    \"q\": \"quarter\",\n    \"Q\": \"quarter\",\n    \"M\": \"month\",\n    \"L\": \"month\",\n    \"d\": \"day\",\n    \"E\": \"weekday\",\n    \"c\": \"weekday\",\n    \"e\": \"weekday\",\n    \"h\": \"hour\",\n    \"H\": \"hour\",\n    \"k\": \"hour\",\n    \"K\": \"hour\",\n    \"m\": \"minute\",\n    \"s\": \"second\",\n    \"a\": \"dayperiod\",\n    \"t\": \"dayperiod\",\n    \"x\": \"zone\",\n    \"X\": \"zone\",\n    \"z\": \"zone\",\n    \"Z\": \"zone\"\n};\n\n/**\n * Name type configuration for date parts\n */\nexport interface NameTypeConfig {\n    type: string;\n    minLength: number | Record<string, number>;\n    standAlone?: string;\n}\n\n/**\n * Name types for date formatting\n */\nexport const NAME_TYPES: Record<string, NameTypeConfig> = {\n    month: {\n        type: \"months\",\n        minLength: 3,\n        standAlone: \"L\"\n    },\n    quarter: {\n        type: \"quarters\",\n        minLength: 3,\n        standAlone: \"q\"\n    },\n    weekday: {\n        type: \"days\",\n        minLength: {\n            E: 0,\n            c: 3,\n            e: 3\n        },\n        standAlone: \"c\"\n    },\n    dayperiod: {\n        type: \"dayPeriods\",\n        minLength: 0\n    },\n    era: {\n        type: \"eras\",\n        minLength: 0\n    }\n};\n\n/**\n * Date format part structure\n */\nexport interface DateFormatPart {\n    type: string;\n    pattern: string;\n    hour12?: boolean;\n    names?: {\n        type: string;\n        nameType: string;\n        standAlone: boolean;\n    };\n}\n\n/**\n * Options for date format names\n */\nexport interface DateFormatNamesOptions {\n    type: string;\n    nameType: string;\n}\n\n/**\n * Options for date field name\n */\nexport interface DateFieldNameOptions {\n    type: string;\n    nameType: string;\n}\n\n/**\n * Interface for date utility service\n */\nexport interface IDateUtilsService {\n    /** Milliseconds per minute constant */\n    readonly MS_PER_MINUTE: number;\n    /** Milliseconds per hour constant */\n    readonly MS_PER_HOUR: number;\n    /** Milliseconds per day constant */\n    readonly MS_PER_DAY: number;\n\n    /**\n     * Adjust date for DST changes\n     */\n    adjustDST(date: Date, hours: number): boolean;\n\n    /**\n     * Set the day of week on a date (mutates the date)\n     */\n    setDayOfWeek(date: Date, day: number, dir?: number): void;\n\n    /**\n     * Get a new date set to the specified day of week\n     */\n    dayOfWeek(date: Date, day: number, dir?: number): Date;\n\n    /**\n     * Get the first day of the month\n     */\n    firstDayOfMonth(date: Date): Date;\n\n    /**\n     * Get the last day of the month\n     */\n    lastDayOfMonth(date: Date): Date;\n\n    /**\n     * Get the first day of the year\n     */\n    firstDayOfYear(date: Date): Date;\n\n    /**\n     * Get the last day of the year\n     */\n    lastDayOfYear(date: Date): Date;\n\n    /**\n     * Get the week number in the year\n     */\n    weekInYear(date: Date, weekStartDay?: number): number;\n\n    /**\n     * Get a date with time set to midnight\n     */\n    getDate(date: Date): Date;\n\n    /**\n     * Convert date to UTC time\n     */\n    toUtcTime(date: Date): number;\n\n    /**\n     * Get milliseconds from midnight\n     */\n    getMilliseconds(date: Date): number;\n\n    /**\n     * Check if a time value is within a range\n     */\n    isInTimeRange(value: Date | null, min: Date, max: Date): boolean;\n\n    /**\n     * Check if a date value is within a range\n     */\n    isInDateRange(value: Date, min: Date, max: Date): boolean;\n\n    /**\n     * Add days to a date\n     */\n    addDays(date: Date, offset: number): Date;\n\n    /**\n     * Set time on a date (mutates the date)\n     */\n    setTime(date: Date, milliseconds: number, ignoreDST?: boolean): void;\n\n    /**\n     * Set hours from another date/time\n     */\n    setHours(date: Date, time: Date): Date;\n\n    /**\n     * Get today's date (midnight)\n     */\n    today(): Date;\n\n    /**\n     * Check if a date is today\n     */\n    isToday(date: Date): boolean;\n\n    /**\n     * Convert date to invariant time (fixed date, preserves time)\n     */\n    toInvariantTime(date?: Date): Date;\n\n    /**\n     * Get the next day\n     */\n    nextDay(date: Date): Date;\n\n    /**\n     * Get the previous day\n     */\n    previousDay(date: Date): Date;\n\n    /**\n     * Get the next year\n     */\n    nextYear(date: Date): Date;\n\n    /**\n     * Get the previous year\n     */\n    previousYear(date: Date): Date;\n\n    /**\n     * Split a date format string into parts\n     */\n    splitDateFormat(format: string): DateFormatPart[];\n\n    /**\n     * Get date format names (month names, day names, etc.)\n     */\n    dateFormatNames(options: DateFormatNamesOptions): string[];\n\n    /**\n     * Get date field name\n     */\n    dateFieldName(options: DateFieldNameOptions): string | undefined;\n\n    /**\n     * Generates a relative date string (Today, Yesterday, Last Wednesday, etc.)\n     * @param date - The date to compare against\n     * @param currentDate - The current date (defaults to new Date())\n     * @returns Relative date string\n     */\n    getRelativeDateString(date: Date | null | undefined, currentDate?: Date): string;\n}\n","import { \n    IDateUtilsService, \n    DateFormatPart, \n    DateFormatNamesOptions, \n    DateFieldNameOptions,\n    DATE_FIELD_MAP,\n    NAME_TYPES\n} from \"../models/date-utils\";\nimport { ICultureService } from \"../models/culture\";\nimport { IFormatterService } from \"../models/formatter\";\n\n/**\n * Service providing date utility functions\n * Extracted from kendo.date namespace\n */\nexport class DateUtilsService implements IDateUtilsService {\n    readonly MS_PER_MINUTE = 60000;\n    readonly MS_PER_HOUR = 60 * 60000;\n    readonly MS_PER_DAY = 86400000;\n\n    constructor(\n        private cultureService: ICultureService,\n        private formatterService: IFormatterService\n    ) {}\n\n    /**\n     * Adjust date for DST changes\n     */\n    adjustDST(date: Date, hours: number): boolean {\n        if (hours === 0 && date.getHours() === 23) {\n            date.setHours(date.getHours() + 2);\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * Set the day of week on a date (mutates the date)\n     */\n    setDayOfWeek(date: Date, day: number, dir: number = 1): void {\n        const hours = date.getHours();\n        day = ((day - date.getDay()) + (7 * dir)) % 7;\n        date.setDate(date.getDate() + day);\n        this.adjustDST(date, hours);\n    }\n\n    /**\n     * Get a new date set to the specified day of week\n     */\n    dayOfWeek(date: Date, day: number, dir?: number): Date {\n        date = new Date(date);\n        this.setDayOfWeek(date, day, dir);\n        return date;\n    }\n\n    /**\n     * Get the first day of the month\n     */\n    firstDayOfMonth(date: Date): Date {\n        return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            1\n        );\n    }\n\n    /**\n     * Get the last day of the month\n     */\n    lastDayOfMonth(date: Date): Date {\n        const last = new Date(date.getFullYear(), date.getMonth() + 1, 0);\n        const first = this.firstDayOfMonth(date);\n        const timeOffset = Math.abs(last.getTimezoneOffset() - first.getTimezoneOffset());\n\n        if (timeOffset) {\n            last.setHours(first.getHours() + (timeOffset / 60));\n        }\n\n        return last;\n    }\n\n    /**\n     * Get the first day of the year\n     */\n    firstDayOfYear(date: Date): Date {\n        return new Date(date.getFullYear(), 0, 1);\n    }\n\n    /**\n     * Get the last day of the year\n     */\n    lastDayOfYear(date: Date): Date {\n        return new Date(date.getFullYear(), 11, 31);\n    }\n\n    /**\n     * Move date to week start for week calculation\n     */\n    private moveDateToWeekStart(date: Date, weekStartDay: number): Date {\n        if (weekStartDay !== 1) {\n            return this.addDays(this.dayOfWeek(date, weekStartDay, -1), 4);\n        }\n        return this.addDays(date, (4 - (date.getDay() || 7)));\n    }\n\n    /**\n     * Calculate week number in year\n     */\n    private calcWeekInYear(date: Date, weekStartDay: number): number {\n        const firstWeekInYear = new Date(date.getFullYear(), 0, 1, -6);\n        const newDate = this.moveDateToWeekStart(date, weekStartDay);\n        const diffInMS = newDate.getTime() - firstWeekInYear.getTime();\n        const days = Math.floor(diffInMS / this.MS_PER_DAY);\n        return 1 + Math.floor(days / 7);\n    }\n\n    /**\n     * Get the week number in the year\n     */\n    weekInYear(date: Date, weekStartDay?: number): number {\n        if (weekStartDay === undefined) {\n            weekStartDay = this.cultureService.culture().calendar.firstDay;\n        }\n\n        const prevWeekDate = this.addDays(date, -7);\n        const nextWeekDate = this.addDays(date, 7);\n        const weekNumber = this.calcWeekInYear(date, weekStartDay);\n\n        if (weekNumber === 0) {\n            return this.calcWeekInYear(prevWeekDate, weekStartDay) + 1;\n        }\n\n        if (weekNumber === 53 && this.calcWeekInYear(nextWeekDate, weekStartDay) > 1) {\n            return 1;\n        }\n\n        return weekNumber;\n    }\n\n    /**\n     * Get a date with time set to midnight\n     */\n    getDate(date: Date): Date {\n        date = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);\n        this.adjustDST(date, 0);\n        return date;\n    }\n\n    /**\n     * Convert date to UTC time\n     */\n    toUtcTime(date: Date): number {\n        return Date.UTC(\n            date.getFullYear(), \n            date.getMonth(),\n            date.getDate(), \n            date.getHours(), \n            date.getMinutes(),\n            date.getSeconds(), \n            date.getMilliseconds()\n        );\n    }\n\n    /**\n     * Get milliseconds from midnight\n     */\n    getMilliseconds(date: Date): number {\n        return this.toInvariantTime(date).getTime() - this.getDate(this.toInvariantTime(date)).getTime();\n    }\n\n    /**\n     * Check if a time value is within a range\n     */\n    isInTimeRange(value: Date | null, min: Date, max: Date): boolean {\n        let msMin = this.getMilliseconds(min);\n        let msMax = this.getMilliseconds(max);\n\n        if (!value || msMin === msMax) {\n            return true;\n        }\n\n        if (min >= max) {\n            msMax += this.MS_PER_DAY;\n        }\n\n        let msValue = this.getMilliseconds(value);\n\n        if (msMin > msValue) {\n            msValue += this.MS_PER_DAY;\n        }\n\n        if (msMax < msMin) {\n            msMax += this.MS_PER_DAY;\n        }\n\n        return msValue >= msMin && msValue <= msMax;\n    }\n\n    /**\n     * Check if a date value is within a range\n     */\n    isInDateRange(value: Date, min: Date, max: Date): boolean {\n        let msMin = min.getTime();\n        let msMax = max.getTime();\n\n        if (msMin >= msMax) {\n            msMax += this.MS_PER_DAY;\n        }\n\n        const msValue = value.getTime();\n        return msValue >= msMin && msValue <= msMax;\n    }\n\n    /**\n     * Add days to a date\n     */\n    addDays(date: Date, offset: number): Date {\n        const hours = date.getHours();\n        date = new Date(date);\n        this.setTime(date, offset * this.MS_PER_DAY);\n        this.adjustDST(date, hours);\n        return date;\n    }\n\n    /**\n     * Set time on a date (mutates the date)\n     */\n    setTime(date: Date, milliseconds: number, ignoreDST?: boolean): void {\n        const offset = date.getTimezoneOffset();\n        date.setTime(date.getTime() + milliseconds);\n\n        if (!ignoreDST) {\n            const difference = date.getTimezoneOffset() - offset;\n            date.setTime(date.getTime() + difference * this.MS_PER_MINUTE);\n        }\n    }\n\n    /**\n     * Set hours from another date/time\n     */\n    setHours(date: Date, time: Date): Date {\n        date = new Date(\n            date.getFullYear(), \n            date.getMonth(), \n            date.getDate(), \n            time.getHours(), \n            time.getMinutes(), \n            time.getSeconds(), \n            time.getMilliseconds()\n        );\n        this.adjustDST(date, time.getHours());\n        return date;\n    }\n\n    /**\n     * Get today's date (midnight)\n     */\n    today(): Date {\n        return this.getDate(new Date());\n    }\n\n    /**\n     * Check if a date is today\n     */\n    isToday(date: Date): boolean {\n        return this.getDate(date).getTime() === this.today().getTime();\n    }\n\n    /**\n     * Convert date to invariant time (fixed date, preserves time)\n     */\n    toInvariantTime(date?: Date): Date {\n        const staticDate = new Date(1980, 1, 1, 0, 0, 0);\n\n        if (date) {\n            staticDate.setHours(\n                date.getHours(), \n                date.getMinutes(), \n                date.getSeconds(), \n                date.getMilliseconds()\n            );\n        }\n\n        return staticDate;\n    }\n\n    /**\n     * Add years to a date\n     */\n    private addYear(date: Date, offset: number): Date {\n        const currentDate = new Date(date);\n        return new Date(currentDate.setFullYear(currentDate.getFullYear() + offset));\n    }\n\n    /**\n     * Get the next day\n     */\n    nextDay(date: Date): Date {\n        return this.addDays(date, 1);\n    }\n\n    /**\n     * Get the previous day\n     */\n    previousDay(date: Date): Date {\n        return this.addDays(date, -1);\n    }\n\n    /**\n     * Get the next year\n     */\n    nextYear(date: Date): Date {\n        return this.addYear(date, 1);\n    }\n\n    /**\n     * Get the previous year\n     */\n    previousYear(date: Date): Date {\n        return this.addYear(date, -1);\n    }\n\n    /**\n     * Add literal part to date format parts array\n     */\n    private addLiteral(parts: DateFormatPart[], value: string): void {\n        const lastPart = parts[parts.length - 1];\n        if (lastPart && lastPart.type === \"LITERAL\") {\n            lastPart.pattern += value;\n        } else {\n            parts.push({\n                type: \"literal\",\n                pattern: value\n            });\n        }\n    }\n\n    /**\n     * Check if hour pattern is 12-hour format\n     */\n    private isHour12(pattern: string): boolean {\n        return pattern === \"h\" || pattern === \"K\";\n    }\n\n    /**\n     * Get date name type based on format length\n     */\n    private dateNameType(formatLength: number): string | undefined {\n        if (formatLength <= 3) {\n            return \"abbreviated\";\n        } else if (formatLength === 4) {\n            return \"wide\";\n        } else if (formatLength === 5) {\n            return \"narrow\";\n        }\n        return undefined;\n    }\n\n    /**\n     * Check if text starts with search string\n     */\n    private startsWith(text: string, searchString: string, position: number = 0): boolean {\n        return text.indexOf(searchString, position) === position;\n    }\n\n    /**\n     * Get date pattern from format\n     */\n    private datePattern(format: string | undefined, info: any): string {\n        const calendar = info.calendar;\n        let result: string | undefined;\n\n        if (typeof format === \"string\") {\n            if (calendar.patterns[format]) {\n                result = calendar.patterns[format];\n            } else {\n                result = format;\n            }\n        }\n\n        if (!result) {\n            result = calendar.patterns.d;\n        }\n\n        return result;\n    }\n\n    /**\n     * Split a date format string into parts\n     */\n    splitDateFormat(format: string): DateFormatPart[] {\n        const info = this.cultureService.culture();\n        const pattern = this.datePattern(format, info)\n            .replaceAll(\"dddd\", \"EEEE\")\n            .replaceAll(\"ddd\", \"EEE\")\n            .replace(\"tt\", \"aa\");\n        \n        const parts: DateFormatPart[] = [];\n        const dateFormatRegExp = /d{1,2}|E{1,6}|e{1,6}|c{3,6}|c{1}|M{1,5}|L{1,5}|y{1,4}|H{1,2}|h{1,2}|k{1,2}|K{1,2}|m{1,2}|a{1,5}|s{1,2}|S{1,3}|t{1,2}|z{1,4}|Z{1,5}|x{1,5}|X{1,5}|G{1,5}|q{1,5}|Q{1,5}|\"[^\"]*\"|'[^']*'/g;\n\n        let lastIndex = dateFormatRegExp.lastIndex = 0;\n        let match = dateFormatRegExp.exec(pattern);\n\n        while (match) {\n            const value = match[0];\n\n            if (lastIndex < match.index) {\n                this.addLiteral(parts, pattern.substring(lastIndex, match.index));\n            }\n\n            if (this.startsWith(value, '\"') || this.startsWith(value, \"'\")) {\n                this.addLiteral(parts, value);\n            } else {\n                const specifier = value[0];\n                const type = DATE_FIELD_MAP[specifier];\n                const part: DateFormatPart = {\n                    type: type,\n                    pattern: value\n                };\n\n                if (type === \"hour\") {\n                    part.hour12 = this.isHour12(value);\n                }\n\n                const names = NAME_TYPES[type];\n\n                if (names) {\n                    const minLength = typeof names.minLength === \"number\" \n                        ? names.minLength \n                        : names.minLength[specifier];\n                    const patternLength = value.length;\n\n                    if (patternLength >= minLength && value !== \"aa\") {\n                        part.names = {\n                            type: names.type,\n                            nameType: this.dateNameType(patternLength) || \"abbreviated\",\n                            standAlone: names.standAlone === specifier\n                        };\n                    }\n                }\n\n                parts.push(part);\n            }\n\n            lastIndex = dateFormatRegExp.lastIndex;\n            match = dateFormatRegExp.exec(pattern);\n        }\n\n        if (lastIndex < pattern.length) {\n            this.addLiteral(parts, pattern.substring(lastIndex));\n        }\n\n        return parts;\n    }\n\n    /**\n     * Get date format names (month names, day names, etc.)\n     */\n    dateFormatNames(options: DateFormatNamesOptions): string[] {\n        let { type, nameType } = options;\n        const info = this.cultureService.culture();\n\n        if (nameType === \"wide\") {\n            nameType = \"names\";\n        }\n        if (nameType === \"abbreviated\") {\n            nameType = \"namesAbbr\";\n        }\n        if (nameType === \"narrow\") {\n            nameType = \"namesShort\";\n        }\n\n        let result = info.calendar[type]?.[nameType];\n        if (!result) {\n            result = info.calendar[type]?.[\"name\"];\n        }\n        return result || [];\n    }\n\n    /**\n     * Get date field name\n     */\n    dateFieldName(options: DateFieldNameOptions): string | undefined {\n        const info = this.cultureService.culture();\n        const dateFields = info.calendar.dateFields;\n        const fieldNameInfo = dateFields?.[options.type] || {};\n        return fieldNameInfo[options.nameType];\n    }\n\n    /**\n     * Generates a relative date string (Today, Yesterday, Last Wednesday, etc.)\n     * @param date - The date to compare against\n     * @param currentDate - The current date (defaults to new Date())\n     * @returns Relative date string\n     */\n    getRelativeDateString(date: Date | null | undefined, currentDate: Date = new Date()): string {\n        if (!date) {\n            return '';\n        }\n\n        const today = new Date(currentDate);\n        today.setHours(0, 0, 0, 0);\n\n        const dateObj = new Date(date);\n        dateObj.setHours(0, 0, 0, 0);\n\n        const diffTime = today.getTime() - dateObj.getTime();\n        const diffDays = Math.floor(diffTime / this.MS_PER_DAY);\n\n        if (diffDays === 0) {\n            return 'Today';\n        } else if (diffDays === 1) {\n            return 'Yesterday';\n        } else if (diffDays <= 6) {\n            return `Last ${this.formatterService.toString(dateObj, 'dddd')}`;\n        } else {\n            // For older dates, show formatted date\n            return String(this.formatterService.toString(dateObj, 'dddd, MMMM dd, yyyy'));\n        }\n    }\n}\n","import \"../../kendo.icons.js\";\nimport { inject } from \"../../core/service-container\";\nimport { HtmlService } from \"../../core/services/html.service\";\nimport { DateParserService } from \"../../core/services/date-parser.service\";\nimport { FormatterService } from \"../../core/services/formatter.service\";\nimport { DateUtilsService } from \"../../core/services/date-utils.service\";\nimport { UtilsService } from \"../../core/services/utils.service\";\nimport { STYLES, ICONS, REFERENCES, MESSAGE_STATUS, FILES_LAYOUT_MODE } from \"../constants\";\nimport type { IMessage, IAuthor, IChatMessages, IChatAttachment, TimestampTemplateFunction, MessageTemplateFunction, MessageStatusTemplateFunction, MessageContentTemplateFunction, AttachmentTemplateFunction, UserStatusTemplateFunction, MessageStatus, IMessageSettings, IMessageStatusSettings, FilesLayoutMode, AttachmentLayoutMode } from \"../models\";\nimport { renderAvatar, renderTypingIndicator } from \"./common.template\";\nimport { renderFiles, renderMessageReference } from \"./file.template\";\n\ndeclare const kendo: any;\n\n/**\n * Renders the retry button for failed messages.\n */\nexport const renderRetryButton = (\n    message: IMessage,\n    retryText: string\n): string => {\n    if (!message.failed) {\n        return \"\";\n    }\n    return kendo.html.renderButton(\n        `<button class=\"${STYLES.messageRetryButton}\" ${REFERENCES.retryButton} title=\"${retryText}\" aria-label=\"${retryText}\" data-uid=\"${message.uid || \"\"}\"></button>`,\n        { icon: ICONS.retry, size: \"small\", fillMode: \"flat\" }\n    );\n};\n\n/**\n * Renders the message status indicator.\n * Supports custom status settings with icon/svgIcon for enhanced display.\n */\nexport const renderMessageStatus = (\n    status: MessageStatus | undefined,\n    message: IMessage,\n    statusTemplate?: MessageStatusTemplateFunction | null,\n    htmlService = inject(HtmlService),\n    statusSettings?: Record<MessageStatus, IMessageStatusSettings>\n): string => {\n    if (!status) {\n        return \"\";\n    }\n\n    if (statusTemplate) {\n        return statusTemplate({ status, message });\n    }\n\n    const settings = statusSettings?.[status];\n    const statusClass = status === MESSAGE_STATUS.FAILED\n        ? `${STYLES.messageStatus} ${STYLES.messageFailed}${settings?.cssClass ? \" \" + settings.cssClass : \"\"}`\n        : `${STYLES.messageStatus}${settings?.cssClass ? \" \" + settings.cssClass : \"\"}`;\n\n    let iconHtml = \"\";\n    if (settings?.icon) {\n        iconHtml = kendo.ui.icon({ icon: settings.icon });\n    } else if (settings?.svgIcon) {\n        iconHtml = kendo.ui.icon({ icon: settings.svgIcon });\n    }\n\n    const statusText = settings?.text !== undefined\n        ? settings.text\n        : status.charAt(0).toUpperCase() + status.slice(1);\n\n    return `<span class=\"${statusClass}\">${iconHtml}${htmlService.encode(statusText)}</span>`;\n};\n\n/**\n * Renders a single attachment card.\n */\nexport const renderAttachment = (\n    attachment: IChatAttachment,\n    message: IMessage,\n    attachmentTemplate?: AttachmentTemplateFunction | null,\n    htmlService = inject(HtmlService)\n): string => {\n    if (attachmentTemplate) {\n        return attachmentTemplate({ attachment, message });\n    }\n\n    const title = attachment.title ? `<div class=\"${STYLES.cardTitle}\">${htmlService.encode(attachment.title)}</div>` : \"\";\n    const subtitle = attachment.subtitle ? `<div class=\"${STYLES.cardSubtitle}\">${htmlService.encode(attachment.subtitle)}</div>` : \"\";\n    const image = attachment.thumbnailUrl ? `<div class=\"${STYLES.cardMedia}\"><img src=\"${htmlService.encode(attachment.thumbnailUrl)}\" alt=\"\" /></div>` : \"\";\n    const actions = attachment.actions?.length\n        ? `<div class=\"${STYLES.cardActions}\">${attachment.actions.map(a => `<button class=\"${STYLES.cardAction} ${STYLES.button}\">${htmlService.encode(a.text)}</button>`).join(\"\")}</div>`\n        : \"\";\n\n    return `<div class=\"${STYLES.card}\">\n        ${image}\n        <div class=\"${STYLES.cardBody}\">\n            ${title}\n            ${subtitle}\n        </div>\n        ${actions}\n    </div>`;\n};\n\n/**\n * Renders attachments with the specified layout.\n */\nexport const renderAttachments = (\n    attachments: IChatAttachment[] | undefined,\n    message: IMessage,\n    layout: AttachmentLayoutMode = \"list\",\n    attachmentTemplate?: AttachmentTemplateFunction | null\n): string => {\n    if (!attachments?.length) {\n        return \"\";\n    }\n\n    const attachmentsHtml = attachments.map(a => renderAttachment(a, message, attachmentTemplate)).join(\"\");\n    const layoutClass = layout === \"carousel\" ? STYLES.cardDeckScrollWrap : STYLES.cardList;\n\n    return `<div class=\"${layoutClass}\">${attachmentsHtml}</div>`;\n};\n\n/**\n * Renders a single chat message.\n */\nexport const renderMessage = (\n    message: IMessage & { isOwnMessage: boolean; author: IAuthor },\n    replyMessage: IMessage | null,\n    downloadAll: boolean,\n    messages: IChatMessages,\n    expandable: boolean,\n    messageTimeFormat: string,\n    skipSanitization: boolean,\n    statusTemplate?: MessageStatusTemplateFunction | null,\n    filesLayoutMode: FilesLayoutMode = FILES_LAYOUT_MODE.VERTICAL,\n    htmlService = inject(HtmlService),\n    formatterService = inject(FormatterService),\n    dateParserService = inject(DateParserService),\n    contentTemplate?: MessageContentTemplateFunction | null,\n    attachmentTemplate?: AttachmentTemplateFunction | null,\n    attachmentLayout?: AttachmentLayoutMode\n): string => {\n    const isDeleted = message.isDeleted;\n    const isFailed = message.failed || message.status === MESSAGE_STATUS.FAILED;\n    const expandableClasses = expandable && !message.isTyping\n        ? [STYLES.bubbleExpandable, STYLES.expanded]\n        : [];\n\n    const replyMessageHtml = replyMessage\n        ? renderMessageReference({\n            text: replyMessage.text,\n            files: replyMessage.files,\n            isOwnMessage: replyMessage.isOwnMessage,\n            isPinMessage: false,\n            renderCloseButton: false,\n            renderFileMenuButton: false\n        })\n        : \"\";\n\n    let messageContent = \"\";\n    if (message.isTyping && !message.isOwnMessage) {\n        messageContent = renderTypingIndicator();\n    } else if (contentTemplate && !isDeleted) {\n        messageContent = contentTemplate(message);\n    } else if (isDeleted) {\n        messageContent = message.isOwnMessage\n            ? htmlService.encode(messages.selfMessageDeleted)\n            : htmlService.encode(messages.otherMessageDeleted);\n    } else {\n        messageContent = htmlService.convertTextUrlToLink(message.text || \"\", skipSanitization);\n    }\n\n    const attachmentsHtml = !isDeleted\n        ? renderAttachments(message.attachments, message, attachmentLayout || message.attachmentLayout || \"list\", attachmentTemplate)\n        : \"\";\n\n    const timeHtml = `<time class=\"${STYLES.messageTime}\">${formatterService.toString(dateParserService.parseDate(message.timestamp), messageTimeFormat)}</time>`;\n    const statusHtml = renderMessageStatus(message.status, message, statusTemplate, htmlService);\n    const retryHtml = isFailed ? renderRetryButton(message, messages.retryMessage || \"Retry\") : \"\";\n    const messageInfoHtml = `<div class=\"${STYLES.messageInfo}\">${timeHtml}${statusHtml}${retryHtml}</div>`;\n\n    return `<div class=\"${STYLES.message}${isDeleted ? \" \" + STYLES.messageRemoved : \"\"}${isFailed ? \" \" + STYLES.messageFailed : \"\"}\" data-uid=\"${htmlService.encode(message.uid ?? \"\")}\">\n        <div class=\"${STYLES.chatBubble} ${STYLES.bubble} ${expandableClasses.join(\" \")}\">\n            <div class=\"${STYLES.bubbleContent}\">\n                ${replyMessageHtml}\n                <span class=\"${STYLES.chatBubbleText}\">${messageContent}</span>\n                ${!isDeleted ? renderFiles(message.files, downloadAll, messages, false, filesLayoutMode) : \"\"}\n                ${attachmentsHtml}\n            </div>\n            ${expandable && !message.isTyping ? `<span class=\"${STYLES.bubbleExpandableIndicator}\" ${REFERENCES.bubbleExpandableIndicator}>${kendo.ui.icon({ icon: ICONS.chevronUp })}</span>` : \"\"}\n        </div>\n        ${messageInfoHtml}\n        ${!isDeleted ? `<div class=\"${STYLES.messageToolbar}\"></div>` : \"\"}\n    </div>`;\n};\n\n/**\n * Renders a message group with author avatar and multiple messages.\n */\nexport const renderMessageGroup = (\n    context: {\n        message: IMessage;\n        author: IAuthor;\n        isOwnMessage: boolean;\n        replyMessage?: IMessage | null;\n        downloadAll?: boolean;\n        messages?: IChatMessages;\n        expandable?: boolean;\n        fullWidth?: boolean;\n        messageTimeFormat?: string;\n        timestampTemplate?: TimestampTemplateFunction | null;\n        statusTemplate?: MessageStatusTemplateFunction | null;\n        showTimestamp?: boolean;\n        messageTemplate?: MessageTemplateFunction;\n        skipSanitization?: boolean;\n        messageSettings?: IMessageSettings;\n        filesLayoutMode?: FilesLayoutMode;\n        contentTemplate?: MessageContentTemplateFunction | null;\n        authorMessageContentTemplate?: MessageContentTemplateFunction | null;\n        receiverMessageContentTemplate?: MessageContentTemplateFunction | null;\n        attachmentTemplate?: AttachmentTemplateFunction | null;\n        attachmentLayout?: AttachmentLayoutMode;\n        userStatusTemplate?: UserStatusTemplateFunction | null;\n    },\n    utilsService = inject(UtilsService),\n    dateUtilsService = inject(DateUtilsService),\n    htmlService = inject(HtmlService),\n    dateParserService = inject(DateParserService)\n): string => {\n    const {\n        message,\n        author,\n        isOwnMessage,\n        replyMessage,\n        downloadAll = true,\n        messages,\n        expandable = false,\n        fullWidth = false,\n        messageTimeFormat = \"ddd MMM dd yyyy\",\n        timestampTemplate,\n        statusTemplate,\n        showTimestamp = false,\n        messageTemplate,\n        skipSanitization = false,\n        messageSettings,\n        filesLayoutMode = FILES_LAYOUT_MODE.VERTICAL,\n        contentTemplate,\n        authorMessageContentTemplate,\n        receiverMessageContentTemplate,\n        attachmentTemplate,\n        attachmentLayout,\n        userStatusTemplate\n    } = context;\n\n    // Determine the effective content template based on message author\n    const effectiveContentTemplate = isOwnMessage\n        ? (authorMessageContentTemplate || contentTemplate)\n        : (receiverMessageContentTemplate || contentTemplate);\n\n    // Apply user-specific settings if provided\n    const effectiveShowAvatar = messageSettings?.showAvatar !== undefined\n        ? messageSettings.showAvatar && author && author.imageUrl\n        : author && author.imageUrl;\n    const effectiveShowUsername = messageSettings?.showUsername !== undefined\n        ? messageSettings.showUsername\n        : true;\n    const effectiveExpandable = messageSettings?.allowMessageCollapse !== undefined\n        ? messageSettings.allowMessageCollapse\n        : expandable;\n    const effectiveFullWidth = messageSettings?.messageWidthMode === \"full\" || fullWidth;\n\n    const groupClasses = [\n        STYLES.messageGroup,\n        isOwnMessage ? STYLES.messageGroupSender : STYLES.messageGroupReceiver,\n        effectiveShowAvatar ? \"\" : STYLES.noAvatar,\n        effectiveFullWidth ? STYLES.messageGroupFullWidth : \"\"\n    ].filter(Boolean).join(\" \");\n\n    let timestampContent = \"\";\n    if (showTimestamp && message.timestamp) {\n        const messageDate = dateParserService.parseDate(message.timestamp);\n        if (utilsService.isFunction(timestampTemplate)) {\n            timestampContent = timestampTemplate!({ date: messageDate, message });\n        } else {\n            const relativeDateText = dateUtilsService.getRelativeDateString(messageDate);\n            timestampContent = `<div class=\"${STYLES.timestamp}\">${relativeDateText}</div>`;\n        }\n    }\n\n    const userStatusHtml = userStatusTemplate ? userStatusTemplate({ author }) : \"\";\n\n    // Use custom messageTemplate or default renderMessage\n    let messageHtml: string;\n    if (messageTemplate) {\n        messageHtml = messageTemplate(\n            { ...message, isOwnMessage, author },\n            replyMessage ?? null,\n            downloadAll,\n            messages!,\n            effectiveExpandable,\n            messageTimeFormat,\n            skipSanitization\n        );\n    } else {\n        messageHtml = renderMessage(\n            { ...message, isOwnMessage, author },\n            replyMessage ?? null,\n            downloadAll,\n            messages!,\n            effectiveExpandable,\n            messageTimeFormat,\n            skipSanitization,\n            statusTemplate,\n            filesLayoutMode,\n            htmlService,\n            undefined,\n            undefined,\n            effectiveContentTemplate,\n            attachmentTemplate,\n            attachmentLayout\n        );\n    }\n\n    return `${showTimestamp && timestampContent ? timestampContent : \"\"}\n        <div class=\"${groupClasses}\">${userStatusHtml}\n            ${effectiveShowAvatar ? renderAvatar(author.imageUrl!, author.imageAltText) : \"\"}\n            <div class=\"${STYLES.messageGroupContent}\">\n                ${effectiveShowUsername ? `<span class=\"${STYLES.messageAuthor}\">${htmlService.encode(author.name ?? \"\")}</span>` : \"\"}\n                ${messageHtml}\n            </div>\n        </div>`;\n};\n","import \"../../kendo.avatar.js\"; // Still required until kendo.ui is modularized\nimport \"../../kendo.button.js\";\nimport \"../../kendo.toolbar.js\";\nimport { inject } from \"../../core/service-container\";\nimport { HtmlService } from \"../../core/services/html.service\";\nimport { STYLES, REFERENCES, ICONS, SUGGESTED_ACTIONS_LAYOUT_MODE } from \"../constants\";\nimport type { ISuggestion, IHeaderItem, HeaderTemplateFunction, SuggestedActionsLayoutMode } from \"../models\";\n\ndeclare const kendo: any;\n\n/**\n * Renders a list of suggestions/suggested actions with the specified layout mode.\n * @param suggestions - Array of suggestions to render\n * @param layoutMode - Layout mode: \"scroll\" | \"wrap\" | \"scrollbuttons\"\n * @param isRtl - Whether RTL direction is used\n * @param htmlService - HTML encoding service\n */\nexport const renderSuggestions = (\n    suggestions: ISuggestion[] | undefined,\n    htmlService = inject(HtmlService)\n): string => {\n    if (!suggestions?.length) {\n        return \"\";\n    }\n\n    const suggestionItems = suggestions\n        .map(suggestion => `<span class=\"${STYLES.suggestion}\">${htmlService.encode(suggestion.text)}</span>`)\n        .join(\"\");\n\n    return `<div class=\"${STYLES.suggestionGroup}\" ${REFERENCES.suggestionGroup}>${suggestionItems}</div>`;\n};\n\n/**\n * Renders suggestions with the specified layout mode from an array of suggestions.\n * @param suggestions - Array of suggestions to render\n * @param layoutMode - Layout mode: \"scroll\" | \"wrap\" | \"scrollbuttons\"\n * @param isRtl - Whether RTL direction is used\n * @param htmlService - HTML encoding service\n */\nexport const renderSuggestionsWithLayout = (\n    suggestions: ISuggestion[] | undefined,\n    layoutMode: SuggestedActionsLayoutMode = SUGGESTED_ACTIONS_LAYOUT_MODE.SCROLL,\n    isRtl: boolean = false,\n    htmlService = inject(HtmlService)\n): string => {\n    if (!suggestions?.length) {\n        return \"\";\n    }\n\n    const suggestionItems = suggestions\n        .map(suggestion => `<span class=\"${STYLES.suggestion}\">${htmlService.encode(suggestion.text)}</span>`)\n        .join(\"\");\n\n    return wrapSuggestionsWithLayout(suggestionItems, layoutMode, isRtl);\n};\n\n/**\n * Wraps pre-rendered suggestion content with the specified layout mode.\n * Use this when you have custom-rendered content from a template.\n * @param content - Pre-rendered HTML content (suggestion items)\n * @param layoutMode - Layout mode: \"scroll\" | \"wrap\" | \"scrollbuttons\"\n * @param isRtl - Whether RTL direction is used\n */\nexport const wrapSuggestionsWithLayout = (\n    content: string,\n    layoutMode: SuggestedActionsLayoutMode = SUGGESTED_ACTIONS_LAYOUT_MODE.SCROLL,\n    isRtl: boolean = false\n): string => {\n    if (!content) {\n        return \"\";\n    }\n\n    if (layoutMode === SUGGESTED_ACTIONS_LAYOUT_MODE.WRAP) {\n        return `<div class=\"${STYLES.suggestionGroup}\" ${REFERENCES.suggestionGroup}>${content}</div>`;\n    }\n\n    const layoutClass = layoutMode === SUGGESTED_ACTIONS_LAYOUT_MODE.SCROLL\n        ? STYLES.suggestionGroupScrollable\n        : \"\";\n\n    const groupClass = layoutClass ? `${STYLES.suggestionGroup} ${layoutClass}` : STYLES.suggestionGroup;\n    const scrollContent = `<div class=\"${STYLES.suggestionsScroll}\">${content}</div>`;\n    const suggestionsElement = `<div class=\"${groupClass}\" ${REFERENCES.suggestionGroup}>${scrollContent}</div>`;\n\n    if (layoutMode === SUGGESTED_ACTIONS_LAYOUT_MODE.SCROLLBUTTONS) {\n        return renderScrollableSuggestions(suggestionsElement, isRtl);\n    }\n\n    return suggestionsElement;\n};\n\n/**\n * Renders scrollable suggestions with navigation buttons and gradient styling.\n */\nexport const renderScrollableSuggestions = (\n    suggestionsElement: string,\n    isRtl: boolean\n): string => {\n    const leftIcon = isRtl ? ICONS.chevronRight : ICONS.chevronLeft;\n    const rightIcon = isRtl ? ICONS.chevronLeft : ICONS.chevronRight;\n\n    return `<div class=\"${STYLES.suggestionScrollWrap} ${STYLES.suggestionScrollWrapGradient}\">\n        ${new kendo.ui.Button(`<button ${REFERENCES.leftScrollButton}>`, { icon: leftIcon }).wrapper[0].outerHTML}\n        ${suggestionsElement}\n        ${new kendo.ui.Button(`<button ${REFERENCES.rightScrollButton}>`, { icon: rightIcon }).wrapper[0].outerHTML}\n    </div>`;\n};\n\n/**\n * Renders the chat header using Toolbar.\n * @param items - Array of toolbar items configuration\n * @param headerTemplate - Optional custom header template that overrides items\n */\nexport const renderHeader = (\n    items: IHeaderItem[],\n    headerTemplate?: HeaderTemplateFunction | null\n): string => {\n    // If custom header template is provided, use it\n    if (headerTemplate) {\n        return `<div class=\"${STYLES.header}\">${headerTemplate()}</div>`;\n    }\n\n    // If no items provided, return empty\n    if (!items || items.length === 0) {\n        return \"\";\n    }\n\n    // Use Toolbar for header rendering\n    const toolbarElement = $(`<div class=\"${STYLES.header}\">`);\n    new kendo.ui.ToolBar(toolbarElement, {\n        items: items\n    });\n\n    return toolbarElement[0].outerHTML;\n};\n","import { HtmlService } from \"../../../core/services/html.service\";\nimport { DateParserService } from \"../../../core/services/date-parser.service\";\nimport { DOT, STYLES, MESSAGE_WIDTH_MODE } from \"../../constants\";\nimport { renderMessage } from \"../../templates\";\nimport type { IChatOptions, IMessage, IAuthor, IChatMessages, IMessageSettings, MessageStatusTemplateFunction } from \"../../models\";\nimport type { DataManager } from \"../data-manager.collaborator\";\nimport type { IKendoJQuery } from \"../../../core\";\n\ndeclare const $: any;\n\nexport interface IMessageRendererContext {\n    list: IKendoJQuery;\n    options: IChatOptions;\n    dataManager: DataManager;\n    htmlService: HtmlService;\n    dateParserService: DateParserService;\n    dataItem: (message: IKendoJQuery) => IMessage | null;\n    getReplyMessage: (message: IMessage) => IMessage | null;\n    initMessageToolbar: (element: IKendoJQuery) => void;\n    initFileMenus: (element: IKendoJQuery) => void;\n}\n\nexport class MessageRenderer {\n    private context: IMessageRendererContext;\n\n    constructor(context: IMessageRendererContext) {\n        this.context = context;\n    }\n\n    renderMessage(message: IMessage): void {\n        const options = this.context.options;\n        const componentMessages = options.messages;\n        const expandable = options.allowMessageCollapse;\n        const fullWidth = options.messageWidthMode === MESSAGE_WIDTH_MODE.FULL;\n        const author: IAuthor = {\n            id: message.authorId,\n            name: message.authorName,\n            imageUrl: message.authorImageUrl,\n            imageAltText: message.authorImageAltText\n        };\n        const isOwnMessage = author.id === options.authorId;\n        const replyMessage = this.context.getReplyMessage(message);\n        const messageTimeFormat = options.messageTimeFormat;\n        const skipSanitization = options.skipSanitization;\n        const statusTemplate = options.messageStatusTemplate;\n        const userSettings = isOwnMessage ? options.authorMessageSettings : options.receiverMessageSettings;\n        const messageSettings = this._mergeMessageSettings(options, userSettings);\n\n        if (this._handleExistingMessageUpdate({\n            message, author, isOwnMessage, replyMessage, componentMessages, expandable, messageTimeFormat, skipSanitization, statusTemplate, messageSettings\n        })) {\n            return;\n        }\n\n        const targetGroupElement = this._findTargetMessageGroup();\n        const canGroup = this._canGroupWithLastMessage(targetGroupElement, author.id);\n\n        if (canGroup && targetGroupElement.length) {\n            this._addMessageToExistingGroup({\n                message, author, isOwnMessage, replyMessage, componentMessages, expandable, targetGroupElement, messageTimeFormat, skipSanitization, statusTemplate, messageSettings\n            });\n        } else {\n            const showTimestamp = this._shouldShowTimestamp(message);\n            this._createNewMessageGroup({\n                message, author, isOwnMessage, replyMessage, componentMessages, expandable, fullWidth, messageTimeFormat, showTimestamp, skipSanitization, statusTemplate, messageSettings\n            });\n        }\n    }\n\n    _mergeMessageSettings(options: IChatOptions, userSettings: IMessageSettings | null | undefined): IMessageSettings {\n        const merged: IMessageSettings = {\n            showAvatar: options.showAvatar,\n            showUsername: options.showUsername,\n            showTimestamp: options.timestampVisibility !== \"never\",\n            allowMessageCollapse: options.allowMessageCollapse,\n            messageWidthMode: options.messageWidthMode\n        };\n\n        if (userSettings) {\n            if (userSettings.showAvatar !== undefined) merged.showAvatar = userSettings.showAvatar;\n            if (userSettings.showUsername !== undefined) merged.showUsername = userSettings.showUsername;\n            if (userSettings.showTimestamp !== undefined) merged.showTimestamp = userSettings.showTimestamp;\n            if (userSettings.allowMessageCollapse !== undefined) merged.allowMessageCollapse = userSettings.allowMessageCollapse;\n            if (userSettings.messageWidthMode !== undefined) merged.messageWidthMode = userSettings.messageWidthMode;\n            if (userSettings.enableFileActions !== undefined) merged.enableFileActions = userSettings.enableFileActions;\n            if (userSettings.enableContextMenuActions !== undefined) merged.enableContextMenuActions = userSettings.enableContextMenuActions;\n            if (userSettings.messageToolbarActions !== undefined) merged.messageToolbarActions = userSettings.messageToolbarActions;\n            if (userSettings.messageActions !== undefined) merged.messageActions = userSettings.messageActions;\n        }\n\n        return merged;\n    }\n\n    _shouldShowTimestamp(message: IMessage): boolean {\n        if (!message.timestamp) {\n            return false;\n        }\n\n        const lastNonTypingMessage = this.context.list.find(DOT + STYLES.message).filter(function() {\n            return $(this).find(DOT + STYLES.typingIndicator).length === 0;\n        }).last() as IKendoJQuery;\n\n        if (!lastNonTypingMessage.length) {\n            return true;\n        }\n\n        const lastMessageData = this.context.dataItem(lastNonTypingMessage);\n        if (!lastMessageData || !lastMessageData.timestamp) {\n            return true;\n        }\n\n        const currentMessageDate = this.context.dateParserService.parseDate(message.timestamp);\n        const lastMessageDate = this.context.dateParserService.parseDate(lastMessageData.timestamp);\n\n        if (!currentMessageDate || !lastMessageDate) {\n            return false;\n        }\n\n        const currentDay = new Date(currentMessageDate);\n        currentDay.setHours(0, 0, 0, 0);\n\n        const lastDay = new Date(lastMessageDate);\n        lastDay.setHours(0, 0, 0, 0);\n\n        return currentDay.getTime() !== lastDay.getTime();\n    }\n\n    _handleExistingMessageUpdate(context: {\n        message: IMessage;\n        author: IAuthor;\n        isOwnMessage: boolean;\n        replyMessage: IMessage | null;\n        componentMessages: IChatMessages;\n        expandable: boolean;\n        messageTimeFormat: string;\n        skipSanitization: boolean;\n        statusTemplate?: MessageStatusTemplateFunction | null;\n        messageSettings?: IMessageSettings;\n    }): boolean {\n        const { message, author, isOwnMessage, replyMessage, componentMessages, expandable, messageTimeFormat, skipSanitization, statusTemplate, messageSettings } = context;\n        const options = this.context.options;\n        const existingMessageElement = this.context.list.find(DOT + STYLES.message + `[data-uid=\"${this.context.htmlService.encode(message.uid ?? \"\")}\"]`);\n\n        if (existingMessageElement.length) {\n            const messageTemplate = options.messageTemplate;\n\n            let messageHtml: string;\n            if (messageTemplate) {\n                messageHtml = messageTemplate(\n                    { ...message, isOwnMessage, author },\n                    replyMessage,\n                    true,\n                    componentMessages,\n                    messageSettings?.allowMessageCollapse ?? expandable,\n                    messageTimeFormat,\n                    skipSanitization,\n                    statusTemplate\n                );\n            } else {\n                messageHtml = renderMessage(\n                    { ...message, isOwnMessage, author },\n                    replyMessage,\n                    true,\n                    componentMessages,\n                    messageSettings?.allowMessageCollapse ?? expandable,\n                    messageTimeFormat,\n                    skipSanitization,\n                    statusTemplate,\n                    options.filesLayoutMode,\n                    this.context.htmlService\n                );\n            }\n\n            const updatedMessageElement = $(messageHtml);\n            existingMessageElement.replaceWith(updatedMessageElement);\n            this.context.initMessageToolbar(updatedMessageElement.find(DOT + STYLES.messageToolbar) as IKendoJQuery);\n            this.context.initFileMenus(updatedMessageElement);\n            return true;\n        }\n        return false;\n    }\n\n    _findTargetMessageGroup(): IKendoJQuery {\n        let lastGroupElement = this.context.list.children(DOT + STYLES.messageGroup).last();\n        let targetGroupElement = lastGroupElement;\n\n        const messagesInLastGroup = lastGroupElement.find(DOT + STYLES.message);\n        if (messagesInLastGroup.length === 1) {\n            const onlyMessage = messagesInLastGroup.first();\n            const isTypingIndicator = onlyMessage.find(DOT + STYLES.typingIndicator).length > 0;\n\n            if (isTypingIndicator) {\n                targetGroupElement = lastGroupElement.prev(DOT + STYLES.messageGroup);\n            }\n        }\n\n        return targetGroupElement as IKendoJQuery;\n    }\n\n    _canGroupWithLastMessage(targetGroupElement: IKendoJQuery, authorId: string): boolean {\n        const lastMessageInTargetGroup = targetGroupElement.find(DOT + STYLES.message).filter(function() {\n            return $(this).find(DOT + STYLES.typingIndicator).length === 0;\n        }).last() as IKendoJQuery;\n\n        const lastMessageData = this.context.dataItem(lastMessageInTargetGroup);\n        return lastMessageData?.authorId === authorId;\n    }\n\n    _addMessageToExistingGroup(context: {\n        message: IMessage;\n        author: IAuthor;\n        isOwnMessage: boolean;\n        replyMessage: IMessage | null;\n        componentMessages: IChatMessages;\n        expandable: boolean;\n        targetGroupElement: IKendoJQuery;\n        messageTimeFormat: string;\n        skipSanitization: boolean;\n        statusTemplate?: MessageStatusTemplateFunction | null;\n        messageSettings?: IMessageSettings;\n    }): void {\n        const { message, author, isOwnMessage, replyMessage, componentMessages, expandable, targetGroupElement, messageTimeFormat, skipSanitization, statusTemplate, messageSettings } = context;\n        const options = this.context.options;\n        const messageTemplate = options.messageTemplate;\n        const messageGroupContent = targetGroupElement.find(DOT + STYLES.messageGroupContent);\n\n        let messageHtml: string;\n        if (messageTemplate) {\n            messageHtml = messageTemplate(\n                { ...message, isOwnMessage, author },\n                replyMessage,\n                true,\n                componentMessages,\n                messageSettings?.allowMessageCollapse ?? expandable,\n                messageTimeFormat,\n                skipSanitization,\n                statusTemplate\n            );\n        } else {\n            messageHtml = renderMessage(\n                { ...message, isOwnMessage, author },\n                replyMessage,\n                true,\n                componentMessages,\n                messageSettings?.allowMessageCollapse ?? expandable,\n                messageTimeFormat,\n                skipSanitization,\n                statusTemplate,\n                options.filesLayoutMode,\n                this.context.htmlService\n            );\n        }\n\n        const messageElement = $(messageHtml);\n        messageGroupContent.append(messageElement);\n        this.context.initMessageToolbar(messageElement.find(DOT + STYLES.messageToolbar) as IKendoJQuery);\n        this.context.initFileMenus(messageElement);\n        this._moveTypingIndicatorsToEnd();\n    }\n\n    _createNewMessageGroup(context: {\n        message: IMessage;\n        author: IAuthor;\n        isOwnMessage: boolean;\n        replyMessage: IMessage | null;\n        componentMessages: IChatMessages;\n        expandable: boolean;\n        fullWidth: boolean;\n        messageTimeFormat: string;\n        showTimestamp: boolean;\n        skipSanitization: boolean;\n        statusTemplate?: MessageStatusTemplateFunction | null;\n        messageSettings?: IMessageSettings;\n    }): IKendoJQuery {\n        const { message, author, isOwnMessage, replyMessage, componentMessages, expandable, fullWidth, messageTimeFormat, showTimestamp, skipSanitization, statusTemplate, messageSettings } = context;\n        const options = this.context.options;\n        const messageGroupTemplate = options.messageGroupTemplate;\n        const timestampTemplate = options.timestampTemplate;\n        const messageTemplate = options.messageTemplate;\n\n        const groupElement = $(messageGroupTemplate({\n            message,\n            author,\n            isOwnMessage,\n            replyMessage,\n            downloadAll: true,\n            messages: componentMessages,\n            expandable,\n            fullWidth,\n            messageTimeFormat,\n            timestampTemplate,\n            statusTemplate,\n            showTimestamp,\n            messageTemplate,\n            skipSanitization,\n            messageSettings,\n            filesLayoutMode: options.filesLayoutMode,\n            contentTemplate: options.messageContentTemplate,\n            authorMessageContentTemplate: options.authorMessageContentTemplate,\n            receiverMessageContentTemplate: options.receiverMessageContentTemplate,\n            attachmentTemplate: options.attachmentTemplate,\n            attachmentLayout: options.attachmentLayout,\n            userStatusTemplate: options.userStatusTemplate\n        }));\n\n        this.context.list.append(groupElement);\n        this.context.initMessageToolbar(groupElement.find(DOT + STYLES.messageToolbar) as IKendoJQuery);\n        this.context.initFileMenus(groupElement);\n        this._moveTypingIndicatorsToEnd();\n\n        return groupElement;\n    }\n\n    _moveTypingIndicatorsToEnd(): void {\n        const ctx = this.context;\n        const options = ctx.options;\n        const messageGroupTemplate = options.messageGroupTemplate;\n        const fullWidth = options.messageWidthMode === MESSAGE_WIDTH_MODE.FULL;\n\n        const typingMessages = ctx.list.find(DOT + STYLES.message).filter(function() {\n            return $(this).find(DOT + STYLES.typingIndicator).length > 0;\n        });\n\n        typingMessages.each(function() {\n            const typingMessage = $(this);\n            const messageGroup = typingMessage.closest(DOT + STYLES.messageGroup);\n            const messagesInGroup = messageGroup.find(DOT + STYLES.message);\n\n            if (messagesInGroup.length === 1) {\n                messageGroup.detach().appendTo(ctx.list);\n            } else {\n                typingMessage.remove();\n\n                const message = ctx.dataItem(typingMessage);\n                if (!message) return;\n\n                const author: IAuthor = {\n                    id: message.authorId,\n                    name: message.authorName,\n                    imageUrl: message.authorImageUrl,\n                    imageAltText: message.authorImageAltText\n                };\n\n                const typingGroupElement = $(messageGroupTemplate({\n                    message,\n                    author,\n                    isOwnMessage: author.id === options.authorId,\n                    fullWidth,\n                    messageTimeFormat: options.messageTimeFormat,\n                    showTimestamp: false,\n                    timestampTemplate: options.timestampTemplate,\n                    messageTemplate: options.messageTemplate,\n                    filesLayoutMode: options.filesLayoutMode\n                }));\n\n                ctx.list.append(typingGroupElement);\n            }\n        });\n    }\n}\n","import { DomUtilsService } from \"../../../core/services/dom-utils.service\";\nimport { HtmlService } from \"../../../core/services/html.service\";\nimport { NS, STYLES, REFERENCES, ICONS, SCROLL_TO_BOTTOM_THRESHOLD, CLICK, SCROLL, DOT } from \"../../constants\";\nimport type { IChatOptions } from \"../../models\";\nimport type { IKendoJQuery } from \"../../../core\";\n\ndeclare const kendo: any;\ndeclare const $: any;\n\nexport interface IScrollManagerContext {\n    element: IKendoJQuery;\n    options: IChatOptions;\n    list: IKendoJQuery;\n    domUtilsService: DomUtilsService;\n    htmlService: HtmlService;\n}\n\nexport class ScrollManager {\n    private context: IScrollManagerContext;\n    private scrollToBottomButton: IKendoJQuery | null = null;\n    private _scrollHandler: (() => void) | null = null;\n    private _clickHandler: ((e: any) => void) | null = null;\n\n    constructor(context: IScrollManagerContext) {\n        this.context = context;\n        this._initScrollToBottomButton();\n        this._attachEvents();\n    }\n\n    private _initScrollToBottomButton(): void {\n        const options = this.context.options;\n\n        if (options.scrollToBottomButton === false) {\n            this.scrollToBottomButton = null;\n            return;\n        }\n\n        const buttonHtml = kendo.html.renderButton(\n            `<button class=\"${STYLES.scrollFab} ${STYLES.hidden}\" ${REFERENCES.scrollToBottomButton} aria-label=\"Scroll to bottom\"></button>`,\n            {\n                icon: ICONS.arrowDown,\n                rounded: \"full\"\n            }\n        );\n\n        this.scrollToBottomButton = $(buttonHtml).appendTo(this.context.element);\n        const cssStyles = {\n            position: \"sticky\",\n            bottom: \"16px\",\n            transform: \"translateX(-50%)\",\n            zIndex: 1\n        }\n\n        const isContextElementRtl = this.context.element.css(\"direction\") === \"rtl\";\n        cssStyles[isContextElementRtl ? \"right\" : \"left\"] = \"50%\";\n\n        this.scrollToBottomButton.css(cssStyles);\n    }\n\n    private _attachEvents(): void {\n        this._scrollHandler = this._onScroll.bind(this);\n        this._clickHandler = this._scrollToBottomButtonClick.bind(this);\n\n        this.context.element\n            .on(SCROLL + NS + \".scrollManager\", this._scrollHandler)\n            .on(CLICK + NS + \".scrollManager\", `[${REFERENCES.scrollToBottomButton}]`, this._clickHandler);\n    }\n\n    private _updateScrollToBottomButtonVisibility(): void {\n        if (!this.scrollToBottomButton) {\n            return;\n        }\n\n        const scrollTop = this.context.element.scrollTop() || 0;\n        const scrollHeight = this.context.element.prop(\"scrollHeight\") || 0;\n        const clientHeight = this.context.element.prop(\"clientHeight\") || 0;\n        const distanceFromBottom = scrollHeight - scrollTop - clientHeight;\n\n        if (distanceFromBottom > SCROLL_TO_BOTTOM_THRESHOLD) {\n            this.scrollToBottomButton.removeClass(STYLES.hidden);\n        } else {\n            this.scrollToBottomButton.addClass(STYLES.hidden);\n        }\n    }\n\n    private _onScroll(): void {\n        this._updateScrollToBottomButtonVisibility();\n    }\n\n    private _scrollToBottomButtonClick(e: any): void {\n        e.preventDefault();\n        this.scrollToBottom();\n    }\n\n    scrollToBottom(): void {\n        this.context.element.scrollTop(this.context.element.prop(\"scrollHeight\"));\n    }\n\n    scrollToMessage(uid: string): boolean {\n        if (!uid) {\n            return false;\n        }\n\n        const messageElement = this.context.list.find(DOT + STYLES.message + `[data-uid=\"${this.context.htmlService.encode(uid)}\"]`);\n\n        if (!messageElement.length) {\n            return false;\n        }\n\n        const pinnedElement = this.context.element.find(DOT + STYLES.messagePinned);\n        const pinnedHeight = pinnedElement.length ? pinnedElement.outerHeight() || 0 : 0;\n\n        return this.context.domUtilsService.scrollToElement(this.context.element, messageElement, { position: \"top\", offset: -pinnedHeight });\n    }\n\n    destroy(): void {\n        if (this.scrollToBottomButton) {\n            this.scrollToBottomButton.remove();\n            this.scrollToBottomButton = null;\n        }\n\n        this.context.element.off(NS + \".scrollManager\");\n    }\n}\n","import { STYLES, DOT, REFERENCES, SUGGESTED_ACTIONS_LAYOUT_MODE } from \"../../constants\";\nimport { wrapSuggestionsWithLayout } from \"../../templates\";\nimport type { IChatOptions } from \"../../models\";\nimport type { DataManager } from \"../data-manager.collaborator\";\nimport type { IKendoJQuery } from \"../../../core\";\n\nexport interface ISuggestionRendererContext {\n    list: IKendoJQuery;\n    options: IChatOptions;\n    dataManager: DataManager;\n}\n\nexport class SuggestionRenderer {\n    private context: ISuggestionRendererContext;\n\n    constructor(context: ISuggestionRendererContext) {\n        this.context = context;\n    }\n\n    renderSuggestedActions(): void {\n        const options = this.context.options;\n        const lastMessage = this.context.dataManager.getLastMessage();\n        const lastSuggestedActions = lastMessage?.suggestedActions || [];\n        const suggestedActionsElement = options.suggestedActionsTemplate(lastSuggestedActions);\n        const layoutMode = this._getSuggestedActionsLayoutMode(options);\n        const suggestedActionsWrapper = wrapSuggestionsWithLayout(suggestedActionsElement, layoutMode, options.dir === \"rtl\");\n\n        this.removeSuggestedActions();\n\n        this.context.list.append(lastSuggestedActions.length ? suggestedActionsWrapper : \"\");\n        this.context.list.find(`[${REFERENCES.leftScrollButton}]`).addClass(STYLES.disabled);\n    }\n\n    removeSuggestedActions(): void {\n        this.context.list.find(DOT + STYLES.suggestionGroup).remove();\n        this.context.list.find(DOT + STYLES.suggestionScrollWrap).remove();\n    }\n\n    private _getSuggestedActionsLayoutMode(options: IChatOptions): typeof SUGGESTED_ACTIONS_LAYOUT_MODE[keyof typeof SUGGESTED_ACTIONS_LAYOUT_MODE] {\n        if (options.suggestedActionsLayoutMode) {\n            return options.suggestedActionsLayoutMode;\n        }\n        if (options.suggestedActionsScrollable) {\n            return SUGGESTED_ACTIONS_LAYOUT_MODE.SCROLLBUTTONS;\n        }\n        return SUGGESTED_ACTIONS_LAYOUT_MODE.SCROLL;\n    }\n}\n","import \"../../kendo.icons.js\";\nimport \"../../kendo.dropdownbutton.js\";\nimport \"../../kendo.button.js\";\nimport { Widget } from \"../../core/base/widget\";\nimport type { DomUtilsService } from \"../../core/services/dom-utils.service\";\nimport type { HtmlService } from \"../../core/services/html.service\";\nimport type { DateParserService } from \"../../core/services/date-parser.service\";\nimport { DragToScrollHandler } from \"../../core/models/dom-utils\";\nimport { NS, STYLES, REFERENCES, ICONS, SCROLLING_DELTA, CLICK, DOT, RTL, EVENTS } from \"../constants\";\nimport type { IChatOptions, IMessage } from \"../models\";\nimport type { DataManager } from \"./data-manager.collaborator.js\";\nimport { MessageToolbar } from \"./message-toolbar.collaborator.js\";\nimport { FileMenu } from \"./file-menu.collaborator.js\";\nimport { IKendoJQueryStatic, IKendoJQuery } from \"../../core\";\nimport { MessageRenderer, ScrollManager, SuggestionRenderer } from \"./chat-view\";\n\ndeclare const kendo: any;\ndeclare const $: IKendoJQueryStatic;\n\nexport interface IChatViewContext {\n    dataManager: DataManager;\n    domUtilsService: DomUtilsService;\n    htmlService: HtmlService;\n    dateParserService: DateParserService;\n}\n\nexport class ChatView extends Widget {\n    static options = {\n        name: \"ChatView\"\n    };\n\n    private context: IChatViewContext;\n    private list!: IKendoJQuery;\n    private _dragHandler: DragToScrollHandler | null = null;\n    private _messageRenderer!: MessageRenderer;\n    private _scrollManager!: ScrollManager;\n    private _suggestionRenderer!: SuggestionRenderer;\n\n    constructor(\n        element: IKendoJQuery,\n        options: Partial<IChatOptions>,\n        context: IChatViewContext\n    ) {\n        super(element, $.extend(true, {}, ChatView.options, options));\n\n        this.context = context;\n        this._initList();\n        this._initHelpers();\n        this._attachEvents();\n    }\n\n    events: string[] = [\n        EVENTS.suggestedActionClick,\n        EVENTS.messageToolbarExecute,\n        EVENTS.fileMenuExecute,\n        EVENTS.downloadAllFiles,\n        EVENTS.expandableToggle,\n        EVENTS.resendMessage\n    ];\n\n    private _initList(): void {\n        const messages = (this.options as IChatOptions).messages;\n\n        this.element\n            .addClass(STYLES.viewWrapper)\n            .attr(\"role\", \"log\")\n            .attr(\"aria-label\", messages.messageListLabel);\n\n        this.list = $(\"<div>\")\n            .addClass(STYLES.messageListContent)\n            .appendTo(this.element);\n    }\n\n    private _initHelpers(): void {\n        const options = this.options as IChatOptions;\n\n        this._messageRenderer = new MessageRenderer({\n            list: this.list,\n            options,\n            dataManager: this.context.dataManager,\n            htmlService: this.context.htmlService,\n            dateParserService: this.context.dateParserService,\n            dataItem: this.dataItem.bind(this),\n            getReplyMessage: this.getReplyMessage.bind(this),\n            initMessageToolbar: this._initMessageToolbar.bind(this),\n            initFileMenus: this._initFileMenus.bind(this)\n        });\n\n        this._scrollManager = new ScrollManager({\n            element: this.element,\n            options,\n            list: this.list,\n            domUtilsService: this.context.domUtilsService,\n            htmlService: this.context.htmlService\n        });\n\n        this._suggestionRenderer = new SuggestionRenderer({\n            list: this.list,\n            options,\n            dataManager: this.context.dataManager\n        });\n    }\n\n    private _attachEvents(): void {\n        this.element\n            .on(CLICK + NS, this._listClick.bind(this))\n            .on(CLICK + NS, DOT + STYLES.message, this._messageClick.bind(this))\n            .on(CLICK + NS, DOT + STYLES.suggestion, this._suggestionClick.bind(this))\n            .on(CLICK + NS, `[${REFERENCES.leftScrollButton}]`, this._leftScrollButtonClick.bind(this))\n            .on(CLICK + NS, `[${REFERENCES.rightScrollButton}]`, this._rightScrollButtonClick.bind(this))\n            .on(CLICK + NS, DOT + STYLES.downloadButton, this._downloadAllClick.bind(this))\n            .on(CLICK + NS, `[${REFERENCES.retryButton}]`, this._retryButtonClick.bind(this));\n\n        this._attachDragToScrollEvents();\n    }\n\n    private _attachDragToScrollEvents(): void {\n        this._dragHandler = this.context.domUtilsService.createDragToScrollHandler(\n            this.element,\n            {\n                namespace: NS + \".chatViewDrag\",\n                captureElement: this.element,\n                delegateSelector: DOT + STYLES.suggestionsScroll\n            }\n        );\n        this._dragHandler.attach();\n    }\n\n    private _retryButtonClick(e: any): void {\n        e.preventDefault();\n        e.stopPropagation();\n        const button = $(e.currentTarget);\n        const uid = button.attr(\"data-uid\");\n        const messageElement = button.closest(DOT + STYLES.message) as IKendoJQuery;\n        const message = this._getMessageFromElement(messageElement);\n\n        this.trigger(EVENTS.resendMessage, { message, uid });\n    }\n\n    private _getMessageFromElement(element: IKendoJQuery): IMessage | null {\n        const uid = element.attr(\"data-uid\");\n        if (!uid) {\n            return null;\n        }\n        const options = this.options as IChatOptions;\n        const messages = options.dataSource?.data() || [];\n        return messages.find((m: any) => m.uid === uid) || { uid };\n    }\n\n    renderMessage(message: IMessage): void {\n        this._messageRenderer.renderMessage(message);\n    }\n\n    _initMessageToolbar(element: IKendoJQuery): void {\n        const options = this.options as IChatOptions;\n        const messageToolbarActions = options.messageToolbarActions;\n\n        if (!messageToolbarActions || !messageToolbarActions.length || !element.length) {\n            element.remove();\n            return;\n        }\n\n        const messageToolbar = new MessageToolbar(element, {\n            items: messageToolbarActions,\n            dir: options.dir,\n            messages: options.messages,\n            resizable: false\n        });\n\n        messageToolbar.bind(\"execute\", (e: any) => this.trigger(EVENTS.messageToolbarExecute, e));\n    }\n\n    _initFileMenus(element: IKendoJQuery): void {\n        const options = this.options as IChatOptions;\n        const fileActions = options.fileActions;\n        const fileMenuButtons = element.find(`[${REFERENCES.fileMenuButton}]`);\n\n        if (!fileActions || !fileActions.length || !element.length) {\n            fileMenuButtons.remove();\n            return;\n        }\n\n        fileMenuButtons.each((_i: number, el: HTMLElement) => {\n            const $el = $(el);\n            if (!$el.data(\"kendoDropDownButton\")) {\n                const menu = new FileMenu($el, { items: fileActions });\n                menu.bind(\"execute\", (e: any) => this.trigger(EVENTS.fileMenuExecute, e));\n            }\n        });\n    }\n\n    dataItem(message: IKendoJQuery): IMessage | null {\n        const uid = message && message.data(\"uid\");\n        if (uid) {\n            return this.context.dataManager.getMessageByUid(uid);\n        }\n        return null;\n    }\n\n    fileDataItem(message: IMessage, file: IKendoJQuery): any {\n        const uid = file && file.data(\"uid\");\n        if (uid) {\n            return this.context.dataManager.getFileByUid(message, uid);\n        }\n        return null;\n    }\n\n    getReplyMessage(message: IMessage): IMessage | null {\n        if (!message?.replyToId) {\n            return null;\n        }\n\n        const replyMessage = this.context.dataManager.getMessageById(message.replyToId);\n        if (replyMessage) {\n            (replyMessage as any).isOwnMessage = replyMessage.authorId === (this.options as IChatOptions).authorId;\n        }\n\n        return replyMessage;\n    }\n\n    renderSuggestedActions(): void {\n        this._suggestionRenderer.renderSuggestedActions();\n    }\n\n    clearMessages(): void {\n        this.list.find(DOT + STYLES.messageGroup).remove();\n        this.list.find(DOT + STYLES.timestamp).remove();\n        this._suggestionRenderer.removeSuggestedActions();\n    }\n\n    removeMessage(uid: string): boolean {\n        const messageElement = this.list.find(DOT + STYLES.message + `[data-uid=\"${this.context.htmlService.encode(uid)}\"]`);\n\n        if (!messageElement.length) {\n            return false;\n        }\n\n        const messageGroup = messageElement.closest(DOT + STYLES.messageGroup);\n        const messagesInGroup = messageGroup.find(DOT + STYLES.message);\n\n        if (messagesInGroup.length === 1) {\n            messageGroup.remove();\n        } else {\n            messageElement.remove();\n        }\n\n        return true;\n    }\n\n    scrollToBottom(): void {\n        this._scrollManager.scrollToBottom();\n    }\n\n    scrollToMessage(uid: string): boolean {\n        return this._scrollManager.scrollToMessage(uid);\n    }\n\n    refreshDataManager(dataManager: DataManager): void {\n        this.context.dataManager = dataManager;\n    }\n\n    showNoData(html: string): void {\n        this.list.html(html);\n    }\n\n    hasMessages(): boolean {\n        return this.list.children(DOT + STYLES.messageGroup).length > 0;\n    }\n\n    private _listClick(e: any): void {\n        const targetElement = $(e.target);\n\n        if (targetElement.hasClass(STYLES.message) || targetElement.parents(DOT + STYLES.message).length) {\n            return;\n        }\n\n        this._clearSelection(targetElement);\n    }\n\n    private _suggestionClick(e: any): void {\n        const suggestionElement = $(e.currentTarget);\n\n        if (suggestionElement.length) {\n            this.trigger(EVENTS.suggestedActionClick, { text: suggestionElement.text() });\n        }\n    }\n\n    private _messageClick(e: any): void {\n        const target = $(e.target);\n        const expandIcon = target.closest(`[${REFERENCES.bubbleExpandableIndicator}]`);\n\n        if (this._allowMessageClick(target)) {\n            return;\n        }\n\n        this._clearSelection(target);\n\n        if (expandIcon.length) {\n            const bubble = expandIcon.closest(DOT + STYLES.bubble);\n            const isExpanded = bubble.hasClass(STYLES.expanded);\n\n            bubble.toggleClass(STYLES.expanded, !isExpanded);\n            expandIcon.html(kendo.ui.icon({ icon: isExpanded ? ICONS.chevronDown : ICONS.chevronUp }));\n\n            this.trigger(EVENTS.expandableToggle, { indicator: expandIcon, isExpanded: !isExpanded });\n            return;\n        }\n\n        const messageElement = $(e.currentTarget);\n        const bubble = messageElement.find(DOT + STYLES.bubble);\n        bubble.addClass(STYLES.selected);\n    }\n\n    private _allowMessageClick(target: IKendoJQuery): boolean {\n        const disallowedSelectors = [\n            `[${REFERENCES.fileMenuButton}]`,\n            DOT + STYLES.messageToolbar,\n            DOT + STYLES.typingIndicator,\n            DOT + STYLES.downloadButton\n        ].join(\", \");\n\n        return target.closest(disallowedSelectors).length > 0 ||\n            target.children(disallowedSelectors).length > 0 ||\n            target.is(disallowedSelectors);\n    }\n\n    private _clearSelection(target: IKendoJQuery): void {\n        const selectedMessages = this.element.find(DOT + STYLES.selected);\n\n        if (target.closest(`[${REFERENCES.bubbleExpandableIndicator}]`).length) {\n            return;\n        }\n\n        selectedMessages.each((_index: number, element: HTMLElement) => {\n            const bubble = $(element);\n            bubble.removeClass(STYLES.selected);\n        });\n    }\n\n    private _leftScrollButtonClick(e: any): void {\n        e.preventDefault();\n        const button = $(e.currentTarget);\n        const scrollableElement = this.element.find(`${DOT}${STYLES.suggestionsScroll}`);\n        const isRtl = (this.options as IChatOptions).dir === RTL;\n\n        const position = this.context.domUtilsService.scrollByDelta(scrollableElement, isRtl ? SCROLLING_DELTA : -SCROLLING_DELTA);\n\n        this.element.find(`[${REFERENCES.rightScrollButton}]`).removeClass(STYLES.disabled);\n\n        if (position.atStart) {\n            button.addClass(STYLES.disabled);\n        }\n    }\n\n    private _rightScrollButtonClick(e: any): void {\n        e.preventDefault();\n        const button = $(e.currentTarget);\n        const scrollableElement = this.element.find(`${DOT}${STYLES.suggestionsScroll}`);\n        const isRtl = (this.options as IChatOptions).dir === RTL;\n\n        const position = this.context.domUtilsService.scrollByDelta(scrollableElement, isRtl ? -SCROLLING_DELTA : SCROLLING_DELTA);\n\n        this.element.find(`[${REFERENCES.leftScrollButton}]`).removeClass(STYLES.disabled);\n\n        if (position.atEnd) {\n            button.addClass(STYLES.disabled);\n        }\n    }\n\n    private _downloadAllClick(e: any): void {\n        const downloadButton = $(e.currentTarget);\n        const message = downloadButton.closest(DOT + STYLES.message);\n\n        if (message.length) {\n            this.trigger(EVENTS.downloadAllFiles, { messageElement: message });\n        }\n    }\n\n    destroy(): void {\n        super.destroy();\n\n        this._scrollManager.destroy();\n\n        if (this._dragHandler) {\n            this._dragHandler.destroy();\n        }\n\n        this.element.find(\"[data-role='button']\").each(function() {\n            const fileMenu = $(this).data(\"kendoChatFileMenu\");\n            if (fileMenu) {\n                fileMenu.destroy();\n            }\n        });\n\n        this.element.empty();\n        this.element.off(NS);\n\n        (this as any).list = null;\n    }\n}\n","/**\n * PromptBox component constants\n *\n * This module contains all constants used throughout the PromptBox widget.\n */\n\n/** Namespace for event binding */\nexport const NS = \".kendoPromptBox\";\n\n/** Line mode options */\nexport const LINE_MODE = {\n    SINGLE: \"single\",\n    MULTI: \"multi\",\n    AUTO: \"auto\"\n} as const;\n\n/** Icon identifiers used in the PromptBox component */\nexport const ICONS = {\n    send: \"paper-plane\",\n    stop: \"stop-sm\",\n    attachment: \"paperclip-outline-alt-right\"\n} as const;\n\n/** CSS class names used in the PromptBox component */\nexport const STYLES = {\n    // Core structure (matching kendo-themes)\n    promptBox: \"k-prompt-box\",\n    promptBoxContent: \"k-prompt-box-content\",\n    promptBoxHeader: \"k-prompt-box-header\",\n    promptBoxAffix: \"k-prompt-box-affix\",\n    promptBoxTextarea: \"k-prompt-box-textarea\",\n    promptBoxInput: \"k-prompt-box-input\",\n    promptBoxSingleline: \"k-prompt-box-singleline\",\n    promptBoxMultiline: \"k-prompt-box-multiline\",\n\n    // Input base class\n    input: \"k-input\",\n    inputInner: \"k-input-inner\",\n\n    // State classes\n    disabled: \"k-disabled\",\n    hidden: \"k-hidden\",\n    focus: \"k-focus\",\n    generating: \"k-generating\",\n    active: \"k-active\",\n\n    // Button reference classes (semantic identifiers)\n    speechToTextButton: \"k-speech-to-text-button\",\n    fileSelectButton: \"k-file-select-button\",\n\n    // File attachments (in header)\n    fileBoxWrapper: \"k-file-box-wrapper\",\n    fileBoxWrapperScrollableStart: \"k-file-box-wrapper-scrollable-start\",\n    filesScroll: \"k-files-scroll\",\n    fileBox: \"k-file-box\",\n    fileInfo: \"k-file-info\",\n    fileName: \"k-file-name\",\n    fileSize: \"k-file-size\",\n\n    // Layout\n    spacer: \"k-spacer\"\n} as const;\n\n/** Attribute references for element selection (used as [ref-*] selectors) */\nexport const REFERENCES = {\n    sendButton: \"ref-promptbox-send-button\",\n    fileSelectButton: \"ref-promptbox-file-select-button\",\n    fileInput: \"ref-promptbox-file-input\",\n    attachmentsHost: \"ref-promptbox-attachments-host\",\n    attachmentRemoveButton: \"ref-promptbox-attachment-remove-button\",\n    input: \"ref-promptbox-input\",\n    header: \"ref-promptbox-header\",\n    startAffix: \"ref-promptbox-start-affix\",\n    endAffix: \"ref-promptbox-end-affix\",\n    topAffix: \"ref-promptbox-top-affix\",\n    affixSpacer: \"ref-promptbox-affix-spacer\"\n} as const;\n\n/** Event names triggered by the PromptBox component */\nexport const EVENTS = {\n    valueChange: \"valueChange\",\n    input: \"input\",\n    promptAction: \"promptAction\",\n    fileSelect: \"fileSelect\",\n    fileRemove: \"fileRemove\",\n    speechToTextClick: \"speechToTextClick\",\n    speechToTextStart: \"speechToTextStart\",\n    speechToTextEnd: \"speechToTextEnd\",\n    speechToTextError: \"speechToTextError\",\n    speechToTextResult: \"speechToTextResult\",\n    focus: \"focus\",\n    blur: \"blur\",\n    inputFocus: \"inputFocus\",\n    inputBlur: \"inputBlur\",\n    multilineStateChange: \"multilineStateChange\"\n} as const;\n\n/** Common DOM event names */\nexport const CLICK = \"click\";\nexport const INPUT = \"input\";\nexport const KEYDOWN = \"keydown\";\nexport const FOCUS = \"focus\";\nexport const BLUR = \"blur\";\nexport const CHANGE = \"change\";\nexport const FOCUSIN = \"focusin\";\nexport const FOCUSOUT = \"focusout\";\n\n/** CSS selector prefix */\nexport const DOT = \".\";\n\n// Type exports for const objects\nexport type ModeValue = typeof LINE_MODE[keyof typeof LINE_MODE];\nexport type IconName = typeof ICONS[keyof typeof ICONS];\nexport type StyleClass = typeof STYLES[keyof typeof STYLES];\nexport type ReferenceAttr = typeof REFERENCES[keyof typeof REFERENCES];\nexport type EventName = typeof EVENTS[keyof typeof EVENTS];\n","import \"../../kendo.icons.js\";\nimport \"../../kendo.html.button.js\";\nimport { STYLES, REFERENCES, ICONS } from \"../constants\";\nimport type { IPromptBoxMessages, IActionButtonSettings, IFileSelectButtonSettings, ISpeechToTextButtonSettings } from \"../models\";\nimport type { ModeValue } from \"../constants\";\nimport { LINE_MODE } from \"../constants\";\n\ndeclare const kendo: any;\n\n/**\n * Renders the PromptBox header section.\n * Returns empty string when no headerTemplate (header is created dynamically when needed).\n */\nexport const renderHeader = (\n    headerTemplate: (() => string) | null,\n    forceRender: boolean = false\n): string => {\n    let content = \"\";\n    if (headerTemplate) {\n        content = headerTemplate();\n    }\n\n    if (!content && !forceRender) {\n        return \"\";\n    }\n\n    const hiddenClass = content ? \"\" : ` ${STYLES.hidden}`;\n    return `<div class=\"${STYLES.promptBoxHeader}${hiddenClass}\" ${REFERENCES.header}><div ${REFERENCES.attachmentsHost}></div>${content}</div>`;\n};\n\n/**\n * Renders a template function.\n */\nconst renderTemplate = (template: (() => string) | null | undefined): string => {\n    if (!template) {\n        return \"\";\n    }\n    return template();\n};\n\n/**\n * Renders the send button using kendo.html.renderButton.\n */\nexport const renderSendButton = (\n    messages: IPromptBoxMessages,\n    enable: boolean = true,\n    settings?: IActionButtonSettings\n): string => {\n    const disabledClass = !enable ? ` ${STYLES.disabled}` : \"\";\n    const ariaDisabled = !enable ? ' aria-disabled=\"true\"' : '';\n\n    const buttonOptions: Record<string, any> = {\n        icon: settings?.icon || \"arrow-up-outline\",\n        size: settings?.size || \"small\",\n        rounded: settings?.rounded || \"full\"\n    };\n\n    if (settings?.fillMode) {\n        buttonOptions.fillMode = settings.fillMode;\n    }\n    if (settings?.themeColor) {\n        buttonOptions.themeColor = settings.themeColor;\n    }\n\n    return kendo.html.renderButton(\n        `<button title=\"${messages.actionButton}\" aria-label=\"${messages.actionButton}\" aria-live=\"polite\" class=\"${disabledClass}\"${ariaDisabled} ${REFERENCES.sendButton} type=\"button\"></button>`,\n        buttonOptions\n    );\n};\n\n/**\n * Renders the file select button and hidden file input using kendo.html.renderButton.\n */\nexport const renderFileSelectButton = (\n    fileInputId: string,\n    accept?: string,\n    multiple?: boolean,\n    settings?: IFileSelectButtonSettings,\n    enable: boolean = true,\n    messages?: IPromptBoxMessages\n): string => {\n    const multipleAttr = multiple ? ' multiple' : '';\n    const acceptAttr = accept ? ` accept=\"${accept}\"` : '';\n    const disabledAttr = !enable ? ' disabled' : '';\n    const ariaDisabledAttr = !enable ? ' aria-disabled=\"true\"' : '';\n    const disabledClass = !enable ? ` ${STYLES.disabled}` : '';\n    const buttonTitle = settings?.text || messages?.fileSelectButton || \"Attach file\";\n\n    const buttonOptions: Record<string, any> = {\n        icon: settings?.icon || ICONS.attachment,\n        fillMode: settings?.fillMode || \"clear\"\n    };\n\n    if (settings?.size) {\n        buttonOptions.size = settings.size;\n    }\n    if (settings?.rounded) {\n        buttonOptions.rounded = settings.rounded;\n    }\n    if (settings?.themeColor) {\n        buttonOptions.themeColor = settings.themeColor;\n    }\n\n    const button = kendo.html.renderButton(\n        `<button title=\"${buttonTitle}\" aria-label=\"${buttonTitle}\" class=\"${disabledClass}\" ${REFERENCES.fileSelectButton} type=\"button\"${disabledAttr}${ariaDisabledAttr}></button>`,\n        buttonOptions\n    );\n\n    return `${button}<input type=\"file\" id=\"${fileInputId}\" class=\"${STYLES.hidden}\" ${REFERENCES.fileInput}${multipleAttr}${acceptAttr} />`;\n};\n\n/**\n * Renders the speech-to-text button placeholder.\n * The actual icon is rendered by the SpeechToTextButton component.\n */\nexport const renderSpeechToTextButton = (settings?: ISpeechToTextButtonSettings): string => {\n    return `<button class=\"${STYLES.speechToTextButton}\" type=\"button\"></button>`;\n};\n\n/**\n * Affix configuration for rendering.\n */\nexport interface IAffixConfig {\n    startAffixTemplate?: (() => string) | null;\n    endAffixTemplate?: (() => string) | null;\n    topAffixTemplate?: (() => string) | null;\n}\n\n/**\n * File select button configuration for rendering.\n */\nexport interface IFileSelectButtonConfig {\n    enable?: boolean;\n    fileInputId: string;\n    accept?: string;\n    multiple?: boolean;\n    showSpacer?: boolean;\n    settings?: IFileSelectButtonSettings;\n}\n\n/**\n * Button settings configuration for rendering.\n */\nexport interface IButtonSettingsConfig {\n    actionButtonSettings?: IActionButtonSettings;\n    fileSelectButtonSettings?: IFileSelectButtonSettings;\n    speechToTextButtonSettings?: ISpeechToTextButtonSettings;\n}\n\n/**\n * Combined rendering configuration.\n */\nexport interface IRenderConfig {\n    affixConfig?: IAffixConfig;\n    fileSelectButtonConfig?: IFileSelectButtonConfig;\n    buttonSettingsConfig?: IButtonSettingsConfig;\n}\n\n/**\n * Renders the start affix container (before the input).\n * Uses k-prompt-box-affix class; position is determined by DOM order.\n */\nexport const renderStartAffix = (\n    startAffixTemplate: (() => string) | null | undefined\n): string => {\n    const content = renderTemplate(startAffixTemplate);\n    if (!content) {\n        return \"\";\n    }\n    return `<div class=\"${STYLES.promptBoxAffix}\" ${REFERENCES.startAffix}>${content}</div>`;\n};\n\n/**\n * Renders the end affix container with buttons (after the input).\n * Returns empty string when no content.\n */\nexport const renderEndAffix = (\n    messages: IPromptBoxMessages,\n    showSendButton: boolean,\n    showSpeechToText: boolean = true,\n    endAffixTemplate?: (() => string) | null,\n    fileSelectButtonConfig?: IFileSelectButtonConfig,\n    buttonSettingsConfig?: IButtonSettingsConfig\n): string => {\n    const endAffix = renderTemplate(endAffixTemplate);\n    const fileSelectButtonEnabled = fileSelectButtonConfig?.enable !== false;\n    const fileSelectButton = fileSelectButtonConfig\n        ? renderFileSelectButton(fileSelectButtonConfig.fileInputId, fileSelectButtonConfig.accept, fileSelectButtonConfig.multiple, fileSelectButtonConfig.settings, fileSelectButtonEnabled, messages)\n        : \"\";\n    const spacer = fileSelectButtonConfig?.showSpacer ? `<div class=\"${STYLES.spacer}\"></div>` : \"\";\n    const speechButton = showSpeechToText ? renderSpeechToTextButton(buttonSettingsConfig?.speechToTextButtonSettings) : \"\";\n    const sendButton = showSendButton ? renderSendButton(messages, true, buttonSettingsConfig?.actionButtonSettings) : \"\";\n\n    const content = `${endAffix}${fileSelectButton}${spacer}${speechButton}${sendButton}`.trim();\n    if (!content) {\n        return \"\";\n    }\n\n    return `<div class=\"${STYLES.promptBoxAffix}\" ${REFERENCES.endAffix}>\n        ${endAffix}\n        ${fileSelectButton}\n        ${spacer}\n        ${speechButton}\n        ${sendButton}\n    </div>`;\n};\n\n/**\n * Renders the end affix container with start affix content (for multi mode).\n * In multi mode: fileSelectButton + startAffix content + spacer + endAffix content + buttons\n * The spacer is only rendered if there's content on both sides to separate.\n */\nexport const renderEndAffixWithStartAffix = (\n    messages: IPromptBoxMessages,\n    showSendButton: boolean,\n    showSpeechToText: boolean = true,\n    startAffixTemplate?: (() => string) | null,\n    endAffixTemplate?: (() => string) | null,\n    fileSelectButtonConfig?: IFileSelectButtonConfig,\n    buttonSettingsConfig?: IButtonSettingsConfig\n): string => {\n    const startAffix = renderTemplate(startAffixTemplate);\n    const endAffix = renderTemplate(endAffixTemplate);\n    const fileSelectButtonEnabled = fileSelectButtonConfig?.enable !== false;\n    const fileSelectButton = fileSelectButtonConfig\n        ? renderFileSelectButton(fileSelectButtonConfig.fileInputId, fileSelectButtonConfig.accept, fileSelectButtonConfig.multiple, fileSelectButtonConfig.settings, fileSelectButtonEnabled, messages)\n        : \"\";\n    const speechButton = showSpeechToText ? renderSpeechToTextButton(buttonSettingsConfig?.speechToTextButtonSettings) : \"\";\n    const sendButton = showSendButton ? renderSendButton(messages, true, buttonSettingsConfig?.actionButtonSettings) : \"\";\n\n    const spacer = `<div class=\"${STYLES.spacer}\"></div>`;\n\n    if (!fileSelectButtonConfig?.showSpacer) {\n         return `<div class=\"${STYLES.promptBoxAffix}\" ${REFERENCES.endAffix}>\n            ${startAffix}\n            ${spacer}\n            ${endAffix}\n            ${fileSelectButton}\n            ${speechButton}\n            ${sendButton}\n        </div>`;\n    }\n\n    return `<div class=\"${STYLES.promptBoxAffix}\" ${REFERENCES.endAffix}>\n        ${fileSelectButton}\n        ${startAffix}\n        ${spacer}\n        ${endAffix}\n        ${speechButton}\n        ${sendButton}\n    </div>`;\n};\n\n/**\n * Renders the top affix section (only for multi mode).\n * Note: This is placed at the beginning of content for multi-mode layout.\n */\nexport const renderTopAffix = (\n    topAffixTemplate: (() => string) | null | undefined\n): string => {\n    const content = renderTemplate(topAffixTemplate);\n    if (!content) {\n        return \"\";\n    }\n    return `<div class=\"${STYLES.promptBoxAffix}\" ${REFERENCES.topAffix}>${content}</div>`;\n};\n\n/**\n * Renders the complete PromptBox structure.\n * For multi mode: startAffix content is rendered inside the end affix container with a spacer.\n * For auto mode: startAffix is rendered as a separate container (JS handles reorganization on expand).\n */\nexport const renderPromptBox = (\n    headerTemplate: (() => string) | null,\n    messages: IPromptBoxMessages,\n    showSendButton: boolean,\n    mode: ModeValue,\n    showSpeechToText: boolean = true,\n    renderConfig: IRenderConfig = {}\n): string => {\n    const { affixConfig = {}, fileSelectButtonConfig, buttonSettingsConfig } = renderConfig;\n    const forceRenderHeader = !!fileSelectButtonConfig;\n    const header = renderHeader(headerTemplate, forceRenderHeader);\n    const topAffix = mode === LINE_MODE.MULTI ? renderTopAffix(affixConfig.topAffixTemplate) : \"\";\n\n    const isMultiMode = mode === LINE_MODE.MULTI;\n\n    const startAffix = isMultiMode ? \"\" : renderStartAffix(affixConfig.startAffixTemplate);\n    const endAffix = isMultiMode\n        ? renderEndAffixWithStartAffix(messages, showSendButton, showSpeechToText, affixConfig.startAffixTemplate, affixConfig.endAffixTemplate, fileSelectButtonConfig, buttonSettingsConfig)\n        : renderEndAffix(messages, showSendButton, showSpeechToText, affixConfig.endAffixTemplate, fileSelectButtonConfig, buttonSettingsConfig);\n\n    return `${header}\n        <div class=\"${STYLES.promptBoxContent}\">\n            ${topAffix}\n            ${startAffix}\n            <span ${REFERENCES.input}></span>\n            ${endAffix}\n        </div>`;\n};\n","import type { IPromptBoxOptions } from \"../models\";\nimport type { IKendoJQuery } from \"../../core\";\n\nexport interface IAccessibilityManagerContext {\n    wrapper: IKendoJQuery;\n    getOptions: () => IPromptBoxOptions;\n    getInputElement: () => JQuery | null;\n}\n\nexport class AccessibilityManager {\n    private context: IAccessibilityManagerContext;\n\n    constructor(context: IAccessibilityManagerContext) {\n        this.context = context;\n    }\n\n    applyInitial(): void {\n        const options = this.context.getOptions();\n        const input = this.context.getInputElement();\n        input.attr(\"aria-label\", options.messages?.messageBoxTitle || \"Message\");\n\n        if (!options.enable) {\n            this.context.wrapper.attr(\"aria-disabled\", \"true\");\n        }\n\n        if (options.readonly) {\n            this.updateInputAccessibility();\n        }\n\n        if (options.loading) {\n            this.context.wrapper.attr(\"aria-busy\", \"true\");\n        }\n    }\n\n    updateInputAccessibility(): void {\n        const options = this.context.getOptions();\n        const input = this.context.getInputElement();\n\n        if (!input) {\n            return;\n        }\n\n        input.attr(\"aria-label\", options.messages?.messageBoxTitle || \"Message\");\n\n        if (options.readonly) {\n            input.attr(\"aria-readonly\", \"true\");\n        } else {\n            input.removeAttr(\"aria-readonly\");\n        }\n\n        if (!options.enable) {\n            input.attr(\"aria-disabled\", \"true\");\n        } else {\n            input.removeAttr(\"aria-disabled\");\n        }\n    }\n\n    updateWrapper(state: { disabled?: boolean; loading?: boolean }): void {\n        if (state.disabled !== undefined) {\n            if (state.disabled) {\n                this.context.wrapper.attr(\"aria-disabled\", \"true\");\n            } else {\n                this.context.wrapper.removeAttr(\"aria-disabled\");\n            }\n        }\n\n        if (state.loading !== undefined) {\n            if (state.loading) {\n                this.context.wrapper.attr(\"aria-busy\", \"true\");\n            } else {\n                this.context.wrapper.removeAttr(\"aria-busy\");\n            }\n        }\n    }\n}\n","import { STYLES, REFERENCES } from \"../constants\";\nimport type { IPromptBoxMessages, IActionButtonSettings } from \"../models\";\nimport type { IKendoJQuery } from \"../../core\";\n\ndeclare const kendo: any;\n\nexport interface IActionButtonManagerContext {\n    wrapper: IKendoJQuery;\n    getMessages: () => IPromptBoxMessages;\n    getSettings: () => IActionButtonSettings | undefined;\n    isDisabled: () => boolean;\n    isLoading: () => boolean;\n    hasContent: () => boolean;\n}\n\nexport class ActionButtonManager {\n    private context: IActionButtonManagerContext;\n\n    constructor(context: IActionButtonManagerContext) {\n        this.context = context;\n    }\n\n    private getSendButton(): JQuery {\n        return this.context.wrapper.find(`[${REFERENCES.sendButton}]`);\n    }\n\n    setLoading(loading: boolean): void {\n        const sendButton = this.getSendButton();\n        const messages = this.context.getMessages();\n        const settings = this.context.getSettings();\n\n        if (loading) {\n            sendButton.addClass(`${STYLES.generating} ${STYLES.active}`);\n            sendButton.attr(\"title\", messages.actionButtonLoading);\n            sendButton.attr(\"aria-label\", messages.actionButtonLoading);\n            const icon = sendButton.find(\".k-icon, .k-svg-icon\");\n            if (icon.length) {\n                const loadingIcon = settings?.loadingIcon || \"stop-sm\";\n                kendo.ui.icon(icon, { icon: loadingIcon });\n            }\n        } else {\n            sendButton.removeClass(`${STYLES.generating} ${STYLES.active}`);\n            sendButton.attr(\"title\", messages.actionButton);\n            sendButton.attr(\"aria-label\", messages.actionButton);\n            const icon = sendButton.find(\".k-icon, .k-svg-icon\");\n            if (icon.length) {\n                const sendIcon = settings?.icon || \"arrow-up-outline\";\n                kendo.ui.icon(icon, { icon: sendIcon });\n            }\n        }\n\n        this.updateState();\n    }\n\n    updateState(): void {\n        const sendButton = this.getSendButton();\n        const isDisabled = this.context.isDisabled();\n\n        if (isDisabled) {\n            sendButton.addClass(STYLES.disabled);\n            sendButton.attr(\"aria-disabled\", \"true\");\n            return;\n        }\n\n        sendButton.removeAttr(\"aria-disabled\");\n\n        if (this.context.isLoading()) {\n            sendButton.removeClass(STYLES.disabled);\n            return;\n        }\n\n        if (this.context.hasContent()) {\n            sendButton.removeClass(STYLES.disabled);\n        } else {\n            sendButton.addClass(STYLES.disabled);\n        }\n    }\n\n    updateMessages(): void {\n        const sendButton = this.getSendButton();\n        const messages = this.context.getMessages();\n\n        if (this.context.isLoading()) {\n            sendButton.attr(\"title\", messages.actionButtonLoading);\n            sendButton.attr(\"aria-label\", messages.actionButtonLoading);\n        } else {\n            sendButton.attr(\"title\", messages.actionButton);\n            sendButton.attr(\"aria-label\", messages.actionButton);\n        }\n    }\n}\n","import { DOT, STYLES } from \"../constants\";\nimport type { ISpeechToTextButtonSettings } from \"../models\";\nimport type { IKendoJQuery } from \"../../core\";\n\ndeclare const kendo: any;\n\nexport interface ISpeechHandlerCallbacks {\n    onStart: (e: any) => void;\n    onEnd: (e: any) => void;\n    onResult: (e: any) => void;\n    onError: (e: any) => void;\n}\n\nexport interface ISpeechHandlerContext {\n    wrapper: IKendoJQuery;\n    getSpeechToTextButtonOption: () => boolean | ISpeechToTextButtonSettings | null;\n    callbacks: ISpeechHandlerCallbacks;\n}\n\nexport class SpeechHandler {\n    private context: ISpeechHandlerContext;\n    private instance: any = null;\n\n    constructor(context: ISpeechHandlerContext) {\n        this.context = context;\n    }\n\n    init(): void {\n        const option = this.context.getSpeechToTextButtonOption();\n\n        if (option === false) {\n            return;\n        }\n\n        const speechToTextButton = this.context.wrapper.find(DOT + STYLES.speechToTextButton);\n        if (!speechToTextButton.length) {\n            return;\n        }\n\n        const defaultSettings: ISpeechToTextButtonSettings = {\n            fillMode: \"flat\",\n            size: \"small\",\n            enable: true\n        };\n\n        const userSettings = typeof option === \"object\" && option !== null ? option : {};\n        const isEnabled = (userSettings as ISpeechToTextButtonSettings).enable !== false;\n\n        const buttonOptions = {\n            ...defaultSettings,\n            ...userSettings,\n            start: (e: any) => this.context.callbacks.onStart(e),\n            end: (e: any) => this.context.callbacks.onEnd(e),\n            result: (e: any) => this.context.callbacks.onResult(e),\n            error: (e: any) => this.context.callbacks.onError(e)\n        };\n\n        this.instance = new kendo.ui.SpeechToTextButton(speechToTextButton, buttonOptions);\n\n        if (!isEnabled) {\n            this.instance.enable(false);\n        }\n    }\n\n    enable(enabled: boolean): void {\n        if (this.instance) {\n            this.instance.enable(enabled);\n        }\n    }\n\n    destroy(): void {\n        if (this.instance) {\n            this.instance.destroy();\n            this.instance = null;\n        }\n    }\n}\n","import { STYLES, REFERENCES, NS } from \"../constants\";\nimport type { IPromptBoxOptions, IFileSelectButtonSettings } from \"../models\";\nimport type { HtmlService } from \"../../core/services/html.service\";\nimport type { UtilsService } from \"../../core/services/utils.service\";\nimport type { FileUtilsService } from \"../../core/services/file-utils.service\";\nimport type { DomUtilsService } from \"../../core/services/dom-utils.service\";\nimport type { DragToScrollHandler } from \"../../core/models/dom-utils\";\nimport type { IKendoJQuery } from \"../../core\";\nimport type { IFile } from \"../../upload\";\n\ndeclare const kendo: any;\n\nexport interface IFileHandlerCallbacks {\n    onFilesChanged: () => void;\n    onFileSelect: (files: IFile[]) => void;\n    onFileRemove: (file: IFile, remainingFiles: IFile[]) => void;\n}\n\nexport interface IFileHandlerContext {\n    wrapper: IKendoJQuery;\n    getOptions: () => IPromptBoxOptions;\n    htmlService: HtmlService;\n    fileUtilsService: FileUtilsService;\n    utilsService: UtilsService;\n    domUtilsService: DomUtilsService;\n    callbacks: IFileHandlerCallbacks;\n}\n\nexport class FileHandler {\n    private context: IFileHandlerContext;\n    private files: IFile[] = [];\n    private uploadInstance?: any;\n    private _dragHandler: DragToScrollHandler | null = null;\n\n    constructor(context: IFileHandlerContext) {\n        this.context = context;\n    }\n\n    initUpload(): void {\n        const options = this.context.getOptions();\n        if (!this.showFileSelectButton(options)) {\n            return;\n        }\n\n        const fileInput = this.context.wrapper.find(`[${REFERENCES.fileInput}]`);\n        if (fileInput.length === 0) {\n            return;\n        }\n\n        const settings = this.getFileSelectButtonSettings(options);\n        const multiple = settings?.multiple !== false;\n\n        const upload = new kendo.ui.Upload(fileInput, {\n            multiple: multiple,\n            async: false,\n            uniqueFileUids: true,\n            select: this.onUploadSelect.bind(this)\n        });\n\n        upload?.wrapper?.addClass(STYLES.hidden);\n        this.uploadInstance = upload;\n    }\n\n    getFiles(): IFile[] {\n        return [...this.files];\n    }\n\n    setFiles(newFiles: IFile[]): void {\n        this.files = [...newFiles];\n        this.renderAttachments();\n        this.context.callbacks.onFilesChanged();\n    }\n\n    clearFiles(): void {\n        this.files = [];\n        this.renderAttachments();\n        this.context.callbacks.onFilesChanged();\n    }\n\n    hasFiles(): boolean {\n        return this.files.length > 0;\n    }\n\n    handleFileSelectClick(): void {\n        const options = this.context.getOptions();\n        const settings = this.getFileSelectButtonSettings(options);\n\n        if (!options.enable || options.readonly || settings?.enable === false) {\n            return;\n        }\n\n        const uploadInput = this.uploadInstance?.element?.[0] || null;\n        const fileInput = uploadInput || this.context.wrapper.find(`[${REFERENCES.fileInput}]`)[0];\n\n        if (fileInput && typeof (fileInput as HTMLInputElement).click === \"function\") {\n            (fileInput as HTMLInputElement).click();\n        }\n    }\n\n    removeAttachmentByUid(uid: string): void {\n        const removedFile = this.files.find(file => this.getFileUid(file) === uid);\n        const newFiles = this.files.filter(file => this.getFileUid(file) !== uid);\n\n        if (newFiles.length === this.files.length) {\n            return;\n        }\n\n        this.files = newFiles;\n        this.renderAttachments();\n        this.context.callbacks.onFilesChanged();\n\n        if (removedFile) {\n            this.context.callbacks.onFileRemove(removedFile, [...this.files]);\n        }\n    }\n\n    renderAttachments(): void {\n        this._destroyDragHandler();\n\n        const header = this.context.wrapper.find(`[${REFERENCES.header}]`);\n        const host = this.context.wrapper.find(`[${REFERENCES.attachmentsHost}]`);\n        if (host.length === 0) {\n            return;\n        }\n\n        if (!this.files.length) {\n            host.empty();\n\n            if (!this.context.getOptions().headerTemplate) {\n                header.addClass(STYLES.hidden);\n            }\n            return;\n        }\n\n        header.removeClass(STYLES.hidden);\n\n        let html = `<ul class=\"${STYLES.fileBoxWrapper} ${STYLES.fileBoxWrapperScrollableStart}\">`;\n        html += `<div class=\"${STYLES.filesScroll}\">`;\n\n        for (let i = 0; i < this.files.length; i++) {\n            const fileObj = this.files[i];\n            const rawFile = fileObj?.rawFile || fileObj;\n            const uid = this.getFileUid(fileObj);\n            const name = rawFile?.name || fileObj?.name || \"\";\n            const size = rawFile?.size || fileObj?.size || 0;\n            const extension = name.lastIndexOf(\".\") > -1 ? name.substring(name.lastIndexOf(\".\")).toLowerCase() : \"\";\n            const iconName = this.context.fileUtilsService.getFileGroup(extension, true);\n            const fileSizeMessage = this.context.fileUtilsService.getFileSizeMessage(size);\n            const icon = kendo.ui.icon({ icon: iconName, size: \"xlarge\" });\n            const removeButton = kendo.html.renderButton(\n                `<button type=\"button\" ${REFERENCES.attachmentRemoveButton} data-uid=\"${this.context.htmlService.encode(uid)}\" aria-label=\"Remove attachment\" title=\"Remove attachment\"></button>`,\n                { icon: \"x-mark-sm-outline\", fillMode: \"flat\" }\n            );\n\n            html += `<li class=\"${STYLES.fileBox}\">`;\n            html += icon;\n            html += `<div class=\"${STYLES.fileInfo}\">`;\n            html += `<span class=\"${STYLES.fileName}\">${this.context.htmlService.encode(name)}</span>`;\n            html += `<span class=\"${STYLES.fileSize}\">${this.context.htmlService.encode(fileSizeMessage)}</span>`;\n            html += `</div>`;\n            html += removeButton;\n            html += `</li>`;\n        }\n\n        html += \"</div></ul>\";\n        host.html(html);\n\n        this._attachDragToScroll();\n    }\n\n    private _attachDragToScroll(): void {\n        const host = this.context.wrapper.find(`[${REFERENCES.attachmentsHost}]`);\n        const scrollContainer = host.find(\".\" + STYLES.filesScroll) as IKendoJQuery;\n        if (!scrollContainer.length) {\n            return;\n        }\n\n        this._dragHandler = this.context.domUtilsService.createDragToScrollHandler(\n            scrollContainer,\n            {\n                namespace: NS + \".promptBoxFileDrag\",\n                captureElement: this.context.wrapper\n            }\n        );\n        this._dragHandler.attach();\n    }\n\n    private _destroyDragHandler(): void {\n        if (this._dragHandler) {\n            this._dragHandler.destroy();\n            this._dragHandler = null;\n        }\n    }\n\n    destroy(): void {\n        this._destroyDragHandler();\n        if (this.uploadInstance) {\n            this.uploadInstance.destroy();\n            this.uploadInstance = null;\n        }\n    }\n\n    private onUploadSelect(e: any): void {\n        e.preventDefault();\n        const files = e.files;\n        const options = this.context.getOptions();\n        const settings = this.getFileSelectButtonSettings(options);\n        const validFiles = this.validateFiles(files, settings);\n\n        if (validFiles.length > 0) {\n            this.files = [...this.files, ...validFiles];\n            this.renderAttachments();\n            this.context.callbacks.onFilesChanged();\n            this.context.callbacks.onFileSelect(validFiles);\n        }\n    }\n\n    private validateFiles(files: IFile[], settings?: IFileSelectButtonSettings): IFile[] {\n        const validFiles: IFile[] = [];\n        const restrictions = settings?.restrictions;\n\n        for (let i = 0; i < files.length; i++) {\n            const fileObj = files[i];\n            const file = fileObj.rawFile || fileObj;\n            let isValid = true;\n\n            if (restrictions) {\n                if (restrictions.allowedExtensions && restrictions.allowedExtensions.length > 0) {\n                    const ext = file.name.split('.').pop()?.toLowerCase() || '';\n                    const allowedExts = restrictions.allowedExtensions.map((e: string) => e.toLowerCase().replace('.', ''));\n                    if (!allowedExts.includes(ext)) {\n                        isValid = false;\n                    }\n                }\n\n                if (restrictions.maxFileSize && file.size > restrictions.maxFileSize) {\n                    isValid = false;\n                }\n\n                if (restrictions.minFileSize && file.size < restrictions.minFileSize) {\n                    isValid = false;\n                }\n            }\n\n            if (isValid) {\n                validFiles.push(fileObj);\n            }\n        }\n\n        return validFiles;\n    }\n\n    private getFileUid(file: IFile): string {\n        if (!file) {\n            return \"\";\n        }\n\n        if (!file.uid) {\n            file.uid = this.context.utilsService.guid();\n        }\n\n        return file.uid;\n    }\n\n    private showFileSelectButton(options: IPromptBoxOptions): boolean {\n        return options.fileSelectButton === true ||\n            (typeof options.fileSelectButton === \"object\" && options.fileSelectButton !== null);\n    }\n\n    private getFileSelectButtonSettings(options: IPromptBoxOptions): IFileSelectButtonSettings | undefined {\n        if (typeof options.fileSelectButton === \"object\" && options.fileSelectButton !== null) {\n            return options.fileSelectButton as IFileSelectButtonSettings;\n        }\n        return undefined;\n    }\n}\n","import { STYLES, REFERENCES, NS, INPUT, KEYDOWN, FOCUS, BLUR, LINE_MODE } from \"../constants\";\nimport type { IPromptBoxOptions, IPromptBoxMessages } from \"../models\";\nimport type { IKendoJQuery } from \"../../core\";\n\ndeclare const $: any;\n\nconst DEFAULT_MESSAGES: IPromptBoxMessages = {\n    placeholder: \"Type a message...\",\n    actionButton: \"Send\",\n    actionButtonLoading: \"Stop\",\n    messageBoxTitle: \"Message\"\n};\n\nexport interface IInputManagerCallbacks {\n    onInput: () => void;\n    onKeyDown: (e: any) => void;\n    onFocus: () => void;\n    onBlur: () => void;\n    onMultilineStateChange: (isMultiline: boolean, wasMultiline: boolean) => void;\n}\n\nexport interface IInputManagerContext {\n    wrapper: IKendoJQuery;\n    getOptions: () => IPromptBoxOptions;\n    getMode: () => string;\n    callbacks: IInputManagerCallbacks;\n}\n\nexport class InputManager {\n    private context: IInputManagerContext;\n    private inputInstance: any = null;\n    private singleRowHeight: number = 0;\n    private singleLineWidth: number = 0;\n    private initialHeight: number = 0;\n    private minMultiRowHeight: number = 0;\n    private multiline: boolean = false;\n\n    constructor(context: IInputManagerContext) {\n        this.context = context;\n    }\n\n    init(): void {\n        const inputContainer = this.context.wrapper.find(`[${REFERENCES.input}]`);\n        const mode = this.context.getMode();\n        const inputElement = this.createInputElement(mode);\n        inputContainer.replaceWith(inputElement);\n\n        const value = this.context.getOptions().value || \"\";\n        if (value) {\n            inputElement.val(value);\n        }\n\n        this.captureInitialDimensions();\n        this.attachInputEvents();\n    }\n\n    getElement(): JQuery | null {\n        return this.inputInstance?.element || null;\n    }\n\n    getValue(): string {\n        return this.inputInstance ? this.inputInstance.value() : \"\";\n    }\n\n    setValue(value: string): void {\n        if (this.inputInstance) {\n            this.inputInstance.value(value);\n        }\n        this.updateAutoResize();\n        this.updateMultiResize();\n    }\n\n    enable(enabled: boolean): void {\n        if (this.inputInstance) {\n            this.inputInstance.enable(enabled);\n        }\n    }\n\n    setReadonly(readonly: boolean): void {\n        if (this.inputInstance?.element) {\n            this.inputInstance.element.prop(\"readonly\", readonly);\n        }\n    }\n\n    focus(): void {\n        if (this.inputInstance) {\n            this.inputInstance.focus();\n        }\n    }\n\n    blur(): void {\n        if (this.inputInstance?.element) {\n            this.inputInstance.element.blur();\n        }\n    }\n\n    isMultiline(): boolean {\n        return this.multiline;\n    }\n\n    updateAutoResize(): void {\n        const mode = this.context.getMode();\n\n        if (mode !== LINE_MODE.AUTO || !this.inputInstance) {\n            return;\n        }\n\n        const textarea = this.inputInstance.element;\n        if (!textarea.is(\"textarea\")) {\n            return;\n        }\n\n        const el = textarea[0] as HTMLTextAreaElement;\n\n        if (!this.multiline) {\n            const needsExpansion = el.scrollWidth > el.clientWidth || el.scrollHeight > el.clientHeight;\n\n            if (needsExpansion) {\n                this.updateMultilineState(true);\n                this.updateHeight();\n            }\n        } else {\n            this.updateHeight();\n\n            if (this.shouldCollapse()) {\n                this.updateMultilineState(false);\n                textarea.css(\"height\", \"\");\n            }\n        }\n    }\n\n    updateMultiResize(): void {\n        const mode = this.context.getMode();\n\n        if (mode !== LINE_MODE.MULTI || !this.inputInstance) {\n            return;\n        }\n\n        const textarea = this.inputInstance.element;\n        if (!textarea.is(\"textarea\")) {\n            return;\n        }\n\n        const el = textarea[0];\n        const options = this.context.getOptions();\n\n        textarea.css(\"overflow\", \"hidden\");\n        textarea.css(\"height\", this.initialHeight + \"px\");\n\n        const scrollHeight = el.scrollHeight;\n        const newHeight = this.calculateMultiHeight(scrollHeight, options.maxTextAreaHeight);\n\n        if (newHeight === options.maxTextAreaHeight) {\n            textarea.css(\"overflow\", \"\");\n        }\n\n        textarea.css(\"height\", newHeight + \"px\");\n    }\n\n    updatePlaceholder(): void {\n        const options = this.context.getOptions();\n        const messages = $.extend({}, DEFAULT_MESSAGES, options.messages);\n        const placeholder = options.placeholder || messages.placeholder;\n\n        if (this.inputInstance?.element) {\n            this.inputInstance.element.attr(\"placeholder\", placeholder);\n        }\n    }\n\n    destroy(): void {\n        if (this.inputInstance) {\n            this.inputInstance.element.off(NS);\n            this.inputInstance.destroy();\n            this.inputInstance = null;\n        }\n    }\n\n    private createInputElement(mode: string): JQuery {\n        const options = this.context.getOptions();\n        const messages = $.extend({}, DEFAULT_MESSAGES, options.messages);\n        const title = options.title ? `title=\"${options.title}\"` : \"\";\n        const readonly = options.readonly ? \"readonly\" : \"\";\n\n        let inputElement: JQuery;\n\n        if (mode === LINE_MODE.SINGLE) {\n            inputElement = $(`<input type=\"text\" class=\"${STYLES.promptBoxInput} ${STYLES.inputInner}\" placeholder=\"${options.placeholder || messages.placeholder}\" autocomplete=\"off\" ${title} ${readonly} />`);\n\n            this.inputInstance = {\n                element: inputElement,\n                value: (val?: string) => {\n                    if (val === undefined) {\n                        return inputElement.val() as string;\n                    }\n                    inputElement.val(val);\n                },\n                enable: (enabled: boolean) => {\n                    inputElement.prop(\"disabled\", !enabled);\n                },\n                focus: () => inputElement.trigger(\"focus\"),\n                destroy: () => { }\n            };\n        } else {\n            const rows = mode === LINE_MODE.AUTO ? 1 : (options.rows || 1);\n            inputElement = $(`<textarea class=\"${STYLES.promptBoxTextarea} ${STYLES.inputInner}\" placeholder=\"${options.placeholder || messages.placeholder}\" rows=\"${rows}\" aria-multiline=\"true\" ${title} ${readonly}></textarea>`);\n\n            if (options.maxTextAreaHeight) {\n                inputElement.css(\"max-height\", options.maxTextAreaHeight + \"px\");\n                inputElement.css(\"overflow-y\", \"auto\");\n            }\n\n            this.inputInstance = {\n                element: inputElement,\n                value: (val?: string) => {\n                    if (val === undefined) {\n                        return inputElement.val() as string;\n                    }\n                    inputElement.val(val);\n                },\n                enable: (enabled: boolean) => {\n                    inputElement.prop(\"disabled\", !enabled);\n                },\n                focus: () => inputElement.trigger(\"focus\"),\n                destroy: () => { }\n            };\n        }\n\n        return inputElement;\n    }\n\n    private captureInitialDimensions(): void {\n        const mode = this.context.getMode();\n\n        if (mode === LINE_MODE.SINGLE || !this.inputInstance) {\n            return;\n        }\n\n        const textarea = this.inputInstance.element;\n        if (!textarea.is(\"textarea\")) {\n            return;\n        }\n\n        const el = textarea[0] as HTMLTextAreaElement;\n        const computedStyle = window.getComputedStyle(el);\n        const lineHeight = parseFloat(computedStyle.lineHeight) || 20;\n        const paddingTop = parseFloat(computedStyle.paddingTop) || 0;\n        const paddingBottom = parseFloat(computedStyle.paddingBottom) || 0;\n\n        const options = this.context.getOptions();\n        const rows = options.rows || 1;\n\n        this.singleRowHeight = lineHeight + paddingTop + paddingBottom;\n        this.initialHeight = el.offsetHeight || this.singleRowHeight;\n        this.singleLineWidth = el.offsetWidth;\n        this.minMultiRowHeight = lineHeight * rows + paddingTop + paddingBottom;\n    }\n\n    private shouldCollapse(): boolean {\n        if (!this.inputInstance || this.singleLineWidth <= 0) {\n            return false;\n        }\n\n        const textarea = this.inputInstance.element as JQuery;\n        if (!textarea.is(\"textarea\")) {\n            return false;\n        }\n\n        const el = textarea[0];\n        const currentHeight = el.style.height;\n\n        textarea.css({\n            overflow: \"hidden\",\n            width: this.singleLineWidth + \"px\",\n            whiteSpace: \"nowrap\",\n            height: this.initialHeight + \"px\"\n        });\n\n        const fitsSingleLine =\n            el.scrollWidth <= this.singleLineWidth && el.scrollHeight <= this.initialHeight;\n\n        textarea.css({\n            overflow: \"\",\n            width: \"\",\n            whiteSpace: \"\"\n        });\n\n        if (currentHeight) {\n            textarea.css(\"height\", currentHeight);\n        } else {\n            textarea.css(\"height\", \"\");\n        }\n\n        return fitsSingleLine;\n    }\n\n    private updateHeight(): void {\n        const options = this.context.getOptions();\n\n        if (!this.inputInstance) {\n            return;\n        }\n\n        const textarea = this.inputInstance.element as JQuery;\n        if (!textarea.is(\"textarea\")) {\n            return;\n        }\n\n        const el = textarea[0];\n\n        textarea.css(\"overflow\", \"hidden\");\n        textarea.css(\"height\", this.initialHeight + \"px\");\n\n        const scrollHeight = el.scrollHeight;\n        const newHeight = options.maxTextAreaHeight\n            ? Math.min(scrollHeight, options.maxTextAreaHeight)\n            : scrollHeight;\n\n        if (newHeight === options.maxTextAreaHeight) {\n            textarea.css(\"overflow\", \"\");\n        }\n\n        textarea.css(\"height\", newHeight + \"px\");\n    }\n\n    private calculateMultiHeight(scrollHeight: number, maxTextAreaHeight: number | undefined): number {\n        if (maxTextAreaHeight && scrollHeight > maxTextAreaHeight) {\n            return maxTextAreaHeight;\n        }\n        return Math.max(this.minMultiRowHeight, scrollHeight);\n    }\n\n    private updateMultilineState(isMultiline: boolean): void {\n        const mode = this.context.getMode();\n\n        if (mode !== LINE_MODE.AUTO) {\n            return;\n        }\n\n        if (this.multiline === isMultiline) {\n            return;\n        }\n\n        const wasMultiline = this.multiline;\n        this.multiline = isMultiline;\n\n        if (isMultiline) {\n            this.context.wrapper.addClass(STYLES.promptBoxMultiline);\n        } else {\n            this.context.wrapper.removeClass(STYLES.promptBoxMultiline);\n        }\n\n        this.context.callbacks.onMultilineStateChange(isMultiline, wasMultiline);\n    }\n\n    private attachInputEvents(): void {\n        if (!this.inputInstance) {\n            return;\n        }\n\n        const inputElement = this.inputInstance.element as JQuery;\n\n        inputElement.on(INPUT + NS, () => {\n            this.updateAutoResize();\n            this.updateMultiResize();\n            this.context.callbacks.onInput();\n        });\n\n        inputElement.on(KEYDOWN + NS, (e: any) => {\n            this.context.callbacks.onKeyDown(e);\n        });\n\n        inputElement.on(FOCUS + NS, () => {\n            this.context.callbacks.onFocus();\n        });\n\n        inputElement.on(BLUR + NS, () => {\n            this.context.callbacks.onBlur();\n        });\n    }\n}\n","import \"../kendo.html.button.js\";\nimport \"../kendo.icons.js\";\nimport \"../kendo.speechtotextbutton.js\";\nimport \"../kendo.textarea.js\";\nimport \"../kendo.textbox.js\";\nimport \"../kendo.upload.js\";\nimport { Widget } from \"../core/base/widget\";\nimport { inject } from \"../core/service-container\";\nimport { HtmlService } from \"../core/services/html.service\";\nimport { UtilsService } from \"../core/services/utils.service\";\nimport { FileUtilsService } from \"../core/services/file-utils.service\";\nimport { DomUtilsService } from \"../core/services/dom-utils.service\";\nimport { NS, STYLES, REFERENCES, EVENTS, LINE_MODE, CLICK, FOCUSIN, FOCUSOUT } from \"./constants\";\nimport { renderPromptBox, IAffixConfig, IFileSelectButtonConfig, IButtonSettingsConfig, IRenderConfig } from \"./templates\";\nimport { IKendoJQueryStatic, IKendoJQuery } from \"../core\";\nimport { AccessibilityManager, ActionButtonManager, SpeechHandler, FileHandler, InputManager } from \"./collaborators\";\nimport type { IPromptBoxOptions, IPromptBoxMessages, IActionButtonEvent, IFileSelectButtonSettings } from \"./models\";\nimport type { IFile } from \"../upload\";\n\ndeclare const kendo: any;\ndeclare const $: IKendoJQueryStatic;\n\nconst DEFAULT_MESSAGES: IPromptBoxMessages = {\n    placeholder: \"Type a message...\",\n    actionButton: \"Send\",\n    actionButtonLoading: \"Stop\",\n    messageBoxTitle: \"Message\",\n    fileSelectButton: \"Attach file\"\n};\n\n/**\n * PromptBox widget - A composite input component for chat-like interfaces.\n *\n * Supports three modes:\n * - \"single\": Single-line text input\n * - \"multi\": Multi-line textarea with fixed rows\n * - \"auto\": Auto-expanding textarea (starts from 1 row)\n */\nexport class PromptBox extends Widget {\n    static readonly options = {\n        name: \"PromptBox\",\n        prefix: \"\",\n        mode: LINE_MODE.AUTO,\n        placeholder: \"\",\n        value: \"\",\n        enable: true,\n        readonly: false,\n        title: \"\",\n        fillMode: undefined,\n        maxTextAreaHeight: undefined,\n        rows: 1,\n        headerTemplate: null,\n        loading: false,\n        actionButton: null,\n        fileSelectButton: false,\n        speechToTextButton: true,\n        startAffixTemplate: null,\n        endAffixTemplate: null,\n        topAffixTemplate: null,\n        messages: DEFAULT_MESSAGES\n    };\n\n    events: string[] = [\n        EVENTS.valueChange,\n        EVENTS.input,\n        EVENTS.promptAction,\n        EVENTS.fileSelect,\n        EVENTS.fileRemove,\n        EVENTS.speechToTextClick,\n        EVENTS.speechToTextStart,\n        EVENTS.speechToTextEnd,\n        EVENTS.speechToTextError,\n        EVENTS.speechToTextResult,\n        EVENTS.focus,\n        EVENTS.blur,\n        EVENTS.inputFocus,\n        EVENTS.inputBlur,\n        EVENTS.multilineStateChange\n    ];\n\n    private _value: string = \"\";\n    private _loading: boolean = false;\n    private _readonly: boolean = false;\n    private _hasFocus: boolean = false;\n    private _fileInputId: string = \"\";\n\n    private utilsService: UtilsService;\n    private htmlService: HtmlService;\n    private fileUtilsService: FileUtilsService;\n    private domUtilsService: DomUtilsService;\n    private accessibilityManager!: AccessibilityManager;\n    private actionButtonManager!: ActionButtonManager;\n    private speechHandler!: SpeechHandler;\n    private fileHandler!: FileHandler;\n    private inputManager!: InputManager;\n\n    /**\n     * Constructs a new PromptBox instance.\n     */\n    constructor(\n        element: HTMLElement | IKendoJQuery,\n        options?: Partial<IPromptBoxOptions>,\n        utilsService = inject(UtilsService),\n        htmlService = inject(HtmlService),\n        fileUtilsService = inject(FileUtilsService),\n        domUtilsService = inject(DomUtilsService)\n    ) {\n        super(element as any, $.extend(true, {}, PromptBox.options, options));\n\n        this.utilsService = utilsService;\n        this.htmlService = htmlService;\n        this.fileUtilsService = fileUtilsService;\n        this.domUtilsService = domUtilsService;\n\n        this._value = (this.options as IPromptBoxOptions).value || \"\";\n        this._loading = (this.options as IPromptBoxOptions).loading || false;\n        this._fileInputId = \"promptbox_file_\" + this.utilsService.guid();\n\n        this._initWrapper();\n        this._initInputManager();\n        this._initSpeechHandler();\n        this._initFileHandler();\n        this._attachEvents();\n        this.fileHandler.renderAttachments();\n        this._initAccessibilityManager();\n        this._initActionButtonManager();\n\n        this.bind(this.events, this.options);\n\n        if (!(this.options as IPromptBoxOptions).enable) {\n            this.enable(false);\n        }\n\n        if ((this.options as IPromptBoxOptions).readonly) {\n            this.readonly(true);\n        }\n\n        if (this._value && this._getMode() === LINE_MODE.AUTO) {\n            this.inputManager.updateAutoResize();\n        }\n\n        this.actionButtonManager.updateState();\n    }\n\n    /**\n     * Gets or sets the input value.\n     */\n    value(newValue?: string): string | void {\n        if (newValue === undefined) {\n            return this._value;\n        }\n\n        this._value = newValue;\n        this.inputManager.setValue(newValue);\n        this.actionButtonManager.updateState();\n    }\n\n    /**\n     * Enables or disables the PromptBox.\n     * When enabling, this also clears the readonly state (similar to TextBox behavior).\n     */\n    enable(enabled: boolean = true): void {\n        const options = this.options as IPromptBoxOptions;\n        options.enable = enabled;\n\n        if (enabled) {\n            this._readonly = false;\n            options.readonly = false;\n            this.inputManager.setReadonly(false);\n            this.wrapper.removeClass(STYLES.disabled);\n        } else {\n            this.wrapper.addClass(STYLES.disabled);\n        }\n\n        this.inputManager.enable(enabled);\n        this.speechHandler.enable(enabled);\n        this._updateFileSelectButtonState();\n        this.actionButtonManager.updateState();\n\n        this.accessibilityManager.updateWrapper({ disabled: !enabled });\n        this.accessibilityManager.updateInputAccessibility();\n    }\n\n    /**\n     * Gets or sets the read-only state of the PromptBox.\n     */\n    readonly(value?: boolean): boolean | void {\n        if (value === undefined) {\n            return this._readonly;\n        }\n\n        this._readonly = value;\n        const options = this.options as IPromptBoxOptions;\n        options.readonly = value;\n        this.inputManager.setReadonly(value);\n\n        this.accessibilityManager.updateInputAccessibility();\n\n        this.actionButtonManager.updateState();\n        this.speechHandler.enable(!value);\n        this._updateFileSelectButtonState();\n    }\n\n    /**\n     * Gets or sets the loading state (shows stop button instead of send).\n     */\n    loading(value?: boolean): boolean | void {\n        if (value === undefined) {\n            return this._loading;\n        }\n\n        this._loading = value;\n\n        this.accessibilityManager.updateWrapper({ loading: value });\n        this.actionButtonManager.setLoading(value);\n    }\n\n    /**\n     * Focuses the input element.\n     */\n    focus(): void {\n        this.inputManager.focus();\n    }\n\n    /**\n     * Blurs the input element.\n     */\n    blur(): void {\n        this.inputManager.blur();\n    }\n\n    /**\n     * Gets or sets the attached files.\n     * @param newFiles - Optional array of files to set. If not provided, returns current files.\n     * @returns Array of attached files when getting, void when setting.\n     */\n    files(newFiles?: IFile[]): IFile[] | void {\n        if (newFiles === undefined) {\n            return this.fileHandler.getFiles();\n        }\n\n        this.fileHandler.setFiles(newFiles);\n    }\n\n    /**\n     * Clears all attached files.\n     */\n    clearFiles(): void {\n        this.fileHandler.clearFiles();\n    }\n\n    /**\n     * Destroys the widget.\n     */\n    destroy(): void {\n        this._detachEvents();\n        this._destroyCollaborators();\n        super.destroy();\n    }\n\n    private _destroyCollaborators(): void {\n        this.fileHandler.destroy();\n        this.speechHandler.destroy();\n        this.inputManager.destroy();\n    }\n\n    /**\n     * Updates widget options dynamically.\n     * For complex changes (templates, buttons, mode), the widget is rebuilt.\n     */\n    setOptions(options: Partial<IPromptBoxOptions>): void {\n        const requiresRebuild = options.headerTemplate !== undefined ||\n            options.startAffixTemplate !== undefined ||\n            options.endAffixTemplate !== undefined ||\n            options.topAffixTemplate !== undefined ||\n            options.actionButton !== undefined ||\n            options.actionButtonSettings !== undefined ||\n            options.fileSelectButton !== undefined ||\n            options.speechToTextButton !== undefined ||\n            options.mode !== undefined;\n\n        if (requiresRebuild) {\n            const currentValue = this._value;\n            const wasLoading = this._loading;\n            const attachments = (this.options as IPromptBoxOptions).attachments;\n            const currentFiles = this.fileHandler.getFiles();\n\n            this._detachEvents();\n            this._destroyCollaborators();\n\n            super.setOptions(options as any);\n\n            // Remove old wrapper completely (element was moved outside wrapper in _initWrapper)\n            this.wrapper.remove();\n\n            this._initWrapper();\n            this._initInputManager();\n            this._initSpeechHandler();\n            this._initFileHandler();\n            this._attachEvents();\n\n            // Restore files that were attached before the rebuild\n            if (currentFiles.length > 0) {\n                this.fileHandler.setFiles(currentFiles);\n            }\n\n            this._initAccessibilityManager();\n            this._initActionButtonManager();\n\n            if (currentValue) {\n                this.value(currentValue);\n            }\n            if (wasLoading) {\n                this.loading(true);\n            }\n            if (attachments) {\n                (this.options as IPromptBoxOptions).attachments = attachments;\n                this.fileHandler.renderAttachments();\n            }\n            return;\n        }\n\n        super.setOptions(options as any);\n\n        if (options.placeholder !== undefined || options.messages?.placeholder !== undefined) {\n            this.inputManager.updatePlaceholder();\n        }\n\n        if (options.messages?.actionButton !== undefined || options.messages?.actionButtonLoading !== undefined) {\n            this.actionButtonManager.updateMessages();\n        }\n\n        if (options.enable !== undefined) {\n            this.enable(options.enable);\n        }\n\n        if (options.readonly !== undefined) {\n            this.readonly(options.readonly);\n        }\n\n        if (options.loading !== undefined) {\n            this.loading(options.loading);\n        }\n    }\n\n    private _initInputManager(): void {\n        this.inputManager = new InputManager({\n            wrapper: this.wrapper,\n            getOptions: () => this.options as IPromptBoxOptions,\n            getMode: () => this._getMode(),\n            callbacks: {\n                onInput: () => this._handleInput(),\n                onKeyDown: (e) => this._handleKeyDown(e),\n                onFocus: () => this.trigger(EVENTS.inputFocus),\n                onBlur: () => this.trigger(EVENTS.inputBlur),\n                onMultilineStateChange: (isMultiline, wasMultiline) => {\n                    this._handleAffixReorganization(isMultiline);\n                    this.trigger(EVENTS.multilineStateChange, { isMultiline, wasMultiline });\n                }\n            }\n        });\n        this.inputManager.init();\n    }\n\n    /**\n     * Reorganizes affixes when auto mode switches between single-line and multiline.\n     * In multiline: startAffix content moves to endAffix (left side) with a spacer.\n     * In single-line: startAffix content returns to its original container.\n     */\n    private _handleAffixReorganization(isMultiline: boolean): void {\n        const options = this.options as IPromptBoxOptions;\n        if (!options.startAffixTemplate) {\n            return;\n        }\n\n        const startAffix = this.wrapper.find(`[${REFERENCES.startAffix}]`);\n        const endAffix = this.wrapper.find(`[${REFERENCES.endAffix}]`);\n\n        if (!startAffix.length || !endAffix.length) {\n            return;\n        }\n\n        if (isMultiline) {\n            const startAffixContent = startAffix.contents().detach();\n            startAffix.addClass(STYLES.hidden);\n\n            const spacer = $(`<div class=\"${STYLES.spacer}\" ${REFERENCES.affixSpacer}></div>`);\n\n            endAffix.prepend(spacer);\n            endAffix.prepend(startAffixContent);\n        } else {\n            const spacer = endAffix.find(`[${REFERENCES.affixSpacer}]`);\n            if (spacer.length) {\n                const startAffixContent = spacer.prevAll().detach();\n\n                startAffix.empty().append(startAffixContent);\n                startAffix.removeClass(STYLES.hidden);\n\n                spacer.remove();\n            }\n        }\n    }\n\n    private _initSpeechHandler(): void {\n        this.speechHandler = new SpeechHandler({\n            wrapper: this.wrapper,\n            getSpeechToTextButtonOption: () => (this.options as IPromptBoxOptions).speechToTextButton,\n            callbacks: {\n                onStart: (e) => this.trigger(EVENTS.speechToTextStart, e),\n                onEnd: (e) => this.trigger(EVENTS.speechToTextEnd, e),\n                onResult: (e) => {\n                    const transcript = e.alternatives?.[0]?.transcript || \"\";\n                    if (transcript) {\n                        const currentValue = this._value || \"\";\n                        const newValue = currentValue + (currentValue ? \" \" : \"\") + transcript;\n                        this.value(newValue);\n                    }\n                    this.trigger(EVENTS.speechToTextResult, { ...e, transcript });\n                },\n                onError: (e) => this.trigger(EVENTS.speechToTextError, e)\n            }\n        });\n        this.speechHandler.init();\n    }\n\n    private _initFileHandler(): void {\n        this.fileHandler = new FileHandler({\n            wrapper: this.wrapper,\n            getOptions: () => this.options as IPromptBoxOptions,\n            htmlService: this.htmlService,\n            fileUtilsService: this.fileUtilsService,\n            utilsService: this.utilsService,\n            domUtilsService: this.domUtilsService,\n            callbacks: {\n                onFilesChanged: () => this.actionButtonManager.updateState(),\n                onFileSelect: (files) => this.trigger(EVENTS.fileSelect, { files }),\n                onFileRemove: (file, remainingFiles) => this.trigger(EVENTS.fileRemove, { file, files: remainingFiles })\n            }\n        });\n        this.fileHandler.initUpload();\n    }\n\n    private _initAccessibilityManager(): void {\n        this.accessibilityManager = new AccessibilityManager({\n            wrapper: this.wrapper,\n            getOptions: () => this.options as IPromptBoxOptions,\n            getInputElement: () => this.inputManager.getElement()\n        });\n        this.accessibilityManager.applyInitial();\n    }\n\n    private _initActionButtonManager(): void {\n        this.actionButtonManager = new ActionButtonManager({\n            wrapper: this.wrapper,\n            getMessages: () => this._getMessages(),\n            getSettings: () => (this.options as IPromptBoxOptions).actionButton,\n            isDisabled: () => {\n                const options = this.options as IPromptBoxOptions;\n                const widgetDisabled = !options.enable;\n                const widgetReadonly = options.readonly;\n                const actionButtonDisabled = options.actionButton?.enable === false;\n                return widgetDisabled || widgetReadonly || actionButtonDisabled;\n            },\n            isLoading: () => this._loading,\n            hasContent: () => !!this._value?.trim() || this.fileHandler.hasFiles()\n        });\n    }\n\n    /**\n     * Gets the input mode (single, multi, or auto).\n     */\n    private _getMode(): string {\n        const options = this.options as IPromptBoxOptions;\n        return options.mode || LINE_MODE.AUTO;\n    }\n\n    /**\n     * Gets the merged messages, including overrides from button settings.\n     */\n    private _getMessages(): IPromptBoxMessages {\n        const options = this.options as IPromptBoxOptions;\n        const actionButtonSettings = options.actionButton;\n        const fileSelectButtonSettings = typeof options.fileSelectButton === \"object\" ? options.fileSelectButton as IFileSelectButtonSettings : null;\n        const baseMessages = $.extend({}, DEFAULT_MESSAGES, options.messages);\n        if (actionButtonSettings?.text) {\n            baseMessages.actionButton = actionButtonSettings.text;\n        }\n        if (actionButtonSettings?.loadingText) {\n            baseMessages.actionButtonLoading = actionButtonSettings.loadingText;\n        }\n        if (fileSelectButtonSettings?.text) {\n            baseMessages.fileSelectButton = fileSelectButtonSettings.text;\n        }\n        return baseMessages;\n    }\n\n    /**\n     * Gets whether the action button should be shown. Always returns true.\n     */\n    private _showActionButton(): boolean {\n        return true;\n    }\n\n    /**\n     * Gets whether the speech-to-text button should be shown.\n     */\n    private _showSpeechToTextButton(): boolean {\n        const options = this.options as IPromptBoxOptions;\n        return options.speechToTextButton === true ||\n            options.speechToTextButton === null ||\n            options.speechToTextButton === undefined ||\n            (typeof options.speechToTextButton === \"object\" && options.speechToTextButton !== null);\n    }\n\n    /**\n     * Gets whether the file select button should be shown.\n     */\n    private _showFileSelectButton(): boolean {\n        const options = this.options as IPromptBoxOptions;\n        return options.fileSelectButton === true ||\n            (typeof options.fileSelectButton === \"object\" && options.fileSelectButton !== null);\n    }\n\n    /**\n     * Updates the file select button state based on enable/readonly options.\n     */\n    private _updateFileSelectButtonState(): void {\n        const options = this.options as IPromptBoxOptions;\n        const fileSelectButton = this.wrapper.find(`[${REFERENCES.fileSelectButton}]`);\n\n        if (!fileSelectButton.length) {\n            return;\n        }\n\n        const fileSelectSettings = this._getFileSelectButtonSettings();\n        const isDisabled = !options.enable || options.readonly || fileSelectSettings?.enable === false;\n\n        if (isDisabled) {\n            fileSelectButton.addClass(STYLES.disabled);\n            fileSelectButton.attr(\"aria-disabled\", \"true\");\n        } else {\n            fileSelectButton.removeClass(STYLES.disabled);\n            fileSelectButton.removeAttr(\"aria-disabled\");\n        }\n    }\n\n    /**\n     * Gets the file select button settings.\n     */\n    private _getFileSelectButtonSettings(): IFileSelectButtonSettings | undefined {\n        const options = this.options as IPromptBoxOptions;\n        if (typeof options.fileSelectButton === \"object\" && options.fileSelectButton !== null) {\n            return options.fileSelectButton as IFileSelectButtonSettings;\n        }\n        return undefined;\n    }\n\n    /**\n     * Creates the wrapper element using wrap instead of replaceWith.\n     * This keeps the original element in the DOM so jQuery data binding works.\n     */\n    private _initWrapper(): void {\n        const options = this.options as IPromptBoxOptions;\n        const messages = this._getMessages();\n        const mode = this._getMode();\n\n        let modeClass = \"\";\n        if (mode === LINE_MODE.SINGLE) {\n            modeClass = ` ${STYLES.promptBoxSingleline}`;\n        } else if (mode === LINE_MODE.MULTI) {\n            modeClass = ` ${STYLES.promptBoxMultiline}`;\n        }\n\n        const stylingClasses = this._getAppearanceClasses();\n\n        const affixConfig: IAffixConfig = {\n            startAffixTemplate: options.startAffixTemplate,\n            endAffixTemplate: options.endAffixTemplate,\n            topAffixTemplate: options.topAffixTemplate\n        };\n\n        const fileSelectButtonConfig = this._getFileSelectButtonConfig();\n        const buttonSettingsConfig = this._getButtonSettingsConfig();\n\n        const renderConfig: IRenderConfig = {\n            affixConfig,\n            fileSelectButtonConfig,\n            buttonSettingsConfig\n        };\n\n        const wrapperContent = renderPromptBox(\n            options.headerTemplate,\n            messages,\n            this._showActionButton(),\n            mode as any,\n            this._showSpeechToTextButton(),\n            renderConfig\n        );\n\n        this.wrapper = this.element.wrap(`<div class=\"${STYLES.input}${stylingClasses} ${STYLES.promptBox}${modeClass}\" role=\"group\"></div>`).parent() as IKendoJQuery;\n        this.wrapper.prepend(wrapperContent);\n        this.element.addClass(STYLES.hidden);\n        this.wrapper.after(this.element);\n    }\n\n    /**\n     * Gets appearance CSS classes for fillMode.\n     * PromptBox only supports fillMode at the root level per kendo-themes spec.\n     */\n    private _getAppearanceClasses(): string {\n        const options = this.options as IPromptBoxOptions;\n\n        if (options.fillMode) {\n            return ` k-input-${options.fillMode}`;\n        }\n\n        return \"\";\n    }\n\n    /**\n     * Gets the file select button configuration for template rendering.\n     */\n    private _getFileSelectButtonConfig(): IFileSelectButtonConfig | undefined {\n        if (!this._showFileSelectButton()) {\n            return undefined;\n        }\n\n        const settings = this._getFileSelectButtonSettings();\n        let accept = settings?.accept;\n\n        if (!accept && settings?.restrictions?.allowedExtensions?.length) {\n            accept = settings.restrictions.allowedExtensions\n                .map(ext => ext.startsWith(\".\") ? ext : `.${ext}`)\n                .join(\",\");\n        }\n\n        return {\n            enable: settings?.enable,\n            fileInputId: this._fileInputId,\n            accept: accept,\n            multiple: settings?.multiple,\n            showSpacer: settings?.showSpacer,\n            settings: settings\n        };\n    }\n\n    /**\n     * Gets the button settings configuration for template rendering.\n     */\n    private _getButtonSettingsConfig(): IButtonSettingsConfig {\n        const options = this.options as IPromptBoxOptions;\n        const speechOption = options.speechToTextButton;\n        const speechSettings = typeof speechOption === \"object\" && speechOption !== null ? speechOption : undefined;\n        return {\n            actionButtonSettings: options.actionButton || undefined,\n            fileSelectButtonSettings: this._getFileSelectButtonSettings(),\n            speechToTextButtonSettings: speechSettings\n        };\n    }\n\n    /**\n     * Gets the current multiline state (for auto mode).\n     */\n    isMultiline(): boolean {\n        return this.inputManager.isMultiline();\n    }\n\n    /**\n     * Attaches event handlers.\n     */\n    private _attachEvents(): void {\n        this.wrapper.on(CLICK + NS, `[${REFERENCES.sendButton}]`, (e: JQuery.ClickEvent) => {\n            e.preventDefault();\n            this._handleSend();\n        });\n\n        this.wrapper.on(CLICK + NS, `[${REFERENCES.fileSelectButton}]`, (e: JQuery.ClickEvent) => {\n            e.preventDefault();\n            this.fileHandler.handleFileSelectClick();\n        });\n\n        this.wrapper.on(CLICK + NS, `[${REFERENCES.attachmentRemoveButton}]`, (e: JQuery.ClickEvent) => {\n            e.preventDefault();\n            const target = e.currentTarget as HTMLElement;\n            const uid = target.getAttribute(\"data-uid\");\n            if (uid) {\n                this.fileHandler.removeAttachmentByUid(uid);\n            }\n        });\n\n        this.wrapper.on(FOCUSIN + NS, (e: JQuery.FocusInEvent) => {\n            this._handleFocusIn(e);\n        });\n\n        this.wrapper.on(FOCUSOUT + NS, (e: JQuery.FocusOutEvent) => {\n            this._handleFocusOut(e);\n        });\n    }\n\n    /**\n     * Detaches event handlers.\n     */\n    private _detachEvents(): void {\n        this.wrapper.off(NS);\n    }\n\n    /**\n     * Handles focus entering the widget.\n     */\n    private _handleFocusIn(e: JQuery.FocusInEvent): void {\n        if (!this._hasFocus) {\n            this._hasFocus = true;\n            this.wrapper.addClass(STYLES.focus);\n            this.trigger(EVENTS.focus);\n        }\n    }\n\n    /**\n     * Handles focus leaving the widget.\n     */\n    private _handleFocusOut(e: JQuery.FocusOutEvent): void {\n        const relatedTarget = e.relatedTarget as HTMLElement;\n        const isInsideWidget = relatedTarget && this.wrapper[0].contains(relatedTarget);\n\n        if (!isInsideWidget && this._hasFocus) {\n            this._hasFocus = false;\n            this.wrapper.removeClass(STYLES.focus);\n            this.trigger(EVENTS.blur);\n        }\n    }\n\n    /**\n     * Handles the send action.\n     */\n    private _handleSend(): void {\n        const options = this.options as IPromptBoxOptions;\n\n        if (!options.enable || options.readonly || options.actionButton?.enable === false) {\n            return;\n        }\n\n        if (this._loading) {\n            const eventData: IActionButtonEvent = { actionType: \"stop\" };\n            this.trigger(EVENTS.promptAction, eventData);\n            this.loading(false);\n            return;\n        }\n\n        const value = this._value;\n        const hasValue = value?.trim();\n        const hasFiles = this.fileHandler.hasFiles();\n\n        if (!hasValue && !hasFiles) {\n            return;\n        }\n\n        const eventData: IActionButtonEvent = {\n            actionType: \"send\",\n            value: hasValue ? value.trim() : \"\",\n            files: this.fileHandler.getFiles()\n        };\n        this.trigger(EVENTS.promptAction, eventData);\n\n        this.value(\"\");\n        this.clearFiles();\n        this.focus();\n    }\n\n    /**\n     * Handles input changes.\n     */\n    private _handleInput(): void {\n        const oldValue = this._value;\n        this._value = this.inputManager.getValue();\n\n        this.actionButtonManager.updateState();\n\n        this.trigger(EVENTS.input, { value: this._value });\n\n        if (oldValue !== this._value) {\n            this.trigger(EVENTS.valueChange, {\n                oldValue,\n                newValue: this._value\n            });\n        }\n    }\n\n    /**\n     * Handles keydown events.\n     * Enter sends the message in all modes.\n     * Shift+Enter adds a newline in multi/auto modes.\n     * Enter is ignored when loading to prevent accidental stops.\n     */\n    private _handleKeyDown(e: JQuery.KeyDownEvent): void {\n        const mode = this._getMode();\n        const isEnter = e.key === \"Enter\" || e.which === 13 || e.keyCode === 13;\n\n        if (isEnter) {\n            if (e.shiftKey && mode !== LINE_MODE.SINGLE) {\n                return;\n            }\n\n            e.preventDefault();\n\n            if (!this._loading) {\n                this._handleSend();\n            }\n        }\n    }\n}\n","import { inject } from \"../core/service-container\";\nimport { CssPropertiesService } from \"../core/services/css-properties.service\";\n\n// Main PromptBox widget export\nexport { PromptBox } from \"./promptbox.widget\";\n\n// Models\nexport * from \"./models\";\n\n// Constants\nexport * from \"./constants\";\n\n// Templates\nexport * from \"./templates\";\n\n// Register PromptBox CSS properties\n// PromptBox uses k-input prefix for fillMode (k-input-solid, k-input-outline, k-input-flat)\nconst cssProps = inject(CssPropertiesService);\ncssProps.registerPrefix(\"PromptBox\", \"k-input-\");\ncssProps.registerValues(\"PromptBox\", [{\n    prop: \"fillMode\",\n    values: cssProps.fillModeValues\n}]);\n","import \"../../kendo.html.button.js\";\nimport \"../../kendo.icons.js\";\nimport \"../../kendo.promptbox.js\";\nimport { Widget } from \"../../core/base/widget.js\";\nimport type { UtilsService } from \"../../core/services/utils.service.js\";\nimport type { DomUtilsService } from \"../../core/services/dom-utils.service.js\";\nimport { DragToScrollHandler } from \"../../core/models/dom-utils.js\";\nimport { NS, STYLES, REFERENCES, SCROLLING_DELTA, CLICK, DOT, RTL, EVENTS, SUGGESTED_ACTIONS_LAYOUT_MODE } from \"../constants.js\";\nimport type { IChatOptions, IMessage, IChatMessages, IMessageBoxSettings } from \"../models/index.js\";\nimport { renderSuggestionsWithLayout } from \"../templates/index.js\";\nimport { IKendoJQueryStatic, IKendoJQuery } from \"../../core/index.js\";\nimport { PromptBox } from \"../../promptbox/index.js\";\n\ndeclare const kendo: any;\ndeclare const $: IKendoJQueryStatic;\n\nexport interface IChatMessageBoxContext {\n    chatElement: IKendoJQuery;\n    utilsService: UtilsService;\n    domUtilsService: DomUtilsService;\n}\n\n/**\n * MessageBox handles the input area of the chat component.\n * Delegates text input and file attachments entirely to PromptBox.\n *\n * This is an internal collaborator that extends Widget for event handling.\n */\nexport class MessageBox extends Widget {\n    static readonly options = {\n        name: \"MessageBox\"\n    };\n\n    events: string[] = [\n        EVENTS.sendMessage,\n        EVENTS.input,\n        EVENTS.suggestionClick,\n        EVENTS.replyMessageCloseButtonClick,\n        EVENTS.fileSelect,\n        EVENTS.fileRemove\n    ];\n\n    private chatElement!: IKendoJQuery;\n    private _generating = false;\n    private _typing = false;\n    promptBoxInstance: any;\n    private suggestions?: IKendoJQuery;\n\n    private context!: IChatMessageBoxContext;\n    private _dragHandler: DragToScrollHandler | null = null;\n\n    get textAreaInstance(): any {\n        return this.promptBoxInstance;\n    }\n\n    /**\n     * Constructs a new MessageBox instance.\n     */\n    constructor(\n        element: IKendoJQuery,\n        options: Partial<IChatOptions>,\n        context: IChatMessageBoxContext\n    ) {\n        super(element, $.extend(true, {}, MessageBox.options, options));\n\n        this.context = context;\n        this.chatElement = context.chatElement;\n        this._generating = false;\n\n        this._initWrapper();\n        this._initPromptBox();\n        this._attachEvents();\n        this._typing = false;\n    }\n\n    /**\n     * Creates the wrapper element for the message box.\n     */\n    private _initWrapper(): void {\n        const options = this.options as IChatOptions;\n        this.wrapper = $(`<div class=\"${STYLES.messageBoxWrapper}\"></div>`);\n\n        if (options.suggestions.length) {\n            const layoutMode = this._getSuggestionsLayoutMode(options);\n            const suggestionsHtml = renderSuggestionsWithLayout(\n                options.suggestions,\n                layoutMode,\n                options.dir === RTL\n            );\n\n            this.suggestions = this.wrapper!.append(suggestionsHtml);\n        }\n\n        this.wrapper!.find(`[${REFERENCES.leftScrollButton}]`).addClass(STYLES.disabled);\n        this.chatElement.append(this.wrapper);\n    }\n\n    /**\n     * Gets the effective suggestions layout mode, considering legacy options.\n     */\n    private _getSuggestionsLayoutMode(options: IChatOptions): typeof SUGGESTED_ACTIONS_LAYOUT_MODE[keyof typeof SUGGESTED_ACTIONS_LAYOUT_MODE] {\n        if (options.suggestionsLayoutMode) {\n            return options.suggestionsLayoutMode;\n        }\n        if (options.suggestionsScrollable) {\n            return SUGGESTED_ACTIONS_LAYOUT_MODE.SCROLLBUTTONS;\n        }\n        return SUGGESTED_ACTIONS_LAYOUT_MODE.SCROLL;\n    }\n\n    /**\n     * Initializes the PromptBox component for message input.\n     */\n    private _initPromptBox(): void {\n        const options = this.options as IChatOptions;\n        const messages = options.messages || {} as IChatMessages;\n        const messageBox = options.messageBox || {} as IMessageBoxSettings;\n        const actionButtonOpts = options.actionButton;\n        const fileAttachmentEnabled = options.fileAttachment !== false;\n\n        const mode = messageBox.mode || \"auto\";\n        const maxTextAreaHeight = messageBox.maxTextAreaHeight;\n        const rows = messageBox.rows || 1;\n\n        const actionButtonSettings = this._getActionButtonSettings(actionButtonOpts);\n        const speechToTextSettings = this._getSpeechToTextSettings(options);\n        const fileAttachmentSettings = this._getFileAttachmentSettings(options, fileAttachmentEnabled);\n\n        const promptBox = new PromptBox(this.element, {\n            mode: mode,\n            maxTextAreaHeight: maxTextAreaHeight,\n            rows: rows,\n            placeholder: messages.placeholder,\n            speechToTextButton: speechToTextSettings,\n            actionButton: actionButtonSettings,\n            fileSelectButton: fileAttachmentSettings,\n            messages: {\n                placeholder: messages.placeholder,\n                actionButton: messages.sendButton || actionButtonOpts?.text || messages.actionButton,\n                actionButtonLoading: messages.sendButtonLoading || actionButtonOpts?.loadingText || actionButtonOpts?.stopText || messages.actionButtonLoading || messages.stopButton\n            },\n            input: this._input.bind(this),\n            promptAction: this._promptBoxAction.bind(this),\n            fileSelect: this._promptBoxFileSelect.bind(this),\n            fileRemove: this._promptBoxFileRemove.bind(this)\n        });\n\n        promptBox.wrapper.appendTo(this.wrapper);\n\n        this.promptBoxInstance = promptBox;\n    }\n\n    /**\n     * Gets action button settings to pass to PromptBox.\n     */\n    private _getActionButtonSettings(actionButtonOpts: any): object {\n        return {\n            enable: true,\n            icon: actionButtonOpts?.icon,\n            loadingIcon: actionButtonOpts?.loadingIcon || actionButtonOpts?.stopIcon,\n            fillMode: actionButtonOpts?.fillMode,\n            rounded: actionButtonOpts?.rounded,\n            size: actionButtonOpts?.size,\n            themeColor: actionButtonOpts?.themeColor,\n            text: actionButtonOpts?.text,\n            loadingText: actionButtonOpts?.loadingText || actionButtonOpts?.stopText\n        };\n    }\n\n    /**\n     * Gets speech-to-text settings to pass to PromptBox.\n     */\n    private _getSpeechToTextSettings(options: IChatOptions): boolean | object | null {\n        if (options.speechToText === false) {\n            return false;\n        }\n\n        if (this.context.utilsService.isObject(options.speechToText)) {\n            return options.speechToText as object;\n        }\n\n        return null;\n    }\n\n    /**\n     * Gets file attachment settings to pass to PromptBox.\n     */\n    private _getFileAttachmentSettings(options: IChatOptions, enabled: boolean): boolean | object {\n        if (!enabled) {\n            return false;\n        }\n\n        if (this.context.utilsService.isObject(options.fileAttachment)) {\n            return { showSpacer: true, ...(options.fileAttachment as object) };\n        }\n\n        return { showSpacer: true };\n    }\n\n    /**\n     * Handles PromptBox promptAction event.\n     */\n    private _promptBoxAction(e: any): void {\n        e.preventDefault();\n\n        const actionType = e.actionType;\n        const text = e.value || \"\";\n        const files = e.files || [];\n\n        if (actionType === \"stop\") {\n            const eventData = { generating: true };\n            this.trigger(EVENTS.sendMessage, eventData);\n            return;\n        }\n\n        if (!text.length && !files.length) {\n            return;\n        }\n\n        const eventData = { message: { text, files } };\n        this.trigger(EVENTS.sendMessage, eventData);\n    }\n\n    /**\n     * Handles PromptBox fileSelect event.\n     */\n    private _promptBoxFileSelect(e: any): void {\n        const files = this.promptBoxInstance?.files() || [];\n        this.trigger(EVENTS.fileSelect, { files });\n    }\n\n    /**\n     * Handles PromptBox fileRemove event.\n     */\n    private _promptBoxFileRemove(e: any): void {\n        this.trigger(EVENTS.fileRemove, { file: e.file, files: e.files });\n    }\n\n    /**\n     * Attaches event handlers to message box elements.\n     */\n    private _attachEvents(): void {\n        this.wrapper!\n            .on(CLICK + NS, `[${REFERENCES.replyMessageCloseButton}]`, this._replyMessageCloseButtonClick.bind(this))\n            .on(CLICK + NS, DOT + STYLES.suggestion, this._suggestionClick.bind(this))\n            .on(CLICK + NS, `[${REFERENCES.leftScrollButton}]`, this._leftScrollButtonClick.bind(this))\n            .on(CLICK + NS, `[${REFERENCES.rightScrollButton}]`, this._rightScrollButtonClick.bind(this));\n\n        this._attachDragToScrollEvents();\n    }\n\n    /**\n     * Attaches drag-to-scroll events for suggestions.\n     */\n    private _attachDragToScrollEvents(): void {\n        const scrollContainer = this.wrapper!.find(DOT + STYLES.suggestionsScroll);\n        if (!scrollContainer.length) {\n            return;\n        }\n\n        this._dragHandler = this.context.domUtilsService.createDragToScrollHandler(\n            scrollContainer,\n            {\n                namespace: NS + \".chatMessageBoxDrag\",\n                captureElement: this.chatElement\n            }\n        );\n        this._dragHandler.attach();\n    }\n\n    /**\n     * Gets the current files from the PromptBox.\n     */\n    getFiles(): any[] {\n        return this.promptBoxInstance?.files() || [];\n    }\n\n    /**\n     * Sets files on the PromptBox.\n     */\n    setFiles(files: any[]): void {\n        this.promptBoxInstance?.files(files);\n    }\n\n    /**\n     * Clears all file attachments.\n     */\n    clearFiles(): void {\n        this.promptBoxInstance?.clearFiles();\n    }\n\n    private _getPrefixContainer(): IKendoJQuery {\n        let header = this.promptBoxInstance!.wrapper.find(\".k-prompt-box-header\") as IKendoJQuery;\n\n        if (header.length === 0) {\n            header = $('<div class=\"k-prompt-box-header\" ref-promptbox-header><div ref-promptbox-attachments-host></div></div>') as IKendoJQuery;\n            this.promptBoxInstance!.wrapper.prepend(header);\n        }\n\n        return header;\n    }\n\n    /**\n     * Sets a reply message in the message box interface.\n     */\n    setReplyMessage(message: IMessage, isOwnMessage: boolean): void {\n        const options = this.options as IChatOptions;\n        const replyContainer = this.getReplyMessageContainer();\n        const replyTemplate = options.messageReferenceTemplate({\n            text: message.text,\n            files: message.files,\n            isOwnMessage,\n            renderCloseButton: true,\n            renderFileMenuButton: false\n        });\n        const prefixContainer = this._getPrefixContainer();\n\n        prefixContainer.removeClass(\"k-hidden\");\n\n        if (replyContainer.length === 0) {\n            prefixContainer.prepend(replyTemplate);\n        } else {\n            replyContainer.replaceWith(replyTemplate);\n        }\n    }\n\n    /**\n     * Removes the reply message from the message box interface.\n     */\n    removeReplyMessage(): void {\n        const replyContainer = this.getReplyMessageContainer();\n        if (replyContainer.length > 0) {\n            replyContainer.remove();\n            this._updateHeaderVisibility();\n        }\n    }\n\n    private _updateHeaderVisibility(): void {\n        const prefixContainer = this._getPrefixContainer();\n        const files = this.promptBoxInstance?.files() as any[];\n        const hasFiles = files && files.length > 0;\n        const hasReply = this.getReplyMessageContainer().length > 0;\n\n        if (!hasFiles && !hasReply) {\n            prefixContainer.addClass(\"k-hidden\");\n        }\n    }\n\n    /**\n     * Gets the reply message container element.\n     */\n    getReplyMessageContainer(): IKendoJQuery {\n        return this._getPrefixContainer().find(`[${REFERENCES.messageReferenceReplyWrapper}]`) as IKendoJQuery;\n    }\n\n    loading(value?: boolean): boolean | void {\n        if (value === undefined) {\n            return this._generating;\n        }\n\n        this._generating = value;\n        this.promptBoxInstance!.loading(value);\n    }\n\n    value(newValue?: string): string | void {\n        if (newValue === undefined) {\n            return this._getInputValue();\n        }\n\n        this._setInputValue(newValue);\n    }\n\n    // Event handlers\n    private _input(e?: any): void {\n        const currentValue = e?.value ?? this._getInputValue();\n        this.trigger(EVENTS.input, { value: currentValue });\n    }\n\n    private _replyMessageCloseButtonClick(e: any): void {\n        e.preventDefault();\n        this.trigger(EVENTS.replyMessageCloseButtonClick);\n    }\n\n    private _suggestionClick(e: any): void {\n        e.preventDefault();\n        const options = this.options as IChatOptions;\n        const text = $(e.target).closest(DOT + STYLES.suggestion).text();\n        this.trigger(EVENTS.suggestionClick, { text, behavior: options.suggestionsBehavior || \"send\" });\n        if (options.suggestionsBehavior === \"insert\") {\n            this._setInputValue(text);\n        }\n    }\n\n    private _getInputValue(): string {\n        return this.promptBoxInstance!.value();\n    }\n\n    private _setInputValue(value: string): void {\n        this.promptBoxInstance!.value(value);\n    }\n\n    private _leftScrollButtonClick(e: any): void {\n        e.preventDefault();\n        const button = $(e.currentTarget);\n        const scrollableElement = this.wrapper!.find(`${DOT}${STYLES.suggestionsScroll}`);\n        const isRtl = (this.options as IChatOptions).dir === RTL;\n\n        const position = this.context.domUtilsService.scrollByDelta(scrollableElement, isRtl ? SCROLLING_DELTA : -SCROLLING_DELTA);\n\n        this.wrapper!.find(`[${REFERENCES.rightScrollButton}]`).removeClass(STYLES.disabled);\n\n        if (position.atStart) {\n            button.addClass(STYLES.disabled);\n        }\n    }\n\n    private _rightScrollButtonClick(e: any): void {\n        e.preventDefault();\n        const button = $(e.currentTarget);\n        const scrollableElement = this.wrapper!.find(`${DOT}${STYLES.suggestionsScroll}`);\n        const isRtl = (this.options as IChatOptions).dir === RTL;\n\n        const position = this.context.domUtilsService.scrollByDelta(scrollableElement, isRtl ? -SCROLLING_DELTA : SCROLLING_DELTA);\n\n        this.wrapper!.find(`[${REFERENCES.leftScrollButton}]`).removeClass(STYLES.disabled);\n\n        if (position.atEnd) {\n            button.addClass(STYLES.disabled);\n        }\n    }\n\n    destroy(): void {\n        if (this._dragHandler) {\n            this._dragHandler.destroy();\n        }\n\n        if (this.promptBoxInstance) {\n            this.promptBoxInstance.destroy();\n        }\n\n        this.wrapper!.remove();\n    }\n}\n","import \"../../kendo.menu.js\"; // Still required until kendo.ui is modularized\nimport { IKendoJQueryStatic, IKendoJQuery } from \"../../core/index.js\";\nimport { Widget } from \"../../core/base/widget.js\";\nimport { STYLES, DOT, REFERENCES } from \"../constants.js\";\n\ndeclare const kendo: any;\ndeclare const $: IKendoJQueryStatic;\n\n/**\n * MessageMenu provides context menu functionality for chat messages.\n * Handles actions like reply, copy, pin, and delete for individual messages.\n *\n * This is an internal collaborator that extends Widget for event handling.\n */\nexport class MessageMenu extends Widget {\n    static options = {\n        name: \"ChatMessageMenu\",\n        filter: `${DOT}${STYLES.chatBubble}`,\n        dataSource: [] as any[],\n        keyboardAlignToAnchor: true\n    };\n\n    private menu: any;\n\n    /**\n     * Constructs a new MessageMenu instance.\n     */\n    constructor(element: IKendoJQuery, options: any) {\n        super(element, $.extend(true, {}, MessageMenu.options, options));\n\n        this.setCommandAttributes();\n        this.create();\n        this.attachEvents();\n    }\n\n    /**\n     * Creates the underlying Kendo UI ContextMenu.\n     */\n    private create(): void {\n        this.menu = new kendo.ui.ContextMenu(this.element, this.options);\n    }\n\n    /**\n     * Attaches event handlers to the context menu.\n     */\n    private attachEvents(): void {\n        this.menu\n            .bind(\"select\", this.onSelect.bind(this))\n            .bind(\"open\", this.onOpen.bind(this))\n            .bind(\"close\", this.onClose.bind(this));\n    }\n\n    /**\n     * Sets command attributes on menu items for identification.\n     */\n    private setCommandAttributes(): void {\n        (this.options as any).dataSource.forEach((item: any) => {\n            item.attr = item.attr || {};\n            item.attr[\"data-command\"] = item.name.toLowerCase();\n        });\n    }\n\n    /**\n     * Handles menu item selection.\n     */\n    private onSelect(e: any): void {\n        const item = $(e.item);\n        const message = $(e.target).closest(DOT + STYLES.message) as IKendoJQuery;\n        const command = item.data(\"command\");\n\n        if (command) {\n            this.executeCommand(command, item, message);\n        }\n    }\n\n    /**\n     * Handles menu open event.\n     */\n    onOpen(e: any): void {\n        let setActive = true;\n        const target = $(e.target);\n        const originalTarget = $(e.event?.target).length ? $(e.event.target) : target;\n\n        const isMessageRemoved = target.closest(DOT + STYLES.messageRemoved).length > 0;\n        const hasTypingIndicator = target.find(DOT + STYLES.typingIndicator).length > 0;\n        const isAttachmentMenuButton = originalTarget.closest(`[${REFERENCES.fileMenuButton}]`).length > 0;\n        const message = target.closest(DOT + STYLES.message);\n\n        if (isMessageRemoved || hasTypingIndicator || isAttachmentMenuButton || !message.length) {\n            e.preventDefault();\n            setActive = false;\n        }\n\n        target.toggleClass(STYLES.active, setActive);\n        this.trigger(\"open\", { message });\n    }\n\n    /**\n     * Handles menu close event.\n     */\n    private onClose(e: any): void {\n        const target = $(e.target);\n        const message = target.closest(DOT + STYLES.message);\n        target.removeClass(STYLES.active);\n        this.trigger(\"close\", { message });\n    }\n\n    /**\n     * Executes a command from the menu.\n     */\n    private executeCommand(command: string, item: IKendoJQuery, message: IKendoJQuery): void {\n        this.trigger(\"execute\", { type: command, item, message });\n    }\n\n    /**\n     * Toggles the visibility of the delete menu item.\n     */\n    toggleDeleteVisibility(visible: boolean): void {\n        const deleteItem = this.element.find(\"[data-command='delete']\");\n        if (deleteItem.length) {\n            deleteItem.toggleClass(STYLES.hidden, !visible);\n        }\n    }\n\n    destroy(): void {\n        if (this.menu) {\n            this.menu.destroy();\n            this.menu = null;\n            this.element.remove();\n        }\n    }\n}\n","import { COMMANDS, EVENTS } from \"../constants\";\nimport type { IMessage } from \"../models\";\nimport type { IFile } from \"../../upload\";\nimport type { IKendoJQuery } from \"../../core\";\n\nexport interface ICommandHandlerContext {\n    getUserId: () => string;\n    dataItem: (message: IKendoJQuery) => IMessage | null;\n    fileDataItem: (message: IMessage, file: IKendoJQuery) => IFile | null;\n    removeMessage: (message: IMessage) => boolean;\n    pinMessage: (message: IMessage) => void;\n    setReplyMessage: (message: IMessage, isOwnMessage: boolean) => void;\n    setCurrentMessageReplyId: (id: string) => void;\n    setupAriaAttributes: () => void;\n    toggleDeleteVisibility: (isAuthor: boolean) => void;\n    trigger: (event: string, args?: any) => void;\n}\n\nexport class CommandHandler {\n    private context: ICommandHandlerContext;\n\n    constructor(context: ICommandHandlerContext) {\n        this.context = context;\n    }\n\n    commandExecute(e: any): void {\n        const message = this.context.dataItem(e.message);\n        const file = this.context.fileDataItem(message!, e.file);\n        const type = e.type;\n\n        if (!file) {\n            switch (type) {\n                case COMMANDS.reply:\n                    this.messageReply(message!);\n                    break;\n                case COMMANDS.copy:\n                    this.messageCopy(message!);\n                    break;\n                case COMMANDS.pin:\n                    this.messagePin(message!);\n                    break;\n                case COMMANDS.delete:\n                    this.messageDelete(message!);\n                    break;\n            }\n        } else {\n            switch (type) {\n                case COMMANDS.download:\n                    this.context.trigger(EVENTS.download, { files: [file], message });\n                    break;\n            }\n            this.context.trigger(EVENTS.fileMenuAction, { type, file, message });\n        }\n    }\n\n    contextMenuExecute(e: any): void {\n        this.commandExecute(e);\n        const message = this.context.dataItem(e.message);\n        const type = e.type;\n        this.context.trigger(EVENTS.contextMenuAction, { type, message });\n    }\n\n    messageReply(message: IMessage): void {\n        const isOwnMessage = message.authorId === this.context.getUserId();\n        this.context.setCurrentMessageReplyId(message.id);\n        this.context.setReplyMessage(message, isOwnMessage);\n        this.context.setupAriaAttributes();\n    }\n\n    messageCopy(message: IMessage): void {\n        if (navigator && navigator.clipboard) {\n            navigator.clipboard.writeText(message.text);\n        }\n    }\n\n    messagePin(message: IMessage): void {\n        this.context.pinMessage(message);\n    }\n\n    messageDelete(message: IMessage): void {\n        this.context.removeMessage(message);\n    }\n\n    messageContextMenuOpen(e: any): void {\n        const message = this.context.dataItem(e.message);\n\n        if (!message) {\n            return;\n        }\n\n        const isAuthor = message.authorId === this.context.getUserId();\n        this.context.toggleDeleteVisibility(isAuthor);\n    }\n}\n","import { NS, STYLES, REFERENCES, EVENTS, CLICK, KEYDOWN, DOT } from \"../constants\";\nimport type { IChatOptions, IMessage } from \"../models\";\nimport type { IKendoJQuery } from \"../../core\";\n\ndeclare const $: any;\n\nexport interface IEventWiringContext {\n    options: IChatOptions;\n    wrapper: IKendoJQuery;\n    view: {\n        bind: (event: string, handler: (...args: any[]) => void) => any;\n    };\n    messageBox: {\n        bind: (event: string, handler: (...args: any[]) => void) => any;\n    };\n    messageContextMenu: {\n        bind: (event: string, handler: (...args: any[]) => void) => any;\n    };\n    value: (newValue?: string) => string | void;\n    postMessage: (message: string | Partial<IMessage>) => IMessage;\n    clearReplyState: () => void;\n    commandExecute: (e: any) => void;\n    contextMenuExecute: (e: any) => void;\n    messageContextMenuOpen: (e: any) => void;\n    dataItem: (message: IKendoJQuery) => IMessage | null;\n    scrollToMessage: (uid: string) => boolean;\n    clearPinnedMessage: () => void;\n    getPinnedMessage: () => IMessage | null;\n    getMessageById: (id: string) => IMessage | null;\n    trigger: (event: string, args?: any) => void;\n    accessibility: {\n        updateExpandableIndicatorAria: (indicator: any, isExpanded: boolean) => void;\n        handleKeyDown: (e: any, messageBox: any) => void;\n        setupAriaAttributes: () => void;\n    };\n    messageBoxRef: any;\n}\n\nexport class EventWiring {\n    private context: IEventWiringContext;\n\n    constructor(context: IEventWiringContext) {\n        this.context = context;\n    }\n\n    attach(): void {\n        this._attachViewEvents();\n        this._attachMessageBoxEvents();\n        this._attachContextMenuEvents();\n        this._attachWrapperDomEvents();\n    }\n\n    private _attachViewEvents(): void {\n        const ctx = this.context;\n\n        ctx.view\n            .bind(\"suggestedActionClick\", (args: any) => {\n                const options = ctx.options;\n                if (options.suggestionsBehavior === \"insert\") {\n                    ctx.value(args.text);\n                    ctx.trigger(EVENTS.suggestionClick, { text: args.text });\n                } else {\n                    const message = { text: args.text, files: [] };\n                    ctx.trigger(EVENTS.sendMessage, { message });\n                    ctx.postMessage(message);\n                }\n            })\n            .bind(\"messageToolbarExecute\", (args: any) => {\n                const message = ctx.dataItem(args.message);\n                ctx.commandExecute({ type: args.type, message: args.message });\n                ctx.trigger(EVENTS.toolbarAction, { type: args.type, message });\n            })\n            .bind(\"fileMenuExecute\", (args: any) => {\n                ctx.commandExecute(args);\n            })\n            .bind(\"downloadAllFiles\", (args: any) => {\n                const message = ctx.dataItem(args.messageElement);\n                ctx.trigger(EVENTS.download, { files: message?.files, message });\n            })\n            .bind(\"expandableToggle\", (args: any) => {\n                ctx.accessibility.updateExpandableIndicatorAria(args.indicator, args.isExpanded);\n            });\n    }\n\n    private _attachMessageBoxEvents(): void {\n        const ctx = this.context;\n\n        ctx.messageBox\n            .bind(\"input\", (args: any) => {\n                ctx.trigger(EVENTS.input, { value: args.value });\n            })\n            .bind(\"sendMessage\", (args: any) => {\n                const generating = args.generating;\n\n                if (generating) {\n                    ctx.trigger(EVENTS.sendMessage, { generating });\n                } else {\n                    const message = { text: args.text || args.message?.text, files: args.files || args.message?.files || [] };\n                    ctx.trigger(EVENTS.sendMessage, { message });\n                    ctx.postMessage(message);\n                    ctx.clearReplyState();\n                }\n            })\n            .bind(\"suggestionClick\", (args: any) => {\n                ctx.trigger(EVENTS.suggestionClick, { text: args.text });\n                if (args.behavior !== \"insert\") {\n                    const message = { text: args.text, files: [] };\n                    ctx.trigger(EVENTS.sendMessage, { message });\n                    ctx.postMessage(message);\n                }\n            })\n            .bind(\"fileSelect\", (args: any) => {\n                ctx.trigger(EVENTS.fileSelect, { files: args.files });\n            })\n            .bind(\"fileRemove\", (args: any) => {\n                ctx.trigger(EVENTS.fileRemove, { file: args.file, files: args.files });\n            })\n            .bind(\"replyMessageCloseButtonClick\", () => {\n                ctx.clearReplyState();\n            });\n    }\n\n    private _attachContextMenuEvents(): void {\n        const ctx = this.context;\n\n        ctx.messageContextMenu\n            .bind(\"execute\", ctx.contextMenuExecute.bind(ctx))\n            .bind(\"open\", ctx.messageContextMenuOpen.bind(ctx));\n    }\n\n    private _attachWrapperDomEvents(): void {\n        const ctx = this.context;\n\n        ctx.wrapper.on(CLICK + NS, `[${REFERENCES.pinnedMessageCloseButton}]`, () => {\n            ctx.trigger(EVENTS.unpin, { message: ctx.getPinnedMessage() });\n            ctx.clearPinnedMessage();\n        });\n\n        ctx.wrapper.on(CLICK + NS, `[${REFERENCES.messageReferencePinWrapper}]`, (e: any) => {\n            if ($(e.target).closest(`[${REFERENCES.pinnedMessageCloseButton}]`).length) {\n                return;\n            }\n\n            if ($(e.target).is(\"a\")) {\n                return;\n            } else {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n\n            const pinnedMessage = ctx.getPinnedMessage();\n\n            if (pinnedMessage && pinnedMessage.uid) {\n                ctx.scrollToMessage(pinnedMessage.uid);\n            }\n        });\n\n        ctx.wrapper.on(CLICK + NS, `[${REFERENCES.messageReferenceReplyWrapper}]`, (e: any) => {\n            if ($(e.target).is(\"a\")) {\n                return;\n            } else {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n\n            const messageElement = $(e.currentTarget).closest(DOT + STYLES.message);\n            const currentMessage = ctx.dataItem(messageElement);\n\n            if (currentMessage && currentMessage.replyToId) {\n                const originalMessage = ctx.getMessageById(currentMessage.replyToId);\n\n                if (originalMessage && originalMessage.uid) {\n                    ctx.scrollToMessage(originalMessage.uid);\n                }\n            }\n        });\n\n        ctx.wrapper.on(KEYDOWN + NS, (e: any) => {\n            ctx.accessibility.handleKeyDown(e as any, ctx.messageBoxRef);\n        });\n\n        ctx.wrapper.on(`focus${NS}`, `.${STYLES.bubble}`, (e: any) => {\n            const bubbleElement = $(e.target);\n\n            if (bubbleElement.find(`.${STYLES.typingIndicator}`).length > 0) {\n                return;\n            }\n\n            if (bubbleElement.attr(\"data-keyboard-focus\") === \"true\") {\n                const messageElement = bubbleElement.closest(`.${STYLES.message}`);\n                const message = ctx.dataItem(messageElement);\n\n                if (message && message.uid) {\n                    ctx.scrollToMessage(message.uid);\n                }\n            }\n        });\n    }\n}\n","import { Widget } from \"../core/base/widget\";\nimport { inject } from \"../core/service-container\";\nimport { UtilsService } from \"../core/services/utils.service\";\nimport { DomUtilsService } from \"../core/services/dom-utils.service\";\nimport { HtmlService } from \"../core/services/html.service\";\nimport { DateParserService } from \"../core/services/date-parser.service\";\nimport { IKendoJQuery } from \"../core/models/kendo-jquery\";\nimport {\n    DataManager,\n    ChatView,\n    MessageBox,\n    MessageMenu,\n    AccesibilityManager\n} from \"./collaborators\";\nimport {\n    STYLES,\n    REFERENCES,\n    EVENTS,\n    ICONS,\n    COMMANDS,\n    CHANGE,\n    DOT,\n    LTR\n} from \"./constants\";\nimport {\n    renderMessageGroup,\n    renderMessageReference,\n    renderFiles,\n    renderSuggestions,\n    renderHeader\n} from \"./templates\";\nimport type {\n    IChatOptions,\n    IMessage,\n    IMenuAction\n} from \"./models\";\nimport type { IFile } from \"../upload\";\nimport { CommandHandler, EventWiring } from \"./helpers\";\n\ndeclare const $: any;\n\nconst DEFAULT_MESSAGE_ACTIONS: IMenuAction[] = [\n    { name: COMMANDS.reply, text: \"Reply\", icon: ICONS.undo },\n    { name: COMMANDS.copy, text: \"Copy\", icon: ICONS.copy },\n    { name: COMMANDS.pin, text: \"Pin\", icon: ICONS.pin },\n    { name: COMMANDS.delete, text: \"Delete\", icon: ICONS.trash }\n];\n\nconst DEFAULT_FILE_ACTIONS: IMenuAction[] = [\n    { name: COMMANDS.download, text: \"Download\", icon: ICONS.download }\n];\n\nconst DEFAULT_MESSAGES = {\n    messageListLabel: \"Message list\",\n    placeholder: \"Type a message...\",\n    sendButton: \"Send message\",\n    sendButtonLoading: \"Stop\",\n    actionButton: \"Send message\",\n    actionButtonLoading: \"Stop\",\n    stopButton: \"Stop\",\n    speechToTextButton: \"Toggle speech to text\",\n    fileButton: \"Attach file\",\n    downloadAll: \"Download all\",\n    selfMessageDeleted: \"You removed this message.\",\n    otherMessageDeleted: \"This message was removed by its sender.\",\n    stopGeneration: \"Stop generation\",\n    messageBoxLabel: \"Type your message here\",\n    pinnedMessageCloseButton: \"Unpin message\",\n    replyMessageCloseButton: \"Remove reply\",\n    fileMenuButton: \"File menu\",\n    retryMessage: \"Retry\"\n};\n\nexport class Chat extends Widget<IChatOptions> {\n    static options: Partial<IChatOptions> = {\n        name: \"Chat\",\n        autoAssignId: true,\n        autoBind: true,\n        allowMessageCollapse: false,\n        showUsername: true,\n        showAvatar: true,\n        timestampVisibility: \"always\",\n        suggestionsBehavior: \"insert\",\n        authorId: null,\n        suggestionsScrollable: false,\n        suggestedActionsScrollable: false,\n        suggestionsLayoutMode: \"scroll\",\n        suggestedActionsLayoutMode: \"scroll\",\n        speechToText: true,\n        fileAttachment: true,\n        scrollToBottomButton: true,\n        loading: false,\n        messageBox: {\n            mode: \"multi\",\n            maxTextAreaHeight: 110\n        },\n        messageToolbarActions: [],\n        messageActions: DEFAULT_MESSAGE_ACTIONS,\n        fileActions: DEFAULT_FILE_ACTIONS,\n        suggestions: [],\n        headerItems: [],\n        dir: LTR,\n        messageTimeFormat: \"ddd MMM dd yyyy\",\n        width: null,\n        height: null,\n        messages: DEFAULT_MESSAGES,\n        messageWidthMode: \"standard\",\n        messageTemplate: null,\n        messageGroupTemplate: renderMessageGroup,\n        messageReferenceTemplate: renderMessageReference,\n        filesTemplate: renderFiles,\n        suggestionsTemplate: renderSuggestions,\n        suggestedActionsTemplate: renderSuggestions,\n        timestampTemplate: null,\n        messageStatusTemplate: null,\n        messageStatusSettings: null,\n        headerTemplate: null,\n        noDataTemplate: null,\n        messageContentTemplate: null,\n        authorMessageTemplate: null,\n        receiverMessageTemplate: null,\n        authorMessageContentTemplate: null,\n        receiverMessageContentTemplate: null,\n        userStatusTemplate: null,\n        attachmentTemplate: null,\n        messageBoxTemplate: null,\n        authorMessageSettings: null,\n        receiverMessageSettings: null,\n        actionButton: null,\n        attachmentLayout: \"list\",\n        filesLayoutMode: \"vertical\",\n        textField: \"text\",\n        authorIdField: \"authorId\",\n        authorNameField: \"authorName\",\n        authorImageUrlField: \"authorImageUrl\",\n        authorImageAltTextField: \"authorImageAltText\",\n        idField: \"id\",\n        timestampField: \"timestamp\",\n        filesField: \"files\",\n        replyToIdField: \"replyToId\",\n        isDeletedField: \"isDeleted\",\n        isPinnedField: \"isPinned\",\n        isTypingField: \"isTyping\",\n        statusField: \"status\",\n        failedField: \"failed\",\n        attachmentsField: \"attachments\",\n        attachmentLayoutField: \"attachmentLayout\",\n        skipSanitization: false\n    };\n\n    _dataManager!: DataManager;\n    view!: ChatView;\n    messageBox!: MessageBox;\n    private messageContextMenu!: MessageMenu;\n    private accessibility!: AccesibilityManager;\n    private _commandHandler!: CommandHandler;\n    private _eventWiring!: EventWiring;\n    private currentMessageReplyId: string | null = null;\n    private _hasHeader = false;\n    private _refreshHandler!: () => void;\n    private _loading = false;\n    private utilsService: UtilsService;\n    private domUtilsService: DomUtilsService;\n    private htmlService: HtmlService;\n    private dateParserService: DateParserService;\n    dataSource: any;\n\n    events: string[] = [\n        EVENTS.sendMessage,\n        EVENTS.suggestionClick,\n        EVENTS.unpin,\n        EVENTS.input,\n        EVENTS.toolbarAction,\n        EVENTS.fileMenuAction,\n        EVENTS.contextMenuAction,\n        EVENTS.download,\n        EVENTS.fileSelect,\n        EVENTS.fileRemove,\n        EVENTS.executeAction,\n        EVENTS.resendMessage\n    ];\n\n    /**\n     * Creates a new Chat widget instance.\n     *\n     * @param element - The DOM element to attach the widget to\n     * @param options - Configuration options\n     * @param events - Optional event handlers\n     * @param utilsService - Utility service (injected)\n     */\n    constructor(\n        element: HTMLElement | IKendoJQuery,\n        options?: Partial<IChatOptions>,\n        events?: string[],\n        utilsService = inject(UtilsService),\n        domUtilsService = inject(DomUtilsService),\n        htmlService = inject(HtmlService),\n        dateParserService = inject(DateParserService)\n    ) {\n        options = options || {};\n        Chat.mergeContextMenuActions(options, Chat.options, \"messageActions\");\n        Chat.mergeContextMenuActions(options, Chat.options, \"fileActions\");\n\n        super(element, $.extend(true, {}, Chat.options, options));\n\n        this.utilsService = utilsService;\n        this.domUtilsService = domUtilsService;\n        this.htmlService = htmlService;\n        this.dateParserService = dateParserService;\n        (this.options as IChatOptions).messageActions = options.messageActions as IMenuAction[];\n        (this.options as IChatOptions).fileActions = options.fileActions as IMenuAction[];\n\n        if (events) {\n            this._events = events as any;\n        }\n\n        this._init(options);\n    }\n\n    static mergeContextMenuActions(\n        options: Partial<IChatOptions>,\n        defaultOptions: Partial<IChatOptions>,\n        property: \"messageActions\" | \"fileActions\"\n    ): void {\n        const userActions = options[property];\n\n        if (Array.isArray(userActions)) {\n            const defaultActions = defaultOptions[property] || [];\n            const defaultMap: Record<string, IMenuAction> = {};\n\n            for (const action of defaultActions) {\n                defaultMap[action.name] = { ...action };\n            }\n\n            options[property] = userActions.map(userAction => {\n                if (userAction.name in defaultMap) {\n                    return { ...defaultMap[userAction.name], ...userAction };\n                }\n                return { ...userAction };\n            });\n        } else {\n            options[property] = defaultOptions[property] || [];\n        }\n    }\n\n    private _init(options: Partial<IChatOptions>): void {\n        this.currentMessageReplyId = null;\n        this._hasHeader = !!(options.headerItems?.length);\n\n        this._initUser();\n        this._initWrapper();\n        this._initDataSource();\n        this._initView();\n\n        if (options?.toolbar) {\n            this.utilsService.logToConsole(\"The 'toolbar' option has been deprecated.\", \"warn\");\n        }\n\n        this._initMessageBox();\n        this._initMenus();\n        this._initAccessibility();\n\n        this._attachEvents();\n\n        if (this.options.loading) {\n            this.loading(true);\n        }\n\n        if (this.options.autoBind) {\n            this.dataSource.fetch();\n        }\n\n        this.scrollToBottom();\n    }\n\n    private _initUser(): void {\n        const options = this.options as IChatOptions;\n\n        if (options.authorId) {\n            options.authorId = options.authorId.toString();\n            return;\n        }\n\n        options.authorId = this.utilsService.guid();\n    }\n\n    private _initWrapper(): void {\n        const options = this.options as IChatOptions;\n        const height = options.height;\n        const width = options.width;\n        const headerItems = options.headerItems;\n        const headerTemplate = options.headerTemplate;\n        const uiElements = `<div ${REFERENCES.viewWrapper}></div>`;\n\n        this.wrapper = this.element\n            .addClass(STYLES.wrapper)\n            .attr(\"dir\", options.dir)\n            .append(uiElements);\n\n        if (this._hasHeader || headerTemplate) {\n            this.wrapper.prepend(renderHeader(headerItems, headerTemplate));\n        }\n\n        if (height) {\n            this.wrapper.css({\n                height: height,\n                minHeight: height\n            });\n        }\n\n        if (width) {\n            this.wrapper.css({\n                width: width,\n                minWidth: width\n            });\n        }\n    }\n\n    private _initDataSource(): void {\n        this._refreshHandler = this.refresh.bind(this);\n\n        this._dataManager = new DataManager({\n            chatOptions: this.options as IChatOptions,\n            utilsService: this.utilsService\n        });\n        this.dataSource = this._dataManager.getDataSource();\n\n        this.dataSource.bind(CHANGE, this._refreshHandler);\n    }\n\n    private _unbindDataSource(): void {\n        this.dataSource.unbind(CHANGE, this._refreshHandler);\n        (this as any)._dataManager = null;\n    }\n\n    private _initView(): void {\n        const options = $.extend(true, {}, this.options);\n        delete options.name;\n\n        const element = this.wrapper!.find(`[${REFERENCES.viewWrapper}]`) as IKendoJQuery;\n\n        this.view = new ChatView(element, options, {\n            dataManager: this._dataManager,\n            domUtilsService: this.domUtilsService,\n            htmlService: this.htmlService,\n            dateParserService: this.dateParserService\n        });\n    }\n\n    private _initMessageBox(): void {\n        const options = $.extend(true, {}, this.options);\n        delete options.name;\n\n        this.messageBox = new MessageBox($('<textarea></textarea>'), options, {\n            chatElement: this.wrapper!,\n            utilsService: this.utilsService,\n            domUtilsService: this.domUtilsService\n        });\n    }\n\n    private _initMenus(): void {\n        const options = this.options as IChatOptions;\n        const messageActions = options.messageActions;\n\n        this.messageContextMenu = new MessageMenu($(\"<ul></ul>\"), { dataSource: messageActions });\n    }\n\n    private _initAccessibility(): void {\n        this.accessibility = new AccesibilityManager({\n            wrapper: this.wrapper!,\n            getOptions: () => this.options,\n            utilsService: this.utilsService\n        });\n\n        this.accessibility.setupAriaAttributes();\n        this.accessibility.setupBubbleTabNavigation();\n    }\n\n    private _attachEvents(): void {\n        this._commandHandler = new CommandHandler({\n            getUserId: this.getUserId.bind(this),\n            dataItem: this.dataItem.bind(this),\n            fileDataItem: this.fileDataItem.bind(this),\n            removeMessage: this.removeMessage.bind(this),\n            pinMessage: (message: IMessage) => this._dataManager.pinMessage(message),\n            setReplyMessage: (message: IMessage, isOwnMessage: boolean) => this.messageBox.setReplyMessage(message, isOwnMessage),\n            setCurrentMessageReplyId: (id: string) => { this.currentMessageReplyId = id; },\n            setupAriaAttributes: () => this.accessibility.setupAriaAttributes(),\n            toggleDeleteVisibility: (isAuthor: boolean) => this.messageContextMenu.toggleDeleteVisibility(isAuthor),\n            trigger: this.trigger.bind(this)\n        });\n\n        this._eventWiring = new EventWiring({\n            options: this.options as IChatOptions,\n            wrapper: this.wrapper!,\n            view: this.view,\n            messageBox: this.messageBox,\n            messageContextMenu: this.messageContextMenu,\n            value: this.value.bind(this),\n            postMessage: this.postMessage.bind(this),\n            clearReplyState: this.clearReplyState.bind(this),\n            commandExecute: this._commandHandler.commandExecute.bind(this._commandHandler),\n            contextMenuExecute: this._commandHandler.contextMenuExecute.bind(this._commandHandler),\n            messageContextMenuOpen: this._commandHandler.messageContextMenuOpen.bind(this._commandHandler),\n            dataItem: this.dataItem.bind(this),\n            scrollToMessage: this.scrollToMessage.bind(this),\n            clearPinnedMessage: this.clearPinnedMessage.bind(this),\n            getPinnedMessage: () => this._dataManager.getPinnedMessage(),\n            getMessageById: (id: string) => this._dataManager.getMessageById(id),\n            trigger: this.trigger.bind(this),\n            accessibility: this.accessibility,\n            messageBoxRef: this.messageBox\n        });\n\n        this._eventWiring.attach();\n\n        this.bind(this.events, this.options);\n    }\n\n    getUserId(): string {\n        return (this.options as IChatOptions).authorId!;\n    }\n\n    /**\n     * Gets or sets the input value of the message box.\n     * @param value - Optional value to set. If provided, sets the input value.\n     * @returns The current input value when called without arguments.\n     */\n    value(newValue?: string): string | void {\n        if (newValue === undefined) {\n            return this.messageBox?.value() || \"\";\n        }\n\n        if (this.messageBox) {\n            this.messageBox.value(newValue);\n            this.trigger(EVENTS.input, { value: newValue });\n        }\n    }\n\n    /**\n     * Sets new options for the widget.\n     */\n    setOptions(options: Partial<IChatOptions>): void {\n        super.setOptions(options);\n        this.destroy();\n        const chat = new Chat(this.element, this.options as Partial<IChatOptions>);\n        Object.assign(this, chat);\n    }\n\n    /**\n     * Sets a new data source.\n     */\n    setDataSource(dataSource: any): void {\n        if (this.dataSource) {\n            this._unbindDataSource();\n        }\n\n        this.view.clearMessages();\n\n        (this.options as IChatOptions).dataSource = dataSource;\n\n        this._initDataSource();\n\n        if ((this.options as IChatOptions).autoBind) {\n            this.dataSource.fetch();\n        }\n\n        if (this.view) {\n            this.view.refreshDataManager(this._dataManager);\n        }\n    }\n\n    /**\n     * Posts a new message to the chat.\n     */\n    postMessage(message: string | Partial<IMessage>): IMessage {\n        if (this.currentMessageReplyId) {\n            if (typeof message === \"string\") {\n                message = { text: message };\n            }\n            message.replyToId = this.currentMessageReplyId;\n        }\n\n        return this._dataManager.postMessage(message, this.getUserId());\n    }\n\n    /**\n     * Removes a message (marks as deleted).\n     */\n    removeMessage(message: IMessage): boolean {\n        return this._dataManager.removeMessage(message);\n    }\n\n    /**\n     * Updates an existing message.\n     */\n    updateMessage(message: IMessage, newData: Partial<IMessage>): IMessage | null {\n        return this._dataManager.updateMessage(message, newData);\n    }\n\n    /**\n     * Gets a message by its UID.\n     */\n    getMessageByUid(uid: string): IMessage | null {\n        return this._dataManager.getMessageByUid(uid);\n    }\n\n    /**\n     * Gets the data item for a message element.\n     */\n    dataItem(message: IKendoJQuery): IMessage | null {\n        return this.view.dataItem(message);\n    }\n\n    /**\n     * Gets the file data item for a file element.\n     */\n    fileDataItem(message: IMessage, file: IKendoJQuery): IFile | null {\n        return this.view.fileDataItem(message, file);\n    }\n\n    /**\n     * Clears all messages from the view.\n     */\n    clearMessages(): void {\n        this.view.clearMessages();\n    }\n\n    /**\n     * @internal\n     * Renders a message in the view.\n     */\n    renderMessage(message: IMessage): void {\n        this.view.renderMessage(message);\n        this.accessibility.setupBubbleTabNavigation();\n    }\n\n    /**\n     * @internal\n     * Renders a pinned message.\n     * The pinned message is positioned sticky inside the message list per Chat v3 spec.\n     */\n    renderPinnedMessage(message: IMessage): void {\n        const isOwnMessage = message.authorId === this.getUserId();\n        const options = this.options as IChatOptions;\n        const pinnedMessageElement = $(options.messageReferenceTemplate({\n            text: message.text,\n            files: message.files,\n            isDeleted: message.isDeleted,\n            isOwnMessage,\n            messages: options.messages,\n            isPinMessage: true,\n            renderCloseButton: true,\n            renderFileMenuButton: false\n        }));\n\n        this.wrapper!.find(`[${REFERENCES.messageReferencePinWrapper}]`).remove();\n\n        const messageList = this.wrapper!.find(DOT + STYLES.viewWrapper);\n        if (messageList.length) {\n            messageList.prepend(pinnedMessageElement);\n        } else if (this._hasHeader) {\n            pinnedMessageElement.insertAfter(this.wrapper!.find(DOT + STYLES.header));\n        } else {\n            this.wrapper!.prepend(pinnedMessageElement);\n        }\n\n        this.view._initFileMenus(pinnedMessageElement);\n    }\n\n    /**\n     * Clears the pinned message.\n     */\n    clearPinnedMessage(): void {\n        this._dataManager.clearPinnedMessage();\n        this.wrapper!.find(DOT + STYLES.messagePinned).remove();\n    }\n\n    /**\n     * Clears the reply state.\n     */\n    clearReplyState(): void {\n        this.messageBox.removeReplyMessage();\n        this.currentMessageReplyId = null;\n    }\n\n    /**\n     * Scrolls the chat to the bottom.\n     */\n    scrollToBottom(): void {\n        this.view.scrollToBottom();\n    }\n\n    /**\n     * Scrolls to a specific message.\n     */\n    scrollToMessage(uid: string): boolean {\n        return this.view.scrollToMessage(uid);\n    }\n\n    /**\n     * Gets or sets the loading state (transforms send button to stop button).\n     */\n    loading(value?: boolean): boolean | void {\n        if (value === undefined) {\n            return this._loading;\n        }\n\n        this._loading = value;\n        if (this.wrapper) {\n            this.wrapper.toggleClass(STYLES.generating, value);\n        }\n        if (this.messageBox) {\n            this.messageBox.loading(value);\n        }\n    }\n\n    /**\n     * @deprecated Use `loading()` instead. Will be removed in future version.\n     */\n    toggleSendButtonGenerating(value: boolean): void {\n        this.loading(value);\n    }\n\n    /**\n     * @internal\n     * Refreshes the chat view when data changes.\n     */\n    refresh(e?: any): void {\n        const that = this;\n        const options = this.options as IChatOptions;\n        const data = that.dataSource.view();\n        const pinnedMessage = data.find((item: IMessage) => item.isPinned);\n        const changedItems = e?.changedItems || [];\n\n        if (!e || !e.action) {\n            if (data.length === 0 && options.noDataTemplate) {\n                const noDataHtml = options.noDataTemplate();\n                that.view.showNoData(noDataHtml);\n            } else {\n                that.view.clearMessages();\n                data.forEach((item: IMessage) => {\n                    that.renderMessage(item);\n                });\n            }\n            that.scrollToBottom();\n        }\n\n        if (pinnedMessage) {\n            that.renderPinnedMessage(pinnedMessage);\n        }\n\n        if (e?.action === \"sync\") {\n            if (options.noDataTemplate && !that.view.hasMessages()) {\n                that.view.clearMessages();\n            }\n\n            const message = changedItems.length ? changedItems[0] : data[data.length - 1];\n            that.renderMessage(message);\n\n            if (!changedItems.length) {\n                that.scrollToBottom();\n            }\n        }\n\n        that.view.renderSuggestedActions();\n        that.accessibility.setupAriaAttributes();\n        that.accessibility.setupBubbleTabNavigation();\n    }\n\n    /**\n     * @internal\n     */\n    commandExecute(e: any): void {\n        this._commandHandler.commandExecute(e);\n    }\n\n    /**\n     * @internal\n     */\n    messageReply(message: IMessage): void {\n        this._commandHandler.messageReply(message);\n    }\n\n    /**\n     * @internal\n     * Copies message text to clipboard.\n     */\n    messageCopy(message: IMessage): void {\n        this._commandHandler.messageCopy(message);\n    }\n\n    /**\n     * @internal\n     * Pins a message.\n     */\n    messagePin(message: IMessage): void {\n        this._commandHandler.messagePin(message);\n    }\n\n    /**\n     * @internal\n     * Deletes a message.\n     */\n    messageDelete(message: IMessage): void {\n        this._commandHandler.messageDelete(message);\n    }\n\n    /**\n     * @internal\n     */\n    messageContextMenuOpen(e: any): void {\n        this._commandHandler.messageContextMenuOpen(e);\n    }\n\n    /**\n     * Destroys the widget and cleans up resources.\n     */\n    destroy(): void {\n        if (this.dataSource) {\n            this._unbindDataSource();\n            this.dataSource = null;\n        }\n\n        if (this.view) {\n            this.view.unbind();\n            this.view.destroy();\n            this.view = null;\n        }\n\n        if (this.messageBox) {\n            this.messageBox.unbind();\n            this.messageBox.destroy();\n            this.messageBox = null;\n        }\n\n        if (this.messageContextMenu) {\n            this.messageContextMenu.destroy();\n        }\n\n        if (this.wrapper) {\n            this.wrapper.off();\n            this.wrapper.empty();\n            this.wrapper = null;\n        }\n\n        super.destroy();\n    }\n}\n","/**\n * DOM utility type definitions\n */\n\nimport { ISupportService } from \"./support\";\n\n/**\n * Offset result from element position calculations\n */\nexport interface ElementOffset {\n    top: number;\n    right: number;\n    bottom: number;\n    left: number;\n}\n\n/**\n * Dimensions for hidden elements\n */\nexport interface HiddenDimensions {\n    width: number;\n    height: number;\n}\n\n/**\n * Shadow dimensions from box-shadow CSS\n */\nexport interface ShadowDimensions {\n    left: number;\n    right: number;\n    bottom: number;\n}\n\n/**\n * Parsed effects object\n */\nexport interface ParsedEffects {\n    [key: string]: string;\n}\n\n/**\n * Direction mapping for animations\n */\nexport interface DirectionInfo {\n    reverse: string;\n}\n\n/**\n * Animation directions\n */\nexport const DIRECTIONS: Record<string, DirectionInfo> = {\n    left: { reverse: \"right\" },\n    right: { reverse: \"left\" },\n    down: { reverse: \"up\" },\n    up: { reverse: \"down\" },\n    top: { reverse: \"bottom\" },\n    bottom: { reverse: \"top\" },\n    \"in\": { reverse: \"out\" },\n    out: { reverse: \"in\" }\n};\n\n/**\n * Interface for DOM utility service\n */\nexport interface IDomUtilsService {\n    /**\n     * Get outer width of element\n     * @param element - Element to measure\n     * @param includeMargin - Whether to include margin\n     * @param calculateFromHidden - Calculate width even if hidden\n     */\n    outerWidth(element: HTMLElement | JQuery | Window, includeMargin?: boolean, calculateFromHidden?: boolean): number;\n\n    /**\n     * Get outer height of element\n     * @param element - Element to measure\n     * @param includeMargin - Whether to include margin\n     * @param calculateFromHidden - Calculate height even if hidden\n     */\n    outerHeight(element: HTMLElement | JQuery | Window, includeMargin?: boolean, calculateFromHidden?: boolean): number;\n\n    /**\n     * Get computed styles for an element\n     */\n    getComputedStyles(element: HTMLElement, properties?: string[]): Record<string, string>;\n\n    /**\n     * Check if an element is scrollable\n     */\n    isScrollable(element: HTMLElement): boolean;\n\n    /**\n     * Get or set scroll left position (RTL-aware)\n     */\n    scrollLeft(element: HTMLElement | JQuery, value?: number): number | void;\n\n    /**\n     * Get element offset position\n     */\n    getOffset(element: JQuery, type?: string, positioned?: boolean): ElementOffset;\n\n    /**\n     * Get dimensions of a hidden element by temporarily cloning and showing it\n     */\n    getHiddenDimensions(element: JQuery, includeMargin?: boolean): HiddenDimensions;\n\n    /**\n     * Parse effects string into object\n     */\n    parseEffects(input: string | string[]): ParsedEffects;\n\n    /**\n     * Remove whitespace text nodes from an element\n     */\n    stripWhitespace(element: HTMLElement): void;\n\n    /**\n     * Request animation frame wrapper\n     */\n    animationFrame(callback: FrameRequestCallback): void;\n\n    /**\n     * Queue an animation callback\n     */\n    queueAnimation(callback: () => void): void;\n\n    /**\n     * Run the next animation in queue\n     */\n    runNextAnimation(): void;\n\n    /**\n     * Parse query string parameters from URL\n     */\n    parseQueryStringParams(url: string): Record<string, string>;\n\n    /**\n     * Get element under cursor position\n     */\n    elementUnderCursor(e: { x: { client?: number }; y: { client?: number } }): Element | null;\n\n    /**\n     * Get wheel delta Y from jQuery event\n     */\n    wheelDeltaY(jQueryEvent: JQuery.MouseEventBase): number | undefined;\n\n    /**\n     * Get box-shadow dimensions from an element\n     */\n    getShadows(element: JQuery): ShadowDimensions;\n\n    /**\n     * Wrap element with animation container\n     */\n    wrap(element: JQuery, autosize?: boolean, resize?: boolean, shouldCorrectWidth?: boolean, autowidth?: boolean): JQuery;\n\n    /**\n     * Resize wrapped element\n     */\n    wrapResize(element: JQuery, autosize?: boolean, shouldCorrectWidth?: boolean): void;\n\n    /**\n     * Scroll element horizontally by a delta\n     */\n    scrollByDelta(element: JQuery, delta: number): ScrollResult;\n\n    /**\n     * Scroll element vertically by a delta\n     */\n    scrollVerticalByDelta(element: JQuery, delta: number, options?: VerticalScrollOptions): VerticalScrollResult;\n\n    /**\n     * Smoothly scroll to a specific element within a container\n     */\n    scrollToElement(container: JQuery, targetElement: JQuery, options?: ScrollToElementOptions): boolean;\n\n    /**\n     * Add a value to an element's attribute, avoiding duplicates\n     * @param element - jQuery element\n     * @param attribute - Attribute name\n     * @param value - Value to add\n     */\n    addAttribute(element: JQuery, attribute: string, value: string): void;\n\n    /**\n     * Remove an attribute from an element\n     * @param element - jQuery element\n     * @param attribute - Attribute name to remove\n     */\n    removeAttribute(element: JQuery, attribute: string): void;\n\n    /**\n     * Toggle an attribute value on an element\n     * Adds if not present, removes if present (with special handling for disabled/readonly)\n     * @param element - jQuery element\n     * @param attribute - Attribute name\n     * @param value - Value to toggle\n     */\n    toggleAttribute(element: JQuery, attribute: string, value: string): void;\n\n    /**\n     * Bind a callback to the window resize event.\n     * On Android, the callback is delayed by 600ms.\n     * @param callback - Function to call on resize\n     * @returns The handler function (may be wrapped)\n     */\n    onResize(callback: () => void): () => void;\n\n    /**\n     * Unbind a resize callback from the window.\n     * @param callback - The handler returned from onResize\n     */\n    unbindResize(callback: () => void): void;\n\n    /**\n     * Get a data attribute value from an element using kendo namespace.\n     * @param element - jQuery element\n     * @param key - Attribute key (without kendo namespace prefix)\n     * @returns The attribute value\n     */\n    attrValue(element: JQuery, key: string): any;\n\n    /**\n     * Get the kendo data attribute name with namespace prefix.\n     * @param value - The attribute name without prefix\n     * @returns The full attribute name (e.g., \"data-kendo-role\" or \"data-role\")\n     */\n    attr(value: string): string;\n\n    /**\n     * Get or set element dimensions.\n     * @param element - jQuery element\n     * @param dimensions - Optional dimensions to set\n     * @returns Object with width and height\n     */\n    dimensions(element: JQuery, dimensions?: { width?: number | string; height?: number | string }): { width: number; height: number };\n\n    /**\n     * Check if an object is an HTML element or document\n     * @param element - Object to check\n     * @returns True if element is Element or HTMLDocument\n     */\n    isElement(element: any): boolean;\n\n    /**\n     * Check if an event was triggered by an input element\n     * @param e - Event object\n     * @returns True if event target is a form input element\n     */\n    triggeredByInput(e: Event | { target: HTMLElement }): boolean;\n\n    /**\n     * Apply inline styles from kendo data attributes to elements\n     * @param element - Container element to search within\n     * @param styleProps - Array of CSS property names to apply\n     */\n    applyStylesFromKendoAttributes(element: JQuery, styleProps: string[]): void;\n\n    /**\n     * Show or hide a loading mask on a container element\n     * @param container - Container element for the mask\n     * @param toggle - Whether to show (true) or hide (false) the mask\n     * @param options - Optional configuration for the mask\n     */\n    progress(container: JQuery, toggle: boolean, options?: ProgressOptions): void;\n\n    /**\n     * Get the actual target element from an event, handling touch events.\n     * For touch events, uses document.elementFromPoint with touch coordinates.\n     * @param e - Event object (mouse or touch)\n     * @returns The target element\n     */\n    eventTarget(e: Event | JQuery.Event): EventTarget | null;\n\n    /**\n     * Create a drag-to-scroll handler for horizontal scrolling via mouse/touch drag.\n     * @param scrollContainer - The element that will be scrolled\n     * @param options - Configuration options including namespace and capture element\n     * @returns Handler with attach() and destroy() methods\n     */\n    createDragToScrollHandler(scrollContainer: JQuery, options: DragToScrollOptions): DragToScrollHandler;\n}\n\n/**\n * Options for the progress/loading mask\n */\nexport interface ProgressOptions {\n    width?: string | number;\n    height?: string | number;\n    top?: number;\n    opacity?: boolean;\n}\n\n/**\n * Result of horizontal scroll operation\n */\nexport interface ScrollResult {\n    atStart: boolean;\n    atEnd: boolean;\n}\n\n/**\n * Result of vertical scroll operation\n */\nexport interface VerticalScrollResult {\n    atTop: boolean;\n    atBottom: boolean;\n}\n\n/**\n * Options for vertical scroll by delta\n */\nexport interface VerticalScrollOptions {\n    duration?: string | number;\n    easing?: string;\n}\n\n/**\n * Options for scrollToElement\n */\nexport interface ScrollToElementOptions {\n    duration?: number;\n    easing?: string;\n    position?: 'top' | 'center' | 'bottom';\n    offset?: number;\n    onComplete?: () => void;\n}\n\n/**\n * Options for drag-to-scroll handler\n */\nexport interface DragToScrollOptions {\n    namespace: string;\n    captureElement?: JQuery;\n    delegateSelector?: string;\n}\n\n/**\n * Drag-to-scroll handler returned by createDragToScrollHandler\n */\nexport interface DragToScrollHandler {\n    attach(): void;\n    destroy(): void;\n}\n","import { IDataboundWidget } from \"../models\";\nimport { Widget } from \"./widget\";\n\nexport class DataBoundWidget extends Widget implements IDataboundWidget {\n    /**\n     * Retrieves the data items currently bound to the widget.\n     * @returns An array of data items\n     */\n    dataItems(): any[] {\n        const dataSource = (this as any).dataSource;\n        if (dataSource && typeof dataSource.view === \"function\") {\n            return dataSource.flatView();\n        }\n        return [];\n    }\n}\n\nDataBoundWidget.fn = DataBoundWidget.prototype;\n\n// Re-export types for convenience\nexport type {\n    IDataboundWidget\n} from \"../models/databound-widget\";","import { Culture, Calendars, CulturesRegistry, ICultureService } from \"../models/culture\";\n\nconst DEFAULT_LANGUAGE: string = \"en-US\";\n\nconst DEFAULT_EN_US_CULTURE: Culture = {\n    name: DEFAULT_LANGUAGE,\n    numberFormat: {\n        pattern: [\"-n\"],\n        decimals: 2,\n        \",\": \",\",\n        \".\": \".\",\n        groupSize: [3],\n        percent: {\n            pattern: [\"-n %\", \"n %\"],\n            decimals: 2,\n            \",\": \",\",\n            \".\": \".\",\n            groupSize: [3],\n            symbol: \"%\"\n        },\n        currency: {\n            name: \"US Dollar\",\n            abbr: \"USD\",\n            pattern: [\"($n)\", \"$n\"],\n            decimals: 2,\n            \",\": \",\",\n            \".\": \".\",\n            groupSize: [3],\n            symbol: \"$\"\n        }\n    },\n    calendars: {\n        standard: {\n            days: {\n                names: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\n                namesAbbr: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n                namesShort: [\"Su\", \"Mo\", \"Tu\", \"We\", \"Th\", \"Fr\", \"Sa\"]\n            },\n            months: {\n                names: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\n                namesAbbr: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n            },\n            AM: [\"AM\", \"am\", \"AM\"],\n            PM: [\"PM\", \"pm\", \"PM\"],\n            patterns: {\n                d: \"M/d/yyyy\",\n                D: \"dddd, MMMM dd, yyyy\",\n                F: \"dddd, MMMM dd, yyyy h:mm:ss tt\",\n                g: \"M/d/yyyy h:mm tt\",\n                G: \"M/d/yyyy h:mm:ss tt\",\n                m: \"MMMM dd\",\n                M: \"MMMM dd\",\n                s: \"yyyy'-'MM'-'ddTHH':'mm':'ss\",\n                t: \"h:mm tt\",\n                T: \"h:mm:ss tt\",\n                u: \"yyyy'-'MM'-'dd HH':'mm':'ss'Z'\",\n                y: \"MMMM, yyyy\",\n                Y: \"MMMM, yyyy\"\n            },\n            \"/\": \"/\",\n            \":\": \":\",\n            firstDay: 0,\n            twoDigitYearMax: 2029\n        }\n    }\n};\n\nexport class CultureService implements ICultureService {\n    private cultures: CulturesRegistry;\n\n    constructor(culturesRegistry: CulturesRegistry) {\n        this.cultures = culturesRegistry;\n        \n        // Initialize with default en-US culture if not present\n        if (!this.cultures[DEFAULT_LANGUAGE]) {\n            this.cultures[DEFAULT_LANGUAGE] = DEFAULT_EN_US_CULTURE;\n        }\n    }\n\n    /**\n     * Finds a culture by name or returns the culture object if already in the correct format\n     * @param {string|Culture} culture - Culture name (e.g., \"en-US\") or culture object\n     * @returns {Culture|null} The found culture object or null\n     */\n    findCulture(culture: string | Culture | null | undefined): Culture | null {\n        if (culture) {\n            if (typeof culture === \"string\") {\n                return this.cultures[culture] || this.cultures[culture.split(\"-\")[0]] || null;\n            }\n\n            if ((culture as Culture).numberFormat) {\n                return culture as Culture;\n            }\n\n            return null;\n        }\n\n        return null;\n    }\n\n    /**\n     * Gets a culture by name, returning current culture if not found\n     * @param {string|Culture} culture - Culture name or culture object\n     * @returns {Culture} The found culture or current culture\n     */\n    getCulture(culture: string | Culture | null | undefined): Culture {\n        if (culture) {\n            culture = this.findCulture(culture);\n        }\n\n        return (culture as Culture) || this.cultures.current!;\n    }\n\n    /**\n     * Appends AM/PM designators to the culture's AM/PM arrays\n     * @param {Calendars} calendars - The calendars object from a culture\n     */\n    appendDesignatorsToCultures(calendars: Calendars): void {\n        // Don't ask. It's temporary.\n        if ((calendars.standard.AM && calendars.standard.AM.length)\n            && (calendars.standard.PM && calendars.standard.PM.length)\n            && (calendars.standard.AM.indexOf(\"PMA0\") < 0)\n            && (calendars.standard.AM.indexOf(\"AM\") > -1 || calendars.standard.PM.indexOf(\"PM\") > -1)) {\n            calendars.standard.AM.push(\"a\", \"A\", \"PMa\", \"PMA\", \"PMa0\", \"PMA0\");\n            calendars.standard.PM.push(\"p\", \"P\", \"AMp\", \"AMP\", \"AMp0\", \"AMP0\");\n        }\n    }\n\n    /**\n     * Gets the current culture\n     * @returns {Culture} The current culture\n     */\n    culture(): Culture {\n        this.appendDesignatorsToCultures(this.cultures.current!.calendars);\n        return this.cultures.current!;\n    }\n\n    /**\n     * Sets the current culture\n     * @param {string} cultureName - The name of the culture to set\n     */\n    setCulture(cultureName: string): void {\n        const culture = this.findCulture(cultureName) || this.cultures[DEFAULT_LANGUAGE];\n        (culture as Culture).calendar = (culture as Culture).calendars.standard;\n        this.cultures.current = culture as Culture;\n    }\n\n    /**\n     * Register a culture (called when external culture files are loaded)\n     * @param {string} name - Culture name (e.g., \"de-DE\")\n     * @param {Culture} culture - Culture object\n     */\n    registerCulture(name: string, culture: Culture): void {\n        this.cultures[name] = culture;\n    }\n\n    /**\n     * Get the cultures registry (for creating proxy)\n     * @returns {CulturesRegistry} The cultures registry\n     */\n    getCulturesRegistry(): CulturesRegistry {\n        return this.cultures;\n    }\n}","import { Culture, CalendarStandard, ICultureService } from \"../models/culture\";\nimport { IDateFormatter } from \"../models/formatter\";\n\nconst DATE_FORMAT_REGEX = /dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|HH|H|hh|h|mm|m|fff|ff|f|tt|aa|ss|s|zzz|zz|z|EEEE|\"[^\"]*\"|'[^']*'/g;\n\n/**\n * Pad a number with leading zeros\n */\nfunction pad(value: number, length: number = 2): string {\n    let str = String(value);\n    while (str.length < length) {\n        str = \"0\" + str;\n    }\n    return str;\n}\n\nexport class DateFormatterService implements IDateFormatter {\n    constructor(private cultureService: ICultureService) {}\n\n    format(date: Date, format: string, culture?: string | Culture): string {\n        const resolvedCulture = culture \n            ? this.cultureService.getCulture(culture) \n            : this.cultureService.culture();\n\n        const calendar = resolvedCulture.calendars.standard;\n        const days = calendar.days;\n        const months = calendar.months;\n\n        const resolvedFormat = (format as any).pattern || calendar.patterns[format as keyof typeof calendar.patterns] || format;\n\n        return resolvedFormat.replace(DATE_FORMAT_REGEX, (match: string) => {\n            return this.formatMatch(match, date, calendar, days, months);\n        });\n    }\n\n    private formatMatch(\n        match: string, \n        date: Date, \n        calendar: CalendarStandard,\n        days: { names: string[]; namesAbbr: string[]; namesShort: string[] },\n        months: { names: string[]; namesAbbr: string[] }\n    ): string | number {\n        let result: string | number | undefined;\n        let minutes: number;\n        let sign: boolean;\n\n        if (match === \"d\") {\n            result = date.getDate();\n        } else if (match === \"dd\") {\n            result = pad(date.getDate());\n        } else if (match === \"ddd\") {\n            result = days.namesAbbr[date.getDay()];\n        } else if (match === \"dddd\" || match === \"EEEE\") {\n            result = days.names[date.getDay()];\n        } else if (match === \"M\") {\n            result = date.getMonth() + 1;\n        } else if (match === \"MM\") {\n            result = pad(date.getMonth() + 1);\n        } else if (match === \"MMM\") {\n            result = months.namesAbbr[date.getMonth()];\n        } else if (match === \"MMMM\") {\n            result = months.names[date.getMonth()];\n        } else if (match === \"yy\") {\n            result = pad(date.getFullYear() % 100);\n        } else if (match === \"yyyy\") {\n            result = pad(date.getFullYear(), 4);\n        } else if (match === \"h\") {\n            result = date.getHours() % 12 || 12;\n        } else if (match === \"hh\") {\n            result = pad(date.getHours() % 12 || 12);\n        } else if (match === \"H\") {\n            result = date.getHours();\n        } else if (match === \"HH\") {\n            result = pad(date.getHours());\n        } else if (match === \"m\") {\n            result = date.getMinutes();\n        } else if (match === \"mm\") {\n            result = pad(date.getMinutes());\n        } else if (match === \"s\") {\n            result = date.getSeconds();\n        } else if (match === \"ss\") {\n            result = pad(date.getSeconds());\n        } else if (match === \"f\") {\n            result = Math.floor(date.getMilliseconds() / 100);\n        } else if (match === \"ff\") {\n            let ms = date.getMilliseconds();\n            if (ms > 99) {\n                ms = Math.floor(ms / 10);\n            }\n            result = pad(ms);\n        } else if (match === \"fff\") {\n            result = pad(date.getMilliseconds(), 3);\n        } else if (match === \"tt\" || match === \"aa\") {\n            result = date.getHours() < 12 ? calendar.AM[0] : calendar.PM[0];\n        } else if (match === \"zzz\") {\n            minutes = date.getTimezoneOffset();\n            sign = minutes < 0;\n\n            let hours = Math.abs(minutes / 60).toString().split(\".\")[0];\n            minutes = Math.abs(minutes) - (parseInt(hours, 10) * 60);\n\n            result = (sign ? \"+\" : \"-\") + pad(parseInt(hours, 10));\n            result += \":\" + pad(minutes);\n        } else if (match === \"zz\" || match === \"z\") {\n            let hours = date.getTimezoneOffset() / 60;\n            sign = hours < 0;\n\n            const absHours = Math.abs(hours).toString().split(\".\")[0];\n            result = (sign ? \"+\" : \"-\") + (match === \"zz\" ? pad(parseInt(absHours, 10)) : absHours);\n        }\n\n        return result !== undefined ? result : match.slice(1, match.length - 1);\n    }\n}\n","import { Culture, ICultureService } from \"../models/culture\";\nimport { INumberParserService } from \"../models/parser\";\n\nconst DOT = \".\";\nconst COMMA = \",\";\nconst SPACE = \" \";\nconst MINUS = \"-\";\n\nconst EXPONENT_REGEX = /[eE][\\-+]?[0-9]+/;\nconst NON_BREAKING_SPACE_REGEX = /\\u00A0/g;\nconst WHITESPACE_REGEX = /\\s/g;\n\nexport class NumberParserService implements INumberParserService {\n    constructor(private cultureService: ICultureService) {}\n\n    /**\n     * Parse a string value as an integer according to culture settings\n     */\n    parseInt(value: string | number | null | undefined, culture?: string | Culture): number | null {\n        const result = this.parseFloat(value, culture);\n        if (result) {\n            return result | 0;\n        }\n        return result;\n    }\n\n    /**\n     * Parse a string value as a float according to culture settings\n     */\n    parseFloat(value: string | number | null | undefined, culture?: string | Culture, format?: string): number | null {\n        if (!value && value !== 0) {\n            return null;\n        }\n\n        if (typeof value === \"number\") {\n            return value;\n        }\n\n        let strValue = value.toString();\n        const resolvedCulture = this.cultureService.getCulture(culture);\n\n        let numberFormat = resolvedCulture.numberFormat;\n        const percent = numberFormat.percent;\n        const currency = numberFormat.currency;\n        const percentSymbol = percent.symbol;\n        let symbol = currency.symbol;\n        let negative = strValue.indexOf(MINUS);\n        let parts: string[];\n        let isPercent = false;\n\n        // Handle exponential number\n        if (EXPONENT_REGEX.test(strValue)) {\n            const parsed = parseFloat(strValue.replace(numberFormat[DOT], DOT));\n            if (isNaN(parsed)) {\n                return null;\n            }\n            return parsed;\n        }\n\n        if (negative > 0) {\n            return null;\n        } else {\n            negative = negative > -1 ? 1 : 0;\n        }\n\n        if (strValue.indexOf(symbol) > -1 || (format && format.toLowerCase().indexOf(\"c\") > -1)) {\n            numberFormat = currency as any;\n            parts = numberFormat.pattern[0].replace(\"$\", symbol).split(\"n\");\n            if (strValue.indexOf(parts[0]) > -1 && strValue.indexOf(parts[1]) > -1) {\n                strValue = strValue.replace(parts[0], \"\").replace(parts[1], \"\");\n                negative = 1;\n            }\n        } else if (strValue.indexOf(percentSymbol) > -1) {\n            isPercent = true;\n            numberFormat = percent as any;\n            symbol = percentSymbol;\n        }\n\n        strValue = strValue\n            .replace(MINUS, \"\")\n            .replace(symbol, \"\")\n            .replace(NON_BREAKING_SPACE_REGEX, SPACE)\n            .split(numberFormat[COMMA].replace(NON_BREAKING_SPACE_REGEX, SPACE)).join(\"\")\n            .replace(WHITESPACE_REGEX, \"\")\n            .replace(numberFormat[DOT], DOT);\n\n        let result: number | null = parseFloat(strValue);\n\n        if (isNaN(result)) {\n            result = null;\n        } else if (negative) {\n            result *= -1;\n        }\n\n        if (result && isPercent) {\n            result /= 100;\n        }\n\n        return result;\n    }\n}\n","import { Culture, ICultureService } from \"../models/culture\";\nimport { IntlCultureAdapter, IntlLocaleInfo, IKendoCultureToIntlService } from \"../models/intl\";\nimport { IDateParserService } from \"../models/parser\";\nimport { IFormatterService } from \"../models/formatter\";\n\n/**\n * Service that converts Kendo cultures to Intl-compatible format\n * Used for integration with @progress/kendo-intl\n */\nexport class KendoCultureToIntlService implements IKendoCultureToIntlService {\n    constructor(\n        private cultureService: ICultureService,\n        private dateParser: IDateParserService,\n        private formatter: IFormatterService\n    ) {}\n\n    /**\n     * Convert a Kendo culture to an Intl-compatible adapter\n     */\n    convert(culture?: string | Culture): IntlCultureAdapter {\n        const kendoCulture = this.cultureService.getCulture(culture) || this.cultureService.culture();\n        \n        const currencies: { [key: string]: any } = {};\n        currencies[kendoCulture.numberFormat.currency.abbr] = kendoCulture.numberFormat.currency;\n        \n        const localeInfoAll = this.buildLocaleInfoAll(kendoCulture, currencies);\n        \n        return {\n            localeInfo: () => this.buildLocaleInfo(kendoCulture, currencies),\n            parseDate: (value: string, fmt?: string) => this.dateParser.parseExactDate(value, fmt, kendoCulture),\n            toString: (value: any, fmt?: string) => {\n                const result = this.formatter.toString(value, fmt, kendoCulture);\n                // Coerce to string for Intl adapter compatibility\n                return result == null ? \"\" : String(result);\n            },\n            format: (fmt: string, ...values: any[]) => this.formatter.format(fmt, ...values)\n        };\n    }\n\n    private buildLocaleInfo(kendoCulture: Culture, currencies: { [key: string]: any }): IntlLocaleInfo {\n        return {\n            numbers: {\n                localeCurrency: kendoCulture.numberFormat.currency.abbr,\n                currencies: currencies,\n                symbols: {\n                    group: kendoCulture.numberFormat[','],\n                    decimal: kendoCulture.numberFormat['.'],\n                    percentSign: kendoCulture.numberFormat.percent.symbol,\n                }\n            },\n            calendar: {\n                patterns: kendoCulture.calendars.standard.patterns,\n                months: {\n                    format: {\n                        wide: kendoCulture.calendars.standard.months.names,\n                        abbreviated: kendoCulture.calendars.standard.months.namesAbbr\n                    }\n                },\n                days: {\n                    format: {\n                        wide: kendoCulture.calendars.standard.days.names,\n                        abbreviated: kendoCulture.calendars.standard.days.namesAbbr\n                    }\n                }\n            }\n        };\n    }\n\n    private buildLocaleInfoAll(kendoCulture: Culture, currencies: { [key: string]: any }): any {\n        const localeInfoAll: any = {};\n\n        // Extract the name and split into language and territory if possible\n        const [language, territory] = kendoCulture.name.split('-');\n        localeInfoAll.name = language;\n        localeInfoAll.identity = { language };\n        if (territory) {\n            localeInfoAll.territory = territory;\n        }\n\n        // Map number format symbols\n        if (kendoCulture.numberFormat) {\n            localeInfoAll.numbers = {\n                symbols: {\n                    decimal: kendoCulture.numberFormat[\".\"],\n                    group: kendoCulture.numberFormat[\",\"],\n                    percentSign: kendoCulture.numberFormat.percent?.symbol || \"%\"\n                },\n                decimal: {\n                    patterns: kendoCulture.numberFormat.pattern,\n                    groupSize: kendoCulture.numberFormat.groupSize\n                },\n                currency: {\n                    patterns: kendoCulture.numberFormat.currency?.pattern,\n                    groupSize: kendoCulture.numberFormat.currency?.groupSize\n                },\n                percent: {\n                    patterns: kendoCulture.numberFormat.percent?.pattern,\n                    groupSize: kendoCulture.numberFormat.percent?.groupSize,\n                    decimals: kendoCulture.numberFormat.percent?.decimals\n                }\n            };\n\n            // Map currency information if available\n            if (kendoCulture.numberFormat.currency) {\n                localeInfoAll.numbers.currencies = {\n                    [kendoCulture.numberFormat.currency.abbr]: kendoCulture.numberFormat.currency\n                };\n                localeInfoAll.numbers.localeCurrency = kendoCulture.numberFormat.currency.abbr;\n            }\n        }\n\n        // Map calendar information\n        if (kendoCulture.calendars && kendoCulture.calendars.standard) {\n            const standardCalendar = kendoCulture.calendars.standard;\n            localeInfoAll.calendar = {\n                patterns: {\n                    d: standardCalendar.patterns.d,\n                    D: standardCalendar.patterns.D,\n                    F: standardCalendar.patterns.F,\n                    g: standardCalendar.patterns.g,\n                    G: standardCalendar.patterns.G,\n                    m: standardCalendar.patterns.m,\n                    M: standardCalendar.patterns.M,\n                    s: standardCalendar.patterns.s,\n                    t: standardCalendar.patterns.t,\n                    T: standardCalendar.patterns.T,\n                    u: standardCalendar.patterns.u,\n                    y: standardCalendar.patterns.y,\n                    Y: standardCalendar.patterns.Y\n                },\n                days: {\n                    format: {\n                        wide: standardCalendar.days.names,\n                        abbreviated: standardCalendar.days.namesAbbr,\n                        short: standardCalendar.days.namesShort\n                    },\n                    \"stand-alone\": {\n                        wide: standardCalendar.days.names,\n                        abbreviated: standardCalendar.days.namesAbbr,\n                        short: standardCalendar.days.namesShort\n                    }\n                },\n                months: {\n                    format: {\n                        wide: standardCalendar.months.names,\n                        abbreviated: standardCalendar.months.namesAbbr,\n                        narrow: standardCalendar.months.namesAbbr.map((name: string) => name.charAt(0))\n                    },\n                    \"stand-alone\": {\n                        wide: standardCalendar.months.names,\n                        abbreviated: standardCalendar.months.namesAbbr,\n                        narrow: standardCalendar.months.namesAbbr.map((name: string) => name.charAt(0))\n                    }\n                },\n                dayPeriods: {\n                    format: {\n                        abbreviated: {\n                            am: standardCalendar.AM[0],\n                            pm: standardCalendar.PM[0]\n                        },\n                        narrow: {\n                            am: standardCalendar.AM[1],\n                            pm: standardCalendar.PM[1]\n                        },\n                        wide: {\n                            am: standardCalendar.AM[0],\n                            pm: standardCalendar.PM[0]\n                        }\n                    },\n                    \"stand-alone\": {\n                        abbreviated: {\n                            am: standardCalendar.AM[0],\n                            pm: standardCalendar.PM[0]\n                        },\n                        narrow: {\n                            am: standardCalendar.AM[1],\n                            pm: standardCalendar.PM[1]\n                        },\n                        wide: {\n                            am: standardCalendar.AM[0],\n                            pm: standardCalendar.PM[0]\n                        }\n                    }\n                }\n            };\n\n            // Include firstDay if defined\n            if ('firstDay' in standardCalendar) {\n                localeInfoAll.firstDay = standardCalendar.firstDay;\n            }\n        }\n\n        return localeInfoAll;\n    }\n}\n","import { TemplateOptions, CompiledTemplate, ITemplateService } from \"../models/template\";\nimport type { IFormatterService } from \"../models/formatter\";\n\n// Regex patterns for template parsing\nconst argumentNameRegExp = /^\\w+/;\nconst encodeRegExp = /\\$\\{([^}]*)\\}/g;\nconst escapedCurlyRegExp = /\\\\\\}/g;\nconst curlyRegExp = /__CURLY__/g;\nconst escapedSharpRegExp = /\\\\#/g;\nconst sharpRegExp = /__SHARP__/g;\n\n/**\n * Compile a template part (either string literal or code)\n */\nfunction compilePart(part: string, stringPart: boolean): string {\n    if (stringPart) {\n        return \"'\" +\n            part.split(\"'\").join(\"\\\\'\")\n                .split('\\\\\"').join('\\\\\\\\\\\\\"')\n                .replace(/\\n/g, \"\\\\n\")\n                .replace(/\\r/g, \"\\\\r\")\n                .replace(/\\t/g, \"\\\\t\") + \"'\";\n    } else {\n        const first = part.charAt(0);\n        const rest = part.substring(1);\n\n        if (first === \"=\") {\n            return \"+(\" + rest + \")+\";\n        } else if (first === \":\") {\n            return \"+$kendoHtmlEncode(\" + rest + \")+\";\n        } else {\n            return \";\" + part + \";$kendoOutput+=\";\n        }\n    }\n}\n\n/**\n * Template service for compiling and rendering Kendo UI templates\n * \n * Supports the legacy Kendo template syntax:\n * - #= expression # - Output expression result\n * - #: expression # - Output HTML-encoded expression result\n * - # code # - Execute JavaScript code\n */\nexport class TemplateService implements ITemplateService {\n    paramName = \"data\";\n    useWithBlock = true;\n    private debugTemplates = false;\n\n    constructor(private formatterService: IFormatterService) {}\n\n    /**\n     * Enable or disable template debugging\n     */\n    setDebugMode(enabled: boolean): void {\n        this.debugTemplates = enabled;\n    }\n\n    /**\n     * Render a template with an array of data items\n     */\n    render(template: CompiledTemplate, data: any[]): string {\n        let html = \"\";\n        for (let idx = 0; idx < data.length; idx++) {\n            html += template(data[idx]);\n        }\n        return html;\n    }\n\n    /**\n     * Compile a template string into a function\n     */\n    compile(template: string | CompiledTemplate, options?: TemplateOptions): CompiledTemplate {\n        // If already a function, return as-is\n        if (typeof template === \"function\") {\n            return template;\n        }\n\n        // Use options values only if they're not undefined (matches original jQuery extend behavior)\n        const settings = {\n            paramName: options?.paramName !== undefined ? options.paramName : this.paramName,\n            useWithBlock: options?.useWithBlock !== undefined ? options.useWithBlock : this.useWithBlock\n        };\n\n        const paramName = settings.paramName;\n        const argumentName = paramName.match(argumentNameRegExp)![0];\n        const useWithBlock = settings.useWithBlock;\n\n        let functionBody = \"var $kendoOutput, $kendoHtmlEncode = kendo.htmlEncode;\";\n        \n        functionBody += useWithBlock ? \"with(\" + paramName + \"){\" : \"\";\n        functionBody += \"$kendoOutput=\";\n\n        const parts = template\n            .replace(escapedCurlyRegExp, \"__CURLY__\")\n            .replace(encodeRegExp, \"#=$kendoHtmlEncode($1)#\")\n            .replace(curlyRegExp, \"}\")\n            .replace(escapedSharpRegExp, \"__SHARP__\")\n            .split(\"#\");\n\n        for (let idx = 0; idx < parts.length; idx++) {\n            functionBody += compilePart(parts[idx], idx % 2 === 0);\n        }\n\n        functionBody += useWithBlock ? \";}\" : \";\";\n        functionBody += \"return $kendoOutput;\";\n        functionBody = functionBody.replace(sharpRegExp, \"#\");\n\n        try {\n            // This function evaluation is required for legacy support of the Kendo Template syntax - non CSP compliant.\n            // NOSONAR - It is a valid security concern, however this is required for backward compatibility\n            const fn = new Function(argumentName, functionBody) as CompiledTemplate;\n            fn._slotCount = Math.floor(parts.length / 2);\n            return fn;\n        } catch (e) {\n            if (this.debugTemplates) {\n                console.warn(`Invalid template:'${template}' Generated code:'${functionBody}'`);\n                // Return a no-op function in debug mode\n                return (() => \"\") as CompiledTemplate;\n            } else {\n                throw new Error(this.formatterService.format(\"Invalid template:'{0}' Generated code:'{1}'\", template, functionBody));\n            }\n        }\n    }\n}\n","import type { \n    ISupportService, \n    MobileOS, \n    BrowserInfo, \n    TransformSupport, \n    InputTypeSupport, \n    ClipboardSupport \n} from \"../models/support\";\n\nconst UNDEFINED = \"undefined\";\n\n/**\n * Test a value against a set of regex patterns\n */\nfunction testRx(agent: string, rxs: Record<string, RegExp>, dflt?: string | false): string | false {\n    for (const rx in rxs) {\n        if (rxs.hasOwnProperty(rx) && rxs[rx].test(agent)) {\n            return rx;\n        }\n    }\n    return dflt !== undefined ? dflt : agent;\n}\n\n/**\n * Support detection service for browser, OS, and feature detection\n */\nexport class SupportService implements ISupportService {\n    _scrollbar: number | undefined = undefined;\n    \n    browser!: BrowserInfo;\n    mobileOS!: MobileOS | false;\n    \n    touch!: boolean;\n    tbodyInnerHtml!: boolean;\n    transforms!: TransformSupport;\n    transitions!: TransformSupport;\n    hasHW3D!: boolean;\n    cssFlexbox!: boolean;\n    cssFloat!: boolean;\n    devicePixelRatio!: number;\n    screenWidth!: number;\n    screenHeight!: number;\n    wpDevicePixelRatio!: number;\n    hasNativeScrolling!: MobileOS | false;\n    mouseAndTouchPresent!: boolean;\n    clipboard!: ClipboardSupport;\n    eventCapture!: boolean;\n    placeholder!: boolean;\n    propertyChangeEvent!: boolean;\n    input!: InputTypeSupport;\n    stableSort!: boolean;\n    matchesSelector!: (selector: string) => boolean;\n    matchMedia!: boolean;\n    pushState!: boolean;\n    hashChange!: boolean;\n    customElements!: boolean;\n    msPointers!: boolean;\n    pointers!: boolean;\n    kineticScrollNeeded!: boolean;\n    resize!: string;\n    mousedown!: string;\n    mouseup!: string;\n    mousemove!: string;\n    mousecancel!: string;\n    click!: string;\n\n    private $: JQueryStatic;\n\n    constructor($: JQueryStatic) {\n        this.$ = $;\n        \n        // Bind methods to ensure correct 'this' context when called as standalone functions\n        this.scrollbar = this.scrollbar.bind(this);\n        this.isRtl = this.isRtl.bind(this);\n        this.detectOS = this.detectOS.bind(this);\n        this.detectBrowser = this.detectBrowser.bind(this);\n        this.detectClipboardAccess = this.detectClipboardAccess.bind(this);\n        this.zoomLevel = this.zoomLevel.bind(this);\n        this.delayedClick = this.delayedClick.bind(this);\n        \n        this.initialize();\n    }\n\n    private initialize(): void {\n        const $ = this.$;\n        const win = window as any;\n        const doc = document;\n        const nav = navigator;\n\n        // Table innerHTML support test\n        const table = doc.createElement(\"table\");\n        try {\n            table.innerHTML = \"<tr><td></td></tr>\";\n            this.tbodyInnerHtml = true;\n        } catch (e) {\n            this.tbodyInnerHtml = false;\n        }\n\n        // Touch support\n        this.touch = \"ontouchstart\" in win;\n\n        const docStyle = doc.documentElement.style;\n        const elementProto: any = \"HTMLElement\" in win ? HTMLElement.prototype : [];\n\n        // Transforms and Transitions - legacy properties kept for compatibility\n        this.transforms = this.transitions = { css: \"\", prefix: \"\", event: \"transitionend\" };\n        this.hasHW3D = (\"WebKitCSSMatrix\" in win && \"m11\" in new win.WebKitCSSMatrix()) || \n                       \"MozPerspective\" in docStyle || \n                       \"msPerspective\" in docStyle;\n        this.cssFlexbox = (\"flexWrap\" in docStyle) || \n                          (\"WebkitFlexWrap\" in docStyle) || \n                          (\"msFlexWrap\" in docStyle);\n\n        this.devicePixelRatio = win.devicePixelRatio === undefined ? 1 : win.devicePixelRatio;\n\n        try {\n            this.screenWidth = win.outerWidth || win.screen ? win.screen.availWidth : win.innerWidth;\n            this.screenHeight = win.outerHeight || win.screen ? win.screen.availHeight : win.innerHeight;\n        } catch (e) {\n            // window.outerWidth throws error when in IE showModalDialog\n            this.screenWidth = win.screen.availWidth;\n            this.screenHeight = win.screen.availHeight;\n        }\n\n        // Detect mobile OS\n        let mobileOS = this.detectOS(nav.userAgent);\n        this.mobileOS = mobileOS;\n\n        this.wpDevicePixelRatio = mobileOS && mobileOS.wp ? screen.width / 320 : 0;\n\n        this.hasNativeScrolling = false;\n        if (mobileOS && (mobileOS.ios || (mobileOS.android && parseInt(mobileOS.majorVersion) > 2) || mobileOS.wp)) {\n            this.hasNativeScrolling = mobileOS;\n        }\n\n        this.mouseAndTouchPresent = this.touch && !(mobileOS && (mobileOS.ios || mobileOS.android));\n\n        // Detect browser\n        this.browser = this.detectBrowser(nav.userAgent);\n\n        // Handle iPad detection for Safari on iPadOS 13+\n        if (!mobileOS && this.touch && this.browser.safari) {\n            mobileOS = this.mobileOS = {\n                ios: true,\n                tablet: \"tablet\",\n                device: \"ipad\",\n                majorVersion: \"13\",\n                minorVersion: \"0\",\n                flatVersion: \"1300\",\n                cordova: false,\n                appMode: false,\n                name: \"ios\",\n                browser: \"mobilesafari\"\n            };\n        }\n\n        // Clipboard support\n        this.clipboard = this.detectClipboardAccess();\n\n        // Event capture support\n        this.eventCapture = !!doc.documentElement.addEventListener;\n\n        // Input element feature detection\n        const input = doc.createElement(\"input\");\n        this.placeholder = \"placeholder\" in input;\n        this.propertyChangeEvent = \"onpropertychange\" in input;\n\n        // Input type support\n        this.input = this.detectInputTypes(input);\n\n        // CSS float support\n        input.style.cssText = \"float:left;\";\n        this.cssFloat = !!(input.style as any).cssFloat;\n\n        // Stable sort detection\n        this.stableSort = this.detectStableSort();\n\n        // Matches selector\n        this.matchesSelector = elementProto.webkitMatchesSelector || \n                               elementProto.mozMatchesSelector ||\n                               elementProto.msMatchesSelector || \n                               elementProto.oMatchesSelector ||\n                               elementProto.matchesSelector || \n                               elementProto.matches ||\n                               function(this: Element, selector: string): boolean {\n                                   const nodeList = doc.querySelectorAll ? \n                                       (this.parentNode || doc).querySelectorAll(selector) || [] : \n                                       $(selector);\n                                   let i = nodeList.length;\n                                   while (i--) {\n                                       if (nodeList[i] === this) {\n                                           return true;\n                                       }\n                                   }\n                                   return false;\n                               };\n\n        this.matchMedia = \"matchMedia\" in win;\n        this.pushState = !!(win.history && win.history.pushState);\n        this.hashChange = \"onhashchange\" in win;\n        this.customElements = \"registerElement\" in doc;\n\n        // Pointer event support\n        const chrome = this.browser.chrome;\n        const mobileChrome = this.browser.crios;\n        const mozilla = this.browser.mozilla;\n        const safari = this.browser.safari;\n        this.msPointers = !chrome && win.MSPointerEvent;\n        this.pointers = !chrome && !mobileChrome && !mozilla && !safari && win.PointerEvent;\n        this.kineticScrollNeeded = !!(mobileOS && \n            (mobileOS.device !== \"ipad\" || parseInt(mobileOS.majorVersion) < 13) && \n            (this.touch || this.msPointers || this.pointers));\n\n        // Set resize and mouse event name(s) based on device type\n        if (this.touch) {\n            if (!this.mobileOS) {\n                this.mousedown = \"mousedown touchstart\";\n                this.mouseup = \"mouseup touchend\";\n                this.mousemove = \"mousemove touchmove\";\n                this.mousecancel = \"mouseleave touchcancel\";\n                this.click = \"click\";\n                this.resize = \"resize\";\n            } else {\n                this.mousedown = \"touchstart\";\n                this.mouseup = \"touchend\";\n                this.mousemove = \"touchmove\";\n                this.mousecancel = \"touchcancel\";\n                this.click = \"touchend\";\n                this.resize = \"orientationchange\";\n            }\n        } else if (this.pointers) {\n            this.mousemove = \"pointermove\";\n            this.mousedown = \"pointerdown\";\n            this.mouseup = \"pointerup\";\n            this.mousecancel = \"pointercancel\";\n            this.click = \"pointerup\";\n            this.resize = \"orientationchange resize\";\n        } else if (this.msPointers) {\n            this.mousemove = \"MSPointerMove\";\n            this.mousedown = \"MSPointerDown\";\n            this.mouseup = \"MSPointerUp\";\n            this.mousecancel = \"MSPointerCancel\";\n            this.click = \"MSPointerUp\";\n            this.resize = \"orientationchange resize\";\n        } else {\n            this.mousemove = \"mousemove\";\n            this.mousedown = \"mousedown\";\n            this.mouseup = \"mouseup\";\n            this.mousecancel = \"mouseleave\";\n            this.click = \"click\";\n            this.resize = \"resize\";\n        }\n\n        // Add browser-specific CSS classes\n        this.addBrowserCssClasses($);\n    }\n\n    /**\n     * Get or calculate scrollbar width\n     */\n    scrollbar(refresh?: boolean): number {\n        if (!isNaN(this._scrollbar as number) && !refresh) {\n            return this._scrollbar as number;\n        }\n\n        const div = document.createElement(\"div\");\n        div.style.cssText = \"overflow:scroll;overflow-x:hidden;zoom:1;clear:both;display:block\";\n        div.innerHTML = \"&nbsp;\";\n        document.body.appendChild(div);\n\n        this._scrollbar = div.offsetWidth - div.scrollWidth;\n        document.body.removeChild(div);\n\n        return this._scrollbar;\n    }\n\n    /**\n     * Check if element is in RTL context\n     */\n    isRtl(element: HTMLElement | JQuery): boolean {\n        return this.$(element).closest(\".k-rtl\").length > 0;\n    }\n\n    /**\n     * Detect mobile operating system from user agent\n     */\n    detectOS(ua: string): MobileOS | false {\n        let os: MobileOS | false = false;\n        let minorVersion: string;\n        let match: RegExpMatchArray | null = null;\n        const notAndroidPhone = !/mobile safari/i.test(ua);\n\n        const agentRxs: Record<string, RegExp> = {\n            wp: /(Windows Phone(?: OS)?)\\s(\\d+)\\.(\\d+(\\.\\d+)?)/,\n            fire: /(Silk)\\/(\\d+)\\.(\\d+(\\.\\d+)?)/,\n            android: /(Android|Android.*(?:Opera|Firefox).*?\\/)\\s*(\\d+)\\.?(\\d+(\\.\\d+)?)?/,\n            iphone: /(iPhone|iPod).*OS\\s+(\\d+)[\\._]([\\d\\._]+)/,\n            ipad: /(iPad).*OS\\s+(\\d+)[\\._]([\\d_]+)/,\n            meego: /(MeeGo).+NokiaBrowser\\/(\\d+)\\.([\\d\\._]+)/,\n            webos: /(webOS)\\/(\\d+)\\.(\\d+(\\.\\d+)?)/,\n            blackberry: /(BlackBerry|BB10).*?Version\\/(\\d+)\\.(\\d+(\\.\\d+)?)/,\n            playbook: /(PlayBook).*?Tablet\\s*OS\\s*(\\d+)\\.(\\d+(\\.\\d+)?)/,\n            windows: /(MSIE)\\s+(\\d+)\\.(\\d+(\\.\\d+)?)/,\n            tizen: /(tizen).*?Version\\/(\\d+)\\.(\\d+(\\.\\d+)?)/i,\n            sailfish: /(sailfish).*rv:(\\d+)\\.(\\d+(\\.\\d+)?).*firefox/i,\n            ffos: /(Mobile).*rv:(\\d+)\\.(\\d+(\\.\\d+)?).*Firefox/\n        };\n\n        const osRxs: Record<string, RegExp> = {\n            ios: /^i(phone|pad|pod)$/i,\n            android: /^android|fire$/i,\n            blackberry: /^blackberry|playbook/i,\n            windows: /windows/,\n            wp: /wp/,\n            flat: /sailfish|ffos|tizen/i,\n            meego: /meego/\n        };\n\n        const formFactorRxs: Record<string, RegExp> = {\n            tablet: /playbook|ipad|fire/i\n        };\n\n        const browserRxs: Record<string, RegExp> = {\n            omini: /Opera\\sMini/i,\n            omobile: /Opera\\sMobi/i,\n            firefox: /Firefox|Fennec/i,\n            mobilesafari: /version\\/.*safari/i,\n            ie: /MSIE|Windows\\sPhone/i,\n            chrome: /chrome|crios/i,\n            webkit: /webkit/i,\n            edge: /edge|edg|edgios|edga/i\n        };\n\n        for (const agent in agentRxs) {\n            if (agentRxs.hasOwnProperty(agent)) {\n                match = ua.match(agentRxs[agent]);\n                if (match) {\n                    // Break if not Metro/Mobile Windows\n                    if (agent === \"windows\" && \"plugins\" in navigator) {\n                        return false;\n                    }\n\n                    os = {} as MobileOS;\n                    os.device = agent;\n                    os.tablet = testRx(agent, formFactorRxs, false) as string | false;\n                    os.browser = testRx(ua, browserRxs, \"default\") as string;\n                    os.name = testRx(agent, osRxs) as string;\n                    (os as any)[os.name] = true;\n                    os.majorVersion = match[2];\n                    os.minorVersion = (match[3] || \"0\").replace(\"_\", \".\");\n                    minorVersion = os.minorVersion.replace(\".\", \"\").substr(0, 2);\n                    os.flatVersion = os.majorVersion + minorVersion + \n                        (new Array(3 - (minorVersion.length < 3 ? minorVersion.length : 2)).join(\"0\"));\n                    os.cordova = typeof (window as any).PhoneGap !== UNDEFINED || \n                                 typeof (window as any).cordova !== UNDEFINED;\n                    os.appMode = !!(navigator as any).standalone || \n                                 (/file|local|wmapp/).test(window.location.protocol) || \n                                 os.cordova;\n\n                    if (os.android && \n                        (this.devicePixelRatio < 1.5 && parseInt(os.flatVersion) < 400 || notAndroidPhone) && \n                        (this.screenWidth > 800 || this.screenHeight > 800)) {\n                        os.tablet = agent;\n                    }\n\n                    break;\n                }\n            }\n        }\n\n        return os;\n    }\n\n    /**\n     * Detect browser from user agent\n     */\n    detectBrowser(ua: string): BrowserInfo {\n        let browser: BrowserInfo | false = false;\n        let match: RegExpMatchArray | null;\n        let chromiumEdgeMatch: RegExpMatchArray | null;\n\n        const browserRxs: Record<string, RegExp> = {\n            edge: /(edge)[ \\/]([\\w.]+)/i,\n            webkit: /(chrome|crios)[ \\/]([\\w.]+)/i,\n            safari: /(webkit)[ \\/]([\\w.]+)/i,\n            opera: /(opera)(?:.*version|)[ \\/]([\\w.]+)/i,\n            msie: /(msie\\s|trident.*? rv:)([\\w.]+)/i,\n            mozilla: /(mozilla)(?:.*? rv:([\\w.]+)|)/i\n        };\n\n        for (const agent in browserRxs) {\n            if (browserRxs.hasOwnProperty(agent)) {\n                match = ua.match(browserRxs[agent]);\n                if (match) {\n                    browser = {} as BrowserInfo;\n                    (browser as any)[agent] = true;\n                    (browser as any)[match[1].toLowerCase().split(\" \")[0].split(\"/\")[0]] = true;\n                    browser.version = parseInt((document as any).documentMode || match[2], 10);\n\n                    if (browser.chrome) {\n                        chromiumEdgeMatch = ua.match(/(edg)[ \\/]([\\w.]+)/i);\n                        if (chromiumEdgeMatch) {\n                            browser.chromiumEdge = true;\n                        }\n                    }\n\n                    break;\n                }\n            }\n        }\n\n        return browser || { version: 0 };\n    }\n\n    /**\n     * Detect clipboard command support\n     */\n    detectClipboardAccess(): ClipboardSupport {\n        const doc = document as any;\n        const commands: ClipboardSupport = {\n            copy: doc.queryCommandSupported ? doc.queryCommandSupported(\"copy\") : false,\n            cut: doc.queryCommandSupported ? doc.queryCommandSupported(\"cut\") : false,\n            paste: doc.queryCommandSupported ? doc.queryCommandSupported(\"paste\") : false\n        };\n\n        if (this.browser.chrome) {\n            // Not using queryCommandSupported due to chromium issues 476508 and 542948\n            commands.paste = false;\n            if (this.browser.version >= 43) {\n                commands.copy = true;\n                commands.cut = true;\n            }\n        }\n\n        return commands;\n    }\n\n    /**\n     * Get current zoom level\n     */\n    zoomLevel(): number {\n        try {\n            const browser = this.browser;\n            let ie11WidthCorrection = 0;\n            const docEl = document.documentElement;\n\n            if (browser.msie && browser.version === 11 && \n                docEl.scrollHeight > docEl.clientHeight && !this.touch) {\n                ie11WidthCorrection = this.scrollbar();\n            }\n\n            return this.touch ? \n                (docEl.clientWidth / window.innerWidth) :\n                (browser.msie && browser.version >= 10 ? \n                    ((((top || window) as any).document.documentElement.offsetWidth + ie11WidthCorrection) / \n                     ((top || window) as any).innerWidth) : \n                    1);\n        } catch (e) {\n            return 1;\n        }\n    }\n\n    /**\n     * Check if device has delayed click behavior\n     */\n    delayedClick(): boolean {\n        // Only mobile devices with touch events do this\n        if (this.touch) {\n            const mobileOS = this.mobileOS;\n            \n            // All iOS devices delay their click events\n            if (mobileOS && mobileOS.ios) {\n                return true;\n            }\n\n            if (mobileOS && mobileOS.android) {\n                // Older webkits and webviews delay the click\n                if (!this.browser.chrome) {\n                    return true;\n                }\n\n                // Chrome 32+ does conditional fast clicks\n                if (this.browser.version < 32) {\n                    return false;\n                }\n\n                // Check if viewport is user-scalable\n                const $ = this.$;\n                return !($(\"meta[name=viewport]\").attr(\"content\") || \"\").match(/user-scalable=no/i);\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Detect native input type support\n     */\n    private detectInputTypes(input: HTMLInputElement): InputTypeSupport {\n        const types = [\"number\", \"date\", \"time\", \"month\", \"week\", \"datetime\", \"datetime-local\"];\n        const value = \"test\";\n        const result: any = {};\n\n        for (const type of types) {\n            input.setAttribute(\"type\", type);\n            input.value = value;\n            result[type.replace(\"-\", \"\")] = input.type !== \"text\" && input.value !== value;\n        }\n\n        return result as InputTypeSupport;\n    }\n\n    /**\n     * Detect if sort is stable\n     */\n    private detectStableSort(): boolean {\n        // Chrome sort is not stable for more than 10 items\n        // IE9+ sort is not stable for more than 512 items\n        const threshold = 513;\n\n        const sorted: Array<{ index: number; field: string }> = [{\n            index: 0,\n            field: \"b\"\n        }];\n\n        for (let i = 1; i < threshold; i++) {\n            sorted.push({\n                index: i,\n                field: \"a\"\n            });\n        }\n\n        sorted.sort((a, b) => {\n            return a.field > b.field ? 1 : (a.field < b.field ? -1 : 0);\n        });\n\n        return sorted[0].index === 1;\n    }\n\n    /**\n     * Add browser-specific CSS classes to document element\n     */\n    private addBrowserCssClasses($: JQueryStatic): void {\n        const browser = this.browser;\n        let cssClass = \"\";\n        const docElement = $(document.documentElement);\n        const majorVersion = parseInt(String(browser.version), 10);\n\n        if (browser.msie) {\n            cssClass = \"ie\";\n        } else if (browser.mozilla) {\n            cssClass = \"ff\";\n        } else if (browser.safari) {\n            cssClass = \"safari\";\n        } else if (browser.webkit) {\n            cssClass = \"webkit\";\n        } else if (browser.opera) {\n            cssClass = \"opera\";\n        } else if (browser.edge) {\n            cssClass = \"edge\";\n        }\n\n        if (cssClass) {\n            cssClass = \"k-\" + cssClass + \" k-\" + cssClass + majorVersion;\n        }\n\n        if (this.mobileOS) {\n            cssClass += \" k-mobile\";\n        }\n\n        if (!this.cssFlexbox) {\n            cssClass += \" k-no-flexbox\";\n        }\n\n        docElement.addClass(cssClass);\n    }\n\n    /**\n     * Convert Bootstrap breakpoint name to CSS media query\n     */\n    bootstrapToMedia(bootstrapMedia: string): string | undefined {\n        const bootstrapBreakpoints: Record<string, string> = {\n            \"xs\": \"(max-width: 576px)\",\n            \"sm\": \"(min-width: 576px)\",\n            \"md\": \"(min-width: 768px)\",\n            \"lg\": \"(min-width: 992px)\",\n            \"xl\": \"(min-width: 1200px)\"\n        };\n        return bootstrapBreakpoints[bootstrapMedia];\n    }\n\n    /**\n     * Check if a media query matches\n     * Supports both CSS media queries and Bootstrap breakpoint names\n     */\n    matchesMedia(mediaQuery: string): boolean {\n        const media = this.bootstrapToMedia(mediaQuery) || mediaQuery;\n        return this.matchMedia && window.matchMedia(media).matches;\n    }\n}\n","import { IUtilsService } from \"../models\";\nimport { \n    IEffectsService, \n    DirectionsMap,\n    IEffects,\n    AnimationOptions,\n    IEffectsElement\n} from \"../models/effects\";\n\n// Constants\nconst STRING = \"string\";\nconst BOOLEAN = \"boolean\";\n\n/**\n * Effects Service - provides animation effects utilities\n \n */\nexport class EffectsService implements IEffectsService {\n    private _directions: DirectionsMap;\n    private _effects: IEffects;\n\n    constructor(\n        private $: JQueryStatic,\n        private utilsService: IUtilsService\n    ) {\n        this._directions = this.createDirections();\n        this._effects = this.createEffects();\n    }\n\n    /**\n     * Create the directions map\n     */\n    private createDirections(): DirectionsMap {\n        return {\n            left: {\n                reverse: \"right\",\n                property: \"left\",\n                transition: \"translatex\",\n                vertical: false,\n                modifier: -1\n            },\n            right: {\n                reverse: \"left\",\n                property: \"left\",\n                transition: \"translatex\",\n                vertical: false,\n                modifier: 1\n            },\n            down: {\n                reverse: \"up\",\n                property: \"top\",\n                transition: \"translatey\",\n                vertical: true,\n                modifier: 1\n            },\n            up: {\n                reverse: \"down\",\n                property: \"top\",\n                transition: \"translatey\",\n                vertical: true,\n                modifier: -1\n            },\n            top: {\n                reverse: \"bottom\"\n            },\n            bottom: {\n                reverse: \"top\"\n            },\n            \"in\": {\n                reverse: \"out\",\n                modifier: -1\n            },\n            out: {\n                reverse: \"in\",\n                modifier: 1\n            },\n            vertical: {\n                reverse: \"vertical\"\n            },\n            horizontal: {\n                reverse: \"horizontal\"\n            }\n        };\n    }\n\n    /**\n     * Create the effects object\n     */\n    private createEffects(): IEffects {\n        const $ = this.$;\n        const effects: IEffects = {\n            enabled: true,\n            Element: function(this: IEffectsElement, element: HTMLElement | JQuery) {\n                this.element = $(element);\n            } as any,\n            promise: function(element: JQuery, options: AnimationOptions) {\n                if (!element.is(\":visible\")) {\n                    element.css({ display: element.data(\"olddisplay\") || \"block\" }).css(\"display\");\n                }\n\n                if (options.hide) {\n                    element.data(\"olddisplay\", element.data(\"olddisplay\") || element.css(\"display\")).hide();\n                }\n\n                if (options.init) {\n                    options.init();\n                }\n\n                if (options.completeCallback) {\n                    options.completeCallback(element); // call the external complete callback with the element\n                }\n\n                element.dequeue();\n            },\n            promiseShim: null as any, // Will be set below\n            disable: function() {\n                this.enabled = false;\n                this.promise = this.promiseShim;\n            },\n            enable: function() {\n                this.enabled = true;\n                this.promise = this.animatedPromise!;\n            }\n        };\n\n        // Set promiseShim to be the same as promise initially\n        effects.promiseShim = effects.promise;\n\n        return effects;\n    }\n\n    /**\n     * Get the directions map for animations\n     */\n    get directions(): DirectionsMap {\n        return this._directions;\n    }\n\n    /**\n     * Get the effects object\n     */\n    get effects(): IEffects {\n        return this._effects;\n    }\n\n    /**\n     * Prepare animation options with defaults\n     */\n    prepareAnimationOptions(\n        options: string | AnimationOptions,\n        duration?: number | boolean | (() => void),\n        reverse?: boolean | (() => void),\n        complete?: () => void\n    ): AnimationOptions {\n        if (typeof options === STRING) {\n            // options is the list of effect names separated by space e.g. animate(element, \"fadeIn slideDown\")\n\n            // only callback is provided e.g. animate(element, options, function() {});\n            if (this.utilsService.isFunction(duration)) {\n                complete = duration as () => void;\n                duration = 400;\n                reverse = false;\n            }\n\n            if (this.utilsService.isFunction(reverse)) {\n                complete = reverse as () => void;\n                reverse = false;\n            }\n\n            if (typeof duration === BOOLEAN) {\n                reverse = duration as boolean;\n                duration = 400;\n            }\n\n            options = {\n                effects: options,\n                duration: duration as number,\n                reverse: reverse as boolean,\n                complete: complete\n            };\n        }\n\n        return this.$.extend({\n            //default options\n            effects: {},\n            duration: 400, //jQuery default duration\n            reverse: false,\n            init: this.$.noop,\n            teardown: this.$.noop,\n            hide: false\n        }, options, { completeCallback: (options as AnimationOptions).complete, complete: this.$.noop }); // Move external complete callback, so deferred.resolve can be always executed.\n    }\n\n    /**\n     * Animate one or more elements\n     */\n    animate(\n        element: JQuery,\n        options: string | AnimationOptions,\n        duration?: number | boolean | (() => void),\n        reverse?: boolean | (() => void),\n        complete?: () => void\n    ): JQuery {\n        const $ = this.$;\n        const effects = this._effects;\n        const preparedOptions = this.prepareAnimationOptions.bind(this);\n        let idx = 0;\n        const length = element.length;\n        let instance: JQuery;\n\n        for (; idx < length; idx++) {\n            instance = $(element[idx]);\n            instance.queue(function(this: HTMLElement) {\n                effects.promise($(this), preparedOptions(options, duration, reverse, complete));\n            });\n        }\n\n        return element;\n    }\n\n    /**\n     * Toggle CSS classes on element\n     */\n    toggleClass(element: JQuery, classes: string, options?: any, add?: boolean): JQuery {\n        if (classes) {\n            const classArray = classes.split(\" \");\n\n            this.$.each(classArray, (idx: number, value: string) => {\n                element.toggleClass(value, add);\n            });\n        }\n\n        return element;\n    }\n\n    /**\n     * Create an effects element wrapper\n     */\n    fx(element: HTMLElement | JQuery): IEffectsElement {\n        return new this._effects.Element(element);\n    }\n}\n","import { IFocusUtilsService } from \"../models/focus-utils\";\nimport { IDomUtilsService } from \"../models/dom-utils\";\nimport { IWidgetUtilsService } from \"../models\";\n\n// TAB key code - will be moved to utils service in future refactoring\nconst TAB_KEY = 9;\n\n/**\n * Focus Utils Service - provides focus-related utilities\n \n */\nexport class FocusUtilsService implements IFocusUtilsService {\n    constructor(\n        private $: JQueryStatic,\n        private domUtils: IDomUtilsService,\n        private widgetUtilsService: IWidgetUtilsService\n    ) {}\n\n    /**\n     * Check if an element is focusable\n     */\n    focusable(element: HTMLElement, isTabIndexNotNaN: boolean): boolean {\n        const nodeName = element.nodeName.toLowerCase();\n\n        return (/input|select|textarea|button|object/.test(nodeName) ?\n                !(element as HTMLInputElement).disabled :\n                nodeName === \"a\" ?\n                (element as HTMLAnchorElement).href || isTabIndexNotNaN :\n                isTabIndexNotNaN\n               ) &&\n            this.visible(element);\n    }\n\n    /**\n     * Check if an element is visible (not hidden or with visibility:hidden)\n     */\n    visible(element: HTMLElement): boolean {\n        const $ = this.$;\n        return ($.expr.pseudos as any).visible(element) &&\n            !$(element).parents().addBack().filter(function(this: HTMLElement) {\n                return $.css(this, \"visibility\") === \"hidden\";\n            }).length;\n    }\n\n    /**\n     * Check if an element is kendo-focusable (focusable with positive tabindex)\n     */\n    kendoFocusable(element: HTMLElement): boolean {\n        const idx = this.$(element).attr(\"tabindex\");\n        const numIdx = idx !== undefined ? parseInt(idx, 10) : NaN;\n        return this.focusable(element, !isNaN(numIdx) && numIdx > -1);\n    }\n\n    /**\n     * Focus an element while preserving scroll positions of parent containers\n     */\n    focusElement(element: JQuery): void {\n        const $ = this.$;\n        const domUtils = this.domUtils;\n        const scrollTopPositions: number[] = [];\n        const scrollableParents = element.parentsUntil(\"body\")\n                .filter(function(this: HTMLElement, index: number, el: HTMLElement) {\n                    const computedStyle = domUtils.getComputedStyles(el, [\"overflow\"]);\n                    return computedStyle.overflow !== \"visible\";\n                })\n                .add(window as any);\n\n        scrollableParents.each(function(this: HTMLElement | Window, index: number, parent: HTMLElement | Window) {\n            scrollTopPositions[index] = $(parent as any).scrollTop() || 0;\n        });\n\n        try {\n            //The setActive method does not cause the document to scroll to the active object in the current page\n            (element[0] as any).setActive();\n        } catch (e) {\n            element.trigger(\"focus\");\n        }\n\n        scrollableParents.each(function(this: HTMLElement | Window, index: number, parent: HTMLElement | Window) {\n            $(parent as any).scrollTop(scrollTopPositions[index]);\n        });\n    }\n\n    /**\n     * Focus the next focusable element in the document\n     */\n    focusNextElement(): void {\n        const $ = this.$;\n        if (document.activeElement) {\n            const focussable = $(\":kendoFocusable\");\n            const index = focussable.index(document.activeElement);\n\n            if (index > -1) {\n               const nextElement = focussable[index + 1] || focussable[0];\n               (nextElement as HTMLElement).focus();\n            }\n        }\n    }\n\n    /**\n     * Set up form cycling - when tabbing from last element, cycle to first\n     */\n    cycleForm(form: JQuery): void {\n        const $ = this.$;\n        const self = this;\n        const firstElement = form.find(\"input, .k-widget, .k-dropdownlist, .k-combobox\").first();\n        const lastElement = form.find(\"button, .k-button\").last();\n\n        function focus(el: JQuery) {\n            const widget = self.widgetUtilsService.widgetInstance(el);\n\n            if (widget && widget.focus) {\n              widget.focus();\n            } else {\n              el.trigger(\"focus\");\n            }\n        }\n\n        lastElement.on(\"keydown\", function(e: JQuery.KeyDownEvent) {\n          if (e.keyCode === TAB_KEY && !e.shiftKey) {\n            e.preventDefault();\n            focus(firstElement);\n          }\n        });\n\n        firstElement.on(\"keydown\", function(e: JQuery.KeyDownEvent) {\n          if (e.keyCode === TAB_KEY && e.shiftKey) {\n            e.preventDefault();\n            focus(lastElement);\n          }\n        });\n    }\n\n    /**\n     * Get the focusable element for a widget\n     */\n    getWidgetFocusableElement(element: JQuery): JQuery {\n        const $ = this.$;\n        const nextFocusable = element.closest(\":kendoFocusable\");\n        const widgetInstance = this.widgetUtilsService.widgetInstance(element);\n        let target: JQuery;\n\n        if (nextFocusable.length) {\n            target = nextFocusable;\n        } else if (widgetInstance) {\n            target = widgetInstance.options.name === 'Editor' ?\n                $(widgetInstance.body) :\n                widgetInstance.wrapper.find(\":kendoFocusable\").first();\n        } else {\n            target = element;\n        }\n\n        return target;\n    }\n\n    /**\n     * Register the :kendoFocusable pseudo-selector with jQuery\n     */\n    registerFocusableSelector(): void {\n        const self = this;\n        const $ = this.$;\n        $.extend($.expr.pseudos, {\n            kendoFocusable: function(element: HTMLElement) {\n                return self.kendoFocusable(element);\n            }\n        });\n    }\n\n    /**\n     * Get the currently focused element in the document.\n     * Handles exceptions that can occur in some browsers.\n     * @returns The active element\n     */\n    activeElement(): Element {\n        try {\n            return document.activeElement!;\n        } catch (e) {\n            return (document.documentElement as any).activeElement;\n        }\n    }\n}\n","import { IUtilsService } from \"../models/utils\";\nimport {\n    IPropertyAccessService,\n    PropertyGetter,\n    PropertySetter,\n    PropertyAccessor\n} from \"../models/property-access\";\n\n/**\n * Property Access Service Implementation\n * Provides utilities for dynamic property access using path expressions.\n \n */\nexport class PropertyAccessService implements IPropertyAccessService {\n    private getterCache: Record<string, PropertyGetter> = {};\n    private setterCache: Record<string, PropertySetter> = {};\n\n    constructor(\n        private utilsService: IUtilsService\n    ) {}\n\n    /**\n     * Wrap an expression for safe access.\n     * Generates nested null-safe property access.\n     */\n    private wrapExpression(members: string[], paramName: string): string {\n        let result = paramName || \"d\";\n        let count = 1;\n\n        for (let idx = 0; idx < members.length; idx++) {\n            let member = members[idx];\n            if (member !== \"\") {\n                const index = member.indexOf(\"[\");\n\n                if (index !== 0) {\n                    if (index === -1) {\n                        member = \".\" + member;\n                    } else {\n                        count++;\n                        member = \".\" + member.substring(0, index) + \" || {})\" + member.substring(index);\n                    }\n                }\n\n                count++;\n                result += member + ((idx < members.length - 1) ? \" || {})\" : \")\");\n            }\n        }\n        return new Array(count).join(\"(\") + result;\n    }\n\n    /**\n     * Generate a JavaScript expression for accessing a property path.\n     */\n    expr(expression: string, safe?: boolean | string, paramName?: string): string {\n        expression = expression || \"\";\n\n        if (typeof safe === \"string\") {\n            paramName = safe;\n            safe = false;\n        }\n\n        paramName = paramName || \"d\";\n\n        if (expression && expression.charAt(0) !== \"[\") {\n            expression = \".\" + expression;\n        }\n\n        if (safe) {\n            expression = expression.replace(/\"([^.]*)\\.([^\"]*)\"/g, '\"$1_$DOT$_$2\"');\n            expression = expression.replace(/'([^.]*)\\.([^']*)'/g, \"'$1_$DOT$_$2'\");\n            expression = this.wrapExpression(expression.split(\".\"), paramName);\n            expression = expression.replace(/_\\$DOT\\$_/g, \".\");\n        } else {\n            expression = paramName + expression;\n        }\n\n        return expression;\n    }\n\n    /**\n     * Convert an expression to an array of field names.\n     */\n    exprToArray(expression: string, safe?: boolean): string[] {\n        expression = expression || \"\";\n\n        return expression.indexOf(\".\") >= 0 || expression.indexOf(\"[\") >= 0 ?\n            expression.split(/[[\\].]/).map(v => v.replace(/[\"']/g, \"\")).filter(v => v) :\n            expression === \"\" ? [] : [expression];\n    }\n\n    /**\n     * Create a getter function for a property path.\n     */\n    getter(expression: string, safe?: boolean): PropertyGetter {\n        const key = expression + safe;\n\n        if (!this.getterCache[key]) {\n            this.getterCache[key] = (obj: any) => {\n                const fields = this.exprToArray(expression, safe);\n\n                let result = obj;\n                for (let idx = 0; idx < fields.length; idx++) {\n                    result = result[fields[idx]];\n                    if (!this.utilsService.isPresent(result) && safe) {\n                        return result;\n                    }\n                }\n\n                return result;\n            };\n        }\n\n        return this.getterCache[key];\n    }\n\n    /**\n     * Create a setter function for a property path.\n     */\n    setter(expression: string): PropertySetter {\n        if (!this.setterCache[expression]) {\n            this.setterCache[expression] = (obj: any, value: any) => {\n                const fields = this.exprToArray(expression);\n\n                const innerSetter = (args: { parent: any; val: any; prop: string; props: string[] }) => {\n                    if (args.props.length) {\n                        args.parent = args.parent[args.props.shift()!];\n                        innerSetter(args);\n                    } else {\n                        args.parent[args.prop] = args.val;\n                    }\n                };\n\n                innerSetter({\n                    parent: obj,\n                    val: value,\n                    prop: fields.pop()!,\n                    props: fields\n                });\n            };\n        }\n\n        return this.setterCache[expression];\n    }\n\n    /**\n     * Create an accessor with both get and set functions.\n     */\n    accessor(expression: string): PropertyAccessor {\n        return {\n            get: this.getter(expression),\n            set: this.setter(expression)\n        };\n    }\n}\n","import { IInputService, CaretPosition } from \"../models/input\";\nimport { ISupportService } from \"../models/support\";\n\n/**\n * Input Service Implementation\n * Provides utilities for input element manipulation.\n \n */\nexport class InputService implements IInputService {\n    constructor(\n        private $: JQueryStatic,\n        private supportService: ISupportService\n    ) {}\n\n    /**\n     * Get or set the caret (text cursor) position in an input element.\n     */\n    caret(element: HTMLInputElement | HTMLTextAreaElement | JQuery, start?: number, end?: number): CaretPosition {\n        let rangeElement: any;\n        const isPosition = start !== undefined;\n\n        if (end === undefined) {\n            end = start;\n        }\n\n        // Unwrap jQuery element\n        if ((element as JQuery)[0]) {\n            element = (element as JQuery)[0] as HTMLInputElement;\n        }\n\n        const inputElement = element as HTMLInputElement | HTMLTextAreaElement;\n\n        if (isPosition && inputElement.disabled) {\n            return [];\n        }\n\n        try {\n            if (inputElement.selectionStart !== undefined) {\n                if (isPosition) {\n                    inputElement.focus();\n                    const mobile = this.supportService.mobileOS;\n                    if (mobile && (mobile.wp || mobile.android)) {\n                        // Without the timeout the caret is at the end of the input\n                        setTimeout(() => {\n                            inputElement.setSelectionRange(start!, end!);\n                        }, 0);\n                    } else {\n                        inputElement.setSelectionRange(start!, end!);\n                    }\n                    return [start!, end!];\n                } else {\n                    return [inputElement.selectionStart, inputElement.selectionEnd];\n                }\n            } else if ((document as any).selection) {\n                // Legacy IE support\n                if (this.$(inputElement).is(\":visible\")) {\n                    inputElement.focus();\n                }\n\n                rangeElement = (inputElement as any).createTextRange();\n\n                if (isPosition) {\n                    rangeElement.collapse(true);\n                    rangeElement.moveStart(\"character\", start);\n                    rangeElement.moveEnd(\"character\", end! - start!);\n                    rangeElement.select();\n                    return [start!, end!];\n                } else {\n                    const rangeDuplicated = rangeElement.duplicate();\n                    let selectionStart: number;\n                    let selectionEnd: number;\n\n                    rangeElement.moveToBookmark((document as any).selection.createRange().getBookmark());\n                    rangeDuplicated.setEndPoint(\"EndToStart\", rangeElement);\n                    selectionStart = rangeDuplicated.text.length;\n                    selectionEnd = selectionStart + rangeElement.text.length;\n\n                    return [selectionStart, selectionEnd];\n                }\n            }\n        } catch (e) {\n            // Element is not focused or it is not in the DOM\n            return [];\n        }\n\n        return [];\n    }\n\n    /**\n     * Get anti-forgery (CSRF) tokens from the page.\n     */\n    antiForgeryTokens(): Record<string, string> {\n        const tokens: Record<string, string> = {};\n        const $ = this.$;\n\n        const csrfToken = $(\"meta[name=csrf-token],meta[name=_csrf]\").attr(\"content\");\n        const csrfParam = $(\"meta[name=csrf-param],meta[name=_csrf_header]\").attr(\"content\");\n\n        $(\"input[name^='__RequestVerificationToken']\").each(function(this: HTMLInputElement) {\n            tokens[this.name] = this.value;\n        });\n\n        if (csrfParam !== undefined && csrfToken !== undefined) {\n            tokens[csrfParam] = csrfToken;\n        }\n\n        return tokens;\n    }\n}\n","import { IColorService } from \"../models/color\";\n\n/**\n * Color Service Implementation\n * Provides utilities for extracting theme colors.\n \n */\nexport class ColorService implements IColorService {\n    constructor(private $: JQueryStatic) {}\n\n    /**\n     * Get series colors from CSS custom properties.\n     */\n    getSeriesColors(): string[] {\n        const seriesColorsTemplate = \n            '<div class=\"k-var--series-a\"></div>' +\n            '<div class=\"k-var--series-b\"></div>' +\n            '<div class=\"k-var--series-c\"></div>' +\n            '<div class=\"k-var--series-d\"></div>' +\n            '<div class=\"k-var--series-e\"></div>' +\n            '<div class=\"k-var--series-f\"></div>';\n\n        const series = this.$(seriesColorsTemplate);\n        const colors: string[] = [];\n\n        series.appendTo(this.$(\"body\"));\n\n        series.each((_i: number, item: HTMLElement) => {\n            colors.push(this.$(item).css(\"background-color\"));\n        });\n\n        series.remove();\n\n        return colors;\n    }\n}\n","import { ISelectorService } from \"../models/selector\";\n\n/**\n * Selector Service Implementation\n * Provides utilities for building CSS selectors.\n \n */\nexport class SelectorService implements ISelectorService {\n    /**\n     * Convert space-separated class names to a CSS selector.\n     */\n    selectorFromClasses(classes: string): string {\n        return \".\" + classes.split(\" \").join(\".\");\n    }\n\n    /**\n     * Build a role selector for data-role attributes.\n     */\n    roleSelector(role: string, ns: string): string {\n        return role.replace(/(\\S+)/g, \"[data-\" + ns + \"role=$1],\").slice(0, -1);\n    }\n\n    /**\n     * Build a directive selector for mobile components.\n     */\n    directiveSelector(directives: string): string {\n        const selectors = directives.split(\" \");\n\n        if (selectors) {\n            for (let i = 0; i < selectors.length; i++) {\n                if (selectors[i] !== \"view\") {\n                    selectors[i] = selectors[i].replace(/(\\w*)(view|bar|strip|over)$/, \"$1-$2\");\n                }\n            }\n        }\n\n        return selectors.join(\" \").replace(/(\\S+)/g, \"kendo-mobile-$1,\").slice(0, -1);\n    }\n}\n","import { INumberParserService } from \"../models/parser\";\nimport { \n    ITimezoneService, \n    MonthMap, \n    DayMap, \n    TimezoneRule, \n    TimezoneZone,\n    ZonesDictionary,\n    RulesDictionary,\n    ZoneAndRuleInfo\n} from \"../models/timezone\";\n\n// Constants\nconst NUMBER = \"number\";\nconst STRING = \"string\";\n\n/**\n * Service for timezone conversions\n * Extracted from kendo.timezone in kendo.core.js\n */\nexport class TimezoneService implements ITimezoneService {\n    /**\n     * Timezone zone definitions - populated externally\n     */\n    zones: ZonesDictionary = {};\n\n    /**\n     * Timezone rule definitions - populated externally\n     */\n    rules: RulesDictionary = {};\n\n    /**\n     * Month name to index mapping\n     */\n    private months: MonthMap = { \n        Jan: 0, Feb: 1, Mar: 2, Apr: 3, May: 4, Jun: 5, \n        Jul: 6, Aug: 7, Sep: 8, Oct: 9, Nov: 10, Dec: 11 \n    };\n\n    /**\n     * Day name to index mapping\n     */\n    private days: DayMap = { \n        Sun: 0, Mon: 1, Tue: 2, Wed: 3, Thu: 4, Fri: 5, Sat: 6 \n    };\n\n    constructor(\n        private numberParserService: INumberParserService\n    ) {}\n\n    /**\n     * Get the UTC offset for a given time in a timezone\n     */\n    offset(utcTime: number | Date, timezone: string): number {\n        if (timezone === \"Etc/UTC\" || timezone === \"Etc/GMT\") {\n            return 0;\n        }\n\n        const info = this.zoneAndRule(utcTime, this.zones, this.rules, timezone);\n        const zone = info.zone;\n        const rule = info.rule;\n\n        return this.numberParserService.parseFloat(rule ? (zone[0] as number) - (rule[6] as number) : zone[0] as number);\n    }\n\n    /**\n     * Get the timezone abbreviation for a given time\n     */\n    abbr(utcTime: number | Date, timezone: string): string {\n        const info = this.zoneAndRule(utcTime, this.zones, this.rules, timezone);\n        const zone = info.zone;\n        const rule = info.rule;\n\n        const base = zone[2] as string;\n\n        if (base.indexOf(\"/\") >= 0) {\n            return base.split(\"/\")[rule && +rule[6] ? 1 : 0];\n        } else if (base.indexOf(\"%s\") >= 0) {\n            return base.replace(\"%s\", (!rule || rule[7] === \"-\") ? '' : rule[7] as string);\n        }\n\n        return base;\n    }\n\n    /**\n     * Convert a date between timezones\n     */\n    convert(date: Date, fromOffset: string | number, toOffset: string | number): Date {\n        let tempToOffset = toOffset;\n        let diff: number;\n\n        if (typeof fromOffset === STRING) {\n            fromOffset = this.offset(date, fromOffset as string);\n        }\n\n        if (typeof toOffset === STRING) {\n            toOffset = this.offset(date, toOffset as string);\n        }\n\n        const fromLocalOffset = date.getTimezoneOffset();\n\n        date = new Date(date.getTime() + ((fromOffset as number) - (toOffset as number)) * 60000);\n\n        const toLocalOffset = date.getTimezoneOffset();\n\n        if (typeof tempToOffset === STRING) {\n            tempToOffset = this.offset(date, tempToOffset as string);\n        }\n\n        diff = (toLocalOffset - fromLocalOffset) + ((toOffset as number) - (tempToOffset as number));\n\n        return new Date(date.getTime() + diff * 60000);\n    }\n\n    /**\n     * Apply a timezone to a local date\n     */\n    apply(date: Date, timezone: string): Date {\n        return this.convert(date, date.getTimezoneOffset(), timezone);\n    }\n\n    /**\n     * Remove timezone adjustment from a date\n     */\n    remove(date: Date, timezone: string): Date {\n        return this.convert(date, timezone, date.getTimezoneOffset());\n    }\n\n    /**\n     * Convert a UTC timestamp to a local date\n     */\n    toLocalDate(time: number): Date {\n        return this.apply(new Date(time), \"Etc/UTC\");\n    }\n\n    /**\n     * Convert a rule to a Date for a specific year\n     */\n    private ruleToDate(year: number, rule: TimezoneRule): Date {\n        let date: Date;\n        let targetDay: number;\n        let ourDay: number;\n        const month = rule[3] as string;\n        const on = rule[4] as string | number;\n        const time = rule[5] as number[];\n        let cache = rule[8] as Record<number, Date>;\n\n        if (!cache) {\n            rule[8] = cache = {};\n        }\n\n        if (cache[year]) {\n            return cache[year];\n        }\n\n        if (!isNaN(on as number)) {\n            date = new Date(Date.UTC(year, this.months[month], on as number, time[0], time[1], time[2], 0));\n        } else if ((on as string).indexOf(\"last\") === 0) {\n            date = new Date(Date.UTC(year, this.months[month] + 1, 1, time[0] - 24, time[1], time[2], 0));\n\n            targetDay = this.days[(on as string).substr(4, 3)];\n            ourDay = date.getUTCDay();\n\n            date.setUTCDate(date.getUTCDate() + targetDay - ourDay - (targetDay > ourDay ? 7 : 0));\n        } else if ((on as string).indexOf(\">=\") >= 0) {\n            date = new Date(Date.UTC(year, this.months[month], parseInt((on as string).substr(5), 10), time[0], time[1], time[2], 0));\n\n            targetDay = this.days[(on as string).substr(0, 3)];\n            ourDay = date.getUTCDay();\n\n            date.setUTCDate(date.getUTCDate() + targetDay - ourDay + (targetDay < ourDay ? 7 : 0));\n        } else if ((on as string).indexOf(\"<=\") >= 0) {\n            date = new Date(Date.UTC(year, this.months[month], parseInt((on as string).substr(5), 10), time[0], time[1], time[2], 0));\n\n            targetDay = this.days[(on as string).substr(0, 3)];\n            ourDay = date.getUTCDay();\n\n            date.setUTCDate(date.getUTCDate() + targetDay - ourDay - (targetDay > ourDay ? 7 : 0));\n        }\n\n        return cache[year] = date!;\n    }\n\n    /**\n     * Find the applicable rule for a given UTC time\n     */\n    private findRule(utcTime: number, rules: RulesDictionary, zone: string): TimezoneRule | null {\n        let zoneRules = rules[zone] as TimezoneRule[];\n\n        if (!zoneRules) {\n            const time = zone.split(\":\");\n            let offset = 0;\n\n            if (time.length > 1) {\n                offset = parseInt(time[0], 10) * 60 + Number(time[1]);\n            }\n\n            return [-1000000, 'max', '-', 'Jan', 1, [0, 0, 0], offset, '-'] as TimezoneRule;\n        }\n\n        const year = new Date(utcTime).getUTCFullYear();\n\n        // Filter rules applicable to this year\n        // Note: Using == for loose equality to match original behavior since rule values may be strings\n        zoneRules = zoneRules.filter((rule: TimezoneRule) => {\n            const from = rule[0];\n            const to = rule[1];\n\n            // eslint-disable-next-line eqeqeq\n            return (from as number) <= year && ((to as number) >= year || (from == year && to === \"only\") || to === \"max\");\n        });\n\n        // Add the utcTime to sort with rules\n        const sortArray: (TimezoneRule | number)[] = [...zoneRules, utcTime];\n\n        sortArray.sort((a, b) => {\n            let aVal = a as number;\n            let bVal = b as number;\n\n            if (typeof a !== \"number\") {\n                aVal = Number(this.ruleToDate(year, a as TimezoneRule));\n            }\n\n            if (typeof b !== \"number\") {\n                bVal = Number(this.ruleToDate(year, b as TimezoneRule));\n            }\n\n            return aVal - bVal;\n        });\n\n        const idx = sortArray.indexOf(utcTime);\n        const rule = sortArray[idx - 1] || sortArray[sortArray.length - 1];\n\n        return isNaN(rule as number) ? rule as TimezoneRule : null;\n    }\n\n    /**\n     * Find the zone definition for a given UTC time\n     */\n    private findZone(utcTime: number, zones: ZonesDictionary, timezone: string): TimezoneZone {\n        let zoneRules = zones[timezone];\n\n        if (typeof zoneRules === \"string\") {\n            zoneRules = zones[zoneRules] as TimezoneZone[];\n        }\n\n        if (!zoneRules) {\n            throw new Error('Timezone \"' + timezone + '\" is either incorrect, or kendo.timezones.min.js is not included.');\n        }\n\n        const zoneArray = zoneRules as TimezoneZone[];\n        let idx: number;\n\n        for (idx = zoneArray.length - 1; idx >= 0; idx--) {\n            const until = zoneArray[idx][3];\n\n            if (until && utcTime > until) {\n                break;\n            }\n        }\n\n        const zone = zoneArray[idx + 1];\n\n        if (!zone) {\n            throw new Error('Timezone \"' + timezone + '\" not found on ' + utcTime + \".\");\n        }\n\n        return zone;\n    }\n\n    /**\n     * Get zone and rule info for a given UTC time\n     */\n    private zoneAndRule(utcTime: number | Date, zones: ZonesDictionary, rules: RulesDictionary, timezone: string): ZoneAndRuleInfo {\n        if (typeof utcTime !== NUMBER) {\n            const date = utcTime as Date;\n            utcTime = Date.UTC(date.getFullYear(), date.getMonth(),\n                date.getDate(), date.getHours(), date.getMinutes(),\n                date.getSeconds(), date.getMilliseconds());\n        }\n\n        const zone = this.findZone(utcTime as number, zones, timezone);\n\n        return {\n            zone: zone,\n            rule: this.findRule(utcTime as number, rules, zone[1] as string)\n        };\n    }\n}\n","/**\n * Type utilities service for runtime type checking.\n * Implements jQuery's deprecated type() function.\n *\n * @module core-v2/services/type-utils.service\n */\n\n/**\n * Mapping of Object.prototype.toString results to type names\n */\nexport type Class2TypeMap = Record<string, string>;\n\n/**\n * Service for runtime type checking utilities.\n * Provides type() function that was deprecated in jQuery.\n */\nexport class TypeUtilsService {\n    /**\n     * Map of toString results to lowercase type names\n     */\n    private class2type: Class2TypeMap = {};\n\n    constructor() {\n        // Build the class2type map for standard JavaScript types\n        \"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \")\n            .forEach((name) => {\n                this.class2type[\"[object \" + name + \"]\"] = name.toLowerCase();\n            });\n    }\n\n    /**\n     * Get the class2type mapping object\n     */\n    getClass2Type(): Class2TypeMap {\n        return this.class2type;\n    }\n\n    /**\n     * Determine the internal JavaScript [[Class]] of an object.\n     * This is a replacement for jQuery.type() which was deprecated.\n     *\n     * @param obj - The object to get the type of\n     * @returns The type name as a lowercase string (e.g., \"string\", \"number\", \"array\", \"date\", \"regexp\", \"object\", \"null\", \"undefined\")\n     *\n     * @example\n     * ```typescript\n     * type(undefined)     // \"undefined\"\n     * type(null)          // \"null\"\n     * type(true)          // \"boolean\"\n     * type(3)             // \"number\"\n     * type(\"test\")        // \"string\"\n     * type(function(){})  // \"function\"\n     * type([])            // \"array\"\n     * type(new Date())    // \"date\"\n     * type(/test/)        // \"regexp\"\n     * type({})            // \"object\"\n     * ```\n     */\n    type(obj: unknown): string {\n        // eslint-disable-next-line eqeqeq\n        if (obj == null) {\n            return obj + \"\";\n        }\n\n        // Support: Android <=2.3 only (functionish RegExp)\n        return typeof obj === \"object\" || typeof obj === \"function\" ?\n            this.class2type[Object.prototype.toString.call(obj)] || \"object\" :\n            typeof obj;\n    }\n}\n","/**\n * Mouse Event Normalizer Service\n * Handles mouse event capturing and muting for touch/pointer event normalization.\n *\n * @module core-v2/services/mouse-event-normalizer.service\n */\n\nimport type { ISupportService } from \"../models/support\";\n\n/**\n * Mouse event normalizer service for handling touch/mouse event conflicts.\n * Prevents ghost clicks and normalizes touch events to mouse events.\n */\nexport class MouseEventNormalizerService {\n    /**\n     * Whether the mouse trap has been set up\n     */\n    mouseTrap: boolean = false;\n\n    /**\n     * Whether click events should be busted (prevented)\n     */\n    bustClick: boolean = false;\n\n    /**\n     * Whether mouse events are currently being captured/muted\n     */\n    captureMouse: boolean = false;\n\n    /**\n     * Timeout ID for the mouse trap release\n     */\n    mouseTrapTimeoutID: ReturnType<typeof setTimeout> | undefined;\n\n    /**\n     * List of mouse events to capture\n     */\n    private readonly MOUSE_EVENTS = [\"mousedown\", \"mousemove\", \"mouseenter\", \"mouseleave\", \"mouseover\", \"mouseout\", \"mouseup\", \"click\"];\n\n    /**\n     * Selector for elements that should not have click busting\n     */\n    private readonly EXCLUDE_BUST_CLICK_SELECTOR = \"label, input, [data-rel=external]\";\n\n    constructor(\n        private $: JQueryStatic,\n        private support: ISupportService\n    ) {}\n\n    /**\n     * Set up mouse event capturing to prevent ghost clicks from touch events.\n     * This sets up event listeners on document.documentElement to intercept\n     * and optionally stop mouse events when touch events are active.\n     */\n    setupMouseMute(): void {\n        let idx = 0;\n        const length = this.MOUSE_EVENTS.length;\n        const element = document.documentElement;\n\n        if (this.mouseTrap || !this.support.eventCapture) {\n            return;\n        }\n\n        this.mouseTrap = true;\n\n        this.bustClick = false;\n        this.captureMouse = false;\n\n        const self = this;\n        const handler = function(e: Event) {\n            if (self.captureMouse) {\n                if (e.type === \"click\") {\n                    if (self.bustClick && !self.$(e.target as Element).is(self.EXCLUDE_BUST_CLICK_SELECTOR)) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                    }\n                } else {\n                    e.stopPropagation();\n                }\n            }\n        };\n\n        for (; idx < length; idx++) {\n            element.addEventListener(this.MOUSE_EVENTS[idx], handler, true);\n        }\n    }\n\n    /**\n     * Mute mouse events. Called on touchstart to prevent ghost clicks.\n     * @param e - The jQuery event with bustClick data\n     */\n    muteMouse(e: JQuery.Event & { data?: { bustClick?: boolean } }): void {\n        this.captureMouse = true;\n        if (e.data?.bustClick) {\n            this.bustClick = true;\n        }\n        clearTimeout(this.mouseTrapTimeoutID);\n    }\n\n    /**\n     * Unmute mouse events. Called on touchend after a delay to allow\n     * legitimate mouse events through again.\n     */\n    unMuteMouse(): void {\n        clearTimeout(this.mouseTrapTimeoutID);\n        this.mouseTrapTimeoutID = setTimeout(() => {\n            this.captureMouse = false;\n            this.bustClick = false;\n        }, 400);\n    }\n}\n","/**\n * Event Map Service\n * Provides cross-browser event mapping for touch, pointer, and mouse events.\n *\n * @module core-v2/services/event-map.service\n */\n\nimport type { ISupportService } from \"../models/support\";\n\n/**\n * Event map type - maps abstract event names to browser-specific events\n */\nexport interface EventMap {\n    down: string;\n    move: string;\n    up: string;\n    cancel: string;\n}\n\n/**\n * Event map service for cross-browser event handling.\n * Maps abstract event names (down, move, up, cancel) to the appropriate\n * browser-specific events based on touch/pointer/mouse support.\n */\nexport class EventMapService {\n    /**\n     * The current event map based on browser capabilities\n     */\n    private eventMap: EventMap;\n\n    /**\n     * Regex for matching event names in a string\n     */\n    private readonly eventRegEx = /([^ ]+)/g;\n\n    constructor(\n        private $: JQueryStatic,\n        private support: ISupportService\n    ) {\n        this.eventMap = this.buildEventMap();\n        this.setupMSPointerEvents();\n    }\n\n    /**\n     * Build the event map based on browser capabilities\n     */\n    private buildEventMap(): EventMap {\n        // Default: combined touch and mouse events\n        let map: EventMap = {\n            down: \"touchstart mousedown\",\n            move: \"mousemove touchmove\",\n            up: \"mouseup touchend touchcancel\",\n            cancel: \"mouseleave touchcancel\"\n        };\n\n        if (this.support.touch && (this.support.mobileOS && (this.support.mobileOS.ios || this.support.mobileOS.android))) {\n            // Touch-only devices\n            map = {\n                down: \"touchstart\",\n                move: \"touchmove\",\n                up: \"touchend touchcancel\",\n                cancel: \"touchcancel\"\n            };\n        } else if (this.support.pointers) {\n            // W3C Pointer Events\n            map = {\n                down: \"pointerdown\",\n                move: \"pointermove\",\n                up: \"pointerup\",\n                cancel: \"pointercancel pointerleave\"\n            };\n        } else if (this.support.msPointers) {\n            // IE10 MS Pointer Events\n            map = {\n                down: \"MSPointerDown\",\n                move: \"MSPointerMove\",\n                up: \"MSPointerUp\",\n                cancel: \"MSPointerCancel MSPointerLeave\"\n            };\n        }\n\n        return map;\n    }\n\n    /**\n     * Setup MSPointerEnter/MSPointerLeave events for IE10\n     * Creates these events using mouseover/out and event-time checks\n     */\n    private setupMSPointerEvents(): void {\n        if (this.support.msPointers && !(\"onmspointerenter\" in window)) {\n            // IE10 - Create MSPointerEnter/MSPointerLeave events\n            this.$.each({\n                MSPointerEnter: \"MSPointerOver\",\n                MSPointerLeave: \"MSPointerOut\"\n            }, (orig: string, fix: string) => {\n                (this.$.event as any).special[orig] = {\n                    delegateType: fix,\n                    bindType: fix,\n\n                    handle: function(event: JQuery.Event & { handleObj?: any; relatedTarget?: EventTarget | null }) {\n                        let ret;\n                        const target = this;\n                        const related = event.relatedTarget;\n                        const handleObj = event.handleObj;\n\n                        // For mousenter/leave call the handler if related is outside the target.\n                        // NB: No relatedTarget if the mouse left/entered the browser window\n                        if (!related || (related !== target && !this.$.contains(target, related as Element))) {\n                            event.type = handleObj.origType;\n                            ret = handleObj.handler.apply(this, arguments);\n                            event.type = fix;\n                        }\n                        return ret;\n                    }\n                };\n            });\n        }\n    }\n\n    /**\n     * Get the mapped event for an abstract event name\n     * @param eventName - The abstract event name (down, move, up, cancel) or specific event\n     * @returns The browser-specific event(s) or the original event if no mapping exists\n     */\n    getEventMap(eventName: string): string {\n        return (this.eventMap as any)[eventName] || eventName;\n    }\n\n    /**\n     * Get the full event map object\n     */\n    getFullEventMap(): EventMap {\n        return { ...this.eventMap };\n    }\n\n    /**\n     * Apply event mapping to a space-separated list of events\n     * @param events - Space-separated event names to map\n     * @param ns - Optional namespace to append to each event\n     * @returns The mapped and namespaced events\n     */\n    applyEventMap(events: string, ns?: string): string {\n        events = events.replace(this.eventRegEx, (e: string) => this.getEventMap(e));\n\n        if (ns) {\n            events = events.replace(this.eventRegEx, \"$1.\" + ns);\n        }\n\n        return events;\n    }\n}\n","/**\n * Defaults Service\n * Manages global Kendo defaults configuration with deep path support.\n *\n * @module core-v2/services/defaults.service\n */\n\nimport type { IUtilsService } from \"../models/utils\";\n\n/**\n * Generic object type for defaults storage\n */\ntype DefaultsObject = Record<string, unknown>;\n\n/**\n * Service for managing global Kendo defaults configuration.\n * Supports deep path-based setting with automatic object creation.\n */\nexport class DefaultsService {\n    /**\n     * The defaults storage object\n     */\n    private defaults: DefaultsObject = {};\n\n    constructor(private utils: IUtilsService) {}\n\n    /**\n     * Get the current defaults object\n     */\n    getDefaults(): DefaultsObject {\n        return this.defaults;\n    }\n\n    /**\n     * Set a default value at a given path.\n     * Supports dot-separated paths for nested values.\n     * Objects are deep extended, primitives are replaced.\n     *\n     * @param key - Dot-separated path (e.g., \"breakpoints\", \"grid.pager.pageSize\")\n     * @param value - The value to set at the path\n     *\n     * @example\n     * ```typescript\n     * // Set a simple value\n     * setDefaults('pageSize', 10);\n     *\n     * // Set a nested value\n     * setDefaults('grid.pager.pageSize', 20);\n     *\n     * // Deep extend an object\n     * setDefaults('breakpoints', { sm: 576, md: 768 });\n     * ```\n     */\n    setDefaults(key: string, value: unknown): void {\n        const path = key.split(\".\");\n        let curr: DefaultsObject = this.defaults;\n\n        key = path.pop() as string;\n\n        path.forEach((part) => {\n            if (curr[part] === undefined) {\n                curr[part] = {};\n            }\n\n            curr = curr[part] as DefaultsObject;\n        });\n\n        if (value !== null && typeof value === \"object\" && value.constructor === Object) {\n            curr[key] = this.utils.deepExtend({}, curr[key] as object || {}, value as object);\n        } else {\n            curr[key] = value;\n        }\n    }\n\n    /**\n     * Get a default value at a given path.\n     *\n     * @param key - Dot-separated path (e.g., \"breakpoints\", \"grid.pager.pageSize\")\n     * @returns The value at the path, or undefined if not found\n     */\n    getDefault(key: string): unknown {\n        const path = key.split(\".\");\n        let curr: DefaultsObject = this.defaults;\n\n        for (const part of path) {\n            if (curr[part] === undefined) {\n                return undefined;\n            }\n            curr = curr[part] as DefaultsObject;\n        }\n\n        return curr;\n    }\n}\n","/**\n * Widget Registry Service\n * \n * Manages widget registration across different namespaces (ui, mobile.ui, dataviz.ui).\n * Provides both modern service-based access and maintains backward compatibility\n * with legacy kendo.ui.plugin() pattern.\n *\n \n */\n\nimport type {\n    IWidgetRegistryService,\n    IWidgetEntry,\n    IWidgetNamespace,\n    IWidgetRegistrationOptions\n} from \"../models/widget-registry\";\nimport type { WidgetConstructor } from \"../models/widget\";\nimport type { IFormatterService } from \"../models/formatter\";\n\n// Constants\nconst STRING = \"string\";\nconst FUNCTION = \"function\";\n\n/**\n * Widget Registry Service implementation\n */\nexport class WidgetRegistryService implements IWidgetRegistryService<any> {\n    /**\n     * All registered widgets\n     */\n    private widgets: IWidgetEntry<any>[] = [];\n\n    /**\n     * Namespace registers (e.g., { \"ui\": kendo.ui, \"mobile.ui\": kendo.mobile.ui })\n     */\n    private namespaces: Map<string, IWidgetNamespace<any>> = new Map();\n\n    constructor(\n        private $: JQueryStatic,\n        private formatterService: IFormatterService\n    ) {}\n\n    /**\n     * Create a new namespace with roles:{} and register it\n     * This is the primary way to create namespaces - the service owns them.\n     * @param name - Namespace name (e.g., \"ui\", \"mobile.ui\", \"dataviz.ui\")\n     * @param properties - Additional properties to add to the namespace\n     * @returns The created namespace object\n     */\n    createNamespace(name: string, properties?: Record<string, any>): IWidgetNamespace<any> {\n        const namespace: IWidgetNamespace<any> = {\n            roles: {},\n            ...properties\n        };\n        this.namespaces.set(name, namespace);\n        return namespace;\n    }\n\n    /**\n     * Get a namespace register\n     * @param name - Namespace name\n     * @returns The namespace object or undefined\n     */\n    getNamespace(name: string): IWidgetNamespace<any> | undefined {\n        return this.namespaces.get(name);\n    }\n\n    /**\n     * Register a widget using options\n     */\n    register(widget: WidgetConstructor<any>, options: IWidgetRegistrationOptions = {}): void {\n        const namespace = options.namespace || \"ui\";\n        const register = this.namespaces.get(namespace);\n\n        if (!register) {\n            throw new Error(`Unknown widget namespace: ${namespace}`);\n        }\n\n        this.registerToNamespace(widget, register, options.prefix);\n    }\n\n    /**\n     * Register a widget to a specific namespace register\n     * This is the core implementation matching the original kendo.ui.plugin\n     */\n    registerToNamespace(widget: WidgetConstructor<any>, register: IWidgetNamespace<any>, prefix?: string): void {\n        const name = widget.fn.options.name || (widget as any).options?.name;\n\n        if (!name) {\n            throw new Error(\"Widget must have a name in options\");\n        }\n\n        prefix = prefix || \"\";\n\n        // Register to namespace\n        register[name] = widget;\n        register.roles[name.toLowerCase()] = widget;\n\n        // Create jQuery plugin\n        const getter = \"getKendo\" + prefix + name;\n        const pluginName = \"kendo\" + prefix + name;\n\n        this.createJQueryPlugin(pluginName, widget, getter);\n\n        // Track widget entry\n        const widgetEntry: IWidgetEntry<any> = {\n            name: pluginName,\n            widget: widget,\n            prefix: prefix\n        };\n\n        this.widgets.push(widgetEntry);\n    }\n\n    /**\n     * Get a widget by name\n     */\n    getWidget(name: string, namespace?: string): WidgetConstructor<any> | undefined {\n        if (namespace) {\n            const register = this.namespaces.get(namespace);\n            return register?.[name];\n        }\n\n        // Search all namespaces\n        for (const register of this.namespaces.values()) {\n            if (register[name]) {\n                return register[name];\n            }\n        }\n\n        return undefined;\n    }\n\n    /**\n     * Get a widget by role name\n     */\n    getWidgetByRole(role: string, namespace?: string): WidgetConstructor<any> | undefined {\n        const lowerRole = role.toLowerCase();\n\n        if (namespace) {\n            const register = this.namespaces.get(namespace);\n            return register?.roles[lowerRole];\n        }\n\n        // Search all namespaces\n        for (const register of this.namespaces.values()) {\n            if (register.roles[lowerRole]) {\n                return register.roles[lowerRole];\n            }\n        }\n\n        return undefined;\n    }\n\n    /**\n     * Get all registered widgets\n     */\n    getAllWidgets(): IWidgetEntry<any>[] {\n        return this.widgets.slice(); // Return a copy\n    }\n\n    /**\n     * Get widget instance from an element\n     */\n    getWidgetInstance(element: HTMLElement | JQuery, namespace?: IWidgetNamespace<any>): any {\n        const el = this.$(element);\n        let result: any;\n\n        const searchNamespaces = namespace ? [namespace] : Array.from(this.namespaces.values());\n\n        for (const ns of searchNamespaces) {\n            for (const role in ns.roles) {\n                const widget = ns.roles[role];\n                const prefix = widget.fn?.options?.prefix || \"\";\n                const dataKey = \"kendo\" + prefix + (widget.fn?.options?.name || \"\");\n                result = el.data(dataKey);\n                if (result) {\n                    return result;\n                }\n            }\n        }\n\n        return undefined;\n    }\n\n    /**\n     * Create jQuery plugin for a widget\n     */\n    createJQueryPlugin(name: string, widget: WidgetConstructor<any>, getter: string): void {\n        const $ = this.$;\n        const formatterService = this.formatterService;\n        const slice = Array.prototype.slice;\n\n        ($.fn as any)[name] = function(this: JQuery, options?: any) {\n            let value: any = this;\n            let args: any[];\n\n            if (typeof options === STRING) {\n                args = slice.call(arguments, 1);\n\n                this.each(function(this: HTMLElement) {\n                    const widgetInstance = $.data(this, name);\n                    let method: any;\n                    let result: any;\n\n                    if (!widgetInstance) {\n                        throw new Error(formatterService.format(\"Cannot call method '{0}' of {1} before it is initialized\", options, name));\n                    }\n\n                    method = widgetInstance[options];\n\n                    if (typeof method !== FUNCTION) {\n                        throw new Error(formatterService.format(\"Cannot find method '{0}' of {1}\", options, name));\n                    }\n\n                    result = method.apply(widgetInstance, args);\n\n                    if (result !== undefined) {\n                        value = result;\n                        return false;\n                    }\n                });\n            } else {\n                this.each(function(this: HTMLElement) {\n                    return new (widget as any)(this, options);\n                });\n            }\n\n            return value;\n        };\n\n        ($.fn as any)[name].widget = widget;\n\n        ($.fn as any)[getter] = function(this: JQuery) {\n            return this.data(name);\n        };\n    }\n\n    /**\n     * Merge roles from multiple namespaces into a single object\n     * Uses jQuery extend to match original behavior exactly\n     */\n    rolesFromNamespaces(namespaces: IWidgetNamespace<any>[], defaultNamespaces?: IWidgetNamespace<any>[]): Record<string, WidgetConstructor<any>> {\n        const roles: Record<string, WidgetConstructor<any>>[] = [];\n        let idx: number;\n        let length: number;\n\n        // Use default namespaces if none provided or first element is falsy\n        if (!namespaces[0] && defaultNamespaces) {\n            namespaces = defaultNamespaces;\n        }\n\n        for (idx = 0, length = namespaces.length; idx < length; idx++) {\n            roles[idx] = namespaces[idx].roles;\n        }\n\n        // Use $.extend.apply to match original: extend.apply(null, [{}].concat(roles.reverse()))\n        return this.$.extend.apply(null, ([{}] as any[]).concat(roles.reverse()));\n    }\n}\n","/**\n * Widget Utils Service\n *\n * Provides utilities for widget initialization, lifecycle management, and instance retrieval.\n * All methods preserve exact original functionality from kendo.core.js.\n *\n */\n\nimport type { IWidgetUtilsService, IParsedOptions } from \"../models/widget-utils\";\nimport type { IWidgetRegistryService, IWidgetNamespace } from \"../models/widget-registry\";\nimport type { IPropertyAccessService } from \"../models/property-access\";\nimport type { ITemplateService } from \"../models/template\";\nimport type { IUtilsService } from \"../models/utils\";\nimport type { INamespaceService } from \"../models/namespace\";\nimport type { WidgetConstructor } from \"../models/widget\";\n\n// Constants - match original kendo.core.js\nconst STRING = \"string\";\nconst FUNCTION = \"function\";\n\n// RegExps - match original kendo.core.js exactly\nconst templateRegExp = /template$/i;\nconst jsonRegExp = /^\\s*(?:\\{(?:.|\\r\\n|\\n)*\\}|\\[(?:.|\\r\\n|\\n)*\\])\\s*$/;\nconst jsonFormatRegExp = /^\\{(\\d+)(:[^\\}]+)?\\}|^\\[[A-Za-z_]+\\]$/;\nconst dashRegExp = /([A-Z])/g;\nconst numberRegExp = /^(\\+|-?)\\d+(\\.?)\\d*$/;\n\nconst cssPropertiesNames = [\"themeColor\", \"fillMode\", \"shape\", \"size\", \"rounded\", \"positionMode\"];\n\n/**\n * Widget Utils Service Implementation\n */\nexport class WidgetUtilsService implements IWidgetUtilsService {\n    constructor(\n        private $: JQueryStatic,\n        private widgetRegistryService: IWidgetRegistryService<any>,\n        private propertyAccessService: IPropertyAccessService,\n        private templateService: ITemplateService,\n        private utilsService: IUtilsService,\n        private Observable: any,\n        private namespaceService: INamespaceService\n    ) {}\n\n    /**\n     * Get default namespaces from the registry service\n     * Returns [kendo.ui, kendo.dataviz.ui, kendo.mobile.ui]\n     */\n    private getDefaultNamespaces(): IWidgetNamespace<any>[] {\n        return [\n            this.widgetRegistryService.getNamespace(\"ui\"),\n            this.widgetRegistryService.getNamespace(\"dataviz.ui\"),\n            this.widgetRegistryService.getNamespace(\"mobile.ui\")\n        ].filter(Boolean) as IWidgetNamespace<any>[];\n    }\n\n    /**\n     * Parse a single option from element's data attribute\n     */\n    parseOption(element: HTMLElement, option: string, source?: any): any {\n        const ns = this.namespaceService.ns;\n        let value: any;\n        let modelBinded = false;\n\n        if (option.indexOf(\"data\") === 0) {\n            option = option.substring(4);\n            option = option.charAt(0).toLowerCase() + option.substring(1);\n        }\n\n        option = option.replace(dashRegExp, \"-$1\");\n        value = element.getAttribute(\"data-\" + ns + option);\n\n        if (value === null) {\n            value = element.getAttribute(\"bind:data-\" + ns + option);\n            modelBinded = true;\n        }\n\n        if (value === null) {\n            value = undefined;\n        } else if (value === \"null\") {\n            value = null;\n        } else if (value === \"true\") {\n            value = true;\n        } else if (value === \"false\") {\n            value = false;\n        } else if (numberRegExp.test(value) && option != \"mask\" && option != \"format\") {\n            value = parseFloat(value);\n        } else if (jsonRegExp.test(value) && !jsonFormatRegExp.test(value)) {\n            try {\n                value = JSON.parse(value);\n            } catch (error) {\n                // Fallback to function eval for legacy reason - non CSP compliant\n                value = new Function(\"return (\" + value + \")\")();\n            }\n        } else if (modelBinded) {\n            // This way you can set a config like so bind:data-checkboxes=\"checkboxesOptions\" where checkboxesOptions is an object inside your viewmodel.\n            // This is a CSP-safe approach similar to data-checkboxes=\"{ checkboxes: true }\" but you don't need to eval javascript.\n            value = source[value];\n\n            if (value instanceof this.Observable) {\n                // Pass true as a parameter to allow function serialization. Otherwise, if you have a function in the configuration, it will be ignored.\n                value = value.toJSON(true);\n            }\n        }\n\n        return value;\n    }\n\n    /**\n     * Parse all options from element's data attributes\n     */\n    parseOptions(element: HTMLElement, options: Record<string, any>, source?: any): IParsedOptions {\n        const $ = this.$;\n        const ns = this.namespaceService.ns;\n        const result: IParsedOptions = {};\n        let option: string;\n        let value: any;\n        const role = element.getAttribute(\"data-\" + ns + \"role\");\n\n        // Combine options keys with CSS appearance properties to ensure they're always parsed\n        // even when their default value is undefined (which gets stripped by $.extend)\n        const allOptions = Object.keys(options);\n\n        for (let i = 0; i < cssPropertiesNames.length; i++) {\n            if (allOptions.indexOf(cssPropertiesNames[i]) === -1) {\n                allOptions.push(cssPropertiesNames[i]);\n            }\n        }\n\n        for (let i = 0; i < allOptions.length; i++) {\n            option = allOptions[i];\n            // Pass the source option for MVVM scenarios.\n            value = this.parseOption(element, option, source);\n\n            if (value !== undefined) {\n\n                if (templateRegExp.test(option) && role != \"drawer\") {\n                    if (typeof value === \"string\") {\n                        if (this.validateQuerySelectorTemplate(value)) {\n                            value = this.templateService.compile($(\"#\" + value).html());\n                        } else if (source && source[value]) {\n                            value = this.templateService.compile(source[value]);\n                        } else {\n                            value = this.templateService.compile(value);\n                        }\n                    } else if (!this.utilsService.isFunction(value)) {\n                        value = element.getAttribute(option);\n                    }\n                }\n\n                result[option] = value;\n            }\n        }\n\n        return result;\n    }\n\n    /**\n     * Validate if a value is a valid query selector for a template element\n     */\n    validateQuerySelectorTemplate(value: string): boolean {\n        try {\n            return !!(this.$(\"#\" + value).length);\n        } catch (e) {\n        }\n\n        return false;\n    }\n\n    /**\n     * Initialize a widget on an element\n     */\n    initWidget(element: HTMLElement | JQuery, options?: Record<string, any>, roles?: Record<string, WidgetConstructor<any>> | IWidgetNamespace<any>, source?: any): any {\n        const $ = this.$;\n        const ns = this.namespaceService.ns;\n        let result: any;\n        let option: string;\n        let widget: WidgetConstructor<any> | undefined;\n        let idx: number;\n        let length: number;\n        let role: string | null;\n        let value: any;\n        let dataSource: any;\n        let fullPath: boolean;\n        let widgetKeyRegExp: RegExp;\n\n        // Preserve backwards compatibility with (element, options, namespace) signature, where namespace was kendo.ui\n        if (!roles) {\n            roles = this.getDefaultNamespaces()[0].roles;\n        } else if ((roles as IWidgetNamespace<any>).roles) {\n            roles = (roles as IWidgetNamespace<any>).roles;\n        }\n\n        element = (element as any).nodeType ? element as HTMLElement : (element as JQuery)[0];\n\n        role = (element as HTMLElement).getAttribute(\"data-\" + ns + \"role\");\n\n        if (!role) {\n            return;\n        }\n\n        fullPath = role.indexOf(\".\") === -1;\n\n        // look for any widget that may be already instantiated based on this role.\n        // The prefix used is unknown, hence the regexp\n        //\n\n        if (fullPath) {\n            widget = (roles as Record<string, WidgetConstructor<any>>)[role];\n        } else { // full namespace path - like kendo.ui.Widget\n            widget = this.propertyAccessService.getter(role)(window);\n        }\n\n        const data = $(element).data();\n        const widgetKey = widget ? \"kendo\" + (widget as any).fn.options.prefix + (widget as any).fn.options.name : \"\";\n\n        if (fullPath) {\n            widgetKeyRegExp = new RegExp(\"^kendo.*\" + role + \"$\", \"i\");\n        } else { // full namespace path - like kendo.ui.Widget\n            widgetKeyRegExp = new RegExp(\"^\" + widgetKey + \"$\", \"i\");\n        }\n\n        for (var key in data) {\n            if (key.match(widgetKeyRegExp)) {\n                // we have detected a widget of the same kind - save its reference, we will set its options\n                if (key === widgetKey) {\n                    result = data[key];\n                } else {\n                    return data[key];\n                }\n            }\n        }\n\n        if (!widget) {\n            return;\n        }\n\n        dataSource = this.parseOption(element as HTMLElement, \"dataSource\");\n\n        options = $.extend({}, this.parseOptions(element as HTMLElement, $.extend({}, (widget as any).fn.options, (widget as any).fn.defaults), source), options);\n\n        if (dataSource) {\n            if (typeof dataSource === STRING) {\n                options.dataSource = this.propertyAccessService.getter(dataSource)(window);\n            } else {\n                options.dataSource = dataSource;\n            }\n        }\n\n        for (idx = 0, length = (widget as any).fn.events.length; idx < length; idx++) {\n            option = (widget as any).fn.events[idx];\n\n            value = this.parseOption(element as HTMLElement, option);\n\n            if (value !== undefined) {\n                options[option] = this.propertyAccessService.getter(value)(window);\n            }\n        }\n\n        if (!result) {\n            result = new (widget as any)(element, options);\n        } else if (!$.isEmptyObject(options)) {\n            result.setOptions(options);\n        }\n\n        return result;\n    }\n\n    /**\n     * Initialize all widgets in an element tree\n     */\n    init(element: HTMLElement | JQuery, ...namespaces: IWidgetNamespace<any>[]): void {\n        const $ = this.$;\n        const ns = this.namespaceService.ns;\n        const roles = this.widgetRegistryService.rolesFromNamespaces(namespaces, this.getDefaultNamespaces());\n        const self = this;\n\n        $(element).find(\"[data-\" + ns + \"role]\").addBack().each(function(this: HTMLElement) {\n            self.initWidget(this, {}, roles);\n        });\n    }\n\n    /**\n     * Destroy all widgets in an element tree\n     */\n    destroy(element: HTMLElement | JQuery): void {\n        const $ = this.$;\n        const ns = this.namespaceService.ns;\n\n        $(element).find(\"[data-\" + ns + \"role]\").addBack().each(function(this: HTMLElement) {\n            const data = $(this).data();\n\n            for (var key in data) {\n                if (key.indexOf(\"kendo\") === 0 && typeof data[key].destroy === FUNCTION) {\n                    data[key].destroy();\n                }\n            }\n        });\n    }\n\n    /**\n     * Containment comparer for sorting widgets by DOM hierarchy\n     */\n    private containmentComparer(a: HTMLElement, b: HTMLElement): number {\n        return this.$.contains(a, b) ? -1 : 1;\n    }\n\n    /**\n     * Resize all widgets in an element tree\n     */\n    resize(element: HTMLElement | JQuery, force?: boolean): void {\n        const $ = this.$;\n        const ns = this.namespaceService.ns;\n        const self = this;\n\n        // Create resizableWidget filter with proper context\n        const resizableWidgetFilter = function(this: HTMLElement): boolean {\n            const widget = $(this);\n            return ($.inArray(widget.attr(\"data-\" + ns + \"role\"), [\"slider\", \"rangeslider\", \"breadcrumb\"]) > -1) || widget.is(\":visible\");\n        };\n\n        const widgets = $(element).find(\"[data-\" + ns + \"role]\").addBack().filter(resizableWidgetFilter);\n\n        if (!widgets.length) {\n            return;\n        }\n\n        // sort widgets based on their parent-child relation\n        const widgetsArray = $.makeArray(widgets);\n        widgetsArray.sort((a: HTMLElement, b: HTMLElement) => self.containmentComparer(a, b));\n\n        // resize widgets\n        $.each(widgetsArray, function(this: HTMLElement) {\n            const widget = self.widgetInstance($(this));\n            if (widget) {\n                widget.resize(force);\n            }\n        });\n    }\n\n    /**\n     * Get widget instance from a DOM element\n     */\n    widgetInstance(element: JQuery, suites?: IWidgetNamespace<any> | IWidgetNamespace<any>[]): any {\n        const ns = this.namespaceService.ns;\n        const defaultNamespaces = this.getDefaultNamespaces();\n        let role = element.data(ns + \"role\");\n        let widgets: (WidgetConstructor<any> | undefined)[] = [];\n        let i: number;\n        let length: number;\n        const elementData = element.data(\"kendoView\");\n\n        if (role) {\n            // HACK!!! mobile view scroller widgets are instantiated on data-role=\"content\" elements. We need to discover them when resizing.\n            if (role === \"content\") {\n                role = \"scroller\";\n            }\n\n            // kendo.View is not a ui plugin\n\n            if (role === \"view\" && elementData) {\n                return elementData;\n            }\n\n            if (suites) {\n                if ((suites as IWidgetNamespace<any>[])[0]) {\n                    for (i = 0, length = (suites as IWidgetNamespace<any>[]).length; i < length; i++) {\n                        widgets.push((suites as IWidgetNamespace<any>[])[i].roles[role]);\n                    }\n                } else {\n                    widgets.push((suites as IWidgetNamespace<any>).roles[role]);\n                }\n            }\n            else {\n                // Use default namespaces: [kendo.ui, kendo.dataviz.ui, kendo.mobile.ui]\n                widgets = defaultNamespaces.map(ns => ns.roles[role]);\n            }\n\n            if (role.indexOf(\".\") >= 0) {\n                widgets = [this.propertyAccessService.getter(role)(window)];\n            }\n\n            for (i = 0, length = widgets.length; i < length; i++) {\n                const widget = widgets[i];\n                if (widget) {\n                    const instance = element.data(\"kendo\" + (widget as any).fn.options.prefix + (widget as any).fn.options.name);\n                    if (instance) {\n                        return instance;\n                    }\n                }\n            }\n        }\n    }\n}\n","/**\n * Namespace Service\n *\n * Manages the data attribute namespace prefix used throughout Kendo UI.\n * This allows customization of data-role attributes (e.g., data-kendo-role instead of data-role).\n */\n\nimport type { INamespaceService } from \"../models/namespace\";\n\nexport class NamespaceService implements INamespaceService {\n    private _ns: string = \"\";\n\n    /**\n     * Get the current namespace prefix\n     */\n    get ns(): string {\n        return this._ns;\n    }\n\n    /**\n     * Set the namespace prefix\n     * @param value - The namespace prefix (e.g., \"kendo-\")\n     */\n    setNs(value: string): void {\n        this._ns = value;\n    }\n}\n","/**\n * Kendo UI Chat Widget\n *\n * This file serves as the entry point for the Chat widget.\n */\nimport \"./kendo.core.js\"; // Still required for the time being, because we need to access the global kendo object.\nimport { Chat } from \"./chat\";\nimport { inject, UtilsService, WidgetRegistryService } from \"./core\";\n\nexport const __meta__ = {\n    id: \"chat\",\n    name: \"Chat\",\n    category: \"web\",\n    description: \"The Chat component.\",\n    depends: [\"data\", \"draganddrop\", \"html.button\", \"textarea\", \"menu\", \"avatar\", \"toolbar\", \"speechtotextbutton\"]\n};\n\n// Keep the chat namespace for backwards compatibility\nwindow.kendo.chat = {};\n$.extend(window.kendo.chat, {\n    ChatView: {},\n    Component: {},\n    Components: {},\n    Templates: {},\n    getTemplate: () => inject(UtilsService).logToConsole(\"The getTemplate method is deprecated. Use one of the built-in templates or append elements manually.\", \"warn\"),\n    getComponent: () => inject(UtilsService).logToConsole(\"The getComponent method is deprecated. Use one of the built-in templates or append elements manually.\", \"warn\"),\n    registerTemplate: () => inject(UtilsService).logToConsole(\"The registerTemplate method is deprecated. Use one of the built-in templates or append elements manually.\", \"warn\"),\n    registerComponent: () => inject(UtilsService).logToConsole(\"The registerComponent method is deprecated. Use one of the built-in templates or append elements manually.\", \"warn\")\n});\n\n// Register the widget\ninject(WidgetRegistryService).register(Chat);\n\n// Re-export for consumers\nexport { Chat };\n\nexport default kendo;"],"mappings":";4iEAQA,IAAY,EAAA,SAAA,EAAL,OACH,GAAA,UAAA,YACA,EAAA,OAAA,gBCuHS,EAAmB,IA7FhC,KAAoD,kCAExB,IAAI,IAM5B,UAAa,EAAsB,EAAyB,CACxD,KAAK,cAAc,IAAI,EAAM,CACzB,OACA,QAAS,QAAkB,IAAI,GAC/B,SAAU,EAAgB,UAC1B,SAAU,OACb,CAAC,CAON,kBAAqB,EAAsB,EAAmB,CAC1D,KAAK,cAAc,IAAI,EAAM,CACzB,OACA,YAAe,EACf,SAAU,EAAgB,UAC1B,WACH,CAAC,CAON,OAAU,EAAsB,EAAyB,CACrD,KAAK,cAAc,IAAI,EAAM,CACzB,OACA,QAAS,QAAkB,IAAI,GAC/B,SAAU,EAAgB,OAC1B,SAAU,OACb,CAAC,CAQN,QAAW,EAAyB,CAChC,IAAM,EAAe,KAAK,cAAc,IAAI,EAAK,CAEjD,GAAI,CAAC,EACD,MAAU,MAAM,WAAW,EAAK,KAAK,oBAAoB,CAY7D,OATI,EAAa,WAAa,EAAgB,WAEtC,EAAa,WAAa,SAC1B,EAAa,SAAW,EAAa,SAAS,EAE3C,EAAa,UAIjB,EAAa,SAAS,CAMjC,WAAc,EAAqC,CAC1C,QAAK,IAAI,EAAK,CAGnB,OAAO,KAAK,QAAQ,EAAK,CAM7B,IAAO,EAA+B,CAClC,OAAO,KAAK,cAAc,IAAI,EAAK,CAMvC,YAAe,EAAmD,CAC9D,OAAO,KAAK,cAAc,IAAI,EAAK,EAAE,WAsB7C,SAAgB,EAAU,EAAyB,CAC/C,OAAO,EAAiB,QAAQ,EAAK,CCjHzC,IAAa,EAAb,KAA+D,CAK3D,YACI,EACA,EACA,EACA,EACA,EACA,EACF,CANU,KAAA,EAAA,EACA,KAAA,QAAA,EACA,KAAA,qBAAA,EACA,KAAA,gBAAA,EACA,KAAA,MAAA,EAGR,KAAK,WAAa,EAAE,GAAG,GACvB,KAAK,YAAc,KAAK,kBAAkB,EAAkB,CAC5D,KAAK,WAAa,KAAK,YAAY,SAAS,CAMhD,kBAA0B,EAA+F,CACrH,IAAM,EAAI,KAAK,EACT,EAAO,KAGP,EAAmB,SAAS,EAAe,EAAe,CAC5D,OAAO,IAAI,EAAY,GAAG,KAAK,EAAU,EAAQ,EAwHrD,OApHA,EAAkB,GAAM,EAAa,EAAE,CAIvC,EAAY,GAAK,EAAY,UAAY,IAAK,EAC9C,EAAY,GAAG,YAAc,EAG7B,EAAY,GAAG,KAAO,SAAS,EAAe,EAAe,CAKzD,OAJI,GAAW,aAAmB,GAAK,EAAE,aAAmB,KACxD,EAAU,EAAY,EAAQ,EAG1B,EAAE,GAAW,KAAK,KAAK,KAAM,EAAU,EAAS,EAAK,WAAW,EAG5E,EAAY,GAAG,KAAK,UAAY,EAAY,GAG5C,EAAE,OAAO,EAAY,GAAI,CACrB,QAAS,SAA6B,EAA+B,CAEjE,OADA,KAAK,KAAK,UAAW,EAAQ,CACtB,MAGX,YAAa,SAA6B,EAA2B,CAEjE,OADA,KAAK,KAAK,UAAW,GAAM,EAAK,MAAM,MAAM,CAAC,CACtC,MAGX,GAAI,SAA6B,GAAG,EAA2B,CAC3D,IAAM,EAAO,KACP,EAAK,EAAK,KAAK,UAAU,CACzB,EAAK,EAAK,WAGhB,GAAI,EAAK,SAAW,EAChB,OAAO,EAAG,KAAK,EAAM,EAAK,GAAG,CAGjC,IAAI,EAAe,EACb,EAAW,EAAK,OAAO,CAGlB,EAAS,EAAS,OAAS,KAAOC,QACzC,EAAS,KAAK,CAGlB,IAAM,EAAW,EAAS,EAAS,OAAS,GACtC,EAAS,EAAK,gBAAgB,cAAc,EAAS,GAAI,EAAG,CAGlE,GAAI,EAAK,QAAQ,sBACb,EAAO,OAAO,cAAc,CAAG,IAC/B,KAAK,KAAO,SAAS,gBAAiB,CAEtC,EAAK,qBAAqB,gBAAgB,CAE1C,IAAM,EAAW,EAAS,SAAW,EAAI,KAAO,EAAS,GACnD,EAAY,EAAO,QAAQ,QAAQ,CAAG,IAAM,EAAO,QAAQ,WAAW,CAAG,GAE/E,EAAG,KAAK,KACJ,CACI,WAAa,GAAoB,EAAK,qBAAqB,UAAU,EAAS,CAC9E,aAAgB,EAAK,qBAAqB,aAAa,CAC1D,CACD,EACA,CACe,YACd,CACJ,CAIL,GAAI,EAAS,GAAG,QAAQ,UAAU,GAAK,IAAM,EAAS,IAAM,EAAS,GAAG,QAAS,CAC7E,EAAS,GAAK,EACd,IAAM,EAAS,EAAS,GAClB,EAAkB,EAAS,EAAS,OAAS,GASnD,MAPA,GAAS,EAAS,OAAS,GAAK,SAAS,EAAkB,CACvD,GAAI,EAAK,eAAe,EAAG,EAAO,CAC9B,OAAO,EAAgB,MAAM,KAAM,CAAC,EAAE,CAAC,EAI/C,EAAG,MAAM,EAAM,EAAgB,CACxB,EAIX,GAAI,OAAO,GAAaD,SAAQ,CAC5B,EAAU,EAAK,KAAK,UAAU,CAC9B,IAAM,EAAc,EAAgB,GAEpC,EAAS,EAAS,OAAS,GAAK,SAAS,EAAiB,CACtD,EAAW,KAAK,EAAS,EAAE,EAOnC,MAHA,GAAS,GAAK,EACd,EAAG,MAAM,EAAM,EAAgB,CAExB,GAGX,aAAc,SAA6B,EAA2B,CAOlE,MANA,KAAW,KAAK,KAAK,UAAU,CAE3B,GACA,KAAK,IAAI,IAAM,EAAG,CAGf,MAEd,CAAC,CAEK,EAMX,gBAAqC,CACjC,OAAO,KAAK,YAMhB,OAAO,EAAe,EAA6B,CAC/C,OAAO,KAAK,YAAY,EAAU,EAAQ,CAO9C,eAAe,EAAkB,EAAkC,CAC/D,IAAM,EAAS,EAAO,QAAQ,aAE9B,GAAI,CAAC,EACD,MAAO,GAIX,IAAM,EAAa,EAAO,OAAO,CACjC,EAAE,OAAS,EACX,EAAE,oBAAsB,GAExB,IAAK,IAAI,EAAM,EAAG,EAAS,EAAW,OAAQ,EAAM,EAAQ,IACxD,EAAW,GAAK,KAAK,EAAQ,EAAE,CAGnC,MAAO,CAAC,EAAE,sBCpKL,EAAb,KAAqC,CA8CjC,OAAO,OAAkC,EAAyC,CAC9E,IAAM,EAAO,KAGP,EAAO,UAAkB,GAC/B,EAAK,UAAY,EAAK,UAMtB,IAAM,EAAgB,GAAS,EAAM,KAAO,EAAM,KAAO,SAAqB,GAAG,EAAa,CAEtF,EAAK,UAAU,MACf,EAAK,UAAU,KAAK,MAAM,KAAM,EAAK,EAKvC,EAAK,EAAS,GAAK,EAAS,UAAY,IAAK,EAGnD,GAAI,EACA,IAAK,IAAM,KAAU,EACb,EAAM,IAAW,MAAQ,EAAM,GAAQ,cAAgB,OAGvD,EAAG,GAAU,EAAO,EAAmB,CAAC,gBAAgB,CAAC,OAAO,GAAM,EAAE,CAAG,EAAK,UAAkB,GAAS,EAAM,GAAQ,CAGzH,EAAG,GAAU,EAAM,GAW/B,MALA,GAAG,YAAc,EAGjB,EAAS,OAAS,EAAK,OAEhB,IAKf,EAAM,GAAK,EAAM,UAoBjB,EAAM,UAAU,KAAO,SAAuB,GAAG,EAAoB,GAKrE,EAAM,UAAU,aAAe,SAAuB,EAAqC,CAEvF,KAAK,QAAU,EAAO,EAAmB,CAAC,gBAAgB,CAAC,OAAO,GAAM,EAAE,CAAE,KAAK,QAAS,EAAQ,EC5HtG,IAAME,EAAS,SACTC,EAAW,WAOjB,SAAS,GAA6C,CAClD,KAAK,kBAAoB,GAQ7B,SAAS,GAAoD,CACzD,OAAO,KAAK,oBAAsB,GAOtC,IAAa,EAAb,cAAgC,CAA6B,CAczD,aAAc,CACV,OAAO,CACP,KAAK,QAAU,EAAE,CAWrB,KAAK,GAAG,EAAoB,CACxB,KAAK,QAAU,EAAE,CAiBrB,KACI,EACA,EACA,EACI,CACJ,IAAM,EAAO,KACT,EACA,EACA,EACA,EACE,EAAqB,OAAO,IAAaA,EAC3C,EAGJ,GAAI,IAAa,OAAW,CACxB,IAAM,EAAW,EACjB,IAAK,KAAO,EACR,EAAK,KAAK,EAAK,EAAS,GAAK,CAEjC,OAAO,EAIX,IAAM,EAAuB,OAAO,IAAcD,EAC5C,CAAC,EAAoB,CACrB,EAEN,IAAK,EAAM,EAAG,EAAS,EAAW,OAAQ,EAAM,EAAQ,IAAO,CAC3D,IAAM,EAAmB,EAAW,GAEpC,EAAU,EACJ,EACC,EAAyB,GAE5B,IACI,IAGA,EAAW,EACX,GAAW,SAAU,EAAiB,EAA+B,CACjE,IAAM,EAAuC,UAA4B,CACrE,EAAK,OAAO,EAAS,EAAe,CACpC,EAAgB,MAAM,EAAM,UAAiB,EAGjD,MADA,GAAe,SAAW,EACnB,IACR,EAAkB,EAAS,EAElC,EAAS,EAAK,QAAQ,GAAoB,EAAK,QAAQ,IAAqB,EAAE,CAC9E,EAAO,KAAK,EAAgC,EAIpD,OAAO,EAUX,IAAI,EAA+B,EAA4C,CAC3E,OAAO,KAAK,KAAK,EAAY,EAAU,GAAK,CAWhD,MAAM,EAA8B,EAA4C,CAC5E,IAAM,EAAO,KACT,EACE,EAAuB,OAAO,IAAcA,EAC5C,CAAC,EAAoB,CACrB,EACA,EAAS,EAAW,OACtB,EACE,EAAqB,OAAO,IAAaC,EAC3C,EAEJ,IAAK,EAAM,EAAG,EAAM,EAAQ,IAAO,CAC/B,IAAM,EAAmB,EAAW,GAEpC,EAAU,EACJ,EACC,EAAyB,GAE5B,IACA,EAAS,EAAK,QAAQ,GAAoB,EAAK,QAAQ,IAAqB,EAAE,CAC9E,EAAO,QAAQ,EAAgC,EAIvD,OAAO,EAUX,QAAQ,EAAmB,EAA8D,CACrF,IAAM,EAAO,KACT,EAAS,EAAK,QAAQ,GACtB,EACE,EAAS,EAAS,EAAO,OAAS,EAExC,GAAI,EAAQ,CAER,IAAM,EAA8B,GAAK,EAAE,CAW3C,IATA,EAAS,OAAS,EAClB,EAAS,kBAAoB,GAC7B,EAAS,eAAiB,EAC1B,EAAS,mBAAqB,EAI9B,EAAS,EAAO,OAAO,CAElB,EAAM,EAAG,EAAM,EAAQ,IACxB,EAAO,GAAK,KAAK,EAAM,EAAS,CAIpC,OAAQ,EAA4C,oBAAsB,GAG9E,MAAO,GAcX,OAAO,EAAoB,EAA8B,CACrD,IAAM,EAAO,KACP,EAAS,EAAY,EAAK,QAAQ,GAAa,OACjD,EAEJ,GAAI,IAAc,OAEd,EAAK,QAAU,EAAE,SACV,EACP,GAAI,EAEA,IAAK,EAAM,EAAO,OAAS,EAAG,GAAO,EAAG,KAChC,EAAO,KAAS,GAAW,EAAO,GAAK,WAAa,IACpD,EAAO,OAAO,EAAK,EAAE,MAK7B,EAAK,QAAQ,GAAa,EAAE,CAIpC,OAAO,IAWf,IAAM,GAAQ,EAAW,UACT,CAAC,OAAQ,OAAQ,MAAO,QAAS,UAAW,SAAS,CAC7D,QAAQ,GAAU,CACtB,IAAM,EAAK,GAAM,GACjB,OAAO,eAAe,GAAO,EAAQ,CACjC,MAAO,EACP,SAAU,GACV,aAAc,GACd,WAAY,GACf,CAAC,EACJ,CAGF,EAAW,GAAK,EAAW,UCxS3B,IAAM,EAAiB,IACjB,GAAoB,sEAK1B,IAAa,EAAb,KAAyD,CAIrD,YACI,EACA,EACA,EACA,EACA,EACF,CALU,KAAA,eAAA,EACA,KAAA,EAAA,EACA,KAAA,iBAAA,EACA,KAAA,MAAA,EACA,KAAA,MAAA,sBARgC,EAAE,CAW1C,IAAM,EAAM,OACZ,KAAK,iBACD,EAAI,uBACJ,EAAI,6BACJ,EAAI,0BACJ,EAAI,wBACJ,EAAI,0BACF,GAAmC,CAAE,WAAW,EAAU,IAAO,GAAG,GAG9E,UAAU,EAAuB,CAC7B,OAAO,aAAmB,SAAW,aAAmB,aAM5D,WAAW,EAAwC,EAAyB,EAAuC,CAC/G,IAAM,EAAW,KAAK,EAAE,EAAe,CAIvC,OAHI,EACO,KAAK,oBAAoB,EAAU,EAAc,CAAC,MAEtD,EAAS,WAAW,GAAiB,GAAM,EAAI,EAM1D,YAAY,EAAwC,EAAyB,EAAuC,CAChH,IAAM,EAAW,KAAK,EAAE,EAAe,CAIvC,OAHI,EACO,KAAK,oBAAoB,EAAU,EAAc,CAAC,OAEtD,EAAS,YAAY,GAAiB,GAAM,EAAI,EAM3D,kBAAkB,EAAsB,EAA+C,CACnF,IAAM,EAAiC,EAAE,CACrC,EAyBJ,OAvBI,SAAS,aAAe,SAAS,YAAY,kBAC7C,EAAgB,SAAS,YAAY,iBAAiB,EAAS,GAAG,CAE9D,GACA,KAAK,EAAE,KAAK,GAAa,EAAc,IAAkB,CACrD,EAAO,GAAS,EAAc,iBAAiB,EAAM,EACvD,GAIN,EAAiB,EAAgB,aAE7B,GACA,KAAK,EAAE,KAAK,GAAa,EAAc,IAAkB,CACrD,EAAO,GAAS,EAAc,KAAK,MAAM,YAAY,EAAM,GAC7D,EAIL,KAAK,MAAM,KAAK,EAAO,CAIrB,EAHI,EASf,aAAa,EAA+B,CAExC,GADgB,EAAQ,QACZ,KAAK,iBAAiB,GAAK,gBAAkB,QACrD,MAAO,GAGX,GAAI,OAAO,GAAS,WAAc,UAC9B,EAAQ,UAAU,QAAQ,oBAAoB,CAAG,GACjD,MAAO,GAGX,IAAM,EAAW,KAAK,kBAAkB,EAAS,CAAC,WAAW,CAAC,CAAC,UAAY,GAC3E,OAAO,EAAS,QAAQ,OAAO,CAAG,IAAM,EAAS,QAAQ,SAAS,CAAG,GAMzE,WAAW,EAA+B,EAA+B,CACrE,IAAM,EAAS,KAAK,eAAe,QAAQ,OACrC,EAAU,KAAK,eAAe,QAAQ,QACtC,EAAiB,KAAK,eAAe,QAAQ,QAGnD,GAAI,aAAmB,KAAK,GAAK,IAAU,OAAW,CACjD,EAAmB,MAAM,EAAY,IAAmB,CACrD,KAAK,WAAW,EAAG,EAAM,EAC3B,CACF,OAGJ,IAAM,EAAkB,aAAmB,KAAK,EAAK,EAAmB,GAAK,EAE7E,GAAI,CAAC,EACD,OAGJ,IAAM,EAAQ,KAAK,eAAe,MAAM,EAAQ,CAEhD,GAAI,IAAU,OACN,GAAS,IAAW,EAAiB,IAAM,KAAK,eAAe,QAAQ,QACvE,EAAG,WAAa,EAAG,YAAc,EAAG,YAAc,EAC3C,IAAU,GAAW,IAAW,EAAQ,EAC/C,EAAG,WAAa,CAAC,EAEjB,EAAG,WAAa,UAEb,GAAS,IAAW,EAAiB,IAAM,KAAK,eAAe,QAAQ,QAC9E,OAAO,EAAG,YAAc,EAAG,YAAc,EAAG,gBAE5C,OAAO,KAAK,IAAI,EAAG,WAAW,CAOtC,UAAU,EAAiB,EAAe,SAAU,EAAqC,CACrF,IAAM,EAAU,EAAgB,IAAO,CAGjC,EAAwB,CAC1B,IAAK,EAAO,IACZ,MAAO,EAAO,MACd,OAAQ,EAAO,OACf,KAAM,EAAO,KAChB,CAGD,GAAI,KAAK,eAAe,QAAQ,OAAS,KAAK,eAAe,UAAY,KAAK,eAAe,aAAe,CAAC,EAAY,CACrH,IAAM,EAAO,KAAK,eAAe,MAAM,EAAQ,CAAG,EAAI,GAEtD,EAAO,KAAQ,OAAO,YAAe,SAAS,gBAAgB,UAC9D,EAAO,MAAS,OAAO,YAAe,EAAO,SAAS,gBAAgB,WAG1E,OAAO,EAMX,oBAAoB,EAAiB,EAA2C,CAC5E,IAAM,EAAQ,EAAQ,OAAO,CAC7B,EAAM,IAAI,UAAW,GAAG,CACxB,EAAM,IAAI,aAAc,SAAS,CACjC,EAAM,SAAS,KAAK,EAAE,OAAO,CAAC,CAE9B,IAAM,EAAQ,EAAM,WAAW,GAAiB,GAAM,CAChD,EAAS,EAAM,YAAY,GAAiB,GAAM,CAIxD,OAFA,EAAM,QAAQ,CAEP,CACH,MAAO,GAAS,EAChB,OAAQ,GAAU,EACrB,CAML,aAAa,EAAyC,CAClD,IAAM,EAAyB,EAAE,CAC3B,EAAQ,OAAO,GAAU,SAAW,EAAM,MAAM,IAAI,CAAG,EAM7D,OAJA,KAAK,EAAE,KAAK,EAAO,SAAwB,EAAa,CACpD,EAAQ,GAAO,MACjB,CAEK,EAMX,gBAAgB,EAA4B,CACxC,GAAI,SAAS,mBAAoB,CAC7B,IAAM,EAAW,SAAS,mBACtB,EACA,WAAW,UACV,GACU,EAAK,aAAe,EACrB,WAAW,cACX,WAAW,cAExB,CAED,KAAO,EAAS,UAAU,EAAE,CACxB,IAAM,EAAW,EAAiB,cAC9B,GAAW,CAAC,EAAQ,aAAa,MAAM,EACvC,EAAQ,YAAY,YAAY,EAAQ,GASxD,eAAe,EAAsC,CACjD,KAAK,iBAAiB,KAAK,OAAQ,EAAS,CAMhD,eAAe,EAA4B,CACvC,KAAK,eAAe,KAAK,EAAS,CAC9B,KAAK,eAAe,SAAW,GAC/B,KAAK,kBAAkB,CAO/B,kBAAyB,CACrB,KAAK,mBAAqB,CAClB,KAAK,eAAe,KACpB,KAAK,eAAe,OAAO,EAAG,CAC1B,KAAK,eAAe,IACpB,KAAK,kBAAkB,GAGjC,CAMN,uBAAuB,EAAqC,CACxD,IAAM,EAAc,EAAI,MAAM,IAAI,CAAC,IAAM,GACnC,EAAiC,EAAE,CACnC,EAAa,EAAY,MAAM,MAAM,CACrC,EAAS,EAAW,OAE1B,IAAK,IAAI,EAAM,EAAG,EAAM,EAAQ,GAAO,EAC/B,EAAW,KAAS,KACpB,EAAO,mBAAmB,EAAW,GAAK,EAAI,mBAAmB,EAAW,EAAM,GAAG,EAI7F,OAAO,EAMX,mBAAmB,EAAuE,CAItF,OAHW,EAAE,EAAE,SAAW,OAGnB,KAFI,SAAS,iBAAiB,EAAE,EAAE,OAAS,EAAE,EAAE,OAAQ,CAQlE,YAAY,EAAwD,CAChE,IAAM,EAAI,EAAY,cAMhB,EAAS,EAAE,YACb,EAaJ,OAXI,EAAE,YAEE,IAAW,QAAa,KAExB,EAAQ,EAAE,YAEP,EAAE,QAAU,EAAE,OAAS,EAAE,gBAEhC,EAAS,CAAC,EAAE,OAAU,IAGnB,EAMX,WAAW,EAAmC,CAC1C,IAAM,EAAS,EAAQ,IAAI,aAAa,CAClC,EAAS,GACT,GAAkB,KAAK,EAAO,EAC9B,CAAC,EAAG,EAAG,EAAG,EAAG,EAAE,CACf,EAAO,KAAK,IAAI,CAAC,EAAO,GAAI,EAAE,EAAO,IAAM,GAAG,CAEpD,MAAO,CACH,KAAO,CAAC,EAAO,GAAM,EACrB,MAAQ,CAAC,EAAO,GAAM,EACtB,OAAS,CAAC,EAAO,GAAM,EAC1B,CAML,KACI,EACA,EACA,EACA,EAA8B,GAC9B,EACM,CACN,IAAI,EAAS,EAAQ,QAAQ,CACvB,EAAmB,KAAK,WAAW,OAAO,CAIhD,GAFA,EAAO,QAAQ,CAAC,YAAY,2BAA2B,CAElD,EAAO,SAAS,8BAA8B,CA6C/C,KAAK,WAAW,EAAS,EAAU,EAAmB,KA7CL,CACjD,IAAM,EAAQ,EAAQ,GAAG,MAAM,MACzB,EAAS,EAAQ,GAAG,MAAM,OAC1B,EAAe,EAAe,KAAK,EAAM,CACzC,EAAgB,EAAe,KAAK,EAAO,CAC3C,EAAkB,EAAQ,SAAS,YAAY,EAAI,EAAQ,GAAG,oCAAoC,CAClG,EAAsB,EAAQ,SAAS,YAAY,CAEnD,EAAa,GAAgB,EAE/B,EAAiC,EACjC,EAAkC,EAElC,CAAC,IAAiB,CAAC,GAAa,GAAY,GAAU,KACtD,EAAgB,EACV,KAAK,WAAW,EAAS,GAAO,EAAoB,CAAG,EACvD,KAAK,WAAW,EAAS,GAAO,EAAoB,GAE1D,CAAC,IAAkB,CAAC,GAAa,GAAY,IAAY,KACzD,EAAiB,KAAK,YAAY,EAAS,GAAO,EAAoB,EAG1E,EAAQ,KACJ,KAAK,EAAE,SAAS,CACX,SAAS,8BAA8B,CACvC,IAAI,CACD,MAAO,EAAY,OAAS,EAC5B,OAAQ,EACX,CAAC,CACT,CACD,EAAS,EAAQ,QAAQ,CAEzB,EAAO,KACH,KAAK,EAAE,SAAS,CACX,SAAS,wBAAwB,CACjC,KAAK,OAAQ,SAAS,CAC9B,CAEG,GACA,EAAQ,IAAI,CACR,MAAO,OACP,OAAQ,OACX,CAAC,CAiBV,MAXA,GAAS,EAAO,QAAQ,CAEpB,EAAmB,KAAK,WAAW,EAAO,GAC1C,EAAO,SAAS,2BAA2B,CAC3C,EAAS,IAGT,GACA,KAAK,WAAW,EAAS,EAAU,EAAmB,CAGnD,EAMX,WAAW,EAAiB,EAAoB,EAA8B,GAAY,CACtF,IAAM,EAAS,EAAQ,QAAQ,CACzB,EAAU,EAAQ,QAAQ,yBAAyB,CACnD,EAAsB,EAAQ,SAAS,YAAY,CACnD,EAAU,EAAQ,GAAG,WAAW,CAChC,EAAe,EAAO,GAAG,MACzB,EAAgB,EAAQ,GAAG,MAAM,OAEnC,EAAQ,GAAG,UAAU,EACrB,EAAQ,IAAI,CACR,QAAS,GACT,SAAU,GACb,CAAC,CAGa,EAAe,KAAK,EAAa,MAAM,EAAI,EAAe,KAAK,EAAa,OAAO,GAG7F,GACD,EAAQ,IAAI,EAAO,CAAC,MAAM,CAE1B,GACA,EAAO,IAAI,QAAS,GAAG,CAE3B,EAAO,IAAI,CACP,MAAO,EACD,KAAK,WAAW,EAAS,GAAO,EAAoB,CAAG,EACvD,KAAK,WAAW,EAAS,GAAO,EAAoB,CAC7D,CAAC,CAEE,IAAkB,OAClB,EAAQ,IAAI,CAAE,OAAQ,KAAK,YAAY,EAAO,CAAE,CAAC,CAEjD,EAAO,IAAI,CACP,OAAQ,KAAK,YAAY,EAAQ,CACpC,CAAC,CAGD,GACD,EAAQ,MAAM,EAQ1B,cAAc,EAAiB,EAA6B,CACxD,IAAM,EAAQ,KAAK,eAAe,MAAM,EAAQ,CAE1C,GADY,EAAQ,CAAC,KAAK,WAAW,EAAQ,CAAG,KAAK,WAAW,EAAQ,EACxC,EAChC,EAAc,EAAQ,GAAG,YAAc,EAAQ,GAAG,YAElD,EAAiB,CAAE,WAAc,EAAmB,CAE1D,EAAQ,QAAQ,CAAC,QAAQ,EAAgB,OAAQ,SAAS,CAE1D,IAAM,EAAY,EAAQ,CAAC,EAAc,EACnC,EAAgB,EAChB,KAAK,IAAI,KAAK,IAAI,EAAmB,EAAE,CAAE,EAAU,CACnD,KAAK,IAAI,KAAK,IAAI,EAAmB,EAAE,CAAE,EAAU,CAEzD,MAAO,CACH,QAAS,IAAkB,EAC3B,MAAO,IAAkB,EAC5B,CAML,sBACI,EACA,EACA,EAAiC,EAAE,CACf,CACpB,GAAM,CAAE,WAAW,OAAQ,SAAS,UAAa,EAE3C,GADmB,EAAQ,WAAW,EAAI,GACL,EAErC,EAAiB,CAAE,UAAa,EAAiB,CAEvD,EAAQ,QAAQ,CAAC,QAAQ,EAAgB,EAAoB,EAAO,CAEpE,IAAM,EAAY,EAAQ,GAAG,aAAe,EAAQ,GAAG,aACjD,EAAe,KAAK,IAAI,KAAK,IAAI,EAAiB,EAAE,CAAE,EAAU,CAEtE,MAAO,CACH,MAAO,IAAiB,EACxB,SAAU,GAAgB,EAC7B,CAML,gBACI,EACA,EACA,EAAkC,EAAE,CAC7B,CACP,GAAI,CAAC,EAAU,QAAU,CAAC,EAAc,OACpC,MAAO,GAGX,GAAM,CACF,WAAW,EACX,SAAS,SACT,WAAW,SACX,SAAS,EACT,cACA,EAEE,EAAkB,EAAU,QAAQ,EAAI,EACxC,EAAqB,EAAU,WAAW,EAAI,EAC9C,EAAkB,EAAU,QAAQ,CACpC,EAAe,EAAc,QAAQ,CACrC,EAAe,EAAc,aAAa,EAAI,EAE9C,EAAc,EAAa,IAAM,EAAgB,IAAM,EAEzD,EAEJ,OAAQ,EAAR,CACI,IAAK,MACD,EAAkB,EAAc,EAChC,MACJ,IAAK,SACD,EAAkB,EAAc,EAAkB,EAAe,EACjE,MAEJ,QACI,EAAkB,EAAe,EAAkB,EAAM,EAAe,EAAK,EAC7E,MAGR,IAAM,EAAY,EAAU,GAAG,aAAe,EAAU,GAAG,aAO3D,MANA,GAAkB,KAAK,IAAI,KAAK,IAAI,EAAiB,EAAE,CAAE,EAAU,CAEnE,EAAU,QAAQ,CAAC,QAAQ,CACvB,UAAW,EACd,CAAE,EAAU,EAAQ,EAAW,CAEzB,GAOX,aAAa,EAAiB,EAAmB,EAAqB,CAClE,IAAM,EAAU,EAAQ,KAAK,EAAU,EAAI,GAEvC,EAAQ,QAAQ,EAAM,CAAG,GACzB,EAAQ,KAAK,GAAY,EAAU,IAAM,GAAO,MAAM,CAAC,CAO/D,gBAAgB,EAAiB,EAAyB,CACtD,EAAQ,WAAW,EAAU,CAQjC,gBAAgB,EAAiB,EAAmB,EAAqB,CACrE,IAAM,GAAwB,EAAQ,KAAK,EAAU,EAAI,IAAI,QAAQ,EAAM,CAAG,EACxE,EAAmB,CAAC,WAAY,WAAW,CAAC,QAAQ,EAAU,CAAG,GAEnE,GAAwB,CAAC,GAElB,GAAoB,EAD3B,KAAK,aAAa,EAAS,EAAW,EAAM,CAI5C,KAAK,gBAAgB,EAAS,EAAU,CAUhD,SAAS,EAAkC,CACvC,IAAI,EAAU,EASd,OAPI,KAAK,eAAe,UAAY,KAAK,eAAe,SAAS,UAC7D,EAAU,UAAY,CAClB,WAAW,EAAU,IAAI,GAIjC,KAAK,EAAE,OAAO,CAAC,GAAG,KAAK,eAAe,OAAQ,EAAQ,CAC/C,EAOX,aAAa,EAA4B,CACrC,KAAK,EAAE,OAAO,CAAC,IAAI,KAAK,eAAe,OAAQ,EAAS,CAS5D,UAAU,EAAiB,EAAkB,CACzC,OAAO,EAAQ,KAAK,KAAK,iBAAiB,GAAK,EAAI,CAQvD,KAAK,EAAuB,CACxB,MAAO,QAAU,KAAK,iBAAiB,GAAK,EAShD,WAAW,EAAiB,EAAuG,CAC/H,IAAM,EAAa,EAAQ,GAM3B,OAJI,GACA,EAAQ,IAAI,EAAW,CAGpB,CAAE,MAAO,EAAW,YAAa,OAAQ,EAAW,aAAc,CAQ7E,iBAAiB,EAA6C,CAC1D,MAAQ,mCAAoC,KAAM,EAAE,OAAuB,QAAQ,CAQvF,+BAA+B,EAAiB,EAA4B,CACxE,IAAM,EAAI,KAAK,EAET,EAAW,EAAW,IAAI,GAAa,IAAI,KAAK,KAAK,SAAS,IAAY,CAAC,GAAG,CAAC,KAAK,IAAI,CAC9F,EAAQ,KAAK,EAAS,CAAC,QAAQ,EAAS,CAAC,MAAM,EAAW,IAAgC,CACtF,IAAM,EAAkB,EAAE,EAAe,CACzC,EAAW,QAAS,GAAsB,CACtC,IAAM,EAAY,KAAK,KAAK,SAAS,IAAY,CAC7C,EAAgB,KAAK,EAAU,GAC/B,EAAgB,IAAI,EAAW,EAAgB,KAAK,EAAU,CAAE,CAChE,EAAgB,WAAW,EAAU,GAE3C,EACJ,CASN,SAAS,EAAmB,EAAiB,EAAiC,CAC1E,IAAI,EAAO,EAAU,KAAK,kBAAkB,CACtC,EAAU,KAAK,eAAe,QAE9B,EAAO,KAAK,EAAE,OAAO,EAAE,CAAE,CAC3B,MAAO,OACP,OAAQ,OACR,IAAK,EAAU,WAAW,CAC1B,QAAS,GACZ,CAAE,EAAQ,CAEL,EAAW,EAAK,QAAU,0BAA4B,iBAE5D,GAAI,EACA,IAAI,CAAC,EAAK,OAAQ,CACd,IAAM,EAAQ,KAAK,eAAe,MAAM,EAAU,CAC5C,EAAY,EAAQ,QAAU,OAC9B,EAAsB,KAAK,WAAW,EAAU,CAClD,EAAmB,EACnB,EAAQ,QAAU,IAClB,EAAmB,EAAU,GAAG,aAAe,EAAU,OAAO,EAAI,GAAK,EAAI,GAKjF,IAAM,EAAe,KAAK,MAAM,IAAI,UAAU,UAAU,SAAY,aAEpE,KAAK,EAAE,eAAe,EAAS,iEAAiE,EAAY,qFAAqF,CAC5L,MAAM,EAAK,MAAO,CAClB,OAAO,EAAK,OAAQ,CACpB,IAAI,MAAO,EAAK,IAAK,CACrB,IAAI,EAAW,KAAK,IAAI,EAAoB,CAAG,EAAiB,CAChE,UAAU,EAAU,OAEtB,GACP,EAAK,QAAQ,CAUrB,YAAY,EAA6C,CACrD,GAAI,CAAC,KAAK,eAAe,MACrB,OAAQ,EAAY,OAKxB,IAAM,EADiB,EAA4B,eACpB,gBAAmB,EAA4B,eAM9E,OAJI,GAAW,EAAQ,OAAS,EACrB,SAAS,iBAAiB,EAAQ,GAAG,QAAS,EAAQ,GAAG,QAAQ,CAGpE,EAAY,OAUxB,0BAA0B,EAAyB,EAAmD,CAClG,OAAO,IAAI,GAAwB,KAAK,EAAG,EAAiB,EAAQ,GAItE,GAAN,MAAM,CAAuD,4BAChB,EAczC,YAAY,EAAiB,EAAyB,EAA8B,iBAN/D,mBACA,mBACA,uBACK,yBACsB,KAG5C,KAAK,EAAI,EACT,KAAK,gBAAkB,EACvB,KAAK,UAAY,EAAQ,UACzB,KAAK,eAAiB,EAAQ,eAC9B,KAAK,iBAAmB,EAAQ,iBAEhC,KAAK,YAAc,KAAK,YAAY,KAAK,KAAK,CAC9C,KAAK,WAAa,KAAK,WAAW,KAAK,KAAK,CAC5C,KAAK,UAAY,KAAK,UAAU,KAAK,KAAK,CAC1C,KAAK,iBAAmB,KAAK,iBAAiB,KAAK,KAAK,CAG5D,QAAe,CACN,KAAK,iBAIN,KAAK,iBACL,KAAK,gBACA,GAAG,YAAc,KAAK,UAAW,KAAK,iBAAkB,KAAK,YAAY,CACzE,GAAG,aAAe,KAAK,UAAW,KAAK,iBAAkB,KAAK,YAAY,CAE/E,KAAK,gBACA,GAAG,YAAc,KAAK,UAAW,KAAK,YAAY,CAClD,GAAG,aAAe,KAAK,UAAW,KAAK,YAAY,CAG5D,KAAK,mBAAmB,EAG5B,SAAgB,CACZ,KAAK,gBAAgB,IAAI,KAAK,UAAU,CACpC,KAAK,gBACL,KAAK,qBAAqB,CAE9B,KAAK,gBAAgB,GAAG,oBAAoB,QAAS,KAAK,iBAAkB,GAAK,CAGrF,WAAmB,EAAgB,CAC/B,GAAI,EAAE,KAAK,QAAQ,QAAQ,GAAK,GAAI,CAChC,IAAM,EAAQ,EAAE,eAAe,UAAU,IAAM,EAAE,eAAe,iBAAiB,GACjF,OAAO,EAAQ,EAAM,QAAU,EAEnC,OAAO,EAAE,SAAW,EAAE,eAAe,SAAW,EAGpD,iBAAyB,EAAqB,CAC1C,EAAE,gBAAgB,CAClB,EAAE,iBAAiB,CACnB,EAAE,0BAA0B,CAC5B,KAAK,gBAAgB,GAAG,oBAAoB,QAAS,KAAK,iBAAkB,GAAK,CAGrF,YAAoB,EAAc,CAC9B,IAAM,EAAS,KAAK,EAAE,EAAE,cAAc,CACjC,EAAO,SAIZ,KAAK,WAAa,GAClB,KAAK,WAAa,GAClB,KAAK,kBAAoB,EAAO,GAChC,KAAK,WAAa,KAAK,WAAW,EAAE,CACpC,KAAK,gBAAkB,EAAO,GAAG,WAEjC,EAAO,IAAI,SAAU,WAAW,CAChC,EAAO,IAAI,cAAe,OAAO,EAGrC,WAAmB,EAAc,CAC7B,GAAI,CAAC,KAAK,YAAc,CAAC,KAAK,kBAC1B,OAGJ,IAAM,EAAU,KAAK,WAAW,EAAE,CAC5B,EAAS,KAAK,WAAa,EAE7B,CAAC,KAAK,YAAc,KAAK,IAAI,EAAO,EAAI,EAAwB,iBAChE,KAAK,WAAa,IAGlB,KAAK,aACL,EAAE,gBAAgB,CAClB,KAAK,kBAAkB,WAAa,KAAK,gBAAkB,GAInE,WAA0B,CACjB,QAAK,WAIV,IAAI,KAAK,kBAAmB,CACxB,IAAM,EAAS,KAAK,EAAE,KAAK,kBAAkB,CAC7C,EAAO,IAAI,SAAU,GAAG,CACxB,EAAO,IAAI,cAAe,GAAG,CAG7B,KAAK,YACL,KAAK,gBAAgB,GAAG,iBAAiB,QAAS,KAAK,iBAAkB,GAAK,CAGlF,KAAK,WAAa,GAClB,KAAK,WAAa,GAClB,KAAK,kBAAoB,MAG7B,mBAAkC,CACzB,KAAK,gBAKV,KAAK,EAAE,SAAS,CACX,GAAG,YAAc,KAAK,UAAW,KAAK,WAAW,CACjD,GAAG,YAAc,KAAK,UAAW,KAAK,WAAW,CACjD,GAAG,UAAY,KAAK,UAAW,KAAK,UAAU,CAC9C,GAAG,WAAa,KAAK,UAAW,KAAK,UAAU,CAGxD,qBAAoC,CAChC,KAAK,EAAE,SAAS,CAAC,IAAI,KAAK,UAAU,GC94B5C,IAAM,GAAS,SAOf,IAAa,EAAb,KAAmD,CA4C/C,YACI,EACF,CADU,KAAA,MAAA,YAxCkB,CAC1B,OAAQ,GACR,OAAQ,GACR,UAAW,EACX,IAAK,EACL,MAAO,GACP,IAAK,GACL,KAAM,GACN,GAAI,GACJ,MAAO,GACP,KAAM,GACN,IAAK,GACL,KAAM,GACN,SAAU,GACV,OAAQ,GACR,SAAU,GACV,GAAI,IACJ,IAAK,IACL,IAAK,IACL,MAAO,GACP,YAAa,IACb,aAAc,IACd,WAAY,IACf,WAM2B,CACxB,OAAQ,EACR,OAAQ,EACR,QAAS,EACT,UAAW,EACX,SAAU,EACV,OAAQ,EACR,SAAU,EACb,CAaD,IAAY,WAAgC,CACxC,OAAO,KAAK,MAAM,MAAQ,EAAE,CAMhC,UAAU,EAAqB,CAC3B,OAAO,EAAI,QAAQ,gBAAkB,GAC1B,EAAE,OAAO,EAAE,CAAG,IAAM,EAAE,OAAO,EAAE,CAAC,aAAa,CACtD,CAMN,YAAY,EAAqB,CAC7B,OAAO,EAAI,QAAQ,WAAY,EAAW,IAC/B,EAAG,aAAa,CACzB,CAMN,KAAK,EAAqB,CACtB,IAAI,EAAS,EACb,IAAK,IAAM,KAAO,EACV,OAAO,UAAU,eAAe,KAAK,EAAK,EAAI,EAAI,IAAQ,UAC1D,IAGR,OAAO,EAcX,WAA6B,EAAgB,GAAG,EAAsB,CAClE,IAAK,IAAI,EAAI,EAAG,EAAI,EAAQ,OAAQ,IAChC,KAAK,cAAc,EAAa,EAAQ,GAAG,CAE/C,OAAO,EAOX,cAAgC,EAAgB,EAAmB,CAC/D,IAAM,EAAkB,KAAK,UAAU,gBACjC,EAAsB,KAAK,UAAU,oBACrC,EAAa,KAAK,UAAU,WAC5B,EAAyB,KAAK,UAAU,uBAE9C,IAAK,IAAM,KAAY,EAAQ,CAE3B,GAAI,IAAa,aAAe,IAAa,eAAiB,IAAa,YACvE,SAGJ,IAAM,EAAa,EAAe,GAC5B,EAAW,OAAO,EACpB,EAAiD,KAEjD,IAAa,IAAU,IAAc,OACrC,EAAW,EAAU,aAGzB,IAAI,EAAW,GAAU,OAAS,SAC9B,EAAgB,GAAU,OAAS,cACnC,EAAS,GAAU,OAAS,OAEhC,GAAI,GACA,CAAC,MAAM,QAAQ,EAAU,EACzB,IAAa,GACb,IAAa,GACb,IAAa,GACb,IAAa,GACb,CAAC,IACA,CAAC,KAAK,WAAY,OAAe,YAAY,EAAI,CAAC,IACnD,EAAE,aAAqB,aAEvB,GAAI,EAEC,EAAoB,GAAY,IAAI,KAAK,EAAU,SAAS,CAAC,SACvD,KAAK,YAAY,EAAU,CAEjC,EAAoB,GAAY,EAAU,OAAO,KAC/C,CAEH,IAAM,EAAY,EAAoB,GAClC,OAAO,IAAa,GACnB,EAAoB,GAAY,GAAY,EAAE,CAE9C,EAAoB,GAAY,EAAE,CAEvC,KAAK,cAAe,EAAoB,GAAW,EAAU,MAE1D,IAAaC,cAInB,EAAoB,GAAY,GAIzC,OAAO,EAMX,YAAoB,EAA4B,CAC5C,OAAO,OAAO,EAAI,OAAU,WAUhC,SAA4C,EAAO,EAAyC,CACxF,GAAI,CAAC,GAAS,GAAS,EAEnB,OAAO,EAGX,IAAI,EACA,EAAe,EAEb,EAAY,SAAoB,GAAG,EAA2C,CAChF,IAAM,EAAO,KACP,EAAU,CAAC,IAAI,KAAS,EAE9B,SAAS,GAAsB,CAC3B,IAAM,EAAS,EAAG,MAAM,EAAM,EAAK,CAEnC,MADA,GAAe,CAAC,IAAI,KACb,EAYX,GARI,CAAC,IAID,GACA,aAAa,EAAQ,CAGrB,EAAU,GACV,OAAO,GAAM,CAEb,EAAU,WAAW,EAAM,EAAQ,EAAQ,EAWnD,MAPA,GAAU,OAAS,UAAiB,CAChC,AAEI,KADA,aAAa,EAAQ,CACX,SAIX,EAQX,MAAe,CACX,IAAM,EAAY,OAAO,OAEzB,GAAI,CAEA,OAAO,EAAU,YAAY,MACrB,CAGR,OADqB,EAAU,gBAAgB,IAAI,WAAW,GAAG,CAAC,CAC9C,QAAQ,EAAa,EAAc,MAC/C,IAAM,GAAK,IAAM,GAAK,IAAM,GAAK,IAAM,MACvC,GAAO,KAEX,GAAO,EAAK,SAAS,GAAG,CAAC,SAAS,EAAG,IAAI,CAClC,GACR,GAAG,EAQd,KAAK,EAAoB,CAIrB,OAHI,EACO,EAAM,UAAU,CAAC,MAAM,CAE3B,GAMX,UAAU,EAAqB,CAC3B,OAAO,GAAU,KAMrB,QAAQ,EAAqB,CACzB,OAAO,GAAU,KAMrB,QAAQ,EAAoC,CACxC,OAAO,EAAM,SAAW,EAM5B,SAAS,EAA6B,CAClC,OAAO,OAAO,GAAU,SAM5B,UAAU,EAA6B,CACnC,OAAO,OAAO,UAAU,EAAM,CAMlC,UAAU,EAAqB,CAC3B,MAAO,CAAC,MAAM,EAAQ,WAAW,EAAM,CAAC,CAM5C,OAAO,EAA2B,CAC9B,OAAO,GAAS,EAAM,QAM1B,WAAW,EAA+B,CACtC,OAAO,OAAO,GAAU,WAM5B,SAAS,EAA6B,CAClC,OAAO,IAAU,MAAQ,OAAO,IAAU,GAS9C,aAAa,EAAiB,EAAqB,CAC/C,IAAM,EAAU,OAAO,QAGnB,CAFU,KAAK,MAER,aAAsB,IAAY,QAAe,EAAQ,KAC/D,EAAgB,GAAQ,OAAO,EAAQ,CAahD,QAAiB,EAAkE,CAC/E,IAAM,EAAK,OAAe,OACpB,EAAuB,UAAU,SAAW,GAAK,MAAM,QAAQ,EAAM,CACrE,EACA,MAAM,UAAU,MAAM,KAAK,UAAU,CACrC,EAAS,EAAc,OACzB,EAAY,EACV,EAAW,EAAE,UAAU,CACzB,EAAI,EACJ,EAAS,EACP,EAA4B,MAAM,EAAO,CACzC,EAA0B,MAAM,EAAO,CACvC,EAA6B,MAAM,EAAO,CAC5C,EAEE,GAAc,EAAe,EAAiB,IACzC,UAAoB,CACnB,IAAW,GACX,IAGJ,EAAS,WACL,EAAS,GAAS,KAClB,EAAO,GAAS,MAAM,UAAU,MAAM,KAAK,UAAU,CACxD,CAEK,EAAE,GACJ,GAAW,EAAqB,SAAZ,WAAwB,QAAQ,EAAU,EAAO,EAKjF,KAAO,EAAI,EAAQ,IACf,EAAQ,EAAc,GAClB,GAAS,KAAK,WAAW,EAAM,QAAQ,CACvC,EAAM,SAAS,CACV,KAAK,EAAW,EAAG,EAAiB,EAAc,CAAC,CACnD,KAAK,EAAW,EAAG,EAAgB,EAAa,CAAC,EAEtD,EAAS,WAAW,KAAM,EAAM,CAChC,EAAE,GAQV,OAJK,GACD,EAAS,YAAY,EAAiB,EAAc,CAGjD,EAAS,SAAS,CAQ7B,WAAW,EAAsB,CAC7B,OAAO,GAAO,CAAC,mBAAmB,KAAK,EAAI,CAQ/C,cAAc,EAAoD,CAC9D,IAAM,EAAY,OAAO,oBAAoB,EAAY,CACpD,OAAO,GAAQ,OAAQ,EAAoB,IAAU,WAAW,CAC/D,EAAe,OAAO,oBAAoB,OAAO,eAAe,IAAI,EAAY,EAAE,CAAC,CAAC,CAAC,CACtF,OAAO,GAAQ,IAAS,cAAc,CAE3C,OAAO,EAAU,OAAO,EAAa,CAQzC,aAAa,EAAwC,CACjD,GAAI,aAAuB,SAAU,CACjC,IAAM,EAAY,EACZ,EAAe,OAAO,eAAe,EAAU,CAErD,GAAI,GAAgB,IAAiB,QAAU,EAAa,KACxD,OAAO,EAGf,OAAO,KAQX,kBAAkB,EAAyC,EAAoB,CAC3E,EAAM,GAAG,GAAQ,UAAyD,CACtE,IAAM,EAAW,KAAK,UACtB,GAAI,EACA,OAAO,EAAS,GAAM,MAAM,EAAU,UAAU,EAU5D,yBAAkC,EAAuC,CACrE,IAAM,EAAW,EAAE,UAAa,CAIhC,OAFC,EAAQ,QAAgB,EAAS,OAAO,CAAC,KAAK,EAAS,QAAQ,CAAC,MAAM,EAAS,OAAO,CAEhF,EAAS,SAAS,GC5djC,IAAM,GAAS,SAMf,IAAa,GAAb,KAAmE,CA6E/D,aAAc,uBAzEoC,CAC9C,OAAQ,UAAW,YAAa,WAAY,UAC5C,OAAQ,UAAW,UAAW,QAAS,OAAQ,QAAS,UAC3D,qBAK+C,CAAC,QAAS,UAAW,OAAO,kBAK/B,CAAC,YAAa,SAAS,iBAKxB,CACxC,CAAC,QAAS,KAAK,CAAE,CAAC,SAAU,KAAK,CAAE,CAAC,QAAS,KAAK,CACrD,oBAK8C,CAC3C,CAAC,QAAS,KAAK,CAAE,CAAC,SAAU,KAAK,CAAE,CAAC,QAAS,KAAK,CAAE,CAAC,OAAQ,OAAO,CAAE,CAAC,OAAQ,OAAO,CACzF,yBAKmD,CAChD,QAAS,SAAU,SAAU,WAChC,mBAK6C,CAC1C,CAAC,OAAQ,SAAS,CAAE,CAAC,aAAc,WAAW,CAAE,CAAC,WAAY,WAAW,CAC3E,qBAK+C,CAC5C,OAAQ,SAAU,UAAW,SAAU,OAC1C,uBAKiD,CAC9C,CAAC,WAAY,cAAc,CAAE,CAAC,aAAc,cAAc,CAC7D,oBAKwC,EAAE,yBAKF,EAAE,4BAMqB,EAAE,CAI9D,KAAK,0BAA0B,aAAc,KAAK,iBAAiB,CACnE,KAAK,0BAA0B,WAAY,KAAK,eAAe,CAC/D,KAAK,0BAA0B,QAAS,KAAK,YAAY,CACzD,KAAK,0BAA0B,OAAQ,KAAK,WAAW,CACvD,KAAK,0BAA0B,eAAgB,KAAK,mBAAmB,CACvE,KAAK,0BAA0B,UAAW,KAAK,cAAc,CAC7D,KAAK,0BAA0B,SAAU,KAAK,aAAa,CAC3D,KAAK,0BAA0B,WAAY,KAAK,eAAe,CAC/D,KAAK,0BAA0B,aAAc,KAAK,iBAAiB,CAGnE,KAAK,mBAAmB,aAAc,KAAK,iBAAiB,CAC5D,KAAK,mBAAmB,OAAQ,KAAK,eAAe,CACpD,KAAK,mBAAmB,QAAS,KAAK,YAAY,CAClD,KAAK,mBAAmB,OAAQ,KAAK,WAAW,CAChD,KAAK,mBAAmB,eAAgB,KAAK,mBAAmB,CAMpE,eAAe,EAAgB,EAAsB,CAC5C,KAAK,mBAAmB,KACzB,KAAK,mBAAmB,GAAU,EAAE,EAGxC,KAAK,mBAAmB,GAAQ,IAAU,EAM9C,eAAe,EAAgB,EAAiC,CAC5D,IAAI,EACA,EACA,EACA,EACA,EACA,EAMJ,IAJK,KAAK,mBAAmB,KACzB,KAAK,mBAAmB,GAAU,EAAE,EAGnC,EAAI,EAAG,EAAI,EAAK,OAAQ,IAUzB,IATA,EAAO,EAAK,GAAG,KACf,EAAY,EAAK,GAAG,OAEf,KAAK,mBAAmB,GAAQ,KACjC,KAAK,mBAAmB,GAAQ,GAAQ,EAAE,EAG9C,EAAS,KAAK,mBAAmB,GAAQ,GAEpC,EAAI,EAAG,EAAI,EAAU,OAAQ,IAC9B,EAAe,EAAU,GAErB,MAAM,QAAQ,EAAa,CAC3B,EAAQ,EAAkC,IAAO,EAAkC,GAEnF,EAAO,GAA0B,EASjD,cAAc,EAAiC,CAC3C,IAAM,EAAS,EAAK,OACd,EAAW,EAAK,SAChB,EAAQ,EAAK,MACb,EAAiB,EAAK,OAEtB,EAAc,KAAK,cAAc,GACjC,EAAmB,KAAK,mBAAmB,GAEjD,GAAI,CAAC,EACD,MAAO,GAGX,IAAM,EAAe,EAAiB,GAChC,EAAa,GACZ,EAAa,IACb,GAAe,EAAY,GAElC,GAAI,EAAY,CACZ,IAAI,EAoBJ,MAlBA,CAaI,EAbA,IAAa,aACJ,EAAiB,IACnB,IAAa,eACX,SACF,IAAa,UACX,aACF,IAAa,SACX,KACF,IAAa,WACX,cACF,IAAa,aACX,GAEA,EAAiB,IAG9B,EAAS,GAAkB,EAEpB,EAAS,OAEhB,MAAO,GAOf,wBAAgC,EAAkB,EAAe,EAA0B,CAClF,KAAK,cAAc,KACpB,KAAK,cAAc,GAAY,EAAE,EAGrC,KAAK,cAAc,GAAU,GAAS,GAAa,EAMvD,0BAAkC,EAAkB,EAAiC,CACjF,IAAK,IAAI,EAAI,EAAG,EAAI,EAAI,OAAQ,IAC5B,GAAI,MAAM,QAAQ,EAAI,GAAG,CAAE,CACvB,IAAM,EAAQ,EAAI,GAClB,KAAK,wBAAwB,EAAU,EAAM,GAAI,EAAM,GAAG,MAE1D,KAAK,wBAAwB,EAAU,EAAI,GAAa,CAWpE,iBAAiB,EAAkB,EAAe,EAA0B,CACnE,KAAK,sBAAsB,KAC5B,KAAK,sBAAsB,GAAY,EAAE,EAG7C,KAAK,sBAAsB,GAAU,GAAS,GAAa,EAM/D,mBAAmB,EAAkB,EAAiC,CAClE,IAAK,IAAI,EAAI,EAAG,EAAI,EAAI,OAAQ,IAC5B,GAAI,MAAM,QAAQ,EAAI,GAAG,CAAE,CACvB,IAAM,EAAQ,EAAI,GAClB,KAAK,iBAAiB,EAAU,EAAM,GAAI,EAAM,GAAG,MAEnD,KAAK,iBAAiB,EAAU,EAAI,GAAa,CAQ7D,iBAAiB,EAAgB,EAAkB,EAAmC,CAClF,GAAI,IAAU,OACV,MAAO,GAGX,IAAM,EAAa,KAAK,sBAAsB,KAAY,GAE1D,GAAI,EACA,OAAO,EAAS,IC5N5B,IAAMC,GAAqB,CAAC,aAAc,WAAY,QAAS,OAAQ,UAAW,eAAe,CAG3F,GAAkB,kBAClB,GAAa,aAMnB,IAAa,EAAb,MAAa,UAAiE,CAAwC,CAoBlH,OAAO,KAAK,EAAc,EAAsC,EAAyC,CACrG,EAAO,GAAG,KAAK,KAAK,EAAS,EAAS,EAAQ,CAWlD,OAAO,MAAM,EAAc,EAAkF,CACzG,EAAO,GAAG,KAAK,MAAM,EAAS,EAAY,CAoD9C,YAAY,EAAsC,EAA6B,CAC3E,OAAO,CAEH,IAAY,QACZ,KAAK,KAAK,EAAS,EAAQ,CASnC,KAAK,EAAqC,EAAmC,CACzE,IAAM,EAAO,KAGRC,EAAU,iBAAiB,GAC5B,EAAK,sBAAwBA,EAAU,8BAI3C,IAAM,EAAc,EAAO,EAAmB,CAAC,gBAAgB,CAC/D,EAAK,QAAU,EAAY,EAAQ,CAAC,QAAQ,EAAK,CAGjD,EAAW,GAAG,KAAK,KAAK,EAAK,CAG7B,IAAI,EAAa,EAAW,EAAgB,WAAa,KACrD,EAEA,IACA,GAAS,EAAK,gBAAkB,EAAE,EAAE,EAAQ,gBAG5C,IAEA,EAAU,EAAY,OAAO,EAAE,CAAE,EAAS,CAAE,WAAY,EAAE,CAAE,CAAC,EAGjE,EAAU,EAAK,QAAU,EAAY,OAAO,GAAM,EAAE,CAAE,EAAK,QAAS,EAAK,SAAU,GAAS,EAAE,CAAE,EAAQ,CAGpG,IACC,EAAgB,WAAa,GAIlC,IAAM,EAAW,EAAO,EAAgB,CAAC,KAAK,OAAO,CAChD,EAAK,QAAQ,KAAK,EAAS,EAC5B,EAAK,QAAQ,KAAK,GAAW,EAAQ,MAAQ,IAAI,aAAa,CAAC,CAInE,EAAK,QAAQ,KAAK,QAAU,EAAQ,OAAS,EAAQ,KAAM,EAAK,CAGhE,EAAK,KAAK,EAAK,OAAQ,EAAQ,CAOnC,mBAA6B,CACzB,MAAO,CAAC,CAAE,KAAK,QAAQ,GAAW,mBAOtC,UAAU,EAA6B,CACnC,IAAmB,KAAK,QAExB,IAAM,EAAU,KAAK,QACf,EAAW,WACX,EAAW,EAAQ,KAAK,EAAS,EAAI,EAAQ,KAAK,EAAS,CAEjE,EAAQ,WAAW,EAAS,CAE5B,EAAQ,KAAK,EAAW,MAAM,EAAgB,CAAc,EAAX,EAAa,CAOlE,WAAW,EAAkC,CACzC,KAAK,iBAAiB,EAAQ,CAC9B,KAAK,WAAW,EAAQ,CACxB,EAAO,EAAmB,CAAC,gBAAgB,CAAC,OAAO,KAAK,QAAS,EAAQ,CACzE,KAAK,kBAAkB,CAO3B,WAAW,EAAkC,CACzC,IAAM,EAAO,KACT,EAAM,EACJ,EAAS,EAAK,OAAO,OACvB,EAEJ,KAAO,EAAM,EAAQ,IACjB,EAAI,EAAK,OAAO,GACZ,EAAK,QAAQ,IAAM,EAAQ,KAC3B,EAAK,OAAO,EAAG,EAAK,QAAQ,GAAG,CAC3B,EAAK,SAAW,EAAK,QAAQ,IAC7B,OAAO,EAAK,QAAQ,IAKhC,EAAK,KAAK,EAAK,OAAQ,EAAQ,CAOnC,OAAO,EAAuB,CAC1B,IAAM,EAAO,KAAK,SAAS,CACrB,EAAc,KAAK,OAErB,IAAU,EAAK,MAAQ,GAAK,EAAK,OAAS,KAAO,CAAC,GAAe,EAAK,QAAU,EAAY,OAAS,EAAK,SAAW,EAAY,WACjI,KAAK,MAAQ,EACb,KAAK,QAAQ,EAAM,EAAM,CACzB,KAAK,QAAQ,SAAU,EAAK,EAQpC,SAAuB,CACnB,OAAO,EAAO,EAAgB,CAAC,WAAW,KAAK,QAAe,CAQlE,KAAK,EAAwC,CACzC,GAAK,EAGD,KAAK,QAAQ,EAAK,MAFlB,OAAO,KAAK,SAAS,CAU7B,QAAQ,EAA0B,EASlC,QAAQ,EAAoB,EAAwB,EAOpD,SAAgB,CACZ,IAAM,EAAO,KAEb,EAAK,QAAQ,WAAW,QAAU,EAAK,QAAQ,OAAS,EAAK,QAAQ,KAAK,CAC1E,EAAK,QAAQ,WAAW,UAAU,CAClC,EAAK,QAAQ,CAMjB,UAAiB,CACb,KAAK,SAAS,CAOlB,iBAAiB,EAA8B,CAC3C,IAAM,EAAgB,KAAa,UAAU,QACvC,EAAU,KAAK,QACf,EAAK,GAAW,KAAK,SAAW,KAAK,QACrC,EAAoB,EAAE,CACxB,EACA,EACA,EACA,EAEE,EAAW,EAAO,GAAqB,CAE7C,KAAa,KAAK,QAAQ,UAAY,EAAa,KACnD,EAAmB,EAAS,mBAAmB,GAE3C,GAAC,GAAY,CAAC,GAIlB,KAAK,EAAI,EAAG,EAAID,GAAmB,OAAQ,IACvC,EAAOA,GAAmB,GAC1B,EAAa,KAAK,QAAQ,UAAY,EAAa,MAE9C,KAAQ,GAAkB,KAAQ,IACnC,EAAQ,KAAK,EAAS,cAAc,CAChC,OAAQ,EACR,SAAU,EACV,MAAO,EAAQ,GAClB,CAAC,CAAC,CAIX,EAAG,SAAS,EAAQ,KAAK,IAAI,CAAC,EAOlC,WAAW,EAA4B,CACnC,IAAM,EAAO,KACP,EAAW,EAAK,QAChB,EAAU,EAAS,KAAK,KAAK,CAE7B,EADI,EAAO,EAAmB,CAAC,gBAAgB,CAClC,cAAiB,EAAU,KAAM,CAC9C,EAAY,EAAS,KAAK,GAAW,CACrC,EAAiB,EAAS,KAAK,GAAgB,CACjD,EAEA,KAAO,KAAO,EAAS,GAI3B,IAAI,EACA,EAAO,KAAK,GAAY,EAAU,SAC3B,EACP,EAAO,KAAK,GAAiB,EAAe,SACrC,EAAS,OAAQ,CAExB,IAAM,EAAO,EAAO,EAAa,CAAC,MAAM,CACxC,EAAU,EAAS,KAAK,KAAK,EAAI,EAAK,iBAAiB,EAAU,GAAW,EAAK,CACjF,EAAO,KAAK,GAAiB,EAAQ,GAS7C,iBAAiB,EAAqC,EAA8B,CAChF,IAAM,EAAgB,KAAa,UAAU,QACvC,EAAiB,KAAK,QACtB,EAAK,GAAW,KAAK,SAAW,KAAK,QACvC,EACA,EACA,EACA,EAEE,EAAW,EAAO,GAAqB,CAE7C,KAAa,KAAK,QAAQ,UAAY,EAAa,KACnD,EAAmB,EAAS,mBAAmB,GAE3C,GAAC,GAAY,CAAC,GAIlB,IAAK,EAAI,EAAG,EAAIA,GAAmB,OAAQ,IACvC,EAAOA,GAAmB,IAEpB,KAAQ,GAAkB,KAAQ,IAAoB,EAAW,eAAe,EAAK,GACnF,IAAS,aACT,EAAG,YAAY,EAAS,cAAc,CAClC,OAAQ,EACR,SAAU,EACV,MAAO,EAAe,GACtB,KAAM,EAAe,SACxB,CAAC,CAAC,EAEC,IAAS,YACT,EAAG,YAAY,EAAS,cAAc,CAClC,OAAQ,EACR,SAAU,aACV,MAAO,EAAe,WACtB,KAAM,EAAe,SACxB,CAAC,CAAC,CAGP,EAAG,YAAY,EAAS,cAAc,CAClC,OAAQ,EACR,SAAU,EACV,MAAO,EAAe,GACzB,CAAC,CAAC,GAYnB,iBAAiB,EAAqB,EAAyB,CAC3D,IAAM,EAAU,EAAU,SAI1B,OAFA,EAAM,KAAK,KAAM,EAAQ,CAElB,IAKf,EAAO,GAAK,EAAO,UAInB,EAAO,UAAU,QAAU,CACvB,OAAQ,GACX,CACD,EAAO,UAAU,OAAS,EAAE,CCje5B,IAAM,GAAY,KACZ,GAAW,KACX,GAAc,KACd,GAAa,KACb,GAAW,KAGX,GAAoB,CAAC,QAAS,SAAS,CAK7C,IAAa,EAAb,KAAiD,CAI7C,OAAO,EAAuB,CAC1B,IAAM,EAAsC,CACxC,QAAS,IACT,OAAQ,IACR,OAAQ,IACR,SAAU,IACV,QAAS,IACZ,CAED,OAAO,EAAM,QAAQ,4BAA6B,SAAS,EAAO,CAC9D,OAAO,EAAS,IAClB,CAMN,OAAO,EAAe,EAAgC,CAKlD,OAJI,IAAiB,KACjB,EAAQ,KAAK,OAAO,EAAM,GAGtB,GAAK,GACR,QAAQ,GAAW,QAAQ,CAC3B,QAAQ,GAAU,OAAO,CACzB,QAAQ,GAAU,OAAO,CACzB,QAAQ,GAAa,SAAS,CAC9B,QAAQ,GAAY,QAAQ,CAOrC,aAAa,EAAuB,CAChC,IAAI,EAAO,GAEX,GAAI,CAEA,IAAM,EAAM,IAAI,IAAI,EAAO,OAAO,SAAS,OAAO,CAClD,GAAI,GAAkB,SAAS,EAAI,SAAS,CACxC,EAAO,OAEP,MAAU,MAAM,mBAAmB,MAEnC,CACJ,EAAO,eAGX,OAAO,KAAK,OAAO,EAAK,CAM5B,qBAAqB,EAAc,EAAoC,CAInE,OAFsB,EAAmB,EAAO,KAAK,OAAO,EAAK,EAE5C,QAHJ,iDAGuB,EAAO,EAAK,EAAK,EAAK,EAAQ,IAAe,CACjF,IAAM,EAAe,EAAW,YAAY,IAAK,EAAS,EAAE,CACtD,EAAc,EAAW,UAAU,EAAe,EAAG,EAAO,CAElE,GAAI,kBAAkB,KAAK,EAAY,CACnC,OAAO,EAGX,IAAI,EAAM,EAAM,MAAM,CAChB,EAAc,EAAM,MAAM,CAE5B,UAAU,KAAK,EAAI,GACnB,EAAM,WAAa,GAGvB,GAAI,CAMA,MALA,GAAM,IAAI,IAAI,EAAI,CAAC,KAKZ,YAAY,EAAI,8CAAoD,EAAY,WAC/E,CAER,OAAO,IAEb,CAMN,SAAS,EAAuB,CAC5B,IAAI,EAEJ,GAAI,CACA,EAAW,OAAO,mBAAmB,EAAM,MAC/B,CAIZ,EAAW,EAAM,QAAQ,iCAAkC,SAAU,EAAG,EAAI,EAAI,CAC5E,OAAO,OAAO,aAAa,SAAS,MAAQ,GAAM,GAAK,GAAG,CAAC,EAC7D,CAGN,OAAO,ICzHf,IACMG,GAAiB,EAAE,CAAC,SAEpB,GAAuB,gBACvB,GAAsB,uBACtB,GAAuB,sBACvB,GAAe,UAEf,GAAmB,CAAC,EAAE,CAAE,CAAC,IAAK,IAAK,IAAI,CAAE,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAI,CAAC,CACxE,GAAmB,CACrB,CACI,iCACA,8BACA,6BACA,0BACA,2BACA,yBACA,sBACA,qBACA,sBACA,sBACA,sBACH,CACD,CACI,mBACA,mBACA,mBACH,CACD,CACI,aACA,aACA,WACA,QACH,CACJ,CAEK,GAA0C,CAC5C,EAAG,WACH,EAAG,WACH,EAAG,SACH,OAAQ,SACX,CAOD,IAAa,GAAb,KAA6D,CAGzD,YACI,EACA,EACF,CAFU,KAAA,eAAA,EACA,KAAA,QAAA,uBAJsC,KAUlD,mBAAmB,EAAwC,CACvD,KAAK,gBAAkB,EAM3B,UACI,EACA,EACA,EACA,EACW,CACX,OAAO,KAAK,kBAAkB,EAAO,EAAS,EAAS,GAAO,EAAiB,CAMnF,eACI,EACA,EACA,EACW,CACX,OAAO,KAAK,kBAAkB,EAAO,EAAS,EAAS,GAAK,CAGhE,kBACI,EACA,EACA,EACA,EACA,EACW,CACX,GAAIA,GAAe,KAAK,EAAM,GAAKD,gBAC/B,OAAO,EAGX,GAAI,CAAC,EACD,OAAO,KAGX,IAAM,EAAW,OAAO,EAAM,CAC1B,EAAoB,KACpB,EAGJ,GAAI,EAAS,QAAQ,KAAK,GAAK,EAAG,CAC9B,IAAM,EAAY,GAAqB,KAAK,EAAS,CACrD,GAAI,EAAW,CACX,IAAI,EAAU,EAAU,GAKxB,GAJA,EAAW,GAAa,KAAK,EAAQ,UAAU,EAAE,CAAC,CAElD,EAAO,IAAI,KAAK,SAAS,EAAS,GAAG,CAAC,CAElC,GAAY,KAAK,gBAAiB,CAClC,IAAM,EAAS,KAAK,2BAA2B,EAAS,GAAG,CAC3D,EAAO,KAAK,gBAAgB,MAAM,EAAM,EAAE,CAC1C,EAAO,KAAK,gBAAgB,QAAQ,EAAM,EAAG,GAAK,EAAO,CAG7D,OAAO,GAIf,IAAM,EAAkB,KAAK,eAAe,WAAW,EAAQ,CAE3D,EACJ,AACI,EADC,EAGa,MAAM,QAAQ,EAAQ,CAAG,EAAU,CAAC,EAAQ,CAF5C,KAAK,kBAAkB,EAAgB,CAKzD,IAAK,IAAI,EAAM,EAAG,EAAM,EAAY,OAAQ,IAExC,GADA,EAAO,KAAK,WAAW,EAAU,EAAY,GAAM,EAAiB,EAAQ,EAAiB,CACzF,EACA,OAAO,EAIf,OAAO,EAGX,WACI,EACA,EACA,EACA,EACA,EACW,CACX,GAAI,CAAC,EACD,OAAO,KAGX,IAAM,EAAW,EAAQ,UAAU,SAC/B,EAAM,EACN,EAAW,EAET,EAAa,GAA0B,CACzC,IAAI,EAAI,EACR,KAAO,EAAO,KAAS,GACnB,IACA,IAKJ,OAHI,EAAI,GACJ,IAEG,GAGL,EAAa,GAAgC,CAC/C,IAAI,EAAO,GACX,GAAI,IAAS,EACT,IAAK,IAAI,EAAI,EAAG,GAAK,EAAM,IACvB,GAAQ,EAAM,EAAW,IAAM,GAKvC,AAGI,EAHA,GAAoB,EAAK,MAAM,GAAa,OAAO,EAAI,OAAO,UAAU,OAAO,EAAK,CAAC,EAAI,OAAO,EAAK,CAAG,EACjG,KAAK,UAAU,EAAK,CAEpB,EAAM,OAAO,EAAU,EAAK,CAGvC,IAAM,EAAK,GAAa,IAAa,OAAO,UAAY,EAAO,IAAI,CAC7D,EAAQ,EAAK,MAAM,EAAG,CAE5B,GAAI,EAAO,CACP,IAAM,EAAW,EAAM,GAEvB,MADA,IAAY,EAAS,OACd,SAAS,EAAU,GAAG,CAEjC,OAAO,MAGL,GAAkB,EAAiB,EAAgB,IAAsC,CAC3F,IAAI,EAAc,EACd,EAAW,EAEf,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM,OAAQ,IAAK,CACnC,IAAM,EAAO,EAAM,GACb,EAAa,EAAK,OACpB,EAAW,EAAM,OAAO,EAAU,GAAa,EAAW,CAE1D,IACA,EAAW,EAAS,aAAa,EAGjC,IAAa,GAAQ,EAAa,IAClC,EAAc,EACd,EAAW,GASnB,OALI,GACA,GAAY,EACL,EAAW,GAGf,MAGL,MACE,EAAM,OAAO,EAAS,GAAK,EAAO,IAClC,IACO,IAEJ,GAGP,EAAsB,KACtB,EAAuB,KACvB,EAAqB,KACrB,EAAuB,KACvB,EAAyB,KACzB,EAAyB,KACzB,EAA8B,KAC9B,EAAU,GACR,EAAO,IAAI,KACX,EAAkB,EAAS,iBAAmB,KAC9C,EAAc,EAAK,aAAa,CAClC,EAAwB,KACxB,EACA,EAA6B,KAC7B,EAA+B,KAEnC,AACI,IAAS,IAIb,IAAM,EAAW,EAAS,SAAiB,GACvC,IACA,EAAS,GAGb,IAAM,EAAc,EAAO,MAAM,GAAG,CAC9B,EAAS,EAAY,OAU3B,IAPA,AACK,EAAiB,aAAa,KAAK,eAAe,EAAS,KAAK,CAErE,AACK,EAAiB,eAAe,KAAK,eAAe,EAAS,OAAO,CAGlE,EAAM,EAAQ,IAAO,CACxB,IAAM,EAAK,EAAY,GAEvB,GAAI,EACI,IAAO,IACP,EAAU,GAEV,GAAc,SAGd,IAAO,IAAK,CACZ,IAAM,EAAQ,EAAU,IAAI,CAE5B,GAAI,IAAQ,MAAQ,EAAQ,EACxB,SAOJ,GAJA,EAAM,EAAQ,EACR,EAAU,EAAE,CACZ,EAAgB,EAAiB,WAAW,IAAU,EAAI,YAAc,SAAU,GAAK,CAEzF,IAAQ,MAAQ,KAAK,WAAW,EAAK,EAAG,GAAG,CAC3C,OAAO,aAEJ,IAAO,IAAK,CACnB,IAAM,EAAQ,EAAU,IAAI,CAM5B,GAJA,EAAQ,EAAQ,EACV,EAAU,EAAE,CACZ,EAAgB,EAAiB,aAAa,IAAU,EAAI,YAAc,SAAU,GAAK,CAE3F,IAAU,MAAQ,KAAK,WAAW,EAAO,EAAG,GAAG,CAC/C,OAAO,KAEX,YACO,IAAO,IAAK,CACnB,IAAM,EAAQ,EAAU,IAAI,CAG5B,GAFA,EAAO,EAAU,EAAM,CAEnB,IAAS,KACT,OAAO,KAGX,GAAI,IAAU,EAAG,CACb,IAAI,EAAU,EACV,OAAO,GAAY,WACnB,EAAU,EAAc,SAAS,EAAS,GAAG,EAGjD,EAAQ,EAAc,EAAc,IAAO,EACvC,EAAO,IACP,GAAQ,cAGT,IAAO,IAMd,IALA,EAAU,IAAI,CACd,EAAQ,EAAU,EAAE,CAChB,IAAU,KACV,EAAQ,GAER,IAAU,MAAQ,KAAK,WAAW,EAAO,EAAG,GAAG,CAC/C,OAAO,aAEJ,IAAO,IAGd,IAFA,EAAU,IAAI,CACd,EAAQ,EAAU,EAAE,CAChB,IAAU,MAAQ,KAAK,WAAW,EAAO,EAAG,GAAG,CAC/C,OAAO,aAEJ,IAAO,IAGd,IAFA,EAAU,IAAI,CACd,EAAU,EAAU,EAAE,CAClB,IAAY,MAAQ,KAAK,WAAW,EAAS,EAAG,GAAG,CACnD,OAAO,aAEJ,IAAO,IAGd,IAFA,EAAU,IAAI,CACd,EAAU,EAAU,EAAE,CAClB,IAAY,MAAQ,KAAK,WAAW,EAAS,EAAG,GAAG,CACnD,OAAO,aAEJ,IAAO,IAAK,CACnB,IAAM,EAAQ,EAAU,IAAI,CACtB,EAAQ,EAAM,OAAO,EAAU,EAAM,CAAC,MAAM,GAAa,GAAG,CAGlE,GAFA,EAAe,EAAU,EAAM,CAE3B,IAAiB,MAAQ,EAAO,CAChC,IAAI,EAAK,WAAW,KAAO,EAAM,GAAG,CACpC,EAAK,WAAW,KAAK,QAAQ,EAAI,EAAE,CAAC,CACpC,EAAe,EAAK,IAGxB,GAAI,IAAiB,MAAQ,KAAK,WAAW,EAAc,EAAG,IAAI,CAC9D,OAAO,aAEJ,IAAO,IAAK,CACnB,IAAM,EAAQ,EAAU,IAAI,CACxB,EAAgB,EAAS,GACzB,EAAgB,EAAS,GAQ7B,GANI,IAAU,IACV,EAAgB,KAAK,eAAe,EAAc,CAClD,EAAgB,KAAK,eAAe,EAAc,EAGtD,EAAS,EAAe,EAAe,GAAO,KAAK,oBAAoB,EAAc,CAAC,CAClF,CAAC,GAAU,CAAC,EAAe,EAAe,GAAO,KAAK,oBAAoB,EAAc,CAAC,CACzF,OAAO,aAEJ,IAAO,IAAK,CACnB,EAAM,GACN,IAAM,EAAQ,EAAU,IAAI,CAE5B,GAAI,EAAM,OAAO,EAAU,EAAE,GAAK,IAAK,CACnC,GAAc,CACd,SAGJ,IAAM,EAAU,EAAM,OAAO,EAAU,EAAE,CAAC,MAAM,EAAQ,EAAI,GAAsB,GAAqB,CAEvG,GAAI,CAAC,EACD,OAAO,KAGX,IAAM,EAAa,EAAQ,GAAG,MAAM,IAAI,CACpC,EAAiB,EAAW,GAC5B,EAAmB,EAAW,GAalC,GAXI,CAAC,GAAoB,EAAe,OAAS,IAC7C,EAAW,EAAe,OAAS,EACnC,EAAmB,EAAe,UAAU,EAAS,CACrD,EAAiB,EAAe,UAAU,EAAG,EAAS,EAG1D,EAAc,SAAS,EAAgB,GAAG,CACtC,KAAK,WAAW,EAAa,IAAK,GAAG,EAIrC,EAAQ,IACR,EAAmB,EAAW,GAAG,GAAK,EACtC,EAAgB,SAAS,EAAkB,GAAG,CAC1C,MAAM,EAAc,EAAI,KAAK,WAAW,EAAe,IAAK,GAAG,EAC/D,OAAO,aAGR,IAAO,IACd,EAAU,GACV,GAAc,SACP,CAAC,GAAc,CACtB,OAAO,KAMnB,GAAI,GAAU,CAAC,QAAQ,KAAK,EAAM,OAAO,EAAS,CAAC,CAC/C,OAAO,KAKP,IAAS,MAAQ,IAAU,MAAQ,IAAQ,OAF/B,IAAU,MAAQ,IAAY,MAAQ,IAAY,OAG9D,EAAO,EACP,EAAQ,EAAK,UAAU,CACvB,EAAM,EAAK,SAAS,GAEhB,IAAS,OACT,EAAO,GAEP,IAAQ,OACR,EAAM,IAIV,GAAU,IAAU,MAAQ,EAAQ,KACpC,GAAS,IAGb,IAAI,EAsBJ,OArBI,GACI,GAAe,IAAU,OACzB,GAAS,CAAC,GAEV,GAAiB,IAAY,OAC7B,GAAW,CAAC,GAEhB,EAAS,IAAI,KAAK,KAAK,IAAI,EAAO,GAAS,EAAG,EAAK,GAAS,EAAG,GAAW,EAAG,GAAW,EAAG,GAAgB,EAAE,CAAC,GAE9G,EAAS,IAAI,KAAK,EAAO,GAAS,EAAG,EAAK,GAAS,EAAG,GAAW,EAAG,GAAW,EAAG,GAAgB,EAAE,CACpG,KAAK,UAAU,EAAQ,EAAM,EAG7B,EAAQ,KACR,EAAO,YAAY,EAAM,CAGzB,EAAO,SAAS,GAAK,GAAO,IAAQ,OAC7B,KAGJ,EAGX,2BAAmC,EAAwB,CACvD,IAAM,EAAO,EAAO,OAAO,EAAG,EAAE,GAAK,IAAM,GAAK,EAGhD,MAFA,GAAS,EAAO,UAAU,EAAE,CAErB,GADS,SAAS,EAAO,OAAO,EAAG,EAAE,CAAE,GAAG,CAAG,GAAM,SAAS,EAAO,UAAU,EAAE,CAAE,GAAG,EAI/F,kBAA0B,EAA4B,CAClD,IAAM,EAAS,KAAK,IAAI,GAAiB,OAAQ,GAAiB,OAAO,CAEnE,GADW,EAAQ,UAAY,EAAQ,UAAU,UAC7B,SACpB,EAAoB,EAAE,CAE5B,IAAK,IAAI,EAAM,EAAG,EAAM,EAAQ,IAAO,CACnC,IAAM,EAAiB,GAAiB,IAAQ,EAAE,CAClD,IAAK,IAAI,EAAY,EAAG,EAAY,EAAe,OAAQ,IACvD,EAAQ,KAAM,EAAiB,EAAe,IAAY,CAE9D,EAAQ,KAAK,GAAI,GAAiB,IAAQ,EAAE,CAAE,CAGlD,OAAO,EAGX,WAAmB,EAAe,EAAe,EAAsB,CACnE,MAAO,EAAE,GAAS,GAAS,GAAS,GAGxC,UAAkB,EAAY,EAA4B,CAClD,CAAC,GAAS,EAAK,UAAU,GAAK,IAC9B,EAAK,SAAS,EAAK,UAAU,CAAG,EAAE,CAI1C,eAAuB,EAA0F,CAC7G,MAAO,CACH,MAAO,EAAK,MAAM,IAAI,GAAK,EAAE,aAAa,CAAC,CAC3C,UAAW,EAAK,UAAU,IAAI,GAAK,EAAE,aAAa,CAAC,CACtD,CAGL,UAAkB,EAAuB,CACrC,OAAO,EAAM,QAAQ,MAAO,GAAG,CAGnC,eAAuB,EAAiC,CACpD,OAAO,EAAY,IAAI,GAAK,EAAE,OAAO,EAAE,CAAC,CAG5C,oBAA4B,EAA2B,CACnD,OAAO,EAAQ,QAAQ,EAAK,IAAM,KAAK,IAAI,EAAK,EAAE,OAAO,CAAE,EAAE,GChexD,GAAb,MAAa,CAAY,6BAE0C,CAC3D,SAAU,GACV,OAAQ,CACJ,MAAO,CACH,GAAI,KACJ,OAAQ,CACJ,GAAI,CAAE,KAAM,SAAU,CACtB,KAAM,CAAE,KAAM,SAAU,CACxB,SAAU,CAAE,KAAM,SAAU,CAC5B,WAAY,CAAE,KAAM,SAAU,CAC9B,eAAgB,CAAE,KAAM,SAAU,CAClC,mBAAoB,CAAE,KAAM,SAAU,CACtC,UAAW,CAAE,KAAM,SAAU,aAAc,KAAM,CACjD,UAAW,CAAE,KAAM,UAAW,aAAc,GAAO,CACnD,SAAU,CAAE,KAAM,UAAW,aAAc,GAAO,CAClD,SAAU,CAAE,KAAM,UAAW,aAAc,GAAO,CAClD,UAAW,CAAE,KAAM,OAAQ,CAC3B,MAAO,CAAE,MAAQ,GAAe,GAAS,EAAE,CAAE,CAChD,CACJ,CACJ,CACJ,uBAG2D,CACxD,KAAM,YACN,SAAU,gBACV,WAAY,kBACZ,eAAgB,sBAChB,mBAAoB,0BACpB,GAAI,UACJ,UAAW,iBACX,MAAO,aACP,UAAW,iBACX,UAAW,iBACX,SAAU,gBACV,SAAU,gBACb,CAUD,YAAY,EAA2B,CACnC,KAAK,QAAU,EACf,KAAK,QAAU,KAAK,aAAa,EAAQ,YAAY,CACrD,KAAK,WAAa,KAAK,iBAAiB,EAAQ,YAAY,CAMhE,aAAqB,EAAyD,CAC1E,IAAI,EAaJ,MAXA,CAKI,EALA,EAAY,sBAAsB,MAAM,KAAK,WACnC,EAAE,OAAO,GAAM,EAAE,CAAE,EAAY,gBAAiB,EAAY,WAAW,QAAQ,CAClF,MAAM,QAAQ,EAAY,WAAW,CAClC,EAAE,OAAO,GAAM,EAAE,CAAE,EAAY,gBAAiB,CAAE,KAAM,EAAY,WAAY,CAAC,CAEjF,EAAE,OAAO,GAAM,EAAE,CAAE,EAAY,gBAAiB,EAAY,WAAW,CAGrF,EAAQ,aAAe,EAAY,aACnC,KAAK,UAAU,EAAQ,OAAO,MAAM,OAAQ,EAAY,CAEjD,EAMX,iBAAyB,EAAyC,CAK9D,OAJI,EAAY,sBAAsB,MAAM,KAAK,WACtC,EAAY,WAGhB,MAAM,KAAK,WAAW,OAAO,KAAK,QAAQ,CAMrD,UACI,EACA,EACI,CACJ,IAAK,IAAM,KAAO,EACd,GAAI,OAAO,UAAU,eAAe,KAAK,EAAQ,EAAI,EAAI,EAAY,UAAU,GAAM,CACjF,IAAM,EAAY,EAAY,UAAU,GACxC,EAAO,GAAK,KAAO,EAAY,IAQ3C,eAAqB,CACjB,OAAO,KAAK,WAMhB,SAAsB,CAClB,OAAO,KAAK,WAAW,MAAM,CAMjC,gBAAkC,CAC9B,IAAM,EAAO,KAAK,SAAS,CAC3B,OAAO,EAAK,OAAS,EAAK,EAAK,OAAS,GAAK,KAMjD,eAAe,EAAsC,CAIjD,OAHK,EAGE,KAAK,WAAW,IAAI,EAAG,CAFnB,KAQf,gBAAgB,EAA8B,CAC1C,OAAO,KAAK,WAAW,SAAS,EAAI,CAMxC,aAAa,EAAmB,EAA2B,CAIvD,MAHI,CAAC,GAAW,CAAC,EACN,KAEJ,EAAQ,MAAM,KAAK,GAAQ,EAAK,MAAQ,EAAI,EAAI,KAM3D,kBAAoC,CAChC,OAAO,KAAK,WAAW,MAAM,CAAC,KAAM,GAAgB,EAAE,SAAS,EAAI,KAMvE,YAAY,EAAqC,EAAiC,CAC9E,IAAM,EAAe,OAAO,GAAY,SAAW,CAAE,KAAM,EAAS,CAAG,EAEjE,EAAiC,CACnC,GAAI,KAAK,QAAQ,aAAe,KAAK,QAAQ,aAAa,MAAM,CAAG,OACnE,UAAW,IAAI,KACf,MAAO,EAAE,CACT,GAAG,EACH,SAAU,EAAa,UAAU,UAAU,EAAI,EAClD,CAED,OAAO,KAAK,WAAW,IAAI,EAAY,CAM3C,cAAc,EAAuC,EAA6C,CAC9F,GAAI,CAAC,EACD,OAAO,KAGX,IAAI,EAAgB,EAKpB,GAJM,aAAmB,MAAM,KAAK,mBAChC,EAAgB,KAAK,eAAgB,EAAqB,GAAG,EAG7D,CAAC,EACD,OAAO,KAGX,IAAK,IAAM,KAAO,EACV,OAAO,UAAU,eAAe,KAAK,EAAS,EAAI,EACjD,EAAsB,IAAI,EAAM,EAAgB,GAAK,CAI9D,OAAO,EAMX,cAAc,EAA4B,CAMtC,OALK,GAIJ,EAAgB,IAAI,YAAa,GAAK,CAChC,IAJI,GAUf,WAAW,EAAqC,CAC5C,GAAI,CAAC,EACD,MAAO,GAIX,IAAM,EAAgB,KAAK,kBAAkB,CAM7C,OALI,GACC,EAAsB,IAAI,WAAY,GAAM,CAGhD,EAAgB,IAAI,WAAY,GAAK,CAC/B,EAMX,oBAA2B,CACvB,IAAM,EAAgB,KAAK,kBAAkB,CACzC,GACC,EAAsB,IAAI,WAAY,GAAM,GCjRzD,IAAaE,EAAK,aAGL,GAAqB,CAC9B,SAAU,WACV,KAAM,OACT,CAGY,GAAiB,CAC1B,KAAM,OACN,UAAW,YACX,KAAM,OACN,OAAQ,SACX,CAGY,EAAoB,CAC7B,WAAY,aACZ,SAAU,WACV,KAAM,OACT,CAGY,EAAgC,CACzC,OAAQ,SACR,KAAM,OACN,cAAe,gBAClB,CAGYC,EAAQ,CACjB,WAAY,8BACZ,eAAgB,gBAChB,YAAa,eACb,YAAa,eACb,YAAa,eACb,aAAc,gBACd,UAAW,aACX,SAAU,WACV,UAAW,aACX,QAAS,WACT,kBAAmB,qBACnB,IAAK,MACL,KAAM,OACN,KAAM,OACN,MAAO,QACP,KAAM,cACN,KAAM,UACN,OAAQ,SACR,EAAG,IACH,UAAW,aACX,MAAO,kBACV,CAGY,EAAW,CACpB,MAAO,QACP,KAAM,OACN,IAAK,MACL,OAAQ,SACR,SAAU,WACb,CAGYC,EAAS,CAElB,OAAQ,WACR,SAAU,aACV,MAAO,UACP,SAAU,aACV,SAAU,aACV,OAAQ,WACR,WAAY,eACZ,SAAU,cAGV,KAAM,aACN,SAAU,cACV,SAAU,cACV,SAAU,cACV,YAAa,qBACb,2BAA4B,sCAC5B,YAAa,iBACb,cAAe,mBACf,UAAW,eAGX,OAAQ,WAGR,OAAQ,WACR,cAAe,mBACf,iBAAkB,sBAClB,0BAA2B,gCAC3B,WAAY,gBACZ,eAAgB,qBAGhB,OAAQ,WACR,eAAgB,8DAChB,WAAY,gBACZ,cAAe,+DACf,WAAY,gBACZ,WAAY,gBACZ,SAAU,cACV,WAAY,gBACZ,eAAgB,yBAChB,sBAAuB,iCAGvB,OAAQ,gBACR,KAAM,SACN,WAAY,gBACZ,YAAa,iBACb,oBAAqB,qBACrB,SAAU,cACV,SAAU,cACV,mBAAoB,yBACpB,SAAU,cACV,UAAW,eACX,SAAU,mBACV,aAAc,kBACd,UAAW,eACX,YAAa,mBAGb,aAAc,kBACd,aAAc,kBACd,cAAe,mBACf,iBAAkB,sBAGlB,OAAQ,gBAGR,QAAS,YACT,cAAe,mBACf,aAAc,kBACd,oBAAqB,0BACrB,sBAAuB,6BACvB,qBAAsB,2BACtB,mBAAoB,yBACpB,mBAAoB,yBACpB,eAAgB,oBAChB,cAAe,mBACf,YAAa,iBACb,YAAa,iBACb,cAAe,mBACf,eAAgB,yBAChB,mBAAoB,yBAGpB,cAAe,mBACf,iBAAkB,sBAClB,wBAAyB,8BACzB,yBAA0B,+BAC1B,uBAAwB,6BAGxB,qBAAsB,eACtB,sBAAuB,gBAGvB,WAAY,eACZ,gBAAiB,qBACjB,0BAA2B,gCAC3B,oBAAqB,0BACrB,kBAAmB,uBACnB,qBAAsB,0BACtB,6BAA8B,mCAG9B,UAAW,cAGX,gBAAiB,qBAGjB,YAAa,iBACb,QAAS,SAGT,WAAY,gBACZ,kBAAmB,wBAGnB,OAAQ,WAGR,UAAW,oBACX,IAAK,QACR,CAGYC,EAAa,CACtB,WAAY,uBACZ,eAAgB,4BAChB,YAAa,wBACb,gBAAiB,6BACjB,0BAA2B,uCAC3B,2BAA4B,yCAC5B,6BAA8B,2CAC9B,yBAA0B,uCAC1B,wBAAyB,sCACzB,iBAAkB,8BAClB,kBAAmB,+BACnB,WAAY,mCACZ,mBAAoB,6CACpB,gBAAiB,4BACjB,gBAAiB,6BACjB,YAAa,wBACb,qBAAsB,mCACtB,YAAa,gCAChB,CAGYC,EAAS,CAClB,YAAa,cACb,gBAAiB,kBACjB,MAAO,QACP,MAAO,QACP,cAAe,gBACf,eAAgB,iBAChB,kBAAmB,oBACnB,SAAU,WACV,WAAY,aACZ,WAAY,aAEZ,cAAe,gBAEf,cAAe,gBACf,qBAAsB,uBACtB,sBAAuB,wBACvB,gBAAiB,kBACjB,iBAAkB,mBAClB,iBAAkB,mBAClB,6BAA8B,+BACjC,CAGYC,EAAQ,QAGRG,GAAQ,QACRC,GAAO,OACPC,GAAS,SCvPhB,EAAgB,GAAGE,EAAG,YAGxB,GAA6B,KAC7B,GAAa,GAcjB,IAAa,GAAb,KAAiC,CAO7B,YAAY,EAAoC,CAC5C,KAAK,QAAU,EAMnB,qBAA4B,CAExB,IAAM,EADU,KAAK,QAAQ,YAAY,CAChB,SAGnB,EAAc,KAAK,QAAQ,QAAQ,KAAK,IAAIC,EAAO,cAAc,CACnE,EAAY,QACZ,EACK,KAAK,OAAQ,MAAM,CACnB,KAAK,YAAa,SAAS,CAC3B,KAAK,aAAc,EAAS,iBAAiB,CAGtD,KAAK,0BAA0B,CAC/B,KAAK,8BAA8B,CACnC,KAAK,yBAAyB,EAAS,CACvC,KAAK,2BAA2B,CAChC,KAAK,wBAAwB,CAC7B,KAAK,oBAAoB,EAAS,CAMtC,0BAAiC,CAC7B,IAAM,EAAa,KAAK,QAAQ,QAAQ,KAAK,IAAIA,EAAO,SAAS,CAE3D,EAAsB,EAAW,OAAO,UAAW,CACrD,OAAO,EAAE,KAAK,CAAC,KAAK,IAAIA,EAAO,kBAAkB,CAAC,SAAW,GAC/D,CAEI,EAAyB,EAAW,OAAO,UAAW,CACxD,OAAO,EAAE,KAAK,CAAC,KAAK,IAAIA,EAAO,kBAAkB,CAAC,OAAS,GAC7D,CAEF,EAAoB,KAAK,WAAY,IAAI,CACzC,EAAuB,KAAK,WAAY,KAAK,CAG7C,EACK,IAAI,GAAGC,KAAQ,EAAc,GAAGC,KAAO,EAAc,GAAGC,IAAQ,IAAgB,CAChF,GAAG,GAAGF,KAAQ,IAAiB,UAAW,CACvC,IAAM,EAAQ,EAAE,KAAK,CAEjB,IACA,EAAW,YAAYD,EAAO,SAAS,CAG3C,EAAW,YAAYA,EAAO,MAAM,CAEhC,IACA,EAAM,SAASA,EAAO,SAAS,CAGnC,EAAM,SAASA,EAAO,MAAM,CAC5B,GAAa,IACf,CACD,GAAG,GAAGE,KAAO,IAAiB,UAAW,CAClC,IAAc,CAAC,IACf,EAAE,KAAK,CAAC,YAAYF,EAAO,SAAS,CAExC,EAAE,KAAK,CAAC,YAAYA,EAAO,MAAM,EACnC,CACD,GAAG,GAAGG,IAAQ,IAAiB,SAAS,EAAQ,CACzC,EAAE,EAAE,OAAO,CAAC,QAAQC,EAAW,eAAe,EAGlD,EAAE,KAAK,CAAC,QAAQH,GAAM,EACxB,CAMV,8BAA6C,CAChB,KAAK,QAAQ,QAAQ,KAAK,IAAID,EAAO,kBAAkB,CAC/D,MAAM,EAAgB,IAAyB,CAC5D,IAAM,EAAS,EAAE,EAAQ,CACzB,EAAO,KAAK,OAAQ,QAAQ,CAER,EAAO,KAAK,IAAIA,EAAO,aAAa,CAC5C,MAAM,EAA0B,IAAmC,CACvD,EAAE,EAAkB,CAEnC,KAAK,OAAQ,SAAS,CACtB,KAAK,WAAY,IAAI,EAC5B,EACJ,CAMN,yBAAiC,EAA+B,CAEtC,KAAK,QAAQ,QAAQ,KAAK,8BAA8B,CAChE,MAAM,EAAgB,IAAyB,CACzD,IAAM,EAAU,EAAE,EAAQ,CAEtB,CAAC,EAAQ,KAAK,OAAO,EAAI,EAAQ,SAAS,aAAa,GAAK,UAC5D,EAAQ,KAAK,OAAQ,SAAS,CAG9B,CAAC,EAAQ,KAAK,aAAa,EAAI,CAAC,EAAQ,KAAK,QAAQ,GACjD,EAAQ,SAASA,EAAO,SAAS,CACjC,EAAQ,KAAK,aAAc,EAAS,cAAgB,EAAS,WAAW,CACjE,EAAQ,SAAS,gBAAgB,EACxC,EAAQ,KAAK,aAAc,EAAS,WAAW,EAInD,EAAQ,SAASA,EAAO,SAAS,EAAI,EAAQ,SAAS,aAAa,EACnE,EAAQ,KAAK,gBAAiB,OAAO,EAE3C,CAGsB,KAAK,QAAQ,QAAQ,KAAK,IAAIA,EAAO,iBAAiB,CAC9D,MAAM,EAAgB,IAAyB,CAC3D,IAAM,EAAU,EAAE,EAAQ,CACtB,CAAC,EAAQ,KAAK,OAAO,EAAI,EAAQ,SAAS,aAAa,GAAK,UAC5D,EAAQ,KAAK,OAAQ,SAAS,CAE9B,CAAC,EAAQ,KAAK,aAAa,EAAI,CAAC,EAAQ,KAAK,QAAQ,EACrD,EAAQ,KAAK,aAAc,EAAS,YAAY,EAEtD,CAGF,KAAK,qBAAqBI,EAAW,yBAA0B,EAAS,yBAAyB,CAGjG,KAAK,qBAAqBA,EAAW,wBAAyB,EAAS,wBAAwB,CAGvE,KAAK,QAAQ,QAAQ,KAAK,IAAIA,EAAW,eAAe,GAAG,CACnE,MAAM,EAAgB,IAAyB,CAC3D,IAAM,EAAU,EAAE,EAAQ,CAC1B,EAAQ,KAAK,aAAc,EAAS,eAAe,CACnD,EAAQ,KAAK,QAAS,EAAS,eAAe,EAChD,CAMN,qBAA6B,EAAmB,EAAqB,CACjD,KAAK,QAAQ,QAAQ,KAAK,IAAI,EAAU,GAAG,CACnD,MAAM,EAAgB,IAAyB,CACnD,IAAM,EAAU,EAAE,EAAQ,CACtB,CAAC,EAAQ,KAAK,OAAO,EAAI,EAAQ,SAAS,aAAa,GAAK,UAC5D,EAAQ,KAAK,OAAQ,SAAS,CAE9B,CAAC,EAAQ,KAAK,aAAa,EAAI,CAAC,EAAQ,KAAK,QAAQ,GACrD,EAAQ,KAAK,aAAc,EAAM,CACjC,EAAQ,KAAK,QAAS,EAAM,GAElC,CAMN,2BAA0C,CACT,KAAK,QAAQ,QAAQ,KAAK,IAAIJ,EAAO,4BAA4B,CACzE,MAAM,EAAgB,IAAyB,CAChE,IAAM,EAAa,EAAE,EAAQ,CAC7B,EACK,KAAK,OAAQ,SAAS,CACtB,KAAK,WAAY,IAAI,CAI1B,IAAM,EAFS,EAAW,QAAQ,IAAIA,EAAO,SAAS,CAC5B,SAASA,EAAO,SAAS,CACxB,mBAAqB,iBAChD,EAAW,KAAK,aAAc,EAAM,EACtC,CAMN,wBAAuC,CACnC,IAAM,EAAM,KAAK,QAAQ,YAAY,CAAC,IAChC,EAAmB,KAAK,QAAQ,QAAQ,KAAK,IAAII,EAAW,iBAAiB,GAAG,CAChF,EAAoB,KAAK,QAAQ,QAAQ,KAAK,IAAIA,EAAW,kBAAkB,GAAG,CAElF,EAAW,IAAQ,MAAQ,eAAiB,cAC5C,EAAY,IAAQ,MAAQ,cAAgB,eAElD,EAAiB,KAAK,aAAc,EAAS,CAC7C,EAAiB,KAAK,QAAS,EAAS,CAExC,EAAkB,KAAK,aAAc,EAAU,CAC/C,EAAkB,KAAK,QAAS,EAAU,CAM9C,oBAA4B,EAA+B,CACpC,KAAK,QAAQ,QAAQ,KAAK,IAAIJ,EAAO,aAAa,CAC1D,KAAK,WAAW,CAAC,KAAK,aAAc,EAAS,gBAAgB,CAM5E,uBAAuB,EAA+B,CAC1B,EAAU,KAAK,IAAII,EAAW,gBAAgB,GAAG,CACzD,MAAM,EAAgB,IAAyB,CAC3D,IAAM,EAAU,EAAE,EAAQ,CACtB,CAAC,EAAQ,KAAK,OAAO,EAAI,EAAQ,SAAS,aAAa,GAAK,UAC5D,EAAQ,KAAK,OAAQ,SAAS,CAE9B,CAAC,EAAQ,KAAK,aAAa,EAAI,CAAC,EAAQ,KAAK,QAAQ,GACrD,EAAQ,KAAK,aAAc,uBAAuB,CAClD,EAAQ,KAAK,QAAS,uBAAuB,GAEnD,CAMN,8BAA8B,EAAyB,EAA2B,CAC9E,IAAM,EAAQ,EAAa,mBAAqB,iBAChD,EAAU,KAAK,aAAc,EAAM,CAMvC,cAAc,EAAkB,EAAsB,CAClD,GAAI,CAAC,EAAE,EAAE,OAAO,CAAC,QAAQ,KAAK,QAAQ,QAAQ,CAAC,OAC3C,OAAO,KAGX,IAAM,EAAS,EAAE,EAAE,OAAO,CACpB,EAAM,EAAE,SAAW,EAAE,MAyB3B,MAvBA,IAAa,GACb,GAAa,EAAE,SAEX,EAAO,SAASJ,EAAO,OAAO,EAC9B,KAAK,oBAAoB,EAAG,EAAI,CAGhC,EAAO,SAASA,EAAO,WAAW,EAClC,KAAK,8BAA8B,EAAG,EAAI,CAG1C,EAAO,SAASA,EAAO,0BAA0B,EACjD,KAAK,iCAAiC,EAAG,EAAK,EAAO,CAGrD,EAAO,SAAS,gBAAgB,EAChC,KAAK,0BAA0B,EAAG,EAAK,EAAW,CAGlD,EAAO,QAAQ,4BAA4B,CAAC,QAC5C,KAAK,8BAA8B,EAAG,EAAI,CAGvC,KAMX,oBAA4B,EAAkB,EAAmB,CAC7D,IAAM,EAAgB,EAAE,EAAE,OAAO,CAEjC,GAAI,EAAc,KAAK,IAAIA,EAAO,kBAAkB,CAAC,OAAS,EAC1D,OAIJ,IAAM,EADa,KAAK,QAAQ,QAAQ,KAAK,IAAIA,EAAO,SAAS,CACtC,OAAO,UAAW,CACzC,OAAO,EAAE,KAAK,CAAC,KAAK,IAAIA,EAAO,kBAAkB,CAAC,SAAW,GAC/D,CAEI,EAAe,EAAQ,MAAM,EAAc,CAC3C,EAAO,KAAK,QAAQ,aAAa,KAEvC,OAAQ,EAAR,CACI,KAAK,EAAK,GACN,EAAE,gBAAgB,CAClB,KAAK,mBAAmB,EAAS,EAAe,EAAE,CAClD,MACJ,KAAK,EAAK,KACN,EAAE,gBAAgB,CAClB,KAAK,mBAAmB,EAAS,EAAe,EAAE,CAClD,MACJ,KAAK,EAAK,KACN,EAAE,gBAAgB,CAClB,KAAK,mBAAmB,EAAS,EAAE,CACnC,MACJ,KAAK,EAAK,IACN,EAAE,gBAAgB,CAClB,KAAK,mBAAmB,EAAS,EAAQ,OAAS,EAAE,CACpD,OAOZ,mBAA2B,EAAuB,EAAqB,CACnE,GAAI,EAAQ,SAAW,GAAK,EAAQ,GAAK,GAAS,EAAQ,OACtD,OAGJ,IAAM,EAAe,EAAQ,GAAG,EAAM,CACtC,EAAa,KAAK,sBAAuB,OAAO,CAChD,EAAa,OAAO,CACpB,EAAa,WAAW,sBAAsB,CAMlD,iCAAyC,EAAkB,EAAa,EAA4B,CAChG,IAAM,EAAO,KAAK,QAAQ,aAAa,KAEvC,GAAI,IAAQ,EAAK,OAAS,IAAQ,EAAK,SAAU,CAC7C,EAAE,gBAAgB,CAClB,EAAO,QAAQG,EAAM,CAErB,IAAM,EADS,EAAO,QAAQ,IAAIH,EAAO,SAAS,CACxB,SAASA,EAAO,SAAS,CACnD,KAAK,8BAA8B,EAAQ,CAAC,EAAW,EAQ/D,0BAAkC,EAAkB,EAAa,EAAuB,EAMxF,8BAAsC,EAAkB,EAAmB,CACvE,IAAM,EAAO,KAAK,QAAQ,aAAa,MAEnC,IAAQ,EAAK,OAAS,IAAQ,EAAK,YACnC,EAAE,gBAAgB,CAClB,EAAE,EAAE,OAAO,CAAC,QAAQG,EAAM,ICrXzB,GAAb,MAAa,UAAuB,CAAO,qBACtB,CACb,KAAM,iBACT,CAOD,YAAY,EAAuB,EAAc,CAC7C,MAAM,EAAS,EAAE,OAAO,GAAM,EAAE,CAAE,EAAe,QAAS,EAAQ,CAAC,CAEnE,KAAK,mBAAmB,CACxB,KAAK,QAAQ,CACb,KAAK,cAAc,CAMvB,QAAuB,CACnB,IAAM,EAAkB,KAAK,QAAQ,KAAK,eAAe,CACrD,GACA,EAAgB,SAAS,CAG7B,IAAM,EAAiB,EAAE,OAAO,EAAE,CAAE,KAAK,QAAS,CAC9C,SAAU,OACb,CAAC,CACF,OAAO,EAAe,KAEtB,KAAK,QAAU,IAAI,MAAM,GAAG,QAAQ,KAAK,QAAS,EAAe,CAMrE,mBAAkC,CAC9B,IAAM,EAAS,KAAK,QAAgB,MAChC,GACA,EAAM,QAAS,GAAc,CACzB,EAAK,WAAa,EAAK,YAAc,EAAE,CAEvC,IAAM,EAAY,EAAK,WAAW,cAElC,EAAK,WAAW,gBAAkB,EAAK,KAAK,aAAa,CACzD,EAAK,WAAW,cAAgB,GAAa,EAAK,KAClD,EAAK,KAAO,SACZ,EAAK,SAAW,OAChB,EAAK,SAAW,SAClB,CAOV,cAA6B,CACzB,KAAK,QAAQ,KAAKE,EAAO,KAAK,QAAQ,KAAK,KAAK,CAAC,CAMrD,QAAgB,EAAc,CAC1B,IAAM,EAAU,EAAE,OAAO,QAAQC,IAAMC,EAAO,QAAQ,CAChD,EAAU,EAAE,OAAO,KAAK,UAAU,CAEpC,GACA,KAAK,eAAe,EAAS,EAAE,OAAQ,EAAQ,CAOvD,eAAuB,EAAiB,EAAoB,EAA6B,CACrF,KAAK,QAAQ,UAAW,CAAE,KAAM,EAAS,OAAM,UAAS,CAAC,CAG7D,SAAgB,CACZ,AAEI,KAAK,WADL,KAAK,QAAQ,SAAS,CACP,MAGnB,KAAK,QAAQ,OAAO,GCvFf,GAAb,MAAa,UAAiB,CAAO,qBAChB,CACb,KAAM,eACN,MAAO,EAAE,CACZ,CAOD,YAAY,EAAuB,EAAc,CAC7C,MAAM,EAAS,EAAE,OAAO,GAAM,EAAE,CAAE,EAAS,QAAS,EAAQ,CAAC,CAE7D,KAAK,sBAAsB,CAC3B,KAAK,sBAAsB,CAM/B,sBAAqC,CACjC,KAAK,eAAiB,IAAI,MAAM,GAAG,eAAe,KAAK,QAAS,CAC5D,MAAQ,KAAK,QAAgB,MAC7B,SAAU,OACV,KAAMC,EAAM,eACf,CAAC,CAEF,KAAK,eACA,KAAK,QAAS,KAAK,QAAQ,KAAK,KAAK,CAAC,CACtC,KAAK,OAAQ,KAAK,OAAO,KAAK,KAAK,CAAC,CACpC,KAAK,QAAS,KAAK,QAAQ,KAAK,KAAK,CAAC,CAM/C,sBAAqC,CAChC,KAAK,QAAgB,MAAM,QAAS,GAAc,CAC/C,EAAK,WAAa,EAAK,YAAc,EAAE,CACvC,EAAK,WAAW,gBAAkB,EAAK,KAAK,aAAa,CACzD,EAAK,GAAK,EAAK,KAAK,aAAa,EACnC,CAMN,QAAgB,EAAc,CAC1B,IAAM,EAAU,EAAE,GACZ,EAAO,EAAE,EAAE,OAAO,QAAQ,CAAC,QAAQC,IAAMC,EAAO,KAAK,CACrD,EAAU,EAAE,EAAE,OAAO,QAAQ,CAAC,QAAQD,IAAMC,EAAO,QAAQ,CAE7D,GACA,KAAK,eAAe,EAAS,EAAE,EAAE,OAAO,QAAQ,CAAE,EAAM,EAAQ,CAOxE,OAAe,EAAc,CACzB,IAAI,EAAY,GACV,EAAS,EAAE,EAAE,OAAO,QAAQ,EAE9B,EAAO,QAAQD,IAAMC,EAAO,eAAe,CAAC,QAAU,EAAO,KAAKD,IAAMC,EAAO,gBAAgB,CAAC,UAChG,EAAE,gBAAgB,CAClB,EAAY,IAGhB,KAAK,UAAU,EAAQ,EAAU,CAMrC,QAAgB,EAAc,CAC1B,IAAM,EAAS,EAAE,EAAE,OAAO,QAAQ,CAC5B,EAAU,EAAO,QAAQD,IAAMC,EAAO,QAAQ,CACpD,KAAK,UAAU,EAAQ,GAAM,CAC7B,KAAK,QAAQ,QAAS,CAAE,UAAS,CAAC,CAMtC,eAAuB,EAAiB,EAAc,EAAc,EAAuB,CACvF,KAAK,QAAQ,UAAW,CAAE,KAAM,EAAS,OAAM,OAAM,UAAS,CAAC,CAMnE,UAAkB,EAAgB,EAAuB,CACrD,IAAM,EAAS,EAAO,QAAQD,IAAMC,EAAO,OAAO,CAE9C,EACA,EAAO,SAASA,EAAO,OAAO,CAE9B,EAAO,YAAYA,EAAO,OAAO,CAIzC,SAAgB,CACZ,AAEI,KAAK,kBADL,KAAK,eAAe,SAAS,CACP,MAG1B,MAAM,SAAS,GC/GV,GAAb,KAA2D,CAKvD,YACI,EACA,EACA,EACF,CAHU,KAAA,EAAA,EACA,KAAA,QAAA,EACA,KAAA,aAAA,EAER,KAAK,cAAgB,KAAK,oBAAoB,CAC9C,KAAK,UAAY,SAAS,cAAc,IAAI,CAC5C,KAAK,kBAAoB,aAAc,KAAK,WAAa,CAAC,KAAK,QAAQ,QAAQ,KAMnF,oBAA2C,CACvC,MAAO,CACH,MAAO,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAO,CAC/G,MAAO,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,MAAO,QAAS,OAAQ,OAAQ,OAAQ,OAAQ,OAChG,MAAO,OAAQ,OAAQ,OAAO,CACtC,MAAO,CAAC,MAAO,OAAQ,QAAS,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,QACxF,OAAQ,OAAQ,MAAO,OAAQ,OAAQ,QAAS,OAAQ,QAAQ,CACxE,IAAK,CAAC,OAAQ,QAAS,OAAQ,SAAU,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,QAAS,OAAQ,OAAO,CACzG,aAAc,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,QAAQ,CACvD,KAAM,CAAC,OAAQ,OAAQ,QAAQ,CAC/B,YAAa,wJAE0B,CACvC,IAAK,CAAC,OAAO,CACb,OAAQ,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,UAAW,OAAQ,OAAO,CACnF,IAAK,CAAC,MAAO,OAAQ,MAAO,QAAS,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,UAAW,KAAM,OAAQ,QAAQ,CAC9G,aAAc,CAAC,OAAQ,OAAQ,SAAU,OAAQ,OAAQ,OAAQ,OAAO,CAC3E,CAML,IAAI,cAA6B,CAC7B,OAAO,KAAK,cAMhB,aAAa,EAA+B,EAA8B,CACtE,IAAM,EAAc,KAAK,cACnB,EAAS,OAAO,KAAK,EAAY,CACjC,EAAO,OAEb,GAAI,IAAc,QAAa,CAAC,EAAU,OACtC,OAAO,EAGX,IAAI,EAAgB,EAAU,aAAa,CACtC,EAAc,WAAW,IAAI,GAC9B,EAAgB,IAAM,GAG1B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAO,OAAQ,GAAK,EAGpC,GAFmB,EAAY,EAAO,IAEvB,QAAQ,EAAc,CAAG,GACrC,OAAO,EAAa,QAAU,EAAO,GAAK,EAAO,GAIxD,OAAO,EAMX,mBAAmB,EAAsB,CACrC,IAAM,EAAQ,CAAC,QAAS,KAAM,KAAM,KAAM,KAAK,CAE/C,GAAI,IAAS,EACT,MAAO,SAGX,IAAM,EAAI,SAAS,OAAO,KAAK,MAAM,KAAK,IAAI,EAAK,CAAG,KAAK,IAAI,KAAK,CAAC,CAAC,CAAE,GAAG,CAC3E,OAAO,KAAK,MAAM,EAAgB,MAAM,EAAG,CAAG,IAAM,EAAM,GAM9D,YAAoB,EAAiB,EAAkB,EAAkB,EAA4B,CACjG,IAAM,EAAI,KAAK,EACT,EAAO,EAAE,SAAS,CAAC,KAAK,CAC1B,OAAQ,EACR,OAAQ,OACR,OAAQ,EACX,CAAC,CAEI,EAA+B,KAAK,aAAa,mBAAmB,CAC1E,EAAK,SAAW,EAEhB,IAAM,EAAQ,EAAQ,MAAM,WAAW,CAIvC,IAAK,IAAM,IAHX,GAAK,YAAc,EAAM,GAAG,QAAQ,QAAS,GAAG,CAChD,EAAK,OAAS,EAAM,GAED,EACX,OAAO,UAAU,eAAe,KAAK,EAAM,EAAK,EAChD,EAAE,UAAU,CAAC,KAAK,CACd,MAAO,EAAK,GACN,OACN,KAAM,SACT,CAAC,CAAC,SAAS,EAAK,CAIzB,EAAK,SAAS,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAM3C,WAAmB,EAAwB,EAAwB,CAC/D,IAAI,EAAa,EAEjB,GAAI,OAAO,GAAY,SAAU,CAC7B,IAAM,EAAQ,EAAQ,MAAM,WAAW,CACjC,EAAc,EAAM,GACpB,EAAS,KAAK,EAAM,GAAG,CACvB,EAAQ,IAAI,WAAW,EAAO,OAAO,CAE3C,IAAK,IAAI,EAAM,EAAG,EAAM,EAAO,OAAQ,IACnC,EAAM,GAAO,EAAO,WAAW,EAAI,CAEvC,EAAO,IAAI,KAAK,CAAC,EAAM,OAAO,CAAE,CAAE,KAAM,EAAa,CAAC,CAGzD,UAAkB,WAAW,EAAM,EAAS,CAMjD,cAAsB,EAAwB,EAAwB,CAClE,IAAI,EAAc,EAEd,OAAO,MAAQ,aAAmB,OAClC,EAAM,IAAI,gBAAgB,EAAQ,EAGtC,KAAK,UAAU,SAAW,EAC1B,KAAK,UAAU,KAAO,EAEtB,IAAM,EAAI,SAAS,YAAY,cAAc,CAC7C,EAAE,eAAe,QAAS,GAAM,GAAO,OACnC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAO,GAAO,GAAO,GAAO,EAAG,KAAK,CAEvD,KAAK,UAAU,cAAc,EAAE,CAC/B,WAAW,UAAW,CAClB,IAAI,gBAAgB,EAAI,EAC1B,CAMN,OAAO,EAA8B,CAEjC,IAAI,EAAe,KAAK,YAAY,KAAK,KAAK,CAEzC,EAAQ,aACL,KAAK,kBACL,EAAO,KAAK,cAAc,KAAK,KAAK,CAC5B,UAAkB,aAC1B,EAAO,KAAK,WAAW,KAAK,KAAK,GAIzC,EAAK,EAAQ,QAAS,EAAQ,SAAU,EAAQ,SAAU,EAAQ,YAAY,GC/KtF,IAAa,IACT,EACA,EACA,EAAc,EAAO,EAAY,GAE1B,IAAI,MAAM,GAAG,OAAO,QAAS,CAChC,KAAM,QACN,MAAO,EACP,IAAK,EAAY,OAAO,GAAW,GAAG,CACzC,CAAC,CAAC,QAAQ,GAAG,UAML,OACF,eAAeC,EAAO,gBAAgB;;;;YAWpC,IACT,EACA,EACA,EAAiB,GACjB,EAAc,EAAO,EAAY,CACjC,EAAmB,EAAO,GAAiB,GAClC,CACT,IAAM,EAAkB,EAClB,IAAI,MAAM,GAAG,OAAO,oBAAoBC,EAAW,gBAAgB,GAAI,CACrE,KAAMC,EAAM,EACZ,SAAU,OACV,KAAM,QACT,CAAC,CAAC,QAAQ,GAAG,UACZ,GAGA,EAAqB,GAAkB,CAAC,EACxC,IAAI,MAAM,GAAG,OAAO,kBAAkBF,EAAO,WAAW,IAAIC,EAAW,eAAe,GAAI,CACxF,KAAMC,EAAM,eACZ,SAAU,OACV,KAAM,QACT,CAAC,CAAC,QAAQ,GAAG,UACZ,GAEN,MAAO,cAAcF,EAAO,KAAK,cAAc,EAAY,OAAO,EAAK,IAAI,CAAC;UACtE,MAAM,GAAG,KAAK,CAAE,KAAM,EAAiB,aAAa,EAAK,UAAW,GAAK,CAAE,KAAM,SAAU,CAAC,CAAC;sBACjFA,EAAO,SAAS;2BACXA,EAAO,SAAS,IAAI,EAAY,OAAO,EAAK,KAAK,CAAC;2BAClDA,EAAO,SAAS,IAAI,EAAY,OAAO,EAAiB,mBAAmB,EAAK,KAAK,CAAC,CAAC;;UAExG,EAAgB;UAChB,EAAmB;YCzDhB,IACT,EACA,EACA,EACA,EACA,EAA8B,EAAkB,WACvC,CACT,GAAI,CAAC,GAAO,OACR,MAAO,GAGX,IAAI,EAAY,GAChB,EAAM,QAAQ,GAAQ,CAClB,GAAa,GAAW,EAAM,GAAe,GAAO,GAAK,EAC3D,CAEF,IAAI,EAAc,GACd,IAAe,EAAkB,SACjC,EAAc,IAAIG,EAAO,gBAClB,IAAe,EAAkB,OACxC,EAAc,IAAIA,EAAO,aAG7B,IAAI,EAAO,cAAcA,EAAO,cAAc,EAAY,IAAIC,EAAW,YAAY,GAoBrF,OAlBI,IAAe,EAAkB,WACjC,GAAQ,eAAeD,EAAO,YAAY,IAAI,EAAU,QAExD,GAAQ,EAGZ,GAAQ,QAEJ,GAAe,EAAM,OAAS,GAAK,GAAU,cAC7C,GAAQ,eAAeA,EAAO,sBAAsB;cAC9C,IAAI,MAAM,GAAG,OAAO,kBAAkBA,EAAO,eAAe,IAAI,EAAS,YAAY,WAAY,CAC/F,KAAME,EAAM,SACZ,SAAU,OACV,KAAM,QACT,CAAC,CAAC,QAAQ,GAAG,UAAU;iBAIzB,GA6DE,IACT,EAUA,EAAc,EAAO,EAAY,GACxB,CACT,GAAM,CACF,OACA,QACA,eACA,eACA,YACA,oBACA,uBACA,YACA,EAEE,EAA8B,EAC9BF,EAAO,uBACPA,EAAO,yBACP,EAA2B,EAAeA,EAAO,cAAgB,GACjE,EAAuB,EACvBC,EAAW,yBACXA,EAAW,wBACX,EAAmB,EACnBA,EAAW,2BACXA,EAAW,6BAEb,EAAU,EAAY,qBAAqB,GAAQ,GAAG,CAY1D,MAVA,CACI,IAAU,GAAO,OAAS,GAAW,EAAM,GAAI,GAAO,GAAwB,GAAM,CAAG,GAGvF,GAAa,IACb,EAAU,EACJ,EAAY,OAAO,EAAS,mBAAmB,CAC/C,EAAY,OAAO,EAAS,oBAAoB,EAGnD,eAAeD,EAAO,iBAAiB,GAAG,EAA4B,GAAG,EAAyB,IAAI,EAAiB;UACxH,EAAe,MAAM,GAAG,KAAK,CAAE,KAAME,EAAM,IAAK,KAAM,SAAU,CAAC,CAAG,GAAG;sBAC3DF,EAAO,wBAAwB,IAAI,EAAQ;uBAC1CA,EAAO,OAAO;UAC3B,EAAoB,IAAI,MAAM,GAAG,OAAO,WAAW,EAAqB,GAAI,CAC1E,KAAME,EAAM,EACZ,SAAU,OACb,CAAC,CAAC,QAAQ,GAAG,UAAY,GAAG;aCnK/B,GAAwB,oBACxB,GAAgB,gDAChB,GAAc,MAgBpB,IAAa,GAAb,MAAa,CAAmD,CAC5D,YAAY,EAAyC,CAAjC,KAAA,eAAA,EAEpB,OAAO,EAAgB,EAAgB,EAAoC,CACvE,IAAM,EAAkB,EAClB,KAAK,eAAe,WAAW,EAAQ,CACvC,KAAK,eAAe,SAAS,CAE/B,EAAiC,EAAgB,aACjD,EAAU,EAAaC,KACvB,EAAY,EAAa,SACzB,EAAU,EAAa,QAAQ,GAC7B,EAAqB,EAAE,CACzB,EACA,EACA,EACA,EACA,EACA,EAAW,EAAS,EACpB,EACA,EACA,EACA,EAAgB,GAChB,EACA,EACA,EACA,EACA,EACA,EAAQ,GACR,EAGJ,GAAI,IAAW,OACX,MAAO,GAGX,GAAI,CAAC,SAAS,EAAO,CACjB,OAAO,OAAO,EAAO,CAIzB,GAAI,CAAC,EACD,OAAO,EAAgB,KAAK,OAAS,EAAO,gBAAgB,CAAG,EAAO,UAAU,CAMpF,GAHA,EAAqB,GAAsB,KAAK,EAAO,CAGnD,EAAoB,CAsBpB,GArBA,EAAS,EAAmB,GAAG,aAAa,CAE5C,EAAa,IAAW,IACxB,EAAY,IAAW,KAEnB,GAAc,KAEd,EAAe,EAAa,EAAa,SAAW,EAAa,QACjE,EAAU,EAAaA,KACvB,EAAY,EAAa,SACzB,EAAS,EAAa,OACtB,EAAU,EAAa,QAAQ,EAAW,EAAI,IAGlD,EAAkB,EAAmB,GAEjC,IACA,EAAY,CAAC,GAIb,IAAW,IAEX,OADY,EAAkB,EAAO,cAAc,EAAU,CAAG,EAAO,eAAe,EAC3E,QAAQA,IAAK,EAAaA,KAAK,CAI1C,IACA,GAAU,KAGd,IAAM,EAAU,KAAK,MAAM,EAAQ,EAAU,CAC7C,EAAW,WAAW,EAAQ,CAAG,EACjC,IAAM,EAAQ,EAAQ,MAAMA,IAAI,CAgBhC,GAdA,EAAU,EAAM,GAChB,EAAW,EAAM,GAGb,IACA,EAAU,EAAQ,UAAU,EAAE,EAGlC,EAAQ,KAAK,aAAa,EAAS,EAAG,EAAQ,OAAQ,EAAa,CAE/D,IACA,GAAS,EAAU,GAGnB,IAAW,KAAO,CAAC,EACnB,OAAO,EAGX,IAAI,EAAS,GAEb,IAAK,IAAI,EAAM,EAAG,EAAM,EAAQ,OAAQ,EAAM,EAAK,IAAO,CACtD,IAAM,EAAK,EAAQ,OAAO,EAAI,CAE1B,IAAO,IACP,GAAU,EACH,IAAO,KAAO,IAAO,IAC5B,GAAU,EAEV,GAAU,EAIlB,OAAO,EAKX,EAAS,KAAK,gBAAgB,EAAQ,EAAS,CAE/C,IAAM,EAAiB,EAAO,MAAM,IAAI,CAClC,EAAsB,KAAK,oBAAoB,EAAgB,EAAU,EAAO,CAItF,GAHA,EAAS,EAAoB,OAC7B,EAAoB,EAAoB,kBAEpC,EAAoB,aACpB,OAAO,EAGX,IAAI,EAAe,EAAO,QAAQ,IAAI,CAClC,EAAgB,EAAO,QAAQ,IAAI,CAEvC,EAAY,IAAiB,GAC7B,EAAa,IAAkB,GAG3B,IACA,GAAU,KAGV,GAAc,EAAO,EAAgB,KAAO,OAC5C,EAAS,EAAO,MAAM,KAAK,CAAC,KAAK,GAAG,CACpC,EAAa,KAGb,GAAc,KAEd,EAAe,EAAa,EAAa,SAAW,EAAa,QACjE,EAAU,EAAaA,KACvB,EAAY,EAAa,SACzB,EAAS,EAAa,QAG1B,EAAW,EAAO,QAAQC,IAAM,CAAG,GAC/B,IACA,EAAS,EAAO,QAAQ,GAAa,GAAM,EAG/C,IAAM,EAAgB,KAAK,0BAA0B,EAAQ,EAAQ,EAAS,CAC9E,EAAS,EAAc,OACvB,EAAe,EAAc,aAC7B,EAAS,EAAc,OACvB,IAAM,EAAgB,EAAc,OAE9B,EAAiB,KAAK,yBAAyB,EAAO,CAS5D,GARA,EAAQ,EAAe,MACvB,EAAM,EAAe,IACrB,EAAY,EAAe,UAEvB,IAAU,IACV,EAAM,GAGN,IAAU,GAAI,CACd,IAAM,EAAa,EAAc,UAAU,CAAC,MAAMD,IAAI,CACtD,EAAU,EAAW,GACrB,EAAW,EAAW,IAAM,GAE5B,EAAgB,EAAQ,OAEpB,GAAa,WAAW,EAAc,CAAG,IAAO,IAChD,EAAW,IAGf,IAAI,EAAS,KAAK,qBACd,EAAQ,EAAO,EAAK,EAAQ,EAAU,EACtC,EAAc,EAAS,EAAU,EAAS,EAC7C,CAuBD,OArBI,IACA,EAAS,KAAK,aACV,EACA,GAAS,GAAY,CAAC,EAAoB,EAAI,GAC9C,KAAK,IAAI,EAAM,EAAgB,EAAO,CACtC,EACH,EAGD,GAAO,IACP,GAAU,EAAO,UAAU,EAAM,EAAE,GAGnC,GAAc,KACd,EAAS,KAAK,eAAe,EAAQ,EAAQ,EAG7C,EAAS,SACT,EAAS,KAAK,gBAAgB,EAAQ,EAAS,EAG5C,EAGX,OAAO,OAAO,EAAc,CAGhC,eAAuB,EAAgB,EAAwB,CAC3D,IAAI,EAAQ,GACZ,IAAK,IAAI,EAAM,EAAG,EAAM,EAAO,OAAQ,EAAM,EAAK,IAAO,CACrD,IAAM,EAAK,EAAO,OAAO,EAAI,CAC7B,GAAU,IAAO,KAAO,IAAO,IAAO,EAAS,EAEnD,OAAO,EAGX,gBAAwB,EAAgB,EAA4B,CAChE,IAAK,IAAI,EAAM,EAAG,EAAM,EAAS,OAAQ,IACrC,EAAS,EAAO,QAAQ,KAAa,EAAS,GAAK,CAEvD,OAAO,EAGX,qBACI,EAAgB,EAAe,EAAa,EAC5C,EAAmB,EAA4B,EAC/C,EAAiB,EAAkB,EAAiB,EAC9C,CACN,IAAI,EAAS,EAAO,UAAU,EAAG,EAAM,CACnC,EAAc,GACZ,EAAgB,EAAQ,OAE1B,GAAY,CAAC,IACb,GAAU,KAGd,IAAI,EAAM,EACV,KAAO,EAAM,GAAQ,CACjB,IAAM,EAAK,EAAO,OAAO,EAAI,CAE7B,GAAI,IAAiB,GACjB,IAAI,EAAM,EAAM,EAAe,CAC3B,GAAU,EACV,eAGA,IAAc,IAAM,EAAY,IAChC,EAAc,IAGb,EAAe,GAAQ,GAAiB,EAAe,EAAM,KAC9D,GAAU,EACV,EAAM,GAGN,IAAiB,EAAK,CACtB,IAAW,EAAW,EAAU,IAAS,EACzC,GAAO,EAAM,EAAe,EAC5B,SAIJ,IAAO,KACP,GAAU,EACV,EAAc,GACP,IAAO,MACd,GAAU,GAEd,IAGJ,OAAO,EAGX,oBACI,EAA0B,EAAmB,EACwB,CACrE,IAAI,EACA,EAAoB,GACpB,EAAe,GAcnB,OAZI,GAAY,EAAe,IAC3B,EAAS,EAAe,GACxB,EAAoB,IACb,IAAW,GAAK,EAAe,IACtC,EAAS,EAAe,GACpB,EAAO,QAAQ,IAAM,GAAK,IAAM,EAAO,QAAQ,IAAK,GAAK,KACzD,EAAe,KAGnB,EAAS,EAAe,GAGrB,CAAE,SAAQ,oBAAmB,eAAc,CAGtD,0BACI,EAAgB,EAAgB,EACwC,CACxE,IAAI,EAAe,EAAO,QAAQA,IAAI,CAClC,EAAM,EACN,EAAS,EAAO,OAChB,EACA,EACA,EACA,EACA,EACA,EAEJ,GAAI,IAAiB,GAAI,CACrB,IAAM,EAAW,EAAO,UAAU,CAAC,MAAM,IAAI,CAoB7C,GAnBA,AAGI,EAHA,EAAS,GACE,KAAK,MAAM,EAAQ,KAAK,IAAI,SAAS,EAAS,GAAI,GAAG,CAAC,CAAC,CAEvD,EAAS,GAExB,EAAW,EAAS,MAAMA,IAAI,CAAC,IAAM,GACrC,EAAY,EAAO,YAAY,IAAK,CAAG,EACvC,EAAa,EAAO,YAAY,IAAM,CAAG,EACzC,EAAU,EAAY,GACtB,EAAW,EAAa,GACxB,EAAM,EAAS,OAEX,CAAC,GAAW,CAAC,IACb,EAAS,EAAO,UAAU,EAAG,EAAa,CAAG,EAAO,UAAU,EAAe,EAAE,CAC/E,EAAS,EAAO,OAChB,EAAe,GACf,EAAM,GAGN,GAAW,EAAY,EACvB,EAAM,UACC,EAAa,EACpB,GAAI,GAAY,EAAM,EAAY,CAG9B,IAFA,EAAU,KAAK,MAAM,EAAQ,EAAY,EAAS,CAE3C,EAAQ,OAAO,EAAQ,OAAS,EAAE,GAAK,KAAQ,EAAa,GAAK,EAAa,GACjF,IACA,EAAU,KAAK,MAAM,EAAQ,EAAY,EAAS,CAGtD,EAAM,OACC,GAAW,EAAM,IACxB,EAAM,GAKlB,IAAM,EAAe,KAAK,MAAM,EAAQ,EAAK,EAAS,CAEtD,MAAO,CAAE,SAAQ,eAAc,SAAQ,OAAQ,EAAc,CAGjE,yBAAiC,EAAmE,CAChG,IAAI,EAAa,EAAO,QAAQ,IAAM,CAChC,EAAiB,EAAO,QAAQ,IAAK,CACvC,EACA,EACA,EAqBJ,MAnBA,CAKI,EALA,IAAe,IAAM,IAAmB,GAChC,EACD,IAAe,IAAM,IAAmB,GACvC,EAEA,EAAa,EAAiB,EAAiB,EAG3D,EAAa,EAAO,YAAY,IAAM,CACtC,EAAY,EAAO,YAAY,IAAK,CAEpC,AAKI,EALA,IAAe,IAAM,IAAc,GAC7B,EACC,IAAe,IAAM,IAAc,IAGpC,EAAa,EAFb,EAEsC,EAGzC,CAAE,QAAO,MAAK,YAAW,CAGpC,gBAAwB,EAAgB,EAA4B,CAShE,OARI,EAAO,QAAQ,IAAI,CAAG,IAAM,EAAO,QAAQ,IAAI,CAAG,IAAM,EAAO,QAAQ,KAAK,CAAG,MAC/E,EAAS,EAAO,QAAQ,GAAgB,GAAU,CAC9C,IAAM,EAAY,EAAM,OAAO,EAAE,CAAC,QAAQ,KAAM,GAAG,CAC7C,EAAU,EAAM,MAAM,EAAE,CAAC,QAAQ,EAAW,GAAG,CAErD,OADA,EAAS,KAAK,EAAQ,CACf,MACT,EAEC,EAGX,aAAqB,EAAgB,EAAe,EAAa,EAAwC,CACrG,IAAM,EAAe,EAAO,QAAQ,EAAaA,KAAK,CAChD,EAAa,EAAa,UAAU,OAAO,CAC7C,EAAY,EAAW,OAAO,CAC9B,EACA,EACA,EACA,EACA,EACA,EAOJ,GALA,EAAM,IAAiB,GAAoB,EAAM,EAArB,EAE5B,EAAU,EAAO,UAAU,EAAO,EAAI,CACtC,EAAgB,EAAQ,OAEpB,GAAiB,EAAW,CAI5B,IAHA,EAAM,EACN,EAAQ,EAAE,CAEH,EAAM,IAST,GARA,EAAQ,EAAQ,UAAU,EAAM,EAAW,EAAI,CAC3C,GACA,EAAM,KAAK,EAAM,CAErB,GAAO,EACP,EAAe,EAAW,OAAO,CACjC,EAAY,IAAiB,OAA2B,EAAf,EAErC,IAAc,EAAG,CACb,EAAM,GACN,EAAM,KAAK,EAAQ,UAAU,EAAG,EAAI,CAAC,CAEzC,MAIR,EAAU,EAAM,SAAS,CAAC,KAAK,EAAaC,KAAO,CACnD,EAAS,EAAO,UAAU,EAAG,EAAM,CAAG,EAAU,EAAO,UAAU,EAAI,CAGzE,OAAO,EAMX,MAAM,EAAe,EAAmB,EAA4B,CAChE,OAAO,EAAuB,MAAM,EAAO,EAAW,EAAS,CAMnE,OAAO,MAAM,EAAe,EAAmB,EAA4B,CACvE,IAAyB,EAEzB,IAAI,EAAQ,EAAM,UAAU,CAAC,MAAM,IAAI,CACnC,EAAU,KAAK,MAAM,EAAE,EAAM,GAAK,KAAO,EAAM,GAAM,CAAC,EAAM,GAAK,EAAa,IAAY,CAS9F,OAPI,IACA,EAAU,CAAC,GAGf,EAAQ,EAAQ,UAAU,CAAC,MAAM,IAAI,EACtB,EAAE,EAAM,GAAK,KAAO,EAAM,GAAM,CAAC,EAAM,GAAK,EAAa,CAAC,KAE3D,QAAQ,KAAK,IAAI,EAAW,GAAG,CAAC,GCjftD,IACM,GAAe,uBACf,GAAiB,EAAE,CAAC,SAE1B,IAAa,GAAb,KAA2D,CACvD,YACI,EACA,EACF,CAFU,KAAA,gBAAA,EACA,KAAA,cAAA,EAQZ,SAAS,EAAyC,EAAiB,EAA4C,CAC3G,GAAI,EAAQ,CACR,GAAI,GAAe,KAAK,EAAM,GAAK,gBAC/B,OAAO,KAAK,cAAc,OAAO,EAAe,EAAQ,EAAQ,IACzD,OAAO,GAAU,SACxB,OAAO,KAAK,gBAAgB,OAAO,EAAO,EAAQ,EAAQ,CAMlE,OAAO,IAAU,OAAoB,GAAR,EAGjC,OAAO,EAAa,GAAG,EAA2B,CAC9C,OAAO,EAAI,QAAQ,IAAe,EAAG,EAAO,IAAsB,CAC9D,IAAM,EAAQ,EAAO,SAAS,EAAO,GAAG,EAClC,EAAS,KAAK,SAChB,EACA,EAAoB,EAAkB,UAAU,EAAE,CAAG,GACxD,CAGD,OAAO,OAAO,EAAO,EACvB,CAGN,cAAc,EAAwB,CAIlC,OAHI,EAAO,MAAM,EAAG,EAAE,GAAK,QACvB,EAAS,EAAO,MAAM,EAAG,EAAO,OAAS,EAAE,EAExC,EAMX,oBAAuC,CACnC,OAAO,KAAK,gBAMhB,kBAAmC,CAC/B,OAAO,KAAK,cAMhB,OAAO,MAAM,EAAe,EAAmB,EAA4B,CACvE,OAAO,GAAuB,MAAM,EAAO,EAAW,EAAS,GChEvE,IAAa,GAAyC,CAClD,EAAK,MACL,EAAK,OACL,EAAK,UACL,EAAK,UACL,EAAK,QACL,EAAK,QACL,EAAK,MACL,EAAK,UACL,EAAK,UACL,EAAK,UACL,EAAK,OACL,EAAK,OACL,EAAK,OACL,EAAK,OACL,EAAK,SACL,EAAK,SACL,EAAK,YACL,EAAK,YACL,EAAK,OACL,EAAK,OACL,EAAK,OACL,EAAK,OACR,CAcY,GAA6C,CACtD,MAAO,CACH,KAAM,SACN,UAAW,EACX,WAAY,IACf,CACD,QAAS,CACL,KAAM,WACN,UAAW,EACX,WAAY,IACf,CACD,QAAS,CACL,KAAM,OACN,UAAW,CACP,EAAG,EACH,EAAG,EACH,EAAG,EACN,CACD,WAAY,IACf,CACD,UAAW,CACP,KAAM,aACN,UAAW,EACd,CACD,IAAK,CACD,KAAM,OACN,UAAW,EACd,CACJ,CCzDD,IAAa,GAAb,KAA2D,CAKvD,YACI,EACA,EACF,CAFU,KAAA,eAAA,EACA,KAAA,iBAAA,qBANa,qBACF,GAAK,oBACN,MAUtB,UAAU,EAAY,EAAwB,CAK1C,OAJI,IAAU,GAAK,EAAK,UAAU,GAAK,IACnC,EAAK,SAAS,EAAK,UAAU,CAAG,EAAE,CAC3B,IAEJ,GAMX,aAAa,EAAY,EAAa,EAAc,EAAS,CACzD,IAAM,EAAQ,EAAK,UAAU,CAC7B,GAAQ,EAAM,EAAK,QAAQ,CAAK,EAAI,GAAQ,EAC5C,EAAK,QAAQ,EAAK,SAAS,CAAG,EAAI,CAClC,KAAK,UAAU,EAAM,EAAM,CAM/B,UAAU,EAAY,EAAa,EAAoB,CAGnD,MAFA,GAAO,IAAI,KAAK,EAAK,CACrB,KAAK,aAAa,EAAM,EAAK,EAAI,CAC1B,EAMX,gBAAgB,EAAkB,CAC9B,OAAO,IAAI,KACP,EAAK,aAAa,CAClB,EAAK,UAAU,CACf,EACH,CAML,eAAe,EAAkB,CAC7B,IAAM,EAAO,IAAI,KAAK,EAAK,aAAa,CAAE,EAAK,UAAU,CAAG,EAAG,EAAE,CAC3D,EAAQ,KAAK,gBAAgB,EAAK,CAClC,EAAa,KAAK,IAAI,EAAK,mBAAmB,CAAG,EAAM,mBAAmB,CAAC,CAMjF,OAJI,GACA,EAAK,SAAS,EAAM,UAAU,CAAI,EAAa,GAAI,CAGhD,EAMX,eAAe,EAAkB,CAC7B,OAAO,IAAI,KAAK,EAAK,aAAa,CAAE,EAAG,EAAE,CAM7C,cAAc,EAAkB,CAC5B,OAAO,IAAI,KAAK,EAAK,aAAa,CAAE,GAAI,GAAG,CAM/C,oBAA4B,EAAY,EAA4B,CAIhE,OAHI,IAAiB,EAGd,KAAK,QAAQ,EAAO,GAAK,EAAK,QAAQ,EAAI,GAAI,CAF1C,KAAK,QAAQ,KAAK,UAAU,EAAM,EAAc,GAAG,CAAE,EAAE,CAQtE,eAAuB,EAAY,EAA8B,CAC7D,IAAM,EAAkB,IAAI,KAAK,EAAK,aAAa,CAAE,EAAG,EAAG,GAAG,CAExD,EADU,KAAK,oBAAoB,EAAM,EAAa,CACnC,SAAS,CAAG,EAAgB,SAAS,CACxD,EAAO,KAAK,MAAM,EAAW,KAAK,WAAW,CACnD,MAAO,GAAI,KAAK,MAAM,EAAO,EAAE,CAMnC,WAAW,EAAY,EAA+B,CAC9C,IAAiB,SACjB,EAAe,KAAK,eAAe,SAAS,CAAC,SAAS,UAG1D,IAAM,EAAe,KAAK,QAAQ,EAAM,GAAG,CACrC,EAAe,KAAK,QAAQ,EAAM,EAAE,CACpC,EAAa,KAAK,eAAe,EAAM,EAAa,CAU1D,OARI,IAAe,EACR,KAAK,eAAe,EAAc,EAAa,CAAG,EAGzD,IAAe,IAAM,KAAK,eAAe,EAAc,EAAa,CAAG,EAChE,EAGJ,EAMX,QAAQ,EAAkB,CAGtB,MAFA,GAAO,IAAI,KAAK,EAAK,aAAa,CAAE,EAAK,UAAU,CAAE,EAAK,SAAS,CAAE,EAAG,EAAG,EAAE,CAC7E,KAAK,UAAU,EAAM,EAAE,CAChB,EAMX,UAAU,EAAoB,CAC1B,OAAO,KAAK,IACR,EAAK,aAAa,CAClB,EAAK,UAAU,CACf,EAAK,SAAS,CACd,EAAK,UAAU,CACf,EAAK,YAAY,CACjB,EAAK,YAAY,CACjB,EAAK,iBAAiB,CACzB,CAML,gBAAgB,EAAoB,CAChC,OAAO,KAAK,gBAAgB,EAAK,CAAC,SAAS,CAAG,KAAK,QAAQ,KAAK,gBAAgB,EAAK,CAAC,CAAC,SAAS,CAMpG,cAAc,EAAoB,EAAW,EAAoB,CAC7D,IAAI,EAAQ,KAAK,gBAAgB,EAAI,CACjC,EAAQ,KAAK,gBAAgB,EAAI,CAErC,GAAI,CAAC,GAAS,IAAU,EACpB,MAAO,GAGP,GAAO,IACP,GAAS,KAAK,YAGlB,IAAI,EAAU,KAAK,gBAAgB,EAAM,CAUzC,OARI,EAAQ,IACR,GAAW,KAAK,YAGhB,EAAQ,IACR,GAAS,KAAK,YAGX,GAAW,GAAS,GAAW,EAM1C,cAAc,EAAa,EAAW,EAAoB,CACtD,IAAI,EAAQ,EAAI,SAAS,CACrB,EAAQ,EAAI,SAAS,CAErB,GAAS,IACT,GAAS,KAAK,YAGlB,IAAM,EAAU,EAAM,SAAS,CAC/B,OAAO,GAAW,GAAS,GAAW,EAM1C,QAAQ,EAAY,EAAsB,CACtC,IAAM,EAAQ,EAAK,UAAU,CAI7B,MAHA,GAAO,IAAI,KAAK,EAAK,CACrB,KAAK,QAAQ,EAAM,EAAS,KAAK,WAAW,CAC5C,KAAK,UAAU,EAAM,EAAM,CACpB,EAMX,QAAQ,EAAY,EAAsB,EAA2B,CACjE,IAAM,EAAS,EAAK,mBAAmB,CAGvC,GAFA,EAAK,QAAQ,EAAK,SAAS,CAAG,EAAa,CAEvC,CAAC,EAAW,CACZ,IAAM,EAAa,EAAK,mBAAmB,CAAG,EAC9C,EAAK,QAAQ,EAAK,SAAS,CAAG,EAAa,KAAK,cAAc,EAOtE,SAAS,EAAY,EAAkB,CAWnC,MAVA,GAAO,IAAI,KACP,EAAK,aAAa,CAClB,EAAK,UAAU,CACf,EAAK,SAAS,CACd,EAAK,UAAU,CACf,EAAK,YAAY,CACjB,EAAK,YAAY,CACjB,EAAK,iBAAiB,CACzB,CACD,KAAK,UAAU,EAAM,EAAK,UAAU,CAAC,CAC9B,EAMX,OAAc,CACV,OAAO,KAAK,QAAQ,IAAI,KAAO,CAMnC,QAAQ,EAAqB,CACzB,OAAO,KAAK,QAAQ,EAAK,CAAC,SAAS,GAAK,KAAK,OAAO,CAAC,SAAS,CAMlE,gBAAgB,EAAmB,CAC/B,IAAM,EAAa,IAAI,KAAK,KAAM,EAAG,EAAG,EAAG,EAAG,EAAE,CAWhD,OATI,GACA,EAAW,SACP,EAAK,UAAU,CACf,EAAK,YAAY,CACjB,EAAK,YAAY,CACjB,EAAK,iBAAiB,CACzB,CAGE,EAMX,QAAgB,EAAY,EAAsB,CAC9C,IAAM,EAAc,IAAI,KAAK,EAAK,CAClC,OAAO,IAAI,KAAK,EAAY,YAAY,EAAY,aAAa,CAAG,EAAO,CAAC,CAMhF,QAAQ,EAAkB,CACtB,OAAO,KAAK,QAAQ,EAAM,EAAE,CAMhC,YAAY,EAAkB,CAC1B,OAAO,KAAK,QAAQ,EAAM,GAAG,CAMjC,SAAS,EAAkB,CACvB,OAAO,KAAK,QAAQ,EAAM,EAAE,CAMhC,aAAa,EAAkB,CAC3B,OAAO,KAAK,QAAQ,EAAM,GAAG,CAMjC,WAAmB,EAAyB,EAAqB,CAC7D,IAAM,EAAW,EAAM,EAAM,OAAS,GAClC,GAAY,EAAS,OAAS,UAC9B,EAAS,SAAW,EAEpB,EAAM,KAAK,CACP,KAAM,UACN,QAAS,EACZ,CAAC,CAOV,SAAiB,EAA0B,CACvC,OAAO,IAAY,KAAO,IAAY,IAM1C,aAAqB,EAA0C,CAC3D,GAAI,GAAgB,EAChB,MAAO,iBACA,IAAiB,EACxB,MAAO,UACA,IAAiB,EACxB,MAAO,SAQf,WAAmB,EAAc,EAAsB,EAAmB,EAAY,CAClF,OAAO,EAAK,QAAQ,EAAc,EAAS,GAAK,EAMpD,YAAoB,EAA4B,EAAmB,CAC/D,IAAM,EAAW,EAAK,SAClB,EAcJ,OAZI,OAAO,GAAW,WAClB,AAGI,EAHA,EAAS,SAAS,GACT,EAAS,SAAS,GAElB,GAIjB,AACI,IAAS,EAAS,SAAS,EAGxB,EAMX,gBAAgB,EAAkC,CAC9C,IAAM,EAAO,KAAK,eAAe,SAAS,CACpC,EAAU,KAAK,YAAY,EAAQ,EAAK,CACzC,WAAW,OAAQ,OAAO,CAC1B,WAAW,MAAO,MAAM,CACxB,QAAQ,KAAM,KAAK,CAElB,EAA0B,EAAE,CAC5B,EAAmB,yLAErB,EAAY,EAAiB,UAAY,EACzC,EAAQ,EAAiB,KAAK,EAAQ,CAE1C,KAAO,GAAO,CACV,IAAM,EAAQ,EAAM,GAMpB,GAJI,EAAY,EAAM,OAClB,KAAK,WAAW,EAAO,EAAQ,UAAU,EAAW,EAAM,MAAM,CAAC,CAGjE,KAAK,WAAW,EAAO,IAAI,EAAI,KAAK,WAAW,EAAO,IAAI,CAC1D,KAAK,WAAW,EAAO,EAAM,KAC1B,CACH,IAAM,EAAY,EAAM,GAClB,EAAO,GAAe,GACtB,EAAuB,CACnB,OACN,QAAS,EACZ,CAEG,IAAS,SACT,EAAK,OAAS,KAAK,SAAS,EAAM,EAGtC,IAAM,EAAQ,GAAW,GAEzB,GAAI,EAAO,CACP,IAAM,EAAY,OAAO,EAAM,WAAc,SACvC,EAAM,UACN,EAAM,UAAU,GAChB,EAAgB,EAAM,OAExB,GAAiB,GAAa,IAAU,OACxC,EAAK,MAAQ,CACT,KAAM,EAAM,KACZ,SAAU,KAAK,aAAa,EAAc,EAAI,cAC9C,WAAY,EAAM,aAAe,EACpC,EAIT,EAAM,KAAK,EAAK,CAGpB,EAAY,EAAiB,UAC7B,EAAQ,EAAiB,KAAK,EAAQ,CAO1C,OAJI,EAAY,EAAQ,QACpB,KAAK,WAAW,EAAO,EAAQ,UAAU,EAAU,CAAC,CAGjD,EAMX,gBAAgB,EAA2C,CACvD,GAAI,CAAE,OAAM,YAAa,EACnB,EAAO,KAAK,eAAe,SAAS,CAEtC,IAAa,SACb,EAAW,SAEX,IAAa,gBACb,EAAW,aAEX,IAAa,WACb,EAAW,cAGf,IAAI,EAAS,EAAK,SAAS,KAAQ,GAInC,MAHA,CACI,IAAS,EAAK,SAAS,IAAQ,KAE5B,GAAU,EAAE,CAMvB,cAAc,EAAmD,CAI7D,OAHa,KAAK,eAAe,SAAS,CAClB,SAAS,aACE,EAAQ,OAAS,EAAE,EACjC,EAAQ,UASjC,sBAAsB,EAA+B,EAAoB,IAAI,KAAgB,CACzF,GAAI,CAAC,EACD,MAAO,GAGX,IAAM,EAAQ,IAAI,KAAK,EAAY,CACnC,EAAM,SAAS,EAAG,EAAG,EAAG,EAAE,CAE1B,IAAM,EAAU,IAAI,KAAK,EAAK,CAC9B,EAAQ,SAAS,EAAG,EAAG,EAAG,EAAE,CAE5B,IAAM,EAAW,EAAM,SAAS,CAAG,EAAQ,SAAS,CAC9C,EAAW,KAAK,MAAM,EAAW,KAAK,WAAW,CAUnD,OARA,IAAa,EACN,QACA,IAAa,EACb,YACA,GAAY,EACZ,QAAQ,KAAK,iBAAiB,SAAS,EAAS,OAAO,GAGvD,OAAO,KAAK,iBAAiB,SAAS,EAAS,sBAAsB,CAAC,GCpfzF,IAAa,IACT,EACA,IAEK,EAAQ,OAGN,MAAM,KAAK,aACd,kBAAkBC,EAAO,mBAAmB,IAAIC,EAAW,YAAY,UAAU,EAAU,gBAAgB,EAAU,cAAc,EAAQ,KAAO,GAAG,aACrJ,CAAE,KAAMC,EAAM,MAAO,KAAM,QAAS,SAAU,OAAQ,CACzD,CALU,GAYF,IACT,EACA,EACA,EACA,EAAc,EAAO,EAAY,CACjC,IACS,CACT,GAAI,CAAC,EACD,MAAO,GAGX,GAAI,EACA,OAAO,EAAe,CAAE,SAAQ,UAAS,CAAC,CAG9C,IAAM,EAAW,IAAiB,GAC5B,EAAc,IAAW,GAAe,OACxC,GAAGF,EAAO,cAAc,GAAGA,EAAO,gBAAgB,GAAU,SAAW,IAAM,EAAS,SAAW,KACjG,GAAGA,EAAO,gBAAgB,GAAU,SAAW,IAAM,EAAS,SAAW,KAE3E,EAAW,GACX,GAAU,KACV,EAAW,MAAM,GAAG,KAAK,CAAE,KAAM,EAAS,KAAM,CAAC,CAC1C,GAAU,UACjB,EAAW,MAAM,GAAG,KAAK,CAAE,KAAM,EAAS,QAAS,CAAC,EAGxD,IAAM,EAAa,GAAU,OAAS,OAEhC,EAAO,OAAO,EAAE,CAAC,aAAa,CAAG,EAAO,MAAM,EAAE,CADhD,EAAS,KAGf,MAAO,gBAAgB,EAAY,IAAI,IAAW,EAAY,OAAO,EAAW,CAAC,UAMxE,IACT,EACA,EACA,EACA,EAAc,EAAO,EAAY,GACxB,CACT,GAAI,EACA,OAAO,EAAmB,CAAE,aAAY,UAAS,CAAC,CAGtD,IAAM,EAAQ,EAAW,MAAQ,eAAeA,EAAO,UAAU,IAAI,EAAY,OAAO,EAAW,MAAM,CAAC,QAAU,GAC9G,EAAW,EAAW,SAAW,eAAeA,EAAO,aAAa,IAAI,EAAY,OAAO,EAAW,SAAS,CAAC,QAAU,GAC1H,EAAQ,EAAW,aAAe,eAAeA,EAAO,UAAU,cAAc,EAAY,OAAO,EAAW,aAAa,CAAC,mBAAqB,GACjJ,EAAU,EAAW,SAAS,OAC9B,eAAeA,EAAO,YAAY,IAAI,EAAW,QAAQ,IAAI,GAAK,kBAAkBA,EAAO,WAAW,GAAGA,EAAO,OAAO,IAAI,EAAY,OAAO,EAAE,KAAK,CAAC,WAAW,CAAC,KAAK,GAAG,CAAC,QAC3K,GAEN,MAAO,eAAeA,EAAO,KAAK;UAC5B,EAAM;sBACMA,EAAO,SAAS;cACxB,EAAM;cACN,EAAS;;UAEb,EAAQ;aAOL,IACT,EACA,EACA,EAA+B,OAC/B,IACS,CACT,GAAI,CAAC,GAAa,OACd,MAAO,GAGX,IAAM,EAAkB,EAAY,IAAI,GAAK,GAAiB,EAAG,EAAS,EAAmB,CAAC,CAAC,KAAK,GAAG,CAGvG,MAAO,eAFa,IAAW,WAAaA,EAAO,mBAAqBA,EAAO,SAE7C,IAAI,EAAgB,SAM7C,IACT,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EAAmC,EAAkB,SACrD,EAAc,EAAO,EAAY,CACjC,EAAmB,EAAO,GAAiB,CAC3C,EAAoB,EAAO,GAAkB,CAC7C,EACA,EACA,IACS,CACT,IAAM,EAAY,EAAQ,UACpB,EAAW,EAAQ,QAAU,EAAQ,SAAW,GAAe,OAC/D,EAAoB,GAAc,CAAC,EAAQ,SAC3C,CAACA,EAAO,iBAAkBA,EAAO,SAAS,CAC1C,EAAE,CAEF,EAAmB,EACnB,GAAuB,CACrB,KAAM,EAAa,KACnB,MAAO,EAAa,MACpB,aAAc,EAAa,aAC3B,aAAc,GACd,kBAAmB,GACnB,qBAAsB,GACzB,CAAC,CACA,GAEF,EAAiB,GACrB,AASI,EATA,EAAQ,UAAY,CAAC,EAAQ,aACZ,IAAuB,CACjC,GAAmB,CAAC,EACV,EAAgB,EAAQ,CAClC,EACU,EAAQ,aACnB,EAAY,OAAO,EAAS,mBAAmB,CAC/C,EAAY,OAAO,EAAS,oBAAoB,CAErC,EAAY,qBAAqB,EAAQ,MAAQ,GAAI,EAAiB,CAG3F,IAAM,EAAmB,EAEnB,GADA,GAAkB,EAAQ,YAAa,EAAS,GAAoB,EAAQ,kBAAoB,OAAQ,EAAmB,CAG3H,EAAW,gBAAgBA,EAAO,YAAY,IAAI,EAAiB,SAAS,EAAkB,UAAU,EAAQ,UAAU,CAAE,EAAkB,CAAC,SAC/I,EAAa,GAAoB,EAAQ,OAAQ,EAAS,EAAgB,EAAY,CACtF,EAAY,EAAW,GAAkB,EAAS,EAAS,cAAgB,QAAQ,CAAG,GACtF,EAAkB,eAAeA,EAAO,YAAY,IAAI,IAAW,IAAa,EAAU,QAEhG,MAAO,eAAeA,EAAO,UAAU,EAAY,IAAMA,EAAO,eAAiB,KAAK,EAAW,IAAMA,EAAO,cAAgB,GAAG,cAAc,EAAY,OAAO,EAAQ,KAAO,GAAG,CAAC;sBACnKA,EAAO,WAAW,GAAGA,EAAO,OAAO,GAAG,EAAkB,KAAK,IAAI,CAAC;0BAC9DA,EAAO,cAAc;kBAC7B,EAAiB;+BACJA,EAAO,eAAe,IAAI,EAAe;kBACrD,EAAwF,GAA5E,GAAY,EAAQ,MAAO,EAAa,EAAU,GAAO,EAAgB,CAAM;kBAC5F,EAAgB;;cAEpB,GAAc,CAAC,EAAQ,SAAW,gBAAgBA,EAAO,0BAA0B,IAAIC,EAAW,0BAA0B,GAAG,MAAM,GAAG,KAAK,CAAE,KAAMC,EAAM,UAAW,CAAC,CAAC,SAAW,GAAG;;UAE1L,EAAgB;UACf,EAA6D,GAAjD,eAAeF,EAAO,eAAe,UAAe;aAO9D,IACT,EAwBA,EAAe,EAAO,EAAa,CACnC,EAAmB,EAAO,GAAiB,CAC3C,EAAc,EAAO,EAAY,CACjC,EAAoB,EAAO,GAAkB,GACpC,CACT,GAAM,CACF,UACA,SACA,eACA,eACA,cAAc,GACd,WACA,aAAa,GACb,YAAY,GACZ,oBAAoB,kBACpB,oBACA,iBACA,gBAAgB,GAChB,kBACA,mBAAmB,GACnB,kBACA,kBAAkB,EAAkB,SACpC,kBACA,+BACA,iCACA,qBACA,mBACA,sBACA,EAGE,EAA2B,EAC1B,GAAgC,EAChC,GAAkC,EAGnC,EAAsB,GAAiB,aAAe,OAEtD,GAAU,EAAO,SADjB,EAAgB,YAAc,GAAU,EAAO,SAE/C,EAAwB,GAAiB,eAAiB,OAE1D,GADA,EAAgB,aAEhB,EAAsB,GAAiB,uBAAyB,OAEhE,EADA,EAAgB,qBAEhB,EAAqB,GAAiB,mBAAqB,QAAU,EAErE,GAAe,CACjBA,EAAO,aACP,EAAeA,EAAO,mBAAqBA,EAAO,qBAClD,EAAsB,GAAKA,EAAO,SAClC,EAAqBA,EAAO,sBAAwB,GACvD,CAAC,OAAO,QAAQ,CAAC,KAAK,IAAI,CAEvB,EAAmB,GACvB,GAAI,GAAiB,EAAQ,UAAW,CACpC,IAAM,EAAc,EAAkB,UAAU,EAAQ,UAAU,CAClE,GAAI,EAAa,WAAW,EAAkB,CAC1C,EAAmB,EAAmB,CAAE,KAAM,EAAa,UAAS,CAAC,KAClE,CACH,IAAM,EAAmB,EAAiB,sBAAsB,EAAY,CAC5E,EAAmB,eAAeA,EAAO,UAAU,IAAI,EAAiB,SAIhF,IAAM,GAAiB,EAAqB,EAAmB,CAAE,SAAQ,CAAC,CAAG,GAGzE,EA+BJ,MA9BA,CAWI,EAXA,EACc,EACV,CAAE,GAAG,EAAS,eAAc,SAAQ,CACpC,GAAgB,KAChB,EACA,EACA,EACA,EACA,EACH,CAEa,GACV,CAAE,GAAG,EAAS,eAAc,SAAQ,CACpC,GAAgB,KAChB,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,OACA,OACA,EACA,EACA,EACH,CAGE,GAAG,GAAiB,EAAmB,EAAmB,GAAG;sBAClD,GAAa,IAAI,GAAe;cACxC,EAAsB,GAAa,EAAO,SAAW,EAAO,aAAa,CAAG,GAAG;0BACnEA,EAAO,oBAAoB;kBACnC,EAAwB,gBAAgBA,EAAO,cAAc,IAAI,EAAY,OAAO,EAAO,MAAQ,GAAG,CAAC,SAAW,GAAG;kBACrH,EAAY;;iBClTjB,IACT,EACA,EAAc,EAAO,EAAY,GACxB,CACT,GAAI,CAAC,GAAa,OACd,MAAO,GAGX,IAAM,EAAkB,EACnB,IAAI,GAAc,gBAAgBG,EAAO,WAAW,IAAI,EAAY,OAAO,EAAW,KAAK,CAAC,SAAS,CACrG,KAAK,GAAG,CAEb,MAAO,eAAeA,EAAO,gBAAgB,IAAIC,EAAW,gBAAgB,GAAG,EAAgB,SAUtF,IACT,EACA,EAAyC,EAA8B,OACvE,EAAiB,GACjB,EAAc,EAAO,EAAY,GAE5B,GAAa,OAQX,GAJiB,EACnB,IAAI,GAAc,gBAAgBD,EAAO,WAAW,IAAI,EAAY,OAAO,EAAW,KAAK,CAAC,SAAS,CACrG,KAAK,GAAG,CAEqC,EAAY,EAAM,CAPzD,GAiBF,IACT,EACA,EAAyC,EAA8B,OACvE,EAAiB,KACR,CACT,GAAI,CAAC,EACD,MAAO,GAGX,GAAI,IAAe,EAA8B,KAC7C,MAAO,eAAeA,EAAO,gBAAgB,IAAIC,EAAW,gBAAgB,GAAG,EAAQ,QAG3F,IAAM,EAAc,IAAe,EAA8B,OAC3DD,EAAO,0BACP,GAEA,EAAa,EAAc,GAAGA,EAAO,gBAAgB,GAAG,IAAgBA,EAAO,gBAC/E,EAAgB,eAAeA,EAAO,kBAAkB,IAAI,EAAQ,QACpE,EAAqB,eAAe,EAAW,IAAIC,EAAW,gBAAgB,GAAG,EAAc,QAMrG,OAJI,IAAe,EAA8B,cACtC,GAA4B,EAAoB,EAAM,CAG1D,GAME,IACT,EACA,IACS,CACT,IAAM,EAAW,EAAQC,EAAM,aAAeA,EAAM,YAC9C,EAAY,EAAQA,EAAM,YAAcA,EAAM,aAEpD,MAAO,eAAeF,EAAO,qBAAqB,GAAGA,EAAO,6BAA6B;UACnF,IAAI,MAAM,GAAG,OAAO,WAAWC,EAAW,iBAAiB,GAAI,CAAE,KAAM,EAAU,CAAC,CAAC,QAAQ,GAAG,UAAU;UACxG,EAAmB;UACnB,IAAI,MAAM,GAAG,OAAO,WAAWA,EAAW,kBAAkB,GAAI,CAAE,KAAM,EAAW,CAAC,CAAC,QAAQ,GAAG,UAAU;aASvGE,IACT,EACA,IACS,CAET,GAAI,EACA,MAAO,eAAeH,EAAO,OAAO,IAAI,GAAgB,CAAC,QAI7D,GAAI,CAAC,GAAS,EAAM,SAAW,EAC3B,MAAO,GAIX,IAAM,EAAiB,EAAE,eAAeA,EAAO,OAAO,IAAI,CAK1D,OAJA,IAAI,MAAM,GAAG,QAAQ,EAAgB,CAC1B,QACV,CAAC,CAEK,EAAe,GAAG,WC/G7B,IAAa,GAAb,KAA6B,CAGzB,YAAY,EAAkC,CAC1C,KAAK,QAAU,EAGnB,cAAc,EAAyB,CACnC,IAAM,EAAU,KAAK,QAAQ,QACvB,EAAoB,EAAQ,SAC5B,EAAa,EAAQ,qBACrB,EAAY,EAAQ,mBAAqB,GAAmB,KAC5D,EAAkB,CACpB,GAAI,EAAQ,SACZ,KAAM,EAAQ,WACd,SAAU,EAAQ,eAClB,aAAc,EAAQ,mBACzB,CACK,EAAe,EAAO,KAAO,EAAQ,SACrC,EAAe,KAAK,QAAQ,gBAAgB,EAAQ,CACpD,EAAoB,EAAQ,kBAC5B,EAAmB,EAAQ,iBAC3B,EAAiB,EAAQ,sBACzB,EAAe,EAAe,EAAQ,sBAAwB,EAAQ,wBACtE,EAAkB,KAAK,sBAAsB,EAAS,EAAa,CAEzE,GAAI,KAAK,6BAA6B,CAClC,UAAS,SAAQ,eAAc,eAAc,oBAAmB,aAAY,oBAAmB,mBAAkB,iBAAgB,kBACpI,CAAC,CACE,OAGJ,IAAM,EAAqB,KAAK,yBAAyB,CAGzD,GAFiB,KAAK,yBAAyB,EAAoB,EAAO,GAAG,EAE7D,EAAmB,OAC/B,KAAK,2BAA2B,CAC5B,UAAS,SAAQ,eAAc,eAAc,oBAAmB,aAAY,qBAAoB,oBAAmB,mBAAkB,iBAAgB,kBACxJ,CAAC,KACC,CACH,IAAM,EAAgB,KAAK,qBAAqB,EAAQ,CACxD,KAAK,uBAAuB,CACxB,UAAS,SAAQ,eAAc,eAAc,oBAAmB,aAAY,YAAW,oBAAmB,gBAAe,mBAAkB,iBAAgB,kBAC9J,CAAC,EAIV,sBAAsB,EAAuB,EAAqE,CAC9G,IAAM,EAA2B,CAC7B,WAAY,EAAQ,WACpB,aAAc,EAAQ,aACtB,cAAe,EAAQ,sBAAwB,QAC/C,qBAAsB,EAAQ,qBAC9B,iBAAkB,EAAQ,iBAC7B,CAcD,OAZI,IACI,EAAa,aAAe,SAAW,EAAO,WAAa,EAAa,YACxE,EAAa,eAAiB,SAAW,EAAO,aAAe,EAAa,cAC5E,EAAa,gBAAkB,SAAW,EAAO,cAAgB,EAAa,eAC9E,EAAa,uBAAyB,SAAW,EAAO,qBAAuB,EAAa,sBAC5F,EAAa,mBAAqB,SAAW,EAAO,iBAAmB,EAAa,kBACpF,EAAa,oBAAsB,SAAW,EAAO,kBAAoB,EAAa,mBACtF,EAAa,2BAA6B,SAAW,EAAO,yBAA2B,EAAa,0BACpG,EAAa,wBAA0B,SAAW,EAAO,sBAAwB,EAAa,uBAC9F,EAAa,iBAAmB,SAAW,EAAO,eAAiB,EAAa,iBAGjF,EAGX,qBAAqB,EAA4B,CAC7C,GAAI,CAAC,EAAQ,UACT,MAAO,GAGX,IAAM,EAAuB,KAAK,QAAQ,KAAK,KAAKI,IAAMC,EAAO,QAAQ,CAAC,OAAO,UAAW,CACxF,OAAO,EAAE,KAAK,CAAC,KAAKD,IAAMC,EAAO,gBAAgB,CAAC,SAAW,GAC/D,CAAC,MAAM,CAET,GAAI,CAAC,EAAqB,OACtB,MAAO,GAGX,IAAM,EAAkB,KAAK,QAAQ,SAAS,EAAqB,CACnE,GAAI,CAAC,GAAmB,CAAC,EAAgB,UACrC,MAAO,GAGX,IAAM,EAAqB,KAAK,QAAQ,kBAAkB,UAAU,EAAQ,UAAU,CAChF,EAAkB,KAAK,QAAQ,kBAAkB,UAAU,EAAgB,UAAU,CAE3F,GAAI,CAAC,GAAsB,CAAC,EACxB,MAAO,GAGX,IAAM,EAAa,IAAI,KAAK,EAAmB,CAC/C,EAAW,SAAS,EAAG,EAAG,EAAG,EAAE,CAE/B,IAAM,EAAU,IAAI,KAAK,EAAgB,CAGzC,OAFA,EAAQ,SAAS,EAAG,EAAG,EAAG,EAAE,CAErB,EAAW,SAAS,GAAK,EAAQ,SAAS,CAGrD,6BAA6B,EAWjB,CACR,GAAM,CAAE,UAAS,SAAQ,eAAc,eAAc,oBAAmB,aAAY,oBAAmB,mBAAkB,iBAAgB,mBAAoB,EACvJ,EAAU,KAAK,QAAQ,QACvB,EAAyB,KAAK,QAAQ,KAAK,KAAKD,IAAMC,EAAO,QAAU,cAAc,KAAK,QAAQ,YAAY,OAAO,EAAQ,KAAO,GAAG,CAAC,IAAI,CAElJ,GAAI,EAAuB,OAAQ,CAC/B,IAAM,EAAkB,EAAQ,gBAE5B,EACJ,AAYI,EAZA,EACc,EACV,CAAE,GAAG,EAAS,eAAc,SAAQ,CACpC,EACA,GACA,EACA,GAAiB,sBAAwB,EACzC,EACA,EACA,EACH,CAEa,GACV,CAAE,GAAG,EAAS,eAAc,SAAQ,CACpC,EACA,GACA,EACA,GAAiB,sBAAwB,EACzC,EACA,EACA,EACA,EAAQ,gBACR,KAAK,QAAQ,YAChB,CAGL,IAAM,EAAwB,EAAE,EAAY,CAI5C,OAHA,EAAuB,YAAY,EAAsB,CACzD,KAAK,QAAQ,mBAAmB,EAAsB,KAAKD,IAAMC,EAAO,eAAe,CAAiB,CACxG,KAAK,QAAQ,cAAc,EAAsB,CAC1C,GAEX,MAAO,GAGX,yBAAwC,CACpC,IAAI,EAAmB,KAAK,QAAQ,KAAK,SAASD,IAAMC,EAAO,aAAa,CAAC,MAAM,CAC/E,EAAqB,EAEnB,EAAsB,EAAiB,KAAKD,IAAMC,EAAO,QAAQ,CAUvE,OATI,EAAoB,SAAW,GACX,EAAoB,OAAO,CACT,KAAKD,IAAMC,EAAO,gBAAgB,CAAC,OAAS,IAG9E,EAAqB,EAAiB,KAAKD,IAAMC,EAAO,aAAa,EAItE,EAGX,yBAAyB,EAAkC,EAA2B,CAClF,IAAM,EAA2B,EAAmB,KAAKD,IAAMC,EAAO,QAAQ,CAAC,OAAO,UAAW,CAC7F,OAAO,EAAE,KAAK,CAAC,KAAKD,IAAMC,EAAO,gBAAgB,CAAC,SAAW,GAC/D,CAAC,MAAM,CAGT,OADwB,KAAK,QAAQ,SAAS,EAAyB,EAC/C,WAAa,EAGzC,2BAA2B,EAYlB,CACL,GAAM,CAAE,UAAS,SAAQ,eAAc,eAAc,oBAAmB,aAAY,qBAAoB,oBAAmB,mBAAkB,iBAAgB,mBAAoB,EAC3K,EAAU,KAAK,QAAQ,QACvB,EAAkB,EAAQ,gBAC1B,EAAsB,EAAmB,KAAKD,IAAMC,EAAO,oBAAoB,CAEjF,EACJ,AAYI,EAZA,EACc,EACV,CAAE,GAAG,EAAS,eAAc,SAAQ,CACpC,EACA,GACA,EACA,GAAiB,sBAAwB,EACzC,EACA,EACA,EACH,CAEa,GACV,CAAE,GAAG,EAAS,eAAc,SAAQ,CACpC,EACA,GACA,EACA,GAAiB,sBAAwB,EACzC,EACA,EACA,EACA,EAAQ,gBACR,KAAK,QAAQ,YAChB,CAGL,IAAM,EAAiB,EAAE,EAAY,CACrC,EAAoB,OAAO,EAAe,CAC1C,KAAK,QAAQ,mBAAmB,EAAe,KAAKD,IAAMC,EAAO,eAAe,CAAiB,CACjG,KAAK,QAAQ,cAAc,EAAe,CAC1C,KAAK,4BAA4B,CAGrC,uBAAuB,EAaN,CACb,GAAM,CAAE,UAAS,SAAQ,eAAc,eAAc,oBAAmB,aAAY,YAAW,oBAAmB,gBAAe,mBAAkB,iBAAgB,mBAAoB,EACjL,EAAU,KAAK,QAAQ,QACvB,EAAuB,EAAQ,qBAC/B,EAAoB,EAAQ,kBAC5B,EAAkB,EAAQ,gBAE1B,EAAe,EAAE,EAAqB,CACxC,UACA,SACA,eACA,eACA,YAAa,GACb,SAAU,EACV,aACA,YACA,oBACA,oBACA,iBACA,gBACA,kBACA,mBACA,kBACA,gBAAiB,EAAQ,gBACzB,gBAAiB,EAAQ,uBACzB,6BAA8B,EAAQ,6BACtC,+BAAgC,EAAQ,+BACxC,mBAAoB,EAAQ,mBAC5B,iBAAkB,EAAQ,iBAC1B,mBAAoB,EAAQ,mBAC/B,CAAC,CAAC,CAOH,OALA,KAAK,QAAQ,KAAK,OAAO,EAAa,CACtC,KAAK,QAAQ,mBAAmB,EAAa,KAAKD,IAAMC,EAAO,eAAe,CAAiB,CAC/F,KAAK,QAAQ,cAAc,EAAa,CACxC,KAAK,4BAA4B,CAE1B,EAGX,4BAAmC,CAC/B,IAAM,EAAM,KAAK,QACX,EAAU,EAAI,QACd,EAAuB,EAAQ,qBAC/B,EAAY,EAAQ,mBAAqB,GAAmB,KAE3C,EAAI,KAAK,KAAKD,IAAMC,EAAO,QAAQ,CAAC,OAAO,UAAW,CACzE,OAAO,EAAE,KAAK,CAAC,KAAKD,IAAMC,EAAO,gBAAgB,CAAC,OAAS,GAC7D,CAEa,KAAK,UAAW,CAC3B,IAAM,EAAgB,EAAE,KAAK,CACvB,EAAe,EAAc,QAAQD,IAAMC,EAAO,aAAa,CAGrE,GAFwB,EAAa,KAAKD,IAAMC,EAAO,QAAQ,CAE3C,SAAW,EAC3B,EAAa,QAAQ,CAAC,SAAS,EAAI,KAAK,KACrC,CACH,EAAc,QAAQ,CAEtB,IAAM,EAAU,EAAI,SAAS,EAAc,CAC3C,GAAI,CAAC,EAAS,OAEd,IAAM,EAAkB,CACpB,GAAI,EAAQ,SACZ,KAAM,EAAQ,WACd,SAAU,EAAQ,eAClB,aAAc,EAAQ,mBACzB,CAEK,EAAqB,EAAE,EAAqB,CAC9C,UACA,SACA,aAAc,EAAO,KAAO,EAAQ,SACpC,YACA,kBAAmB,EAAQ,kBAC3B,cAAe,GACf,kBAAmB,EAAQ,kBAC3B,gBAAiB,EAAQ,gBACzB,gBAAiB,EAAQ,gBAC5B,CAAC,CAAC,CAEH,EAAI,KAAK,OAAO,EAAmB,GAEzC,GCpVG,GAAb,KAA2B,CAMvB,YAAY,EAAgC,2BAJQ,yBACN,wBACK,KAG/C,KAAK,QAAU,EACf,KAAK,2BAA2B,CAChC,KAAK,eAAe,CAGxB,2BAA0C,CAGtC,GAFgB,KAAK,QAAQ,QAEjB,uBAAyB,GAAO,CACxC,KAAK,qBAAuB,KAC5B,OAGJ,IAAM,EAAa,MAAM,KAAK,aAC1B,kBAAkBC,EAAO,UAAU,GAAGA,EAAO,OAAO,IAAIC,EAAW,qBAAqB,0CACxF,CACI,KAAMC,EAAM,UACZ,QAAS,OACZ,CACJ,CAED,KAAK,qBAAuB,EAAE,EAAW,CAAC,SAAS,KAAK,QAAQ,QAAQ,CACxE,IAAM,EAAY,CACd,SAAU,SACV,OAAQ,OACR,UAAW,mBACX,OAAQ,EACX,CAEK,EAAsB,KAAK,QAAQ,QAAQ,IAAI,YAAY,GAAK,MACtE,EAAU,EAAsB,QAAU,QAAU,MAEpD,KAAK,qBAAqB,IAAI,EAAU,CAG5C,eAA8B,CAC1B,KAAK,eAAiB,KAAK,UAAU,KAAK,KAAK,CAC/C,KAAK,cAAgB,KAAK,2BAA2B,KAAK,KAAK,CAE/D,KAAK,QAAQ,QACR,GAAG,SAASC,EAAK,iBAAkB,KAAK,eAAe,CACvD,GAAGC,EAAQD,EAAK,iBAAkB,IAAIF,EAAW,qBAAqB,GAAI,KAAK,cAAc,CAGtG,uCAAsD,CAClD,GAAI,CAAC,KAAK,qBACN,OAGJ,IAAM,EAAY,KAAK,QAAQ,QAAQ,WAAW,EAAI,EAChD,EAAe,KAAK,QAAQ,QAAQ,KAAK,eAAe,EAAI,EAC5D,EAAe,KAAK,QAAQ,QAAQ,KAAK,eAAe,EAAI,EACvC,EAAe,EAAY,EAE7B,IACrB,KAAK,qBAAqB,YAAYD,EAAO,OAAO,CAEpD,KAAK,qBAAqB,SAASA,EAAO,OAAO,CAIzD,WAA0B,CACtB,KAAK,uCAAuC,CAGhD,2BAAmC,EAAc,CAC7C,EAAE,gBAAgB,CAClB,KAAK,gBAAgB,CAGzB,gBAAuB,CACnB,KAAK,QAAQ,QAAQ,UAAU,KAAK,QAAQ,QAAQ,KAAK,eAAe,CAAC,CAG7E,gBAAgB,EAAsB,CAClC,GAAI,CAAC,EACD,MAAO,GAGX,IAAM,EAAiB,KAAK,QAAQ,KAAK,KAAKK,IAAML,EAAO,QAAU,cAAc,KAAK,QAAQ,YAAY,OAAO,EAAI,CAAC,IAAI,CAE5H,GAAI,CAAC,EAAe,OAChB,MAAO,GAGX,IAAM,EAAgB,KAAK,QAAQ,QAAQ,KAAKK,IAAML,EAAO,cAAc,CACrE,EAAe,EAAc,QAAS,EAAc,aAAa,EAAQ,EAE/E,OAAO,KAAK,QAAQ,gBAAgB,gBAAgB,KAAK,QAAQ,QAAS,EAAgB,CAAE,SAAU,MAAO,OAAQ,CAAC,EAAc,CAAC,CAGzI,SAAgB,CACZ,AAEI,KAAK,wBADL,KAAK,qBAAqB,QAAQ,CACN,MAGhC,KAAK,QAAQ,QAAQ,IAAIG,EAAK,iBAAiB,GC7G1C,GAAb,KAAgC,CAG5B,YAAY,EAAqC,CAC7C,KAAK,QAAU,EAGnB,wBAA+B,CAC3B,IAAM,EAAU,KAAK,QAAQ,QAEvB,EADc,KAAK,QAAQ,YAAY,gBAAgB,EACnB,kBAAoB,EAAE,CAG1D,EAA0B,GAFA,EAAQ,yBAAyB,EAAqB,CACnE,KAAK,+BAA+B,EAAQ,CACgC,EAAQ,MAAQ,MAAM,CAErH,KAAK,wBAAwB,CAE7B,KAAK,QAAQ,KAAK,OAAO,EAAqB,OAAS,EAA0B,GAAG,CACpF,KAAK,QAAQ,KAAK,KAAK,IAAIG,EAAW,iBAAiB,GAAG,CAAC,SAASC,EAAO,SAAS,CAGxF,wBAA+B,CAC3B,KAAK,QAAQ,KAAK,KAAKC,IAAMD,EAAO,gBAAgB,CAAC,QAAQ,CAC7D,KAAK,QAAQ,KAAK,KAAKC,IAAMD,EAAO,qBAAqB,CAAC,QAAQ,CAGtE,+BAAuC,EAAyG,CAO5I,OANI,EAAQ,2BACD,EAAQ,2BAEf,EAAQ,2BACD,EAA8B,cAElC,EAA8B,SCnBhC,GAAb,MAAa,UAAiB,CAAO,qBAChB,CACb,KAAM,WACT,CASD,YACI,EACA,EACA,EACF,CACE,MAAM,EAAS,EAAE,OAAO,GAAM,EAAE,CAAE,EAAS,QAAS,EAAQ,CAAC,mBAVd,iBAkBhC,CACfE,EAAO,qBACPA,EAAO,sBACPA,EAAO,gBACPA,EAAO,iBACPA,EAAO,iBACPA,EAAO,cACV,CAbG,KAAK,QAAU,EACf,KAAK,WAAW,CAChB,KAAK,cAAc,CACnB,KAAK,eAAe,CAYxB,WAA0B,CACtB,IAAM,EAAY,KAAK,QAAyB,SAEhD,KAAK,QACA,SAASC,EAAO,YAAY,CAC5B,KAAK,OAAQ,MAAM,CACnB,KAAK,aAAc,EAAS,iBAAiB,CAElD,KAAK,KAAO,EAAE,QAAQ,CACjB,SAASA,EAAO,mBAAmB,CACnC,SAAS,KAAK,QAAQ,CAG/B,cAA6B,CACzB,IAAM,EAAU,KAAK,QAErB,KAAK,iBAAmB,IAAI,GAAgB,CACxC,KAAM,KAAK,KACX,UACA,YAAa,KAAK,QAAQ,YAC1B,YAAa,KAAK,QAAQ,YAC1B,kBAAmB,KAAK,QAAQ,kBAChC,SAAU,KAAK,SAAS,KAAK,KAAK,CAClC,gBAAiB,KAAK,gBAAgB,KAAK,KAAK,CAChD,mBAAoB,KAAK,oBAAoB,KAAK,KAAK,CACvD,cAAe,KAAK,eAAe,KAAK,KAAK,CAChD,CAAC,CAEF,KAAK,eAAiB,IAAI,GAAc,CACpC,QAAS,KAAK,QACd,UACA,KAAM,KAAK,KACX,gBAAiB,KAAK,QAAQ,gBAC9B,YAAa,KAAK,QAAQ,YAC7B,CAAC,CAEF,KAAK,oBAAsB,IAAI,GAAmB,CAC9C,KAAM,KAAK,KACX,UACA,YAAa,KAAK,QAAQ,YAC7B,CAAC,CAGN,eAA8B,CAC1B,KAAK,QACA,GAAGC,EAAQC,EAAI,KAAK,WAAW,KAAK,KAAK,CAAC,CAC1C,GAAGD,EAAQC,EAAIC,IAAMH,EAAO,QAAS,KAAK,cAAc,KAAK,KAAK,CAAC,CACnE,GAAGC,EAAQC,EAAIC,IAAMH,EAAO,WAAY,KAAK,iBAAiB,KAAK,KAAK,CAAC,CACzE,GAAGC,EAAQC,EAAI,IAAIE,EAAW,iBAAiB,GAAI,KAAK,uBAAuB,KAAK,KAAK,CAAC,CAC1F,GAAGH,EAAQC,EAAI,IAAIE,EAAW,kBAAkB,GAAI,KAAK,wBAAwB,KAAK,KAAK,CAAC,CAC5F,GAAGH,EAAQC,EAAIC,IAAMH,EAAO,eAAgB,KAAK,kBAAkB,KAAK,KAAK,CAAC,CAC9E,GAAGC,EAAQC,EAAI,IAAIE,EAAW,YAAY,GAAI,KAAK,kBAAkB,KAAK,KAAK,CAAC,CAErF,KAAK,2BAA2B,CAGpC,2BAA0C,CACtC,KAAK,aAAe,KAAK,QAAQ,gBAAgB,0BAC7C,KAAK,QACL,CACI,UAAWF,EAAK,gBAChB,eAAgB,KAAK,QACrB,iBAAkBC,IAAMH,EAAO,kBAClC,CACJ,CACD,KAAK,aAAa,QAAQ,CAG9B,kBAA0B,EAAc,CACpC,EAAE,gBAAgB,CAClB,EAAE,iBAAiB,CACnB,IAAM,EAAS,EAAE,EAAE,cAAc,CAC3B,EAAM,EAAO,KAAK,WAAW,CAC7B,EAAiB,EAAO,QAAQG,IAAMH,EAAO,QAAQ,CACrD,EAAU,KAAK,uBAAuB,EAAe,CAE3D,KAAK,QAAQD,EAAO,cAAe,CAAE,UAAS,MAAK,CAAC,CAGxD,uBAA+B,EAAwC,CACnE,IAAM,EAAM,EAAQ,KAAK,WAAW,CAMpC,OALK,GAGW,KAAK,QACI,YAAY,MAAM,EAAI,EAAE,EACjC,KAAM,GAAW,EAAE,MAAQ,EAAI,EAAI,CAAE,MAAK,CAJ/C,KAOf,cAAc,EAAyB,CACnC,KAAK,iBAAiB,cAAc,EAAQ,CAGhD,oBAAoB,EAA6B,CAC7C,IAAM,EAAU,KAAK,QACf,EAAwB,EAAQ,sBAEtC,GAAI,CAAC,GAAyB,CAAC,EAAsB,QAAU,CAAC,EAAQ,OAAQ,CAC5E,EAAQ,QAAQ,CAChB,OAGmB,IAAI,GAAe,EAAS,CAC/C,MAAO,EACP,IAAK,EAAQ,IACb,SAAU,EAAQ,SAClB,UAAW,GACd,CAAC,CAEa,KAAK,UAAY,GAAW,KAAK,QAAQA,EAAO,sBAAuB,EAAE,CAAC,CAG7F,eAAe,EAA6B,CAExC,IAAM,EADU,KAAK,QACO,YACtB,EAAkB,EAAQ,KAAK,IAAIK,EAAW,eAAe,GAAG,CAEtE,GAAI,CAAC,GAAe,CAAC,EAAY,QAAU,CAAC,EAAQ,OAAQ,CACxD,EAAgB,QAAQ,CACxB,OAGJ,EAAgB,MAAM,EAAY,IAAoB,CAClD,IAAM,EAAM,EAAE,EAAG,CACZ,EAAI,KAAK,sBAAsB,EACnB,IAAI,GAAS,EAAK,CAAE,MAAO,EAAa,CAAC,CACjD,KAAK,UAAY,GAAW,KAAK,QAAQL,EAAO,gBAAiB,EAAE,CAAC,EAE/E,CAGN,SAAS,EAAwC,CAC7C,IAAM,EAAM,GAAW,EAAQ,KAAK,MAAM,CAI1C,OAHI,EACO,KAAK,QAAQ,YAAY,gBAAgB,EAAI,CAEjD,KAGX,aAAa,EAAmB,EAAyB,CACrD,IAAM,EAAM,GAAQ,EAAK,KAAK,MAAM,CAIpC,OAHI,EACO,KAAK,QAAQ,YAAY,aAAa,EAAS,EAAI,CAEvD,KAGX,gBAAgB,EAAoC,CAChD,GAAI,CAAC,GAAS,UACV,OAAO,KAGX,IAAM,EAAe,KAAK,QAAQ,YAAY,eAAe,EAAQ,UAAU,CAK/E,OAJI,IACC,EAAqB,aAAe,EAAa,WAAc,KAAK,QAAyB,UAG3F,EAGX,wBAA+B,CAC3B,KAAK,oBAAoB,wBAAwB,CAGrD,eAAsB,CAClB,KAAK,KAAK,KAAKI,IAAMH,EAAO,aAAa,CAAC,QAAQ,CAClD,KAAK,KAAK,KAAKG,IAAMH,EAAO,UAAU,CAAC,QAAQ,CAC/C,KAAK,oBAAoB,wBAAwB,CAGrD,cAAc,EAAsB,CAChC,IAAM,EAAiB,KAAK,KAAK,KAAKG,IAAMH,EAAO,QAAU,cAAc,KAAK,QAAQ,YAAY,OAAO,EAAI,CAAC,IAAI,CAEpH,GAAI,CAAC,EAAe,OAChB,MAAO,GAGX,IAAM,EAAe,EAAe,QAAQG,IAAMH,EAAO,aAAa,CAStE,OARwB,EAAa,KAAKG,IAAMH,EAAO,QAAQ,CAE3C,SAAW,EAC3B,EAAa,QAAQ,CAErB,EAAe,QAAQ,CAGpB,GAGX,gBAAuB,CACnB,KAAK,eAAe,gBAAgB,CAGxC,gBAAgB,EAAsB,CAClC,OAAO,KAAK,eAAe,gBAAgB,EAAI,CAGnD,mBAAmB,EAAgC,CAC/C,KAAK,QAAQ,YAAc,EAG/B,WAAW,EAAoB,CAC3B,KAAK,KAAK,KAAK,EAAK,CAGxB,aAAuB,CACnB,OAAO,KAAK,KAAK,SAASG,IAAMH,EAAO,aAAa,CAAC,OAAS,EAGlE,WAAmB,EAAc,CAC7B,IAAM,EAAgB,EAAE,EAAE,OAAO,CAE7B,EAAc,SAASA,EAAO,QAAQ,EAAI,EAAc,QAAQG,IAAMH,EAAO,QAAQ,CAAC,QAI1F,KAAK,gBAAgB,EAAc,CAGvC,iBAAyB,EAAc,CACnC,IAAM,EAAoB,EAAE,EAAE,cAAc,CAExC,EAAkB,QAClB,KAAK,QAAQD,EAAO,qBAAsB,CAAE,KAAM,EAAkB,MAAM,CAAE,CAAC,CAIrF,cAAsB,EAAc,CAChC,IAAM,EAAS,EAAE,EAAE,OAAO,CACpB,EAAa,EAAO,QAAQ,IAAIK,EAAW,0BAA0B,GAAG,CAE1E,SAAK,mBAAmB,EAAO,CAMnC,IAFA,KAAK,gBAAgB,EAAO,CAExB,EAAW,OAAQ,CACnB,IAAM,EAAS,EAAW,QAAQD,IAAMH,EAAO,OAAO,CAChD,EAAa,EAAO,SAASA,EAAO,SAAS,CAEnD,EAAO,YAAYA,EAAO,SAAU,CAAC,EAAW,CAChD,EAAW,KAAK,MAAM,GAAG,KAAK,CAAE,KAAM,EAAaK,EAAM,YAAcA,EAAM,UAAW,CAAC,CAAC,CAE1F,KAAK,QAAQN,EAAO,iBAAkB,CAAE,UAAW,EAAY,WAAY,CAAC,EAAY,CAAC,CACzF,OAGmB,EAAE,EAAE,cAAc,CACX,KAAKI,IAAMH,EAAO,OAAO,CAChD,SAASA,EAAO,SAAS,EAGpC,mBAA2B,EAA+B,CACtD,IAAM,EAAsB,CACxB,IAAII,EAAW,eAAe,GAC9BD,IAAMH,EAAO,eACbG,IAAMH,EAAO,gBACbG,IAAMH,EAAO,eAChB,CAAC,KAAK,KAAK,CAEZ,OAAO,EAAO,QAAQ,EAAoB,CAAC,OAAS,GAChD,EAAO,SAAS,EAAoB,CAAC,OAAS,GAC9C,EAAO,GAAG,EAAoB,CAGtC,gBAAwB,EAA4B,CAChD,IAAM,EAAmB,KAAK,QAAQ,KAAKG,IAAMH,EAAO,SAAS,CAE7D,EAAO,QAAQ,IAAII,EAAW,0BAA0B,GAAG,CAAC,QAIhE,EAAiB,MAAM,EAAgB,IAAyB,CAC7C,EAAE,EAAQ,CAClB,YAAYJ,EAAO,SAAS,EACrC,CAGN,uBAA+B,EAAc,CACzC,EAAE,gBAAgB,CAClB,IAAM,EAAS,EAAE,EAAE,cAAc,CAC3B,EAAoB,KAAK,QAAQ,KAAK,IAASA,EAAO,oBAAoB,CAC1E,EAAS,KAAK,QAAyB,MAAQ,MAE/C,EAAW,KAAK,QAAQ,gBAAgB,cAAc,EAAmB,EAAQ,IAAkB,KAAiB,CAE1H,KAAK,QAAQ,KAAK,IAAII,EAAW,kBAAkB,GAAG,CAAC,YAAYJ,EAAO,SAAS,CAE/E,EAAS,SACT,EAAO,SAASA,EAAO,SAAS,CAIxC,wBAAgC,EAAc,CAC1C,EAAE,gBAAgB,CAClB,IAAM,EAAS,EAAE,EAAE,cAAc,CAC3B,EAAoB,KAAK,QAAQ,KAAK,IAASA,EAAO,oBAAoB,CAC1E,EAAS,KAAK,QAAyB,MAAQ,MAE/C,EAAW,KAAK,QAAQ,gBAAgB,cAAc,EAAmB,EAAQ,KAAmB,IAAgB,CAE1H,KAAK,QAAQ,KAAK,IAAII,EAAW,iBAAiB,GAAG,CAAC,YAAYJ,EAAO,SAAS,CAE9E,EAAS,OACT,EAAO,SAASA,EAAO,SAAS,CAIxC,kBAA0B,EAAc,CAEpC,IAAM,EADiB,EAAE,EAAE,cAAc,CACV,QAAQG,IAAMH,EAAO,QAAQ,CAExD,EAAQ,QACR,KAAK,QAAQD,EAAO,iBAAkB,CAAE,eAAgB,EAAS,CAAC,CAI1E,SAAgB,CACZ,MAAM,SAAS,CAEf,KAAK,eAAe,SAAS,CAEzB,KAAK,cACL,KAAK,aAAa,SAAS,CAG/B,KAAK,QAAQ,KAAK,uBAAuB,CAAC,KAAK,UAAW,CACtD,IAAM,EAAW,EAAE,KAAK,CAAC,KAAK,oBAAoB,CAC9C,GACA,EAAS,SAAS,EAExB,CAEF,KAAK,QAAQ,OAAO,CACpB,KAAK,QAAQ,IAAIG,EAAG,CAEnB,KAAa,KAAO,OCtY7B,IAAa,EAAK,kBAGL,EAAY,CACrB,OAAQ,SACR,MAAO,QACP,KAAM,OACT,CAGY,GAAQ,CACjB,KAAM,cACN,KAAM,UACN,WAAY,8BACf,CAGY,EAAS,CAElB,UAAW,eACX,iBAAkB,uBAClB,gBAAiB,sBACjB,eAAgB,qBAChB,kBAAmB,wBACnB,eAAgB,qBAChB,oBAAqB,0BACrB,mBAAoB,yBAGpB,MAAO,UACP,WAAY,gBAGZ,SAAU,aACV,OAAQ,WACR,MAAO,UACP,WAAY,eACZ,OAAQ,WAGR,mBAAoB,0BACpB,iBAAkB,uBAGlB,eAAgB,qBAChB,8BAA+B,sCAC/B,YAAa,iBACb,QAAS,aACT,SAAU,cACV,SAAU,cACV,SAAU,cAGV,OAAQ,WACX,CAGY,EAAa,CACtB,WAAY,4BACZ,iBAAkB,mCAClB,UAAW,2BACX,gBAAiB,iCACjB,uBAAwB,yCACxB,MAAO,sBACP,OAAQ,uBACR,WAAY,4BACZ,SAAU,0BACV,SAAU,0BACV,YAAa,6BAChB,CAGY,EAAS,CAClB,YAAa,cACb,MAAO,QACP,aAAc,eACd,WAAY,aACZ,WAAY,aACZ,kBAAmB,oBACnB,kBAAmB,oBACnB,gBAAiB,kBACjB,kBAAmB,oBACnB,mBAAoB,qBACpB,MAAO,QACP,KAAM,OACN,WAAY,aACZ,UAAW,YACX,qBAAsB,uBACzB,CAGY,GAAQ,QCrFR,IACT,EACA,EAAuB,KACd,CACT,IAAI,EAAU,GAKd,GAJI,IACA,EAAU,GAAgB,EAG1B,CAAC,GAAW,CAAC,EACb,MAAO,GAGX,IAAM,EAAc,EAAU,GAAK,IAAI,EAAO,SAC9C,MAAO,eAAe,EAAO,kBAAkB,EAAY,IAAI,EAAW,OAAO,QAAQ,EAAW,gBAAgB,SAAS,EAAQ,SAMnI,GAAkB,GACf,EAGE,GAAU,CAFN,GAQF,IACT,EACA,EAAkB,GAClB,IACS,CACT,IAAM,EAAiB,EAAiC,GAAxB,IAAI,EAAO,WACrC,EAAgB,EAAmC,GAA1B,wBAEzB,EAAqC,CACvC,KAAM,GAAU,MAAQ,mBACxB,KAAM,GAAU,MAAQ,QACxB,QAAS,GAAU,SAAW,OACjC,CASD,OAPI,GAAU,WACV,EAAc,SAAW,EAAS,UAElC,GAAU,aACV,EAAc,WAAa,EAAS,YAGjC,MAAM,KAAK,aACd,kBAAkB,EAAS,aAAa,gBAAgB,EAAS,aAAa,8BAA8B,EAAc,GAAG,EAAa,GAAG,EAAW,WAAW,0BACnK,EACH,EAMQ,IACT,EACA,EACA,EACA,EACA,EAAkB,GAClB,IACS,CACT,IAAM,EAAe,EAAW,YAAc,GACxC,EAAa,EAAS,YAAY,EAAO,GAAK,GAC9C,EAAgB,EAAuB,GAAd,YACzB,EAAoB,EAAmC,GAA1B,wBAC7B,EAAiB,EAAiC,GAAxB,IAAI,EAAO,WACrC,EAAc,GAAU,MAAQ,GAAU,kBAAoB,cAE9D,EAAqC,CACvC,KAAM,GAAU,MAAQ,GAAM,WAC9B,SAAU,GAAU,UAAY,QACnC,CAiBD,OAfI,GAAU,OACV,EAAc,KAAO,EAAS,MAE9B,GAAU,UACV,EAAc,QAAU,EAAS,SAEjC,GAAU,aACV,EAAc,WAAa,EAAS,YAQjC,GALQ,MAAM,KAAK,aACtB,kBAAkB,EAAY,gBAAgB,EAAY,WAAW,EAAc,IAAI,EAAW,iBAAiB,gBAAgB,IAAe,EAAiB,YACnK,EACH,CAEgB,yBAAyB,EAAY,WAAW,EAAO,OAAO,IAAI,EAAW,YAAY,IAAe,EAAW,MAO3H,GAA4B,GAC9B,kBAAkB,EAAO,mBAAmB,2BA8C1C,GACT,GACS,CACT,IAAM,EAAU,GAAe,EAAmB,CAIlD,OAHK,EAGE,eAAe,EAAO,eAAe,IAAI,EAAW,WAAW,GAAG,EAAQ,QAFtE,IASF,IACT,EACA,EACA,EAA4B,GAC5B,EACA,EACA,IACS,CACT,IAAM,EAAW,GAAe,EAAiB,CAC3C,EAA0B,GAAwB,SAAW,GAC7D,EAAmB,EACnB,GAAuB,EAAuB,YAAa,EAAuB,OAAQ,EAAuB,SAAU,EAAuB,SAAU,EAAyB,EAAS,CAC9L,GACA,EAAS,GAAwB,WAAa,eAAe,EAAO,OAAO,UAAY,GACvF,EAAe,EAAmB,GAAyB,GAAsB,2BAA2B,CAAG,GAC/G,EAAa,EAAiB,GAAiB,EAAU,GAAM,GAAsB,qBAAqB,CAAG,GAOnH,MALgB,GAAG,IAAW,IAAmB,IAAS,IAAe,IAAa,MAAM,CAKrF,eAAe,EAAO,eAAe,IAAI,EAAW,SAAS;UAC9D,EAAS;UACT,EAAiB;UACjB,EAAO;UACP,EAAa;UACb,EAAW;YARN,IAiBF,IACT,EACA,EACA,EAA4B,GAC5B,EACA,EACA,EACA,IACS,CACT,IAAM,EAAa,GAAe,EAAmB,CAC/C,EAAW,GAAe,EAAiB,CAC3C,EAA0B,GAAwB,SAAW,GAC7D,EAAmB,EACnB,GAAuB,EAAuB,YAAa,EAAuB,OAAQ,EAAuB,SAAU,EAAuB,SAAU,EAAyB,EAAS,CAC9L,GACA,EAAe,EAAmB,GAAyB,GAAsB,2BAA2B,CAAG,GAC/G,EAAa,EAAiB,GAAiB,EAAU,GAAM,GAAsB,qBAAqB,CAAG,GAE7G,EAAS,eAAe,EAAO,OAAO,UAa5C,OAXK,GAAwB,WAWtB,eAAe,EAAO,eAAe,IAAI,EAAW,SAAS;UAC9D,EAAiB;UACjB,EAAW;UACX,EAAO;UACP,EAAS;UACT,EAAa;UACb,EAAW;YAhBL,eAAe,EAAO,eAAe,IAAI,EAAW,SAAS;cAC/D,EAAW;cACX,EAAO;cACP,EAAS;cACT,EAAiB;cACjB,EAAa;cACb,EAAW;iBAkBZ,GACT,GACS,CACT,IAAM,EAAU,GAAe,EAAiB,CAIhD,OAHK,EAGE,eAAe,EAAO,eAAe,IAAI,EAAW,SAAS,GAAG,EAAQ,QAFpE,IAUF,IACT,EACA,EACA,EACA,EACA,EAA4B,GAC5B,EAA8B,EAAE,GACvB,CACT,GAAM,CAAE,cAAc,EAAE,CAAE,yBAAwB,wBAAyB,EAErE,EAAS,GAAa,EADF,CAAC,CAAC,EACkC,CACxD,EAAW,IAAS,EAAU,MAAQ,GAAe,EAAY,iBAAiB,CAAG,GAErF,EAAc,IAAS,EAAU,MAEjC,EAAa,EAAc,GAAK,GAAiB,EAAY,mBAAmB,CAChF,EAAW,EACX,GAA6B,EAAU,EAAgB,EAAkB,EAAY,mBAAoB,EAAY,iBAAkB,EAAwB,EAAqB,CACpL,GAAe,EAAU,EAAgB,EAAkB,EAAY,iBAAkB,EAAwB,EAAqB,CAE5I,MAAO,GAAG,EAAO;sBACC,EAAO,iBAAiB;cAChC,EAAS;cACT,EAAW;oBACL,EAAW,MAAM;cACvB,EAAS;iBChSvB,IAAa,GAAb,KAAkC,CAG9B,YAAY,EAAuC,CAC/C,KAAK,QAAU,EAGnB,cAAqB,CACjB,IAAM,EAAU,KAAK,QAAQ,YAAY,CAC3B,KAAK,QAAQ,iBAAiB,CACtC,KAAK,aAAc,EAAQ,UAAU,iBAAmB,UAAU,CAEnE,EAAQ,QACT,KAAK,QAAQ,QAAQ,KAAK,gBAAiB,OAAO,CAGlD,EAAQ,UACR,KAAK,0BAA0B,CAG/B,EAAQ,SACR,KAAK,QAAQ,QAAQ,KAAK,YAAa,OAAO,CAItD,0BAAiC,CAC7B,IAAM,EAAU,KAAK,QAAQ,YAAY,CACnC,EAAQ,KAAK,QAAQ,iBAAiB,CAEvC,IAIL,EAAM,KAAK,aAAc,EAAQ,UAAU,iBAAmB,UAAU,CAEpE,EAAQ,SACR,EAAM,KAAK,gBAAiB,OAAO,CAEnC,EAAM,WAAW,gBAAgB,CAGhC,EAAQ,OAGT,EAAM,WAAW,gBAAgB,CAFjC,EAAM,KAAK,gBAAiB,OAAO,EAM3C,cAAc,EAAwD,CAC9D,EAAM,WAAa,SACf,EAAM,SACN,KAAK,QAAQ,QAAQ,KAAK,gBAAiB,OAAO,CAElD,KAAK,QAAQ,QAAQ,WAAW,gBAAgB,EAIpD,EAAM,UAAY,SACd,EAAM,QACN,KAAK,QAAQ,QAAQ,KAAK,YAAa,OAAO,CAE9C,KAAK,QAAQ,QAAQ,WAAW,YAAY,ICvD/C,GAAb,KAAiC,CAG7B,YAAY,EAAsC,CAC9C,KAAK,QAAU,EAGnB,eAAgC,CAC5B,OAAO,KAAK,QAAQ,QAAQ,KAAK,IAAI,EAAW,WAAW,GAAG,CAGlE,WAAW,EAAwB,CAC/B,IAAM,EAAa,KAAK,eAAe,CACjC,EAAW,KAAK,QAAQ,aAAa,CACrC,EAAW,KAAK,QAAQ,aAAa,CAE3C,GAAI,EAAS,CACT,EAAW,SAAS,GAAG,EAAO,WAAW,GAAG,EAAO,SAAS,CAC5D,EAAW,KAAK,QAAS,EAAS,oBAAoB,CACtD,EAAW,KAAK,aAAc,EAAS,oBAAoB,CAC3D,IAAM,EAAO,EAAW,KAAK,uBAAuB,CACpD,GAAI,EAAK,OAAQ,CACb,IAAM,EAAc,GAAU,aAAe,UAC7C,MAAM,GAAG,KAAK,EAAM,CAAE,KAAM,EAAa,CAAC,MAE3C,CACH,EAAW,YAAY,GAAG,EAAO,WAAW,GAAG,EAAO,SAAS,CAC/D,EAAW,KAAK,QAAS,EAAS,aAAa,CAC/C,EAAW,KAAK,aAAc,EAAS,aAAa,CACpD,IAAM,EAAO,EAAW,KAAK,uBAAuB,CACpD,GAAI,EAAK,OAAQ,CACb,IAAM,EAAW,GAAU,MAAQ,mBACnC,MAAM,GAAG,KAAK,EAAM,CAAE,KAAM,EAAU,CAAC,EAI/C,KAAK,aAAa,CAGtB,aAAoB,CAChB,IAAM,EAAa,KAAK,eAAe,CAGvC,GAFmB,KAAK,QAAQ,YAAY,CAE5B,CACZ,EAAW,SAAS,EAAO,SAAS,CACpC,EAAW,KAAK,gBAAiB,OAAO,CACxC,OAKJ,GAFA,EAAW,WAAW,gBAAgB,CAElC,KAAK,QAAQ,WAAW,CAAE,CAC1B,EAAW,YAAY,EAAO,SAAS,CACvC,OAGA,KAAK,QAAQ,YAAY,CACzB,EAAW,YAAY,EAAO,SAAS,CAEvC,EAAW,SAAS,EAAO,SAAS,CAI5C,gBAAuB,CACnB,IAAM,EAAa,KAAK,eAAe,CACjC,EAAW,KAAK,QAAQ,aAAa,CAEvC,KAAK,QAAQ,WAAW,EACxB,EAAW,KAAK,QAAS,EAAS,oBAAoB,CACtD,EAAW,KAAK,aAAc,EAAS,oBAAoB,GAE3D,EAAW,KAAK,QAAS,EAAS,aAAa,CAC/C,EAAW,KAAK,aAAc,EAAS,aAAa,ICpEnD,GAAb,KAA2B,CAIvB,YAAY,EAAgC,eAFpB,KAGpB,KAAK,QAAU,EAGnB,MAAa,CACT,IAAM,EAAS,KAAK,QAAQ,6BAA6B,CAEzD,GAAI,IAAW,GACX,OAGJ,IAAM,EAAqB,KAAK,QAAQ,QAAQ,KAAKK,IAAM,EAAO,mBAAmB,CACrF,GAAI,CAAC,EAAmB,OACpB,OAGJ,IAAM,EAA+C,CACjD,SAAU,OACV,KAAM,QACN,OAAQ,GACX,CAEK,EAAe,OAAO,GAAW,UAAY,EAAkB,EAAS,EAAE,CAC1E,EAAa,EAA6C,SAAW,GAErE,EAAgB,CAClB,GAAG,EACH,GAAG,EACH,MAAQ,GAAW,KAAK,QAAQ,UAAU,QAAQ,EAAE,CACpD,IAAM,GAAW,KAAK,QAAQ,UAAU,MAAM,EAAE,CAChD,OAAS,GAAW,KAAK,QAAQ,UAAU,SAAS,EAAE,CACtD,MAAQ,GAAW,KAAK,QAAQ,UAAU,QAAQ,EAAE,CACvD,CAED,KAAK,SAAW,IAAI,MAAM,GAAG,mBAAmB,EAAoB,EAAc,CAE7E,GACD,KAAK,SAAS,OAAO,GAAM,CAInC,OAAO,EAAwB,CACvB,KAAK,UACL,KAAK,SAAS,OAAO,EAAQ,CAIrC,SAAgB,CACZ,AAEI,KAAK,YADL,KAAK,SAAS,SAAS,CACP,QC7Cf,GAAb,KAAyB,CAMrB,YAAY,EAA8B,YAJjB,EAAE,mBAEwB,KAG/C,KAAK,QAAU,EAGnB,YAAmB,CACf,IAAM,EAAU,KAAK,QAAQ,YAAY,CACzC,GAAI,CAAC,KAAK,qBAAqB,EAAQ,CACnC,OAGJ,IAAM,EAAY,KAAK,QAAQ,QAAQ,KAAK,IAAI,EAAW,UAAU,GAAG,CACxE,GAAI,EAAU,SAAW,EACrB,OAIJ,IAAM,EADW,KAAK,4BAA4B,EAAQ,EAC/B,WAAa,GAElC,EAAS,IAAI,MAAM,GAAG,OAAO,EAAW,CAChC,WACV,MAAO,GACP,eAAgB,GAChB,OAAQ,KAAK,eAAe,KAAK,KAAK,CACzC,CAAC,CAEF,GAAQ,SAAS,SAAS,EAAO,OAAO,CACxC,KAAK,eAAiB,EAG1B,UAAoB,CAChB,MAAO,CAAC,GAAG,KAAK,MAAM,CAG1B,SAAS,EAAyB,CAC9B,KAAK,MAAQ,CAAC,GAAG,EAAS,CAC1B,KAAK,mBAAmB,CACxB,KAAK,QAAQ,UAAU,gBAAgB,CAG3C,YAAmB,CACf,KAAK,MAAQ,EAAE,CACf,KAAK,mBAAmB,CACxB,KAAK,QAAQ,UAAU,gBAAgB,CAG3C,UAAoB,CAChB,OAAO,KAAK,MAAM,OAAS,EAG/B,uBAA8B,CAC1B,IAAM,EAAU,KAAK,QAAQ,YAAY,CACnC,EAAW,KAAK,4BAA4B,EAAQ,CAE1D,GAAI,CAAC,EAAQ,QAAU,EAAQ,UAAY,GAAU,SAAW,GAC5D,OAIJ,IAAM,EADc,KAAK,gBAAgB,UAAU,IAClB,KAAK,QAAQ,QAAQ,KAAK,IAAI,EAAW,UAAU,GAAG,CAAC,GAEpF,GAAa,OAAQ,EAA+B,OAAU,YAC7D,EAA+B,OAAO,CAI/C,sBAAsB,EAAmB,CACrC,IAAM,EAAc,KAAK,MAAM,KAAK,GAAQ,KAAK,WAAW,EAAK,GAAK,EAAI,CACpE,EAAW,KAAK,MAAM,OAAO,GAAQ,KAAK,WAAW,EAAK,GAAK,EAAI,CAErE,EAAS,SAAW,KAAK,MAAM,SAInC,KAAK,MAAQ,EACb,KAAK,mBAAmB,CACxB,KAAK,QAAQ,UAAU,gBAAgB,CAEnC,GACA,KAAK,QAAQ,UAAU,aAAa,EAAa,CAAC,GAAG,KAAK,MAAM,CAAC,EAIzE,mBAA0B,CACtB,KAAK,qBAAqB,CAE1B,IAAM,EAAS,KAAK,QAAQ,QAAQ,KAAK,IAAI,EAAW,OAAO,GAAG,CAC5D,EAAO,KAAK,QAAQ,QAAQ,KAAK,IAAI,EAAW,gBAAgB,GAAG,CACzE,GAAI,EAAK,SAAW,EAChB,OAGJ,GAAI,CAAC,KAAK,MAAM,OAAQ,CACpB,EAAK,OAAO,CAEP,KAAK,QAAQ,YAAY,CAAC,gBAC3B,EAAO,SAAS,EAAO,OAAO,CAElC,OAGJ,EAAO,YAAY,EAAO,OAAO,CAEjC,IAAI,EAAO,cAAc,EAAO,eAAe,GAAG,EAAO,8BAA8B,IACvF,GAAQ,eAAe,EAAO,YAAY,IAE1C,IAAK,IAAI,EAAI,EAAG,EAAI,KAAK,MAAM,OAAQ,IAAK,CACxC,IAAM,EAAU,KAAK,MAAM,GACrB,EAAU,GAAS,SAAW,EAC9B,EAAM,KAAK,WAAW,EAAQ,CAC9B,EAAO,GAAS,MAAQ,GAAS,MAAQ,GACzC,EAAO,GAAS,MAAQ,GAAS,MAAQ,EACzC,EAAY,EAAK,YAAY,IAAI,CAAG,GAAK,EAAK,UAAU,EAAK,YAAY,IAAI,CAAC,CAAC,aAAa,CAAG,GAC/F,EAAW,KAAK,QAAQ,iBAAiB,aAAa,EAAW,GAAK,CACtE,EAAkB,KAAK,QAAQ,iBAAiB,mBAAmB,EAAK,CACxE,EAAO,MAAM,GAAG,KAAK,CAAE,KAAM,EAAU,KAAM,SAAU,CAAC,CACxD,EAAe,MAAM,KAAK,aAC5B,yBAAyB,EAAW,uBAAuB,aAAa,KAAK,QAAQ,YAAY,OAAO,EAAI,CAAC,sEAC7G,CAAE,KAAM,oBAAqB,SAAU,OAAQ,CAClD,CAED,GAAQ,cAAc,EAAO,QAAQ,IACrC,GAAQ,EACR,GAAQ,eAAe,EAAO,SAAS,IACvC,GAAQ,gBAAgB,EAAO,SAAS,IAAI,KAAK,QAAQ,YAAY,OAAO,EAAK,CAAC,SAClF,GAAQ,gBAAgB,EAAO,SAAS,IAAI,KAAK,QAAQ,YAAY,OAAO,EAAgB,CAAC,SAC7F,GAAQ,SACR,GAAQ,EACR,GAAQ,QAGZ,GAAQ,cACR,EAAK,KAAK,EAAK,CAEf,KAAK,qBAAqB,CAG9B,qBAAoC,CAEhC,IAAM,EADO,KAAK,QAAQ,QAAQ,KAAK,IAAI,EAAW,gBAAgB,GAAG,CAC5C,KAAK,IAAM,EAAO,YAAY,CACtD,EAAgB,SAIrB,KAAK,aAAe,KAAK,QAAQ,gBAAgB,0BAC7C,EACA,CACI,UAAW,EAAK,qBAChB,eAAgB,KAAK,QAAQ,QAChC,CACJ,CACD,KAAK,aAAa,QAAQ,EAG9B,qBAAoC,CAChC,AAEI,KAAK,gBADL,KAAK,aAAa,SAAS,CACP,MAI5B,SAAgB,CACZ,KAAK,qBAAqB,CAC1B,AAEI,KAAK,kBADL,KAAK,eAAe,SAAS,CACP,MAI9B,eAAuB,EAAc,CACjC,EAAE,gBAAgB,CAClB,IAAM,EAAQ,EAAE,MACV,EAAU,KAAK,QAAQ,YAAY,CACnC,EAAW,KAAK,4BAA4B,EAAQ,CACpD,EAAa,KAAK,cAAc,EAAO,EAAS,CAElD,EAAW,OAAS,IACpB,KAAK,MAAQ,CAAC,GAAG,KAAK,MAAO,GAAG,EAAW,CAC3C,KAAK,mBAAmB,CACxB,KAAK,QAAQ,UAAU,gBAAgB,CACvC,KAAK,QAAQ,UAAU,aAAa,EAAW,EAIvD,cAAsB,EAAgB,EAA+C,CACjF,IAAM,EAAsB,EAAE,CACxB,EAAe,GAAU,aAE/B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM,OAAQ,IAAK,CACnC,IAAM,EAAU,EAAM,GAChB,EAAO,EAAQ,SAAW,EAC5B,EAAU,GAEd,GAAI,EAAc,CACd,GAAI,EAAa,mBAAqB,EAAa,kBAAkB,OAAS,EAAG,CAC7E,IAAM,EAAM,EAAK,KAAK,MAAM,IAAI,CAAC,KAAK,EAAE,aAAa,EAAI,GACrC,EAAa,kBAAkB,IAAK,GAAc,EAAE,aAAa,CAAC,QAAQ,IAAK,GAAG,CAAC,CACtF,SAAS,EAAI,GAC1B,EAAU,IAId,EAAa,aAAe,EAAK,KAAO,EAAa,cACrD,EAAU,IAGV,EAAa,aAAe,EAAK,KAAO,EAAa,cACrD,EAAU,IAId,GACA,EAAW,KAAK,EAAQ,CAIhC,OAAO,EAGX,WAAmB,EAAqB,CASpC,OARK,GAIL,AACI,EAAK,MAAM,KAAK,QAAQ,aAAa,MAAM,CAGxC,EAAK,KAPD,GAUf,qBAA6B,EAAqC,CAC9D,OAAO,EAAQ,mBAAqB,IAC/B,OAAO,EAAQ,kBAAqB,UAAY,EAAQ,mBAAqB,KAGtF,4BAAoC,EAAmE,CACnG,GAAI,OAAO,EAAQ,kBAAqB,UAAY,EAAQ,mBAAqB,KAC7E,OAAO,EAAQ,mBCzQ3B,IAAMC,GAAuC,CACzC,YAAa,oBACb,aAAc,OACd,oBAAqB,OACrB,gBAAiB,UACpB,CAiBD,IAAa,GAAb,KAA0B,CAStB,YAAY,EAA+B,oBAPd,0BACK,uBACA,qBACF,yBACI,iBACP,GAGzB,KAAK,QAAU,EAGnB,MAAa,CACT,IAAM,EAAiB,KAAK,QAAQ,QAAQ,KAAK,IAAI,EAAW,MAAM,GAAG,CACnE,EAAO,KAAK,QAAQ,SAAS,CAC7B,EAAe,KAAK,mBAAmB,EAAK,CAClD,EAAe,YAAY,EAAa,CAExC,IAAM,EAAQ,KAAK,QAAQ,YAAY,CAAC,OAAS,GAC7C,GACA,EAAa,IAAI,EAAM,CAG3B,KAAK,0BAA0B,CAC/B,KAAK,mBAAmB,CAG5B,YAA4B,CACxB,OAAO,KAAK,eAAe,SAAW,KAG1C,UAAmB,CACf,OAAO,KAAK,cAAgB,KAAK,cAAc,OAAO,CAAG,GAG7D,SAAS,EAAqB,CACtB,KAAK,eACL,KAAK,cAAc,MAAM,EAAM,CAEnC,KAAK,kBAAkB,CACvB,KAAK,mBAAmB,CAG5B,OAAO,EAAwB,CACvB,KAAK,eACL,KAAK,cAAc,OAAO,EAAQ,CAI1C,YAAY,EAAyB,CAC7B,KAAK,eAAe,SACpB,KAAK,cAAc,QAAQ,KAAK,WAAY,EAAS,CAI7D,OAAc,CACN,KAAK,eACL,KAAK,cAAc,OAAO,CAIlC,MAAa,CACL,KAAK,eAAe,SACpB,KAAK,cAAc,QAAQ,MAAM,CAIzC,aAAuB,CACnB,OAAO,KAAK,UAGhB,kBAAyB,CAGrB,GAFa,KAAK,QAAQ,SAAS,GAEtB,EAAU,MAAQ,CAAC,KAAK,cACjC,OAGJ,IAAM,EAAW,KAAK,cAAc,QACpC,GAAI,CAAC,EAAS,GAAG,WAAW,CACxB,OAGJ,IAAM,EAAK,EAAS,GAEf,KAAK,WAQN,KAAK,cAAc,CAEf,KAAK,gBAAgB,GACrB,KAAK,qBAAqB,GAAM,CAChC,EAAS,IAAI,SAAU,GAAG,IAXP,EAAG,YAAc,EAAG,aAAe,EAAG,aAAe,EAAG,gBAG3E,KAAK,qBAAqB,GAAK,CAC/B,KAAK,cAAc,EAY/B,mBAA0B,CAGtB,GAFa,KAAK,QAAQ,SAAS,GAEtB,EAAU,OAAS,CAAC,KAAK,cAClC,OAGJ,IAAM,EAAW,KAAK,cAAc,QACpC,GAAI,CAAC,EAAS,GAAG,WAAW,CACxB,OAGJ,IAAM,EAAK,EAAS,GACd,EAAU,KAAK,QAAQ,YAAY,CAEzC,EAAS,IAAI,WAAY,SAAS,CAClC,EAAS,IAAI,SAAU,KAAK,cAAgB,KAAK,CAEjD,IAAM,EAAe,EAAG,aAClB,EAAY,KAAK,qBAAqB,EAAc,EAAQ,kBAAkB,CAEhF,IAAc,EAAQ,mBACtB,EAAS,IAAI,WAAY,GAAG,CAGhC,EAAS,IAAI,SAAU,EAAY,KAAK,CAG5C,mBAA0B,CACtB,IAAM,EAAU,KAAK,QAAQ,YAAY,CACnC,EAAW,EAAE,OAAO,EAAE,CAAEA,GAAkB,EAAQ,SAAS,CAC3D,EAAc,EAAQ,aAAe,EAAS,YAEhD,KAAK,eAAe,SACpB,KAAK,cAAc,QAAQ,KAAK,cAAe,EAAY,CAInE,SAAgB,CACZ,AAGI,KAAK,iBAFL,KAAK,cAAc,QAAQ,IAAI,EAAG,CAClC,KAAK,cAAc,SAAS,CACP,MAI7B,mBAA2B,EAAsB,CAC7C,IAAM,EAAU,KAAK,QAAQ,YAAY,CACnC,EAAW,EAAE,OAAO,EAAE,CAAEA,GAAkB,EAAQ,SAAS,CAC3D,EAAQ,EAAQ,MAAQ,UAAU,EAAQ,MAAM,GAAK,GACrD,EAAW,EAAQ,SAAW,WAAa,GAE7C,EAEJ,GAAI,IAAS,EAAU,OACnB,EAAe,EAAE,6BAA6B,EAAO,eAAe,GAAG,EAAO,WAAW,iBAAiB,EAAQ,aAAe,EAAS,YAAY,uBAAuB,EAAM,GAAG,EAAS,KAAK,CAEpM,KAAK,cAAgB,CACjB,QAAS,EACT,MAAQ,GAAiB,CACrB,GAAI,IAAQ,OACR,OAAO,EAAa,KAAK,CAE7B,EAAa,IAAI,EAAI,EAEzB,OAAS,GAAqB,CAC1B,EAAa,KAAK,WAAY,CAAC,EAAQ,EAE3C,UAAa,EAAa,QAAQ,QAAQ,CAC1C,YAAe,GAClB,KACE,CACH,IAAM,EAAO,IAAS,EAAU,KAAO,EAAK,EAAQ,MAAQ,EAC5D,EAAe,EAAE,oBAAoB,EAAO,kBAAkB,GAAG,EAAO,WAAW,iBAAiB,EAAQ,aAAe,EAAS,YAAY,UAAU,EAAK,0BAA0B,EAAM,GAAG,EAAS,cAAc,CAErN,EAAQ,oBACR,EAAa,IAAI,aAAc,EAAQ,kBAAoB,KAAK,CAChE,EAAa,IAAI,aAAc,OAAO,EAG1C,KAAK,cAAgB,CACjB,QAAS,EACT,MAAQ,GAAiB,CACrB,GAAI,IAAQ,OACR,OAAO,EAAa,KAAK,CAE7B,EAAa,IAAI,EAAI,EAEzB,OAAS,GAAqB,CAC1B,EAAa,KAAK,WAAY,CAAC,EAAQ,EAE3C,UAAa,EAAa,QAAQ,QAAQ,CAC1C,YAAe,GAClB,CAGL,OAAO,EAGX,0BAAyC,CAGrC,GAFa,KAAK,QAAQ,SAAS,GAEtB,EAAU,QAAU,CAAC,KAAK,cACnC,OAGJ,IAAM,EAAW,KAAK,cAAc,QACpC,GAAI,CAAC,EAAS,GAAG,WAAW,CACxB,OAGJ,IAAM,EAAK,EAAS,GACd,EAAgB,OAAO,iBAAiB,EAAG,CAC3C,EAAa,WAAW,EAAc,WAAW,EAAI,GACrD,EAAa,WAAW,EAAc,WAAW,EAAI,EACrD,EAAgB,WAAW,EAAc,cAAc,EAAI,EAG3D,EADU,KAAK,QAAQ,YAAY,CACpB,MAAQ,EAE7B,KAAK,gBAAkB,EAAa,EAAa,EACjD,KAAK,cAAgB,EAAG,cAAgB,KAAK,gBAC7C,KAAK,gBAAkB,EAAG,YAC1B,KAAK,kBAAoB,EAAa,EAAO,EAAa,EAG9D,gBAAkC,CAC9B,GAAI,CAAC,KAAK,eAAiB,KAAK,iBAAmB,EAC/C,MAAO,GAGX,IAAM,EAAW,KAAK,cAAc,QACpC,GAAI,CAAC,EAAS,GAAG,WAAW,CACxB,MAAO,GAGX,IAAM,EAAK,EAAS,GACd,EAAgB,EAAG,MAAM,OAE/B,EAAS,IAAI,CACT,SAAU,SACV,MAAO,KAAK,gBAAkB,KAC9B,WAAY,SACZ,OAAQ,KAAK,cAAgB,KAChC,CAAC,CAEF,IAAM,EACF,EAAG,aAAe,KAAK,iBAAmB,EAAG,cAAgB,KAAK,cActE,OAZA,EAAS,IAAI,CACT,SAAU,GACV,MAAO,GACP,WAAY,GACf,CAAC,CAEE,EACA,EAAS,IAAI,SAAU,EAAc,CAErC,EAAS,IAAI,SAAU,GAAG,CAGvB,EAGX,cAA6B,CACzB,IAAM,EAAU,KAAK,QAAQ,YAAY,CAEzC,GAAI,CAAC,KAAK,cACN,OAGJ,IAAM,EAAW,KAAK,cAAc,QACpC,GAAI,CAAC,EAAS,GAAG,WAAW,CACxB,OAGJ,IAAM,EAAK,EAAS,GAEpB,EAAS,IAAI,WAAY,SAAS,CAClC,EAAS,IAAI,SAAU,KAAK,cAAgB,KAAK,CAEjD,IAAM,EAAe,EAAG,aAClB,EAAY,EAAQ,kBACpB,KAAK,IAAI,EAAc,EAAQ,kBAAkB,CACjD,EAEF,IAAc,EAAQ,mBACtB,EAAS,IAAI,WAAY,GAAG,CAGhC,EAAS,IAAI,SAAU,EAAY,KAAK,CAG5C,qBAA6B,EAAsB,EAA+C,CAI9F,OAHI,GAAqB,EAAe,EAC7B,EAEJ,KAAK,IAAI,KAAK,kBAAmB,EAAa,CAGzD,qBAA6B,EAA4B,CAOrD,GANa,KAAK,QAAQ,SAAS,GAEtB,EAAU,MAInB,KAAK,YAAc,EACnB,OAGJ,IAAM,EAAe,KAAK,UAC1B,KAAK,UAAY,EAEb,EACA,KAAK,QAAQ,QAAQ,SAAS,EAAO,mBAAmB,CAExD,KAAK,QAAQ,QAAQ,YAAY,EAAO,mBAAmB,CAG/D,KAAK,QAAQ,UAAU,uBAAuB,EAAa,EAAa,CAG5E,mBAAkC,CAC9B,GAAI,CAAC,KAAK,cACN,OAGJ,IAAM,EAAe,KAAK,cAAc,QAExC,EAAa,GAAG,QAAQ,MAAU,CAC9B,KAAK,kBAAkB,CACvB,KAAK,mBAAmB,CACxB,KAAK,QAAQ,UAAU,SAAS,EAClC,CAEF,EAAa,GAAG,UAAU,EAAK,GAAW,CACtC,KAAK,QAAQ,UAAU,UAAU,EAAE,EACrC,CAEF,EAAa,GAAG,QAAQ,MAAU,CAC9B,KAAK,QAAQ,UAAU,SAAS,EAClC,CAEF,EAAa,GAAG,OAAO,MAAU,CAC7B,KAAK,QAAQ,UAAU,QAAQ,EACjC,GCnWV,IAAMC,GAAuC,CACzC,YAAa,oBACb,aAAc,OACd,oBAAqB,OACrB,gBAAiB,UACjB,iBAAkB,cACrB,CAUD,IAAa,GAAb,MAAa,UAAkB,CAAO,qBACR,CACtB,KAAM,YACN,OAAQ,GACR,KAAM,EAAU,KAChB,YAAa,GACb,MAAO,GACP,OAAQ,GACR,SAAU,GACV,MAAO,GACP,SAAU,OACV,kBAAmB,OACnB,KAAM,EACN,eAAgB,KAChB,QAAS,GACT,aAAc,KACd,iBAAkB,GAClB,mBAAoB,GACpB,mBAAoB,KACpB,iBAAkB,KAClB,iBAAkB,KAClB,SAAUA,GACb,CAuCD,YACI,EACA,EACA,EAAe,EAAO,EAAa,CACnC,EAAc,EAAO,EAAY,CACjC,EAAmB,EAAO,GAAiB,CAC3C,EAAkB,EAAO,EAAgB,CAC3C,CACE,MAAM,EAAgB,EAAE,OAAO,GAAM,EAAE,CAAE,EAAU,QAAS,EAAQ,CAAC,aA7CtD,CACf,EAAO,YACP,EAAO,MACP,EAAO,aACP,EAAO,WACP,EAAO,WACP,EAAO,kBACP,EAAO,kBACP,EAAO,gBACP,EAAO,kBACP,EAAO,mBACP,EAAO,MACP,EAAO,KACP,EAAO,WACP,EAAO,UACP,EAAO,qBACV,aAEwB,iBACG,kBACC,kBACA,qBACE,GAyB3B,KAAK,aAAe,EACpB,KAAK,YAAc,EACnB,KAAK,iBAAmB,EACxB,KAAK,gBAAkB,EAEvB,KAAK,OAAU,KAAK,QAA8B,OAAS,GAC3D,KAAK,SAAY,KAAK,QAA8B,SAAW,GAC/D,KAAK,aAAe,kBAAoB,KAAK,aAAa,MAAM,CAEhE,KAAK,cAAc,CACnB,KAAK,mBAAmB,CACxB,KAAK,oBAAoB,CACzB,KAAK,kBAAkB,CACvB,KAAK,eAAe,CACpB,KAAK,YAAY,mBAAmB,CACpC,KAAK,2BAA2B,CAChC,KAAK,0BAA0B,CAE/B,KAAK,KAAK,KAAK,OAAQ,KAAK,QAAQ,CAE9B,KAAK,QAA8B,QACrC,KAAK,OAAO,GAAM,CAGjB,KAAK,QAA8B,UACpC,KAAK,SAAS,GAAK,CAGnB,KAAK,QAAU,KAAK,UAAU,GAAK,EAAU,MAC7C,KAAK,aAAa,kBAAkB,CAGxC,KAAK,oBAAoB,aAAa,CAM1C,MAAM,EAAkC,CACpC,GAAI,IAAa,OACb,OAAO,KAAK,OAGhB,KAAK,OAAS,EACd,KAAK,aAAa,SAAS,EAAS,CACpC,KAAK,oBAAoB,aAAa,CAO1C,OAAO,EAAmB,GAAY,CAClC,IAAM,EAAU,KAAK,QACrB,EAAQ,OAAS,EAEb,GACA,KAAK,UAAY,GACjB,EAAQ,SAAW,GACnB,KAAK,aAAa,YAAY,GAAM,CACpC,KAAK,QAAQ,YAAY,EAAO,SAAS,EAEzC,KAAK,QAAQ,SAAS,EAAO,SAAS,CAG1C,KAAK,aAAa,OAAO,EAAQ,CACjC,KAAK,cAAc,OAAO,EAAQ,CAClC,KAAK,8BAA8B,CACnC,KAAK,oBAAoB,aAAa,CAEtC,KAAK,qBAAqB,cAAc,CAAE,SAAU,CAAC,EAAS,CAAC,CAC/D,KAAK,qBAAqB,0BAA0B,CAMxD,SAAS,EAAiC,CACtC,GAAI,IAAU,OACV,OAAO,KAAK,UAGhB,KAAK,UAAY,EACjB,IAAM,EAAU,KAAK,QACrB,EAAQ,SAAW,EACnB,KAAK,aAAa,YAAY,EAAM,CAEpC,KAAK,qBAAqB,0BAA0B,CAEpD,KAAK,oBAAoB,aAAa,CACtC,KAAK,cAAc,OAAO,CAAC,EAAM,CACjC,KAAK,8BAA8B,CAMvC,QAAQ,EAAiC,CACrC,GAAI,IAAU,OACV,OAAO,KAAK,SAGhB,KAAK,SAAW,EAEhB,KAAK,qBAAqB,cAAc,CAAE,QAAS,EAAO,CAAC,CAC3D,KAAK,oBAAoB,WAAW,EAAM,CAM9C,OAAc,CACV,KAAK,aAAa,OAAO,CAM7B,MAAa,CACT,KAAK,aAAa,MAAM,CAQ5B,MAAM,EAAoC,CACtC,GAAI,IAAa,OACb,OAAO,KAAK,YAAY,UAAU,CAGtC,KAAK,YAAY,SAAS,EAAS,CAMvC,YAAmB,CACf,KAAK,YAAY,YAAY,CAMjC,SAAgB,CACZ,KAAK,eAAe,CACpB,KAAK,uBAAuB,CAC5B,MAAM,SAAS,CAGnB,uBAAsC,CAClC,KAAK,YAAY,SAAS,CAC1B,KAAK,cAAc,SAAS,CAC5B,KAAK,aAAa,SAAS,CAO/B,WAAW,EAA2C,CAWlD,GAVwB,EAAQ,iBAAmB,QAC/C,EAAQ,qBAAuB,QAC/B,EAAQ,mBAAqB,QAC7B,EAAQ,mBAAqB,QAC7B,EAAQ,eAAiB,QACzB,EAAQ,uBAAyB,QACjC,EAAQ,mBAAqB,QAC7B,EAAQ,qBAAuB,QAC/B,EAAQ,OAAS,OAEA,CACjB,IAAM,EAAe,KAAK,OACpB,EAAa,KAAK,SAClB,EAAe,KAAK,QAA8B,YAClD,EAAe,KAAK,YAAY,UAAU,CAEhD,KAAK,eAAe,CACpB,KAAK,uBAAuB,CAE5B,MAAM,WAAW,EAAe,CAGhC,KAAK,QAAQ,QAAQ,CAErB,KAAK,cAAc,CACnB,KAAK,mBAAmB,CACxB,KAAK,oBAAoB,CACzB,KAAK,kBAAkB,CACvB,KAAK,eAAe,CAGhB,EAAa,OAAS,GACtB,KAAK,YAAY,SAAS,EAAa,CAG3C,KAAK,2BAA2B,CAChC,KAAK,0BAA0B,CAE3B,GACA,KAAK,MAAM,EAAa,CAExB,GACA,KAAK,QAAQ,GAAK,CAElB,IACC,KAAK,QAA8B,YAAc,EAClD,KAAK,YAAY,mBAAmB,EAExC,OAGJ,MAAM,WAAW,EAAe,EAE5B,EAAQ,cAAgB,QAAa,EAAQ,UAAU,cAAgB,SACvE,KAAK,aAAa,mBAAmB,EAGrC,EAAQ,UAAU,eAAiB,QAAa,EAAQ,UAAU,sBAAwB,SAC1F,KAAK,oBAAoB,gBAAgB,CAGzC,EAAQ,SAAW,QACnB,KAAK,OAAO,EAAQ,OAAO,CAG3B,EAAQ,WAAa,QACrB,KAAK,SAAS,EAAQ,SAAS,CAG/B,EAAQ,UAAY,QACpB,KAAK,QAAQ,EAAQ,QAAQ,CAIrC,mBAAkC,CAC9B,KAAK,aAAe,IAAI,GAAa,CACjC,QAAS,KAAK,QACd,eAAkB,KAAK,QACvB,YAAe,KAAK,UAAU,CAC9B,UAAW,CACP,YAAe,KAAK,cAAc,CAClC,UAAY,GAAM,KAAK,eAAe,EAAE,CACxC,YAAe,KAAK,QAAQ,EAAO,WAAW,CAC9C,WAAc,KAAK,QAAQ,EAAO,UAAU,CAC5C,wBAAyB,EAAa,IAAiB,CACnD,KAAK,2BAA2B,EAAY,CAC5C,KAAK,QAAQ,EAAO,qBAAsB,CAAE,cAAa,eAAc,CAAC,EAE/E,CACJ,CAAC,CACF,KAAK,aAAa,MAAM,CAQ5B,2BAAmC,EAA4B,CAE3D,GAAI,CADY,KAAK,QACR,mBACT,OAGJ,IAAM,EAAa,KAAK,QAAQ,KAAK,IAAI,EAAW,WAAW,GAAG,CAC5D,EAAW,KAAK,QAAQ,KAAK,IAAI,EAAW,SAAS,GAAG,CAE1D,MAAC,EAAW,QAAU,CAAC,EAAS,QAIpC,GAAI,EAAa,CACb,IAAM,EAAoB,EAAW,UAAU,CAAC,QAAQ,CACxD,EAAW,SAAS,EAAO,OAAO,CAElC,IAAM,EAAS,EAAE,eAAe,EAAO,OAAO,IAAI,EAAW,YAAY,SAAS,CAElF,EAAS,QAAQ,EAAO,CACxB,EAAS,QAAQ,EAAkB,KAChC,CACH,IAAM,EAAS,EAAS,KAAK,IAAI,EAAW,YAAY,GAAG,CAC3D,GAAI,EAAO,OAAQ,CACf,IAAM,EAAoB,EAAO,SAAS,CAAC,QAAQ,CAEnD,EAAW,OAAO,CAAC,OAAO,EAAkB,CAC5C,EAAW,YAAY,EAAO,OAAO,CAErC,EAAO,QAAQ,GAK3B,oBAAmC,CAC/B,KAAK,cAAgB,IAAI,GAAc,CACnC,QAAS,KAAK,QACd,gCAAoC,KAAK,QAA8B,mBACvE,UAAW,CACP,QAAU,GAAM,KAAK,QAAQ,EAAO,kBAAmB,EAAE,CACzD,MAAQ,GAAM,KAAK,QAAQ,EAAO,gBAAiB,EAAE,CACrD,SAAW,GAAM,CACb,IAAM,EAAa,EAAE,eAAe,IAAI,YAAc,GACtD,GAAI,EAAY,CACZ,IAAM,EAAe,KAAK,QAAU,GAC9B,EAAW,GAAgB,EAAe,IAAM,IAAM,EAC5D,KAAK,MAAM,EAAS,CAExB,KAAK,QAAQ,EAAO,mBAAoB,CAAE,GAAG,EAAG,aAAY,CAAC,EAEjE,QAAU,GAAM,KAAK,QAAQ,EAAO,kBAAmB,EAAE,CAC5D,CACJ,CAAC,CACF,KAAK,cAAc,MAAM,CAG7B,kBAAiC,CAC7B,KAAK,YAAc,IAAI,GAAY,CAC/B,QAAS,KAAK,QACd,eAAkB,KAAK,QACvB,YAAa,KAAK,YAClB,iBAAkB,KAAK,iBACvB,aAAc,KAAK,aACnB,gBAAiB,KAAK,gBACtB,UAAW,CACP,mBAAsB,KAAK,oBAAoB,aAAa,CAC5D,aAAe,GAAU,KAAK,QAAQ,EAAO,WAAY,CAAE,QAAO,CAAC,CACnE,cAAe,EAAM,IAAmB,KAAK,QAAQ,EAAO,WAAY,CAAE,OAAM,MAAO,EAAgB,CAAC,CAC3G,CACJ,CAAC,CACF,KAAK,YAAY,YAAY,CAGjC,2BAA0C,CACtC,KAAK,qBAAuB,IAAI,GAAqB,CACjD,QAAS,KAAK,QACd,eAAkB,KAAK,QACvB,oBAAuB,KAAK,aAAa,YAAY,CACxD,CAAC,CACF,KAAK,qBAAqB,cAAc,CAG5C,0BAAyC,CACrC,KAAK,oBAAsB,IAAI,GAAoB,CAC/C,QAAS,KAAK,QACd,gBAAmB,KAAK,cAAc,CACtC,gBAAoB,KAAK,QAA8B,aACvD,eAAkB,CACd,IAAM,EAAU,KAAK,QACf,EAAiB,CAAC,EAAQ,OAC1B,EAAiB,EAAQ,SACzB,EAAuB,EAAQ,cAAc,SAAW,GAC9D,OAAO,GAAkB,GAAkB,GAE/C,cAAiB,KAAK,SACtB,eAAkB,CAAC,CAAC,KAAK,QAAQ,MAAM,EAAI,KAAK,YAAY,UAAU,CACzE,CAAC,CAMN,UAA2B,CAEvB,OADgB,KAAK,QACN,MAAQ,EAAU,KAMrC,cAA2C,CACvC,IAAM,EAAU,KAAK,QACf,EAAuB,EAAQ,aAC/B,EAA2B,OAAO,EAAQ,kBAAqB,SAAW,EAAQ,iBAAgD,KAClI,EAAe,EAAE,OAAO,EAAE,CAAEA,GAAkB,EAAQ,SAAS,CAUrE,OATI,GAAsB,OACtB,EAAa,aAAe,EAAqB,MAEjD,GAAsB,cACtB,EAAa,oBAAsB,EAAqB,aAExD,GAA0B,OAC1B,EAAa,iBAAmB,EAAyB,MAEtD,EAMX,mBAAqC,CACjC,MAAO,GAMX,yBAA2C,CACvC,IAAM,EAAU,KAAK,QACrB,OAAO,EAAQ,qBAAuB,IAClC,EAAQ,qBAAuB,MAC/B,EAAQ,qBAAuB,QAC9B,OAAO,EAAQ,oBAAuB,UAAY,EAAQ,qBAAuB,KAM1F,uBAAyC,CACrC,IAAM,EAAU,KAAK,QACrB,OAAO,EAAQ,mBAAqB,IAC/B,OAAO,EAAQ,kBAAqB,UAAY,EAAQ,mBAAqB,KAMtF,8BAA6C,CACzC,IAAM,EAAU,KAAK,QACf,EAAmB,KAAK,QAAQ,KAAK,IAAI,EAAW,iBAAiB,GAAG,CAE9E,GAAI,CAAC,EAAiB,OAClB,OAGJ,IAAM,EAAqB,KAAK,8BAA8B,CAC3C,CAAC,EAAQ,QAAU,EAAQ,UAAY,GAAoB,SAAW,IAGrF,EAAiB,SAAS,EAAO,SAAS,CAC1C,EAAiB,KAAK,gBAAiB,OAAO,GAE9C,EAAiB,YAAY,EAAO,SAAS,CAC7C,EAAiB,WAAW,gBAAgB,EAOpD,8BAA8E,CAC1E,IAAM,EAAU,KAAK,QACrB,GAAI,OAAO,EAAQ,kBAAqB,UAAY,EAAQ,mBAAqB,KAC7E,OAAO,EAAQ,iBASvB,cAA6B,CACzB,IAAM,EAAU,KAAK,QACf,EAAW,KAAK,cAAc,CAC9B,EAAO,KAAK,UAAU,CAExB,EAAY,GACZ,IAAS,EAAU,OACnB,EAAY,IAAI,EAAO,sBAChB,IAAS,EAAU,QAC1B,EAAY,IAAI,EAAO,sBAG3B,IAAM,EAAiB,KAAK,uBAAuB,CAW7C,EAA8B,CAChC,YAV8B,CAC9B,mBAAoB,EAAQ,mBAC5B,iBAAkB,EAAQ,iBAC1B,iBAAkB,EAAQ,iBAC7B,CAOG,uBAL2B,KAAK,4BAA4B,CAM5D,qBALyB,KAAK,0BAA0B,CAM3D,CAEK,EAAiB,GACnB,EAAQ,eACR,EACA,KAAK,mBAAmB,CACxB,EACA,KAAK,yBAAyB,CAC9B,EACH,CAED,KAAK,QAAU,KAAK,QAAQ,KAAK,eAAe,EAAO,QAAQ,EAAe,GAAG,EAAO,YAAY,EAAU,uBAAuB,CAAC,QAAQ,CAC9I,KAAK,QAAQ,QAAQ,EAAe,CACpC,KAAK,QAAQ,SAAS,EAAO,OAAO,CACpC,KAAK,QAAQ,MAAM,KAAK,QAAQ,CAOpC,uBAAwC,CACpC,IAAM,EAAU,KAAK,QAMrB,OAJI,EAAQ,SACD,YAAY,EAAQ,WAGxB,GAMX,4BAA0E,CACtE,GAAI,CAAC,KAAK,uBAAuB,CAC7B,OAGJ,IAAM,EAAW,KAAK,8BAA8B,CAChD,EAAS,GAAU,OAQvB,MANI,CAAC,GAAU,GAAU,cAAc,mBAAmB,SACtD,EAAS,EAAS,aAAa,kBAC1B,IAAI,GAAO,EAAI,WAAW,IAAI,CAAG,EAAM,IAAI,IAAM,CACjD,KAAK,IAAI,EAGX,CACH,OAAQ,GAAU,OAClB,YAAa,KAAK,aACV,SACR,SAAU,GAAU,SACpB,WAAY,GAAU,WACZ,WACb,CAML,0BAA0D,CACtD,IAAM,EAAU,KAAK,QACf,EAAe,EAAQ,mBACvB,EAAiB,OAAO,GAAiB,UAAY,EAAwB,EAAe,OAClG,MAAO,CACH,qBAAsB,EAAQ,cAAgB,OAC9C,yBAA0B,KAAK,8BAA8B,CAC7D,2BAA4B,EAC/B,CAML,aAAuB,CACnB,OAAO,KAAK,aAAa,aAAa,CAM1C,eAA8B,CAC1B,KAAK,QAAQ,GAAG,GAAQ,EAAI,IAAI,EAAW,WAAW,GAAK,GAAyB,CAChF,EAAE,gBAAgB,CAClB,KAAK,aAAa,EACpB,CAEF,KAAK,QAAQ,GAAG,GAAQ,EAAI,IAAI,EAAW,iBAAiB,GAAK,GAAyB,CACtF,EAAE,gBAAgB,CAClB,KAAK,YAAY,uBAAuB,EAC1C,CAEF,KAAK,QAAQ,GAAG,GAAQ,EAAI,IAAI,EAAW,uBAAuB,GAAK,GAAyB,CAC5F,EAAE,gBAAgB,CAElB,IAAM,EADS,EAAE,cACE,aAAa,WAAW,CACvC,GACA,KAAK,YAAY,sBAAsB,EAAI,EAEjD,CAEF,KAAK,QAAQ,GAAG,UAAU,EAAK,GAA2B,CACtD,KAAK,eAAe,EAAE,EACxB,CAEF,KAAK,QAAQ,GAAG,WAAW,EAAK,GAA4B,CACxD,KAAK,gBAAgB,EAAE,EACzB,CAMN,eAA8B,CAC1B,KAAK,QAAQ,IAAI,EAAG,CAMxB,eAAuB,EAA8B,CAC5C,KAAK,YACN,KAAK,UAAY,GACjB,KAAK,QAAQ,SAAS,EAAO,MAAM,CACnC,KAAK,QAAQ,EAAO,MAAM,EAOlC,gBAAwB,EAA+B,CACnD,IAAM,EAAgB,EAAE,cAGpB,EAFmB,GAAiB,KAAK,QAAQ,GAAG,SAAS,EAAc,GAExD,KAAK,YACxB,KAAK,UAAY,GACjB,KAAK,QAAQ,YAAY,EAAO,MAAM,CACtC,KAAK,QAAQ,EAAO,KAAK,EAOjC,aAA4B,CACxB,IAAM,EAAU,KAAK,QAErB,GAAI,CAAC,EAAQ,QAAU,EAAQ,UAAY,EAAQ,cAAc,SAAW,GACxE,OAGJ,GAAI,KAAK,SAAU,CAEf,KAAK,QAAQ,EAAO,aADkB,CAAE,WAAY,OAAQ,CAChB,CAC5C,KAAK,QAAQ,GAAM,CACnB,OAGJ,IAAM,EAAQ,KAAK,OACb,EAAW,GAAO,MAAM,CACxB,EAAW,KAAK,YAAY,UAAU,CAE5C,GAAI,CAAC,GAAY,CAAC,EACd,OAGJ,IAAM,EAAgC,CAClC,WAAY,OACZ,MAAO,EAAW,EAAM,MAAM,CAAG,GACjC,MAAO,KAAK,YAAY,UAAU,CACrC,CACD,KAAK,QAAQ,EAAO,aAAc,EAAU,CAE5C,KAAK,MAAM,GAAG,CACd,KAAK,YAAY,CACjB,KAAK,OAAO,CAMhB,cAA6B,CACzB,IAAM,EAAW,KAAK,OACtB,KAAK,OAAS,KAAK,aAAa,UAAU,CAE1C,KAAK,oBAAoB,aAAa,CAEtC,KAAK,QAAQ,EAAO,MAAO,CAAE,MAAO,KAAK,OAAQ,CAAC,CAE9C,IAAa,KAAK,QAClB,KAAK,QAAQ,EAAO,YAAa,CAC7B,WACA,SAAU,KAAK,OAClB,CAAC,CAUV,eAAuB,EAA8B,CACjD,IAAM,EAAO,KAAK,UAAU,CAG5B,GAFgB,EAAE,MAAQ,SAAW,EAAE,QAAU,IAAM,EAAE,UAAY,GAExD,CACT,GAAI,EAAE,UAAY,IAAS,EAAU,OACjC,OAGJ,EAAE,gBAAgB,CAEb,KAAK,UACN,KAAK,aAAa,ICpxBlC,IAAM,GAAW,EAAO,GAAqB,CAC7C,GAAS,eAAe,YAAa,WAAW,CAChD,GAAS,eAAe,YAAa,CAAC,CAClC,KAAM,WACN,OAAQ,GAAS,eACpB,CAAC,CAAC,CCMH,IAAa,GAAb,MAAa,UAAmB,CAAO,qBACT,CACtB,KAAM,aACT,CAoBD,IAAI,kBAAwB,CACxB,OAAO,KAAK,kBAMhB,YACI,EACA,EACA,EACF,CACE,MAAM,EAAS,EAAE,OAAO,GAAM,EAAE,CAAE,EAAW,QAAS,EAAQ,CAAC,aA9BhD,CACfC,EAAO,YACPA,EAAO,MACPA,EAAO,gBACPA,EAAO,6BACPA,EAAO,WACPA,EAAO,WACV,kBAGqB,gBACJ,qBAKiC,KAgB/C,KAAK,QAAU,EACf,KAAK,YAAc,EAAQ,YAC3B,KAAK,YAAc,GAEnB,KAAK,cAAc,CACnB,KAAK,gBAAgB,CACrB,KAAK,eAAe,CACpB,KAAK,QAAU,GAMnB,cAA6B,CACzB,IAAM,EAAU,KAAK,QAGrB,GAFA,KAAK,QAAU,EAAE,eAAeC,EAAO,kBAAkB,UAAU,CAE/D,EAAQ,YAAY,OAAQ,CAC5B,IAAM,EAAa,KAAK,0BAA0B,EAAQ,CACpD,EAAkB,GACpB,EAAQ,YACR,EACA,EAAQ,MAAQ,MACnB,CAED,KAAK,YAAc,KAAK,QAAS,OAAO,EAAgB,CAG5D,KAAK,QAAS,KAAK,IAAIC,EAAW,iBAAiB,GAAG,CAAC,SAASD,EAAO,SAAS,CAChF,KAAK,YAAY,OAAO,KAAK,QAAQ,CAMzC,0BAAkC,EAAyG,CAOvI,OANI,EAAQ,sBACD,EAAQ,sBAEf,EAAQ,sBACD,EAA8B,cAElC,EAA8B,OAMzC,gBAA+B,CAC3B,IAAM,EAAU,KAAK,QACf,EAAW,EAAQ,UAAY,EAAE,CACjC,EAAa,EAAQ,YAAc,EAAE,CACrC,EAAmB,EAAQ,aAC3B,EAAwB,EAAQ,iBAAmB,GAEnD,EAAO,EAAW,MAAQ,OAC1B,EAAoB,EAAW,kBAC/B,EAAO,EAAW,MAAQ,EAE1B,EAAuB,KAAK,yBAAyB,EAAiB,CACtE,EAAuB,KAAK,yBAAyB,EAAQ,CAC7D,EAAyB,KAAK,2BAA2B,EAAS,EAAsB,CAExF,EAAY,IAAI,GAAU,KAAK,QAAS,CACpC,OACa,oBACb,OACN,YAAa,EAAS,YACtB,mBAAoB,EACpB,aAAc,EACd,iBAAkB,EAClB,SAAU,CACN,YAAa,EAAS,YACtB,aAAc,EAAS,YAAc,GAAkB,MAAQ,EAAS,aACxE,oBAAqB,EAAS,mBAAqB,GAAkB,aAAe,GAAkB,UAAY,EAAS,qBAAuB,EAAS,WAC9J,CACD,MAAO,KAAK,OAAO,KAAK,KAAK,CAC7B,aAAc,KAAK,iBAAiB,KAAK,KAAK,CAC9C,WAAY,KAAK,qBAAqB,KAAK,KAAK,CAChD,WAAY,KAAK,qBAAqB,KAAK,KAAK,CACnD,CAAC,CAEF,EAAU,QAAQ,SAAS,KAAK,QAAQ,CAExC,KAAK,kBAAoB,EAM7B,yBAAiC,EAA+B,CAC5D,MAAO,CACH,OAAQ,GACR,KAAM,GAAkB,KACxB,YAAa,GAAkB,aAAe,GAAkB,SAChE,SAAU,GAAkB,SAC5B,QAAS,GAAkB,QAC3B,KAAM,GAAkB,KACxB,WAAY,GAAkB,WAC9B,KAAM,GAAkB,KACxB,YAAa,GAAkB,aAAe,GAAkB,SACnE,CAML,yBAAiC,EAAgD,CAS7E,OARI,EAAQ,eAAiB,GAClB,GAGP,KAAK,QAAQ,aAAa,SAAS,EAAQ,aAAa,CACjD,EAAQ,aAGZ,KAMX,2BAAmC,EAAuB,EAAoC,CAS1F,OARK,EAID,KAAK,QAAQ,aAAa,SAAS,EAAQ,eAAe,CACnD,CAAE,WAAY,GAAM,GAAI,EAAQ,eAA2B,CAG/D,CAAE,WAAY,GAAM,CAPhB,GAaf,iBAAyB,EAAc,CACnC,EAAE,gBAAgB,CAElB,IAAM,EAAa,EAAE,WACf,EAAO,EAAE,OAAS,GAClB,EAAQ,EAAE,OAAS,EAAE,CAE3B,GAAI,IAAe,OAAQ,CAEvB,KAAK,QAAQD,EAAO,YADF,CAAE,WAAY,GAAM,CACK,CAC3C,OAGJ,GAAI,CAAC,EAAK,QAAU,CAAC,EAAM,OACvB,OAGJ,IAAM,EAAY,CAAE,QAAS,CAAE,OAAM,QAAO,CAAE,CAC9C,KAAK,QAAQA,EAAO,YAAa,EAAU,CAM/C,qBAA6B,EAAc,CACvC,IAAM,EAAQ,KAAK,mBAAmB,OAAO,EAAI,EAAE,CACnD,KAAK,QAAQA,EAAO,WAAY,CAAE,QAAO,CAAC,CAM9C,qBAA6B,EAAc,CACvC,KAAK,QAAQA,EAAO,WAAY,CAAE,KAAM,EAAE,KAAM,MAAO,EAAE,MAAO,CAAC,CAMrE,eAA8B,CAC1B,KAAK,QACA,GAAGG,EAAQC,EAAI,IAAIF,EAAW,wBAAwB,GAAI,KAAK,8BAA8B,KAAK,KAAK,CAAC,CACxG,GAAGC,EAAQC,EAAIC,IAAMJ,EAAO,WAAY,KAAK,iBAAiB,KAAK,KAAK,CAAC,CACzE,GAAGE,EAAQC,EAAI,IAAIF,EAAW,iBAAiB,GAAI,KAAK,uBAAuB,KAAK,KAAK,CAAC,CAC1F,GAAGC,EAAQC,EAAI,IAAIF,EAAW,kBAAkB,GAAI,KAAK,wBAAwB,KAAK,KAAK,CAAC,CAEjG,KAAK,2BAA2B,CAMpC,2BAA0C,CACtC,IAAM,EAAkB,KAAK,QAAS,KAAKG,IAAMJ,EAAO,kBAAkB,CACrE,EAAgB,SAIrB,KAAK,aAAe,KAAK,QAAQ,gBAAgB,0BAC7C,EACA,CACI,UAAWG,EAAK,sBAChB,eAAgB,KAAK,YACxB,CACJ,CACD,KAAK,aAAa,QAAQ,EAM9B,UAAkB,CACd,OAAO,KAAK,mBAAmB,OAAO,EAAI,EAAE,CAMhD,SAAS,EAAoB,CACzB,KAAK,mBAAmB,MAAM,EAAM,CAMxC,YAAmB,CACf,KAAK,mBAAmB,YAAY,CAGxC,qBAA4C,CACxC,IAAI,EAAS,KAAK,kBAAmB,QAAQ,KAAK,uBAAuB,CAOzE,OALI,EAAO,SAAW,IAClB,EAAS,EAAE,yGAAyG,CACpH,KAAK,kBAAmB,QAAQ,QAAQ,EAAO,EAG5C,EAMX,gBAAgB,EAAmB,EAA6B,CAC5D,IAAM,EAAU,KAAK,QACf,EAAiB,KAAK,0BAA0B,CAChD,EAAgB,EAAQ,yBAAyB,CACnD,KAAM,EAAQ,KACd,MAAO,EAAQ,MACf,eACA,kBAAmB,GACnB,qBAAsB,GACzB,CAAC,CACI,EAAkB,KAAK,qBAAqB,CAElD,EAAgB,YAAY,WAAW,CAEnC,EAAe,SAAW,EAC1B,EAAgB,QAAQ,EAAc,CAEtC,EAAe,YAAY,EAAc,CAOjD,oBAA2B,CACvB,IAAM,EAAiB,KAAK,0BAA0B,CAClD,EAAe,OAAS,IACxB,EAAe,QAAQ,CACvB,KAAK,yBAAyB,EAItC,yBAAwC,CACpC,IAAM,EAAkB,KAAK,qBAAqB,CAC5C,EAAQ,KAAK,mBAAmB,OAAO,CACvC,EAAW,GAAS,EAAM,OAAS,EACnC,EAAW,KAAK,0BAA0B,CAAC,OAAS,EAEtD,CAAC,GAAY,CAAC,GACd,EAAgB,SAAS,WAAW,CAO5C,0BAAyC,CACrC,OAAO,KAAK,qBAAqB,CAAC,KAAK,IAAIF,EAAW,6BAA6B,GAAG,CAG1F,QAAQ,EAAiC,CACrC,GAAI,IAAU,OACV,OAAO,KAAK,YAGhB,KAAK,YAAc,EACnB,KAAK,kBAAmB,QAAQ,EAAM,CAG1C,MAAM,EAAkC,CACpC,GAAI,IAAa,OACb,OAAO,KAAK,gBAAgB,CAGhC,KAAK,eAAe,EAAS,CAIjC,OAAe,EAAe,CAC1B,IAAM,EAAe,GAAG,OAAS,KAAK,gBAAgB,CACtD,KAAK,QAAQF,EAAO,MAAO,CAAE,MAAO,EAAc,CAAC,CAGvD,8BAAsC,EAAc,CAChD,EAAE,gBAAgB,CAClB,KAAK,QAAQA,EAAO,6BAA6B,CAGrD,iBAAyB,EAAc,CACnC,EAAE,gBAAgB,CAClB,IAAM,EAAU,KAAK,QACf,EAAO,EAAE,EAAE,OAAO,CAAC,QAAQK,IAAMJ,EAAO,WAAW,CAAC,MAAM,CAChE,KAAK,QAAQD,EAAO,gBAAiB,CAAE,OAAM,SAAU,EAAQ,qBAAuB,OAAQ,CAAC,CAC3F,EAAQ,sBAAwB,UAChC,KAAK,eAAe,EAAK,CAIjC,gBAAiC,CAC7B,OAAO,KAAK,kBAAmB,OAAO,CAG1C,eAAuB,EAAqB,CACxC,KAAK,kBAAmB,MAAM,EAAM,CAGxC,uBAA+B,EAAc,CACzC,EAAE,gBAAgB,CAClB,IAAM,EAAS,EAAE,EAAE,cAAc,CAC3B,EAAoB,KAAK,QAAS,KAAK,IAASC,EAAO,oBAAoB,CAC3E,EAAS,KAAK,QAAyB,MAAQ,MAE/C,EAAW,KAAK,QAAQ,gBAAgB,cAAc,EAAmB,EAAQ,IAAkB,KAAiB,CAE1H,KAAK,QAAS,KAAK,IAAIC,EAAW,kBAAkB,GAAG,CAAC,YAAYD,EAAO,SAAS,CAEhF,EAAS,SACT,EAAO,SAASA,EAAO,SAAS,CAIxC,wBAAgC,EAAc,CAC1C,EAAE,gBAAgB,CAClB,IAAM,EAAS,EAAE,EAAE,cAAc,CAC3B,EAAoB,KAAK,QAAS,KAAK,IAASA,EAAO,oBAAoB,CAC3E,EAAS,KAAK,QAAyB,MAAQ,MAE/C,EAAW,KAAK,QAAQ,gBAAgB,cAAc,EAAmB,EAAQ,KAAmB,IAAgB,CAE1H,KAAK,QAAS,KAAK,IAAIC,EAAW,iBAAiB,GAAG,CAAC,YAAYD,EAAO,SAAS,CAE/E,EAAS,OACT,EAAO,SAASA,EAAO,SAAS,CAIxC,SAAgB,CACR,KAAK,cACL,KAAK,aAAa,SAAS,CAG3B,KAAK,mBACL,KAAK,kBAAkB,SAAS,CAGpC,KAAK,QAAS,QAAQ,GC1ajB,GAAb,MAAa,UAAoB,CAAO,qBACnB,CACb,KAAM,kBACN,OAAQ,IAASM,EAAO,aACxB,WAAY,EAAE,CACd,sBAAuB,GAC1B,CAOD,YAAY,EAAuB,EAAc,CAC7C,MAAM,EAAS,EAAE,OAAO,GAAM,EAAE,CAAE,EAAY,QAAS,EAAQ,CAAC,CAEhE,KAAK,sBAAsB,CAC3B,KAAK,QAAQ,CACb,KAAK,cAAc,CAMvB,QAAuB,CACnB,KAAK,KAAO,IAAI,MAAM,GAAG,YAAY,KAAK,QAAS,KAAK,QAAQ,CAMpE,cAA6B,CACzB,KAAK,KACA,KAAK,SAAU,KAAK,SAAS,KAAK,KAAK,CAAC,CACxC,KAAK,OAAQ,KAAK,OAAO,KAAK,KAAK,CAAC,CACpC,KAAK,QAAS,KAAK,QAAQ,KAAK,KAAK,CAAC,CAM/C,sBAAqC,CAChC,KAAK,QAAgB,WAAW,QAAS,GAAc,CACpD,EAAK,KAAO,EAAK,MAAQ,EAAE,CAC3B,EAAK,KAAK,gBAAkB,EAAK,KAAK,aAAa,EACrD,CAMN,SAAiB,EAAc,CAC3B,IAAM,EAAO,EAAE,EAAE,KAAK,CAChB,EAAU,EAAE,EAAE,OAAO,CAAC,QAAQD,IAAMC,EAAO,QAAQ,CACnD,EAAU,EAAK,KAAK,UAAU,CAEhC,GACA,KAAK,eAAe,EAAS,EAAM,EAAQ,CAOnD,OAAO,EAAc,CACjB,IAAI,EAAY,GACV,EAAS,EAAE,EAAE,OAAO,CACpB,EAAiB,EAAE,EAAE,OAAO,OAAO,CAAC,OAAS,EAAE,EAAE,MAAM,OAAO,CAAG,EAEjE,EAAmB,EAAO,QAAQD,IAAMC,EAAO,eAAe,CAAC,OAAS,EACxE,EAAqB,EAAO,KAAKD,IAAMC,EAAO,gBAAgB,CAAC,OAAS,EACxE,EAAyB,EAAe,QAAQ,IAAIC,EAAW,eAAe,GAAG,CAAC,OAAS,EAC3F,EAAU,EAAO,QAAQF,IAAMC,EAAO,QAAQ,EAEhD,GAAoB,GAAsB,GAA0B,CAAC,EAAQ,UAC7E,EAAE,gBAAgB,CAClB,EAAY,IAGhB,EAAO,YAAYA,EAAO,OAAQ,EAAU,CAC5C,KAAK,QAAQ,OAAQ,CAAE,UAAS,CAAC,CAMrC,QAAgB,EAAc,CAC1B,IAAM,EAAS,EAAE,EAAE,OAAO,CACpB,EAAU,EAAO,QAAQD,IAAMC,EAAO,QAAQ,CACpD,EAAO,YAAYA,EAAO,OAAO,CACjC,KAAK,QAAQ,QAAS,CAAE,UAAS,CAAC,CAMtC,eAAuB,EAAiB,EAAoB,EAA6B,CACrF,KAAK,QAAQ,UAAW,CAAE,KAAM,EAAS,OAAM,UAAS,CAAC,CAM7D,uBAAuB,EAAwB,CAC3C,IAAM,EAAa,KAAK,QAAQ,KAAK,0BAA0B,CAC3D,EAAW,QACX,EAAW,YAAYA,EAAO,OAAQ,CAAC,EAAQ,CAIvD,SAAgB,CACR,KAAK,OACL,KAAK,KAAK,SAAS,CACnB,KAAK,KAAO,KACZ,KAAK,QAAQ,QAAQ,IC9GpB,GAAb,KAA4B,CAGxB,YAAY,EAAiC,CACzC,KAAK,QAAU,EAGnB,eAAe,EAAc,CACzB,IAAM,EAAU,KAAK,QAAQ,SAAS,EAAE,QAAQ,CAC1C,EAAO,KAAK,QAAQ,aAAa,EAAU,EAAE,KAAK,CAClD,EAAO,EAAE,KAEf,GAAK,EAeE,CACH,OAAQ,EAAR,CACI,KAAK,EAAS,SACV,KAAK,QAAQ,QAAQE,EAAO,SAAU,CAAE,MAAO,CAAC,EAAK,CAAE,UAAS,CAAC,CACjE,MAER,KAAK,QAAQ,QAAQA,EAAO,eAAgB,CAAE,OAAM,OAAM,UAAS,CAAC,MApBpE,OAAQ,EAAR,CACI,KAAK,EAAS,MACV,KAAK,aAAa,EAAS,CAC3B,MACJ,KAAK,EAAS,KACV,KAAK,YAAY,EAAS,CAC1B,MACJ,KAAK,EAAS,IACV,KAAK,WAAW,EAAS,CACzB,MACJ,KAAK,EAAS,OACV,KAAK,cAAc,EAAS,CAC5B,OAYhB,mBAAmB,EAAc,CAC7B,KAAK,eAAe,EAAE,CACtB,IAAM,EAAU,KAAK,QAAQ,SAAS,EAAE,QAAQ,CAC1C,EAAO,EAAE,KACf,KAAK,QAAQ,QAAQA,EAAO,kBAAmB,CAAE,OAAM,UAAS,CAAC,CAGrE,aAAa,EAAyB,CAClC,IAAM,EAAe,EAAQ,WAAa,KAAK,QAAQ,WAAW,CAClE,KAAK,QAAQ,yBAAyB,EAAQ,GAAG,CACjD,KAAK,QAAQ,gBAAgB,EAAS,EAAa,CACnD,KAAK,QAAQ,qBAAqB,CAGtC,YAAY,EAAyB,CAC7B,WAAa,UAAU,WACvB,UAAU,UAAU,UAAU,EAAQ,KAAK,CAInD,WAAW,EAAyB,CAChC,KAAK,QAAQ,WAAW,EAAQ,CAGpC,cAAc,EAAyB,CACnC,KAAK,QAAQ,cAAc,EAAQ,CAGvC,uBAAuB,EAAc,CACjC,IAAM,EAAU,KAAK,QAAQ,SAAS,EAAE,QAAQ,CAEhD,GAAI,CAAC,EACD,OAGJ,IAAM,EAAW,EAAQ,WAAa,KAAK,QAAQ,WAAW,CAC9D,KAAK,QAAQ,uBAAuB,EAAS,GCrDxC,GAAb,KAAyB,CAGrB,YAAY,EAA8B,CACtC,KAAK,QAAU,EAGnB,QAAe,CACX,KAAK,mBAAmB,CACxB,KAAK,yBAAyB,CAC9B,KAAK,0BAA0B,CAC/B,KAAK,yBAAyB,CAGlC,mBAAkC,CAC9B,IAAM,EAAM,KAAK,QAEjB,EAAI,KACC,KAAK,uBAAyB,GAAc,CAEzC,GADgB,EAAI,QACR,sBAAwB,SAChC,EAAI,MAAM,EAAK,KAAK,CACpB,EAAI,QAAQC,EAAO,gBAAiB,CAAE,KAAM,EAAK,KAAM,CAAC,KACrD,CACH,IAAM,EAAU,CAAE,KAAM,EAAK,KAAM,MAAO,EAAE,CAAE,CAC9C,EAAI,QAAQA,EAAO,YAAa,CAAE,UAAS,CAAC,CAC5C,EAAI,YAAY,EAAQ,GAE9B,CACD,KAAK,wBAA0B,GAAc,CAC1C,IAAM,EAAU,EAAI,SAAS,EAAK,QAAQ,CAC1C,EAAI,eAAe,CAAE,KAAM,EAAK,KAAM,QAAS,EAAK,QAAS,CAAC,CAC9D,EAAI,QAAQA,EAAO,cAAe,CAAE,KAAM,EAAK,KAAM,UAAS,CAAC,EACjE,CACD,KAAK,kBAAoB,GAAc,CACpC,EAAI,eAAe,EAAK,EAC1B,CACD,KAAK,mBAAqB,GAAc,CACrC,IAAM,EAAU,EAAI,SAAS,EAAK,eAAe,CACjD,EAAI,QAAQA,EAAO,SAAU,CAAE,MAAO,GAAS,MAAO,UAAS,CAAC,EAClE,CACD,KAAK,mBAAqB,GAAc,CACrC,EAAI,cAAc,8BAA8B,EAAK,UAAW,EAAK,WAAW,EAClF,CAGV,yBAAwC,CACpC,IAAM,EAAM,KAAK,QAEjB,EAAI,WACC,KAAK,QAAU,GAAc,CAC1B,EAAI,QAAQA,EAAO,MAAO,CAAE,MAAO,EAAK,MAAO,CAAC,EAClD,CACD,KAAK,cAAgB,GAAc,CAChC,IAAM,EAAa,EAAK,WAExB,GAAI,EACA,EAAI,QAAQA,EAAO,YAAa,CAAE,aAAY,CAAC,KAC5C,CACH,IAAM,EAAU,CAAE,KAAM,EAAK,MAAQ,EAAK,SAAS,KAAM,MAAO,EAAK,OAAS,EAAK,SAAS,OAAS,EAAE,CAAE,CACzG,EAAI,QAAQA,EAAO,YAAa,CAAE,UAAS,CAAC,CAC5C,EAAI,YAAY,EAAQ,CACxB,EAAI,iBAAiB,GAE3B,CACD,KAAK,kBAAoB,GAAc,CAEpC,GADA,EAAI,QAAQA,EAAO,gBAAiB,CAAE,KAAM,EAAK,KAAM,CAAC,CACpD,EAAK,WAAa,SAAU,CAC5B,IAAM,EAAU,CAAE,KAAM,EAAK,KAAM,MAAO,EAAE,CAAE,CAC9C,EAAI,QAAQA,EAAO,YAAa,CAAE,UAAS,CAAC,CAC5C,EAAI,YAAY,EAAQ,GAE9B,CACD,KAAK,aAAe,GAAc,CAC/B,EAAI,QAAQA,EAAO,WAAY,CAAE,MAAO,EAAK,MAAO,CAAC,EACvD,CACD,KAAK,aAAe,GAAc,CAC/B,EAAI,QAAQA,EAAO,WAAY,CAAE,KAAM,EAAK,KAAM,MAAO,EAAK,MAAO,CAAC,EACxE,CACD,KAAK,mCAAsC,CACxC,EAAI,iBAAiB,EACvB,CAGV,0BAAyC,CACrC,IAAM,EAAM,KAAK,QAEjB,EAAI,mBACC,KAAK,UAAW,EAAI,mBAAmB,KAAK,EAAI,CAAC,CACjD,KAAK,OAAQ,EAAI,uBAAuB,KAAK,EAAI,CAAC,CAG3D,yBAAwC,CACpC,IAAM,EAAM,KAAK,QAEjB,EAAI,QAAQ,GAAGC,EAAQC,EAAI,IAAIC,EAAW,yBAAyB,OAAU,CACzE,EAAI,QAAQH,EAAO,MAAO,CAAE,QAAS,EAAI,kBAAkB,CAAE,CAAC,CAC9D,EAAI,oBAAoB,EAC1B,CAEF,EAAI,QAAQ,GAAGC,EAAQC,EAAI,IAAIC,EAAW,2BAA2B,GAAK,GAAW,CAKjF,GAJI,EAAE,EAAE,OAAO,CAAC,QAAQ,IAAIA,EAAW,yBAAyB,GAAG,CAAC,QAIhE,EAAE,EAAE,OAAO,CAAC,GAAG,IAAI,CACnB,OAEA,EAAE,gBAAgB,CAClB,EAAE,iBAAiB,CAGvB,IAAM,EAAgB,EAAI,kBAAkB,CAExC,GAAiB,EAAc,KAC/B,EAAI,gBAAgB,EAAc,IAAI,EAE5C,CAEF,EAAI,QAAQ,GAAGF,EAAQC,EAAI,IAAIC,EAAW,6BAA6B,GAAK,GAAW,CACnF,GAAI,EAAE,EAAE,OAAO,CAAC,GAAG,IAAI,CACnB,OAEA,EAAE,gBAAgB,CAClB,EAAE,iBAAiB,CAGvB,IAAM,EAAiB,EAAE,EAAE,cAAc,CAAC,QAAQC,IAAMC,EAAO,QAAQ,CACjE,EAAiB,EAAI,SAAS,EAAe,CAEnD,GAAI,GAAkB,EAAe,UAAW,CAC5C,IAAM,EAAkB,EAAI,eAAe,EAAe,UAAU,CAEhE,GAAmB,EAAgB,KACnC,EAAI,gBAAgB,EAAgB,IAAI,GAGlD,CAEF,EAAI,QAAQ,GAAGC,UAAUJ,EAAK,GAAW,CACrC,EAAI,cAAc,cAAc,EAAU,EAAI,cAAc,EAC9D,CAEF,EAAI,QAAQ,GAAG,QAAQA,IAAM,IAAIG,EAAO,SAAW,GAAW,CAC1D,IAAM,EAAgB,EAAE,EAAE,OAAO,CAE7B,OAAc,KAAK,IAAIA,EAAO,kBAAkB,CAAC,OAAS,IAI1D,EAAc,KAAK,sBAAsB,GAAK,OAAQ,CACtD,IAAM,EAAiB,EAAc,QAAQ,IAAIA,EAAO,UAAU,CAC5D,EAAU,EAAI,SAAS,EAAe,CAExC,GAAW,EAAQ,KACnB,EAAI,gBAAgB,EAAQ,IAAI,GAG1C,GC3JV,IAAM,GAAyC,CAC3C,CAAE,KAAM,EAAS,MAAO,KAAM,QAAS,KAAME,EAAM,KAAM,CACzD,CAAE,KAAM,EAAS,KAAM,KAAM,OAAQ,KAAMA,EAAM,KAAM,CACvD,CAAE,KAAM,EAAS,IAAK,KAAM,MAAO,KAAMA,EAAM,IAAK,CACpD,CAAE,KAAM,EAAS,OAAQ,KAAM,SAAU,KAAMA,EAAM,MAAO,CAC/D,CAEK,GAAsC,CACxC,CAAE,KAAM,EAAS,SAAU,KAAM,WAAY,KAAMA,EAAM,SAAU,CACtE,CAEK,GAAmB,CACrB,iBAAkB,eAClB,YAAa,oBACb,WAAY,eACZ,kBAAmB,OACnB,aAAc,eACd,oBAAqB,OACrB,WAAY,OACZ,mBAAoB,wBACpB,WAAY,cACZ,YAAa,eACb,mBAAoB,4BACpB,oBAAqB,0CACrB,eAAgB,kBAChB,gBAAiB,yBACjB,yBAA0B,gBAC1B,wBAAyB,eACzB,eAAgB,YAChB,aAAc,QACjB,CAED,IAAa,GAAb,MAAa,UAAa,CAAqB,qBACH,CACpC,KAAM,OACN,aAAc,GACd,SAAU,GACV,qBAAsB,GACtB,aAAc,GACd,WAAY,GACZ,oBAAqB,SACrB,oBAAqB,SACrB,SAAU,KACV,sBAAuB,GACvB,2BAA4B,GAC5B,sBAAuB,SACvB,2BAA4B,SAC5B,aAAc,GACd,eAAgB,GAChB,qBAAsB,GACtB,QAAS,GACT,WAAY,CACR,KAAM,QACN,kBAAmB,IACtB,CACD,sBAAuB,EAAE,CACzB,eAAgB,GAChB,YAAa,GACb,YAAa,EAAE,CACf,YAAa,EAAE,CACf,IAAK,MACL,kBAAmB,kBACnB,MAAO,KACP,OAAQ,KACR,SAAU,GACV,iBAAkB,WAClB,gBAAiB,KACjB,qBAAsB,GACtB,yBAA0B,GAC1B,cAAe,GACf,oBAAqB,GACrB,yBAA0B,GAC1B,kBAAmB,KACnB,sBAAuB,KACvB,sBAAuB,KACvB,eAAgB,KAChB,eAAgB,KAChB,uBAAwB,KACxB,sBAAuB,KACvB,wBAAyB,KACzB,6BAA8B,KAC9B,+BAAgC,KAChC,mBAAoB,KACpB,mBAAoB,KACpB,mBAAoB,KACpB,sBAAuB,KACvB,wBAAyB,KACzB,aAAc,KACd,iBAAkB,OAClB,gBAAiB,WACjB,UAAW,OACX,cAAe,WACf,gBAAiB,aACjB,oBAAqB,iBACrB,wBAAyB,qBACzB,QAAS,KACT,eAAgB,YAChB,WAAY,QACZ,eAAgB,YAChB,eAAgB,YAChB,cAAe,WACf,cAAe,WACf,YAAa,SACb,YAAa,SACb,iBAAkB,cAClB,sBAAuB,mBACvB,iBAAkB,GACrB,CA0CD,YACI,EACA,EACA,EACA,EAAe,EAAO,EAAa,CACnC,EAAkB,EAAO,EAAgB,CACzC,EAAc,EAAO,EAAY,CACjC,EAAoB,EAAO,GAAkB,CAC/C,CACE,IAAqB,EAAE,CACvB,EAAK,wBAAwB,EAAS,EAAK,QAAS,iBAAiB,CACrE,EAAK,wBAAwB,EAAS,EAAK,QAAS,cAAc,CAElE,MAAM,EAAS,EAAE,OAAO,GAAM,EAAE,CAAE,EAAK,QAAS,EAAQ,CAAC,4BA9Cd,qBAC1B,iBAEF,eAOA,CACfC,EAAO,YACPA,EAAO,gBACPA,EAAO,MACPA,EAAO,MACPA,EAAO,cACPA,EAAO,eACPA,EAAO,kBACPA,EAAO,SACPA,EAAO,WACPA,EAAO,WACPA,EAAO,cACPA,EAAO,cACV,CAyBG,KAAK,aAAe,EACpB,KAAK,gBAAkB,EACvB,KAAK,YAAc,EACnB,KAAK,kBAAoB,EACxB,KAAK,QAAyB,eAAiB,EAAQ,eACvD,KAAK,QAAyB,YAAc,EAAQ,YAEjD,IACA,KAAK,QAAU,GAGnB,KAAK,MAAM,EAAQ,CAGvB,OAAO,wBACH,EACA,EACA,EACI,CACJ,IAAM,EAAc,EAAQ,GAE5B,GAAI,MAAM,QAAQ,EAAY,CAAE,CAC5B,IAAM,EAAiB,EAAe,IAAa,EAAE,CAC/C,EAA0C,EAAE,CAElD,IAAK,IAAM,KAAU,EACjB,EAAW,EAAO,MAAQ,CAAE,GAAG,EAAQ,CAG3C,EAAQ,GAAY,EAAY,IAAI,GAC5B,EAAW,QAAQ,EACZ,CAAE,GAAG,EAAW,EAAW,MAAO,GAAG,EAAY,CAErD,CAAE,GAAG,EAAY,CAC1B,MAEF,EAAQ,GAAY,EAAe,IAAa,EAAE,CAI1D,MAAc,EAAsC,CAChD,KAAK,sBAAwB,KAC7B,KAAK,WAAa,CAAC,CAAE,EAAQ,aAAa,OAE1C,KAAK,WAAW,CAChB,KAAK,cAAc,CACnB,KAAK,iBAAiB,CACtB,KAAK,WAAW,CAEZ,GAAS,SACT,KAAK,aAAa,aAAa,4CAA6C,OAAO,CAGvF,KAAK,iBAAiB,CACtB,KAAK,YAAY,CACjB,KAAK,oBAAoB,CAEzB,KAAK,eAAe,CAEhB,KAAK,QAAQ,SACb,KAAK,QAAQ,GAAK,CAGlB,KAAK,QAAQ,UACb,KAAK,WAAW,OAAO,CAG3B,KAAK,gBAAgB,CAGzB,WAA0B,CACtB,IAAM,EAAU,KAAK,QAErB,GAAI,EAAQ,SAAU,CAClB,EAAQ,SAAW,EAAQ,SAAS,UAAU,CAC9C,OAGJ,EAAQ,SAAW,KAAK,aAAa,MAAM,CAG/C,cAA6B,CACzB,IAAM,EAAU,KAAK,QACf,EAAS,EAAQ,OACjB,EAAQ,EAAQ,MAChB,EAAc,EAAQ,YACtB,EAAiB,EAAQ,eACzB,EAAa,QAAQC,EAAW,YAAY,SAElD,KAAK,QAAU,KAAK,QACf,SAASC,EAAO,QAAQ,CACxB,KAAK,MAAO,EAAQ,IAAI,CACxB,OAAO,EAAW,EAEnB,KAAK,YAAc,IACnB,KAAK,QAAQ,QAAQC,GAAa,EAAa,EAAe,CAAC,CAG/D,GACA,KAAK,QAAQ,IAAI,CACL,SACR,UAAW,EACd,CAAC,CAGF,GACA,KAAK,QAAQ,IAAI,CACN,QACP,SAAU,EACb,CAAC,CAIV,iBAAgC,CAC5B,KAAK,gBAAkB,KAAK,QAAQ,KAAK,KAAK,CAE9C,KAAK,aAAe,IAAI,GAAY,CAChC,YAAa,KAAK,QAClB,aAAc,KAAK,aACtB,CAAC,CACF,KAAK,WAAa,KAAK,aAAa,eAAe,CAEnD,KAAK,WAAW,KAAKC,GAAQ,KAAK,gBAAgB,CAGtD,mBAAkC,CAC9B,KAAK,WAAW,OAAOA,GAAQ,KAAK,gBAAgB,CACnD,KAAa,aAAe,KAGjC,WAA0B,CACtB,IAAM,EAAU,EAAE,OAAO,GAAM,EAAE,CAAE,KAAK,QAAQ,CAChD,OAAO,EAAQ,KAIf,KAAK,KAAO,IAAI,GAFA,KAAK,QAAS,KAAK,IAAIH,EAAW,YAAY,GAAG,CAE/B,EAAS,CACvC,YAAa,KAAK,aAClB,gBAAiB,KAAK,gBACtB,YAAa,KAAK,YAClB,kBAAmB,KAAK,kBAC3B,CAAC,CAGN,iBAAgC,CAC5B,IAAM,EAAU,EAAE,OAAO,GAAM,EAAE,CAAE,KAAK,QAAQ,CAChD,OAAO,EAAQ,KAEf,KAAK,WAAa,IAAI,GAAW,EAAE,wBAAwB,CAAE,EAAS,CAClE,YAAa,KAAK,QAClB,aAAc,KAAK,aACnB,gBAAiB,KAAK,gBACzB,CAAC,CAGN,YAA2B,CAEvB,IAAM,EADU,KAAK,QACU,eAE/B,KAAK,mBAAqB,IAAI,GAAY,EAAE,YAAY,CAAE,CAAE,WAAY,EAAgB,CAAC,CAG7F,oBAAmC,CAC/B,KAAK,cAAgB,IAAI,GAAoB,CACzC,QAAS,KAAK,QACd,eAAkB,KAAK,QACvB,aAAc,KAAK,aACtB,CAAC,CAEF,KAAK,cAAc,qBAAqB,CACxC,KAAK,cAAc,0BAA0B,CAGjD,eAA8B,CAC1B,KAAK,gBAAkB,IAAI,GAAe,CACtC,UAAW,KAAK,UAAU,KAAK,KAAK,CACpC,SAAU,KAAK,SAAS,KAAK,KAAK,CAClC,aAAc,KAAK,aAAa,KAAK,KAAK,CAC1C,cAAe,KAAK,cAAc,KAAK,KAAK,CAC5C,WAAa,GAAsB,KAAK,aAAa,WAAW,EAAQ,CACxE,iBAAkB,EAAmB,IAA0B,KAAK,WAAW,gBAAgB,EAAS,EAAa,CACrH,yBAA2B,GAAe,CAAE,KAAK,sBAAwB,GACzE,wBAA2B,KAAK,cAAc,qBAAqB,CACnE,uBAAyB,GAAsB,KAAK,mBAAmB,uBAAuB,EAAS,CACvG,QAAS,KAAK,QAAQ,KAAK,KAAK,CACnC,CAAC,CAEF,KAAK,aAAe,IAAI,GAAY,CAChC,QAAS,KAAK,QACd,QAAS,KAAK,QACd,KAAM,KAAK,KACX,WAAY,KAAK,WACjB,mBAAoB,KAAK,mBACzB,MAAO,KAAK,MAAM,KAAK,KAAK,CAC5B,YAAa,KAAK,YAAY,KAAK,KAAK,CACxC,gBAAiB,KAAK,gBAAgB,KAAK,KAAK,CAChD,eAAgB,KAAK,gBAAgB,eAAe,KAAK,KAAK,gBAAgB,CAC9E,mBAAoB,KAAK,gBAAgB,mBAAmB,KAAK,KAAK,gBAAgB,CACtF,uBAAwB,KAAK,gBAAgB,uBAAuB,KAAK,KAAK,gBAAgB,CAC9F,SAAU,KAAK,SAAS,KAAK,KAAK,CAClC,gBAAiB,KAAK,gBAAgB,KAAK,KAAK,CAChD,mBAAoB,KAAK,mBAAmB,KAAK,KAAK,CACtD,qBAAwB,KAAK,aAAa,kBAAkB,CAC5D,eAAiB,GAAe,KAAK,aAAa,eAAe,EAAG,CACpE,QAAS,KAAK,QAAQ,KAAK,KAAK,CAChC,cAAe,KAAK,cACpB,cAAe,KAAK,WACvB,CAAC,CAEF,KAAK,aAAa,QAAQ,CAE1B,KAAK,KAAK,KAAK,OAAQ,KAAK,QAAQ,CAGxC,WAAoB,CAChB,OAAQ,KAAK,QAAyB,SAQ1C,MAAM,EAAkC,CACpC,GAAI,IAAa,OACb,OAAO,KAAK,YAAY,OAAO,EAAI,GAGnC,KAAK,aACL,KAAK,WAAW,MAAM,EAAS,CAC/B,KAAK,QAAQD,EAAO,MAAO,CAAE,MAAO,EAAU,CAAC,EAOvD,WAAW,EAAsC,CAC7C,MAAM,WAAW,EAAQ,CACzB,KAAK,SAAS,CACd,IAAM,EAAO,IAAI,EAAK,KAAK,QAAS,KAAK,QAAiC,CAC1E,OAAO,OAAO,KAAM,EAAK,CAM7B,cAAc,EAAuB,CAC7B,KAAK,YACL,KAAK,mBAAmB,CAG5B,KAAK,KAAK,eAAe,CAExB,KAAK,QAAyB,WAAa,EAE5C,KAAK,iBAAiB,CAEjB,KAAK,QAAyB,UAC/B,KAAK,WAAW,OAAO,CAGvB,KAAK,MACL,KAAK,KAAK,mBAAmB,KAAK,aAAa,CAOvD,YAAY,EAA+C,CAQvD,OAPI,KAAK,wBACD,OAAO,GAAY,WACnB,EAAU,CAAE,KAAM,EAAS,EAE/B,EAAQ,UAAY,KAAK,uBAGtB,KAAK,aAAa,YAAY,EAAS,KAAK,WAAW,CAAC,CAMnE,cAAc,EAA4B,CACtC,OAAO,KAAK,aAAa,cAAc,EAAQ,CAMnD,cAAc,EAAmB,EAA6C,CAC1E,OAAO,KAAK,aAAa,cAAc,EAAS,EAAQ,CAM5D,gBAAgB,EAA8B,CAC1C,OAAO,KAAK,aAAa,gBAAgB,EAAI,CAMjD,SAAS,EAAwC,CAC7C,OAAO,KAAK,KAAK,SAAS,EAAQ,CAMtC,aAAa,EAAmB,EAAkC,CAC9D,OAAO,KAAK,KAAK,aAAa,EAAS,EAAK,CAMhD,eAAsB,CAClB,KAAK,KAAK,eAAe,CAO7B,cAAc,EAAyB,CACnC,KAAK,KAAK,cAAc,EAAQ,CAChC,KAAK,cAAc,0BAA0B,CAQjD,oBAAoB,EAAyB,CACzC,IAAM,EAAe,EAAQ,WAAa,KAAK,WAAW,CACpD,EAAU,KAAK,QACf,EAAuB,EAAE,EAAQ,yBAAyB,CAC5D,KAAM,EAAQ,KACd,MAAO,EAAQ,MACf,UAAW,EAAQ,UACnB,eACA,SAAU,EAAQ,SAClB,aAAc,GACd,kBAAmB,GACnB,qBAAsB,GACzB,CAAC,CAAC,CAEH,KAAK,QAAS,KAAK,IAAIC,EAAW,2BAA2B,GAAG,CAAC,QAAQ,CAEzE,IAAM,EAAc,KAAK,QAAS,KAAKI,IAAMH,EAAO,YAAY,CAC5D,EAAY,OACZ,EAAY,QAAQ,EAAqB,CAClC,KAAK,WACZ,EAAqB,YAAY,KAAK,QAAS,KAAKG,IAAMH,EAAO,OAAO,CAAC,CAEzE,KAAK,QAAS,QAAQ,EAAqB,CAG/C,KAAK,KAAK,eAAe,EAAqB,CAMlD,oBAA2B,CACvB,KAAK,aAAa,oBAAoB,CACtC,KAAK,QAAS,KAAKG,IAAMH,EAAO,cAAc,CAAC,QAAQ,CAM3D,iBAAwB,CACpB,KAAK,WAAW,oBAAoB,CACpC,KAAK,sBAAwB,KAMjC,gBAAuB,CACnB,KAAK,KAAK,gBAAgB,CAM9B,gBAAgB,EAAsB,CAClC,OAAO,KAAK,KAAK,gBAAgB,EAAI,CAMzC,QAAQ,EAAiC,CACrC,GAAI,IAAU,OACV,OAAO,KAAK,SAGhB,KAAK,SAAW,EACZ,KAAK,SACL,KAAK,QAAQ,YAAYA,EAAO,WAAY,EAAM,CAElD,KAAK,YACL,KAAK,WAAW,QAAQ,EAAM,CAOtC,2BAA2B,EAAsB,CAC7C,KAAK,QAAQ,EAAM,CAOvB,QAAQ,EAAe,CACnB,IAAM,EAAO,KACP,EAAU,KAAK,QACf,EAAO,EAAK,WAAW,MAAM,CAC7B,EAAgB,EAAK,KAAM,GAAmB,EAAK,SAAS,CAC5D,EAAe,GAAG,cAAgB,EAAE,CAE1C,GAAI,CAAC,GAAK,CAAC,EAAE,OAAQ,CACjB,GAAI,EAAK,SAAW,GAAK,EAAQ,eAAgB,CAC7C,IAAM,EAAa,EAAQ,gBAAgB,CAC3C,EAAK,KAAK,WAAW,EAAW,MAEhC,EAAK,KAAK,eAAe,CACzB,EAAK,QAAS,GAAmB,CAC7B,EAAK,cAAc,EAAK,EAC1B,CAEN,EAAK,gBAAgB,CAOzB,GAJI,GACA,EAAK,oBAAoB,EAAc,CAGvC,GAAG,SAAW,OAAQ,CAClB,EAAQ,gBAAkB,CAAC,EAAK,KAAK,aAAa,EAClD,EAAK,KAAK,eAAe,CAG7B,IAAM,EAAU,EAAa,OAAS,EAAa,GAAK,EAAK,EAAK,OAAS,GAC3E,EAAK,cAAc,EAAQ,CAEtB,EAAa,QACd,EAAK,gBAAgB,CAI7B,EAAK,KAAK,wBAAwB,CAClC,EAAK,cAAc,qBAAqB,CACxC,EAAK,cAAc,0BAA0B,CAMjD,eAAe,EAAc,CACzB,KAAK,gBAAgB,eAAe,EAAE,CAM1C,aAAa,EAAyB,CAClC,KAAK,gBAAgB,aAAa,EAAQ,CAO9C,YAAY,EAAyB,CACjC,KAAK,gBAAgB,YAAY,EAAQ,CAO7C,WAAW,EAAyB,CAChC,KAAK,gBAAgB,WAAW,EAAQ,CAO5C,cAAc,EAAyB,CACnC,KAAK,gBAAgB,cAAc,EAAQ,CAM/C,uBAAuB,EAAc,CACjC,KAAK,gBAAgB,uBAAuB,EAAE,CAMlD,SAAgB,CACZ,AAEI,KAAK,cADL,KAAK,mBAAmB,CACN,MAGtB,AAGI,KAAK,QAFL,KAAK,KAAK,QAAQ,CAClB,KAAK,KAAK,SAAS,CACP,MAGhB,AAGI,KAAK,cAFL,KAAK,WAAW,QAAQ,CACxB,KAAK,WAAW,SAAS,CACP,MAGlB,KAAK,oBACL,KAAK,mBAAmB,SAAS,CAGrC,AAGI,KAAK,WAFL,KAAK,QAAQ,KAAK,CAClB,KAAK,QAAQ,OAAO,CACL,MAGnB,MAAM,SAAS,GEvuBV,GAAb,cAAqC,CAAmC,CAKpE,WAAmB,CACf,IAAM,EAAc,KAAa,WAIjC,OAHI,GAAc,OAAO,EAAW,MAAS,WAClC,EAAW,UAAU,CAEzB,EAAE,GAIjB,GAAgB,GAAK,GAAgB,UkBSrC,IAAa,GAAb,KAA0E,CAWtE,YACI,EACA,EACF,CAFU,KAAA,EAAA,EACA,KAAA,iBAAA,eAT2B,EAAE,iBAKgB,IAAI,IAc7D,gBAAgB,EAAc,EAAyD,CACnF,IAAM,EAAmC,CACrC,MAAO,EAAE,CACT,GAAG,EACN,CAED,OADA,KAAK,WAAW,IAAI,EAAM,EAAU,CAC7B,EAQX,aAAa,EAAiD,CAC1D,OAAO,KAAK,WAAW,IAAI,EAAK,CAMpC,SAAS,EAAgC,EAAsC,EAAE,CAAQ,CACrF,IAAM,EAAY,EAAQ,WAAa,KACjC,EAAW,KAAK,WAAW,IAAI,EAAU,CAE/C,GAAI,CAAC,EACD,MAAU,MAAM,6BAA6B,IAAY,CAG7D,KAAK,oBAAoB,EAAQ,EAAU,EAAQ,OAAO,CAO9D,oBAAoB,EAAgC,EAAiC,EAAuB,CACxG,IAAM,EAAO,EAAO,GAAG,QAAQ,MAAS,EAAe,SAAS,KAEhE,GAAI,CAAC,EACD,MAAU,MAAM,qCAAqC,CAGzD,IAAmB,GAGnB,EAAS,GAAQ,EACjB,EAAS,MAAM,EAAK,aAAa,EAAI,EAGrC,IAAM,EAAS,WAAa,EAAS,EAC/B,EAAa,QAAU,EAAS,EAEtC,KAAK,mBAAmB,EAAY,EAAQ,EAAO,CAGnD,IAAM,EAAiC,CACnC,KAAM,EACE,SACA,SACX,CAED,KAAK,QAAQ,KAAK,EAAY,CAMlC,UAAU,EAAc,EAAwD,CAC5E,GAAI,EAEA,OADiB,KAAK,WAAW,IAAI,EAAU,GAC7B,GAItB,IAAK,IAAM,KAAY,KAAK,WAAW,QAAQ,CAC3C,GAAI,EAAS,GACT,OAAO,EAAS,GAU5B,gBAAgB,EAAc,EAAwD,CAClF,IAAM,EAAY,EAAK,aAAa,CAEpC,GAAI,EAEA,OADiB,KAAK,WAAW,IAAI,EAAU,EAC9B,MAAM,GAI3B,IAAK,IAAM,KAAY,KAAK,WAAW,QAAQ,CAC3C,GAAI,EAAS,MAAM,GACf,OAAO,EAAS,MAAM,GAUlC,eAAqC,CACjC,OAAO,KAAK,QAAQ,OAAO,CAM/B,kBAAkB,EAA+B,EAAwC,CACrF,IAAM,EAAK,KAAK,EAAE,EAAQ,CACtB,EAEE,EAAmB,EAAY,CAAC,EAAU,CAAG,MAAM,KAAK,KAAK,WAAW,QAAQ,CAAC,CAEvF,IAAK,IAAM,KAAM,EACb,IAAK,IAAM,KAAQ,EAAG,MAAO,CACzB,IAAM,EAAS,EAAG,MAAM,GAElB,EAAU,SADD,EAAO,IAAI,SAAS,QAAU,KACT,EAAO,IAAI,SAAS,MAAQ,IAEhE,GADA,EAAS,EAAG,KAAK,EAAQ,CACrB,EACA,OAAO,GAWvB,mBAAmB,EAAc,EAAgC,EAAsB,CACnF,IAAM,EAAI,KAAK,EACT,EAAmB,KAAK,iBACxB,EAAQ,MAAM,UAAU,MAE7B,EAAE,GAAW,GAAQ,SAAuB,EAAe,CACxD,IAAI,EAAa,KACb,EAiCJ,OA/BI,OAAO,GAAYM,UACnB,EAAO,EAAM,KAAK,UAAW,EAAE,CAE/B,KAAK,KAAK,UAA4B,CAClC,IAAM,EAAiB,EAAE,KAAK,KAAM,EAAK,CACrC,EACA,EAEJ,GAAI,CAAC,EACD,MAAU,MAAM,EAAiB,OAAO,2DAA4D,EAAS,EAAK,CAAC,CAKvH,GAFA,EAAS,EAAe,GAEpB,OAAO,GAAWC,WAClB,MAAU,MAAM,EAAiB,OAAO,kCAAmC,EAAS,EAAK,CAAC,CAK9F,GAFA,EAAS,EAAO,MAAM,EAAgB,EAAK,CAEvC,IAAW,OAEX,MADA,GAAQ,EACD,IAEb,EAEF,KAAK,KAAK,UAA4B,CAClC,OAAO,IAAK,EAAe,KAAM,EAAQ,EAC3C,CAGC,GAGV,EAAE,GAAW,GAAM,OAAS,EAE5B,EAAE,GAAW,GAAU,UAAuB,CAC3C,OAAO,KAAK,KAAK,EAAK,EAQ9B,oBAAoB,EAAqC,EAAqF,CAC1I,IAAM,EAAkD,EAAE,CACtD,EACA,EAOJ,IAJI,CAAC,EAAW,IAAM,IAClB,EAAa,GAGZ,EAAM,EAAG,EAAS,EAAW,OAAQ,EAAM,EAAQ,IACpD,EAAM,GAAO,EAAW,GAAK,MAIjC,OAAO,KAAK,EAAE,OAAO,MAAM,KAAO,CAAC,EAAE,CAAC,CAAW,OAAO,EAAM,SAAS,CAAC,CAAC,GChPjF,IERa,GAAW,CACpB,GAAI,OACJ,KAAM,OACN,SAAU,MACV,YAAa,sBACb,QAAS,CAAC,OAAQ,cAAe,cAAe,WAAY,OAAQ,SAAU,UAAW,qBAAqB,CACjH,CAGD,OAAO,MAAM,KAAO,EAAE,CACtB,EAAE,OAAO,OAAO,MAAM,KAAM,CACxB,SAAU,EAAE,CACZ,UAAW,EAAE,CACb,WAAY,EAAE,CACd,UAAW,EAAE,CACb,gBAAmB,EAAO,EAAa,CAAC,aAAa,uGAAwG,OAAO,CACpK,iBAAoB,EAAO,EAAa,CAAC,aAAa,wGAAyG,OAAO,CACtK,qBAAwB,EAAO,EAAa,CAAC,aAAa,4GAA6G,OAAO,CAC9K,sBAAyB,EAAO,EAAa,CAAC,aAAa,6GAA8G,OAAO,CACnL,CAAC,CAGF,EAAO,GAAsB,CAAC,SAAS,GAAK,CAK5C,IAAA,GAAe"}