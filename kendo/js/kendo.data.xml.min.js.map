{"version":3,"file":"kendo.data.xml.min.js","names":[],"sources":["../../src/kendo.data.xml.js"],"sourcesContent":["import \"./kendo.core.js\";\n\nexport const __meta__ = {\n    id: \"data.xml\",\n    name: \"XML\",\n    category: \"framework\",\n    depends: [ \"core\" ],\n    hidden: true\n};\n\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        isArray = Array.isArray,\n        isPlainObject = $.isPlainObject,\n        map = $.map,\n        each = $.each,\n        extend = $.extend,\n        getter = kendo.getter,\n        Class = kendo.Class;\n\n    var XmlDataReader = Class.extend({\n        init: function(options) {\n            var that = this,\n                total = options.total,\n                model = options.model,\n                parse = options.parse,\n                errors = options.errors,\n                serialize = options.serialize,\n                data = options.data;\n\n            if (model) {\n                if (isPlainObject(model)) {\n                    var base = options.modelBase || kendo.data.Model;\n\n                    if (model.fields) {\n                        each(model.fields, function(field, value) {\n                            if (isPlainObject(value) && value.field) {\n                                if (!kendo.isFunction(value.field)) {\n                                    value = extend(value, { field: that.getter(value.field) });\n                                }\n                            } else {\n                                value = { field: that.getter(value) };\n                            }\n                            model.fields[field] = value;\n                        });\n                    }\n\n                    var id = model.id;\n                    if (id) {\n                        var idField = {};\n\n                        idField[that.xpathToMember(id, true)] = { field: that.getter(id) };\n                        model.fields = extend(idField, model.fields);\n                        model.id = that.xpathToMember(id);\n                    }\n                    model = base.define(model);\n                }\n\n                that.model = model;\n            }\n\n            if (total) {\n                if (typeof total == \"string\") {\n                    total = that.getter(total);\n                    that.total = function(data) {\n                        return parseInt(total(data), 10);\n                    };\n                } else if (typeof total == \"function\") {\n                    that.total = total;\n                }\n            }\n\n            if (errors) {\n                if (typeof errors == \"string\") {\n                    errors = that.getter(errors);\n                    that.errors = function(data) {\n                        return errors(data) || null;\n                    };\n                } else if (typeof errors == \"function\") {\n                    that.errors = errors;\n                }\n            }\n\n            if (data) {\n                if (typeof data == \"string\") {\n                    data = that.xpathToMember(data);\n                    that.data = function(value) {\n                        var result = that.evaluate(value, data),\n                            modelInstance;\n\n                        result = isArray(result) ? result : [result];\n\n                        if (that.model && model.fields) {\n                            modelInstance = new that.model();\n\n                            return map(result, function(value) {\n                                if (value) {\n                                    var record = {}, field;\n\n                                    for (field in model.fields) {\n                                        record[field] = modelInstance._parse(field, model.fields[field].field(value));\n                                    }\n\n                                    return record;\n                                }\n                            });\n                        }\n\n                        return result;\n                    };\n                } else if (typeof data == \"function\") {\n                    that.data = data;\n                }\n            }\n\n            if (typeof parse == \"function\") {\n                var xmlParse = that.parse;\n\n                that.parse = function(data) {\n                    var xml = parse.call(that, data);\n                    return xmlParse.call(that, xml);\n                };\n            }\n\n            if (typeof serialize == \"function\") {\n                that.serialize = serialize;\n            }\n        },\n        total: function(result) {\n            return this.data(result).length;\n        },\n        errors: function(data) {\n            return data ? data.errors : null;\n        },\n        serialize: function(data) {\n            return data;\n        },\n        parseDOM: function(element) {\n            var result = {},\n                parsedNode,\n                node,\n                nodeType,\n                nodeName,\n                member,\n                attribute,\n                attributes = element.attributes,\n                attributeCount = attributes.length,\n                idx;\n\n            for (idx = 0; idx < attributeCount; idx++) {\n                attribute = attributes[idx];\n                result[\"@\" + attribute.nodeName] = attribute.nodeValue;\n            }\n\n            for (node = element.firstChild; node; node = node.nextSibling) {\n                nodeType = node.nodeType;\n\n                if (nodeType === 3 || nodeType === 4) {\n                    // text nodes or CDATA are stored as #text field\n                    result[\"#text\"] = node.nodeValue;\n                } else if (nodeType === 1) {\n                    // elements are stored as fields\n                    parsedNode = this.parseDOM(node);\n\n                    nodeName = node.nodeName;\n\n                    member = result[nodeName];\n\n                    if (isArray(member)) {\n                        // elements of same nodeName are stored as array\n                        member.push(parsedNode);\n                    } else if (member !== undefined) {\n                        member = [member, parsedNode];\n                    } else {\n                        member = parsedNode;\n                    }\n\n                    result[nodeName] = member;\n                }\n            }\n            return result;\n        },\n\n        evaluate: function(value, expression) {\n            var members = expression.split(\".\"),\n                member,\n                result,\n                length,\n                intermediateResult,\n                idx;\n\n            while (member = members.shift()) {\n                value = value[member];\n\n                if (isArray(value)) {\n                    result = [];\n                    expression = members.join(\".\");\n\n                    for (idx = 0, length = value.length; idx < length; idx++) {\n                        intermediateResult = this.evaluate(value[idx], expression);\n\n                        intermediateResult = isArray(intermediateResult) ? intermediateResult : [intermediateResult];\n\n                        result.push.apply(result, intermediateResult);\n                    }\n\n                    return result;\n                }\n            }\n\n            return value;\n        },\n\n        parse: function(xml) {\n            var documentElement,\n                tree,\n                result = {};\n\n            documentElement = xml.documentElement || $.parseXML(xml).documentElement;\n\n            tree = this.parseDOM(documentElement);\n\n            result[documentElement.nodeName] = tree;\n\n            return result;\n        },\n\n        xpathToMember: function(member, raw) {\n            if (!member) {\n                return \"\";\n            }\n\n            member = member.replace(/^\\//, \"\") // remove the first \"/\"\n                           .replace(/\\//g, \".\"); // replace all \"/\" with \".\"\n\n            if (member.indexOf(\"@\") >= 0) {\n                // replace @attribute with '[\"@attribute\"]'\n                return member.replace(/\\.?(@.*)/, raw ? '$1' : '[\"$1\"]');\n            }\n\n            if (member.indexOf(\"text()\") >= 0) {\n                // replace \".text()\" with '[\"#text\"]'\n                return member.replace(/(\\.?text\\(\\))/, raw ? '#text' : '[\"#text\"]');\n            }\n\n            return member;\n        },\n        getter: function(member) {\n            return getter(this.xpathToMember(member), true);\n        }\n    });\n\n    $.extend(true, kendo.data, {\n        XmlDataReader: XmlDataReader,\n        readers: {\n            xml: XmlDataReader\n        }\n    });\n})(window.kendo.jQuery);\nexport default kendo;\n\n"],"mappings":"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"}