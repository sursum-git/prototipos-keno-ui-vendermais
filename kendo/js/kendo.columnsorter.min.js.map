{"version":3,"file":"kendo.columnsorter.min.js","names":[],"sources":["../../src/kendo.columnsorter.js"],"sourcesContent":["import \"./kendo.core.js\";\nimport \"./kendo.icons.js\";\n\nexport const __meta__ = {\n    id: \"columnsorter\",\n    name: \"Column Sorter\",\n    category: \"framework\",\n    depends: [\"core\", \"icons\"],\n    advanced: true\n};\n\n(function($, undefined) {\n    var kendo = window.kendo;\n    var ui = kendo.ui;\n    var Widget = ui.Widget;\n    var DIR = \"dir\";\n    var ASC = \"asc\";\n    var SINGLE = \"single\";\n    var MULTIPLE = \"multiple\";\n    var MIXED = \"mixed\";\n    var FIELD = \"field\";\n    var DESC = \"desc\";\n    var sorterNS = \".kendoColumnSorter\";\n    var TLINK = \".k-link\";\n    var ARIASORT = \"aria-sort\";\n\n    var ColumnSorter = Widget.extend({\n        init: function(element, options) {\n\n            var that = this, link;\n\n            Widget.fn.init.call(that, element, options);\n\n            that._refreshHandler = that.refresh.bind(that);\n\n            that.dataSource = that.options.dataSource.bind(\"change\", that._refreshHandler);\n\n            that.directions = that.options.initialDirection === ASC ? [ASC, DESC] : [DESC, ASC];\n\n            link = that.element.find(TLINK);\n\n            if (!link[0]) {\n                link = that.element.wrapInner('<a class=\"k-link\" href=\"#\"/>').find(TLINK);\n            }\n\n            that.link = link;\n\n            that.element.on(\"click\" + sorterNS, that._click.bind(that));\n        },\n\n        options: {\n            name: \"ColumnSorter\",\n            mode: SINGLE,\n            allowUnsort: true,\n            compare: null,\n            filter: \"\",\n            initialDirection: ASC,\n            showIndexes: false\n        },\n\n        events: [\"change\"],\n\n        destroy: function() {\n            var that = this;\n\n            Widget.fn.destroy.call(that);\n\n            that.element.off(sorterNS);\n\n            that.dataSource.unbind(\"change\", that._refreshHandler);\n            that._refreshHandler = that.element = that.link = that.dataSource = null;\n        },\n\n        refresh: function(e) {\n            if (e && (e.action === \"itemchange\" || e.action === \"sync\")) {\n                return;\n            }\n            var that = this,\n                sort = that.dataSource.sort() || [],\n                dir,\n                table,\n                leafCells,\n                element = that.element,\n                field = element.attr(kendo.attr(FIELD)),\n                descriptor = (that.dataSource._sortFields || {})[field],\n                headerIndex,\n                sortOrder;\n\n            element.removeAttr(kendo.attr(DIR));\n            element.removeAttr(ARIASORT);\n\n\n            if (descriptor) {\n                dir = descriptor.dir;\n                element.attr(kendo.attr(DIR), dir);\n                sortOrder = descriptor.index;\n            }\n\n            if (element.is(\"th\") && descriptor) {\n                table = getColsTable(element);\n\n                if (table) {\n                    if (element.attr(kendo.attr(\"index\"))) {\n                        leafCells = leafDataCells(element.closest(\"table\"));\n                        headerIndex = leafCells.index(element);\n                    } else {\n                        headerIndex = element.parent().children(\":visible\").index(element);\n                    }\n\n                    if (headerIndex > -1) {\n                        table.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(headerIndex).toggleClass(\"k-sorted\", dir !== undefined);\n                    }\n                }\n            }\n            element.toggleClass(\"k-sorted\", dir !== undefined);\n            element.find(\".k-i-sort-asc-small,.k-i-sort-desc-small,.k-svg-i-sort-asc-small,.k-svg-i-sort-desc-small,.k-sort-order,.k-sort-icon\").remove();\n\n            if (dir === ASC) {\n                $('<span class=\"k-sort-icon\">' + kendo.ui.icon(\"sort-asc-small\") + '</span>').appendTo(that.link);\n                element.attr(ARIASORT, \"ascending\");\n            } else if (dir === DESC) {\n                $('<span class=\"k-sort-icon\">' + kendo.ui.icon(\"sort-desc-small\") + '</span>').appendTo(that.link);\n                element.attr(ARIASORT, \"descending\");\n            } else {\n                element.attr(ARIASORT, \"none\");\n            }\n            if (that.options.showIndexes && sort.length > 1 && sortOrder) {\n                $('<span class=\"k-sort-order\" />').html(sortOrder).appendTo(that.link);\n            }\n        },\n\n        _toggleSortDirection: function(dir) {\n            var directions = this.directions;\n            if (dir === directions[directions.length - 1] && this.options.allowUnsort) {\n                return undefined;\n            }\n            return directions[0] === dir ? directions[1] : directions[0];\n        },\n\n        _click: function(e) {\n            var that = this,\n                element = that.element,\n                field = element.attr(kendo.attr(FIELD)),\n                dir = element.attr(kendo.attr(DIR)),\n                options = that.options,\n                compare = that.options.compare === null ? undefined : that.options.compare,\n                sort = that.dataSource.sort() || [],\n                ctrlKey = e.ctrlKey || e.metaKey,\n                idx,\n                length;\n\n            e.preventDefault();\n\n            if (options.filter && !element.is(options.filter)) {\n                return;\n            }\n\n            dir = this._toggleSortDirection(dir);\n\n            if (this.trigger(\"change\", { sort: { field: field, dir: dir, compare: compare } })) {\n                return;\n            }\n\n            if (options.mode === SINGLE || (options.mode === MIXED && !ctrlKey)) {\n                sort = [{ field: field, dir: dir, compare: compare }];\n            } else if (options.mode === MULTIPLE || (options.mode === MIXED && ctrlKey)) {\n                for (idx = 0, length = sort.length; idx < length; idx++) {\n                    if (sort[idx].field === field) {\n                        sort.splice(idx, 1);\n                        break;\n                    }\n                }\n                sort.push({ field: field, dir: dir, compare: compare });\n            }\n\n            if (this.dataSource.options.endless) {\n                element.closest(\".k-grid\").getKendoGrid()._resetEndless();\n            }\n            this.dataSource.sort(sort);\n        }\n    });\n\n    function leafDataCells(container) {\n        var rows = container.find(\"tr:not(.k-filter-row)\");\n        var indexAttr = kendo.attr(\"index\");\n\n        var cells = rows.find(\"th[\" + indexAttr + \"]:visible\");\n\n        return [].sort.call(cells, function(a, b) {\n            a = $(a);\n            b = $(b);\n\n            var indexA = a.attr(indexAttr);\n            var indexB = b.attr(indexAttr);\n\n            if (indexA === undefined) {\n                indexA = $(a).index();\n            }\n            if (indexB === undefined) {\n                indexB = $(b).index();\n            }\n\n            indexA = parseInt(indexA, 10);\n            indexB = parseInt(indexB, 10);\n            return indexA > indexB ? 1 : (indexA < indexB ? -1 : 0);\n        });\n    }\n\n    function getColsTable(element) {\n        var table = null;\n        if (element.is(\"th\")) {\n            table = element.closest(\"table\");\n            if (table.parent().hasClass(\"k-grid-header-wrap\")) {\n                table = table.closest(\".k-grid\").find(\".k-grid-content > table\");\n            } else if (table.parent().hasClass(\"k-grid-header-locked\")) {\n                table = table.closest(\".k-grid\").find(\".k-grid-content-locked > table\");\n            }\n        }\n        return table;\n    }\n\n    ui.plugin(ColumnSorter);\n\n})(window.kendo.jQuery);\nexport default kendo;\n\n"],"mappings":";4gBAGA,IAAa,EAAW,CACpB,GAAI,eACJ,KAAM,gBACN,SAAU,YACV,QAAS,CAAC,OAAQ,QAAQ,CAC1B,SAAU,GACb,EAEA,SAAS,EAAG,EAAW,CACpB,IAAI,EAAQ,OAAO,MACf,EAAK,EAAM,GACX,EAAS,EAAG,OACZ,EAAM,MACN,EAAM,MACN,EAAS,SACT,EAAW,WACX,EAAQ,QACR,EAAQ,QACR,EAAO,OACP,EAAW,qBACX,EAAQ,UACR,EAAW,YAEX,EAAe,EAAO,OAAO,CAC7B,KAAM,SAAS,EAAS,EAAS,CAE7B,IAAI,EAAO,KAAM,EAEjB,EAAO,GAAG,KAAK,KAAK,EAAM,EAAS,EAAQ,CAE3C,EAAK,gBAAkB,EAAK,QAAQ,KAAK,EAAK,CAE9C,EAAK,WAAa,EAAK,QAAQ,WAAW,KAAK,SAAU,EAAK,gBAAgB,CAE9E,EAAK,WAAa,EAAK,QAAQ,mBAAqB,EAAM,CAAC,EAAK,EAAK,CAAG,CAAC,EAAM,EAAI,CAEnF,EAAO,EAAK,QAAQ,KAAK,EAAM,CAE1B,EAAK,KACN,EAAO,EAAK,QAAQ,UAAU,+BAA+B,CAAC,KAAK,EAAM,EAG7E,EAAK,KAAO,EAEZ,EAAK,QAAQ,GAAG,QAAU,EAAU,EAAK,OAAO,KAAK,EAAK,CAAC,EAG/D,QAAS,CACL,KAAM,eACN,KAAM,EACN,YAAa,GACb,QAAS,KACT,OAAQ,GACR,iBAAkB,EAClB,YAAa,GAChB,CAED,OAAQ,CAAC,SAAS,CAElB,QAAS,UAAW,CAChB,IAAI,EAAO,KAEX,EAAO,GAAG,QAAQ,KAAK,EAAK,CAE5B,EAAK,QAAQ,IAAI,EAAS,CAE1B,EAAK,WAAW,OAAO,SAAU,EAAK,gBAAgB,CACtD,EAAK,gBAAkB,EAAK,QAAU,EAAK,KAAO,EAAK,WAAa,MAGxE,QAAS,SAAS,EAAG,CACb,SAAM,EAAE,SAAW,cAAgB,EAAE,SAAW,SAGpD,KAAI,EAAO,KACP,EAAO,EAAK,WAAW,MAAM,EAAI,EAAE,CACnC,EACA,EACA,EACA,EAAU,EAAK,QACf,EAAQ,EAAQ,KAAK,EAAM,KAAK,EAAM,CAAC,CACvC,GAAc,EAAK,WAAW,aAAe,EAAE,EAAE,GACjD,EACA,EAEJ,EAAQ,WAAW,EAAM,KAAK,EAAI,CAAC,CACnC,EAAQ,WAAW,EAAS,CAGxB,IACA,EAAM,EAAW,IACjB,EAAQ,KAAK,EAAM,KAAK,EAAI,CAAE,EAAI,CAClC,EAAY,EAAW,OAGvB,EAAQ,GAAG,KAAK,EAAI,IACpB,EAAQ,EAAa,EAAQ,CAEzB,IACI,EAAQ,KAAK,EAAM,KAAK,QAAQ,CAAC,EACjC,EAAY,EAAc,EAAQ,QAAQ,QAAQ,CAAC,CACnD,EAAc,EAAU,MAAM,EAAQ,EAEtC,EAAc,EAAQ,QAAQ,CAAC,SAAS,WAAW,CAAC,MAAM,EAAQ,CAGlE,EAAc,IACd,EAAM,KAAK,8CAA8C,CAAC,GAAG,EAAY,CAAC,YAAY,WAAY,IAAQ,EAAU,GAIhI,EAAQ,YAAY,WAAY,IAAQ,EAAU,CAClD,EAAQ,KAAK,uHAAuH,CAAC,QAAQ,CAEzI,IAAQ,GACR,EAAE,6BAA+B,EAAM,GAAG,KAAK,iBAAiB,CAAG,UAAU,CAAC,SAAS,EAAK,KAAK,CACjG,EAAQ,KAAK,EAAU,YAAY,EAC5B,IAAQ,GACf,EAAE,6BAA+B,EAAM,GAAG,KAAK,kBAAkB,CAAG,UAAU,CAAC,SAAS,EAAK,KAAK,CAClG,EAAQ,KAAK,EAAU,aAAa,EAEpC,EAAQ,KAAK,EAAU,OAAO,CAE9B,EAAK,QAAQ,aAAe,EAAK,OAAS,GAAK,GAC/C,EAAE,gCAAgC,CAAC,KAAK,EAAU,CAAC,SAAS,EAAK,KAAK,GAI9E,qBAAsB,SAAS,EAAK,CAChC,IAAI,EAAa,KAAK,WAItB,OAHI,IAAQ,EAAW,EAAW,OAAS,IAAM,KAAK,QAAQ,YACnD,EAEJ,EAAW,KAAO,EAAM,EAAW,GAAK,EAAW,IAG9D,OAAQ,SAAS,EAAG,CAChB,IAAI,EAAO,KACP,EAAU,EAAK,QACf,EAAQ,EAAQ,KAAK,EAAM,KAAK,EAAM,CAAC,CACvC,EAAM,EAAQ,KAAK,EAAM,KAAK,EAAI,CAAC,CACnC,EAAU,EAAK,QACf,EAAU,EAAK,QAAQ,UAAY,KAAO,EAAY,EAAK,QAAQ,QACnE,EAAO,EAAK,WAAW,MAAM,EAAI,EAAE,CACnC,EAAU,EAAE,SAAW,EAAE,QACzB,EACA,EAEJ,KAAE,gBAAgB,CAEd,IAAQ,QAAU,CAAC,EAAQ,GAAG,EAAQ,OAAO,IAIjD,EAAM,KAAK,qBAAqB,EAAI,CAEhC,MAAK,QAAQ,SAAU,CAAE,KAAM,CAAS,QAAY,MAAc,UAAS,CAAE,CAAC,EAIlF,IAAI,EAAQ,OAAS,GAAW,EAAQ,OAAS,GAAS,CAAC,EACvD,EAAO,CAAC,CAAS,QAAY,MAAc,UAAS,CAAC,SAC9C,EAAQ,OAAS,GAAa,EAAQ,OAAS,GAAS,EAAU,CACzE,IAAK,EAAM,EAAG,EAAS,EAAK,OAAQ,EAAM,EAAQ,IAC9C,GAAI,EAAK,GAAK,QAAU,EAAO,CAC3B,EAAK,OAAO,EAAK,EAAE,CACnB,MAGR,EAAK,KAAK,CAAS,QAAY,MAAc,UAAS,CAAC,CAGvD,KAAK,WAAW,QAAQ,SACxB,EAAQ,QAAQ,UAAU,CAAC,cAAc,CAAC,eAAe,CAE7D,KAAK,WAAW,KAAK,EAAK,GAEjC,CAAC,CAEF,SAAS,EAAc,EAAW,CAC9B,IAAI,EAAO,EAAU,KAAK,wBAAwB,CAC9C,EAAY,EAAM,KAAK,QAAQ,CAE/B,EAAQ,EAAK,KAAK,MAAQ,EAAY,YAAY,CAEtD,MAAO,EAAE,CAAC,KAAK,KAAK,EAAO,SAAS,EAAG,EAAG,CACtC,EAAI,EAAE,EAAE,CACR,EAAI,EAAE,EAAE,CAER,IAAI,EAAS,EAAE,KAAK,EAAU,CAC1B,EAAS,EAAE,KAAK,EAAU,CAW9B,OATI,IAAW,IACX,EAAS,EAAE,EAAE,CAAC,OAAO,EAErB,IAAW,IACX,EAAS,EAAE,EAAE,CAAC,OAAO,EAGzB,EAAS,SAAS,EAAQ,GAAG,CAC7B,EAAS,SAAS,EAAQ,GAAG,CACtB,EAAS,EAAS,EAAK,EAAS,EAAS,GAAK,GACvD,CAGN,SAAS,EAAa,EAAS,CAC3B,IAAI,EAAQ,KASZ,OARI,EAAQ,GAAG,KAAK,GAChB,EAAQ,EAAQ,QAAQ,QAAQ,CAC5B,EAAM,QAAQ,CAAC,SAAS,qBAAqB,CAC7C,EAAQ,EAAM,QAAQ,UAAU,CAAC,KAAK,0BAA0B,CACzD,EAAM,QAAQ,CAAC,SAAS,uBAAuB,GACtD,EAAQ,EAAM,QAAQ,UAAU,CAAC,KAAK,iCAAiC,GAGxE,EAGX,EAAG,OAAO,EAAa,GAExB,OAAO,MAAM,OAAO,CACvB,IAAA,EAAe"}