{"version":3,"file":"kendo.treeview.draganddrop.min.js","names":[],"sources":["../../src/kendo.treeview.draganddrop.js"],"sourcesContent":["import \"./kendo.data.js\";\nimport \"./kendo.draganddrop.js\";\n\nexport const __meta__ = {\n    id: \"treeview.draganddrop\",\n    name: \"Hierarchical Drag & Drop\",\n    category: \"framework\",\n    depends: [ \"core\", \"draganddrop\" ],\n    advanced: true\n};\n\n(function($, undefined) {\n    var kendo = window.kendo;\n    var ui = kendo.ui;\n    var extend = $.extend;\n    var VISIBILITY = \"visibility\";\n    var DRAG_STATUS = \"k-drag-status\";\n    var DRAG_STATUS_ELEMENT = `<span class=\"${DRAG_STATUS}\"></span>`;\n    var KSTATEHOVER = \"k-hover\";\n    var INPUTSELECTOR = \"input,a:not(.k-treeview-leaf),textarea,.k-multiselect-wrap,select,button,a.k-button>.k-icon,.k-button>.k-button-text,button.k-button>.k-icon,span.k-toggle-icon,a.k-button>.k-svg-icon,button.k-button>.k-svg-icon,.k-button>.k-svg-icon>svg,.k-button>.k-svg-icon>svg>path\";\n    var DROPHINTTEMPLATE = \"<div class='k-drop-hint k-drop-hint-h'>\" +\n                                \"<div class='k-drop-hint-start'></div>\" +\n                                \"<div class='k-drop-hint-line'></div>\" +\n                            \"</div>\";\n\n    ui.HierarchicalDragAndDrop = kendo.Class.extend({\n        init: function(element, options) {\n            this.element = element;\n            this.hovered = element;\n            this.options = extend({\n                dragstart: $.noop, drag: $.noop, drop: $.noop, dragend: $.noop\n            }, options);\n\n            this._draggable = new ui.Draggable(element, {\n                ignore: INPUTSELECTOR,\n                filter: options.filter,\n                autoScroll: options.autoScroll,\n                cursorOffset: {\n                    left: 10,\n                    top: kendo.support.mobileOS ? -40 / kendo.support.zoomLevel() : 10\n                },\n                hint: this._hint.bind(this),\n                dragstart: this.dragstart.bind(this),\n                dragcancel: this.dragcancel.bind(this),\n                hintDestroyed: this.dragcancel.bind(this),\n                drag: this.drag.bind(this),\n                dragend: this.dragend.bind(this),\n                holdToDrag: options.holdToDrag,\n                clickMoveClick: options.clickMoveClick\n            });\n        },\n\n        _hint: function(element) {\n            return \"<div class='k-drag-clue'>\" +\n                        DRAG_STATUS_ELEMENT +\n                        this.options.hintText(element) +\n                    \"</div>\";\n        },\n\n        _removeTouchHover: function() {\n            if (kendo.support.touch && this.hovered) {\n                this.hovered.find(\".\" + KSTATEHOVER).removeClass(KSTATEHOVER);\n                this.hovered = false;\n            }\n        },\n\n        _hintStatus: function(newStatus) {\n            var statusElement = this._draggable.hint.find(`.${DRAG_STATUS}`);\n            if (newStatus) {\n                this.status = newStatus;\n                ui.icon(statusElement, {\n                    icon: newStatus\n                });\n            } else {\n                this.status = '';\n                statusElement.replaceWith(DRAG_STATUS_ELEMENT);\n            }\n        },\n\n        dragstart: function(e) {\n            if (this.dropHint) {\n                this.dropHint.remove();\n            }\n\n            this.source = e.currentTarget.closest(this.options.itemSelector);\n\n            if (this.options.dragstart(this.source)) {\n                e.preventDefault();\n            }\n\n            if (this.options.reorderable) {\n                this.dropHint = $(DROPHINTTEMPLATE)\n                    .css(VISIBILITY, \"hidden\")\n                    .appendTo(this.element);\n            } else {\n                this.dropHint = $();\n            }\n        },\n\n        drag: function(e) {\n            var options = this.options;\n            var source = this.source;\n            var target = this.dropTarget = $(kendo.eventTarget(e));\n            var container = target.closest(options.allowedContainers);\n            var hoveredItem, itemHeight, itemTop, itemContent, delta;\n            var insertOnTop, insertOnBottom, addChild;\n            var itemData, position, status;\n\n            if (!container.length) {\n                // dragging outside of allowed elements\n                status = \"cancel\";\n                this._removeTouchHover();\n            } else if (source[0] == target[0] || options.contains(source[0], target[0])) {\n                // dragging item within itself\n                status = \"cancel\";\n            } else if (e.clickMoveClick && e.currentTarget.hasClass(\"k-drag-cell\") && target.closest(\".k-drag-cell\").length === 0) {\n                // click-move-click interaction with drag cell\n                status = \"cancel\";\n            } else if (e.clickMoveClick && e.currentTarget.hasClass(\"k-treeview-leaf\") && target.closest(\".k-treeview-leaf\").length === 0) {\n                // click-move-click interaction with TreeView\n                status = \"cancel\";\n            } else {\n                // moving or reordering item\n                status = \"insert-middle\";\n\n                itemData = options.itemFromTarget(target);\n                hoveredItem = itemData.item;\n\n                if (hoveredItem.length) {\n                    this._removeTouchHover();\n                    itemHeight = kendo._outerHeight(hoveredItem);\n                    itemContent = itemData.content;\n\n                    if (options.reorderable) {\n                        delta = itemHeight / (itemContent.length > 0 ? 4 : 2);\n                        itemTop = kendo.getOffset(hoveredItem).top;\n\n                        insertOnTop = e.y.location < (itemTop + delta);\n                        insertOnBottom = (itemTop + itemHeight - delta) < e.y.location;\n                        addChild = itemContent.length && !insertOnTop && !insertOnBottom;\n                    } else {\n                        addChild = true;\n                        insertOnTop = false;\n                        insertOnBottom = false;\n                    }\n\n                    this.hovered = addChild ? container : false;\n\n                    this.dropHint.css(VISIBILITY, addChild ? \"hidden\" : \"visible\");\n\n                    if (this._lastHover && this._lastHover[0] != itemContent[0]) {\n                        this._lastHover.removeClass(KSTATEHOVER);\n                    }\n\n                    this._lastHover = itemContent.toggleClass(KSTATEHOVER, addChild);\n\n                    if (addChild) {\n                        status = \"plus\";\n                    } else {\n                        position = hoveredItem.position();\n                        position.top += insertOnTop ? 0 : itemHeight;\n\n                        this.dropHint.css(position)\n                            [insertOnTop ? \"prependTo\" : \"appendTo\"]\n                            (options.dropHintContainer(hoveredItem));\n\n                        if (insertOnTop && itemData.first) {\n                            status = \"insert-top\";\n                        }\n\n                        if (insertOnBottom && itemData.last) {\n                            status = \"insert-bottom\";\n                        }\n                    }\n                } else if (target[0] != this.dropHint[0]) {\n                    if (this._lastHover) {\n                        this._lastHover.removeClass(KSTATEHOVER);\n                    }\n\n                    if (!$.contains(this.element[0], container[0])) {\n                        // moving node to different element\n                        status = \"plus\";\n                    } else {\n                        status = \"cancel\";\n                    }\n                }\n            }\n\n            this.options.drag({\n                originalEvent: e.originalEvent,\n                source: source,\n                target: target,\n                pageY: e.y.location,\n                pageX: e.x.location,\n                status: status,\n                setStatus: function(value) {\n                    status = value;\n                }\n            });\n\n            if (status.indexOf(\"insert\") !== 0) {\n                this.dropHint.css(VISIBILITY, \"hidden\");\n            }\n\n            this._hintStatus(status);\n        },\n\n        dragcancel: function() {\n            if (this.dropHint) {\n                this.dropHint.remove();\n            }\n        },\n\n        dragend: function(e) {\n            var position = \"over\",\n                source = this.source,\n                destination,\n                dropHint = this.dropHint,\n                dropTarget = this.dropTarget || $(kendo.eventTarget(e)),\n                eventArgs, dropPrevented, requireTarget;\n\n            if (dropHint && dropHint.css(VISIBILITY) == \"visible\") {\n                position = this.options.dropPositionFrom(dropHint);\n                destination = dropHint.closest(this.options.itemSelector);\n                requireTarget = true;\n            } else if (dropTarget) {\n                destination = dropTarget.closest(this.options.itemSelector);\n\n                // moving node to root element\n                if (!destination.length) {\n                    destination = dropTarget.closest(this.options.allowedContainers);\n                }\n            }\n\n            if (requireTarget && !destination.length) {\n                this.dragcancel();\n                return;\n            }\n\n            eventArgs = {\n                originalEvent: e.originalEvent,\n                source: source[0],\n                destination: destination[0],\n                valid: this.status != \"cancel\",\n                setValid: function(newValid) {\n                    this.valid = newValid;\n                },\n                dropTarget: dropTarget[0],\n                position: position\n            };\n\n            dropPrevented = this.options.drop(eventArgs);\n\n            dropHint.remove();\n            this._removeTouchHover();\n            if (this._lastHover) {\n                this._lastHover.removeClass(KSTATEHOVER);\n            }\n\n            if (!eventArgs.valid || dropPrevented) {\n                this._draggable.dropped = eventArgs.valid;\n                return;\n            }\n\n            this._draggable.dropped = true;\n\n            this.options.dragend({\n                originalEvent: e.originalEvent,\n                source: source,\n                destination: destination,\n                position: position\n            });\n        },\n\n        destroy: function() {\n            this._lastHover = this.hovered = null;\n            this._draggable.destroy();\n        }\n    });\n\n})(window.kendo.jQuery);\nexport default kendo;\n\n"],"mappings":"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"}