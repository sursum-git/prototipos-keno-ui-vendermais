/**
 * Kendo UI v2026.1.212 (http://www.telerik.com/kendo-ui)
 * Copyright 2026 Progress Software Corporation and/or one of its subsidiaries or affiliates. All rights reserved.
 *
 * Kendo UI commercial licenses may be obtained at
 * http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
 * If you do not own a commercial license, this file shall be governed by the trial license terms.
 */
(function(e,t){typeof exports==`object`&&typeof module<`u`?t(exports,require(`kendo.data.min.js`),require(`kendo.draganddrop.min.js`),require(`kendo.userevents.min.js`),require(`kendo.mobile.scroller.min.js`),require(`kendo.drawing.min.js`),require(`kendo.toolbar.min.js`),require(`kendo.tooltip.min.js`),require(`kendo.editable.min.js`),require(`kendo.window.min.js`),require(`kendo.dropdownlist.min.js`),require(`kendo.dataviz.core.min.js`),require(`kendo.dataviz.themes.min.js`),require(`kendo.html.button.min.js`)):typeof define==`function`&&define.amd?define([`exports`,`kendo.data.min`,`kendo.draganddrop.min`,`kendo.userevents.min`,`kendo.mobile.scroller.min`,`kendo.drawing.min`,`kendo.toolbar.min`,`kendo.tooltip.min`,`kendo.editable.min`,`kendo.window.min`,`kendo.dropdownlist.min`,`kendo.dataviz.core.min`,`kendo.dataviz.themes.min`,`kendo.html.button.min`],t):(e=typeof globalThis<`u`?globalThis:e||self,t((e.kendo=e.kendo||{},e.kendo._globals=e.kendo._globals||{},e.kendo._globals.DatavizDiagram={}),e.kendo._globals.Data,e.kendo._globals.Draganddrop,e.kendo._globals.Userevents,e.kendo._globals.MobileScroller,e.kendo._globals.Drawing,e.kendo._globals.Toolbar,e.kendo._globals.Tooltip,e.kendo._globals.Editable,e.kendo._globals.Window,e.kendo._globals.Dropdownlist,e.kendo._globals.DatavizCore,e.kendo._globals.DatavizThemes,e.kendo._globals.HtmlButton))})(this,function(e,t,n,r,i,a,o,s,c,l,u,d,f,p){Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:`Module`}});var m=Object.defineProperty,h=(e,t)=>{let n={};for(var r in e)m(n,r,{get:e[r],enumerable:!0});return t||m(n,Symbol.toStringTag,{value:`Module`}),n};let g=`width`,_=`height`,v=`transparent`,y=`start`,b=`center`,x=`wrap`,S={none:`none`,arrowStart:`ArrowStart`,filledCircle:`FilledCircle`,arrowEnd:`ArrowEnd`};var C;(function(e){e.None=`none`,e.ArrowStart=`ArrowStart`,e.FilledCircle=`FilledCircle`,e.ArrowEnd=`ArrowEnd`})(C||={});let ee=Math.PI/180,te=1e-6,w=`change`,T={arrow:`default`,grip:`pointer`,cross:`pointer`,add:`pointer`,move:`move`,select:`pointer`,south:`s-resize`,east:`e-resize`,west:`w-resize`,north:`n-resize`,rowresize:`row-resize`,colresize:`col-resize`},E=`Auto`,ne=`Right`,re=`Left`,ie=`Bottom`,ae=`dragStart`,oe=`drag`,se=`dragEnd`,ce=`itemRotate`,le=`itemBoundsChange`,ue=`mouseEnter`,de=`mouseLeave`,fe=`zoomStart`,pe=`zoomEnd`,me=`tooltipShow`,he=`tooltipHide`,ge=`rotated`,_e=`source`,ve=`target`,ye={"-1":_e,1:ve},be=`Connection Editing`,xe=`inline`,Se={left:4,right:4,top:2,bottom:2},Ce=`cascading`,we=9007199254740992,Te=`select`,Ee=`none`,De=Number.MAX_VALUE,Oe=-Number.MAX_VALUE,ke=`transformed`,Ae=`k-focus`,je=`aria-activedescendant`,Me=`tabindex`,Ne=`keydown`,Pe=`mousedown`,Fe=`touchstart`,Ie=`pointerdown`,Le=`focus`,Re=`blur`,ze=`ArrowRight`,Be=`ArrowLeft`,Ve=`Shape`,He=`Connection`,Ue=`className`,We=e=>Math.abs(e)<te,D=e=>e!==void 0,O=D,Ge=e=>typeof e==`function`,k=e=>e==null,Ke=e=>e===Object(e),qe=(e,t)=>Object.hasOwnProperty.call(e,t),A=e=>Object.prototype.toString.call(e)===`[object String]`,Je=e=>Object.prototype.toString.call(e)===`[object Boolean]`,Ye=(e,t)=>Object.prototype.toString.call(e)===`[object `+t+`]`,Xe=e=>!isNaN(parseFloat(e))&&isFinite(e),Ze=e=>{if(e===null)return!0;if(Array.isArray(e)||A(e))return e.length===0;for(let t in e)if(qe(e,t))return!1;return!0},Qe=(e,t)=>{if(Ke(t))for(let n in t)n&&(e[n]=t[n])},$e=(e,t)=>{let n=[];for(let r=0;r<e;++r)n[r]=t;return n},et=e=>{let t=[];for(let n=0;n<e.length;n++){let r=e[n];t.push(r.x+`;`+r.y)}return t.join(`;`)},tt=e=>{let t=e.split(`;`),n=[];if(t.length%2!=0)throw Error(`Not an array of points.`);for(let e=0;e<t.length;e+=2)n.push({x:parseInt(t[e],10),y:parseInt(t[e+1],10)});return n},nt=(e,t)=>{let n=Math.floor(Math.random()*t)+e;return parseInt(n.toString(),10)},rt=(e,t)=>{if(t(e),e.childNodes)for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];rt(r,t)}},it=e=>e===null||e.d===0?0:Math.atan2(e.b,e.d)*180/Math.PI,at=e=>[Math.sqrt(e.a*e.a+e.c*e.c),Math.sqrt(e.b*e.b+e.d*e.d)],ot=(e,t)=>{if(e===t)return 0;let n=t.x-e.x,r=e.y-t.y,i=Math.atan(n/r);return r>=0?n<0?i+2*Math.PI:i:i+Math.PI},st=e=>e?e<0?-1:1:0,ct=(e,t)=>ot(e,t)*180/Math.PI,j=(e,t,n)=>{for(let r=0;r<e.length;r++)t.call(n,e[r],r,e)},lt=(e,t)=>{for(let n=0;n<e.length;++n)if(t(e[n]))return e[n];return null},M=(e,t)=>{let n=e.indexOf(t);for(;n!==-1;)e.splice(n,1),n=e.indexOf(t);return e},N=(e,t)=>(e||[]).includes(t),ut=(e,t)=>e.indexOf(t),dt=(e,t)=>t.indexOf(e),ft=(e,t)=>e.filter(t),pt=(e,t,n,r)=>{let i=n!==void 0;for(let a=0;a<e.length;a++){let o=e[a];i?n=t.call(r,n,o,a,e):(n=o,i=!0)}if(!i)throw Error(`Reduce of empty array with no initial value`);return n},mt=(e,t,n)=>e.find(t.bind(n))||void 0,ht=(e,t,n)=>e.length===0?null:k(t)?e[0]:mt(e,t,n),gt=(e,t,n)=>(e.splice(n,0,t),e),_t=(e,t,n)=>{let r=!0,i;for(let a=0;a<e.length&&(i=e[a],r&&=t.call(n,i,a,e),r);a++);return r},vt=e=>{e.splice(0,e.length)},yt=(e,t,n)=>{if(k(e))throw Error(`First array is not specified.`);if(k(t))throw Error(`Second array is not specified.`);if(e.length!==t.length)throw Error(`The two arrays should have equal length`);let r=[];for(let n=0;n<e.length;n++)r.push({x:e[n],y:t[n]});k(n)?r.sort((e,t)=>e.x-t.x):r.sort((e,t)=>n(e.x,t.x)),vt(e),vt(t);for(let n=0;n<r.length;n++)e.push(r[n].x),t.push(r[n].y)},bt=(e,t)=>{e.push(...t)},xt=()=>{},St=`string`,Ct=`function`,wt=function(){this._defaultPrevented=!0},Tt=function(){return this._defaultPrevented===!0};var Et=class{constructor(){this.options={},this.events=[],this._events={}}destroy(){this.unbind()}bind(e,t,n){if(!t&&Ke(e)&&!Array.isArray(e)){for(let t in e)e[t]&&this.bind(t,e[t]);return this}let r=typeof e===St?[e]:e,i=typeof t===Ct,a,o;for(let e=0,s=r.length;e<s;e++){let s=r[e];o=i?t:t[s],o&&(n&&(a=o,o=(...e)=>{this.unbind(s,o),a.apply(this,e)},o.original=a),this._events[s]=this._events[s]||[],this._events[s].push(o))}return this}one(e,t){return this.bind(e,t,!0)}first(e,t){let n=typeof e===St?[String(e)]:Array.from(e),r=typeof t===Ct,i;for(let e=0,a=n.length;e<a;e++){let a=n[e];i=r?t:t[a],i&&(this._events[a]=this._events[a]||[],this._events[a].unshift(i))}return this}trigger(e,t){let n=this._events[e];if(n){let e=t||{};e.sender=this,e._defaultPrevented=!1,e.preventDefault=wt,e.isDefaultPrevented=Tt,n=n.slice();for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);return e._defaultPrevented===!0}return!1}unbind(e,t){let n=this._events[e];if(e===void 0)this._events={};else if(n)if(t)for(let e=n.length-1;e>=0;e--)(n[e]===t||n[e].original===t)&&n.splice(e,1);else this._events[e]=[];return this}_setEvents(e){let t=(this.events||[]).length;for(let n=0;n<t;n++){let t=this.events[n];this.options[t]&&e[t]&&(this.unbind(t,this.options[t]),this._events&&this._events[t]&&delete this._events[t])}this.bind(this.events,e)}},Dt=h({DFT:()=>rt,Observable:()=>Et,addRange:()=>bt,all:()=>_t,bisort:()=>yt,clear:()=>vt,contains:()=>N,defined:()=>O,deserializePoints:()=>tt,find:()=>mt,findAngle:()=>ct,findRadian:()=>ot,first:()=>ht,fold:()=>pt,forEach:()=>j,getAny:()=>lt,getMatrixAngle:()=>it,getMatrixScaling:()=>at,grep:()=>ft,has:()=>qe,inArray:()=>dt,indexOf:()=>ut,initArray:()=>$e,insert:()=>gt,isBoolean:()=>Je,isDefined:()=>D,isEmpty:()=>Ze,isFunction:()=>Ge,isNearZero:()=>We,isNumber:()=>Xe,isObject:()=>Ke,isString:()=>A,isType:()=>Ye,isUndefined:()=>k,noop:()=>xt,randomInteger:()=>nt,remove:()=>M,serializePoints:()=>et,sign:()=>st,simpleExtend:()=>Qe});function Ot(e,t,n){if(e===void 0||t===void 0)return[];if(n&&st(t-e)!==st(n))throw Error(`The sign of the increment should allow to reach the stop-value.`);if(n||=1,e||=0,t||=e,(t-e)/n===1/0)throw Error(`Infinite range defined.`);let r=[],i=-1,a;function o(e){let t=1;for(;e*t%1;)t*=10;return t}let s=o(Math.abs(n));if(e*=s,t*=s,n*=s,e>t&&n>0&&(n=-n),n<0)for(;(a=e+n*++i)>=t;)r.push(a/s);else for(;(a=e+n*++i)<=t;)r.push(a/s);return r}let kt={easeInOut(e){return-Math.cos(e*Math.PI)/2+.5}};var At=class{constructor(){this.adapters=[],this.target=0,this.tick=0,this.interval=20,this.duration=800,this.lastTime=null,this.handlers=[],this.timerDelegate=()=>{},this.intervalId=null,this.caller=null,this.timerDelegate=()=>{this.onTimerEvent()}}addAdapter(e){this.adapters.push(e)}onComplete(e){this.handlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(){this.handlers&&j(this.handlers,e=>e.call(this.caller===null?this:this.caller))}onStep(){}seekTo(e){this.seekFromTo(this.tick,e)}seekFromTo(e,t){this.target=Math.max(0,Math.min(1,t)),this.tick=Math.max(0,Math.min(1,e)),this.lastTime=new Date().getTime(),this.intervalId||=window.setInterval(this.timerDelegate,this.interval)}stop(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.trigger())}play(e){this.adapters.length!==0&&(e!==null&&(this.caller=e),this.initState(),this.seekFromTo(0,1))}reverse(){this.seekFromTo(1,0)}initState(){if(this.adapters.length!==0)for(let e=0;e<this.adapters.length;e++)this.adapters[e].initState()}propagate(){let e=kt.easeInOut(this.tick);for(let t=0;t<this.adapters.length;t++)this.adapters[t].update(e)}onTimerEvent(){let e=new Date().getTime(),t=e-this.lastTime;this.lastTime=e;let n=t/this.duration*(this.tick<this.target?1:-1);Math.abs(n)>=Math.abs(this.tick-this.target)?this.tick=this.target:this.tick+=n;try{this.propagate()}finally{this.onStep.call(this),this.target===this.tick&&this.stop()}}};function jt(e){k(e)&&(e=10);let t=``;for(let n=e;n>0;--n)t+=`0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ`.charAt(Math.round(Math.random()*61));return t}var Mt=class e{constructor(){this._buckets={},this.length=0,this._stringsMap=new Map,this._stringsCounter=0}add(e,t){let n=this._createGetBucket(e);return D(t)&&(n.value=t),n}get(e){return this._bucketExists(e)?this._createGetBucket(e):null}set(e,t){this.add(e,t)}containsKey(e){return this._bucketExists(e)}remove(e){if(this._bucketExists(e)){let t=this._hash(e);return delete this._buckets[t],this.length--,e}}forEach(e){let t=this._hashes();for(let n=0,r=t.length;n<r;n++){let r=t[n],i=this._buckets[r];k(i)||e(i)}}clone(){let t=new e,n=this._hashes();for(let e=0,r=n.length;e<r;e++){let r=n[e],i=this._buckets[r];k(i)||t.add(i.key,i.value)}return t}_hashes(){let e=[];for(let t in this._buckets)Object.prototype.hasOwnProperty.call(this._buckets,t)&&e.push(t);return e}_bucketExists(e){let t=this._hash(e);return D(this._buckets[t])}_createGetBucket(e){let t=this._hash(e),n=this._buckets[t];return k(n)&&(n={key:e},this._buckets[t]=n,this.length++),n}_hash(e){if(A(e)||Xe(e))return this._hashString(String(e));if(Ke(e))return this._objectHashId(e);throw Error(`Unsupported key type.`)}_hashString(e){let t=0;return e.length===0?t:this._stringsMap.has(e)?this._stringsMap.get(e):(this._stringsCounter++,this._stringsMap.set(e,this._stringsCounter),t=this._stringsCounter,t)}_objectHashId(e){let t=e._hashId;return k(t)&&(t=jt(),e._hashId=t),t}},P=class extends Et{constructor(e){if(super(),this._hashTable=new Mt,this.length=0,D(e))if(Array.isArray(e))for(let t=0;t<e.length;t++)this.add(e[t]);else e.forEach(function(e,t){this.add(e,t)},this)}add(e,t){let n=this._hashTable.get(e);n||(n=this._hashTable.add(e),this.length++,this.trigger(`changed`)),n.value=t}set(e,t){this.add(e,t)}get(e){let t=this._hashTable.get(e);if(t)return t.value;throw Error(`Cannot find key `+e)}containsKey(e){return this._hashTable.containsKey(e)}remove(e){if(this.containsKey(e))return this.trigger(`changed`),this.length--,this._hashTable.remove(e)}forEach(e,t){this._hashTable.forEach(function(n){e.call(t,n.key,n.value)})}forEachValue(e,t){this._hashTable.forEach(function(n){e.call(t,n.value)})}forEachKey(e,t){this._hashTable.forEach(function(n){e.call(t,n.key)})}keys(){let e=[];return this.forEachKey(function(t){e.push(t)}),e}};let Nt={_distanceToLineSquared:function(e,t,n){function r(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}if(t===n)return r(e,t);let i=n.x-t.x,a=n.y-t.y,o=(e.x-t.x)*i+(e.y-t.y)*a;return o<0?r(t,e):(o=(n.x-e.x)*i+(n.y-e.y)*a,o<0?r(n,e):(o=(n.x-e.x)*a-(n.y-e.y)*i,o*o/(i*i+a*a)))},distanceToLine:function(e,t,n){return Math.sqrt(this._distanceToLineSquared(e,t,n))},distanceToPolyline:function(e,t){let n=Number.MAX_VALUE;if(k(t)||t.length===0)return Number.MAX_VALUE;for(let r=0;r<t.length-1;r++){let i=t[r],a=t[r+1],o=this._distanceToLineSquared(e,i,a);o<n&&(n=o)}return Math.sqrt(n)}};var Pt=class{},Ft=class extends Pt{constructor(){super(),this._events={}}bind(e,t,n){let r=Lt(e),i=It(t),a=r.length;if(t===void 0){for(let t in e)this.bind(t,e[t]);return this}for(let e=0;e<a;e++){let a=r[e],o=i?t:t[a];if(o){if(n){let e=o;o=()=>{this.unbind(a,o),e.apply(this,arguments)},o.original=e}(this._events[a]=this._events[a]||[]).push(o)}}return this}one(e,t){return this.bind(e,t,!0)}first(e,t){let n=Lt(e),r=It(t);for(let e=0,i=n.length;e<i;e++){let i=n[e],a=r?t:t[i];a&&(this._events[i]=this._events[i]||[]).unshift(a)}return this}trigger(e,t={}){let n=this._events[e];if(n){let e=n.length;t.sender=this,t._defaultPrevented=!1,t.preventDefault=Rt,t.isDefaultPrevented=zt,n=n.slice();for(let r=0;r<e;r++)n[r].call(this,t);return t._defaultPrevented===!0}return!1}unbind(e,t){let n=this._events[e];if(e===void 0)this._events={};else if(n)if(t)for(let e=n.length-1;e>=0;e--)(n[e]===t||n[e].original===t)&&n.splice(e,1);else this._events[e]=[];return this}};function It(e){return typeof e==`function`}function Lt(e){return typeof e==`string`?[e]:e}function Rt(){this._defaultPrevented=!0}function zt(){return this._defaultPrevented===!0}var Bt=Ft;let Vt=e=>{let t=typeof window<`u`?window:{},n=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)};Vt=e=>n.call(t,e),Vt(e)};var Ht=Vt;let Ut=/&/g,Wt=/</g,Gt=/"/g,Kt=/'/g,qt=/>/g;function Jt(e){return String(e).replace(Ut,`&amp;`).replace(Wt,`&lt;`).replace(qt,`&gt;`).replace(Gt,`&quot;`).replace(Kt,`&#39;`)}function Yt(e){let t=window.console;t!==void 0&&t.log&&t.log(e)}function Xt(e){let t={edge:/(edge)[ \/]([\w.]+)/i,webkit:/(chrome)[ \/]([\w.]+)/i,safari:/(webkit)[ \/]([\w.]+)/i,opera:/(opera)(?:.*version|)[ \/]([\w.]+)/i,msie:/(msie\s|trident.*? rv:)([\w.]+)/i,mozilla:/(mozilla)(?:.*? rv:([\w.]+))/i},n={};for(let r in t)if(t.hasOwnProperty(r)){let i=e.match(t[r]);if(i){n[r]=!0,n[i[1].toLowerCase().split(` `)[0].split(`/`)[0]]=!0,n.version=parseInt(document.documentMode||i[2],10);break}}return n}let Zt=null;var Qt={get browser(){return typeof window>`u`||Zt||(Zt=Xt(window.navigator.userAgent)),Zt}},$t=Date.now||function(){return new Date().getTime()};function en(e,t){let n=0,r;if(!t||t<=0)return e;let i=function(){let i=$t()-n,a=arguments,o=function(){e.apply(null,a),n=$t()};if(!n)return o();r&&clearTimeout(r),i>t?o():r=setTimeout(o,t-i)};return i.cancel=function(){clearTimeout(r)},i}var tn={aliceblue:`f0f8ff`,antiquewhite:`faebd7`,aqua:`00ffff`,aquamarine:`7fffd4`,azure:`f0ffff`,beige:`f5f5dc`,bisque:`ffe4c4`,black:`000000`,blanchedalmond:`ffebcd`,blue:`0000ff`,blueviolet:`8a2be2`,brown:`a52a2a`,burlywood:`deb887`,cadetblue:`5f9ea0`,chartreuse:`7fff00`,chocolate:`d2691e`,coral:`ff7f50`,cornflowerblue:`6495ed`,cornsilk:`fff8dc`,crimson:`dc143c`,cyan:`00ffff`,darkblue:`00008b`,darkcyan:`008b8b`,darkgoldenrod:`b8860b`,darkgray:`a9a9a9`,darkgrey:`a9a9a9`,darkgreen:`006400`,darkkhaki:`bdb76b`,darkmagenta:`8b008b`,darkolivegreen:`556b2f`,darkorange:`ff8c00`,darkorchid:`9932cc`,darkred:`8b0000`,darksalmon:`e9967a`,darkseagreen:`8fbc8f`,darkslateblue:`483d8b`,darkslategray:`2f4f4f`,darkslategrey:`2f4f4f`,darkturquoise:`00ced1`,darkviolet:`9400d3`,deeppink:`ff1493`,deepskyblue:`00bfff`,dimgray:`696969`,dimgrey:`696969`,dodgerblue:`1e90ff`,firebrick:`b22222`,floralwhite:`fffaf0`,forestgreen:`228b22`,fuchsia:`ff00ff`,gainsboro:`dcdcdc`,ghostwhite:`f8f8ff`,gold:`ffd700`,goldenrod:`daa520`,gray:`808080`,grey:`808080`,green:`008000`,greenyellow:`adff2f`,honeydew:`f0fff0`,hotpink:`ff69b4`,indianred:`cd5c5c`,indigo:`4b0082`,ivory:`fffff0`,khaki:`f0e68c`,lavender:`e6e6fa`,lavenderblush:`fff0f5`,lawngreen:`7cfc00`,lemonchiffon:`fffacd`,lightblue:`add8e6`,lightcoral:`f08080`,lightcyan:`e0ffff`,lightgoldenrodyellow:`fafad2`,lightgray:`d3d3d3`,lightgrey:`d3d3d3`,lightgreen:`90ee90`,lightpink:`ffb6c1`,lightsalmon:`ffa07a`,lightseagreen:`20b2aa`,lightskyblue:`87cefa`,lightslategray:`778899`,lightslategrey:`778899`,lightsteelblue:`b0c4de`,lightyellow:`ffffe0`,lime:`00ff00`,limegreen:`32cd32`,linen:`faf0e6`,magenta:`ff00ff`,maroon:`800000`,mediumaquamarine:`66cdaa`,mediumblue:`0000cd`,mediumorchid:`ba55d3`,mediumpurple:`9370d8`,mediumseagreen:`3cb371`,mediumslateblue:`7b68ee`,mediumspringgreen:`00fa9a`,mediumturquoise:`48d1cc`,mediumvioletred:`c71585`,midnightblue:`191970`,mintcream:`f5fffa`,mistyrose:`ffe4e1`,moccasin:`ffe4b5`,navajowhite:`ffdead`,navy:`000080`,oldlace:`fdf5e6`,olive:`808000`,olivedrab:`6b8e23`,orange:`ffa500`,orangered:`ff4500`,orchid:`da70d6`,palegoldenrod:`eee8aa`,palegreen:`98fb98`,paleturquoise:`afeeee`,palevioletred:`d87093`,papayawhip:`ffefd5`,peachpuff:`ffdab9`,peru:`cd853f`,pink:`ffc0cb`,plum:`dda0dd`,powderblue:`b0e0e6`,purple:`800080`,red:`ff0000`,rosybrown:`bc8f8f`,royalblue:`4169e1`,saddlebrown:`8b4513`,salmon:`fa8072`,sandybrown:`f4a460`,seagreen:`2e8b57`,seashell:`fff5ee`,sienna:`a0522d`,silver:`c0c0c0`,skyblue:`87ceeb`,slateblue:`6a5acd`,slategray:`708090`,slategrey:`708090`,snow:`fffafa`,springgreen:`00ff7f`,steelblue:`4682b4`,tan:`d2b48c`,teal:`008080`,thistle:`d8bfd8`,tomato:`ff6347`,turquoise:`40e0d0`,violet:`ee82ee`,wheat:`f5deb3`,white:`ffffff`,whitesmoke:`f5f5f5`,yellow:`ffff00`,yellowgreen:`9acd32`};let nn=Qt.browser,rn=e=>{let t=Object.keys(tn);t.push(`transparent`);let n=RegExp(`^(`+t.join(`|`)+`)(\\W|$)`,`i`);return rn=e=>n.exec(e),n.exec(e)};var an=class extends Pt{constructor(){super()}toHSV(){return this}toRGB(){return this}toHex(e){return this.toBytes().toHex(e)}toBytes(){return this}toCss(e){return`#`+this.toHex(e)}toCssRgba(){let e=this.toBytes();return`rgba(${e.r}, ${e.g}, ${e.b}, ${parseFloat(Number(this.a).toFixed(3))})`}toDisplay(){return nn.msie&&nn.version<9?this.toCss():this.toCssRgba()}equals(e){return e===this||e!=null&&this.toCssRgba()===pn(e).toCssRgba()}diff(e){if(e===null)return NaN;let t=this.toBytes(),n=e.toBytes();return Math.sqrt(((t.r-n.r)*.3)**2+((t.g-n.g)*.59)**2+((t.b-n.b)*.11)**2)}clone(){let e=this.toBytes();return e===this&&(e=new sn(e.r,e.g,e.b,e.a)),e}},on=class extends an{constructor(e,t,n,r){super(),this.r=e,this.g=t,this.b=n,this.a=r}toHSV(){let{r:e,g:t,b:n}=this,r=Math.min(e,t,n),i=Math.max(e,t,n),a=i-r,o=i,s,c;return a===0?new ln(0,0,o,this.a):(i===0?(c=0,s=-1):(c=a/i,s=e===i?(t-n)/a:t===i?2+(n-e)/a:4+(e-t)/a,s*=60,s<0&&(s+=360)),new ln(s,c,o,this.a))}toHSL(){let{r:e,g:t,b:n}=this,r=Math.max(e,t,n),i=Math.min(e,t,n),a,o,s=(r+i)/2;if(r===i)a=o=0;else{let c=r-i;switch(o=s>.5?c/(2-r-i):c/(r+i),r){case e:a=(t-n)/c+(t<n?6:0);break;case t:a=(n-e)/c+2;break;case n:a=(e-t)/c+4;break;default:break}}return new un(a*60,o*100,s*100,this.a)}toBytes(){return new sn(this.r*255,this.g*255,this.b*255,this.a)}},sn=class extends on{constructor(e,t,n,r){super(Math.round(e),Math.round(t),Math.round(n),r)}toRGB(){return new on(this.r/255,this.g/255,this.b/255,this.a)}toHSV(){return this.toRGB().toHSV()}toHSL(){return this.toRGB().toHSL()}toHex(e){let t=cn(this.r,2)+cn(this.g,2)+cn(this.b,2);return e&&e.alpha&&(t+=cn(Math.round(this.a*255),2)),t}toBytes(){return this}};function cn(e,t,n=`0`){let r=e.toString(16);for(;t>r.length;)r=n+r;return r}var ln=class extends an{constructor(e,t,n,r){super(),this.h=e,this.s=t,this.v=n,this.a=r}toRGB(){let{h:e,s:t,v:n}=this,r,i,a;if(t===0)r=i=a=n;else{e/=60;let o=Math.floor(e),s=e-o,c=n*(1-t),l=n*(1-t*s),u=n*(1-t*(1-s));switch(o){case 0:r=n,i=u,a=c;break;case 1:r=l,i=n,a=c;break;case 2:r=c,i=n,a=u;break;case 3:r=c,i=l,a=n;break;case 4:r=u,i=c,a=n;break;default:r=n,i=c,a=l;break}}return new on(r,i,a,this.a)}toHSL(){return this.toRGB().toHSL()}toBytes(){return this.toRGB().toBytes()}},un=class extends an{constructor(e,t,n,r){super(),this.h=e,this.s=t,this.l=n,this.a=r}toRGB(){let e=this.h/360,t=this.s/100,n=this.l/100,r,i,a;if(t===0)r=i=a=n;else{let o=n<.5?n*(1+t):n+t-n*t,s=2*n-o;r=dn(s,o,e+1/3),i=dn(s,o,e),a=dn(s,o,e-1/3)}return new on(r,i,a,this.a)}toHSV(){return this.toRGB().toHSV()}toBytes(){return this.toRGB().toBytes()}};function dn(e,t,n){let r=n;return r<0&&(r+=1),r>1&&--r,r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function fn(e){return parseFloat(parseFloat(parseInt(e,16)/255).toFixed(3))}function pn(e,t){let n,r;if(!e||e===`none`)return null;if(e instanceof an)return e;let i=e.toLowerCase();if(n=rn(i))return i=n[1]===`transparent`?new on(1,1,1,0):pn(tn[n[1]],t),i.match=[n[1]],i;if((n=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})\b/i.exec(i))?r=new sn(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),1):(n=/^#?([0-9a-f])([0-9a-f])([0-9a-f])\b/i.exec(i))?r=new sn(parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16),1):(n=/^#?([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])\b/i.exec(i))?r=new sn(parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16),fn(n[4]+n[4])):(n=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})\b/i.exec(i))?r=new sn(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),fn(n[4])):(n=/^rgb\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/.exec(i))?r=new sn(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),1):(n=/^rgba\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9.]+)\s*\)/.exec(i))?r=new sn(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),parseFloat(n[4])):(n=/^rgb\(\s*([0-9]*\.?[0-9]+)%\s*,\s*([0-9]*\.?[0-9]+)%\s*,\s*([0-9]*\.?[0-9]+)%\s*\)/.exec(i))?r=new on(parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])/100,1):(n=/^rgba\(\s*([0-9]*\.?[0-9]+)%\s*,\s*([0-9]*\.?[0-9]+)%\s*,\s*([0-9]*\.?[0-9]+)%\s*,\s*([0-9.]+)\s*\)/.exec(i))?r=new on(parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])/100,parseFloat(n[4])):(n=/^color\(\s*srgb\s*([0-9]*\.?[0-9]+)\s+([0-9]*\.?[0-9]+)\s+([0-9]*\.?[0-9]+)\s*(\/\s+([0-9]*\.?[0-9]+))?\)/.exec(i))&&(r=new on(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]),parseFloat(n[5]||`1`))),r)r.match=n;else if(!t)throw Error(`Cannot parse color: `+i);return r}var mn=class e extends Pt{constructor(t){if(super(),arguments.length===1){let n=e.formats,r=this.resolveColor(t);for(let e=0;e<n.length;e++){let t=n[e].re,i=n[e].process,a=t.exec(r);if(a){let e=i(a);this.r=e[0],this.g=e[1],this.b=e[2]}}}else this.r=arguments[0],this.g=arguments[1],this.b=arguments[2];this.r=this.normalizeByte(this.r),this.g=this.normalizeByte(this.g),this.b=this.normalizeByte(this.b)}toHex(){let e=this.padDigit,t=this.r.toString(16),n=this.g.toString(16),r=this.b.toString(16);return`#`+e(t)+e(n)+e(r)}resolveColor(t){let n=t||`black`;return n.charAt(0)===`#`&&(n=n.substr(1,6)),n=n.replace(/ /g,``),n=n.toLowerCase(),n=e.namedColors[n]||n,n}normalizeByte(e){return e<0||isNaN(e)?0:e>255?255:e}padDigit(e){return e.length===1?`0`+e:e}brightness(e){let t=Math.round;return this.r=t(this.normalizeByte(this.r*e)),this.g=t(this.normalizeByte(this.g*e)),this.b=t(this.normalizeByte(this.b*e)),this}percBrightness(){return Math.sqrt(.241*this.r*this.r+.691*this.g*this.g+.068*this.b*this.b)}isDark(){return this.percBrightness()<180}static fromBytes(e,t,n,r){return new sn(e,t,n,r??1)}static fromRGB(e,t,n,r){return new on(e,t,n,r??1)}static fromHSV(e,t,n,r){return new ln(e,t,n,r??1)}static fromHSL(e,t,n,r){return new un(e,t,n,r??1)}};mn.formats=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(e){return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],mn.namedColors=tn;var hn=mn,gn=class extends Pt{observers(){return this._observers=this._observers||[],this._observers}addObserver(e){return this._observers?this._observers.push(e):this._observers=[e],this}removeObserver(e){let t=this.observers(),n=t.indexOf(e);return n!==-1&&t.splice(n,1),this}trigger(e,t){let n=this._observers;if(n&&!this._suspended)for(let r=0;r<n.length;r++){let i=n[r];i[e]&&i[e](t)}return this}optionsChange(e={}){e.element=this,this.trigger(`optionsChange`,e)}geometryChange(){this.trigger(`geometryChange`,{element:this})}suspend(){return this._suspended=(this._suspended||0)+1,this}resume(){return this._suspended=Math.max((this._suspended||0)-1,0),this}_observerField(e,t){this[e]&&this[e].removeObserver(this),this[e]=t,t.addObserver(this)}};let _n={}.toString;var vn=class e extends gn{constructor(e,t=``){for(let n in super(),this.prefix=t,e){let t=e[n];t=this._wrap(t,n),this[n]=t}}get(e){let t=e.split(`.`),n=this;for(;t.length&&n;){let e=t.shift();n=n[e]}return n}set(e,t){this.get(e)!==t&&(this._set(e,this._wrap(t,e)),this.optionsChange({field:this.prefix+e,value:t}))}_set(t,n){let r=t.indexOf(`.`)>=0,i=this,a=t;if(r){let t=a.split(`.`),n=this.prefix;for(;t.length>1;){a=t.shift(),n+=a+`.`;let r=i[a];r||(r=new e({},n),r.addObserver(this),i[a]=r),i=r}a=t[0]}i._clear(a),i[a]=n}_clear(e){let t=this[e];t&&t.removeObserver&&t.removeObserver(this)}_wrap(t,n){let r=_n.call(t),i=t;return i!=null&&r===`[object Object]`&&(!(t instanceof e)&&!(t instanceof Pt)&&(i=new e(i,this.prefix+n+`.`)),i.addObserver(this)),i}};function yn(e){return function(t){return this[e]!==t&&(this[e]=t,this.geometryChange()),this}}function bn(e){return function(){return this[e]}}function xn(e,t){for(let n=0;n<t.length;n++){let r=t[n],i=r.charAt(0).toUpperCase()+r.substring(1,r.length);e[`set`+i]=yn(r),e[`get`+i]=bn(r)}}var Sn=(e,t)=>{let n=class extends e{};return xn(n.prototype,t),n};function Cn(e,t){return e.push.apply(e,t),e}let wn={1:`i`,10:`x`,100:`c`,2:`ii`,20:`xx`,200:`cc`,3:`iii`,30:`xxx`,300:`ccc`,4:`iv`,40:`xl`,400:`cd`,5:`v`,50:`l`,500:`d`,6:`vi`,60:`lx`,600:`dc`,7:`vii`,70:`lxx`,700:`dcc`,8:`viii`,80:`lxxx`,800:`dccc`,9:`ix`,90:`xc`,900:`cm`,1e3:`m`};function Tn(e){let t=[1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],n=``;for(;e>0;)e<t[0]?t.shift():(n+=wn[t[0]],e-=t[0]);return n}function En(){let e,t,n=new Promise((r,i)=>{e=e=>(n._state=`resolved`,r(e),n),t=e=>(n._state=`rejected`,i(e),n)});return n._state=`pending`,n.resolve=e,n.reject=t,n.state=()=>n._state,n}let Dn=1;function On(){return`kdef`+ Dn++}let kn=Math.PI/180,An=Number.MAX_VALUE,jn=-Number.MAX_VALUE;function Mn(e){return e/kn}let Nn=String.fromCharCode;function Pn(e){let t=``;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(55296<=r&&r<=56319){let t=r,i=e.charCodeAt(++n);isNaN(i)||(r=(t-55296)*1024+(i-56320)+65536)}r<128?t+=Nn(r):r<2048?(t+=Nn(192|r>>>6),t+=Nn(128|r&63)):r<65536?(t+=Nn(224|r>>>12),t+=Nn(128|r>>>6&63),t+=Nn(128|r&63)):r<1114111&&(t+=Nn(240|r>>>18),t+=Nn(128|r>>>12&63),t+=Nn(128|r>>>6&63),t+=Nn(128|r&63))}return t}let Fn=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=`;function In(e){let t=``,n=0,r=Pn(e);for(;n<r.length;){let e=r.charCodeAt(n++),i=r.charCodeAt(n++),a=r.charCodeAt(n++),o=e>>2,s=(e&3)<<4|i>>4,c=(i&15)<<2|a>>6,l=a&63;isNaN(i)?c=l=64:isNaN(a)&&(l=64),t=t+Fn.charAt(o)+Fn.charAt(s)+Fn.charAt(c)+Fn.charAt(l)}return t}function Ln(e){return(e.x||{}).location===void 0?{x:e.pageX||e.clientX||0,y:e.pageY||e.clientY||0}:{x:e.x.location,y:e.y.location}}function Rn(e={}){return e.touch?e.touch.initialTouch:e.target}function zn(e){return e===``||e===null||e===`none`||e===`transparent`||e===void 0}function Bn(e){if(e)return e[e.length-1]}function Vn(e,t,n){return Math.max(Math.min(e,n),t)}function Hn(e,t){if(e.length<2)return e.slice();function n(e,n){for(var r=[],i=0,a=0,o=0;i<e.length&&a<n.length;)t(e[i],n[a])<=0?r[o++]=e[i++]:r[o++]=n[a++];return i<e.length&&r.push.apply(r,e.slice(i)),a<n.length&&r.push.apply(r,n.slice(a)),r}return(function e(t){if(t.length<=1)return t;var r=Math.floor(t.length/2),i=t.slice(0,r),a=t.slice(r);return i=e(i),a=e(a),n(i,a)})(e)}function Un(e){return Promise.all(e)}function Wn(e){return e*kn}function Gn(e){return e?10**e:1}function F(e,t){let n=Gn(t);return Math.round(e*n)/n}function Kn(e,t){return e===void 0?t:e}function qn(e,t){for(let n in t){let r=n.trim().split(` `);for(let i=0;i<r.length;i++)e.addEventListener(r[i],t[n],!1)}}function Jn(e){let t=e.getBoundingClientRect(),n=document.documentElement;return{top:t.top+(window.pageYOffset||n.scrollTop)-(n.clientTop||0),left:t.left+(window.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}}function Yn(e,t){let n={},r=window.getComputedStyle(e)||{},i=Array.isArray(t)?t:[t];for(let e=0;e<i.length;e++){let t=i[e];n[t]=r[t]}return n}function Xn(e){return isNaN(e)?e:e+`px`}function Zn(e,t){if(t){let{width:n,height:r}=t;n!==void 0&&(e.style.width=Xn(n)),r!==void 0&&(e.style.height=Xn(r))}else{let t=Yn(e,[`width`,`height`]);return{width:parseInt(t.width,10),height:parseInt(t.height,10)}}}function Qn(e,t={}){for(let n in t){let r=n.trim().split(` `);for(let i=0;i<r.length;i++)e.removeEventListener(r[i],t[n],!1)}}function $n(e){let{paddingLeft:t,paddingTop:n}=Yn(e,[`paddingLeft`,`paddingTop`]);return{top:parseFloat(n),left:parseFloat(t)}}var er=class e extends Pt{constructor(e=0,t=0,n=0,r=0,i=0,a=0){super(),this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=a}multiplyCopy(t){return new e(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)}invert(){let{a:t,b:n,c:r,d:i,e:a,f:o}=this,s=t*i-n*r;return s===0?null:new e(i/s,-n/s,-r/s,t/s,(r*o-i*a)/s,(n*a-t*o)/s)}clone(){return new e(this.a,this.b,this.c,this.d,this.e,this.f)}equals(e){return e?this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f:!1}round(e){return this.a=F(this.a,e),this.b=F(this.b,e),this.c=F(this.c,e),this.d=F(this.d,e),this.e=F(this.e,e),this.f=F(this.f,e),this}toArray(e){let t=[this.a,this.b,this.c,this.d,this.e,this.f];if(e!==void 0)for(let n=0;n<t.length;n++)t[n]=F(t[n],e);return t}toString(e,t=`,`){return this.toArray(e).join(t)}static translate(t,n){return new e(1,0,0,1,t,n)}static unit(){return new e(1,0,0,1,0,0)}static rotate(t,n,r){let i=new e;return i.a=Math.cos(Wn(t)),i.b=Math.sin(Wn(t)),i.c=-i.b,i.d=i.a,i.e=n-n*i.a+r*i.b||0,i.f=r-r*i.a-n*i.b||0,i}static scale(t,n){return new e(t,0,0,n,0,0)}};er.IDENTITY=er.unit();var tr=er;let nr=/matrix\((.*)\)/;function rr(e){let t=e.match(nr);return t===null||t.length!==2?tr.unit():new tr(...t[1].split(`,`).map(e=>parseFloat(e)))}function ir(e){let t=getComputedStyle(e).transform;return t===`none`?tr.unit():rr(t)}function ar(e){if(!e)return tr.unit();let t=ir(e),n=e.parentElement;for(;n;){let e=ir(n);t=t.multiplyCopy(e),n=n.parentElement}return t.b=t.c=t.e=t.f=0,t}var or=class extends Pt{constructor(e){super(),this._size=e,this._length=0,this._map={}}put(e,t){let n=this._map,r={key:e,value:t};n[e]=r,this._head?(this._tail.newer=r,r.older=this._tail,this._tail=r):this._head=this._tail=r,this._length>=this._size?(n[this._head.key]=null,this._head=this._head.newer,this._head.older=null):this._length++}get(e){let t=this._map[e];if(t)return t===this._head&&t!==this._tail&&(this._head=t.newer,this._head.older=null),t!==this._tail&&(t.older&&(t.older.newer=t.newer,t.newer.older=t.older),t.older=this._tail,t.newer=null,this._tail.newer=t,this._tail=t),t.value}};let sr=/\r?\n|\r|\t/g;function cr(e){return String(e).replace(sr,` `)}function lr(e){let t=[];for(let n in e)t.push(n+e[n]);return t.sort().join(``)}function ur(e){let t=2166136261;for(let n=0;n<e.length;++n)t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24),t^=e.charCodeAt(n);return t>>>0}function dr(){return{width:0,height:0,baseline:0}}let fr={baselineMarkerSize:1},pr;typeof document<`u`&&(pr=document.createElement(`div`),pr.style.setProperty(`position`,`absolute`,`important`),pr.style.setProperty(`top`,`-4000px`,`important`),pr.style.setProperty(`width`,`auto`,`important`),pr.style.setProperty(`height`,`auto`,`important`),pr.style.setProperty(`padding`,`0`,`important`),pr.style.setProperty(`margin`,`0`,`important`),pr.style.setProperty(`border`,`0`,`important`),pr.style.setProperty(`line-height`,`normal`,`important`),pr.style.setProperty(`visibility`,`hidden`,`important`),pr.style.setProperty(`white-space`,`pre`,`important`));var mr=class extends Pt{constructor(e){super(),this._cache=new or(1e3),this.options=Object.assign({},fr,e)}measure(e,t,n={}){if(e==null)return dr();let r=ur(e+lr(t)),i=this._cache.get(r);if(i)return i;let a=dr(),o=n.box||pr,s=this._baselineMarker().cloneNode(!1);for(let e in t){let n=t[e];n!==void 0&&(o.style[e]=n)}let c=n.normalizeText===!1?String(e):cr(e);return o.textContent=c,o.appendChild(s),document.body.appendChild(o),c.length&&(a.width=o.offsetWidth-this.options.baselineMarkerSize,a.height=o.offsetHeight,a.baseline=s.offsetTop+this.options.baselineMarkerSize),a.width>0&&a.height>0&&this._cache.put(r,a),o.parentNode.removeChild(o),a}_baselineMarker(){let e=document.createElement(`div`);return e.style.display=`inline-block`,e.style.verticalAlign=`baseline`,e.style.width=this.options.baselineMarkerSize+`px`,e.style.height=this.options.baselineMarkerSize+`px`,e.style.overflow=`hidden`,e}};mr.current=new mr;var hr=mr;function gr(e,t,n){return hr.current.measure(e,t,n)}let _r=()=>typeof window<`u`,vr={wp:/(Windows Phone(?: OS)?)\s(\d+)\.(\d+(\.\d+)?)/,fire:/(Silk)\/(\d+)\.(\d+(\.\d+)?)/,android:/(Android|Android.*(?:Opera|Firefox).*?\/)\s*(\d+)(\.(\d+(\.\d+)?))?/,iphone:/(iPhone|iPod).*OS\s+(\d+)[\._]([\d\._]+)/,ipad:/(iPad).*OS\s+(\d+)[\._]([\d_]+)/,meego:/(MeeGo).+NokiaBrowser\/(\d+)\.([\d\._]+)/,webos:/(webOS)\/(\d+)\.(\d+(\.\d+)?)/,blackberry:/(BlackBerry|BB10).*?Version\/(\d+)\.(\d+(\.\d+)?)/,playbook:/(PlayBook).*?Tablet\s*OS\s*(\d+)\.(\d+(\.\d+)?)/,windows:/(MSIE)\s+(\d+)\.(\d+(\.\d+)?)/,tizen:/(tizen).*?Version\/(\d+)\.(\d+(\.\d+)?)/i,sailfish:/(sailfish).*rv:(\d+)\.(\d+(\.\d+)?).*firefox/i,ffos:/(Mobile).*rv:(\d+)\.(\d+(\.\d+)?).*Firefox/},yr={ios:/^i(phone|pad|pod)$/i,android:/^android|fire$/i,blackberry:/^blackberry|playbook/i,windows:/windows/,wp:/wp/,flat:/sailfish|ffos|tizen/i,meego:/meego/},br={edge:/(edge)[ \/]([\w.]+)/i,webkit:/(chrome)[ \/]([\w.]+)/i,safari:/(webkit)[ \/]([\w.]+)/i,opera:/(opera)(?:.*version|)[ \/]([\w.]+)/i,msie:/(msie\s|trident.*? rv:)([\w.]+)/i,mozilla:/(mozilla)(?:.*? rv:([\w.]+)|)/i},xr={omini:/Opera\sMini/i,omobile:/Opera\sMobi/i,firefox:/Firefox|Fennec/i,mobilesafari:/version\/.*safari/i,ie:/MSIE|Windows\sPhone/i,chrome:/chrome|crios/i,webkit:/webkit/i},Sr=(e,t,n)=>{for(let n in t)if(t.hasOwnProperty(n)&&t[n].test(e))return n;return n===void 0?e:n},Cr=e=>{let t,n=[];for(let r in vr)if(vr.hasOwnProperty(r)){if(n=e.match(vr[r]),!n)continue;if(r===`windows`&&`plugins`in window.navigator)return null;let i={};return i.device=r,i.browser=Sr(e,xr,`default`),i.name=Sr(r,yr),i[i.name]=!0,i.majorVersion=n[2],i.minorVersion=n[3]?n[3].replace(`_`,`.`):`.0`,t=i.minorVersion.replace(`.`,``).substr(0,2),i.flatVersion=i.majorVersion+t+Array(3-(t.length<3?t.length:2)).join(`0`),i.cordova=!0,i.appMode=window.navigator.standalone||/file|local|wmapp/.test(window.location.protocol)||i.cordova,i}return null},wr=e=>{let t=null,n=[];for(let r in br)if(br.hasOwnProperty(r)&&(n=e.match(br[r]),n)){t={},t[r]=!0,t[n[1].toLowerCase().split(` `)[0].split(`/`)[0]]=!0,t.version=parseInt(document.documentMode||n[2],10);break}return t},Tr=_r()&&window.navigator?window.navigator.userAgent:null,Er=Tr?wr(Tr):null,Dr=Tr?Cr(Tr):null;_r()&&`ontouchstart`in window,Er&&!Er.chrome&&window.MSPointerEvent,Er&&!Er.chrome&&window.PointerEvent;let Or={};Or.undefined=e=>e;let kr={};kr.undefined=e=>e;let Ar=/\/\*[\s\S]*?\*\//g,jr=/([^\s:;]+?)\s*:\s*((?:(?:url\(\s*(?:(?:[^"')\\]|\\.)*|"(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')\s*\)|"(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*'|[^;"'])*?)\s*)(?=;|$)/gi,Mr=/&quot;|&#34;|&#x22;/gi,Nr=/&apos;|&#39;|&#x27;/gi;function Pr(e){return e.replace(Mr,`"`).replace(Nr,`'`)}function Fr(e){let t={},n=Pr((e||``).replace(Ar,``)),r=jr.exec(n),i,a;for(;r!==null;)i=r[1].trim(),a=r[2].trim(),t[i]=a,r=jr.exec(n);return t}let Ir=(e,t)=>{let n=Fr(t);Object.keys(n).forEach(t=>{e.style[t]=n[t]})},Lr=`data-style`,Rr=e=>(e||``).replace(/\sstyle=/g,` `+Lr+`=`),zr=e=>{Array.from(e.querySelectorAll(`[`+Lr+`]`)).forEach(e=>{let t=e.getAttribute(Lr);e.removeAttribute(Lr),Ir(e,t)})},Br=(e,t)=>{e.innerHTML=Rr(t),zr(e)};function Vr(e){return e&&typeof e.matrix==`function`?e.matrix():e}var I=class e extends Sn(gn,[`x`,`y`]){constructor(e,t){super(),this.x=e||0,this.y=t||0}equals(e){return e&&e.x===this.x&&e.y===this.y}clone(){return new e(this.x,this.y)}rotate(t,n){let r=e.create(n)||e.ZERO;return this.transform(tr.rotate(t,r.x,r.y))}translate(e,t){return this.x+=e,this.y+=t,this.geometryChange(),this}translateWith(e){return this.translate(e.x,e.y)}move(e,t){return this.x=this.y=0,this.translate(e,t)}scale(e,t=e){return this.x*=e,this.y*=t,this.geometryChange(),this}scaleCopy(e,t){return this.clone().scale(e,t)}transform(e){let t=Vr(e),{x:n,y:r}=this;return this.x=t.a*n+t.c*r+t.e,this.y=t.b*n+t.d*r+t.f,this.geometryChange(),this}transformCopy(e){let t=this.clone();return e&&t.transform(e),t}distanceTo(e){let t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}round(e){return this.x=F(this.x,e),this.y=F(this.y,e),this.geometryChange(),this}toArray(e){let t=e!==void 0;return[t?F(this.x,e):this.x,t?F(this.y,e):this.y]}toString(e,t=` `){let{x:n,y:r}=this;return e!==void 0&&(n=F(n,e),r=F(r,e)),n+t+r}static create(t,n){if(t!==void 0)return t instanceof e?t:arguments.length===1&&t.length===2?new e(t[0],t[1]):new e(t,n)}static min(){let t=An,n=An;for(let e=0;e<arguments.length;e++){let r=arguments[e];t=Math.min(r.x,t),n=Math.min(r.y,n)}return new e(t,n)}static max(){let t=jn,n=jn;for(let e=0;e<arguments.length;e++){let r=arguments[e];t=Math.max(r.x,t),n=Math.max(r.y,n)}return new e(t,n)}static minPoint(){return new e(jn,jn)}static maxPoint(){return new e(An,An)}static get ZERO(){return new e(0,0)}},Hr=class e extends Sn(gn,[`width`,`height`]){constructor(e,t){super(),this.width=e||0,this.height=t||0}equals(e){return e&&e.width===this.width&&e.height===this.height}clone(){return new e(this.width,this.height)}toArray(e){let t=e!==void 0;return[t?F(this.width,e):this.width,t?F(this.height,e):this.height]}static create(t,n){if(t!==void 0)return t instanceof e?t:arguments.length===1&&t.length===2?new e(t[0],t[1]):new e(t,n)}static get ZERO(){return new e(0,0)}},L=class e extends gn{constructor(e=new I,t=new Hr,n=0){super(),this.setOrigin(e),this.setSize(t),this.setCornerRadius(n)}clone(){return new e(this.origin.clone(),this.size.clone())}equals(e){return e&&e.origin.equals(this.origin)&&e.size.equals(this.size)}setOrigin(e){return this._observerField(`origin`,I.create(e)),this.geometryChange(),this}getOrigin(){return this.origin}setCornerRadius(e){return this.cornerRadius=Array.isArray(e)?e:[e,e],this.geometryChange(),this}getCornerRadius(){return this.cornerRadius}setSize(e){return this._observerField(`size`,Hr.create(e)),this.geometryChange(),this}getSize(){return this.size}width(){return this.size.width}height(){return this.size.height}topLeft(){return this.origin.clone()}bottomRight(){return this.origin.clone().translate(this.width(),this.height())}topRight(){return this.origin.clone().translate(this.width(),0)}bottomLeft(){return this.origin.clone().translate(0,this.height())}center(){return this.origin.clone().translate(this.width()/2,this.height()/2)}bbox(t){let n=this.topLeft().transformCopy(t),r=this.topRight().transformCopy(t),i=this.bottomRight().transformCopy(t),a=this.bottomLeft().transformCopy(t);return e.fromPoints(n,r,i,a)}transformCopy(t){return e.fromPoints(this.topLeft().transform(t),this.bottomRight().transform(t))}expand(e,t=e){return this.size.width+=2*e,this.size.height+=2*t,this.origin.translate(-e,-t),this}expandCopy(e,t){return this.clone().expand(e,t)}containsPoint(e){let t=this.origin,n=this.bottomRight();return!(e.x<t.x||e.y<t.y||n.x<e.x||n.y<e.y)}_isOnPath(e,t){let n=this.expandCopy(t,t),r=this.expandCopy(-t,-t);return n.containsPoint(e)&&!r.containsPoint(e)}static fromPoints(){let t=I.min.apply(null,arguments),n=I.max.apply(null,arguments);return new e(t,new Hr(n.x-t.x,n.y-t.y))}static union(t,n){return e.fromPoints(I.min(t.topLeft(),n.topLeft()),I.max(t.bottomRight(),n.bottomRight()))}static intersect(t,n){let r={left:t.topLeft().x,top:t.topLeft().y,right:t.bottomRight().x,bottom:t.bottomRight().y},i={left:n.topLeft().x,top:n.topLeft().y,right:n.bottomRight().x,bottom:n.bottomRight().y};if(r.left<=i.right&&i.left<=r.right&&r.top<=i.bottom&&i.top<=r.bottom)return e.fromPoints(new I(Math.max(r.left,i.left),Math.max(r.top,i.top)),new I(Math.min(r.right,i.right),Math.min(r.bottom,i.bottom)))}},Ur=class e extends gn{constructor(e=tr.unit()){super(),this._matrix=e}clone(){return new e(this._matrix.clone())}equals(e){return e&&e._matrix.equals(this._matrix)}translate(e,t){return this._matrix=this._matrix.multiplyCopy(tr.translate(e,t)),this._optionsChange(),this}scale(e,t=e,n=null){let r=n;return r&&(r=I.create(r),this._matrix=this._matrix.multiplyCopy(tr.translate(r.x,r.y))),this._matrix=this._matrix.multiplyCopy(tr.scale(e,t)),r&&(this._matrix=this._matrix.multiplyCopy(tr.translate(-r.x,-r.y))),this._optionsChange(),this}rotate(e,t){let n=I.create(t)||I.ZERO;return this._matrix=this._matrix.multiplyCopy(tr.rotate(e,n.x,n.y)),this._optionsChange(),this}multiply(e){let t=Vr(e);return this._matrix=this._matrix.multiplyCopy(t),this._optionsChange(),this}matrix(e){return e?(this._matrix=e,this._optionsChange(),this):this._matrix}_optionsChange(){this.optionsChange({field:`transform`,value:this})}};function Wr(e){return e===null?null:e instanceof Ur?e:new Ur(e)}let Gr={dot:[1.5,3.5],dash:[4,3.5],longdash:[8,3.5],dashdot:[3.5,3.5,1.5,3.5],longdashdot:[8,3.5,1.5,3.5],longdashdotdot:[8,3.5,1.5,3.5,1.5,3.5]},Kr=`solid`,qr=`butt`,Jr=`Pattern`;var Yr=class extends gn{get nodeType(){return`Rect`}constructor(e){super(),this._initOptions(e)}_initOptions(e={}){let{clip:t,transform:n}=e;n&&(e.transform=Wr(n)),t&&!t.id&&(t.id=On()),this.options=new vn(e),this.options.addObserver(this)}transform(e){if(e!==void 0)this.options.set(`transform`,Wr(e));else return this.options.get(`transform`)}parentTransform(){let e=this,t;for(;e.parent;){e=e.parent;let n=e.transform();n&&(t=n.matrix().multiplyCopy(t||tr.unit()))}if(t)return Wr(t)}currentTransform(e=this.parentTransform()){let t=Vr(this.transform()),n=Vr(e),r;if(r=t&&n?n.multiplyCopy(t):t||n,r)return Wr(r)}visible(e){return e===void 0?this.options.get(`visible`)!==!1:(this.options.set(`visible`,e),this)}clip(e){let t=this.options;return e===void 0?t.get(`clip`):(e&&!e.id&&(e.id=On()),t.set(`clip`,e),this)}opacity(e){return e===void 0?Kn(this.options.get(`opacity`),1):(this.options.set(`opacity`,e),this)}className(e){return e===void 0?this.options.get(`className`):(this.options.set(`className`,e),this)}clippedBBox(e){let t=this._clippedBBox(e);if(t){let n=this.clip();return n?L.intersect(t,n.bbox(e)):t}}containsPoint(e,t){if(this.visible()){let n=this.currentTransform(t),r=e;return n&&(r=e.transformCopy(n.matrix().invert())),this._hasFill()&&this._containsPoint(r)||this._isOnPath&&this._hasStroke()&&this._isOnPath(r)}return!1}_hasFill(){let e=this.options.fill;return e&&(e.nodeType===Jr||!zn(e.color))}_hasStroke(){let e=this.options.stroke;return e&&e.width>0&&!zn(e.color)}_clippedBBox(e){return this.bbox(e)}};function Xr(e,t,n,r){let i=0,a=0;return r&&(i=Math.atan2(r.c*n,r.a*t),r.b!==0&&(a=Math.atan2(r.d*n,r.b*t))),{x:i,y:a}}let Zr=Math.PI/2;var Qr=class e extends Sn(gn,[`radius`]){constructor(e=new I,t=0){super(),this.setCenter(e),this.setRadius(t)}setCenter(e){return this._observerField(`center`,I.create(e)),this.geometryChange(),this}getCenter(){return this.center}equals(e){return e&&e.center.equals(this.center)&&e.radius===this.radius}clone(){return new e(this.center.clone(),this.radius)}pointAt(e){return this._pointAt(Wn(e))}bbox(e){let t=Xr(this.center,this.radius,this.radius,e),n=I.maxPoint(),r=I.minPoint();for(let i=0;i<4;i++){let a=this._pointAt(t.x+i*Zr).transformCopy(e),o=this._pointAt(t.y+i*Zr).transformCopy(e),s=new I(a.x,o.y);n=I.min(n,s),r=I.max(r,s)}return L.fromPoints(n,r)}_pointAt(e){let{center:t,radius:n}=this;return new I(t.x+n*Math.cos(e),t.y+n*Math.sin(e))}containsPoint(e){let{center:t,radius:n}=this;return(e.x-t.x)**2+(e.y-t.y)**2<=n**2}_isOnPath(e,t){let{center:n,radius:r}=this,i=n.distanceTo(e);return r-t<=i&&i<=r+t}},$r=e=>class extends e{fill(e,t){let n=this.options;if(e!==void 0){if(e&&e.nodeType!==`Gradient`){let r={color:e};t!==void 0&&(r.opacity=t),n.set(`fill`,r)}else n.set(`fill`,e);return this}return n.get(`fill`)}stroke(e,t,n){return e===void 0?this.options.get(`stroke`):(this.options.set(`stroke.color`,e),t!==void 0&&this.options.set(`stroke.width`,t),n!==void 0&&this.options.set(`stroke.opacity`,n),this)}};let ei=tr.IDENTITY.toString();var ti=e=>class extends e{bbox(e){let t=Vr(this.currentTransform(e)),n=t?t.toString():ei,r;this._bboxCache&&this._matrixHash===n?r=this._bboxCache.clone():(r=this._bbox(t),this._bboxCache=r?r.clone():null,this._matrixHash=n);let i=this.options.get(`stroke.width`);return i&&r&&r.expand(i/2),r}geometryChange(){delete this._bboxCache,this.trigger(`geometryChange`,{element:this})}};function ni(e){let t=`_`+e;return function(e){return e===void 0?this[t]:(this._observerField(t,e),this.geometryChange(),this)}}function ri(e,t){for(let n=0;n<t.length;n++)e[t[n]]=ni(t[n])}var ii=(e,t=[`geometry`])=>{let n=class extends e{};return ri(n.prototype,t),n},ai=class extends $r(ti(ii(Yr))){get nodeType(){return`Circle`}constructor(e=new Qr,t={}){super(t),this.geometry(e),this.options.stroke===void 0&&this.stroke(`#000`)}rawBBox(){return this._geometry.bbox()}_bbox(e){return this._geometry.bbox(e)}_containsPoint(e){return this.geometry().containsPoint(e)}_isOnPath(e){return this.geometry()._isOnPath(e,this.options.stroke.width/2)}};function oi(e,t,n=10){return F(Math.abs(e-t),n)===0}function si(e,t,n){return e<t||oi(e,t,n)}function ci(e,t,n,r){let i=t.x-e.x,a=r.x-n.x,o=t.y-e.y,s=r.y-n.y,c=e.x-n.x,l=e.y-n.y,u=i*s-a*o,d=(i*l-o*c)/u,f=(a*l-s*c)/u;if(d>=0&&d<=1&&f>=0&&f<=1)return new I(e.x+f*i,e.y+f*o)}let li=Math.pow,ui=[`radiusX`,`radiusY`,`startAngle`,`endAngle`,`anticlockwise`];var di=class e extends Sn(gn,ui){constructor(e=new I,t={}){super(),this.setCenter(e),this.radiusX=t.radiusX,this.radiusY=t.radiusY||t.radiusX,this.startAngle=t.startAngle,this.endAngle=t.endAngle,this.anticlockwise=t.anticlockwise||!1,this.xRotation=t.xRotation}clone(){return new e(this.center,{radiusX:this.radiusX,radiusY:this.radiusY,startAngle:this.startAngle,endAngle:this.endAngle,anticlockwise:this.anticlockwise})}setCenter(e){return this._observerField(`center`,I.create(e)),this.geometryChange(),this}getCenter(){return this.center}pointAt(e){let t=this.center,n=Wn(e);return new I(t.x+this.radiusX*Math.cos(n),t.y+this.radiusY*Math.sin(n))}curvePoints(){let e=this.startAngle,t=this.anticlockwise?-1:1,n=[this.pointAt(e)],r=this._arcInterval(),i=r.endAngle-r.startAngle,a=Math.ceil(i/45),o=i/a,s=e,c;this.xRotation&&(c=Wr().rotate(this.xRotation,this.center));for(let e=1;e<=a;e++){let e=s+t*o,r=this._intervalCurvePoints(s,e,c);n.push(r.cp1,r.cp2,r.p2),s=e}return n}bbox(e){let t=this._arcInterval(),n=t.startAngle,r=t.endAngle,i=Xr(this.center,this.radiusX,this.radiusY,e),a=Mn(i.x),o=Mn(i.y),s=this.pointAt(r).transformCopy(e),c=mi(a,n),l=mi(o,n),u=this.pointAt(n).transformCopy(e),d=I.min(u,s),f=I.max(u,s);for(;c<r||l<r;){let t;c<r&&(t=this.pointAt(c).transformCopy(e),c+=90);let n;l<r&&(n=this.pointAt(l).transformCopy(e),l+=90),u=new I(t.x,n.y),d=I.min(d,u),f=I.max(f,u)}return L.fromPoints(d,f)}_arcInterval(){let{startAngle:e,endAngle:t,anticlockwise:n}=this;if(n){let n=e;e=t,t=n}return(e>t||n&&e===t)&&(t+=360),{startAngle:e,endAngle:t}}_intervalCurvePoints(e,t,n){let r=this.pointAt(e),i=this.pointAt(t),a=this._derivativeAt(e),o=this._derivativeAt(t),s=(Wn(t)-Wn(e))/3,c=new I(r.x+s*a.x,r.y+s*a.y),l=new I(i.x-s*o.x,i.y-s*o.y);return n&&(r.transform(n),i.transform(n),c.transform(n),l.transform(n)),{p1:r,cp1:c,cp2:l,p2:i}}_derivativeAt(e){let t=Wn(e);return new I(-this.radiusX*Math.sin(t),this.radiusY*Math.cos(t))}containsPoint(e){let t=this._arcInterval(),n=t.endAngle-t.startAngle,{center:r,radiusX:i,radiusY:a}=this,o=r.distanceTo(e),s=Math.atan2(e.y-r.y,e.x-r.x),c=i*a/Math.sqrt(li(i,2)*li(Math.sin(s),2)+li(a,2)*li(Math.cos(s),2)),l=this.pointAt(this.startAngle).round(10),u=this.pointAt(this.endAngle).round(10),d=ci(r,e.round(10),l,u),f;if(n<180)f=d&&si(r.distanceTo(d),o)&&si(o,c);else{let n=fi(r.x,r.y,i,a,e.x,e.y);n!==360&&(n=(360+n)%360);let s=t.startAngle<=n&&n<=t.endAngle;f=s&&si(o,c)||!s&&(!d||d.equals(e))}return f}_isOnPath(e,t){let n=this._arcInterval(),r=this.center,i=fi(r.x,r.y,this.radiusX,this.radiusY,e.x,e.y);return i!==360&&(i=(360+i)%360),n.startAngle<=i&&i<=n.endAngle&&this.pointAt(i).distanceTo(e)<=t}static fromPoints(t,n,r,i,a,o,s){let c=pi({x1:t.x,y1:t.y,x2:n.x,y2:n.y,rx:r,ry:i,largeArc:a,swipe:o,rotation:s});return new e(c.center,{startAngle:c.startAngle,endAngle:c.endAngle,radiusX:c.radiusX,radiusY:c.radiusY,xRotation:c.xRotation,anticlockwise:o===0})}};function fi(e,t,n,r,i,a){let o=F((i-e)/n,3),s=F((a-t)/r,3);return F(Mn(Math.atan2(s,o)))}function pi(e){let{x1:t,y1:n,x2:r,y2:i,rx:a,ry:o,largeArc:s,swipe:c,rotation:l=0}=e,u=Wn(l),d=Math.cos(u),f=Math.sin(u),p=d*(t-r)/2+f*(n-i)/2,m=-f*(t-r)/2+d*(n-i)/2,h=s===c?-1:1,g=p**2,_=m**2,v=a**2,y=o**2,b=g/v+_/y;b>1&&(b=Math.sqrt(g/v+_/y),a=b*a,v=a**2,o=b*o,y=o**2);let x=h*Math.sqrt((v*y-v*_-y*g)/(v*_+y*g));isNaN(x)&&(x=0);let S=a*m*x/o,C=-x*(o*p)/a,ee=d*S-f*C+(t+r)/2,te=f*S+d*C+(n+i)/2,w=(p-S)/a,T=(m-C)/o,E=-(p+S)/a,ne=-(m+C)/o,re=(T>=0?1:-1)*Mn(Math.acos(w/Math.sqrt(w*w+T*T))),ie=F((w*E+T*ne)/(Math.sqrt(w*w+T*T)*Math.sqrt(E*E+ne*ne)),10),ae=(w*ne-T*E>=0?1:-1)*Mn(Math.acos(ie));!c&&ae>0&&(ae-=360),c&&ae<0&&(ae+=360);let oe=re+ae,se=oe>=0?1:-1;return oe=Math.abs(oe)%360*se,{center:new I(ee,te),startAngle:re,endAngle:oe,radiusX:a,radiusY:o,xRotation:l}}function mi(e,t){let n=e;for(;n<t;)n+=90;return n}var hi=di;let gi=[].splice,_i=[].slice;var vi=class extends gn{constructor(e=[]){super(),this.length=0,this._splice(0,e.length,e)}elements(e){return e?(this._splice(0,this.length,e),this._change(),this):this.slice(0)}push(...e){let t=this.length,n=e.length;for(let r=0;r<n;r++)this[t+r]=e[r],e[r].addObserver(this);return this.length=t+n,this._change(),this.length}slice(){return _i.call(this)}pop(){if(this.length>0){let e=this[this.length-1];return this.length--,e.removeObserver(this),this._change(),e}}splice(e,t,...n){let r=this._splice(e,t,n);return this._change(),r}shift(){if(this.length>0){let e=this[0];for(let e=1;e<this.length;e++)this[e-1]=this[e];return this.length--,e.removeObserver(this),this._change(),e}}unshift(...e){let t=e.length;for(let e=this.length-1;e>=0;e--)this[e+t]=this[e];for(let n=0;n<t;n++)this[n]=e[n],e[n].addObserver(this);return this.length+=t,this._change(),this.length}indexOf(e){let t=this.length;for(let n=0;n<t;n++)if(this[n]===e)return n;return-1}_splice(e,t,n){let r=gi.apply(this,[e,t].concat(n));return this._clearObserver(r),this._setObserver(n),r}_add(e){this._setObserver(e),this._change()}_remove(e){this._clearObserver(e),this._change()}_setObserver(e){for(let t=0;t<e.length;t++)e[t].addObserver(this)}_clearObserver(e){for(let t=0;t<e.length;t++)e[t].removeObserver(this)}_change(){}},yi=class extends vi{_change(){this.geometryChange()}};function bi(e,t,n){let r=Mn(Math.atan2(t.y-e.y,t.x-e.x));return n.transformCopy(Wr().rotate(-r,e)).x<e.x}function xi(e,t,n){let r=1-e;return r**3*n[0][t]+3*r**2*e*n[1][t]+3*e**2*r*n[2][t]+e**3*n[3][t]}function Si(e,t){return[-e[0][t]+3*e[1][t]-3*e[2][t]+e[3][t],3*(e[0][t]-2*e[1][t]+e[2][t]),3*(-e[0][t]+e[1][t]),e[0][t]]}var Ci=class e extends Pt{constructor(e=0,t=0){super(),this.real=e,this.img=t}add(t){return new e(F(this.real+t.real,10),F(this.img+t.img,10))}addConstant(t){return new e(this.real+t,this.img)}negate(){return new e(-this.real,-this.img)}multiply(t){return new e(this.real*t.real-this.img*t.img,this.real*t.img+this.img*t.real)}multiplyConstant(t){return new e(this.real*t,this.img*t)}nthRoot(t){let n=Math.atan2(this.img,this.real),r=Math.sqrt(this.img**2+this.real**2)**(1/t);return new e(r*Math.cos(n/t),r*Math.sin(n/t))}equals(e){return this.real===e.real&&this.img===e.img}isReal(){return this.img===0}};function wi(e){return e<0?-1:1}function Ti(e,t,n){let r=Math.sqrt(t**2-4*e*n);return[(-t+r)/(2*e),(-t-r)/(2*e)]}function Ei(e,t,n,r){if(e===0)return Ti(t,n,r);let i=(3*e*n-t**2)/(3*e**2),a=(2*t**3-9*e*t*n+27*e**2*r)/(27*e**3),o=(i/3)**3+(a/2)**2,s=new Ci(0,1),c=-t/(3*e),l,u,d,f,p,m,h;o<0?(l=new Ci(-a/2,Math.sqrt(-o)).nthRoot(3),u=new Ci(-a/2,-Math.sqrt(-o)).nthRoot(3)):(l=-a/2+Math.sqrt(o),l=new Ci(wi(l)*Math.abs(l)**(1/3)),u=-a/2-Math.sqrt(o),u=new Ci(wi(u)*Math.abs(u)**(1/3))),d=l.add(u),m=l.add(u).multiplyConstant(-1/2),h=l.add(u.negate()).multiplyConstant(Math.sqrt(3)/2),f=m.add(s.multiply(h)),p=m.add(s.negate().multiply(h));let g=[];return d.isReal()&&g.push(F(d.real+c,10)),f.isReal()&&g.push(F(f.real+c,10)),p.isReal()&&g.push(F(p.real+c,10)),g}function Di(e,t,n,r,i){let a=Si(e,r),o=Ei(a[0],a[1],a[2],a[3]-t[r]),s;for(let r=0;r<o.length;r++)if(0<=o[r]&&o[r]<=1&&(s=xi(o[r],n,e),Math.abs(s-t[n])<=i))return!0}function Oi(e,t,n){let r=Si(e,`x`),i=Ei(r[0],r[1],r[2],r[3]-t.x),a,o,s=0;for(let r=0;r<i.length;r++)a=xi(i[r],`y`,e),o=oi(a,t.y)||a>t.y,o&&((i[r]===0||i[r]===1)&&n.bottomRight().x>t.x||0<i[r]&&i[r]<1)&&s++;return s}function ki(e,t,n){let r;if(e.x!==t.x){let i=Math.min(e.x,t.x),a=Math.max(e.x,t.x),o=Math.min(e.y,t.y),s=Math.max(e.y,t.y),c=i<=n.x&&n.x<a;r=o===s?n.y<=o&&c:c&&(s-o)*((e.x-t.x)*(e.y-t.y)>0?n.x-i:a-n.x)/(a-i)+o-n.y>=0}return r?1:0}function Ai(e){let t=`_`+e;return function(e){return e===void 0?this[t]:(this._observerField(t,I.create(e)),this.geometryChange(),this)}}function ji(e,t){for(let n=0;n<t.length;n++)e[t[n]]=Ai(t[n])}var Mi=(e,t)=>{let n=class extends e{};return ji(n.prototype,t),n};let Ni=[`anchor`,`controlIn`,`controlOut`];var Pi=class extends Mi(gn,Ni){constructor(e,t,n){super(),this.anchor(e||new I),this.controlIn(t),this.controlOut(n)}bboxTo(e,t){let n=this.anchor().transformCopy(t),r=e.anchor().transformCopy(t),i;return i=this.controlOut()&&e.controlIn()?this._curveBoundingBox(n,this.controlOut().transformCopy(t),e.controlIn().transformCopy(t),r):this._lineBoundingBox(n,r),i}_lineBoundingBox(e,t){return L.fromPoints(e,t)}_curveBoundingBox(e,t,n,r){let i=[e,t,n,r],a=this._curveExtremesFor(i,`x`),o=this._curveExtremesFor(i,`y`),s=Fi([a.min,a.max,e.x,r.x]),c=Fi([o.min,o.max,e.y,r.y]);return L.fromPoints(new I(s.min,c.min),new I(s.max,c.max))}_curveExtremesFor(e,t){let n=this._curveExtremes(e[0][t],e[1][t],e[2][t],e[3][t]);return{min:xi(n.min,t,e),max:xi(n.max,t,e)}}_curveExtremes(e,t,n,r){let i=e-3*t+3*n-r,a=-2*(e-2*t+n),o=e-t,s=Math.sqrt(a*a-4*i*o),c=0,l=1;i===0?a!==0&&(c=l=-o/a):isNaN(s)||(c=(-a+s)/(2*i),l=(-a-s)/(2*i));let u=Math.max(Math.min(c,l),0);(u<0||u>1)&&(u=0);let d=Math.min(Math.max(c,l),1);return(d>1||d<0)&&(d=1),{min:u,max:d}}_intersectionsTo(e,t){let n;return n=this.controlOut()&&e.controlIn()?Oi([this.anchor(),this.controlOut(),e.controlIn(),e.anchor()],t,this.bboxTo(e)):ki(this.anchor(),e.anchor(),t),n}_isOnCurveTo(e,t,n,r){if(this.bboxTo(e).expand(n,n).containsPoint(t)){let i=this.anchor(),a=this.controlOut(),o=e.controlIn(),s=e.anchor();if(r===`start`&&i.distanceTo(t)<=n)return!bi(i,a,t);if(r===`end`&&s.distanceTo(t)<=n)return!bi(s,o,t);let c=[i,a,o,s];if(Di(c,t,`x`,`y`,n)||Di(c,t,`y`,`x`,n))return!0;let l=Wr().rotate(45,t),u=[i.transformCopy(l),a.transformCopy(l),o.transformCopy(l),s.transformCopy(l)];return Di(u,t,`x`,`y`,n)||Di(u,t,`y`,`x`,n)}}_isOnLineTo(e,t,n){let r=this.anchor(),i=e.anchor(),a=Mn(Math.atan2(i.y-r.y,i.x-r.x));return new L([r.x,r.y-n/2],[r.distanceTo(i),n]).containsPoint(t.transformCopy(Wr().rotate(-a,r)))}_isOnPathTo(e,t,n,r){let i;return i=this.controlOut()&&e.controlIn()?this._isOnCurveTo(e,t,n/2,r):this._isOnLineTo(e,t,n),i}};function Fi(e){let t=e.length,n=An,r=jn;for(let i=0;i<t;i++)r=Math.max(r,e[i]),n=Math.min(n,e[i]);return{min:n,max:r}}var Ii=Pi;let Li=.333;function Ri(e,t){let n=e.slice(0),r=[],i=n.length;if(i>2&&(zi(0,n),i=n.length),i<2||i===2&&n[0].equals(n[1]))return r;let a=n[0],o=n[1],s=n[2];for(r.push(new Ii(a));a.equals(n[i-1]);)t=!0,n.pop(),i--;if(i===2){let e=Gi(a,o,`x`,`y`);return Bn(r).controlOut(qi(e,a,o,`x`,`y`)),r.push(new Ii(o,Ji(e,a,o,`x`,`y`))),r}let c,l;if(t){a=n[i-1],o=n[0],s=n[1];let e=Ui(a,o,s);c=e[1],l=e[0]}else c=qi(Gi(a,o,`x`,`y`),a,o,`x`,`y`);let u=c;for(let e=0;e<=i-3;e++)if(zi(e,n),i=n.length,e+3<=i){a=n[e],o=n[e+1],s=n[e+2];let t=Ui(a,o,s);Bn(r).controlOut(u),u=t[1];let i=t[0];r.push(new Ii(o,i))}if(t){a=n[i-2],o=n[i-1],s=n[0];let e=Ui(a,o,s);Bn(r).controlOut(u),r.push(new Ii(o,e[0])),Bn(r).controlOut(e[1]),r.push(new Ii(s,l))}else{let e=Gi(o,s,`x`,`y`);Bn(r).controlOut(u),r.push(new Ii(s,Ji(e,o,s,`x`,`y`)))}return r}function zi(e,t){for(;t[e+1]&&(t[e].equals(t[e+1])||t[e+1].equals(t[e+2]));)t.splice(e+1,1)}function Bi(e,t,n){let r=!1;if(e.x===t.x)r=!0;else if(t.x===n.x)(t.y<n.y&&e.y<=t.y||n.y<t.y&&t.y<=e.y)&&(r=!0);else{let i=Xi(Hi(e,t),n.x);!(e.y<=t.y&&n.y<=i)&&!(t.y<=e.y&&n.y>=i)&&(r=!0)}return r}function Vi(e,t,n){let r=Xi(Hi(e,t),n.x);return e.x===t.x&&t.x===n.x||F(r,1)===F(n.y,1)}function Hi(e,t){let n=(t.y-e.y)/(t.x-e.x);return[e.y-n*e.x,n]}function Ui(e,t,n){let r=`x`,i=`y`,a=!1,o=!1,s;if(Vi(e,t,n))s=Gi(e,t,`x`,`y`);else{let c={x:Ki(e,t,n,`x`),y:Ki(e,t,n,`y`)};if(c.x&&c.y)s=Gi(e,n,`x`,`y`),a=!0;else if(Bi(e,t,n)&&(r=`y`,i=`x`),c[r])s=0;else{let a;a=n[i]<e[i]&&e[i]<=t[i]||e[i]<n[i]&&t[i]<=e[i]?Zi((n[i]-e[i])*(t[r]-e[r])):-Zi((n[r]-e[r])*(t[i]-e[i])),s=.01*a,o=!0}}let c=Ji(s,e,t,r,i);if(o){let e=r;r=i,i=e}let l=qi(s,t,n,r,i);return a&&(Wi(e,t,c,s),Wi(t,n,l,s)),[c,l]}function Wi(e,t,n,r){e.y<t.y?t.y<n.y?(n.x=e.x+(t.y-e.y)/r,n.y=t.y):n.y<e.y&&(n.x=t.x-(t.y-e.y)/r,n.y=e.y):n.y<t.y?(n.x=e.x-(e.y-t.y)/r,n.y=t.y):e.y<n.y&&(n.x=t.x+(e.y-t.y)/r,n.y=e.y)}function Gi(e,t,n,r){let i=t[n]-e[n],a=t[r]-e[r],o;return o=i===0?0:a/i,o}function Ki(e,t,n,r){return n[r]>t[r]&&t[r]>e[r]||n[r]<t[r]&&t[r]<e[r]}function qi(e,t,n,r,i){let a=t[r],o=(n[r]-a)*Li;return Yi(a+o,t[i]+o*e,r,i)}function Ji(e,t,n,r,i){let a=t[r],o=n[r],s=(o-a)*Li;return Yi(o-s,n[i]-s*e,r,i)}function Yi(e,t,n,r){let i=new I;return i[n]=e,i[r]=t,i}function Xi(e,t){let n=e.length,r=0;for(let i=0;i<n;i++)r+=t**+i*e[i];return r}function Zi(e){return e<=0?-1:1}let Qi={l:function(e,t){let{parameters:n,position:r}=t;for(let i=0;i<n.length;i+=2){let a=new I(n[i],n[i+1]);t.isRelative&&a.translateWith(r),e.lineTo(a.x,a.y),r.x=a.x,r.y=a.y}},c:function(e,t){let{parameters:n,position:r}=t;for(let i=0;i<n.length;i+=6){let a=new I(n[i],n[i+1]),o=new I(n[i+2],n[i+3]),s=new I(n[i+4],n[i+5]);t.isRelative&&(o.translateWith(r),a.translateWith(r),s.translateWith(r)),e.curveTo(a,o,s),r.x=s.x,r.y=s.y}},v:function(e,t){let n=t.isRelative?0:t.position.x;$i(t.parameters,!0,n),this.l(e,t)},h:function(e,t){let n=t.isRelative?0:t.position.y;$i(t.parameters,!1,n),this.l(e,t)},a:function(e,t){let{parameters:n,position:r}=t;for(let i=0;i<n.length;i+=7){let a=n[i],o=n[i+1],s=n[i+2],c=n[i+3],l=n[i+4],u=new I(n[i+5],n[i+6]);t.isRelative&&u.translateWith(r),(r.x!==u.x||r.y!==u.y)&&(e.arcTo(u,a,o,c,l,s),r.x=u.x,r.y=u.y)}},s:function(e,t){let{parameters:n,position:r,previousCommand:i}=t,a;(i===`s`||i===`c`)&&(a=Bn(Bn(e.paths).segments).controlIn());for(let i=0;i<n.length;i+=4){let o=new I(n[i],n[i+1]),s=new I(n[i+2],n[i+3]),c;t.isRelative&&(o.translateWith(r),s.translateWith(r)),c=a?ea(a,r):r.clone(),a=o,e.curveTo(c,o,s),r.x=s.x,r.y=s.y}},q:function(e,t){let{parameters:n,position:r}=t;for(let i=0;i<n.length;i+=4){let a=new I(n[i],n[i+1]),o=new I(n[i+2],n[i+3]);t.isRelative&&(a.translateWith(r),o.translateWith(r));let s=na(r,a,o);e.curveTo(s.controlOut,s.controlIn,o),r.x=o.x,r.y=o.y}},t:function(e,t){let{parameters:n,position:r,previousCommand:i}=t,a;(i===`q`||i===`t`)&&(a=Bn(Bn(e.paths).segments).controlIn().clone().translateWith(r.scaleCopy(-1/3)).scale(3/2));for(let i=0;i<n.length;i+=2){let o=new I(n[i],n[i+1]);t.isRelative&&o.translateWith(r),a=a?ea(a,r):r.clone();let s=na(r,a,o);e.curveTo(s.controlOut,s.controlIn,o),r.x=o.x,r.y=o.y}}};function $i(e,t,n){let r=t?0:1;for(let t=0;t<e.length;t+=2)e.splice(t+r,0,n)}function ea(e,t){if(e&&t)return t.scaleCopy(2).translate(-e.x,-e.y)}let ta=1/3;function na(e,t,n){let r=t.clone().scale(2/3);return{controlOut:r.clone().translateWith(e.scaleCopy(ta)),controlIn:r.translateWith(n.scaleCopy(ta))}}var ra=Qi;let ia=/([a-df-z]{1})([^a-df-z]*)(z)?/gi,aa=/[,\s]?([+\-]?(?:\d*\.\d+|\d+)(?:[eE][+\-]?\d+)?)/g;function oa(e){let t=[];return e.replace(aa,function(e,n){t.push(parseFloat(n))}),t}function sa(e,t){let n=new I,r;return t.replace(ia,(t,i,a,o)=>{let s=i.toLowerCase(),c=s===i,l=oa(a.trim());if(s===`m`&&(c?(n.x+=l[0],n.y+=l[1]):(n.x=l[0],n.y=l[1]),e.moveTo(n.x,n.y),l.length>2&&(s=`l`,l.splice(0,2))),ra[s])ra[s](e,{parameters:l,position:n,isRelative:c,previousCommand:r}),o&&o.toLowerCase()===`z`&&e.close();else if(s!==`m`)throw Error(`Error while parsing SVG path. Unsupported command: `+s);r=s}),e}var ca=sa;function la(e,t,n){let r;for(let i=0;i<e.length;i++){let a=e[i];if(a.visible()){let e=t?a.bbox(n):a.rawBBox();e&&(r=r?L.union(r,e):e)}}return r}function ua(e,t){let n;for(let r=0;r<e.length;r++){let i=e[r];if(i.visible()){let e=i.clippedBBox(t);e&&(n=n?L.union(n,e):e)}}return n}let da=e=>(...t)=>t.map(t=>t.toString(e)).join(` `),fa=(e,t)=>e.controlOut()&&t.controlIn()?`C`:`L`;var R=class e extends $r(ti(Yr)){get nodeType(){return`Path`}constructor(e){super(e),this.segments=new yi,this.segments.addObserver(this),this.options.stroke===void 0&&(this.stroke(`#000`),this.options.stroke.lineJoin===void 0&&this.options.set(`stroke.lineJoin`,`miter`))}moveTo(e,t){return this.suspend(),this.segments.elements([]),this.resume(),this.lineTo(e,t),this}lineTo(e,t){let n=new Ii(t===void 0?e:new I(e,t));return this.segments.push(n),this}curveTo(e,t,n){if(this.segments.length>0){let r=Bn(this.segments),i=new Ii(n,t);this.suspend(),r.controlOut(e),this.resume(),this.segments.push(i)}return this}arc(e,t,n,r,i){if(this.segments.length>0){let a=Bn(this.segments).anchor(),o=Wn(e),s=new hi(new I(a.x-n*Math.cos(o),a.y-r*Math.sin(o)),{startAngle:e,endAngle:t,radiusX:n,radiusY:r,anticlockwise:i});this._addArcSegments(s)}return this}arcTo(e,t,n,r,i,a){if(this.segments.length>0){let o=Bn(this.segments).anchor(),s=hi.fromPoints(o,I.create(e),t,n,r,i,a);this._addArcSegments(s)}return this}_addArcSegments(e){this.suspend();let t=e.curvePoints();for(let e=1;e<t.length;e+=3)this.curveTo(t[e],t[e+1],t[e+2]);this.resume(),this.geometryChange()}close(){return this.options.closed=!0,this.geometryChange(),this}rawBBox(){return this._bbox()}toString(e){let t=``,n=this.segments,r=n.length;if(r>0){let i=[],a=da(e),o;for(let e=1;e<r;e++){let t=fa(n[e-1],n[e]);t!==o&&(o=t,i.push(t)),t===`L`?i.push(a(n[e].anchor())):i.push(a(n[e-1].controlOut(),n[e].controlIn(),n[e].anchor()))}t=`M`+a(n[0].anchor())+` `+i.join(` `),this.options.closed&&(t+=`Z`)}return t}_containsPoint(e){let t=this.segments,n=t.length,r=0,i,a;for(let o=1;o<n;o++)i=t[o-1],a=t[o],r+=i._intersectionsTo(a,e);return(this.options.closed||!t[0].anchor().equals(t[n-1].anchor()))&&(r+=ki(t[0].anchor(),t[n-1].anchor(),e)),r%2!=0}_isOnPath(e,t){let n=this.segments,r=n.length,i=t||this.options.stroke.width;if(r>1){if(n[0]._isOnPathTo(n[1],e,i,`start`))return!0;for(let t=2;t<=r-2;t++)if(n[t-1]._isOnPathTo(n[t],e,i))return!0;if(n[r-2]._isOnPathTo(n[r-1],e,i,`end`))return!0}return!1}_bbox(e){let t=this.segments,n=t.length,r;if(n===1)r=new L(t[0].anchor().transformCopy(e),Hr.ZERO);else if(n>0)for(let i=1;i<n;i++){let n=t[i-1].bboxTo(t[i],e);r=r?L.union(r,n):n}return r}static parse(e,t){return pa.parse(e,t)}static fromRect(t,n){let r=new e(n),[i,a]=t.cornerRadius;if(i===0&&a===0)r.moveTo(t.topLeft()).lineTo(t.topRight()).lineTo(t.bottomRight()).lineTo(t.bottomLeft()).close();else{let{x:e,y:n}=t.origin,o=t.width(),s=t.height();i=Vn(i,0,o/2),a=Vn(a,0,s/2),r.moveTo(e+i,n).lineTo(e+o-i,n).arcTo([e+o,n+a],i,a,!1).lineTo(e+o,n+s-a).arcTo([e+o-i,n+s],i,a,!1).lineTo(e+i,n+s).arcTo([e,n+s-a],i,a,!1).lineTo(e,n+a).arcTo([e+i,n],i,a,!1)}return r}static fromPoints(t,n){if(t){let r=new e(n);for(let e=0;e<t.length;e++){let n=I.create(t[e]);n&&(e===0?r.moveTo(n):r.lineTo(n))}return r}}static curveFromPoints(t,n){if(t){let r=Ri(t),i=new e(n);return i.segments.push.apply(i.segments,r),i}}static fromArc(t,n){let r=new e(n),i=t.startAngle,a=t.pointAt(i);return r.moveTo(a.x,a.y),r.arc(i,t.endAngle,t.radiusX,t.radiusY,t.anticlockwise),r}},pa=class e extends $r(ti(Yr)){static parse(t,n){return ca(new e(n),t)}toString(e){let t=this.paths,n=``;if(t.length>0){let r=[];for(let n=0;n<t.length;n++)r.push(t[n].toString(e));n=r.join(` `)}return n}get nodeType(){return`MultiPath`}constructor(e){super(e),this.paths=new yi,this.paths.addObserver(this),this.options.stroke===void 0&&this.stroke(`#000`)}moveTo(e,t){let n=new R;return n.moveTo(e,t),this.paths.push(n),this}lineTo(e,t){return this.paths.length>0&&Bn(this.paths).lineTo(e,t),this}curveTo(e,t,n){return this.paths.length>0&&Bn(this.paths).curveTo(e,t,n),this}arc(e,t,n,r,i){return this.paths.length>0&&Bn(this.paths).arc(e,t,n,r,i),this}arcTo(e,t,n,r,i,a){return this.paths.length>0&&Bn(this.paths).arcTo(e,t,n,r,i,a),this}close(){return this.paths.length>0&&Bn(this.paths).close(),this}_bbox(e){return la(this.paths,!0,e)}rawBBox(){return la(this.paths,!1)}_containsPoint(e){let t=this.paths;for(let n=0;n<t.length;n++)if(t[n]._containsPoint(e))return!0;return!1}_isOnPath(e){let t=this.paths,n=this.options.stroke.width;for(let r=0;r<t.length;r++)if(t[r]._isOnPath(e,n))return!0;return!1}_clippedBBox(e){return ua(this.paths,this.currentTransform(e))}};ii(Yr);var ma=class extends $r(Mi(Yr,[`position`])){get nodeType(){return`Text`}constructor(e,t=new I,n={}){super(n),this.content(e),this.position(t),this.options.font||(this.options.font=`12px sans-serif`),this.options.fill===void 0&&this.fill(`#000`)}content(e){return e===void 0?this.options.get(`content`):(this.options.set(`content`,e),this)}measure(){return gr(this.content(),{font:this.options.get(`font`)})}rect(){let e=this.measure();return new L(this.position().clone(),[e.width,e.height])}bbox(e){let t=Vr(this.currentTransform(e));return this.rect().bbox(t)}rawBBox(){return this.rect().bbox()}_containsPoint(e){return this.rect().containsPoint(e)}},ha=class extends ii(Yr,[`rect`]){get nodeType(){return`Image`}constructor(e,t=new L,n={}){super(n),this.src(e),this.rect(t)}src(e){return e===void 0?this.options.get(`src`):(this.options.set(`src`,e),this)}bbox(e){let t=Vr(this.currentTransform(e));return this._rect.bbox(t)}rawBBox(){return this._rect.bbox()}_containsPoint(e){return this._rect.containsPoint(e)}_hasFill(){return this.src()}},ga=(e,t)=>class extends e{traverse(e){let n=this[t];for(let t=0;t<n.length;t++){let r=n[t];r.traverse?r.traverse(e):e(r)}return this}},z=class extends ga(Yr,`children`){get nodeType(){return`Group`}constructor(e){super(e),this.children=[]}childrenChange(e,t,n){this.trigger(`childrenChange`,{action:e,items:t,index:n})}append(){return Cn(this.children,arguments),this._reparent(arguments,this),this.childrenChange(`add`,arguments),this}insert(e,t){return this.children.splice(e,0,t),t.parent=this,this.childrenChange(`add`,[t],e),this}insertAt(e,t){return this.insert(t,e)}remove(e){let t=this.children.indexOf(e);return t>=0&&(this.children.splice(t,1),e.parent=null,this.childrenChange(`remove`,[e],t)),this}removeAt(e){if(0<=e&&e<this.children.length){let t=this.children[e];this.children.splice(e,1),t.parent=null,this.childrenChange(`remove`,[t],e)}return this}clear(){let e=this.children;return this.children=[],this._reparent(e,null),this.childrenChange(`remove`,e,0),this}bbox(e){return la(this.children,!0,this.currentTransform(e))}rawBBox(){return la(this.children,!1)}_clippedBBox(e){return ua(this.children,this.currentTransform(e))}currentTransform(e){return Yr.prototype.currentTransform.call(this,e)||null}containsPoint(e,t){if(this.visible()){let n=this.children,r=this.currentTransform(t);for(let t=0;t<n.length;t++)if(n[t].containsPoint(e,r))return!0}return!1}_reparent(e,t){for(let n=0;n<e.length;n++){let r=e[n],i=r.parent;i&&i!==this&&i.remove&&i.remove(r),r.parent=t}}};function _a(e,t,n){let r=n.transform()||Wr(),i=r.matrix();i.e+=e.x-t.origin.x,i.f+=e.y-t.origin.y,r.matrix(i),n.transform(r)}function va(e,t,n,r,i){let a;return a=n===`start`?t.origin[r]:n===`end`?t.origin[r]+t.size[i]-e:t.origin[r]+(t.size[i]-e)/2,a}function ya(e,t,n,r,i){let a;return a=n===`start`?t.origin[r]+t.size[i]-e:n===`end`?t.origin[r]:t.origin[r]+(t.size[i]-e)/2,a}let ba={alignContent:`start`,justifyContent:`start`,alignItems:`start`,spacing:0,orientation:`horizontal`,lineSpacing:0,wrap:!0,revers:!1},xa=(e,t)=>{e.forEach(t)},Sa=(e,t)=>{let n=e.length;for(let r=n-1;r>=0;r--)t(e[r],r)};var Ca=class extends z{constructor(e,t){super(Object.assign({},ba,t)),this._rect=e,this._fieldMap={}}rect(e){return e?(this._rect=e,this):this._rect}appendBreak(){let e=new z;return e._isBreakMarker=!0,this.append(e),this}_initMap(){let e=this.options,t=this._fieldMap;e.orientation===`horizontal`?(t.sizeField=`width`,t.groupsSizeField=`height`,t.groupAxis=`x`,t.groupsAxis=`y`):(t.sizeField=`height`,t.groupsSizeField=`width`,t.groupAxis=`y`,t.groupsAxis=`x`),e.reverse?(this.forEach=Sa,this.justifyAlign=ya):(this.forEach=xa,this.justifyAlign=va)}reflow(){if(!this._rect||this.children.length===0)return;this._initMap(),this.options.transform&&this.transform(null);let e=this.options,t=this._rect,{groups:n,groupsSize:r}=this._initGroups(),{sizeField:i,groupsSizeField:a,groupAxis:o,groupsAxis:s}=this._fieldMap,c=new I,l=new I,u=new Hr,d=va(r,t,e.alignContent,s,a),f,p,m,h=(t,n)=>{let r=p.elements[n];l[o]=f,l[s]=va(t.size[a],m,e.alignItems,s,a),_a(l,t,r),f+=t.size[i]+e.spacing};for(let r=0;r<n.length;r++)p=n[r],c[o]=f=this.justifyAlign(p.size,t,e.justifyContent,o,i),c[s]=d,u[i]=p.size,u[a]=p.lineSize,m=new L(c,u),this.forEach(p.bboxes,h),d+=p.lineSize+e.lineSpacing;if(!e.wrap&&p.size>t.size[i]){let n=t.size[i]/m.size[i],r=m.topLeft().scale(n,n),c=va(m.size[a]*n,t,e.alignContent,s,a),l=Wr();o===`x`?l.translate(t.origin.x-r.x,c-r.y):l.translate(c-r.x,t.origin.y-r.y),l.scale(n,n),this.transform(l)}}_initGroups(){let{options:e,children:t}=this,{lineSpacing:n,wrap:r,spacing:i}=e,a=this._fieldMap.sizeField,o=this._newGroup(),s=[],c=function(){s.push(o),l+=o.lineSize+n},l=-n;for(let e=0;e<t.length;e++){let n=t[e],s=t[e].clippedBBox();if(n._isBreakMarker){o.bboxes.length>0&&(c(),o=this._newGroup());continue}n.visible()&&s&&(r&&o.size+s.size[a]+i>this._rect.size[a]?o.bboxes.length===0?(this._addToGroup(o,s,n),c(),o=this._newGroup()):(c(),o=this._newGroup(),this._addToGroup(o,s,n)):this._addToGroup(o,s,n))}return o.bboxes.length&&c(),{groups:s,groupsSize:l}}_addToGroup(e,t,n){e.size+=t.size[this._fieldMap.sizeField]+this.options.spacing,e.lineSize=Math.max(t.size[this._fieldMap.groupsSizeField],e.lineSize),e.bboxes.push(t),e.elements.push(n)}_newGroup(){return{lineSize:0,size:-this.options.spacing,bboxes:[],elements:[]}}},wa=class extends $r(ti(ii(Yr))){get nodeType(){return`Rect`}constructor(e=new L,t={}){super(t),this.geometry(e),this.options.stroke===void 0&&this.stroke(`#000`)}_bbox(e){return this._geometry.bbox(e)}rawBBox(){return this._geometry.bbox()}_containsPoint(e){return this._geometry.containsPoint(e)}_isOnPath(e){return this.geometry()._isOnPath(e,this.options.stroke.width/2)}},Ta=class extends vi{_change(){this.optionsChange({field:`stops`})}};function Ea(e){return function(t){return t===void 0?this.options.get(e):(this.options.set(e,t),this)}}function Da(e,t){for(let n=0;n<t.length;n++)e[t[n]]=Ea(t[n])}var Oa=(e,t)=>{let n=class extends e{};return Da(n.prototype,t),n};let ka=[`offset`,`color`,`opacity`];var Aa=class e extends Oa(gn,ka){constructor(e,t,n){super(),this.options=new vn({offset:e,color:t,opacity:n===void 0?1:n}),this.options.addObserver(this)}static create(t){if(t!==void 0){let n;return n=t instanceof e?t:t.length>1?new e(t[0],t[1],t[2]):new e(t.offset,t.color,t.opacity),n}}},ja=class extends gn{get nodeType(){return`Gradient`}constructor(e={}){super(),this.stops=new Ta(this._createStops(e.stops)),this.stops.addObserver(this),this._userSpace=e.userSpace,this.id=On()}userSpace(e){return e===void 0?this._userSpace:(this._userSpace=e,this.optionsChange(),this)}_createStops(e=[]){let t=[];for(let n=0;n<e.length;n++)t.push(Aa.create(e[n]));return t}addStop(e,t,n){this.stops.push(new Aa(e,t,n))}removeStop(e){let t=this.stops.indexOf(e);t>=0&&this.stops.splice(t,1)}optionsChange(e){this.trigger(`optionsChange`,{field:`gradient`+(e?`.`+e.field:``),value:this})}geometryChange(){this.optionsChange()}};let Ma=[`start`,`end`];var Na=class extends Mi(ja,Ma){constructor(e={}){super(e),this.start(e.start||new I),this.end(e.end||new I(1,0))}},Pa=class extends Mi(ja,[`center`]){constructor(e={}){super(e),this.center(e.center||new I),this._radius=e.radius===void 0?1:e.radius,this._fallbackFill=e.fallbackFill}radius(e){return e===void 0?this._radius:(this._radius=e,this.geometryChange(),this)}fallbackFill(e){return e===void 0?this._fallbackFill:(this._fallbackFill=e,this.optionsChange(),this)}},Fa=class extends z{get nodeType(){return Jr}constructor(e){super();let{width:t,height:n}=e;this._size=Hr.create([t,n]),this.id=On()}size(e){return e?(this._size=Hr.create(e),this):this._size}},Ia=class extends Pt{constructor(e){super(),this.childNodes=[],this.parent=null,e&&(this.srcElement=e,this.observe())}destroy(){this.srcElement&&this.srcElement.removeObserver(this);let e=this.childNodes;for(let t=0;t<e.length;t++)this.childNodes[t].destroy();this.parent=null}load(){}observe(){this.srcElement&&this.srcElement.addObserver(this)}append(e){this.childNodes.push(e),e.parent=this}insertAt(e,t){this.childNodes.splice(t,0,e),e.parent=this}remove(e,t){let n=e+t;for(let t=e;t<n;t++)this.childNodes[t].removeSelf();this.childNodes.splice(e,t)}removeSelf(){this.clear(),this.destroy()}clear(){this.remove(0,this.childNodes.length)}invalidate(){this.parent&&this.parent.invalidate()}geometryChange(){this.invalidate()}optionsChange(){this.invalidate()}childrenChange(e){e.action===`add`?this.load(e.items,e.index):e.action===`remove`&&this.remove(e.index,e.items.length),this.invalidate()}};let La=[`click`,`mouseenter`,`mouseleave`,`mousemove`,`resize`];var Ra=class extends Bt{constructor(e,t){super(),this.options=Object.assign({},t),this.element=e,this.element._kendoExportVisual=this.exportVisual.bind(this),this._click=this._handler(`click`),this._mouseenter=this._handler(`mouseenter`),this._mouseleave=this._handler(`mouseleave`),this._mousemove=this._handler(`mousemove`),this._visual=new z,Zn(e,this.options),this.bind(La,this.options),this._enableTracking()}draw(e){this._visual.children.push(e)}clear(){this._visual.children=[]}destroy(){this._visual=null,this.element._kendoExportVisual=null,this.unbind()}eventTarget(e){let t=Rn(e),n;for(;!n&&t&&(n=t._kendoNode,t!==this.element);)t=t.parentElement;if(n)return n.srcElement}exportVisual(){return this._visual}getSize(){return Zn(this.element)}currentSize(e){if(e)this._size=e;else return this._size}setSize(e){Zn(this.element,e),this.currentSize(e),this._resize()}resize(e){let t=this.getSize(),n=this.currentSize();(e||(t.width>0||t.height>0)&&(!n||t.width!==n.width||t.height!==n.height))&&(this.currentSize(t),this._resize(t,e),this.trigger(`resize`,t))}size(e){if(!e)return this.getSize();this.setSize(e)}suspendTracking(){this._suspendedTracking=!0}resumeTracking(){this._suspendedTracking=!1}_enableTracking(){}_resize(){}_handler(e){return t=>{let n=this.eventTarget(t);n&&!this._suspendedTracking&&this.trigger(e,{element:n,originalEvent:t,type:e})}}_elementOffset(){let e=this.element,t=$n(e),{left:n,top:r}=Jn(e);return{left:n+t.left,top:r+t.top}}_surfacePoint(e){let t=this._elementOffset(),n=Ln(e),r=n.x-t.left,i=n.y-t.top,a=ar(this.element).invert();return new I(r,i).transform(a)}};function za(e,t){return t==null?``:` ${e}="${t}" `}function Ba(e){let t=``;for(let n=0;n<e.length;n++)t+=za(e[n][0],e[n][1]);return t}function Va(e){let t=``;for(let n=0;n<e.length;n++){let r=e[n][1];r!==void 0&&(t+=e[n][0]+`:`+r+`;`)}if(t!==``)return t}var Ha={};let Ua=`http://www.w3.org/2000/svg`,Wa=`none`,Ga=(e,t)=>{Br(e,t)},Ka=(e,t)=>{let n=new DOMParser().parseFromString(Rr(t),`text/xml`);zr(n);let r=document.adoptNode(n.documentElement);e.innerHTML=``,e.appendChild(r)},qa;var Ja=(e,t)=>{if(qa)return qa(e,t);if(qa=Ga,typeof document<`u`){``+Ua;let e=document.createElement(`div`),t=typeof DOMParser<`u`;e.innerHTML=`<svg xmlns='http://www.w3.org/2000/svg'></svg>`,t&&e.firstChild.namespaceURI!==Ua&&(qa=Ka)}return qa(e,t)};let Ya=`transform`,Xa={clip:`clip-path`,fill:`fill`};function Za(e,t){return e===`clip`||e===`fill`&&(!t||t.nodeType===`Gradient`||t.nodeType===Jr)}var Qa=class extends Ia{constructor(e,t){super(e),this.definitions={},this.options=t}destroy(){this.element&&=(this.element._kendoNode=null,null),this.clearDefinitions(),super.destroy()}load(e,t){for(let n=0;n<e.length;n++){let r=e[n],i=r.children,a=new Ha[r.nodeType](r,this.options);t===void 0?this.append(a):this.insertAt(a,t),a.createDefinitions(),i&&i.length>0&&a.load(i);let o=this.element;o&&a.attachTo(o,t)}}root(){let e=this;for(;e.parent;)e=e.parent;return e}attachTo(e,t){let n=document.createElement(`div`);Ja(n,`<svg xmlns='`+Ua+`' version='1.1'>`+this.render()+`</svg>`);let r=n.firstChild.firstChild;r&&(t===void 0?e.appendChild(r):e.insertBefore(r,e.childNodes[t]||null),this.setElement(r))}setElement(e){this.element&&(this.element._kendoNode=null),this.element=e,this.element._kendoNode=this;let t=this.childNodes;for(let n=0;n<t.length;n++){let r=e.childNodes[n];t[n].setElement(r)}}clear(){this.clearDefinitions(),this.element&&(this.element.innerHTML=``);let e=this.childNodes;for(let t=0;t<e.length;t++)e[t].destroy();this.childNodes=[]}removeSelf(){if(this.element){let e=this.element.parentNode;e&&e.removeChild(this.element),this.element=null}super.removeSelf()}template(){return this.renderChildren()}render(){return this.template()}renderChildren(){let e=this.childNodes,t=``;for(let n=0;n<e.length;n++)t+=e[n].render();return t}optionsChange(e){let{field:t,value:n}=e;t===`visible`?this.css(`display`,n?``:Wa):Xa[t]&&Za(t,n)?this.updateDefinition(t,n):t===`opacity`?this.attr(`opacity`,n):t===`cursor`?this.css(`cursor`,n):t===`id`&&(n?this.attr(`id`,n):this.removeAttr(`id`)),super.optionsChange(e)}accessibilityOptionsChange(e){let{field:t,value:n}=e;t===`role`?n?this.attr(`role`,n):this.removeAttr(`role`):t===`ariaLabel`?n?this.attr(`aria-label`,Jt(n)):this.removeAttr(`aria-label`):t===`ariaRoleDescription`?n?this.attr(`aria-roledescription`,Jt(n)):this.removeAttr(`aria-roledescription`):t===`ariaChecked`?n===void 0?this.removeAttr(`aria-checked`):this.attr(`aria-checked`,n):t===`className`&&this.className(n)}attr(e,t){this.element&&this.element.setAttribute(e,t)}allAttr(e){for(let t=0;t<e.length;t++)this.attr(e[t][0],e[t][1])}toggleAttr(e,t){t?this.attr(e,t):this.removeAttr(e)}css(e,t){this.element&&(this.element.style[e]=t)}allCss(e){for(let t=0;t<e.length;t++)this.css(e[t][0],e[t][1])}className(e){this.element&&(this.element.classList.remove(...this.element.classList),e&&e.split(` `).forEach(e=>{e&&this.element.classList.add(e)}))}removeAttr(e){this.element&&this.element.removeAttribute(e)}mapTransform(e){let t=[];return e&&t.push([Ya,`matrix(`+e.matrix().toString(6)+`)`]),t}renderTransform(){return Ba(this.mapTransform(this.srcElement.transform()))}transformChange(e){e?this.allAttr(this.mapTransform(e)):this.removeAttr(Ya)}mapStyle(){let e=this.srcElement.options,t=[[`cursor`,e.cursor]];return e.visible===!1&&t.push([`display`,Wa]),t}renderStyle(){return za(`style`,Va(this.mapStyle(!0)))}renderOpacity(){return za(`opacity`,this.srcElement.options.opacity)}renderId(){return za(`id`,this.srcElement.options.id)}renderClassName(){return za(`class`,this.srcElement.options.className)}renderRole(){return za(`role`,this.srcElement.options.role)}renderAriaLabel(){let e=this.srcElement.options.ariaLabel;return e&&=Jt(e),za(`aria-label`,e)}renderAriaRoleDescription(){let e=this.srcElement.options.ariaRoleDescription;return e&&=Jt(e),za(`aria-roledescription`,e)}renderAriaChecked(){return za(`aria-checked`,this.srcElement.options.ariaChecked)}createDefinitions(){let e=this.srcElement,t=this.definitions;if(e){let n=e.options,r;for(let e in Xa){let i=n.get(e);i&&Za(e,i)&&(t[e]=i,r=!0)}r&&this.definitionChange({action:`add`,definitions:t})}}definitionChange(e){this.parent&&this.parent.definitionChange(e)}updateDefinition(e,t){let n=this.definitions,r=n[e],i=Xa[e],a={};r&&(a[e]=r,this.definitionChange({action:`remove`,definitions:a}),delete n[e]),t?(a[e]=t,this.definitionChange({action:`add`,definitions:a}),n[e]=t,this.attr(i,this.refUrl(t.id))):r&&this.removeAttr(i)}clearDefinitions(){let e=this.definitions;this.definitionChange({action:`remove`,definitions:e}),this.definitions={}}renderDefinitions(){return Ba(this.mapDefinitions())}mapDefinitions(){let e=this.definitions,t=[];for(let n in e){let r=e[n];t.push([Xa[n],this.refUrl(r.id)])}return t}refUrl(e){return`url(#${e})`}},$a=class extends Qa{template(){return`<stop ${this.renderOffset()} ${this.renderStyle()} />`}renderOffset(){return za(`offset`,this.srcElement.offset())}mapStyle(){let e=this.srcElement;return[[`stop-color`,e.color()],[`stop-opacity`,e.opacity()]]}optionsChange(e){e.field===`offset`?this.attr(e.field,e.value):(e.field===`color`||e.field===`opacity`)&&this.css(`stop-`+e.field,e.value)}},eo=class extends Qa{constructor(e){super(e),this.id=e.id,this.loadStops()}loadStops(){let e=this.srcElement.stops,t=this.element;for(let n=0;n<e.length;n++){let r=new $a(e[n]);this.append(r),t&&r.attachTo(t)}}optionsChange(e){e.field===`gradient.stops`?(Ia.prototype.clear.call(this),this.loadStops()):e.field===`gradient`&&this.allAttr(this.mapCoordinates())}renderCoordinates(){return Ba(this.mapCoordinates())}mapSpace(){return[`gradientUnits`,this.srcElement.userSpace()?`userSpaceOnUse`:`objectBoundingBox`]}},to=class extends eo{template(){return`<linearGradient id='${this.id}' ${this.renderCoordinates()}>${this.renderChildren()}</linearGradient>`}mapCoordinates(){let e=this.srcElement,t=e.start(),n=e.end();return[[`x1`,t.x],[`y1`,t.y],[`x2`,n.x],[`y2`,n.y],this.mapSpace()]}},no=class extends eo{template(){return`<radialGradient id='${this.id}' ${this.renderCoordinates()}>${this.renderChildren()}</radialGradient>`}mapCoordinates(){let e=this.srcElement,t=e.center(),n=e.radius();return[[`cx`,t.x],[`cy`,t.y],[`r`,n],this.mapSpace()]}},ro=class extends Qa{constructor(e){super(e),this.id=e.id,this.load(e.children)}template(){let e=this.srcElement.size().getWidth(),t=this.srcElement.size().getHeight();return`<pattern id='${this.srcElement.id}' width='${e}' height='${t}' patternUnits='userSpaceOnUse'>${this.renderChildren()}</pattern>`}},io=class extends Qa{constructor(e){super(),this.srcElement=e,this.id=e.id,this.load([e])}renderClipRule(){return za(`clip-rule`,`evenodd`)}template(){return`<clipPath ${this.renderClipRule()} id='${this.id}'>${this.renderChildren()}</clipPath>`}},ao=class extends Qa{constructor(){super(),this.definitionMap={}}attachTo(e){this.element=e}template(){return`<defs>${this.renderChildren()}</defs>`}definitionChange(e){let{definitions:t,action:n}=e;n===`add`?this.addDefinitions(t):n===`remove`&&this.removeDefinitions(t)}createDefinition(e,t){let n;return e===`clip`?n=io:e===`fill`&&(t instanceof Na?n=to:t instanceof Pa?n=no:t.nodeType===Jr&&(n=ro)),new n(t)}addDefinitions(e){for(let t in e)this.addDefinition(t,e[t])}addDefinition(e,t){let{element:n,definitionMap:r}=this,i=t.id,a=r[i];if(a)a.count++;else{let a=this.createDefinition(e,t);r[i]={element:a,count:1},this.append(a),n&&a.attachTo(this.element)}}removeDefinitions(e){for(let t in e)this.removeDefinition(e[t])}removeDefinition(e){let t=this.definitionMap,n=e.id,r=t[n];r&&(r.count--,r.count===0&&(this.remove(this.childNodes.indexOf(r.element),1),delete t[n]))}},oo=class extends Qa{constructor(e){super(),this.options=e,this.defs=new ao}attachTo(e){this.element=e,this.defs.attachTo(e.firstElementChild)}clear(){Ia.prototype.clear.call(this)}template(){return this.defs.render()+this.renderChildren()}definitionChange(e){this.defs.definitionChange(e)}};let so={"fill.opacity":`fill-opacity`,"stroke.color":`stroke`,"stroke.width":`stroke-width`,"stroke.opacity":`stroke-opacity`};var co=class extends Qa{geometryChange(){this.attr(`d`,this.renderData()),this.invalidate()}optionsChange(e){switch(e.field){case`fill`:e.value?this.allAttr(this.mapFill(e.value)):this.removeAttr(`fill`);break;case`fill.color`:this.allAttr(this.mapFill({color:e.value}));break;case`stroke`:e.value?this.allAttr(this.mapStroke(e.value)):this.removeAttr(`stroke`);break;case`transform`:this.transformChange(e.value);break;default:{let t=so[e.field];t&&this.attr(t,e.value);break}}this.accessibilityOptionsChange(e),super.optionsChange(e)}content(){this.element&&(this.element.textContent=this.srcElement.content())}renderData(){return this.srcElement.toString(3)||void 0}mapStroke(e){let t=[];return e&&!zn(e.color)?(t.push([`stroke`,e.color]),t.push([`stroke-width`,e.width]),t.push([`stroke-linecap`,this.renderLinecap(e)]),t.push([`stroke-linejoin`,e.lineJoin]),e.opacity!==void 0&&t.push([`stroke-opacity`,e.opacity]),e.dashType!==void 0&&t.push([`stroke-dasharray`,this.renderDashType(e)])):t.push([`stroke`,Wa]),t}renderStroke(){return Ba(this.mapStroke(this.srcElement.options.stroke))}renderDashType(e){let{dashType:t,width:n=1}=e;if(t&&t!==Kr){let e=Gr[t.toLowerCase()],r=[];for(let t=0;t<e.length;t++)r.push(e[t]*n);return r.join(` `)}}renderLinecap(e){let{dashType:t,lineCap:n}=e;return t&&t!==Kr?qr:n}mapFill(e){let t=[];return e&&(e.nodeType===`Gradient`||e.nodeType===Jr)||(e&&!zn(e.color)?(t.push([`fill`,e.color]),e.opacity!==void 0&&t.push([`fill-opacity`,e.opacity])):t.push([`fill`,Wa])),t}renderFill(){return Ba(this.mapFill(this.srcElement.options.fill))}template(){return`<path ${this.renderId()} ${this.renderStyle()} ${this.renderOpacity()} ${za(`d`,this.renderData())}${this.renderStroke()}${this.renderFill()}${this.renderDefinitions()}${this.renderTransform()}${this.renderClassName()} ${this.renderRole()}${this.renderAriaLabel()} ${this.renderAriaRoleDescription()}${this.renderAriaChecked()} ></path>`}},lo=class extends co{renderData(){return this.srcElement.toPath().toString(3)}},uo=class extends co{geometryChange(){let e=this.center();this.attr(`cx`,e.x),this.attr(`cy`,e.y),this.attr(`r`,this.radius()),this.invalidate()}center(){return this.srcElement.geometry().center}radius(){return this.srcElement.geometry().radius}template(){return`<circle ${this.renderId()} ${this.renderStyle()} ${this.renderOpacity()}cx='${this.center().x}' cy='${this.center().y}' r='${this.radius()}'${this.renderStroke()} ${this.renderFill()} ${this.renderDefinitions()}${this.renderClassName()} ${this.renderRole()}${this.renderAriaLabel()} ${this.renderAriaRoleDescription()}${this.renderAriaChecked()} ${this.renderTransform()} ></circle>`}},fo=class extends Qa{template(){return`<g${this.renderId()+this.renderTransform()+this.renderClassName()+this.renderStyle()+this.renderOpacity()+this.renderRole()+this.renderAriaLabel()+this.renderAriaRoleDescription()+this.renderAriaChecked()+this.renderDefinitions()}>${this.renderChildren()}</g>`}optionsChange(e){let{field:t,value:n}=e;t===`transform`&&this.transformChange(n),this.accessibilityOptionsChange(e),super.optionsChange(e)}},po=class extends co{geometryChange(){this.allAttr(this.mapPosition()),this.invalidate()}optionsChange(e){e.field===`src`&&this.allAttr(this.mapSource()),super.optionsChange(e)}mapPosition(){let e=this.srcElement.rect(),t=e.topLeft();return[[`x`,t.x],[`y`,t.y],[`width`,e.width()+`px`],[`height`,e.height()+`px`]]}renderPosition(){return Ba(this.mapPosition())}mapSource(e){let t=this.srcElement.src();return e&&(t=Jt(t)),[[`xlink:href`,t]]}renderSource(){return Ba(this.mapSource(!0))}template(){return`<image preserveAspectRatio='none' ${this.renderId()} ${this.renderStyle()} ${this.renderTransform()} ${this.renderOpacity()}${this.renderPosition()} ${this.renderSource()} ${this.renderDefinitions()}${this.renderClassName()} ${this.renderRole()}${this.renderAriaLabel()} ${this.renderAriaRoleDescription()}${this.renderAriaChecked()} ></image>`}},mo=class extends co{renderData(){return this.srcElement.toString(3)||`undefined`}},ho=class extends co{geometryChange(){let e=this.srcElement.geometry();this.attr(`x`,e.origin.x),this.attr(`y`,e.origin.y),this.attr(`width`,e.size.width),this.attr(`height`,e.size.height),this.attr(`rx`,e.cornerRadius[0]),this.attr(`ry`,e.cornerRadius[1]),this.invalidate()}size(){return this.srcElement.geometry().size}origin(){return this.srcElement.geometry().origin}rx(){return this.srcElement.geometry().cornerRadius[0]}ry(){return this.srcElement.geometry().cornerRadius[1]}template(){return`<rect ${this.renderId()} ${this.renderStyle()} ${this.renderOpacity()} x='${this.origin().x}' y='${this.origin().y}' rx='${this.rx()}' ry='${this.ry()}' width='${this.size().width}' height='${this.size().height}' ${this.renderStroke()} ${this.renderFill()} ${this.renderDefinitions()} ${this.renderTransform()}${this.renderClassName()} ${this.renderRole()}${this.renderAriaLabel()} ${this.renderAriaRoleDescription()}${this.renderAriaChecked()} />`}};let go=/&(?:[a-zA-Z]+|#\d+);/g;function _o(e){if(!e||typeof e!=`string`||!go.test(e))return e;let t=_o._element;return go.lastIndex=0,e.replace(go,e=>(t.innerHTML=e,t.textContent||t.innerText))}typeof document<`u`&&(_o._element=document.createElement(`span`));var vo=class extends co{geometryChange(){let e=this.pos();this.attr(`x`,e.x),this.attr(`y`,e.y),this.invalidate()}optionsChange(e){e.field===`font`?(this.attr(`style`,Va(this.mapStyle())),this.geometryChange()):e.field===`content`&&super.content(this.srcElement.content()),super.optionsChange(e)}mapStyle(e){let t=super.mapStyle(e),n=this.srcElement.options.font;return e&&(n=Jt(n)),t.push([`font`,n],[`white-space`,`pre`]),t}pos(){let e=this.srcElement.position(),t=this.srcElement.measure();return e.clone().setY(e.y+t.baseline)}renderContent(){let e=this.srcElement.content();return e=_o(e),e=Jt(e),cr(e)}renderTextAnchor(){let e;return(this.options||{}).rtl&&!(Qt.browser.msie||Qt.browser.edge)&&(e=`end`),za(`text-anchor`,e)}renderPaintOrder(){let e=this.srcElement.options.paintOrder;return e?za(`paint-order`,e):``}template(){return`<text ${this.renderId()} ${this.renderTextAnchor()} ${this.renderStyle()} ${this.renderOpacity()}x='${this.pos().x}' y='${this.pos().y}' ${this.renderStroke()} ${this.renderTransform()} ${this.renderDefinitions()}${this.renderPaintOrder()}${this.renderFill()}${this.renderClassName()} ${this.renderRole()}${this.renderAriaLabel()} ${this.renderAriaRoleDescription()}${this.renderAriaChecked()}>${this.renderContent()}</text>`}};Ha.Arc=lo,Ha.Circle=uo,Ha.Group=fo,Ha.Image=po,Ha.MultiPath=mo,Ha.Path=co,Ha.Rect=ho,Ha.Text=vo;function yo(e){let t;try{t=e.getScreenCTM?e.getScreenCTM():null}catch{}if(t){let n=-t.e%1,r=-t.f%1,i=e.style;(n!==0||r!==0)&&(i.left=n+`px`,i.top=r+`px`)}}var bo=class extends Ra{get type(){return`svg`}constructor(e,t){super(e,t),this._root=new oo(Object.assign({rtl:Yn(e,`direction`).direction===`rtl`},this.options)),Ja(this.element,this._template(``)),this._rootElement=this.element.firstElementChild,this._rootElement.style.width=`100%`,this._rootElement.style.height=`100%`,this._rootElement.style.overflow=`hidden`,yo(this._rootElement),this._root.attachTo(this._rootElement),qn(this.element,{click:this._click,mouseover:this._mouseenter,mouseout:this._mouseleave,mousemove:this._mousemove}),this.resize()}destroy(){this._root&&(this._root.destroy(),this._root=null,this._rootElement=null,Qn(this.element,{click:this._click,mouseover:this._mouseenter,mouseout:this._mouseleave,mousemove:this._mousemove})),super.destroy()}translate(e){let t=`${Math.round(e.x)} ${Math.round(e.y)} ${this._size.width} ${this._size.height}`;this._offset=e,this._rootElement.setAttribute(`viewBox`,t)}draw(e){super.draw(e),this._root.load([e])}clear(){super.clear(),this._root.clear()}svg(){return`<?xml version='1.0' ?>`+this._template()}exportVisual(){let{_visual:e,_offset:t}=this;if(t){let n=new z;n.children.push(e),n.transform(Wr().translate(-t.x,-t.y)),e=n}return e}_resize(){this._offset&&this.translate(this._offset)}_template(e){return`<svg ${typeof e==`string`?e:`style='width: 100%; height: 100%; overflow: hidden;' `}xmlns='${Ua}' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1'>${this._root.render()}</svg>`}},xo={},So=class extends Ia{constructor(e){super(e),e&&this.initClip()}initClip(){let e=this.srcElement.clip();e&&(this.clip=e,e.addObserver(this))}clear(){this.srcElement&&this.srcElement.removeObserver(this),this.clearClip(),super.clear()}clearClip(){this.clip&&(this.clip.removeObserver(this),delete this.clip)}setClip(e){this.clip&&(e.beginPath(),new xo[this.clip.nodeType](this.clip).renderPoints(e,this.clip),e.clip(`evenodd`))}optionsChange(e){e.field===`clip`&&(this.clearClip(),this.initClip()),super.optionsChange(e)}setTransform(e){if(this.srcElement){let t=this.srcElement.transform();t&&e.transform.apply(e,t.matrix().toArray(6))}}loadElements(e,t,n){for(let r=0;r<e.length;r++){let i=e[r],a=i.children,o=new xo[i.nodeType](i,n);a&&a.length>0&&o.load(a,t,n),t===void 0?this.append(o):this.insertAt(o,t)}}load(e,t,n){this.loadElements(e,t,n),this.invalidate()}setOpacity(e){if(this.srcElement){let t=this.srcElement.opacity();t!==void 0&&this.globalAlpha(e,t)}}globalAlpha(e,t){let n=t;n&&e.globalAlpha&&(n*=e.globalAlpha),e.globalAlpha=n}visible(){let e=this.srcElement;return!e||e&&e.options.visible!==!1}},Co=class extends ga(So,`childNodes`){renderTo(e){if(!this.visible())return;e.save(),this.setTransform(e),this.setClip(e),this.setOpacity(e);let t=this.childNodes;for(let n=0;n<t.length;n++){let r=t[n];r.visible()&&r.renderTo(e)}e.restore()}},wo=class extends ga(Co,`childNodes`){constructor(e,t){super(),this.canvas=e,this.size=t,this.ctx=e.getContext(`2d`);let n=this._invalidate.bind(this);this.invalidate=en(()=>{Ht(n)},16.666666666666668)}destroy(){super.destroy(),this.canvas=null,this.ctx=null}load(e,t,n){this.loadElements(e,t,n),this._invalidate()}_rescale(e){let{canvas:t,size:n}=this;t.width=n.width*e,t.height=n.height*e,this.ctx.scale(e,e)}_devicePixelRatio(){return typeof window.devicePixelRatio==`number`?window.devicePixelRatio:1}_invalidate(e){if(!this.ctx)return;let t=e&&e.fixedScale?1:this._devicePixelRatio();this._rescale(t),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.renderTo(this.ctx)}},To=class extends Pt{constructor(){super(),this.shapes=[]}_add(e,t){this.shapes.push({bbox:t,shape:e}),e._quadNode=this}pointShapes(e){let t=this.shapes,n=t.length,r=[];for(let i=0;i<n;i++)t[i].bbox.containsPoint(e)&&r.push(t[i].shape);return r}insert(e,t){this._add(e,t)}remove(e){let t=this.shapes,n=t.length;for(let r=0;r<n;r++)if(t[r].shape===e){t.splice(r,1);break}}},Eo=class e extends To{constructor(e){super(),this.children=[],this.rect=e}inBounds(e){let t=this.rect,n=t.bottomRight(),r=e.bottomRight();return t.origin.x<=e.origin.x&&t.origin.y<=e.origin.y&&r.x<=n.x&&r.y<=n.y}pointShapes(e){let t=this.children,n=t.length,r=super.pointShapes(e);for(let i=0;i<n;i++)Cn(r,t[i].pointShapes(e));return r}insert(e,t){let n=this.children,r=!1;if(this.inBounds(t)){if(this.shapes.length<4)this._add(e,t);else{n.length||this._initChildren();for(let i=0;i<n.length;i++)if(n[i].insert(e,t)){r=!0;break}r||this._add(e,t)}r=!0}return r}_initChildren(){let{rect:t,children:n}=this,r=t.center(),i=t.width()/2,a=t.height()/2;n.push(new e(new L([t.origin.x,t.origin.y],[i,a])),new e(new L([r.x,t.origin.y],[i,a])),new e(new L([t.origin.x,r.y],[i,a])),new e(new L([r.x,r.y],[i,a])))}};let Do=3e3,Oo=BigInt(1e4);var ko=class extends Pt{constructor(){super(),this.initRoots()}initRoots(){this.rootMap={},this.root=new To,this.rootElements=[]}clear(){let e=this.rootElements;for(let t=0;t<e.length;t++)this.remove(e[t]);this.initRoots()}pointShape(e){let t=(this.rootMap[Math.floor(e.x/Do)]||{})[Math.floor(e.y/Do)],n=this.root.pointShapes(e);t&&(n=n.concat(t.pointShapes(e)));let r=No(n);this.assignZindex(n,r),n.sort(Ao);for(let t=0;t<n.length;t++)if(n[t].containsPoint(e))return n[t]}assignZindex(e,t){let n=Mo(Oo,BigInt(t)),r=[],i=BigInt(0);for(let t=0;t<e.length;t++){let a=e[t],o=i,s=n,c=[];for(;a;)c.push(a),a=a.parent;for(;c.length;)a=c.pop(),o+=BigInt((a.parent?a.parent.children:this.rootElements).indexOf(a)+1)*s,s/=Oo;e[t]._zIndex=o,r.push(o)}r.sort(jo);for(let t=0;t<e.length;t++)e[t]._zIndex=r.indexOf(e[t]._zIndex)}optionsChange(e){(e.field===`transform`||e.field===`stroke.width`)&&this.bboxChange(e.element)}geometryChange(e){this.bboxChange(e.element)}bboxChange(e){if(e.nodeType===`Group`)for(let t=0;t<e.children.length;t++)this.bboxChange(e.children[t]);else e._quadNode&&e._quadNode.remove(e),this._insertShape(e)}add(e){let t=Array.isArray(e)?e.slice(0):[e];Cn(this.rootElements,t),this._insert(t)}childrenChange(e){if(e.action===`remove`)for(let t=0;t<e.items.length;t++)this.remove(e.items[t]);else this._insert(Array.prototype.slice.call(e.items,0))}_insert(e){let t;for(;e.length>0;)t=e.pop(),t.addObserver(this),t.nodeType===`Group`?Cn(e,t.children):this._insertShape(t)}_insertShape(e){let t=e.bbox();if(t){let n=this.getSectors(t),r=n[0][0],i=n[1][0];if(this.inRoot(n))this.root.insert(e,t);else{let n=this.rootMap;n[r]||(n[r]={}),n[r][i]||(n[r][i]=new Eo(new L([r*Do,i*Do],[Do,Do]))),n[r][i].insert(e,t)}}}remove(e){if(e.removeObserver(this),e.nodeType===`Group`){let t=e.children;for(let e=0;e<t.length;e++)this.remove(t[e])}else e._quadNode&&(e._quadNode.remove(e),delete e._quadNode)}inRoot(e){return e[0].length>1||e[1].length>1}getSectors(e){let t=e.bottomRight(),n=Math.floor(t.x/Do),r=Math.floor(t.y/Do),i=[[],[]];for(let t=Math.floor(e.origin.x/Do);t<=n;t++)i[0].push(t);for(let t=Math.floor(e.origin.y/Do);t<=r;t++)i[1].push(t);return i}};function Ao(e,t){return e._zIndex<t._zIndex?1:e._zIndex>t._zIndex?-1:0}function jo(e,t){return e<t?-1:e>t?1:0}function Mo(e,t){let n=e,r=t,i=BigInt(1),a=i;for(;r;)r&i&&(a*=n),r>>=i,r&&(n*=n);return a}function No(e){let t=0;for(let n=0;n<e.length;n++){let r=e[n],i=[];for(;r;)i.push(r),r=r.parent;t=Math.max(t,i.length)}return t+1}var Po=ko,Fo=class{constructor(e){e.bind(`mouseenter`,this._mouseenter.bind(this)),e.bind(`mouseleave`,this._mouseleave.bind(this)),this.element=e.element}clear(){this._resetCursor()}destroy(){this._resetCursor(),delete this.element}_mouseenter(e){let t=this._shapeCursor(e);t?(this._current||(this._defaultCursor=this._getCursor()),this._setCursor(t)):this._resetCursor()}_mouseleave(){this._resetCursor()}_shapeCursor(e){let t=e.element;for(;t&&t.options.cursor===void 0;)t=t.parent;if(t)return t.options.cursor}_getCursor(){if(this.element)return this.element.style.cursor}_setCursor(e){this.element&&(this.element.style.cursor=e,this._current=e)}_resetCursor(){this._current&&(this._setCursor(this._defaultCursor||``),delete this._current)}};function Io(e,t){let n=t.segments;if(n.length===0)return;let r=n[0],i=r.anchor();e.moveTo(i.x,i.y);for(let t=1;t<n.length;t++){r=n[t],i=r.anchor();let a=n[t-1].controlOut(),o=r.controlIn();a&&o?e.bezierCurveTo(a.x,a.y,o.x,o.y,i.x,i.y):e.lineTo(i.x,i.y)}t.options.closed&&e.closePath()}function Lo(e,t){for(let n=0;n<t.length;n++){let r=t[n],i=pn(r.color());i.a*=r.opacity(),e.addColorStop(r.offset(),i.toCssRgba())}}var Ro=class extends So{renderTo(e){e.save(),this.setTransform(e),this.setClip(e),this.setOpacity(e),e.beginPath(),this.renderPoints(e,this.srcElement),this.setLineDash(e),this.setLineCap(e),this.setLineJoin(e),this.setFill(e),this.setStroke(e),e.restore()}setFill(e){let t=this.srcElement.options.fill,n=!1;return t&&(t.nodeType===`Gradient`?(this.setGradientFill(e,t),n=!0):t.nodeType===Jr?(this.setPatternFill(e,t),n=!0):zn(t.color)||(e.fillStyle=t.color,e.save(),this.globalAlpha(e,t.opacity),e.fill(),e.restore(),n=!0)),n}setGradientFill(e,t){let n=this.srcElement.rawBBox(),r;if(t instanceof Na){let n=t.start(),i=t.end();r=e.createLinearGradient(n.x,n.y,i.x,i.y)}else if(t instanceof Pa){let n=t.center();r=e.createRadialGradient(n.x,n.y,0,n.x,n.y,t.radius())}Lo(r,t.stops),e.save(),t.userSpace()||e.transform(n.width(),0,0,n.height(),n.origin.x,n.origin.y),e.fillStyle=r,e.fill(),e.restore()}setPatternFill(e,t){let n=t.size(),r=document.createElement(`canvas`),i=r.getContext(`2d`);r.width=n.getWidth(),r.height=n.getHeight(),this.childNodes.length=0,this.loadElements(t.children);let a=this.childNodes;for(let e=0;e<a.length;e++)a[e].renderTo(i);e.save(),e.fillStyle=e.createPattern(r,`repeat`),e.fill(),e.restore()}setStroke(e){let t=this.srcElement.options.stroke;if(t&&!zn(t.color)&&t.width>0)return e.strokeStyle=t.color,e.lineWidth=Kn(t.width,1),e.lineJoin=Kn(t.lineJoin,e.lineJoin),e.save(),this.globalAlpha(e,t.opacity),e.stroke(),e.restore(),!0}dashType(){let e=this.srcElement.options.stroke;if(e&&e.dashType)return e.dashType.toLowerCase()}setLineDash(e){let t=this.dashType();if(t&&t!==Kr){let n=Gr[t];e.setLineDash?e.setLineDash(n):(e.mozDash=n,e.webkitLineDash=n)}}setLineCap(e){let t=this.dashType(),n=this.srcElement.options.stroke;t&&t!==Kr?e.lineCap=qr:n&&n.lineCap&&(e.lineCap=n.lineCap)}setLineJoin(e){let t=this.srcElement.options.stroke;t&&t.lineJoin&&(e.lineJoin=t.lineJoin)}renderPoints(e,t){Io(e,t)}},zo=class extends Ro{renderPoints(e){Io(e,this.srcElement.toPath())}},Bo=class extends Ro{renderPoints(e){let{center:t,radius:n}=this.srcElement.geometry();e.arc(t.x,t.y,n,0,Math.PI*2)}},Vo=class extends Ro{constructor(e,t){super(e),this.onLoad=this.onLoad.bind(this),this.onError=this.onError.bind(this),this.loading=En();let n=this.img=new Image,r=e.src();t&&!/^data:/i.test(r)&&(n.crossOrigin=t),r&&(n.src=r),n.complete?this.onLoad():(n.onload=this.onLoad,n.onerror=this.onError)}renderTo(e){this.loading.state()===`resolved`&&(e.save(),this.setTransform(e),this.setClip(e),this.drawImage(e),e.restore())}optionsChange(e){e.field===`src`?(this.loading=En(),this.img.src=this.srcElement.src()):super.optionsChange(e)}onLoad(){this.loading.resolve(),this.invalidate()}onError(){this.loading.reject(Error(`Unable to load image '`+this.img.src+`'. Check for connectivity and verify CORS headers.`))}drawImage(e){let t=this.srcElement.rect(),n=t.topLeft();e.drawImage(this.img,n.x,n.y,t.width(),t.height())}},Ho=class extends Ro{renderPoints(e){let t=this.srcElement.paths;for(let n=0;n<t.length;n++)Io(e,t[n])}},Uo=class extends Ro{renderPoints(e){let t=this.srcElement.geometry(),[n,r]=t.cornerRadius;if(n===0&&r===0){let{origin:n,size:r}=t;e.rect(n.x,n.y,r.width,r.height)}else super.renderPoints(e,R.fromRect(t))}},Wo=class extends Ro{renderTo(e){let t=this.srcElement,n=t.position(),r=t.measure();e.save(),this.setTransform(e),this.setClip(e),this.setOpacity(e),e.beginPath(),e.font=t.options.font,e.textAlign=`left`,t.options.paintOrder===`stroke`?(this.stroke(e,t,n,r),this.fill(e,t,n,r)):(this.fill(e,t,n,r),this.stroke(e,t,n,r)),e.restore()}stroke(e,t,n,r){this.setStroke(e)&&(this.setLineDash(e),e.strokeText(t.content(),n.x,n.y+r.baseline))}fill(e,t,n,r){this.setFill(e)&&e.fillText(t.content(),n.x,n.y+r.baseline)}};xo.Arc=zo,xo.Circle=Bo,xo.Group=Co,xo.Image=Vo,xo.MultiPath=Ho,xo.Path=Ro,xo.Rect=Uo,xo.Text=Wo;var Go=class extends Ra{get type(){return`canvas`}constructor(e,t){super(e,t),this.element.innerHTML=this._template(this);let n=this.element.firstElementChild;n.style.width=`100%`,n.style.height=`100%`;let r=Zn(e);n.width=r.width,n.height=r.height,this._rootElement=n,this._root=new wo(n,r),this._mouseTrackHandler=this._trackMouse.bind(this),qn(this.element,{click:this._mouseTrackHandler,mousemove:this._mouseTrackHandler})}destroy(){super.destroy(),this._root&&=(this._root.destroy(),null),this._searchTree&&(this._searchTree.clear(),delete this._searchTree),this._cursor&&(this._cursor.destroy(),delete this._cursor),Qn(this.element,{click:this._mouseTrackHandler,mousemove:this._mouseTrackHandler})}draw(e){super.draw(e),this._root.load([e],void 0,this.options.cors),this._searchTree&&this._searchTree.add([e])}clear(){super.clear(),this._root.clear(),this._searchTree&&this._searchTree.clear(),this._cursor&&this._cursor.clear()}eventTarget(e){if(this._searchTree){let t=this._surfacePoint(e);return this._searchTree.pointShape(t)}}image(){let{_root:e,_rootElement:t}=this,n=[];e.traverse(e=>{e.loading&&n.push(e.loading)});let r=En(),i=()=>{e._invalidate({fixedScale:!0});try{let e=t.toDataURL();r.resolve(e)}catch(e){r.reject(e)}};return Un(n).then(i,i),r}suspendTracking(){super.suspendTracking(),this._searchTree&&(this._searchTree.clear(),delete this._searchTree)}resumeTracking(){if(super.resumeTracking(),!this._searchTree){this._searchTree=new Po;let e=this._root.childNodes,t=[];for(let n=0;n<e.length;n++)t.push(e[n].srcElement);this._searchTree.add(t)}}_resize(){this._rootElement.width=this._size.width,this._rootElement.height=this._size.height,this._root.size=this._size,this._root.invalidate()}_template(){return`<canvas></canvas>`}_enableTracking(){this._searchTree=new Po,this._cursor=new Fo(this),super._enableTracking()}_trackMouse(e){if(this._suspendedTracking)return;let t=this.eventTarget(e);if(e.type!==`click`){let n=this._currentShape;n&&n!==t&&this.trigger(`mouseleave`,{element:n,originalEvent:e,type:`mouseleave`}),t&&n!==t&&this.trigger(`mouseenter`,{element:t,originalEvent:e,type:`mouseenter`}),this.trigger(`mousemove`,{element:t,originalEvent:e,type:`mousemove`}),this._currentShape=t}else t&&this.trigger(`click`,{element:t,originalEvent:e,type:`click`})}};let Ko,qo,Jo=()=>typeof document<`u`,Yo=()=>Jo()&&document.createElement(`canvas`).getContext,Xo=()=>Jo()&&document.implementation.hasFeature(`http://www.w3.org/TR/SVG11/feature#BasicStructure`,`1.1`);var Zo=class e extends Pt{static get support(){return qo||={canvas:Yo(),svg:Xo()},qo}static get current(){return Ko||=new e,Ko}constructor(){super(),this._items=[{name:`svg`,type:bo},{name:`canvas`,type:Go}]}create(e,t){let n=this._items,r=n[0];if(t&&t.type){let e=t.type.toLowerCase();for(let t=0;t<n.length;t++)if(n[t].name===e){r=n[t];break}}if(r)return new r.type(e,t);Yt(`Warning: Unable to create Kendo UI Drawing Surface. Possible causes:
- The browser does not support SVG and Canvas. User agent: ${navigator.userAgent}`)}},Qo=class extends Ra{static get support(){return Zo.support}static create(e,t){return Zo.current.create(e,t)}};let $o=typeof Uint8Array<`u`&&Qt.browser&&(!Qt.browser.msie||Qt.browser.version>9),es=function(){var e=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=`;return{decode:function(t){for(var n=t.replace(/[^A-Za-z0-9\+\/\=]/g,``),r=0,i=n.length,a=[];r<i;){var o=e.indexOf(n.charAt(r++)),s=e.indexOf(n.charAt(r++)),c=e.indexOf(n.charAt(r++)),l=e.indexOf(n.charAt(r++)),u=o<<2|s>>>4,d=(s&15)<<4|c>>>2,f=(c&3)<<6|l;a.push(u),c!=64&&a.push(d),l!=64&&a.push(f)}return a},encode:function(t){for(var n=0,r=t.length,i=``;n<r;){var a=t[n++],o=t[n++],s=t[n++],c=a>>>2,l=(a&3)<<4|o>>>4,u=(o&15)<<2|s>>>6,d=s&63;n-r==2?u=d=64:n-r==1&&(d=64),i+=e.charAt(c)+e.charAt(l)+e.charAt(u)+e.charAt(d)}return i}}}();function ts(e){var t=0,n=0;e==null?e=$o?new Uint8Array(256):[]:n=e.length;var r=$o?function(t){if(t>=e.length){var n=new Uint8Array(Math.max(t+256,e.length*2));n.set(e,0),e=n}}:function(){},i=$o?function(){return new Uint8Array(e.buffer,0,n)}:function(){return e},a=$o?function(i){if(typeof i==`string`)return ee(i);var a=i.length;r(t+a),e.set(i,t),t+=a,t>n&&(n=t)}:function(e){if(typeof e==`string`)return ee(e);for(var t=0;t<e.length;++t)l(e[t])},o=$o?function(t,n){if(e.buffer.slice)return new Uint8Array(e.buffer.slice(t,t+n));var r=new Uint8Array(n);return r.set(new Uint8Array(e.buffer,t,n)),r}:function(t,n){return e.slice(t,t+n)};function s(){return t>=n}function c(){return t<n?e[t++]:0}function l(i){r(t),e[t++]=i&255,t>n&&(n=t)}function u(){return c()<<8|c()}function d(e){l(e>>8),l(e)}function f(){var e=u();return e>=32768?e-65536:e}function p(e){d(e<0?e+65536:e)}function m(){return u()*65536+u()}function h(e){d(e>>>16&65535),d(e&65535)}function g(){var e=m();return e>=2147483648?e-4294967296:e}function _(e){h(e<0?e+4294967296:e)}function v(){return m()/65536}function y(e){h(Math.round(e*65536))}function b(){return g()/65536}function x(e){_(Math.round(e*65536))}function S(e){return te(e,c)}function C(e){return String.fromCharCode.apply(String,S(e))}function ee(e){for(var t=0;t<e.length;++t)l(e.charCodeAt(t))}function te(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t();return n}var w={eof:s,readByte:c,writeByte:l,readShort:u,writeShort:d,readLong:m,writeLong:h,readFixed:v,writeFixed:y,readShort_:f,writeShort_:p,readLong_:g,writeLong_:_,readFixed_:b,writeFixed_:x,read:S,write:a,readString:C,writeString:ee,times:te,get:i,slice:o,offset:function(e){return e==null?t:(t=e,w)},skip:function(e){t+=e},toString:function(){throw Error(`FIX CALLER.  BinaryStream is no longer convertible to string!`)},length:function(){return n},saveExcursion:function(e){var n=t;try{return e()}finally{t=n}},writeBase64:function(e){window.atob?ee(window.atob(e)):a(es.decode(e))},base64:function(){return es.encode(i())}};return w}function ns(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function rs(e){return Object.keys(e).sort(function(e,t){return e-t}).map(parseFloat)}var is=class{constructor(e,t){this.definition=t,this.length=t.length,this.offset=t.offset,this.file=e,this.rawData=e.raw,this.parse(e.raw)}raw(){return this.rawData.slice(this.offset,this.length)}parse(){}};(function(){class e{get compound(){return!1}constructor(e){this.raw=e}render(){return this.raw.get()}}var t=1,n=8,r=32,i=64,a=128;class o{get compound(){return!0}constructor(e){this.raw=e;for(var o=this.glyphIds=[],s=this.idOffsets=[];;){var c=e.readShort();if(s.push(e.offset()),o.push(e.readShort()),!(c&r))break;e.skip(c&t?4:2),c&a?e.skip(8):c&i?e.skip(4):c&n&&e.skip(2)}}render(e){for(var t=ts(this.raw.get()),n=0;n<this.glyphIds.length;++n){var r=this.glyphIds[n];t.offset(this.idOffsets[n]),t.writeShort(e[r])}return t.get()}}return class extends is{parse(){this.cache={}}glyphFor(t){var n=this.cache;if(ns(n,t))return n[t];var r=this.file.loca,i=r.lengthOf(t);if(i===0)return n[t]=null;var a=this.rawData,s=this.offset+r.offsetOf(t),c=ts(a.slice(s,i)),l=c.readShort_(),u=c.readShort_(),d=c.readShort_(),f=c.readShort_(),p=c.readShort_(),m=n[t]=l<0?new o(c):new e(c);return m.numberOfContours=l,m.xMin=u,m.yMin=d,m.xMax=f,m.yMax=p,m}render(e,t,n){for(var r=ts(),i=[],a=0;a<t.length;++a){var o=e[t[a]];r.offset()%2&&r.writeByte(0),i.push(r.offset()),o&&r.write(o.render(n))}return r.offset()%2&&r.writeByte(0),i.push(r.offset()),{table:r.get(),offsets:i}}}})(),(function(){class e{constructor(e,t){this.text=e,this.length=e.length,this.platformID=t.platformID,this.platformSpecificID=t.platformSpecificID,this.languageID=t.languageID,this.nameID=t.nameID}}return class extends is{parse(t){t.offset(this.offset),t.readShort();for(var n=t.readShort(),r=this.offset+t.readShort(),i=t.times(n,function(){return{platformID:t.readShort(),platformSpecificID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:t.readShort()+r}}),a=this.strings={},o=0;o<i.length;++o){var s=i[o];t.offset(s.offset);var c=t.readString(s.length);a[s.nameID]||(a[s.nameID]=[]),a[s.nameID].push(new e(c,s))}this.postscriptEntry=a[6][0],this.postscriptName=this.postscriptEntry.text.replace(/[^\x20-\x7F]/g,``)}render(t){var n=this.strings,r=0;for(var i in n)ns(n,i)&&(r+=n[i].length);var a=ts(),o=ts();for(i in a.writeShort(0),a.writeShort(r),a.writeShort(6+12*r),n)if(ns(n,i))for(var s=i==6?[new e(t,this.postscriptEntry)]:n[i],c=0;c<s.length;++c){var l=s[c];a.writeShort(l.platformID),a.writeShort(l.platformSpecificID),a.writeShort(l.languageID),a.writeShort(l.nameID),a.writeShort(l.length),a.writeShort(o.offset()),o.writeString(l.text)}return a.write(o.get()),a.get()}}})(),(function(){var e=`.notdef .null nonmarkingreturn space exclam quotedbl numbersign dollar percent ampersand quotesingle parenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven eight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U V W X Y Z bracketleft backslash bracketright asciicircum underscore grave a b c d e f g h i j k l m n o p q r s t u v w x y z braceleft bar braceright asciitilde Adieresis Aring Ccedilla Eacute Ntilde Odieresis Udieresis aacute agrave acircumflex adieresis atilde aring ccedilla eacute egrave ecircumflex edieresis iacute igrave icircumflex idieresis ntilde oacute ograve ocircumflex odieresis otilde uacute ugrave ucircumflex udieresis dagger degree cent sterling section bullet paragraph germandbls registered copyright trademark acute dieresis notequal AE Oslash infinity plusminus lessequal greaterequal yen mu partialdiff summation product pi integral ordfeminine ordmasculine Omega ae oslash questiondown exclamdown logicalnot radical florin approxequal Delta guillemotleft guillemotright ellipsis nonbreakingspace Agrave Atilde Otilde OE oe endash emdash quotedblleft quotedblright quoteleft quoteright divide lozenge ydieresis Ydieresis fraction currency guilsinglleft guilsinglright fi fl daggerdbl periodcentered quotesinglbase quotedblbase perthousand Acircumflex Ecircumflex Aacute Edieresis Egrave Iacute Icircumflex Idieresis Igrave Oacute Ocircumflex apple Ograve Uacute Ucircumflex Ugrave dotlessi circumflex tilde macron breve dotaccent ring cedilla hungarumlaut ogonek caron Lslash lslash Scaron scaron Zcaron zcaron brokenbar Eth eth Yacute yacute Thorn thorn minus multiply onesuperior twosuperior threesuperior onehalf onequarter threequarters franc Gbreve gbreve Idotaccent Scedilla scedilla Cacute cacute Ccaron ccaron dcroat`.split(/\s+/g);return class extends is{parse(e){e.offset(this.offset),this.format=e.readLong(),this.italicAngle=e.readFixed_(),this.underlinePosition=e.readShort_(),this.underlineThickness=e.readShort_(),this.isFixedPitch=e.readLong(),this.minMemType42=e.readLong(),this.maxMemType42=e.readLong(),this.minMemType1=e.readLong(),this.maxMemType1=e.readLong();var t;switch(this.format){case 65536:case 196608:break;case 131072:t=e.readShort(),this.glyphNameIndex=e.times(t,e.readShort),this.names=[];for(var n=this.offset+this.length;e.offset()<n;)this.names.push(e.readString(e.readByte()));break;case 151552:t=e.readShort(),this.offsets=e.read(t);break;case 262144:this.map=e.times(this.file.maxp.numGlyphs,e.readShort);break}}glyphFor(t){switch(this.format){case 65536:return e[t]||`.notdef`;case 131072:var n=this.glyphNameIndex[t];return n<e.length?e[n]:this.names[n-e.length]||`.notdef`;case 151552:case 196608:return`.notdef`;case 262144:return this.map[t]||65535}}render(t){if(this.format==196608)return this.raw();var n=ts(this.rawData.slice(this.offset,32));n.writeLong(131072),n.offset(32);for(var r=[],i=[],a=0;a<t.length;++a){var o=t[a],s=this.glyphFor(o),c=e.indexOf(s);c>=0?r.push(c):(r.push(e.length+i.length),i.push(s))}for(n.writeShort(t.length),a=0;a<r.length;++a)n.writeShort(r[a]);for(a=0;a<i.length;++a)n.writeByte(i[a].length),n.writeString(i[a]);return n.get()}}})(),(function(){class e{constructor(e,t,n){var r=this;r.platformID=e.readShort(),r.platformSpecificID=e.readShort(),r.offset=t+e.readLong(),e.saveExcursion(function(){var t;switch(e.offset(r.offset),r.format=e.readShort(),r.format){case 0:r.length=e.readShort(),r.language=e.readShort();for(var i=0;i<256;++i)n[i]=e.readByte();break;case 4:r.length=e.readShort(),r.language=e.readShort();var a=e.readShort()/2;e.skip(6);var o=e.times(a,e.readShort);e.skip(2);var s=e.times(a,e.readShort),c=e.times(a,e.readShort_),l=e.times(a,e.readShort),u=(r.length+r.offset-e.offset())/2,d=e.times(u,e.readShort);for(i=0;i<a;++i){var f=s[i],p=o[i];for(t=f;t<=p;++t){var m;l[i]===0?m=t+c[i]:(m=d[l[i]/2-(a-i)+(t-f)]||0,m!==0&&(m+=c[i])),n[t]=m&65535}}break;case 6:r.length=e.readShort(),r.language=e.readShort(),t=e.readShort();for(var h=e.readShort();h-- >0;)n[t++]=e.readShort();break;case 12:e.readShort(),r.length=e.readLong(),r.language=e.readLong();for(var g=e.readLong();g-- >0;){t=e.readLong();for(var _=e.readLong(),v=e.readLong();t<=_;)n[t++]=v++}break;default:window.console&&window.console.error(`Unhandled CMAP format: `+r.format)}})}}function t(e,t){var n=rs(e),r=[],i=[],a=null,o=null;function s(n){return t[e[n]]}for(var c=0;c<n.length;++c){var l=n[c],u=s(l)-l;(a==null||u!==o)&&(a&&i.push(a),r.push(l),o=u),a=l}a&&i.push(a),i.push(65535),r.push(65535);var d=r.length,f=d*2,p=2*2**Math.floor(Math.log(d)/Math.LN2),m=Math.log(p/2)/Math.LN2,h=f-p,g=[],_=[],v=[];for(c=0;c<d;++c){var y=r[c],b=i[c];if(y==65535){g.push(0),_.push(0);break}var x=s(y);if(y-x>=32768){g.push(0),_.push(2*(v.length+d-c));for(var S=y;S<=b;++S)v.push(s(S))}else g.push(x-y),_.push(0)}var C=ts();return C.writeShort(3),C.writeShort(1),C.writeLong(12),C.writeShort(4),C.writeShort(16+d*8+v.length*2),C.writeShort(0),C.writeShort(f),C.writeShort(p),C.writeShort(m),C.writeShort(h),i.forEach(C.writeShort),C.writeShort(0),r.forEach(C.writeShort),g.forEach(C.writeShort_),_.forEach(C.writeShort),v.forEach(C.writeShort),C.get()}return class extends is{parse(t){var n=this,r=n.offset;t.offset(r),n.codeMap={},n.version=t.readShort();var i=t.readShort();n.tables=t.times(i,function(){return new e(t,r,n.codeMap)})}static render(e,n){var r=ts();return r.writeShort(0),r.writeShort(1),r.write(t(e,n)),r.get()}}})();var as=0,os=1,ss=2,cs=3,ls=4,us=5,ds=0,fs=1,ps=-2,ms=-3,hs=-5,gs=-1,_s=1,vs=2,ys=3,bs=4,xs=0,Ss=0,Cs=1,ws=2,Ts=8;function Es(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ds(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if(typeof n!=`object`)throw TypeError(n+`must be non-object`);for(var r in n)Es(n,r)&&(e[r]=n[r])}}return e}function Os(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}var ks={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray){e.set(t.subarray(n,n+r),i);return}for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r=0,i,a,o;for(t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],o.set(a,i),i+=a.length;return o},Buf8:function(e){return new Uint8Array(e)},Buf16:function(e){return new Uint16Array(e)},Buf32:function(e){return new Int32Array(e)}},As={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)},Buf8:function(e){return Array(e)},Buf16:function(e){return Array(e)},Buf32:function(e){return Array(e)}};let js=()=>{let e=typeof Uint8Array<`u`&&typeof Uint16Array<`u`&&typeof Int32Array<`u`;return js=()=>e,e},Ms=(e,t,n,r,i)=>(Ms=js()?ks.arraySet:As.arraySet,Ms(e,t,n,r,i)),Ns=e=>(Ns=js()?ks.flattenChunks:As.flattenChunks,Ns(e)),Ps=e=>(Ps=js()?ks.Buf8:As.Buf8,Ps(e)),Fs=e=>(Fs=js()?ks.Buf16:As.Buf16,Fs(e)),Is=e=>(Is=js()?ks.Buf32:As.Buf32,Is(e)),Ls=function(){let e=!0;try{String.fromCharCode.apply(null,[0])}catch{e=!1}return Ls=()=>e,e},Rs=function(){let e=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{e=!1}return Rs=()=>e,e},zs=function(e){for(var t=Ps(256),n=0;n<256;n++)t[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;return t[254]=t[254]=1,zs=e=>t[e],t[e]};function Bs(e){var t,n,r,i,a,o=e.length,s=0;for(i=0;i<o;i++)n=e.charCodeAt(i),(n&64512)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(r&64512)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,i=0;a<s;i++)n=e.charCodeAt(i),(n&64512)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(r&64512)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|n&63):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|n&63):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|n&63);return t}function Vs(e,t){if(t<65534&&(e.subarray&&Rs()||!e.subarray&&Ls()))return String.fromCharCode.apply(null,Os(e,t));for(var n=``,r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}function Hs(e){return Vs(e,e.length)}function Us(e,t,n,r){for(var i=e&65535|0,a=e>>>16&65535|0,o=0;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,a=a+i|0;while(--o);i%=65521,a%=65521}return i|a<<16|0}function Ws(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t}let Gs=function(){let e=Ws();return Gs=()=>e,e};function Ks(e,t,n,r){var i=Gs(),a=r+n;e^=-1;for(var o=r;o<a;o++)e=e>>>8^i[(e^t[o])&255];return e^-1}var qs={2:`need dictionary`,1:`stream end`,0:``,"-1":`file error`,"-2":`stream error`,"-3":`data error`,"-4":`insufficient memory`,"-5":`buffer error`,"-6":`incompatible version`};function Js(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=``,this.state=null,this.data_type=2,this.adler=0}Object.prototype.toString;function Ys(e){for(var t=e.length;--t>=0;)e[t]=0}var Xs=0,Zs=1,Qs=2,$s=3,ec=258,tc=29,nc=256,rc=nc+1+tc,ic=30,ac=19,oc=2*rc+1,sc=15,cc=16,lc=7,uc=256,dc=16,fc=17,pc=18,mc=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],hc=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],gc=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],_c=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],vc=512,yc,bc,xc,Sc,Cc,wc;function Tc(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}var Ec,Dc,Oc;function kc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function Ac(e){return e<256?xc[e]:xc[256+(e>>>7)]}function jc(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function Mc(e,t,n){e.bi_valid>cc-n?(e.bi_buf|=t<<e.bi_valid&65535,jc(e,e.bi_buf),e.bi_buf=t>>cc-e.bi_valid,e.bi_valid+=n-cc):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function Nc(e,t,n){Mc(e,n[t*2],n[t*2+1])}function Pc(e,t){var n=0;do n|=e&1,e>>>=1,n<<=1;while(--t>0);return n>>>1}function Fc(e){e.bi_valid===16?(jc(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function Ic(e,t){var n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,c=t.stat_desc.max_length,l,u,d,f,p,m,h=0;for(f=0;f<=sc;f++)e.bl_count[f]=0;for(n[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<oc;l++)u=e.heap[l],f=n[n[u*2+1]*2+1]+1,f>c&&(f=c,h++),n[u*2+1]=f,!(u>r)&&(e.bl_count[f]++,p=0,u>=s&&(p=o[u-s]),m=n[u*2],e.opt_len+=m*(f+p),a&&(e.static_len+=m*(i[u*2+1]+p)));if(h!==0){do{for(f=c-1;e.bl_count[f]===0;)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[c]--,h-=2}while(h>0);for(f=c;f!==0;f--)for(u=e.bl_count[f];u!==0;)d=e.heap[--l],!(d>r)&&(n[d*2+1]!==f&&(e.opt_len+=(f-n[d*2+1])*n[d*2],n[d*2+1]=f),u--)}}function Lc(e,t,n){var r=Array(sc+1),i=0,a,o;for(a=1;a<=sc;a++)r[a]=i=i+n[a-1]<<1;for(o=0;o<=t;o++){var s=e[o*2+1];s!==0&&(e[o*2]=Pc(r[s]++,s))}}function Rc(){var e,t,n,r,i,a=Array(sc+1);for(yc=Array((rc+2)*2),Ys(yc),bc=Array(ic*2),Ys(bc),xc=Array(vc),Ys(xc),Sc=Array(ec-$s+1),Ys(Sc),Cc=Array(tc),Ys(Cc),wc=Array(ic),Ys(wc),n=0,r=0;r<tc-1;r++)for(Cc[r]=n,e=0;e<1<<mc[r];e++)Sc[n++]=r;for(Sc[n-1]=r,i=0,r=0;r<16;r++)for(wc[r]=i,e=0;e<1<<hc[r];e++)xc[i++]=r;for(i>>=7;r<ic;r++)for(wc[r]=i<<7,e=0;e<1<<hc[r]-7;e++)xc[256+ i++]=r;for(t=0;t<=sc;t++)a[t]=0;for(e=0;e<=143;)yc[e*2+1]=8,e++,a[8]++;for(;e<=255;)yc[e*2+1]=9,e++,a[9]++;for(;e<=279;)yc[e*2+1]=7,e++,a[7]++;for(;e<=287;)yc[e*2+1]=8,e++,a[8]++;for(Lc(yc,rc+1,a),e=0;e<ic;e++)bc[e*2+1]=5,bc[e*2]=Pc(e,5);Ec=new Tc(yc,mc,nc+1,rc,sc),Dc=new Tc(bc,hc,0,ic,sc),Oc=new Tc([],gc,0,ac,lc)}function zc(e){var t;for(t=0;t<rc;t++)e.dyn_ltree[t*2]=0;for(t=0;t<ic;t++)e.dyn_dtree[t*2]=0;for(t=0;t<ac;t++)e.bl_tree[t*2]=0;e.dyn_ltree[uc*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Bc(e){e.bi_valid>8?jc(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Vc(e,t,n,r){Bc(e),r&&(jc(e,n),jc(e,~n)),Ms(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function Hc(e,t,n,r){var i=t*2,a=n*2;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function Uc(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&Hc(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Hc(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function Wc(e,t,n){var r,i,a=0,o,s;if(e.last_lit!==0)do r=e.pending_buf[e.d_buf+a*2]<<8|e.pending_buf[e.d_buf+a*2+1],i=e.pending_buf[e.l_buf+a],a++,r===0?Nc(e,i,t):(o=Sc[i],Nc(e,o+nc+1,t),s=mc[o],s!==0&&(i-=Cc[o],Mc(e,i,s)),r--,o=Ac(r),Nc(e,o,n),s=hc[o],s!==0&&(r-=wc[o],Mc(e,r,s)));while(a<e.last_lit);Nc(e,uc,t)}function Gc(e,t){var n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems,o,s,c=-1,l;for(e.heap_len=0,e.heap_max=oc,o=0;o<a;o++)n[o*2]===0?n[o*2+1]=0:(e.heap[++e.heap_len]=c=o,e.depth[o]=0);for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[l*2]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[l*2+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)Uc(e,n,o);l=a;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Uc(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=s,n[l*2]=n[o*2]+n[s*2],e.depth[l]=(e.depth[o]>=e.depth[s]?e.depth[o]:e.depth[s])+1,n[o*2+1]=n[s*2+1]=l,e.heap[1]=l++,Uc(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Ic(e,t),Lc(n,c,e.bl_count)}function Kc(e,t,n){var r,i=-1,a,o=t[1],s=0,c=7,l=4;for(o===0&&(c=138,l=3),t[(n+1)*2+1]=65535,r=0;r<=n;r++)a=o,o=t[(r+1)*2+1],!(++s<c&&a===o)&&(s<l?e.bl_tree[a*2]+=s:a===0?s<=10?e.bl_tree[fc*2]++:e.bl_tree[pc*2]++:(a!==i&&e.bl_tree[a*2]++,e.bl_tree[dc*2]++),s=0,i=a,o===0?(c=138,l=3):a===o?(c=6,l=3):(c=7,l=4))}function qc(e,t,n){var r,i=-1,a,o=t[1],s=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(a=o,o=t[(r+1)*2+1],!(++s<c&&a===o)){if(s<l)do Nc(e,a,e.bl_tree);while(--s!==0);else a===0?s<=10?(Nc(e,fc,e.bl_tree),Mc(e,s-3,3)):(Nc(e,pc,e.bl_tree),Mc(e,s-11,7)):(a!==i&&(Nc(e,a,e.bl_tree),s--),Nc(e,dc,e.bl_tree),Mc(e,s-3,2));s=0,i=a,o===0?(c=138,l=3):a===o?(c=6,l=3):(c=7,l=4)}}function Jc(e){var t;for(Kc(e,e.dyn_ltree,e.l_desc.max_code),Kc(e,e.dyn_dtree,e.d_desc.max_code),Gc(e,e.bl_desc),t=ac-1;t>=3&&e.bl_tree[_c[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t}function Yc(e,t,n,r){var i;for(Mc(e,t-257,5),Mc(e,n-1,5),Mc(e,r-4,4),i=0;i<r;i++)Mc(e,e.bl_tree[_c[i]*2+1],3);qc(e,e.dyn_ltree,t-1),qc(e,e.dyn_dtree,n-1)}function Xc(e){var t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(t&1&&e.dyn_ltree[n*2]!==0)return Ss;if(e.dyn_ltree[18]!==0||e.dyn_ltree[20]!==0||e.dyn_ltree[26]!==0)return Cs;for(n=32;n<nc;n++)if(e.dyn_ltree[n*2]!==0)return Cs;return Ss}var Zc=!1;function Qc(e){Zc||=(Rc(),!0),e.l_desc=new kc(e.dyn_ltree,Ec),e.d_desc=new kc(e.dyn_dtree,Dc),e.bl_desc=new kc(e.bl_tree,Oc),e.bi_buf=0,e.bi_valid=0,zc(e)}function $c(e,t,n,r){Mc(e,(Xs<<1)+(r?1:0),3),Vc(e,t,n,!0)}function el(e){Mc(e,Zs<<1,3),Nc(e,uc,yc),Fc(e)}function tl(e,t,n,r){var i,a,o=0;e.level>0?(e.strm.data_type===ws&&(e.strm.data_type=Xc(e)),Gc(e,e.l_desc),Gc(e,e.d_desc),o=Jc(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&t!==-1?$c(e,t,n,r):e.strategy===bs||a===i?(Mc(e,(Zs<<1)+(r?1:0),3),Wc(e,yc,bc)):(Mc(e,(Qs<<1)+(r?1:0),3),Yc(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),Wc(e,e.dyn_ltree,e.dyn_dtree)),zc(e),r&&Bc(e)}function nl(e,t,n){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=n&255,e.last_lit++,t===0?e.dyn_ltree[n*2]++:(e.matches++,t--,e.dyn_ltree[(Sc[n]+nc+1)*2]++,e.dyn_dtree[Ac(t)*2]++),e.last_lit===e.lit_bufsize-1}var rl=9,il=286,al=30,ol=19,sl=2*il+1,cl=15,B=3,ll=258,ul=ll+B+1,dl=32,fl=42,pl=69,ml=73,hl=91,gl=103,_l=113,vl=666,V=1,yl=2,bl=3,xl=4,Sl=3;function Cl(e,t){return e.msg=qs[t],t}function wl(e){return(e<<1)-(e>4?9:0)}function Tl(e){for(var t=e.length;--t>=0;)e[t]=0}function El(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(Ms(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))}function Dl(e,t){tl(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,El(e.strm)}function H(e,t){e.pending_buf[e.pending++]=t}function Ol(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function kl(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,Ms(t,e.input,e.next_in,i,n),e.state.wrap===1?e.adler=Us(e.adler,t,i,n):e.state.wrap===2&&(e.adler=Ks(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)}function Al(e,t){var n=e.max_chain_length,r=e.strstart,i,a,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-ul?e.strstart-(e.w_size-ul):0,l=e.window,u=e.w_mask,d=e.prev,f=e.strstart+ll,p=l[r+o-1],m=l[r+o];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(i=t,l[i+o]!==m||l[i+o-1]!==p||l[i]!==l[r]||l[++i]!==l[r+1])continue;r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<f);if(a=ll-(f-r),r=f-ll,a>o){if(e.match_start=t,o=a,a>=s)break;p=l[r+o-1],m=l[r+o]}}while((t=d[t&u])>c&&--n!==0);return o<=e.lookahead?o:e.lookahead}function jl(e){var t=e.w_size,n,r,i,a,o;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ul)){Ms(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,r=e.hash_size,n=r;do i=e.head[--n],e.head[n]=i>=t?i-t:0;while(--r);r=t,n=r;do i=e.prev[--n],e.prev[n]=i>=t?i-t:0;while(--r);a+=t}if(e.strm.avail_in===0)break;if(r=kl(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=B)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+B-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<B)););}while(e.lookahead<ul&&e.strm.avail_in!==0)}function Ml(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(jl(e),e.lookahead===0&&t===as)return V;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((e.strstart===0||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,Dl(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-ul&&(Dl(e,!1),e.strm.avail_out===0))return V}return e.insert=0,t===ls?(Dl(e,!0),e.strm.avail_out===0?bl:xl):(e.strstart>e.block_start&&(Dl(e,!1),e.strm.avail_out),V)}function Nl(e,t){for(var n,r;;){if(e.lookahead<ul){if(jl(e),e.lookahead<ul&&t===as)return V;if(e.lookahead===0)break}if(n=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-ul&&(e.match_length=Al(e,n)),e.match_length>=B)if(r=nl(e,e.strstart-e.match_start,e.match_length-B),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=B){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=nl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Dl(e,!1),e.strm.avail_out===0))return V}return e.insert=e.strstart<B-1?e.strstart:B-1,t===ls?(Dl(e,!0),e.strm.avail_out===0?bl:xl):e.last_lit&&(Dl(e,!1),e.strm.avail_out===0)?V:yl}function Pl(e,t){for(var n,r,i;;){if(e.lookahead<ul){if(jl(e),e.lookahead<ul&&t===as)return V;if(e.lookahead===0)break}if(n=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=B-1,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ul&&(e.match_length=Al(e,n),e.match_length<=5&&(e.strategy===_s||e.match_length===B&&e.strstart-e.match_start>4096)&&(e.match_length=B-1)),e.prev_length>=B&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-B,r=nl(e,e.strstart-1-e.prev_match,e.prev_length-B),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=B-1,e.strstart++,r&&(Dl(e,!1),e.strm.avail_out===0))return V}else if(e.match_available){if(r=nl(e,0,e.window[e.strstart-1]),r&&Dl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return V}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&=(r=nl(e,0,e.window[e.strstart-1]),0),e.insert=e.strstart<B-1?e.strstart:B-1,t===ls?(Dl(e,!0),e.strm.avail_out===0?bl:xl):e.last_lit&&(Dl(e,!1),e.strm.avail_out===0)?V:yl}function Fl(e,t){for(var n,r,i,a,o=e.window;;){if(e.lookahead<=ll){if(jl(e),e.lookahead<=ll&&t===as)return V;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=B&&e.strstart>0&&(i=e.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){a=e.strstart+ll;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=ll-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=B?(n=nl(e,1,e.match_length-B),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=nl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Dl(e,!1),e.strm.avail_out===0))return V}return e.insert=0,t===ls?(Dl(e,!0),e.strm.avail_out===0?bl:xl):e.last_lit&&(Dl(e,!1),e.strm.avail_out===0)?V:yl}function Il(e,t){for(var n;;){if(e.lookahead===0&&(jl(e),e.lookahead===0)){if(t===as)return V;break}if(e.match_length=0,n=nl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Dl(e,!1),e.strm.avail_out===0))return V}return e.insert=0,t===ls?(Dl(e,!0),e.strm.avail_out===0?bl:xl):e.last_lit&&(Dl(e,!1),e.strm.avail_out===0)?V:yl}function Ll(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}let Rl=function(){let e=[new Ll(0,0,0,0,Ml),new Ll(4,4,8,4,Nl),new Ll(4,5,16,8,Nl),new Ll(4,6,32,32,Nl),new Ll(4,4,16,16,Pl),new Ll(8,16,32,32,Pl),new Ll(8,16,128,128,Pl),new Ll(8,32,128,256,Pl),new Ll(32,128,258,1024,Pl),new Ll(32,258,258,4096,Pl)];return Rl=()=>e,e};function zl(e){e.window_size=2*e.w_size,Tl(e.head);let t=Rl();e.max_lazy_match=t[e.level].max_lazy,e.good_match=t[e.level].good_length,e.nice_match=t[e.level].nice_length,e.max_chain_length=t[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=B-1,e.match_available=0,e.ins_h=0}function Bl(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ts,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=Fs(sl*2),this.dyn_dtree=Fs((2*al+1)*2),this.bl_tree=Fs((2*ol+1)*2),Tl(this.dyn_ltree),Tl(this.dyn_dtree),Tl(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=Fs(cl+1),this.heap=Fs(2*il+1),Tl(this.heap),this.heap_len=0,this.heap_max=0,this.depth=Fs(2*il+1),Tl(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Vl(e){var t;return!e||!e.state?Cl(e,ps):(e.total_in=e.total_out=0,e.data_type=ws,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?fl:_l,e.adler=t.wrap===2?0:1,t.last_flush=as,Qc(t),ds)}function Hl(e){var t=Vl(e);return t===ds&&zl(e.state),t}function Ul(e,t){return!e||!e.state||e.state.wrap!==2?ps:(e.state.gzhead=t,ds)}function Wl(e,t,n,r,i,a){if(!e)return ps;var o=1;if(t===gs&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>rl||n!==Ts||r<8||r>15||t<0||t>9||a<0||a>bs)return Cl(e,ps);r===8&&(r=9);var s=new Bl;return e.state=s,s.strm=e,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+B-1)/B),s.window=Ps(s.w_size*2),s.head=Fs(s.hash_size),s.prev=Fs(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=Ps(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=n,Hl(e)}function Gl(e,t){var n,r,i,a;if(!e||!e.state||t>us||t<0)return e?Cl(e,ps):ps;if(r=e.state,!e.output||!e.input&&e.avail_in!==0||r.status===vl&&t!==ls)return Cl(e,e.avail_out===0?hs:ps);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===fl)if(r.wrap===2)e.adler=0,H(r,31),H(r,139),H(r,8),r.gzhead?(H(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),H(r,r.gzhead.time&255),H(r,r.gzhead.time>>8&255),H(r,r.gzhead.time>>16&255),H(r,r.gzhead.time>>24&255),H(r,r.level===9?2:r.strategy>=vs||r.level<2?4:0),H(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(H(r,r.gzhead.extra.length&255),H(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Ks(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=pl):(H(r,0),H(r,0),H(r,0),H(r,0),H(r,0),H(r,r.level===9?2:r.strategy>=vs||r.level<2?4:0),H(r,Sl),r.status=_l);else{var o=Ts+(r.w_bits-8<<4)<<8,s=-1;s=r.strategy>=vs||r.level<2?0:r.level<6?1:r.level===6?2:3,o|=s<<6,r.strstart!==0&&(o|=dl),o+=31-o%31,r.status=_l,Ol(r,o),r.strstart!==0&&(Ol(r,e.adler>>>16),Ol(r,e.adler&65535)),e.adler=1}if(r.status===pl)if(r.gzhead.extra){for(i=r.pending;r.gzindex<(r.gzhead.extra.length&65535)&&!(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=Ks(e.adler,r.pending_buf,r.pending-i,i)),El(e),i=r.pending,r.pending===r.pending_buf_size));)H(r,r.gzhead.extra[r.gzindex]&255),r.gzindex++;r.gzhead.hcrc&&r.pending>i&&(e.adler=Ks(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=ml)}else r.status=ml;if(r.status===ml)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=Ks(e.adler,r.pending_buf,r.pending-i,i)),El(e),i=r.pending,r.pending===r.pending_buf_size)){a=1;break}a=r.gzindex<r.gzhead.name.length?r.gzhead.name.charCodeAt(r.gzindex++)&255:0,H(r,a)}while(a!==0);r.gzhead.hcrc&&r.pending>i&&(e.adler=Ks(e.adler,r.pending_buf,r.pending-i,i)),a===0&&(r.gzindex=0,r.status=hl)}else r.status=hl;if(r.status===hl)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=Ks(e.adler,r.pending_buf,r.pending-i,i)),El(e),i=r.pending,r.pending===r.pending_buf_size)){a=1;break}a=r.gzindex<r.gzhead.comment.length?r.gzhead.comment.charCodeAt(r.gzindex++)&255:0,H(r,a)}while(a!==0);r.gzhead.hcrc&&r.pending>i&&(e.adler=Ks(e.adler,r.pending_buf,r.pending-i,i)),a===0&&(r.status=gl)}else r.status=gl;if(r.status===gl&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&El(e),r.pending+2<=r.pending_buf_size&&(H(r,e.adler&255),H(r,e.adler>>8&255),e.adler=0,r.status=_l)):r.status=_l),r.pending!==0){if(El(e),e.avail_out===0)return r.last_flush=-1,ds}else if(e.avail_in===0&&wl(t)<=wl(n)&&t!==ls)return Cl(e,hs);if(r.status===vl&&e.avail_in!==0)return Cl(e,hs);if(e.avail_in!==0||r.lookahead!==0||t!==as&&r.status!==vl){var c=r.strategy===vs?Il(r,t):r.strategy===ys?Fl(r,t):Rl()[r.level].func(r,t);if((c===bl||c===xl)&&(r.status=vl),c===V||c===bl)return e.avail_out===0&&(r.last_flush=-1),ds;if(c===yl&&(t===os?el(r):t!==us&&($c(r,0,0,!1),t===cs&&(Tl(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),El(e),e.avail_out===0))return r.last_flush=-1,ds}return t===ls?r.wrap<=0?fs:(r.wrap===2?(H(r,e.adler&255),H(r,e.adler>>8&255),H(r,e.adler>>16&255),H(r,e.adler>>24&255),H(r,e.total_in&255),H(r,e.total_in>>8&255),H(r,e.total_in>>16&255),H(r,e.total_in>>24&255)):(Ol(r,e.adler>>>16),Ol(r,e.adler&65535)),El(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending===0?fs:ds):ds}function Kl(e){var t;return!e||!e.state?ps:(t=e.state.status,t!==fl&&t!==pl&&t!==ml&&t!==hl&&t!==gl&&t!==_l&&t!==vl?Cl(e,ps):(e.state=null,t===_l?Cl(e,ms):ds))}function ql(e,t){var n=t.length,r,i,a,o,s,c,l,u;if(!e||!e.state||(r=e.state,o=r.wrap,o===2||o===1&&r.status!==fl||r.lookahead))return ps;for(o===1&&(e.adler=Us(e.adler,t,n,0)),r.wrap=0,n>=r.w_size&&(o===0&&(Tl(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=Ps(r.w_size),Ms(u,t,n-r.w_size,r.w_size,0),t=u,n=r.w_size),s=e.avail_in,c=e.next_in,l=e.input,e.avail_in=n,e.next_in=0,e.input=t,jl(r);r.lookahead>=B;){i=r.strstart,a=r.lookahead-(B-1);do r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+B-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++;while(--a);r.strstart=i,r.lookahead=B-1,jl(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=B-1,r.match_available=0,e.next_in=c,e.input=l,e.avail_in=s,r.wrap=o,ds}var Jl=Object.prototype.toString,Yl=class{constructor(e){this.options=Ds({level:gs,method:Ts,chunkSize:16384,windowBits:15,memLevel:8,strategy:xs,to:``},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg=``,this.ended=!1,this.chunks=[],this.strm=new Js,this.strm.avail_out=0;var n=Wl(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==ds)throw Error(qs[n]);if(t.header&&Ul(this.strm,t.header),t.dictionary){var r=typeof t.dictionary==`string`?Bs(t.dictionary):Jl.call(t.dictionary)===`[object ArrayBuffer]`?new Uint8Array(t.dictionary):t.dictionary;if(n=ql(this.strm,r),n!==ds)throw Error(qs[n]);this._dict_set=!0}}push(e,t){var n=this.strm,r=this.options.chunkSize,i,a;if(this.ended)return!1;a=t===~~t?t:t===!0?ls:as,typeof e==`string`?n.input=Bs(e):Jl.call(e)===`[object ArrayBuffer]`?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(n.avail_out===0&&(n.output=Ps(r),n.next_out=0,n.avail_out=r),i=Gl(n,a),i!==fs&&i!==ds)return this.onEnd(i),this.ended=!0,!1;(n.avail_out===0||n.avail_in===0&&(a===ls||a===ss))&&(this.options.to===`string`?this.onData(Hs(Os(n.output,n.next_out))):this.onData(Os(n.output,n.next_out)))}while((n.avail_in>0||n.avail_out===0)&&i!==fs);return a===ls?(i=Kl(this.strm),this.onEnd(i),this.ended=!0,i===ds):a===ss?(this.onEnd(ds),n.avail_out=0,!0):!0}onData(e){this.chunks.push(e)}onEnd(e){e===ds&&(this.options.to===`string`?this.result=this.chunks.join(``):this.result=Ns(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg}};Qt.browser;function Xl(e,t,n){for(;e.length<t;)e=n+e;return e}function Zl(e,t){return Xl(String(e),t,`0`)}function Ql(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var $l=Array.isArray||function(e){return e instanceof Array},eu=class{beforeRender(){}},tu=class extends eu{static get(e){return nu(e)}constructor(e){super(),this.name=e}render(e){e(`/`+this.escape())}escape(){return this.name.replace(/[^\x21-\x7E]/g,function(e){return`#`+Zl(e.charCodeAt(0).toString(16),2)})}toString(){return this.name}};function nu(e){return new tu(e)}function ru(e){return e.map(function(e){return $l(e)?ru(e):typeof e==`number`?(Math.round(e*1e3)/1e3).toFixed(3):e}).join(` `)}function iu(e){return e.replace(/^\s*(['"])(.*)\1\s*$/,`$2`)}function au(e){var t=/^\s*((normal|italic)\s+)?(([a-z0-9-]+)\s+)?((normal|bold|\d+)\s+)?(([0-9.]+)(px|pt))(\/(([0-9.]+)(px|pt)|normal))?\s+(.*?)\s*$/i.exec(e);if(!t)return{fontSize:12,fontFamily:`sans-serif`};var n=t[8]?parseInt(t[8],10):12;return{italic:t[2]&&t[2].toLowerCase()==`italic`,variant:t[4],bold:t[6]&&/bold|700/i.test(t[6]),fontSize:n,lineHeight:t[12]?t[12]==`normal`?n:parseInt(t[12],10):null,fontFamily:t[14].split(/\s*,\s*/g).map(iu)}}function ou(e){function t(t){return e.bold&&(t+=`|bold`),e.italic&&(t+=`|italic`),t.toLowerCase()}var n=e.fontFamily,r,i;if(n instanceof Array)for(var a=0;a<n.length&&(r=t(n[a]),i=U[r],!i);++a);else i=U[n.toLowerCase()];for(;typeof i==`function`;)i=i();return i||=`Times-Roman`,i}var U={serif:`Times-Roman`,"serif|bold":`Times-Bold`,"serif|italic":`Times-Italic`,"serif|bold|italic":`Times-BoldItalic`,"sans-serif":`Helvetica`,"sans-serif|bold":`Helvetica-Bold`,"sans-serif|italic":`Helvetica-Oblique`,"sans-serif|bold|italic":`Helvetica-BoldOblique`,monospace:`Courier`,"monospace|bold":`Courier-Bold`,"monospace|italic":`Courier-Oblique`,"monospace|bold|italic":`Courier-BoldOblique`,zapfdingbats:`ZapfDingbats`,"zapfdingbats|bold":`ZapfDingbats`,"zapfdingbats|italic":`ZapfDingbats`,"zapfdingbats|bold|italic":`ZapfDingbats`};function su(e,t){e=e.toLowerCase(),U[e]=function(){return U[t]},U[e+`|bold`]=function(){return U[t+`|bold`]},U[e+`|italic`]=function(){return U[t+`|italic`]},U[e+`|bold|italic`]=function(){return U[t+`|bold|italic`]}}su(`Times New Roman`,`serif`),su(`Courier New`,`monospace`),su(`Arial`,`sans-serif`),su(`Helvetica`,`sans-serif`),su(`Verdana`,`sans-serif`),su(`Tahoma`,`sans-serif`),su(`Georgia`,`sans-serif`),su(`Monaco`,`monospace`),su(`Andale Mono`,`monospace`);function cu(e,t){if(arguments.length==1)for(var n in e)Ql(e,n)&&cu(n,e[n]);else switch(e=e.toLowerCase(),U[e]=t,e){case`dejavu sans`:U[`sans-serif`]=t;break;case`dejavu sans|bold`:U[`sans-serif|bold`]=t;break;case`dejavu sans|italic`:U[`sans-serif|italic`]=t;break;case`dejavu sans|bold|italic`:U[`sans-serif|bold|italic`]=t;break;case`dejavu serif`:U.serif=t;break;case`dejavu serif|bold`:U[`serif|bold`]=t;break;case`dejavu serif|italic`:U[`serif|italic`]=t;break;case`dejavu serif|bold|italic`:U[`serif|bold|italic`]=t;break;case`dejavu mono`:U.monospace=t;break;case`dejavu mono|bold`:U[`monospace|bold`]=t;break;case`dejavu mono|italic`:U[`monospace|italic`]=t;break;case`dejavu mono|bold|italic`:U[`monospace|bold|italic`]=t;break}}let lu={fill:0,stroke:1,fillAndStroke:2,invisible:3,fillAndClip:4,strokeAndClip:5,fillStrokeClip:6,clip:7},uu={dash:[4],dashDot:[4,2,1,2],dot:[1,2],longDash:[8,2],longDashDot:[8,2,1,2],longDashDotDot:[8,2,1,2,1,2],solid:[]},du={butt:0,round:1,square:2},fu={miter:0,round:1,bevel:2};function pu(e,t){var n=e[t.nodeType];return n?n.call.apply(n,arguments):t}function mu(e,t,n){e.options._pdfDebug&&t.comment(`BEGIN: `+e.options._pdfDebug);var r=e.transform(),i=e.opacity();if(t.save(),i!=null&&i<1&&t.setOpacity(i),hu(e,t,n),gu(e,t,n),r){var a=r.matrix();t.transform(a.a,a.b,a.c,a.d,a.e,a.f)}_u(e,t,n),pu({Path:wu,MultiPath:Tu,Circle:Eu,Arc:Du,Text:Ou,Image:ju,Group:Au,Rect:Mu},e,t,n),t.restore(),e.options._pdfDebug&&t.comment(`END: `+e.options._pdfDebug)}function hu(e,t){var n=e.stroke&&e.stroke();if(n){var r=n.color;if(r){if(r=Nu(r),r==null)return;t.setStrokeColor(r.r,r.g,r.b),r.a!=1&&t.setStrokeOpacity(r.a)}var i=n.width;if(i!=null){if(i===0)return;t.setLineWidth(i)}var a=n.dashType;a&&t.setDashPattern(uu[a],0);var o=n.lineCap;o&&t.setLineCap(du[o]);var s=n.lineJoin;s&&t.setLineJoin(fu[s]);var c=n.opacity;c!=null&&t.setStrokeOpacity(c)}}function gu(e,t){var n=e.fill&&e.fill();if(n&&!(n instanceof ja||n instanceof Fa)){var r=n.color;if(r){if(r=Nu(r),r==null)return;t.setFillColor(r.r,r.g,r.b),r.a!=1&&t.setFillOpacity(r.a)}var i=n.opacity;i!=null&&t.setFillOpacity(i)}}function _u(e,t,n){var r=e.clip();r&&(Cu(r,t,n),t.clip())}function vu(e){return e&&(e instanceof ja||e instanceof Fa||e.color&&!/^(none|transparent)$/i.test(e.color)&&(e.width==null||e.width>0)&&(e.opacity==null||e.opacity>0))}function yu(e,t,n,r){var i=e.fill();if(i instanceof ja){r?t.clipStroke():t.clip();var a=i instanceof Pa,o,s;a?(o={x:i.center().x,y:i.center().y,r:0},s={x:i.center().x,y:i.center().y,r:i.radius()}):(o={x:i.start().x,y:i.start().y},s={x:i.end().x,y:i.end().y});var c=i.stops.elements().map(function(e){var t=e.offset();t=/%$/.test(t)?parseFloat(t)/100:parseFloat(t);var n=Nu(e.color());return n.a*=e.opacity(),{offset:t,color:n}});c.unshift(c[0]),c.push(c[c.length-1]);var l={userSpace:i.userSpace(),type:a?`radial`:`linear`,start:o,end:s,stops:c},u=e.rawBBox(),d=u.topLeft(),f=u.getSize();return u={left:d.x,top:d.y,width:f.width,height:f.height},t.gradient(l,u),!0}}function bu(e,t,n,r){let i=e.fill();if(i instanceof Fa){r?t.clipStroke():t.clip();let n=e.rawBBox(),a=n.topLeft(),o=n.getSize(),s=e.stroke()?e.stroke().width:0;return t.pattern(i,{left:a.x+s/2,top:a.y+s/2,width:o.width-s,height:o.height-s},ku),!0}}function xu(e,t,n){vu(e.fill())&&vu(e.stroke())?!yu(e,t,n,!0)&&!bu(e,t,n,!0)&&t.fillStroke():vu(e.fill())?!yu(e,t,n,!1)&&!bu(e,t,n,!1)&&t.fill():vu(e.stroke())?t.stroke():t.nop()}function Su(e,t){var n=e.segments;if(n.length==4&&e.options.closed){for(var r=[],i=0;i<n.length;++i){if(n[i].controlIn())return!1;r[i]=n[i].anchor()}if(r[0].y==r[1].y&&r[1].x==r[2].x&&r[2].y==r[3].y&&r[3].x==r[0].x||r[0].x==r[1].x&&r[1].y==r[2].y&&r[2].x==r[3].x&&r[3].y==r[0].y)return t.rect(r[0].x,r[0].y,r[2].x-r[0].x,r[2].y-r[0].y),!0}}function Cu(e,t,n){var r=e.segments;if(r.length!==0&&!Su(e,t,n)){for(var i,a=0;a<r.length;++a){var o=r[a],s=o.anchor();if(!i)t.moveTo(s.x,s.y);else{var c=i.controlOut(),l=o.controlIn();c&&l?t.bezier(c.x,c.y,l.x,l.y,s.x,s.y):t.lineTo(s.x,s.y)}i=o}e.options.closed&&t.close()}}function wu(e,t,n){Cu(e,t,n),xu(e,t,n)}function Tu(e,t,n){for(var r=e.paths,i=0;i<r.length;++i)Cu(r[i],t,n);xu(e,t,n)}function Eu(e,t,n){var r=e.geometry();t.circle(r.center.x,r.center.y,r.radius),xu(e,t,n)}function Du(e,t,n){var r=e.geometry().curvePoints();t.moveTo(r[0].x,r[0].y);for(var i=1;i<r.length;)t.bezier(r[i].x,r[i++].y,r[i].x,r[i++].y,r[i].x,r[i++].y);xu(e,t,n)}function Ou(e,t){var n=au(e.options.font),r=e._position,i;t.transform(1,0,0,-1,r.x,r.y+n.fontSize);let a=r=>{t.beginText(),t.setFont(ou(n),n.fontSize),t.setTextRenderingMode(r),t.showText(e.content(),e._pdfRect?e._pdfRect.width():null)};e.fill()&&e.stroke()?(i=lu.fillAndStroke,e.options.paintOrder===`stroke`&&(a(lu.stroke),i=lu.fill)):e.fill()?i=lu.fill:e.stroke()&&(i=lu.stroke),a(i),t.endText()}function ku(e,t,n){for(var r=e.children,i=0;i<r.length;++i)mu(r[i],t,n)}function Au(e,t,n){e._pdfLink&&t.addLink(e._pdfLink.url,e._pdfLink);for(var r=e.children,i=0;i<r.length;++i)mu(r[i],t,n)}function ju(e,t){var n=e.src();if(n){var r=e.rect(),i=r.getOrigin(),a=r.getSize();t.transform(a.width,0,0,-a.height,i.x,i.y+a.height),t.drawImage(n)}}function Mu(e,t,n){var r=e.geometry();let[i,a]=r.cornerRadius;i===0&&a===0?(t.rect(r.origin.x,r.origin.y,r.size.width,r.size.height),xu(e,t,n)):wu(R.fromRect(r,e.options),t,n)}function Nu(e){var t=pn(e,!0);return t?t.toRGB():null}let Pu=Qt.browser||{};function Fu(e){return Array.prototype.slice.call(e)}var Iu=`KENDO-PSEUDO-ELEMENT`;let Lu=`data-kendo-bullet-type`;var Ru={},W={};W._root=W;let zu=typeof window<`u`?Pu.msie||Pu.edge:!1;var Bu=class extends ma{constructor(e,t,n){super(e,t.getOrigin(),n),this._pdfRect=t}rect(){return this._pdfRect}rawBBox(){return this._pdfRect}},Vu=typeof Element<`u`&&Element.prototype&&(function(e){return e.matches?function(e,t){return e.matches(t)}:e.webkitMatchesSelector?function(e,t){return e.webkitMatchesSelector(t)}:e.mozMatchesSelector?function(e,t){return e.mozMatchesSelector(t)}:e.msMatchesSelector?function(e,t){return e.msMatchesSelector(t)}:function(e){return[].indexOf.call(document.querySelectorAll(e),this)!==-1}})(Element.prototype);(function(e){return e?function t(n){var r=n.cloneNode(!1);if(n.nodeType==1){var i=e(n),a=e(r),o,s=i.data();for(o in s)a.data(o,s[o]);for(/^canvas$/i.test(n.tagName)?r.getContext(`2d`).drawImage(n,0,0):/^(?:input|select|textarea|option)$/i.test(n.tagName)?(r.removeAttribute(`id`),r.removeAttribute(`name`),/^textarea$/i.test(n.tagName)||(r.value=n.value),r.checked=n.checked,r.selected=n.selected):/^img$/i.test(n.tagName)&&r.removeAttribute(`loading`),n._kendoExportVisual&&(r._kendoExportVisual=n._kendoExportVisual),o=n.firstChild;o;o=o.nextSibling)r.appendChild(t(o))}return r}:function(e){let t=(function e(t){let n=t.cloneNode(!1);t._kendoExportVisual&&(n._kendoExportVisual=t._kendoExportVisual);for(let r=t.firstChild;r;r=r.nextSibling)n.appendChild(e(r));return n})(e),n=e.querySelectorAll(`canvas`);n.length&&Fu(t.querySelectorAll(`canvas`)).forEach((e,t)=>{e.getContext(`2d`).drawImage(n[t],0,0)});let r=e.querySelectorAll(`input, select, textarea, option`);return Fu(t.querySelectorAll(`input, select, textarea, option`)).forEach((e,t)=>{e.removeAttribute(`id`),e.removeAttribute(`name`),/^textarea$/i.test(e.tagName)||(e.value=r[t].value),e.checked=r[t].checked,e.selected=r[t].selected}),Fu(t.querySelectorAll(`img`)).forEach(e=>{e.removeAttribute(`loading`)}),t}})(typeof window<`u`&&window.kendo&&window.kendo.jQuery);var Hu=(function(){var e=/^((-webkit-|-moz-|-o-|-ms-)?linear-gradient\s*)\(/,t=/^([-0-9.]+%)/,n=/^([-0-9.]+px)/,r=/^(left|right|top|bottom|to|center)\W/,i=/^([-0-9.]+(deg|grad|rad|turn)|0)/,a=/^(\s+)/,o=/^(\()/,s=/^(\))/,c=/^(,)/,l=/^(url)\(/,u=/^(.*?)\)/,d={},f={};function p(f){var p=f;if(Gu(d,p))return d[p];function m(){var e=a.exec(f);e&&(f=f.substr(e[1].length))}function h(e){m();var t=e.exec(f);if(t)return f=f.substr(t[1].length),t[1]}function g(){var e=pn(f,!0),r,i;if(e){let a=/^#[0-9a-f]+/i.exec(f)||/^rgba?\(.*?\)/i.exec(f)||/^..*?\b/.exec(f);return f=f.substr(a[0].length),e=e.toRGB(),(r=h(n))||(i=h(t)),{color:e,length:r,percent:i}}}function _(e){var n,a,l,u=[],d=!1;if(h(o)){if(n=h(i),n==`0`&&(n=`0deg`),n?(n=md(n),h(c)):(a=h(r),a==`to`?a=h(r):a&&/^-/.test(e)&&(d=!0),l=h(r),h(c)),/-moz-/.test(e)&&n==null&&a==null){var p=h(t),m=h(t);d=!0,p==`0%`?a=`left`:p==`100%`&&(a=`right`),m==`0%`?l=`top`:m==`100%`&&(l=`bottom`),h(c)}for(;f&&!h(s);){var _=g();if(!_)break;u.push(_),h(c)}return{type:`linear`,angle:n,to:a&&l?a+` `+l:a||l||null,stops:u,reverse:d}}}function v(){if(h(o)){var e=h(u);return e=e.replace(/^['"]+|["']+$/g,``),h(s),{type:`url`,url:e}}}var y;return(y=h(e))?y=_(y):(y=h(l))&&(y=v()),d[p]=y||{type:`none`}}return function(e){return Gu(f,e)?f[e]:f[e]=Uu(e).map(p)}})(),Uu=(function(){var e={};return function(t,n){n||=/^\s*,\s*/;var r=t+n;if(Gu(e,r))return e[r];var i=[],a=0,o=0,s=0,c=!1,l;function u(e){return l=e.exec(t.substr(o))}function d(e){return e.replace(/^\s+|\s+$/g,``)}for(;o<t.length;)!c&&u(/^[\(\[\{]/)?(s++,o++):!c&&u(/^[\)\]\}]/)?(s--,o++):!c&&u(/^[\"\']/)?(c=l[0],o++):c==`'`&&u(/^\\\'/)||c==`"`&&u(/^\\\"/)?o+=2:c==`'`&&u(/^\'/)||c==`"`&&u(/^\"/)?(c=!1,o++):u(n)?(!c&&!s&&o>a&&(i.push(d(t.substring(a,o))),a=o+l[0].length),o+=l[0].length):o++;return a<o&&i.push(d(t.substring(a,o))),e[r]=i}})();(function(e){return function(t){var n=e[t];if(!n){var r;((r=/url\((['"]?)([^'")]*?)\1\)\s+format\((['"]?)truetype\3\)/.exec(t))||(r=/url\((['"]?)([^'")]*?\.ttf)\1\)/.exec(t)))&&(n=e[t]=r[2])}return n}})(Object.create(null));var Wu=(function(e){return function(t){var n=e[t];return n??=e[t]=gr(`Mapq`,{font:t}).height,n}})(Object.create(null));function Gu(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ku(e){return e=`_counter_`+e,W[e]}function qu(e){var t=[],n=W;for(e=`_counter_`+e;n;)Gu(n,e)&&t.push(n[e]),n=Object.getPrototypeOf(n);return t.reverse()}function Ju(e,t){var n=W;for(e=`_counter_`+e;n&&!Gu(n,e);)n=Object.getPrototypeOf(n);n||=W._root,n[e]=(n[e]||0)+(t??1)}function Yu(e,t){e=`_counter_`+e,W[e]=t??0}function Xu(e,t,n){for(var r=0;r<e.length;){var i=e[r++],a=parseFloat(e[r]);isNaN(a)?t(i,n):(t(i,a),++r)}}function Zu(e){var t=G(e,`counter-reset`);t&&Xu(Uu(t,/^\s+/),Yu,0);var n=G(e,`counter-increment`);n&&Xu(Uu(n,/^\s+/),Ju,1)}function Qu(e,t){var n=pn(e,!0);return n&&(n=n.toRGB(),t?n=n.toCssRgba():n.a===0&&(n=null)),n}function $u(e){var t=``;do{var n=e%26;t=String.fromCharCode(97+n)+t,e=Math.floor(e/26)}while(e>0);return t}function ed(e,t,n){W=Object.create(W),W[e.tagName.toLowerCase()]={element:e,style:t};let r=G(t,`text-decoration`);if(r&&r!=`none`){let e=G(t,`text-decoration-color`);r.split(/\s+/g).forEach(function(n){if(!W[n]&&(W[n]=e,n==`underline`)){let e=G(t,`text-underline-offset`);e!=`auto`&&(W[`underline-offset`]=parseFloat(e))}})}id(t)&&(W._stackingContext={element:e,group:n})}function td(){W=Object.getPrototypeOf(W)}function nd(e){if(W._clipbox!=null){var t=e.bbox(W._matrix);W._clipbox?W._clipbox=L.intersect(W._clipbox,t):W._clipbox=t}}function rd(){var e=W._clipbox;if(e==null)return!0;if(e)return e.width()===0||e.height()===0}function id(e){function t(t){return G(e,t)}if(t(`transform`)!=`none`||t(`position`)!=`static`||t(`z-index`)!=`auto`||t(`opacity`)<1)return!0}function ad(e,t){return window.getComputedStyle(e,t||null)}function G(e,t,n){var r=e.getPropertyValue(t);return(r==null||r===``)&&(Pu.webkit?r=e.getPropertyValue(`-webkit-`+t):Pu.mozilla?r=e.getPropertyValue(`-moz-`+t):Pu.opera?r=e.getPropertyValue(`-o-`+t):zu&&(r=e.getPropertyValue(`-ms-`+t))),arguments.length>2&&(r==null||r===``)?n:r}function od(e,t,n,r){e.setProperty(t,n,r),Pu.webkit?e.setProperty(`-webkit-`+t,n,r):Pu.mozilla?e.setProperty(`-moz-`+t,n,r):Pu.opera?e.setProperty(`-o-`+t,n,r):zu&&(e.setProperty(`-ms-`+t,n,r),t=`ms`+t.replace(/(^|-)([a-z])/g,function(e,t,n){return t+n.toUpperCase()}),e[t]=n)}function sd(e,t){return t=`border-`+t,{width:parseFloat(G(e,t+`-width`)),style:G(e,t+`-style`),color:Qu(G(e,t+`-color`),!0)}}function cd(e,t){var n=e.style.cssText,r=t();return Ir(e,n),r}function ld(e,t){var n=G(e,`border-`+t+`-radius`).split(/\s+/g).map(parseFloat);return n.length==1&&n.push(n[0]),vd({x:n[0],y:n[1]})}function ud(e){var t=e.getBoundingClientRect();return t=dd(t,`border-*-width`,e),t=dd(t,`padding-*`,e),t}function dd(e,t,n){var r,i,a,o,s;return typeof t==`string`?(r=ad(n),i=parseFloat(G(r,t.replace(`*`,`top`))),a=parseFloat(G(r,t.replace(`*`,`right`))),o=parseFloat(G(r,t.replace(`*`,`bottom`))),s=parseFloat(G(r,t.replace(`*`,`left`)))):typeof t==`number`&&(i=a=o=s=t),{top:e.top+i,right:e.right-a,bottom:e.bottom-o,left:e.left+s,width:e.right-e.left-a-s,height:e.bottom-e.top-o-i}}function fd(e){var t=G(e,`transform`);if(t==`none`)return null;var n=/^\s*matrix\(\s*(.*?)\s*\)\s*$/.exec(t);if(n){var r=G(e,`transform-origin`);return n=n[1].split(/\s*,\s*/g).map(parseFloat),r=r.split(/\s+/g).map(parseFloat),{matrix:n,origin:r}}}function pd(e){return 180*e/Math.PI%360}function md(e){var t=parseFloat(e);if(/grad$/.test(e))return Math.PI*t/200;if(/rad$/.test(e))return t;if(/turn$/.test(e))return Math.PI*t*2;if(/deg$/.test(e))return Math.PI*t/180}function hd(e,t){return t=new tr(t[0],t[1],t[2],t[3],t[4],t[5]),e.transform(t),t}function gd(e,t){e.clip(t)}function _d(e,t,n,r){for(var i=new hi([t,n],r).curvePoints(),a=1;a<i.length;)e.curveTo(i[a++],i[a++],i[a++])}function vd(e){return(e.x<=0||e.y<=0)&&(e.x=e.y=0),e}function yd(e,t,n,r,i){var a=Math.max(0,t.x),o=Math.max(0,t.y),s=Math.max(0,n.x),c=Math.max(0,n.y),l=Math.max(0,r.x),u=Math.max(0,r.y),d=Math.max(0,i.x),f=Math.max(0,i.y),p=Math.min(e.width/(a+s),e.height/(c+u),e.width/(l+d),e.height/(f+o));return p<1&&(a*=p,o*=p,s*=p,c*=p,l*=p,u*=p,d*=p,f*=p),{tl:{x:a,y:o},tr:{x:s,y:c},br:{x:l,y:u},bl:{x:d,y:f}}}function bd(e,t,n){var r=ad(e),i=ld(r,`top-left`),a=ld(r,`top-right`),o=ld(r,`bottom-left`),s=ld(r,`bottom-right`);if(n==`padding`||n==`content`){var c=sd(r,`top`),l=sd(r,`right`),u=sd(r,`bottom`),d=sd(r,`left`);if(i.x-=d.width,i.y-=c.width,a.x-=l.width,a.y-=c.width,s.x-=l.width,s.y-=u.width,o.x-=d.width,o.y-=u.width,n==`content`){var f=parseFloat(G(r,`padding-top`)),p=parseFloat(G(r,`padding-right`)),m=parseFloat(G(r,`padding-bottom`)),h=parseFloat(G(r,`padding-left`));i.x-=h,i.y-=f,a.x-=p,a.y-=f,s.x-=p,s.y-=m,o.x-=h,o.y-=m}}return typeof n==`number`&&(i.x-=n,i.y-=n,a.x-=n,a.y-=n,s.x-=n,s.y-=n,o.x-=n,o.y-=n),xd(t,i,a,s,o)}function xd(e,t,n,r,i){var a=yd(e,t,n,r,i),o=a.tl,s=a.tr,c=a.br,l=a.bl,u=new R({fill:null,stroke:null});return u.moveTo(e.left,e.top+o.y),o.x&&_d(u,e.left+o.x,e.top+o.y,{startAngle:-180,endAngle:-90,radiusX:o.x,radiusY:o.y}),u.lineTo(e.right-s.x,e.top),s.x&&_d(u,e.right-s.x,e.top+s.y,{startAngle:-90,endAngle:0,radiusX:s.x,radiusY:s.y}),u.lineTo(e.right,e.bottom-c.y),c.x&&_d(u,e.right-c.x,e.bottom-c.y,{startAngle:0,endAngle:90,radiusX:c.x,radiusY:c.y}),u.lineTo(e.left+l.x,e.bottom),l.x&&_d(u,e.left+l.x,e.bottom-l.y,{startAngle:90,endAngle:180,radiusX:l.x,radiusY:l.y}),u.close()}function Sd(e,t){var n=String(parseFloat(e));switch(t){case`decimal-leading-zero`:return n.length<2&&(n=`0`+n),n;case`lower-roman`:return Tn(e).toLowerCase();case`upper-roman`:return Tn(e).toUpperCase();case`lower-latin`:case`lower-alpha`:return $u(e-1);case`upper-latin`:case`upper-alpha`:return $u(e-1).toUpperCase();default:return n}}function Cd(e,t){function n(e,t,n){return n?(n=n.replace(/^\s*(["'])(.*)\1\s*$/,`$2`),qu(e).map(function(e){return Sd(e,t)}).join(n)):Sd(Ku(e)||0,t)}var r=Uu(t,/^\s+/),i=[],a;return r.forEach(function(t){var r;(a=/^\s*(["'])(.*)\1\s*$/.exec(t))?i.push(a[2].replace(/\\([0-9a-f]{4})/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})):(a=/^\s*counter\((.*?)\)\s*$/.exec(t))?(r=Uu(a[1]),i.push(n(r[0],r[1]))):(a=/^\s*counters\((.*?)\)\s*$/.exec(t))?(r=Uu(a[1]),i.push(n(r[0],r[2],r[1]))):(a=/^\s*attr\((.*?)\)\s*$/.exec(t))?i.push(e.getAttribute(a[1])||``):i.push(t)}),i.join(``)}function wd(e){if(e.cssText)return e.cssText;for(var t=[],n=0;n<e.length;++n)t.push(e[n]+`: `+G(e,e[n]));return t.join(`;
`)}function Td(e,t){if(e.tagName==Iu){Ed(e,t);return}let n=[];function r(t,r){let i=ad(e,t),a=i.content;if(Zu(i),a&&a!=`normal`&&a!=`none`&&i.width!=`0px`){let t=e.ownerDocument.createElement(Iu);Ir(t,wd(i)),t.textContent=Cd(e,a),e.insertBefore(t,r),n.push(t)}}if(r(`:before`,e.firstChild),r(`:after`,null),n.length>0){let r=e.className;e.className+=` kendo-pdf-hide-pseudo-elements`,Ed(e,t),e.className=r,n.forEach(function(t){e.removeChild(t)})}else Ed(e,t)}function Ed(e,t){var n=ad(e),r=sd(n,`top`),i=sd(n,`right`),a=sd(n,`bottom`),o=sd(n,`left`),s=ld(n,`top-left`),c=ld(n,`top-right`),l=ld(n,`bottom-left`),u=ld(n,`bottom-right`),d=G(n,`direction`),f=G(n,`background-color`);f=Qu(f);var p=Hu(G(n,`background-image`)),m=Uu(G(n,`background-repeat`)),h=Uu(G(n,`background-position`)),g=Uu(G(n,`background-origin`)),_=Uu(G(n,`background-size`)),v,y;zu&&(v=n.textOverflow,v==`ellipsis`&&(y=e.style.textOverflow,e.style.textOverflow=`clip`)),Pu.msie&&Pu.version<10&&(h=Uu(e.currentStyle.backgroundPosition));var b=dd(e.getBoundingClientRect(),`border-*-width`,e);(function(){var e=G(n,`clip`),r=/^\s*rect\((.*)\)\s*$/.exec(e);if(r){var i=r[1].split(/[ ,]+/g),a=i[0]==`auto`?b.top:parseFloat(i[0])+b.top,o=i[1]==`auto`?b.right:parseFloat(i[1])+b.left,s=i[2]==`auto`?b.bottom:parseFloat(i[2])+b.top,c=i[3]==`auto`?b.left:parseFloat(i[3])+b.left,l=new z,u=new R().moveTo(c,a).lineTo(o,a).lineTo(o,s).lineTo(c,s).close();gd(l,u),t.append(l),t=l,nd(u)}})();var x,S,C,ee=G(n,`display`);if(ee==`table-row`)for(x=[],S=0,C=e.children;S<C.length;++S)x.push(C[S].getBoundingClientRect());else x=e.getClientRects(),x.length==1&&(x=[e.getBoundingClientRect()]);for(x=te(x),S=0;S<x.length;++S)re(x[S],S===0,S==x.length-1);if(e.tagName==`A`&&e.href&&!/^#?$/.test(e.getAttribute(`href`))&&(!W._avoidLinks||!Vu(e,W._avoidLinks))){let n=document.createRange();n.selectNodeContents(e),Fu(n.getClientRects()).forEach(function(n){let r=new z;r._pdfLink={url:e.href,top:n.top,right:n.right,bottom:n.bottom,left:n.left},t.append(r)})}return x.length>0&&ee==`list-item`&&!e.getAttribute(`kendo-no-bullet`)&&ne(x[0]),(function(){function r(){var n=bd(e,b,`padding`),r=new z;gd(r,n),t.append(r),t=r,nd(n)}(Md(e)||/^(hidden|auto|scroll)/.test(G(n,`overflow`))||/^(hidden|auto|scroll)/.test(G(n,`overflow-x`))||/^(hidden|auto|scroll)/.test(G(n,`overflow-y`)))&&r()})(),!Od(e,t)&&!kd(e,t)&&Ld(e,t),zu&&v==`ellipsis`&&(e.style.textOverflow=y),t;function te(t){if(/^td$/i.test(e.tagName)){var n=W.table;if(n&&G(n.style,`border-collapse`)==`collapse`){var r=sd(n.style,`left`).width,i=sd(n.style,`top`).width;if(r===0&&i===0)return t;var a=n.element.getBoundingClientRect(),o=n.element.rows[0].cells[0].getBoundingClientRect();if(o.top==a.top||o.left==a.left)return Fu(t).map(function(e){return{left:e.left+r,top:e.top+i,right:e.right+r,bottom:e.bottom+i,height:e.height,width:e.width}})}}return t}function w(e,n,r,i,a,o,s,c){if(r<=0)return;var l,u=new z;hd(u,c),t.append(u),vd(o),vd(s),l=new R({fill:{color:e},stroke:null}),u.append(l),l.moveTo(o.x?Math.max(o.x,i):0,0).lineTo(n-(s.x?Math.max(s.x,a):0),0).lineTo(n-Math.max(s.x,a),r).lineTo(Math.max(o.x,i),r).close(),o.x&&d(i,o,[-1,0,0,1,o.x,0]),s.x&&d(a,s,[1,0,0,1,n-s.x,0]);function d(t,n,i){var a=Math.PI/2*t/(t+r),o={x:n.x-t,y:n.y-r},s=new R({fill:{color:e},stroke:null}).moveTo(0,0);hd(s,i),_d(s,0,n.y,{startAngle:-90,endAngle:-pd(a),radiusX:n.x,radiusY:n.y}),o.x>0&&o.y>0?(s.lineTo(o.x*Math.cos(a),n.y-o.y*Math.sin(a)),_d(s,0,n.y,{startAngle:-pd(a),endAngle:-90,radiusX:o.x,radiusY:o.y,anticlockwise:!0})):o.x>0?s.lineTo(o.x,r).lineTo(0,r):s.lineTo(o.x,r).lineTo(o.x,0),u.append(s.close())}}function T(e){var n=new z;if(gd(n,xd(e,s,c,u,l)),t.append(n),f){var r=new R({fill:{color:f.toCssRgba()},stroke:null});r.moveTo(e.left,e.top).lineTo(e.right,e.top).lineTo(e.right,e.bottom).lineTo(e.left,e.bottom).close(),n.append(r)}for(var i=p.length;--i>=0;)E(n,e,p[i],m[i%m.length],h[i%h.length],g[i%g.length],_[i%_.length])}function E(t,n,r,i,a,o,s){if(!r||r==`none`)return;if(r.type==`url`){var c=Ru[r.url];c&&c.width>0&&c.height>0&&l(t,n,c.width,c.height,function(e,t){e.append(new ha(r.url,t))})}else if(r.type==`linear`)l(t,n,n.width,n.height,Dd(r));else return;function l(t,n,r,c,l){var u=r/c,d,f=n;if(o==`content-box`?(f=dd(f,`border-*-width`,e),f=dd(f,`padding-*`,e)):o==`padding-box`&&(f=dd(f,`border-*-width`,e)),!/^\s*auto(\s+auto)?\s*$/.test(s))if(s==`contain`)d=Math.min(f.width/r,f.height/c),r*=d,c*=d;else if(s==`cover`)d=Math.max(f.width/r,f.height/c),r*=d,c*=d;else{var p=s.split(/\s+/g);r=/%$/.test(p[0])?f.width*parseFloat(p[0])/100:parseFloat(p[0]),c=p.length==1||p[1]==`auto`?r/u:/%$/.test(p[1])?f.height*parseFloat(p[1])/100:parseFloat(p[1])}var m=String(a);switch(m){case`bottom`:m=`50% 100%`;break;case`top`:m=`50% 0`;break;case`left`:m=`0 50%`;break;case`right`:m=`100% 50%`;break;case`center`:m=`50% 50%`;break}m=m.split(/\s+/),m.length==1&&(m[1]=`50%`),/%$/.test(m[0])?m[0]=parseFloat(m[0])/100*(f.width-r):m[0]=parseFloat(m[0]),/%$/.test(m[1])?m[1]=parseFloat(m[1])/100*(f.height-c):m[1]=parseFloat(m[1]);var h=new L([f.left+m[0],f.top+m[1]],[r,c]);function g(){for(;h.origin.x>n.left;)h.origin.x-=r}function _(){for(;h.origin.y>n.top;)h.origin.y-=c}function v(){for(;h.origin.x<n.right;)l(t,h.clone()),h.origin.x+=r}if(i==`no-repeat`)l(t,h);else if(i==`repeat-x`)g(),v();else if(i==`repeat-y`)for(_();h.origin.y<n.bottom;)l(t,h.clone()),h.origin.y+=c;else if(i==`repeat`){g(),_();for(var y=h.origin.clone();h.origin.y<n.bottom;)h.origin.x=y.x,v(),h.origin.y+=c}}}function ne(){var r=G(n,`list-style-type`);if(r==`none`)return;var i=G(n,`list-style-position`);function a(n){cd(e,function(){e.style.position=`relative`;var r=e.ownerDocument.createElement(Iu);r.style.position=`absolute`,r.style.boxSizing=`border-box`,i==`outside`?(r.style.width=`6em`,r.style.left=`-6.8em`,r.style.textAlign=`right`):r.style.left=`0px`,n(r),e.insertBefore(r,e.firstChild),Bd(r,t),e.removeChild(r)})}function o(t){var n=e.parentNode.children,r=e.getAttribute(`kendo-split-index`);if(r!=null)return t(r|0,n.length);for(var i=0;i<n.length;++i)if(n[i]===e)return t(i,n.length)}switch(r){case`circle`:case`disc`:case`square`:a(function(e){e.innerHTML=`&nbsp;`,e.setAttribute(Lu,r)});break;case`decimal`:case`decimal-leading-zero`:a(function(e){o(function(t){++t,r==`decimal-leading-zero`&&t<10&&(t=`0`+t),e.innerHTML=t+`.`})});break;case`lower-roman`:case`upper-roman`:a(function(e){o(function(t){t=Tn(t+1),r==`upper-roman`&&(t=t.toUpperCase()),e.innerHTML=t+`.`})});break;case`lower-latin`:case`lower-alpha`:case`upper-latin`:case`upper-alpha`:a(function(e){o(function(t){t=$u(t),/^upper/i.test(r)&&(t=t.toUpperCase()),e.innerHTML=t+`.`})});break}}function re(n,f,p){if(n.width===0||n.height===0)return;T(n);var m=o.width>0&&(f&&d==`ltr`||p&&d==`rtl`),h=i.width>0&&(p&&d==`ltr`||f&&d==`rtl`);if(r.width===0&&o.width===0&&i.width===0&&a.width===0)return;if(r.color==i.color&&r.color==a.color&&r.color==o.color&&r.width==i.width&&r.width==a.width&&r.width==o.width&&m&&h){n=dd(n,r.width/2);var g=bd(e,n,r.width/2);g.options.stroke={color:r.color,width:r.width},t.append(g);return}if(s.x===0&&c.x===0&&u.x===0&&l.x===0&&r.width<2&&o.width<2&&i.width<2&&a.width<2){r.width>0&&t.append(new R({stroke:{width:r.width,color:r.color}}).moveTo(n.left,n.top+r.width/2).lineTo(n.right,n.top+r.width/2)),a.width>0&&t.append(new R({stroke:{width:a.width,color:a.color}}).moveTo(n.left,n.bottom-a.width/2).lineTo(n.right,n.bottom-a.width/2)),m&&t.append(new R({stroke:{width:o.width,color:o.color}}).moveTo(n.left+o.width/2,n.top).lineTo(n.left+o.width/2,n.bottom)),h&&t.append(new R({stroke:{width:i.width,color:i.color}}).moveTo(n.right-i.width/2,n.top).lineTo(n.right-i.width/2,n.bottom));return}var _=yd(n,s,c,u,l),v=_.tl,y=_.tr,b=_.br,x=_.bl;w(r.color,n.width,r.width,o.width,i.width,v,y,[1,0,0,1,n.left,n.top]),w(a.color,n.width,a.width,i.width,o.width,b,x,[-1,0,0,-1,n.right,n.bottom]);function S(e){return{x:e.y,y:e.x}}w(o.color,n.height,o.width,a.width,r.width,S(x),S(v),[0,-1,1,0,n.left,n.bottom]),w(i.color,n.height,i.width,r.width,a.width,S(y),S(b),[0,1,-1,0,n.right,n.top])}}function Dd(e){return function(t,n){var r=n.width(),i=n.height();switch(e.type){case`linear`:var a=e.angle==null?Math.PI:e.angle;switch(e.to){case`top`:a=0;break;case`left`:a=-Math.PI/2;break;case`bottom`:a=Math.PI;break;case`right`:a=Math.PI/2;break;case`top left`:case`left top`:a=-Math.atan2(i,r);break;case`top right`:case`right top`:a=Math.atan2(i,r);break;case`bottom left`:case`left bottom`:a=Math.PI+Math.atan2(i,r);break;case`bottom right`:case`right bottom`:a=Math.PI-Math.atan2(i,r);break}e.reverse&&(a-=Math.PI),a%=2*Math.PI,a<0&&(a+=2*Math.PI);var o=Math.abs(r*Math.sin(a))+Math.abs(i*Math.cos(a)),s=Math.atan(r*Math.tan(a)/i),c=Math.sin(s),l=Math.cos(s),u=Math.abs(c)+Math.abs(l),d=u/2*c,f=u/2*l;a>Math.PI/2&&a<=3*Math.PI/2&&(d=-d,f=-f);var p=[],m=0,h=e.stops.map(function(t,n){var r=t.percent;r?r=parseFloat(r)/100:t.length?r=parseFloat(t.length)/o:n===0?r=0:n==e.stops.length-1&&(r=1);var i={color:t.color.toCssRgba(),offset:r};return r==null?p.push({left:m,stop:i}):(m=r,p.forEach(function(e,t){var n=e.stop;n.offset=e.left+(m-e.left)*(t+1)/(p.length+1)}),p=[]),i}),g=[.5-d,.5+f],_=[.5+d,.5-f];t.append(R.fromRect(n).stroke(null).fill(new Na({start:g,end:_,stops:h,userSpace:!1})));break;case`radial`:window.console&&window.console.log&&window.console.log(`Radial gradients are not yet supported in HTML renderer`);break}}}function Od(e,t){let n=null;if(window.kendo&&window.kendo.jQuery&&e.getAttribute(window.kendo.attr(`role`))){let t=window.kendo.widgetInstance(window.kendo.jQuery(e));t&&(t.exportDOMVisual||t.exportVisual)&&(n=t.exportDOMVisual?t.exportDOMVisual():t.exportVisual())}if(n===null&&e._kendoExportVisual){let t=e.getBoundingClientRect(),r={width:t.width,height:t.height};n=e._kendoExportVisual(r)}if(!n)return!1;let r=new z;r.children.push(n);let i=e.getBoundingClientRect();return r.transform(Wr().translate(i.left,i.top)),t.append(r),!0}function kd(e,t){let n=e.getAttribute(Lu);if(!n)return!1;var r=e.getBoundingClientRect();let i=ad(e).color;if(n===`square`){let e=r.height/5;t.append(new wa(new L([r.right-e,r.top+r.height/2.1],[e,e])).fill(i).stroke(i))}else{let e=r.height/7,a=new ai(new Qr([r.right-e,r.top+(r.height+e)/2],e));n===`circle`?a.stroke(i,.5):a.fill(i).stroke(null),t.append(a)}return!0}function Ad(e,t,n){var r=ud(e),i=new ha(t,new L([r.left,r.top],[r.width,r.height]));gd(i,bd(e,r,`content`)),n.append(i)}function jd(e,t){var n=ad(e),r=ad(t),i=parseFloat(G(n,`z-index`)),a=parseFloat(G(r,`z-index`)),o=G(n,`position`),s=G(r,`position`);return isNaN(i)&&isNaN(a)?/static|absolute/.test(o)&&/static|absolute/.test(s)?0:o==`static`?-1:s==`static`?1:0:isNaN(i)?a===0?0:a>0?-1:1:isNaN(a)?i===0?0:i>0?1:-1:parseFloat(i)-parseFloat(a)}function Md(e){return/^(?:textarea|select|input)$/i.test(e.tagName)}function Nd(e){return e.selectedOptions&&e.selectedOptions.length>0?e.selectedOptions[0]:e.options[e.selectedIndex]}function Pd(e,t){var n=G(ad(e),`color`),r=e.getBoundingClientRect();e.type==`checkbox`?(t.append(R.fromRect(new L([r.left+1,r.top+1],[r.width-2,r.height-2])).stroke(n,1)),e.checked&&t.append(new R().stroke(n,1.2).moveTo(r.left+.22*r.width,r.top+.55*r.height).lineTo(r.left+.45*r.width,r.top+.75*r.height).lineTo(r.left+.78*r.width,r.top+.22*r.width))):(t.append(new ai(new Qr([(r.left+r.right)/2,(r.top+r.bottom)/2],Math.min(r.width-2,r.height-2)/2)).stroke(n,1)),e.checked&&t.append(new ai(new Qr([(r.left+r.right)/2,(r.top+r.bottom)/2],Math.min(r.width-8,r.height-8)/2)).fill(n).stroke(null)))}function Fd(e,t){var n=e.tagName.toLowerCase();if(n==`input`&&(e.type==`checkbox`||e.type==`radio`))return Pd(e,t);var r=e.parentNode,i=e.ownerDocument,a=i.createElement(Iu),o;if(Ir(a,wd(ad(e))),n==`input`&&(a.style.whiteSpace=`pre`),(n==`select`||n==`textarea`)&&(a.style.overflow=`auto`),n==`select`)if(e.multiple)for(var s=0;s<e.options.length;++s)o=i.createElement(Iu),Ir(o,wd(ad(e.options[s]))),o.style.display=`block`,o.textContent=e.options[s].textContent,a.appendChild(o);else o=Nd(e),o&&(a.textContent=o.textContent);else a.textContent=e.value;r.insertBefore(a,e),a.scrollLeft=e.scrollLeft,a.scrollTop=e.scrollTop,e.style.display=`none`,Ld(a,t),e.style.display=``,r.removeChild(a)}function Id(e){let t=new window.XMLSerializer,n=t.serializeToString(e);if(Pu.mozilla&&!(e.getAttribute(`width`)&&e.getAttribute(`height`))){let r=new window.DOMParser().parseFromString(n,`image/svg+xml`).documentElement,i=ud(e);r.setAttribute(`width`,i.width),r.setAttribute(`height`,i.height),n=t.serializeToString(r)}return n}function Ld(e,t){switch(W._stackingContext.element===e&&(W._stackingContext.group=t),e.tagName.toLowerCase()){case`img`:Ad(e,e.src,t);break;case`svg`:Ad(e,`data:image/svg+xml;base64,${In(Id(e))}`,t);break;case`canvas`:try{Ad(e,e.toDataURL(`image/png`),t)}catch{}break;case`textarea`:case`input`:case`select`:Fd(e,t);break;default:for(var n=[],r=[],i=[],a=e.firstChild;a;a=a.nextSibling)switch(a.nodeType){case 3:/\S/.test(a.data)&&Rd(e,a,t);break;case 1:var o=ad(a),s=G(o,`float`);G(o,`position`)==`static`?s==`none`?n.push(a):r.push(a):i.push(a);break}Hn(n,jd).forEach(function(e){Bd(e,t)}),Hn(r,jd).forEach(function(e){Bd(e,t)}),Hn(i,jd).forEach(function(e){Bd(e,t)})}}function Rd(e,t,n){if(rd())return;var r=ad(e);if(parseFloat(G(r,`text-indent`))<-500)return;var i=t.data,a=0,o=i.search(/\S\s*$/)+1;if(!o)return;var s=G(r,`font-size`),c=G(r,`line-height`),l=[G(r,`font-style`),G(r,`font-variant`),G(r,`font-weight`),s,G(r,`font-family`)].join(` `);if(s=parseFloat(s),c=parseFloat(c),s===0||isNaN(s))return;var u=G(r,`color`),d=e.ownerDocument.createRange(),f=G(r,`text-align`)==`justify`,p=G(r,`column-count`,1),m=G(r,`white-space`),h=G(r,`text-transform`),g=e.getBoundingClientRect().width/s*5;g===0&&(g=500);var _=null,v=W.underline,y=W[`line-through`],b=W.overline,x=W[`underline-offset`];for(v&&S(E);!ee(););(y||b)&&S(T);return;function S(e){d.selectNode(t);let n=Fu(d.getClientRects());S=e=>n.forEach(e),S(e)}function C(e){if(zu||Pu.chrome||Pu.safari){for(var t=e.getClientRects(),n={top:1/0,right:-1/0,bottom:-1/0,left:1/0},r=!1,i=0;i<t.length;++i){var a=t[i];a.width<=1||a.bottom===_||(n.left=Math.min(a.left,n.left),n.top=Math.min(a.top,n.top),n.right=Math.max(a.right,n.right),n.bottom=Math.max(a.bottom,n.bottom),r=!0)}return r?(n.width=n.right-n.left,n.height=n.bottom-n.top,n):e.getBoundingClientRect()}return e.getBoundingClientRect()}function ee(){var e=a,n,r=i.substr(a).search(/\S/);if(a+=r,r<0||a>=o)return!0;d.setStart(t,a),d.setEnd(t,a+1),n=C(d);var s=!1;if((f||p>1)&&(r=i.substr(a).search(/\s/),r>=0)){d.setEnd(t,a+r);var c=C(d);c.bottom==n.bottom&&(n=c,s=!0,a+=r)}if(!s){if(r=(function e(r,i,a){d.setEnd(t,i);var o=C(d);return o.bottom!=n.bottom&&r<i?e(r,r+i>>1,i):o.right==n.right?i:(n=o,i<a?e(i,i+a>>1,a):i)})(a,Math.min(o,a+g),o),r==a)return!0;if(a=r,r=d.toString().search(/\s+$/),r===0)return!1;r>0&&(d.setEnd(t,d.startOffset+r),n=C(d))}zu&&(n=d.getClientRects()[0]);var l=d.toString();if(!/^(?:pre|pre-wrap)$/i.test(m))l=l.replace(/\s+/g,` `);else if(/\t/.test(l)){var u=0;for(r=e;r<d.startOffset;++r){var h=i.charCodeAt(r);h==9?u+=8-u%8:h==10||h==13?u=0:u++}for(;(r=l.search(`	`))>=0;){var v=`        `.substr(0,8-(u+r)%8);l=l.substr(0,r)+v+l.substr(r+1)}}s||(_=n.bottom),te(l,n)}function te(e,t){if(zu&&!isNaN(c)){var r=Wu(l),i=(t.top+t.bottom-r)/2;t={top:i,right:t.right,bottom:i+r,left:t.left,height:r,width:t.right-t.left}}switch(h){case`uppercase`:e=e.toUpperCase();break;case`lowercase`:e=e.toLowerCase();break;case`capitalize`:e=e.replace(/(?:^|\s)\S/g,e=>e.toUpperCase());break}var a=new Bu(e,new L([t.left,t.top],[t.width,t.height]),{font:l,fill:{color:u}});n.append(a)}function w(e,t,r,i){if(r){var a=new R({stroke:{width:e,color:r}});i-=e,a.moveTo(t.left,i).lineTo(t.right,i),n.append(a)}}function T(e){let t=s/12;w(t,e,y,e.bottom-e.height/2.7),w(t,e,b,e.top)}function E(e){let t=s/12,n=e.bottom;x==null?n+=t:n+=x,w(t,e,v,n)}}function zd(e,t,n){var r;n==`auto`?(r=t,n=0):(r=W._stackingContext.group,n=parseFloat(n));for(var i=r.children,a=0;a<i.length&&!(i[a]._dom_zIndex!=null&&i[a]._dom_zIndex>n);++a);var o=new z;if(r.insert(a,o),o._dom_zIndex=n,r!==t&&W._clipbox){var s=W._matrix.invert(),c=W._clipbox.transformCopy(s);gd(o,R.fromRect(c))}return o}function Bd(e,t){var n=ad(e);if(Zu(n),!/^(style|script|link|meta|iframe|col|colgroup)$/i.test(e.tagName)&&W._clipbox!=null){var r=parseFloat(G(n,`opacity`)),i=G(n,`visibility`),a=G(n,`display`);if(!(r===0||i==`hidden`||a==`none`)){var o=fd(n),s,c=G(n,`z-index`);(o||r<1)&&c==`auto`&&(c=0),s=zd(e,t,c),r<1&&s.opacity(r*s.opacity()),ed(e,n,s),o?cd(e,function(){od(e.style,`transform`,`none`,`important`),od(e.style,`transition`,`none`,`important`),G(n,`position`)==`static`&&od(e.style,`position`,`relative`,`important`);var t=e.getBoundingClientRect(),r=t.left+o.origin[0],i=t.top+o.origin[1],a=[1,0,0,1,-r,-i];a=Vd(a,o.matrix),a=Vd(a,[1,0,0,1,r,i]),a=hd(s,a),W._matrix=W._matrix.multiplyCopy(a),Td(e,s)}):Td(e,s),td()}}}function Vd(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=t[0],l=t[1],u=t[2],d=t[3],f=t[4],p=t[5];return[n*c+r*u,n*l+r*d,i*c+a*u,i*l+a*d,o*c+s*u+f,o*l+s*d+p]}var Hd=class{constructor(e,t){this.r=e,this.angle=t}},K=class e extends I{constructor(e,t){super(e,t)}clone(){return new e(this.x,this.y)}plus(t){return new e(this.x+t.x,this.y+t.y)}minus(t){return new e(this.x-t.x,this.y-t.y)}offset(t){return new e(this.x-t,this.y-t)}times(t){return new e(this.x*t,this.y*t)}normalize(){return this.length()===0?new e:this.times(1/this.length())}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}toString(){return`(`+this.x+`,`+this.y+`)`}lengthSquared(){return this.x*this.x+this.y*this.y}middleOf(t,n){return new e(n.x-t.x,n.y-t.y).times(.5).plus(t)}toPolar(e){let t=1;e&&(t=180/Math.PI);let n=Math.atan2(Math.abs(this.y),Math.abs(this.x)),r=Math.PI/2,i=this.length();if(this.x===0){if(this.y===0)return new Hd(0,0);if(this.y>0)return new Hd(i,t*r);if(this.y<0)return new Hd(i,t*3*r)}else if(this.x>0){if(this.y===0)return new Hd(i,0);if(this.y>0)return new Hd(i,t*n);if(this.y<0)return new Hd(i,t*(4*r-n))}else{if(this.y===0)return new Hd(i,2*r);if(this.y>0)return new Hd(i,t*(2*r-n));if(this.y<0)return new Hd(i,t*(2*r+n))}}isOnLine(e,t){if(e.x>t.x){let n=t;t=e,e=n}let n=new q(e.x,e.y).inflate(3,3),r=new q(t.x,t.y).inflate(3,3),i,a;return n.union(r).contains(this)?e.x===t.x||e.y===t.y?!0:(e.y<t.y?(i=n.x+(r.x-n.x)*(this.y-(n.y+n.height))/(r.y+r.height-(n.y+n.height)),a=n.x+n.width+(r.x+r.width-(n.x+n.width))*(this.y-n.y)/(r.y-n.y)):(i=n.x+(r.x-n.x)*(this.y-n.y)/(r.y-n.y),a=n.x+n.width+(r.x+r.width-(n.x+n.width))*(this.y-(n.y+n.height))/(r.y+r.height-(n.y+n.height))),this.x>i&&this.x<a):!1}parse(t){let n=t.slice(1,t.length-1).split(`,`),r=parseInt(n[0],10),i=parseInt(n[1],10);if(!isNaN(r)&&!isNaN(i))return new e(r,i)}},q=class e{constructor(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0}contains(e){return e.x>=this.x&&e.x<=this.x+this.width&&e.y>=this.y&&e.y<=this.y+this.height}inflate(e,t){return t===void 0&&(t=e),this.x-=e,this.y-=t,this.width+=2*e+1,this.height+=2*t+1,this}offset(e,t){let n=e,r=t;return e instanceof K&&(n=e.x,r=e.y),this.x+=n,this.y+=r,this}union(t){let n=Math.min(this.x,t.x),r=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x+t.width),a=Math.max(this.y+this.height,t.y+t.height);return new e(n,r,i-n,a-r)}center(){return new K(this.x+this.width/2,this.y+this.height/2)}top(){return new K(this.x+this.width/2,this.y)}right(){return new K(this.x+this.width,this.y+this.height/2)}bottom(){return new K(this.x+this.width/2,this.y+this.height)}left(){return new K(this.x,this.y+this.height/2)}topLeft(){return new K(this.x,this.y)}topRight(){return new K(this.x+this.width,this.y)}bottomLeft(){return new K(this.x,this.y+this.height)}bottomRight(){return new K(this.x+this.width,this.y+this.height)}clone(){return new e(this.x,this.y,this.width,this.height)}isEmpty(){return!this.width&&!this.height}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}rotatedBounds(e){let t=this.clone(),n=this.rotatedPoints(e),r=n[0],i=n[1],a=n[2],o=n[3];return t.x=Math.min(a.x,r.x,i.x,o.x),t.y=Math.min(a.y,r.y,i.y,o.y),t.width=Math.max(a.x,r.x,i.x,o.x)-t.x,t.height=Math.max(a.y,r.y,i.y,o.y)-t.y,t}rotatedPoints(e){let t=this.center(),n=this.bottomRight().rotate(e,t);return[this.topLeft().rotate(e,t),this.topRight().rotate(e,t),n,this.bottomLeft().rotate(e,t)]}toString(e){return e||=` `,this.x+e+this.y+e+this.width+e+this.height}scale(e,t,n,r,i){let a=this.topLeft(),o=this.center();a.rotate(i,o).rotate(i,r);let s=n.minus(a),c=new K(s.x*e,s.y*t),l=s.minus(c);a=a.plus(l),a.rotate(i,r).rotate(i,o),this.x=a.x,this.y=a.y,this.width*=e,this.height*=t}zoom(e){return this.x*=e,this.y*=e,this.width*=e,this.height*=e,this}overlaps(e){let t=this.bottomRight(),n=e.bottomRight();return!(t.x<e.x||t.y<e.y||n.x<this.x||n.y<this.y)}static toRect(t){return t instanceof e||(t=new e(t.x,t.y,t.width,t.height)),t}static empty(){return new e(0,0,0,0)}static fromPoints(t,n){if(isNaN(t.x)||isNaN(t.y)||isNaN(n.x)||isNaN(n.y))throw Error(`Some values are NaN.`);return new e(Math.min(t.x,n.x),Math.min(t.y,n.y),Math.abs(t.x-n.x),Math.abs(t.y-n.y))}},Ud=class{constructor(e){this.container=q.toRect(e)}align(e,t){let n=t.toLowerCase().split(` `);for(let t=0;t<n.length;t++)e=this._singleAlign(e,n[t]);return e}_singleAlign(e,t){return Ge(this[t])?this[t](e):e}left(e){return this._align(e,this._left)}center(e){return this._align(e,this._center)}right(e){return this._align(e,this._right)}stretch(e){return this._align(e,this._stretch)}top(e){return this._align(e,this._top)}middle(e){return this._align(e,this._middle)}bottom(e){return this._align(e,this._bottom)}_left(e,t){t.x=e.x}_center(e,t){t.x=(e.width-t.width)/2||0}_right(e,t){t.x=e.width-t.width}_top(e,t){t.y=e.y}_middle(e,t){t.y=(e.height-t.height)/2||0}_bottom(e,t){t.y=e.height-t.height}_stretch(e,t){t.x=0,t.y=0,t.height=e.height,t.width=e.width}_align(e,t){return e=q.toRect(e),t(this.container,e),e}},Wd=class{constructor(){this._tail=null,this._head=null,this.length=0}enqueue(e){let t={value:e,next:null};this._head?(this._tail.next=t,this._tail=this._tail.next):(this._head=t,this._tail=this._head),this.length++}dequeue(){if(this.length<1)throw Error(`The queue is empty.`);let e=this._head.value;return this._head=this._head.next,this.length--,e}contains(e){let t=this._head;for(;t;){if(t.value===e)return!0;t=t.next}return!1}};let Gd=`object`,Kd=e=>typeof e==`function`;function qd(e,t){for(let n in t){if(n===`__proto__`||n===`constructor`)continue;let r=t[n],i=typeof r,a;if(a=i===Gd&&r!==null?r.constructor:null,a&&a!==Array)if(r instanceof Date)e[n]=new Date(r.getTime());else if(Kd(r.clone))e[n]=r.clone();else{let t=e[n];typeof t===Gd?e[n]=t||{}:e[n]={},qd(e[n],r)}else i!==`undefined`&&(e[n]=r)}return e}function J(e,...t){let n=t.length;for(let r=0;r<n;r++)qd(e,t[r]);return e}let Jd={type:`Tree`,subtype:`Down`,roots:null,animate:!1,limitToView:!1,friction:.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:!1,ignoreContainers:!0,layoutContainerChildren:!1,ignoreInvisible:!0,animateTransitions:!1};var Yd=class{constructor(){this.defaultOptions={...Jd,grid:{...Jd.grid}}}gridLayoutComponents(e){if(!e)throw Error(`No components supplied.`);j(e,function(e){e.calcBounds()}),e.sort(function(e,t){return t.bounds.width-e.bounds.width});let t=this.options.grid.width,n=this.options.grid.componentSpacingX,r=this.options.grid.componentSpacingY,i=this.options.grid.offsetX,a=this.options.grid.offsetY,o=[],s=[],c=0,l=i,u=a;for(;e.length>0;){l>=t&&(l=i,u+=c+r,c=0);let a=e.pop();this.moveToOffset(a,new K(l,u));for(let e=0;e<a.nodes.length;e++)s.push(a.nodes[e]);for(let e=0;e<a.links.length;e++)o.push(a.links[e]);let d=a.bounds,f=d.height;(f<=0||isNaN(f))&&(f=0);let p=d.width;(p<=0||isNaN(p))&&(p=0),f>=c&&(c=f),l+=p+n}return{nodes:s,links:o}}moveToOffset(e,t){let n,r,i=e.bounds,a=t.x-i.x,o=t.y-i.y;for(n=0;n<e.nodes.length;n++){let t=e.nodes[n],r=t.bounds();r.width===0&&r.height===0&&r.x===0&&r.y===0&&(r=new q(0,0,0,0)),r.x+=a,r.y+=o,t.bounds(r)}for(n=0;n<e.links.length;n++){let t=e.links[n];if(t.points){let e=[],n=t.points;for(r=0;r<n.length;r++){let t=n[r];t.x+=a,t.y+=o,e.push(t)}t.points=e}}return this.currentHorizontalOffset+=i.width+this.options.grid.offsetX,new K(a,o)}transferOptions(e){this.options=J({},this.defaultOptions),!k(e)&&(this.options=J(this.options,e||{}))}},Xd=class{constructor(e,t){if(k(e))throw Error(`No diagram given`);this.diagram=e,this.nodeMap=new P,this.linkMap=new P,this.capture(t||e)}capture(e){let t,n,r,i,a,o,s;if(e&&e.type===`Graph`){for(i=0;i<e.nodes.length;i++)t=e.nodes[i],r=t.associatedShape,this.nodeMap.set(r.visual.id,new q(t.x,t.y,t.width,t.height));for(i=0;i<e.links.length;i++)o=e.links[i],a=o.associatedConnection,this.linkMap.set(a.visual.id,o.points())}else if(e instanceof Array)for(n=e,i=0;i<n.length;i++)t=n[i],r=t.associatedShape,r&&this.nodeMap.set(r.visual.id,new q(t.x,t.y,t.width,t.height));else if(Object.prototype.hasOwnProperty.call(e,`links`)&&Object.prototype.hasOwnProperty.call(e,`nodes`)){for(n=e.nodes,s=e.links,i=0;i<n.length;i++)t=n[i],r=t.associatedShape,r&&this.nodeMap.set(r.visual.id,new q(t.x,t.y,t.width,t.height));for(i=0;i<s.length;i++)o=s[i],a=o.associatedConnection,a&&this.linkMap.set(a.visual.id,o.points)}else{let e=this.diagram.shapes,t=this.diagram.connections;for(i=0;i<e.length;i++)r=e[i],this.nodeMap.set(r.visual.id,r.bounds());for(i=0;i<t.length;i++)a=t[i],this.linkMap.set(a.visual.id,a.points())}}},Zd=class e{constructor(e,t){if(this.links=[],this.outgoing=[],this.incoming=[],this.weight=1,this.data=null,this.type=`Node`,this.isVirtual=!1,D(e)?this.id=e:this.id=jt(),D(t)){this.associatedShape=t;let e=t.bounds();this.width=e.width,this.height=e.height,this.x=e.x,this.y=e.y}else this.associatedShape=null;this.shortForm=`Node '`+this.id+`'`}isIsolated(){return Ze(this.links)}bounds(e){if(!D(e))return new q(this.x,this.y,this.width,this.height);this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}isLinkedTo(e){return lt(this.links,t=>t.getComplement(this)===e)}getChildren(){if(this.outgoing.length===0)return[];let e=[];for(let t=0,n=this.outgoing.length;t<n;t++){let n=this.outgoing[t];e.push(n.getComplement(this))}return e}getParents(){if(this.incoming.length===0)return[];let e=[];for(let t=0,n=this.incoming.length;t<n;t++){let n=this.incoming[t];e.push(n.getComplement(this))}return e}clone(){let t=new e;return D(this.weight)&&(t.weight=this.weight),D(this.balance)&&(t.balance=this.balance),D(this.owner)&&(t.owner=this.owner),t.associatedShape=this.associatedShape,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}adjacentTo(e){return this.isLinkedTo(e)!==null}removeLink(e){e.source===this&&(M(this.links,e),M(this.outgoing,e),e.source=null),e.target===this&&(M(this.links,e),M(this.incoming,e),e.target=null)}hasLinkTo(e){return lt(this.outgoing,function(t){return t.target===e})}degree(){return this.links.length}incidentWith(e){return N(this.links,e)}getLinksWith(e){return _t(this.links,function(t){return t.getComplement(this)===e},this)}getNeighbors(){let e=[];return j(this.incoming,function(t){e.push(t.getComplement(this))},this),j(this.outgoing,function(t){e.push(t.getComplement(this))},this),e}},Qd=class e{constructor(e,t,n,r){if(k(e))throw Error(`The source of the new link is not set.`);if(k(t))throw Error(`The target of the new link is not set.`);let i,a;i=A(e)?new Zd(e):e,a=A(t)?new Zd(t):t,this.source=i,this.target=a,this.source.links.push(this),this.target.links.push(this),this.source.outgoing.push(this),this.target.incoming.push(this),D(n)?this.id=n:this.id=jt(),D(r)?this.associatedConnection=r:this.associatedConnection=null,this.type=`Link`,this.shortForm=`Link '`+this.source.id+`->`+this.target.id+`'`}getComplement(e){if(this.source!==e&&this.target!==e)throw Error(`The given node is not incident with this link.`);return this.source===e?this.target:this.source}getCommonNode(e){return this.source===e.source||this.source===e.target?this.source:this.target===e.source||this.target===e.target?this.target:null}isBridging(e,t){return this.source===e&&this.target===t||this.source===t&&this.target===e}getNodes(){return[this.source,this.target]}incidentWith(e){return this.source===e||this.target===e}adjacentTo(e){return N(this.source.links,e)||N(this.target.links,e)}changeSource(e){M(this.source.links,this),M(this.source.outgoing,this),e.links.push(this),e.outgoing.push(this),this.source=e}changeTarget(e){M(this.target.links,this),M(this.target.incoming,this),e.links.push(this),e.incoming.push(this),this.target=e}changesNodes(e,t){this.source===e?this.changeSource(t):this.target===e&&this.changeTarget(t)}reverse(){let e=this.source,t=this.target;return this.source=t,M(e.outgoing,this),this.source.outgoing.push(this),this.target=e,M(t.incoming,this),this.target.incoming.push(this),this}directTo(e){if(this.source!==e&&this.target!==e)throw Error(`The given node is not incident with this link.`);this.target!==e&&this.reverse()}createReverseEdge(){let e=this.clone();return e.reverse(),e.reversed=!0,e}clone(){return new e(this.source,this.target)}},Y=class e{constructor(e){this.links=[],this.nodes=[],this._nodeMap=new P,this.diagram=null,this._root=null,this.bounds=new q,this._hasCachedRelationships=!1,this.type=`Graph`,this.componentIndex=0,D(e)?A(e)?this.id=e:(this.diagram=e,this.id=e.id):this.id=jt()}cacheRelationships(e){if(k(e)&&(e=!1),!(this._hasCachedRelationships&&!e)){for(let e=0,t=this.nodes.length;e<t;e++){let t=this.nodes[e];t.children=this.getChildren(t),t.parents=this.getParents(t)}this._hasCachedRelationships=!0}}assignLevels(e,t,n){if(!e)throw Error(`Start node not specified.`);k(t)&&(t=0),this.cacheRelationships(),k(n)&&(n=new P,j(this.nodes,function(e){n.add(e,!1)})),n.set(e,!0),e.level=t;let r=e.children;for(let e=0,i=r.length;e<i;e++){let i=r[e];!i||n.get(i)||this.assignLevels(i,t+1,n)}}root(e){if(k(e))return this._root?this._root:ht(this.nodes,function(e){return e.incoming.length===0})||ht(this.nodes);this._root=e}getConnectedComponents(){this.componentIndex=0,this.setItemIndices();let t=$e(this.nodes.length,-1);for(let e=0;e<this.nodes.length;e++)t[e]===-1&&(this._collectConnectedNodes(t,e),this.componentIndex++);let n=[],r;for(r=0;r<this.componentIndex;++r)n[r]=new e;for(r=0;r<t.length;++r)n[t[r]].addNodeAndOutgoings(this.nodes[r]);return n.sort(function(e,t){return t.nodes.length-e.nodes.length}),n}_collectConnectedNodes(e,t){e[t]=this.componentIndex;let n=this.nodes[t];j(n.links,function(t){let r=t.getComplement(n).index;e[r]===-1&&this._collectConnectedNodes(e,r)},this)}calcBounds(){if(this.isEmpty())return this.bounds=new q,this.bounds;let e=null;for(let t=0,n=this.nodes.length;t<n;t++){let n=this.nodes[t];e=e?e.union(n.bounds()):n.bounds()}return this.bounds=e,this.bounds}getSpanningTree(t){let n=new e,r=new P,i,a,o=t.clone();n.root(o),o.level=0,o.id=t.id,r.add(t,n.root()),t.level=0;let s=[],c=[];n._addNode(n.root()),s.push(t),c.push(t);let l=1;for(;c.length>0;){let e=c.pop();for(let t=0;t<e.links.length;t++){let o=e.links[t].getComplement(e);if(N(s,o))continue;o.level=e.level+1,l<o.level+1&&(l=o.level+1),N(c,o)||c.push(o),N(s,o)||s.push(o),r.containsKey(e)?i=r.get(e):(i=e.clone(),i.level=e.level,i.id=e.id,r.add(e,i)),r.containsKey(o)?a=r.get(o):(a=o.clone(),a.level=o.level,a.id=o.id,r.add(o,a));let u=new Qd(i,a);n.addLink(u)}}let u=[];for(let e=0;e<l;e++)u.push([]);return j(n.nodes,function(e){u[e.level].push(e)}),n.treeLevels=u,n.cacheRelationships(),n}takeRandomNode(e,t){if(k(e)&&(e=[]),k(t)&&(t=4),this.nodes.length===0)return null;if(this.nodes.length===1)return N(e,this.nodes[0])?null:this.nodes[0];let n=this.nodes.filter(function(n){return!N(e,n)&&n.degree()<=t});return Ze(n)?null:n[nt(0,n.length)]}isEmpty(){return Ze(this.nodes)}isHealthy(){return _t(this.links,function(e){return N(this.nodes,e.source)&&N(this.nodes,e.target)},this)}getParents(e){if(!this.hasNode(e))throw Error(`The given node is not part of this graph.`);return e.getParents()}getChildren(e){if(!this.hasNode(e))throw Error(`The given node is not part of this graph.`);return e.getChildren()}addLink(e,t,n){if(k(e))throw Error(`The source of the link is not defined.`);if(k(t))if(D(e.type)&&e.type===`Link`){this.addExistingLink(e);return}else throw Error(`The target of the link is not defined.`);let r=this.getNode(e);k(r)&&(r=this.addNode(e));let i=this.getNode(t);k(i)&&(i=this.addNode(t));let a=new Qd(r,i);return D(n)&&(a.owner=n),this.links.push(a),a}removeAllLinks(){for(;this.links.length>0;){let e=this.links[0];this.removeLink(e)}}addExistingLink(e){if(!this.hasLink(e)){if(this.links.push(e),this.hasNode(e.source.id)){let t=this.getNode(e.source.id);e.changeSource(t)}else this.addNode(e.source);if(this.hasNode(e.target.id)){let t=this.getNode(e.target.id);e.changeTarget(t)}else this.addNode(e.target)}}hasLink(e){if(A(e))return lt(this.links,function(t){return t.id===e});if(e.type===`Link`)return N(this.links,e);throw Error(`The given object is neither an identifier nor a Link.`)}getNode(e){let t=e.id||e;if(this._nodeMap.containsKey(t))return this._nodeMap.get(t)}hasNode(e){let t=e.id||e;return this._nodeMap.containsKey(t)}_addNode(e){this.nodes.push(e),this._nodeMap.add(e.id,e)}_removeNode(e){M(this.nodes,e),this._nodeMap.remove(e.id)}removeNode(e){let t=e;if(A(e)&&(t=this.getNode(e)),D(t)){let e=t.links;t.links=[];for(let t=0,n=e.length;t<n;t++){let n=e[t];this.removeLink(n)}this._removeNode(t)}else throw Error(`The identifier should be a Node or the Id (string) of a node.`)}areConnected(e,t){return lt(this.links,function(n){return n.source===e&&n.target===t||n.source===t&&n.target===e})}removeLink(e){M(this.links,e),M(e.source.outgoing,e),M(e.source.links,e),M(e.target.incoming,e),M(e.target.links,e)}addNode(e,t,n){let r=null;if(!D(e))throw Error(`No Node or identifier for a new Node is given.`);if(A(e)){if(this.hasNode(e))return this.getNode(e);r=new Zd(e)}else{if(this.hasNode(e))return this.getNode(e);r=e}return D(t)&&r.bounds(t),D(n)&&(r.owner=n),this._addNode(r),r}addNodeAndOutgoings(e){this.hasNode(e)||this._addNode(e);let t=e.outgoing;e.outgoing=[],j(t,function(e){this.addExistingLink(e)},this)}setItemIndices(){let e;for(e=0;e<this.nodes.length;++e)this.nodes[e].index=e;for(e=0;e<this.links.length;++e)this.links[e].index=e}clone(t){let n=new e,r=D(t)&&t===!0;r&&(n.nodeMap=new P,n.linkMap=new P);let i=new P;return j(this.nodes,function(e){let t=e.clone();i.set(e,t),n._addNode(t),r&&n.nodeMap.set(t,e)}),j(this.links,function(e){if(i.containsKey(e.source)&&i.containsKey(e.target)){let t=n.addLink(i.get(e.source),i.get(e.target));r&&n.linkMap.set(t,e)}}),n}linearize(t){return e.Utils.linearize(this,t)}depthFirstTraversal(e,t){if(k(e))throw Error(`You need to supply a starting node.`);if(k(t))throw Error(`You need to supply an action.`);if(!this.hasNode(e))throw Error(`The given start-node is not part of this graph`);let n=this.getNode(e);this._dftIterator(n,t,[])}_dftIterator(e,t,n){t(e),n.push(e);let r=e.getChildren();for(let e=0,i=r.length;e<i;e++){let i=r[e];N(n,i)||this._dftIterator(i,t,n)}}breadthFirstTraversal(e,t){if(k(e))throw Error(`You need to supply a starting node.`);if(k(t))throw Error(`You need to supply an action.`);if(!this.hasNode(e))throw Error(`The given start-node is not part of this graph`);let n=this.getNode(e),r=new Wd,i=[];for(r.enqueue(n);r.length>0;){let e=r.dequeue();t(e),i.push(e);let n=e.getChildren();for(let e=0,t=n.length;e<t;e++){let t=n[e];N(i,t)||r.contains(t)||r.enqueue(t)}}}_stronglyConnectedComponents(e,t,n,r,i,a,o){n.add(t,o),r.add(t,o),o++,a.push(t);let s=t.getChildren(),c;for(let l=0,u=s.length;l<u;l++)c=s[l],n.containsKey(c)?N(a,c)&&r.add(t,Math.min(r.get(t),n.get(c))):(this._stronglyConnectedComponents(e,c,n,r,i,a,o),r.add(t,Math.min(r.get(t),r.get(c))));if(r.get(t)===n.get(t)){let n=[];do c=a.pop(),n.push(c);while(c!==t);(!e||n.length>1)&&i.push(n)}}findCycles(e){k(e)&&(e=!0);let t=new P,n=new P,r=[],i=[];for(let a=0,o=this.nodes.length;a<o;a++){let o=this.nodes[a];t.containsKey(o)||this._stronglyConnectedComponents(e,o,t,n,r,i,0)}return r}isAcyclic(){return Ze(this.findCycles())}isSubGraph(e){let t=e.linearize(),n=this.linearize();return _t(t,function(e){return N(n,e)})}makeAcyclic(){if(this.isEmpty()||this.nodes.length<=1||this.links.length<=1)return[];if(this.nodes.length===2){let e=[];if(this.links.length>1){let t=this.links[0].source;for(let n=0,r=this.links.length;n<r;n++){let r=this.links[n];if(r.source===t)continue;let i=r.reverse();e.push(i)}}return e}let e=this.clone(!0),t=this.nodes.length,n=new P,r=function(e){return e.outgoing.length===0?2-t:e.incoming.length===0?t-2:e.outgoing.length-e.incoming.length},i=function(e){let t=r(e);n.containsKey(t)||n.set(t,[]),n.get(t).push(e)};j(e.nodes,function(e){i(e)});let a=[],o=[];for(;e.nodes.length>0;){let s,c,l;if(n.containsKey(2-t)){let a=n.get(2-t);for(;a.length>0;){c=a.pop();for(let e=0;e<c.links.length;e++){let t=c.links[e];s=t.getComplement(c),l=r(s),M(n.get(l),s),s.removeLink(t),i(s)}e._removeNode(c),o.unshift(c)}}if(n.containsKey(t-2)){let o=n.get(t-2);for(;o.length>0;){s=o.pop();for(let e=0;e<s.links.length;e++){let t=s.links[e];c=t.getComplement(s),l=r(c),M(n.get(l),c),c.removeLink(t),i(c)}a.push(s),e._removeNode(s)}}if(e.nodes.length>0){for(let o=t-3;o>2-t;o--)if(n.containsKey(o)&&n.get(o).length>0){let t=n.get(o).pop();for(let e=0;e<t.links.length;e++){let a=t.links[e],o=a.getComplement(t);l=r(o),M(n.get(l),o),o.removeLink(a),i(o)}a.push(t),e._removeNode(t);break}}}a=a.concat(o);let s=new P;for(let t=0;t<this.nodes.length;t++)s.set(e.nodeMap.get(a[t]),t);let c=[];return j(this.links,function(e){s.get(e.source)>s.get(e.target)&&(e.reverse(),c.push(e))}),c}};Y.Predefined={EightGraph(){return Y.Utils.parse([`1->2`,`2->3`,`3->4`,`4->1`,`3->5`,`5->6`,`6->7`,`7->3`])},Mindmap(){return Y.Utils.parse(`0->1.0->2.0->3.0->4.0->5.1->6.1->7.7->8.2->9.9->10.9->11.3->12.12->13.13->14.4->15.4->16.15->17.15->18.18->19.18->20.14->21.14->22.5->23.23->24.23->25.6->26`.split(`.`))},ThreeGraph(){return Y.Utils.parse([`1->2`,`2->3`,`3->1`])},BinaryTree(e){return k(e)&&(e=5),Y.Utils.createBalancedTree(e,2)},Linear(e){return k(e)&&(e=10),Y.Utils.createBalancedTree(e,1)},Tree(e,t){return Y.Utils.createBalancedTree(e,t)},Forest(e,t,n){return Y.Utils.createBalancedForest(e,t,n)},Workflow(){return Y.Utils.parse([`0->1`,`1->2`,`2->3`,`1->4`,`4->3`,`3->5`,`5->6`,`6->3`,`6->7`,`5->4`])},Grid(e,t){let n=new Y;if(e<=0&&t<=0)return n;for(let r=0;r<e+1;r++){let e=null;for(let i=0;i<t+1;i++){let t=new Zd(r.toString()+`.`+i.toString());if(n.addNode(t),e&&n.addLink(e,t),r>0){let e=n.getNode((r-1).toString()+`.`+i.toString());n.addLink(e,t)}e=t}}return n}},Y.Utils={parse(e){let t,n=new Y,r=e.slice();for(let e=0,i=r.length;e<i;e++){let i=r[e];if(A(i)){if(i.indexOf(`->`)<0)throw Error(`The link should be specified as 'a->b'.`);let e=i.split(`->`);if(e.length!==2)throw Error(`The link should be specified as 'a->b'.`);t=new Qd(e[0],e[1]),n.addLink(t)}if(Ke(i)){if(!t)throw Error(`Specification found before Link definition.`);J(t,i)}}return n},linearize(e,t){if(k(e))throw Error(`Expected an instance of a Graph object in slot one.`);k(t)&&(t=!1);let n=[];for(let r=0,i=e.links.length;r<i;r++){let i=e.links[r];n.push(i.source.id+`->`+i.target.id),t&&n.push({id:i.id})}return n},_addShape(e,t,n,r){return k(t)&&(t=new K(0,0)),k(n)&&(n=jt()),r=J({width:20,height:20,id:n,radius:10,fill:`#778899`,data:`circle`,undoable:!1,x:t.x,y:t.y},r),e.addShape(r)},_addConnection(e,t,n,r){return e.connect(t,n,r)},createDiagramFromGraph(e,t,n,r){if(k(e))throw Error(`The diagram surface is undefined.`);if(k(t))throw Error(`No graph specification defined.`);k(n)&&(n=!0),k(r)&&(r=!1);let i=e.element.clientWidth||200,a=e.element.clientHeight||200,o=[],s,c;for(let n=0,l=t.nodes.length;n<l;n++){s=t.nodes[n];let l=s.position;k(l)&&(l=D(s.x)&&D(s.y)?new K(s.x,s.y):new K(nt(10,i-20),nt(10,a-20)));let u={};s.id===`0`||r&&J(u,{width:Math.random()*150+20,height:Math.random()*80+50,data:`rectangle`,fill:{color:`#778899`}}),c=this._addShape(e,l,s.id,u);let d=c.bounds();D(d)&&(s.x=d.x,s.y=d.y,s.width=d.width,s.height=d.height),o[s.id]=c}for(let n=0;n<t.links.length;n++){let r=t.links[n],i=o[r.source.id];if(k(i))continue;let a=o[r.target.id];k(a)||this._addConnection(e,i,a,{id:r.id})}if(n){new $d(e).layoutGraph(t,{limitToView:!1});for(let e=0;e<t.nodes.length;e++)s=t.nodes[e],c=o[s.id],c.bounds(new q(s.x,s.y,s.width,s.height))}},createBalancedTree(e,t){k(e)&&(e=3),k(t)&&(t=3);let n=new Y,r,i=-1,a=[];if(e<=0||t<=0)return n;let o=new Zd((++i).toString());n.addNode(o),n.root(o),a.push(o);for(let o=0;o<e;o++){r=[];for(let e=0;e<a.length;e++){let o=a[e];for(let e=0;e<t;e++){let e=new Zd((++i).toString());n.addLink(o,e),r.push(e)}}a=r}return n},createBalancedForest(e,t,n){k(e)&&(e=3),k(t)&&(t=3),k(n)&&(n=5);let r=new Y,i=-1,a=[],o;if(e<=0||t<=0||n<=0)return r;for(let s=0;s<n;s++){let n=new Zd((++i).toString());r.addNode(n),a=[n];for(let n=0;n<e;n++){o=[];for(let e=0;e<a.length;e++){let n=a[e];for(let e=0;e<t;e++){let e=new Zd((++i).toString());r.addLink(n,e),o.push(e)}}a=o}}return r},createRandomConnectedGraph(e,t,n){k(e)&&(e=40),k(t)&&(t=4),k(n)&&(n=!1);let r=new Y,i=-1;if(e<=0)return r;let a=new Zd((++i).toString());if(r.addNode(a),e===1)return r;if(e>1){for(let n=1;n<e;n++){let e=r.takeRandomNode([],t);if(!e)break;let i=r.addNode(n.toString());r.addLink(e,i)}if(!n&&e>1){let n=nt(1,e);for(let e=0;e<n;e++){let e=r.takeRandomNode([],t),n=r.takeRandomNode([],t);e&&n&&!r.areConnected(e,n)&&r.addLink(e,n)}}return r}},randomDiagram(e,t,n,r,i){let a=Y.Utils.createRandomConnectedGraph(t,n,r);Y.Utils.createDiagramFromGraph(e,a,!1,i)}};var $d=class extends Yd{constructor(e){if(super(),k(e))throw Error(`Diagram is not specified.`);this.diagram=e}layout(e){this.transferOptions(e);let t=new ef(this.diagram).convert(e);if(t.isEmpty())return;let n=t.getConnectedComponents();if(Ze(n))return;for(let t=0;t<n.length;t++){let r=n[t];this.layoutGraph(r,e)}let r=this.gridLayoutComponents(n);return new Xd(this.diagram,r)}layoutGraph(e,t){D(t)&&this.transferOptions(t),this.graph=e;let n=this.options.nodeDistance*9;this.temperature=n;let r=this._expectedBounds();this.width=r.width,this.height=r.height;for(let e=0;e<this.options.iterations;e++)this.refineStage=e>=this.options.iterations*5/6,this.tick(),this.temperature=this.refineStage?n/30:n*(1-e/(2*this.options.iterations))}tick(){let e;for(e=0;e<this.graph.nodes.length;e++)this._repulsion(this.graph.nodes[e]);for(e=0;e<this.graph.links.length;e++)this._attraction(this.graph.links[e]);for(e=0;e<this.graph.nodes.length;e++){let t=this.graph.nodes[e],n=Math.sqrt(t.dx*t.dx+t.dy*t.dy);if(n===0)return;t.x+=Math.min(n,this.temperature)*t.dx/n,t.y+=Math.min(n,this.temperature)*t.dy/n,this.options.limitToView&&(t.x=Math.min(this.width,Math.max(t.width/2,t.x)),t.y=Math.min(this.height,Math.max(t.height/2,t.y)))}}_shake(e){let t=Math.random()*this.options.nodeDistance/4,n=Math.random()*2*Math.PI;e.x+=t*Math.cos(n),e.y-=t*Math.sin(n)}_InverseSquareForce(e,t,n){let r;if(!this.refineStage)r=e**2/this.options.nodeDistance**2;else{let e=t.x-n.x,i=t.y-n.y,a=t.width/2,o=t.height/2,s=n.width/2,c=n.height/2;r=e**2/(a+s+this.options.nodeDistance)**2+i**2/(o+c+this.options.nodeDistance)**2}return r*4/3}_SquareForce(e,t,n){return 1/this._InverseSquareForce(e,t,n)}_repulsion(e){e.dx=0,e.dy=0,j(this.graph.nodes,function(t){if(t===e)return;for(;e.x===t.x&&e.y===t.y;)this._shake(t);let n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r),a=this._SquareForce(i,e,t)*2;e.dx+=n/i*a,e.dy+=r/i*a},this)}_attraction(e){let t=e.target,n=e.source;if(n===t)return;for(;n.x===t.x&&n.y===t.y;)this._shake(t);let r=n.x-t.x,i=n.y-t.y,a=Math.sqrt(r*r+i*i),o=this._InverseSquareForce(a,n,t)*5,s=r/a*o,c=i/a*o;t.dx+=s,t.dy+=c,n.dx-=s,n.dy-=c}_expectedBounds(){let e=this.graph.nodes.length,t=1.5;if(e===0)return;let n=pt(this.graph.nodes,function(e,t){let n=t.width*t.height;return n>0?(e+=Math.sqrt(n),e):0},0,this)/e*Math.ceil(Math.sqrt(e)),r=n*Math.sqrt(t),i=n/Math.sqrt(t);return{width:r*4,height:i*4}}},ef=class{constructor(e){this.nodeMap=new P,this.shapeMap=new P,this.nodes=[],this.edges=[],this.edgeMap=new P,this.finalNodes=[],this.finalLinks=[],this.ignoredConnections=[],this.ignoredShapes=[],this.hyperMap=new P,this.hyperTree=new Y,this.finalGraph=null,this.diagram=e}convert(e){if(k(this.diagram))throw Error(`No diagram to convert.`);return this.options=J({ignoreInvisible:!0,ignoreContainers:!0,layoutContainerChildren:!1},e||{}),this.clear(),this._renormalizeShapes(),this._renormalizeConnections(),this.finalNodes=new P(this.nodes),this.finalLinks=new P(this.edges),this.finalGraph=new Y,this.finalNodes.forEach(function(e){this.finalGraph.addNode(e)},this),this.finalLinks.forEach(function(e){this.finalGraph.addExistingLink(e)},this),this.finalGraph}mapConnection(e){return this.edgeMap.get(e.id)}mapShape(e){return this.nodeMap.get(e.id)}getEdge(e,t){return ht(e.links,function(n){return n.getComplement(e)===t})}clear(){this.finalGraph=null,this.hyperTree=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new Y:null,this.hyperMap=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new P:null,this.nodeMap=new P,this.shapeMap=new P,this.nodes=[],this.edges=[],this.edgeMap=new P,this.ignoredConnections=[],this.ignoredShapes=[],this.finalNodes=[],this.finalLinks=[]}listToRoot(e){let t=[],n=e.container;if(!n)return t;for(t.push(n);n.parentContainer;)n=n.parentContainer,t.push(n);return t.reverse(),t}firstNonIgnorableContainer(e){return e.isContainer&&!this.isIgnorableItem(e)?e:e.parentContainer?this.firstNonIgnorableContainer(e.parentContainer):null}isContainerConnection(e,t){return e.isContainer&&this.isDescendantOf(e,t)?!0:t.isContainer&&this.isDescendantOf(t,e)}isDescendantOf(e,t){if(!e.isContainer)throw Error(`Expecting a container.`);if(e===t)return!1;if(N(e.children,t))return!0;let n=[];for(let r=0,i=e.children.length;r<i;r++){let i=e.children[r];i.isContainer&&this.isDescendantOf(i,t)&&n.push(i)}return n.length>0}isIgnorableItem(e){return this.options.ignoreInvisible?!(e.isCollapsed&&this._isVisible(e)||!e.isCollapsed&&this._isVisible(e)):e.isCollapsed&&!this._isTop(e)}isShapeMapped(e){return e.isCollapsed&&!this._isVisible(e)&&!this._isTop(e)}leastCommonAncestor(e,t){if(!e||!t)throw Error(`Parameter should not be null.`);if(!this.hyperTree)throw Error(`No hypertree available.`);let n=this.listToRoot(e),r=this.listToRoot(t),i=null;if(Ze(n)||Ze(r))return this.hyperTree.root().data;let a=n[0],o=r[0],s=0;for(;a===o&&(i=n[s],s++,!(s>=n.length||s>=r.length));)a=n[s],o=r[s];return i?this.hyperTree.nodes.filter(function(e){return e.data.container===i}):this.hyperTree.root().data}_isTop(e){return!e.parentContainer}_isVisible(e){return e.visible()?e.parentContainer?this._isVisible(e.parentContainer):e.visible():!1}_isCollapsed(e){return e.isContainer&&e.isCollapsed?!0:e.parentContainer&&this._isCollapsed(e.parentContainer)}_renormalizeShapes(){if(this.options.ignoreContainers)for(let e=0,t=this.diagram.shapes.length;e<t;e++){let t=this.diagram.shapes[e];if(this.options.ignoreInvisible&&!this._isVisible(t)||t.isContainer){this.ignoredShapes.push(t);continue}let n=new Zd(t.id,t);n.isVirtual=!1,this.nodeMap.add(t.id,n),this.nodes.push(n)}else throw Error(`Containers are not supported yet, but stay tuned.`)}_renormalizeConnections(){if(this.diagram.connections.length!==0)for(let e=0,t=this.diagram.connections.length;e<t;e++){let t=this.diagram.connections[e];if(this.isIgnorableItem(t)){this.ignoredConnections.push(t);continue}let n=t.sourceConnector?t.sourceConnector.shape:null,r=t.targetConnector?t.targetConnector.shape:null;if(!n||!r){this.ignoredConnections.push(t);continue}if(N(this.ignoredShapes,n)&&!this.shapeMap.containsKey(n)){this.ignoredConnections.push(t);continue}if(N(this.ignoredShapes,r)&&!this.shapeMap.containsKey(r)){this.ignoredConnections.push(t);continue}this.shapeMap.containsKey(n)&&(n=this.shapeMap[n]),this.shapeMap.containsKey(r)&&(r=this.shapeMap[r]);let i=this.mapShape(n),a=this.mapShape(r);if(i===a||this.areConnectedAlready(i,a)){this.ignoredConnections.push(t);continue}if(i===null||a===null)throw Error(`A shape was not mapped to a node.`);if(this.options.ignoreContainers){if(i.isVirtual||a.isVirtual){this.ignoredConnections.push(t);continue}let e=new Qd(i,a,t.id,t);this.edgeMap.add(t.id,e),this.edges.push(e)}else throw Error(`Containers are not supported yet, but stay tuned.`)}}areConnectedAlready(e,t){return lt(this.edges,function(n){return n.source===e&&n.target===t||n.source===t&&n.target===e})}};function tf(e,t,n,r,i){let a=(t.x-e.x)*(r.y-n.y)-(t.y-e.y)*(r.x-n.x);if(We(a))return;let o=(e.y-n.y)*(r.x-n.x)-(e.x-n.x)*(r.y-n.y),s=(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y),c=o/a,l=s/a;if(!(i&&(c<0||c>1||l<0||l>1)))return new K(e.x+c*(t.x-e.x),e.y+c*(t.y-e.y))}let nf={lines(e,t,n,r){return tf(e,t,n,r)},segments(e,t,n,r){return tf(e,t,n,r,!0)},rectWithLine(e,t,n){return nf.segments(t,n,e.topLeft(),e.topRight())||nf.segments(t,n,e.topRight(),e.bottomRight())||nf.segments(t,n,e.bottomLeft(),e.bottomRight())||nf.segments(t,n,e.topLeft(),e.bottomLeft())},rects(e,t,n){let r=t.topLeft(),i=t.topRight(),a=t.bottomLeft(),o=t.bottomRight(),s=t.center();n&&(r=r.rotate(n,s),i=i.rotate(n,s),a=a.rotate(n,s),o=o.rotate(n,s));let c=e.contains(r)||e.contains(i)||e.contains(a)||e.contains(o)||nf.rectWithLine(e,r,i)||nf.rectWithLine(e,r,a)||nf.rectWithLine(e,i,o)||nf.rectWithLine(e,a,o);if(!c){if(r=e.topLeft(),i=e.topRight(),a=e.bottomLeft(),o=e.bottomRight(),n){let e=360-n;r=r.rotate(e,s),i=i.rotate(e,s),a=a.rotate(e,s),o=o.rotate(e,s)}c=t.contains(r)||t.contains(i)||t.contains(a)||t.contains(o)}return c}},rf=(e,t)=>e.map(t);var af=class e{constructor(e,t,n,r,i,a){this.a=e||0,this.b=t||0,this.c=n||0,this.d=r||0,this.e=i||0,this.f=a||0}fromMatrix(t){let n=new e;return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n.e=t.e,n.f=t.f,n}},of=class e{constructor(e,t,n,r,i,a){this.a=e||0,this.b=t||0,this.c=n||0,this.d=r||0,this.e=i||0,this.f=a||0}plus(e){this.a+=e.a,this.b+=e.b,this.c+=e.c,this.d+=e.d,this.e+=e.e,this.f+=e.f}minus(e){this.a-=e.a,this.b-=e.b,this.c-=e.c,this.d-=e.d,this.e-=e.e,this.f-=e.f}times(t){return new e(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)}apply(e){return new K(this.a*e.x+this.c*e.y+this.e,this.b*e.x+this.d*e.y+this.f)}applyRect(e){return q.fromPoints(this.apply(e.topLeft()),this.apply(e.bottomRight()))}toString(){return`matrix(`+this.a+` `+this.b+` `+this.c+` `+this.d+` `+this.e+` `+this.f+`)`}static fromSVGMatrix(t){let n=new e;return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n.e=t.e,n.f=t.f,n}static fromMatrixVector(t){let n=new e;return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n.e=t.e,n.f=t.f,n}static fromList(t){if(t.length!==6)throw Error(`The given list should consist of six elements.`);let n=new e;return n.a=t[0],n.b=t[1],n.c=t[2],n.d=t[3],n.e=t[4],n.f=t[5],n}static translation(t,n){let r=new e;return r.a=1,r.b=0,r.c=0,r.d=1,r.e=t,r.f=n,r}static unit(){return new e(1,0,0,1,0,0)}static rotation(t,n,r){let i=new e;return i.a=Math.cos(t*Math.PI/180),i.b=Math.sin(t*Math.PI/180),i.c=-i.b,i.d=i.a,i.e=n-n*i.a+r*i.b||0,i.f=r-r*i.a-n*i.b||0,i}static scaling(t,n){let r=new e;return r.a=t,r.b=0,r.c=0,r.d=n,r.e=0,r.f=0,r}static parse(t){let n,r;return t&&(t=t.trim(),t.slice(0,6).toLowerCase()===`matrix`&&(r=t.slice(7,t.length-1).trim(),n=r.split(`,`),n.length===6||(n=r.split(` `),n.length===6))||(t.slice(0,1)===`(`&&t.slice(t.length-1)===`)`&&(t=t.substr(1,t.length-1)),t.indexOf(`,`)>0&&(n=t.split(`,`),n.length===6))||t.indexOf(` `)>0&&(n=t.split(` `),n.length===6))?e.fromList(rf(n,function(e){return parseFloat(e)})):n}};function sf(e,t){let n,r,i;do n=Math.random()*2-1,r=Math.random()*2-1,i=n*n+r*r;while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}var cf=class{constructor(e,t,n){this.point=e,this.left=t,this.right=n}},lf=class extends Et{constructor(e){super(),this._hashTable=new Mt,this.length=0,D(e)&&(e instanceof Mt?e.forEach(function(e){this.add(e)}):e instanceof P&&e.forEach(function(e,t){this.add({key:e,value:t})},this))}contains(e){return this._hashTable.containsKey(e)}add(e){this._hashTable.get(e)||(this._hashTable.add(e,e),this.length++,this.trigger(`changed`))}get(e){return this.contains(e)?this._hashTable.get(e).value:null}hash(e){return this._hashTable._hash(e)}remove(e){this.contains(e)&&(this._hashTable.remove(e),this.length--,this.trigger(`changed`))}forEach(e,t){let n=t?e.bind(t):e;this._hashTable.forEach(function(e){n(e.value)})}toArray(){let e=[];return this.forEach(function(t){e.push(t)}),e}},uf=class e{constructor(e,t){this.width=e,this.height=t}static Empty(){return new e(0,0)}},df=class e{constructor(e,t,n){this.x=t||0,this.y=n||0,this.angle=e}toString(){return this.x&&this.y?`rotate(${this.angle},${this.x},${this.y})`:`rotate(${this.angle})`}toMatrix(){return of.rotation(this.angle,this.x,this.y)}center(){return new K(this.x,this.y)}invert(){return new e(360-this.angle,this.x,this.y)}static create(t){return new e(t.angle,t.x,t.y)}static parse(t){let n=t.slice(1,t.length-1).split(`,`);return new e(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]))}};df.ZERO=new df(0);var ff=class e{constructor(e,t){this.x=e,this.y=t}toMatrix(){return of.scaling(this.x,this.y)}toString(){return`scale(${this.x},${this.y})`}invert(){return new e(1/this.x,1/this.y)}},pf=class e{constructor(e,t){this.x=e,this.y=t}toMatrixVector(){return new af(0,0,0,0,this.x,this.y)}toMatrix(){return of.translation(this.x,this.y)}toString(){return`translate(${this.x},${this.y})`}plus(e){this.x+=e.x,this.y+=e.y}times(e){this.x*=e,this.y*=e}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){this.Length!==0&&this.times(1/this.length())}invert(){return new e(-this.x,-this.y)}},mf=class e{constructor(e,t,n,r,i,a){this.translate=new pf(e,t),n!==void 0&&r!==void 0&&(this.scale=new ff(n,r)),i!==void 0&&(this.rotate=a?new df(i,a.x,a.y):new df(i))}toString(){let e=function(e){return e?e.toString():``};return e(this.translate)+e(this.rotate)+e(this.scale)}render(e){e._transform=this,e._renderTransform()}toMatrix(){let e=of.unit();return this.translate&&(e=e.times(this.translate.toMatrix())),this.rotate&&(e=e.times(this.rotate.toMatrix())),this.scale&&(e=e.times(this.scale.toMatrix())),e}invert(){let t=this.rotate?this.rotate.invert():void 0,n=t?t.toMatrix():of.unit(),r=this.scale?this.scale.invert():void 0,i=r?r.toMatrix():of.unit(),a=new K(-this.translate.x,-this.translate.y);a=n.times(i).apply(a);let o=new pf(a.x,a.y),s=new e;return s.translate=o,s.rotate=t,s.scale=r,s}};function hf(e,t){let n=this.options,r=!1,i,a;for(let o=0;o<t.length;o++)a=t[o],i=e[a],Xe(i)&&n[a]!==i&&(n[a]=i,r=!0);return r}var gf=class{constructor(e){this.options=J({},this.options,e),this.id=this.options.id,this._originSize=q.empty(),this._transform=new mf}visible(e){return this.drawingContainer().visible(e)}redraw(e){e&&e.id&&(this.id=e.id)}position(e,t){let n=this.options;if(!O(e))return new K(n.x,n.y);O(t)?(n.x=e,n.y=t):e instanceof K&&(n.x=e.x,n.y=e.y),this._transform.translate=new pf(n.x,n.y),this._renderTransform()}rotate(e,t){return O(e)&&(this._transform.rotate=new df(e,t.x,t.y),this._renderTransform()),this._transform.rotate||df.ZERO}drawingContainer(){return this.drawingElement}_renderTransform(){let e=this._transform.toMatrix();this.drawingContainer().transform(new tr(e.a,e.b,e.c,e.d,e.e,e.f))}_hover(){}_diffNumericOptions(e,t){return hf.call(this,e,t)}_measure(e){let t;if(!this._measured||e){let e=this._boundingBox()||new L([0,0],[0,0]),n=e.topLeft();t=new q(n.x,n.y,e.width(),e.height()),this._originSize=t,this._originWidth=t.width,this._originHeight=t.height,this._measured=!0}else t=this._originSize;return t}_boundingBox(){return this.drawingElement.rawBBox()}_initAccessibility(){let e=this.options.accessibility;e&&(this.drawingElement.options.set(`role`,e.role),this.drawingElement.options.set(`ariaRoleDescription`,e.ariaRoleDescription),this.drawingElement.options.set(`ariaLabel`,e.ariaLabel),this.drawingElement.options.set(`id`,this.options.id))}};function X(e){return{x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}function _f(e){if(e){let t=e;return A(t)&&(t={color:t}),t.color&&=vf(t.color),t}}function vf(e){let t;return t=e===v?e:new hn(e).toHex(),t}function yf(e,t){let n=t.x-e.x,r=t.y-e.y;return Mn(Math.atan2(r,n))}function bf(e,t){return new Ii(new I(e,t))}function xf(e){if(e)return new L([e.x,e.y],[e.width,e.height])}function Sf(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Cf(e,t=0){let n={top:0,right:0,bottom:0,left:0};return typeof e==`number`?n.top=n.right=n.bottom=n.left=e:(n.top=e.top||t,n.right=e.right||t,n.bottom=e.bottom||t,n.left=e.left||t),n}let wf=(e,t,n)=>{let r=t.length;for(let i=0;i<r;i++){let a=t[(i+r-1)%r],o=t[i],s=t[(i+1)%r],c=Array.isArray(n)?n[i]:n,l={x:a.x-o.x,y:a.y-o.y},u={x:s.x-o.x,y:s.y-o.y},d=Math.hypot(l.x,l.y),f=Math.hypot(u.x,u.y),p=(l.x*u.x+l.y*u.y)/(d*f),m=Math.acos(Math.max(-1,Math.min(1,p))),h=c/Math.tan(m/2),g=Math.min(h,d-.001,f-.001),_={x:o.x+l.x/d*g,y:o.y+l.y/d*g},v={x:o.x+u.x/f*g,y:o.y+u.y/f*g};i===0?e.moveTo(_.x,_.y):e.lineTo(_.x,_.y);let y=l.x*u.y-l.y*u.x<0;e.arcTo([v.x,v.y],c,c,!1,y)}e.close()},Tf=(e,t)=>{let n=t.length;for(let r=0;r<n;r++){let n=t[r];r===0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)}e.close()},Ef=(e,t,n,r)=>{let i=e.bbox();if(!i.size.width||!i.size.height)return;let a=t+r,o=n+r,s=a/i.size.width,c=o/i.size.height;e.transform(new Ur(new tr(s,0,0,c,-i.origin.x*s,-i.origin.y*c)))};function Df(e,t){let n=e.length,r=[];for(let i=0;i<n;i++){let a=e[(i+n-1)%n],o=e[i],s=e[(i+1)%n],c=Array.isArray(t)?t[i]:t,l={x:a.x-o.x,y:a.y-o.y},u={x:s.x-o.x,y:s.y-o.y},d=Math.hypot(l.x,l.y),f=Math.hypot(u.x,u.y),p={x:l.x/d,y:l.y/d},m={x:u.x/f,y:u.y/f},h=Math.acos(Math.max(-1,Math.min(1,p.x*m.x+p.y*m.y))),g=c/Math.sin(h/2)-c,_={x:p.x+m.x,y:p.y+m.y},v=Math.hypot(_.x,_.y);_={x:_.x/v,y:_.y/v};let y={x:-_.x,y:-_.y};r.push({x:o.x+y.x*g,y:o.y+y.y*g})}return r}let Of={stroke:{color:`gray`,width:1},fill:{color:v}};var kf=class extends gf{constructor(e){e=J({},Of,e),super(e),e=this.options,e.fill=_f(e.fill),e.stroke=_f(e.stroke)}fill(e,t){this._fill({color:vf(e),opacity:t})}stroke(e,t,n){this._stroke({color:vf(e),width:t,opacity:n})}redraw(e){if(e){let t=e.stroke,n=e.fill;t&&this._stroke(_f(t)),n&&this._fill(_f(n)),super.redraw(e)}}_hover(e){let t=this.options,n=t.hover;if(n&&n.fill){let r=e?_f(n.fill):t.fill;this._setFill(r)}}_setFill(e){this.drawingElement.fill(e.color,e.opacity)}_evalStrokeOptions(e){let t=this.options;J(t,{stroke:e}),e=t.stroke;let n=null;return e.width>0&&(n={color:e.color,width:e.width,opacity:e.opacity,dashType:e.dashType}),n}_evalFillOptions(e){let t=this.options;return J(t,{fill:e||{}}),t.fill}_stroke(e){let t=this._evalStrokeOptions(e);this.drawingElement.options.set(`stroke`,t)}_fill(e){let t=this._evalFillOptions(e);if(t.gradient){let e=t.gradient,n=e.type===`radial`?Pa:Na;this.drawingElement.fill(new n(e))}else this.drawingElement.fill(t.color,t.opacity)}};let Af={stroke:{color:v,width:0},fill:{color:`black`}};var jf=class extends kf{constructor(e){e=J({},Af,e),super(e);let t=this.options.anchor||{};this.anchor=new I(t.x,t.y),this.createElement()}createElement(){}_transformToPath(e,t){let n=t.transform();return e&&n&&(e=e.transformCopy(n)),e}redraw(e){e&&(e.position&&(this.options.position=e.position),super.redraw(e))}};let Mf={path:`M 0 0 L 10 5 L 0 10 L 3 5 z`,anchor:{x:10,y:5}};var Nf=class extends jf{constructor(e){e=J({},Mf,e),super(e)}createElement(){let e=this.options;this.drawingElement=R.parse(e.path,{fill:e.fill,stroke:e.stroke})}positionMarker(e){let t=this._linePoints(e),n=t.start,r=t.end,i=Wr();if(n&&i.rotate(yf(n,r),r),r){let e=this.anchor,t=r.clone().translate(-e.x,-e.y);i.translate(t.x,t.y)}this.drawingElement.transform(i)}_linePoints(e){let t=this.options,n=e.segments,r,i,a;if(t.position===y){if(a=n[0],a){i=a.anchor(),r=a.controlOut();let e=n[1];!r&&e&&(r=e.anchor())}}else if(a=n[n.length-1],a){i=a.anchor(),r=a.controlIn();let e=n[n.length-2];!r&&e&&(r=e.anchor())}if(i)return{start:this._transformToPath(r,e),end:this._transformToPath(i,e)}}},Pf=class{constructor(e,t){this._translate=(e,t)=>{let n=this._viewBox;return O(e)&&O(t)&&(n.x=e,n.y=t,this.surface.translate({x:e,y:t})),{x:n.x,y:n.y}},this.element=e,this.surface=Qo.create(e,t),Ge(this.surface.translate)&&(this.translate=this._translate),this.drawingElement=new z,this._viewBox=new q(0,0,t.width,t.height),this.size(this._viewBox)}bounds(){let e=this.drawingElement.clippedBBox();return new q(0,0,e.width(),e.height())}size(e){let t=this._viewBox;return O(e)&&(t.width=e.width,t.height=e.height,this.surface.setSize(e)),{width:t.width,height:t.height}}draw(){this.surface.draw(this.drawingElement)}append(e){return this.drawingElement.append(e.drawingContainer()),this}remove(e){this.drawingElement.remove(e.drawingContainer())}insertBefore(){}clear(){this.drawingElement.clear()}destroy(e){this.surface.destroy(),e&&(Sf(this.element),this.element.remove())}};let Ff={_setScale:function(){let e=this.options,t=this._originWidth,n=this._originHeight,r=e.width/t,i=e.height/n;Xe(r)||(r=1),Xe(i)||(i=1),this._transform.scale=new ff(r,i)},_setTranslate:function(){let e=this.options,t=e.x||0,n=e.y||0;this._transform.translate=new pf(t,n)},_initSize:function(){let e=this.options,t=!1;e.autoSize!==!1&&(D(e.width)||D(e.height))&&(this._measure(!0),this._setScale(),t=!0),(D(e.x)||D(e.y))&&(this._setTranslate(),t=!0),t&&this._renderTransform()},_updateSize:function(e){let t=!1;return this.options.autoSize!==!1&&this._diffNumericOptions(e,[g,_])&&(t=!0,this._measure(!0),this._setScale()),this._diffNumericOptions(e,[`x`,`y`])&&(t=!0,this._setTranslate()),t&&this._renderTransform(),t}};var If=class extends kf{constructor(e){super(e),this._setScale=Ff._setScale.bind(this),this._setTranslate=Ff._setTranslate.bind(this),this._initSize=Ff._initSize.bind(this),this._updateSize=Ff._updateSize.bind(this),this._initCircle(),this._initSize(),this._initAccessibility()}redraw(e){if(e){let t=this.options;e.center&&(J(t,{center:e.center}),this._center.move(t.center.x,t.center.y)),this._diffNumericOptions(e,[`radius`])&&this._circle.setRadius(t.radius),this._updateSize(e),super.redraw.call(this,e)}}_initCircle(){let e=this.options,t=e.width,n=e.height,r=e.radius;O(r)||(O(t)||(t=n),O(n)||(n=t),e.radius=r=Math.min(t,n)/2);let i=e.center||{x:r,y:r};this._center=new I(i.x,i.y),this._circle=new Qr(this._center,r),this.drawingElement=new ai(this._circle,{stroke:e.stroke,id:e.id}),this._fill()}};let Lf={radius:4,anchor:{x:0,y:0}};var Rf=class extends jf{constructor(e){e=J({},Lf,e),super(e)}createElement(){let e=this.options;this.drawingElement=new ai(new Qr(this.anchor,e.radius),{fill:e.fill,stroke:e.stroke})}positionMarker(e){let t=this.options.position,n=e.segments,r,i;r=t===y?n[0]:n[n.length-1],r&&(i=this._transformToPath(r.anchor(),e),this.drawingElement.transform(Wr().translate(i.x,i.y)))}},Z=class extends kf{constructor(e){super(e),this._initPath(),this._setPosition(),this._initAccessibility()}_setPosition(){let e=this.options,t=e.x,n=e.y;(O(t)||O(n))&&this.position(t||0,n||0)}redraw(e){e&&(super.redraw(e),this._diffNumericOptions(e,[g,_])&&this._drawPath(),this._diffNumericOptions(e,[`x`,`y`])&&this._setPosition())}_initPath(){let e=this.options;this.drawingElement=new R({stroke:e.stroke,id:e.id}),this._fill(),this._drawPath()}_drawPath(){let{width:e,height:t}=X(this.options),n=this.drawingElement,r=[{x:0,y:0},{x:e,y:0},{x:e,y:t},{x:0,y:t}];this.options.cornerRadius>0?wf(n,r,this.options.cornerRadius):Tf(n,r)}},zf=class extends Z{_initPath(){let e=this.options;this.drawingElement=new pa({stroke:e.stroke,id:e.id}),this._fill(),this._drawPath()}};let Bf={shapesOffsetRatio:.025};var Vf=class extends zf{constructor(e){super({...Bf,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.cornerRadius,i=this.options.stroke.width||0,a=n*this.options.shapesOffsetRatio-r/2,o=t/2,s=n/2;wf(e,[{x:o,y:s-a},{x:0,y:0},{x:t,y:0}],[r/3,r,r]),wf(e,[{x:o,y:s+a},{x:t,y:n},{x:0,y:n}],[r/3,r,r]),Ef(e,t,n,i)}},Hf=class extends Z{_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=t/2,i=Math.min(t,n)/2;e.moveTo([r,0]).arcTo([r,n],i,i,!1,!0).arcTo([r,0],i,i,!1,!0)}};let Uf={slantRatio:.15};var Wf=class extends Z{constructor(e){super({...Uf,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,{slantRatio:i,cornerRadius:a}=this.options,o=t*i;wf(e,[{x:o,y:0},{x:t,y:0},{x:t-o,y:n},{x:0,y:n}],a),Ef(e,t,n,r)}};let Gf={ellipseRxRatio:.5,ellipseRyRatio:.2};var Kf=class extends Z{constructor(e){super({...Gf,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,i=t*this.options.ellipseRxRatio,a=n*this.options.ellipseRyRatio,o=a,s=a;e.moveTo([t,o]).arcTo([0,o],i,s,!1,!0).arcTo([t,o],i,s,!1,!0).lineTo([t,n]).arcTo([0,n],i,s,!1,!0).lineTo([0,o]),Ef(this.drawingElement,t,n,r)}};let qf={ellipseRadiusXRatio:.165,ellipseRadiusYRatio:.5};var Jf=class extends zf{constructor(e){super({...qf,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=t*this.options.ellipseRadiusXRatio,i=r,a=n*this.options.ellipseRadiusYRatio,o=r;e.moveTo(o,0).lineTo(t,0).arc(270,90,i,a,!0).lineTo(o,n).arcTo([o,0],i,a,!1,!0).close()}},Yf=class extends Z{_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0;wf(e,Df([{x:0,y:n/2},{x:t/2,y:0},{x:t,y:n/2},{x:t/2,y:n}],this.options.cornerRadius),this.options.cornerRadius),Ef(e,t,n,r)}};let Xf={arcRadiusXRatio:.17,arcRadiusYRatio:.3};var Zf=class extends Z{constructor(e){super({...Xf,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,{arcRadiusXRatio:i,arcRadiusYRatio:a,cornerRadius:o}=this.options,s=t*i,c=n*a;e.moveTo([0,o]).arcTo([o,0],o,o,!0,!1).lineTo([t-s,0]).arcTo([t-s,n],s,c,!1,!1).lineTo([o,n]).arcTo([0,n-o],o,o,!0,!1).close(),Ef(this.drawingElement,t,n,r)}};let Qf={ellipseRatio:.1407};var $f=class extends Z{constructor(e){super({...Qf,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=t*this.options.ellipseRatio,i=r,a=r,o=n/2;e.moveTo([t-i,n]).arcTo([t-i,0],a,o,!1,!0).arcTo([t-i,n],a,o,!1,!0).lineTo([i,n]).arcTo([i,0],a,o,!1,!0).lineTo([t-i,0])}};let ep={sideCutRatio:.35,arcRadiusYRatio:.3,arcRadiusXRatio:.08};var tp=class extends Z{constructor(e){super({...ep,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,i=n*this.options.arcRadiusYRatio,a=t*this.options.arcRadiusXRatio,o=t-a,s=t*this.options.sideCutRatio;e.moveTo([s,0]).lineTo([o,0]).arcTo([o,n],a,i,!1,!0).lineTo([o,n]).lineTo([s,n]).lineTo([0,n/2]).close(),Ef(this.drawingElement,t,n,r)}};let np={waveRatio:.37},rp={...np,docsXRatio:.14,docsYRatio:.2},ip=(e,t,n,r,i,a)=>{let o=r*i;e.moveTo(t[0]+n,t[1]+r).curveTo([t[0]+n,t[1]+r],[t[0]+n*.8333333333333334,t[1]+r-o],[t[0]+n/2,t[1]+r]).curveTo([t[0]+n*.16666666666666666,t[1]+r+o],[t[0],t[1]+r],[t[0],t[1]+r]).lineTo(t[0],t[1]+a).arcTo([t[0]+a,t[1]],a,a,!0,!1).lineTo(t[0]+n-a,t[1]).arcTo([t[0]+n,t[1]+a],a,a,!0,!1).lineTo(t[0]+n,t[1]+r).close()};var ap=class extends Z{constructor(e){super({...np,...e})}_drawPath(){let{width:e,height:t}=X(this.options),n=this.options.stroke.width||0,{waveRatio:r,cornerRadius:i}=this.options,a=t*r*.5;ip(this.drawingElement,[0,0],e,t-a,r,i),Ef(this.drawingElement,e,t,n)}},op=class extends ap{constructor(e){super({...rp,...e})}_initPath(){this.drawingElement=new z({id:this.options.id}),this._fill(),this._drawPath()}_fill(e){let t=this._evalFillOptions(e);if(t.gradient){let e=t.gradient,n=e.type===`radial`?Pa:Na;this.drawingElement.children.forEach(t=>{t.fill(new n(e))})}else this.drawingElement.children.forEach(e=>{e.fill(t.color,t.opacity)})}_drawPath(){let{width:e,height:t}=X(this.options),n=this.options.stroke.width||0,{waveRatio:r,docsXRatio:i,docsYRatio:a,stroke:o,fill:s,cornerRadius:c}=this.options,l=e*i,u=t*a,d=this.drawingElement,f=new pa({stroke:o,fill:s}),p=new pa({stroke:o,fill:s}),m=t*r*.5;ip(f,[l,0],e-l,t-u-m,r,c),ip(p,[0,u],e-l,t-u-m,r,c),d.append(f),d.append(p),Ef(this.drawingElement,e,t,n)}},sp=class extends Z{_drawPath(){let{width:e,height:t}=X(this.options),n=this.drawingElement,r=t/2;n.moveTo(r,0).lineTo(e-2*r,0).arcTo([e-2*r,t],r,r,!1,!1).lineTo(r,t).arcTo([r,0],r,r,!1,!1).close()}},cp=class extends Z{_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,i=this.options.cornerRadius||0;wf(e,Df([{x:t/2,y:0},{x:t,y:n},{x:0,y:n}],i),i),Ef(e,t,n,r)}},lp=class extends gf{constructor(e){e=J({autoSize:!1},e),super(e),this.children=[],this._childrenChange=!1,this._setScale=Ff._setScale.bind(this),this._setTranslate=Ff._setTranslate.bind(this),this._initSize=Ff._initSize.bind(this),this._updateSize=Ff._updateSize.bind(this),this.drawingElement=new z,this._initSize()}append(e){this.drawingElement.append(e.drawingContainer()),this.children.push(e),this._childrenChange=!0}remove(e){this._remove(e)&&(this._childrenChange=!0)}_remove(e){let t=this.children.indexOf(e);if(t>=0)return this.drawingElement.removeAt(t),this.children.splice(t,1),!0}clear(){this.drawingElement.clear(),this.children=[],this._childrenChange=!0}toFront(e){let t;for(let n=0;n<e.length;n++)t=e[n],this._remove(t)&&this.append(t)}toBack(e){this._reorderChildren(e,0)}toIndex(e,t){this._reorderChildren(e,t)}_reorderChildren(e,t){let n=this.drawingElement,r=n.children.slice(0),i=this.children,a=Xe(t),o,s,c,l,u;for(o=0;o<e.length;o++)u=e[o],l=u.drawingContainer(),s=i.indexOf(u),s>=0&&(r.splice(s,1),i.splice(s,1),c=a?t:t[o],r.splice(c,0,l),i.splice(c,0,u));n.clear(),n.append(...r)}redraw(e){e&&(this._childrenChange?(this._childrenChange=!1,this._updateSize(e)||this._initSize()):this._updateSize(e),super.redraw(e))}_boundingBox(){let e=this.children,t,n,r;for(let i=0;i<e.length;i++)n=e[i],n.visible()&&n._includeInBBox!==!1&&(r=n.drawingContainer().clippedBBox(null),r&&(t=t?L.union(t,r):r));return t}},up=class extends gf{constructor(e){super(e),this._initImage(),this._initAccessibility()}redraw(e){e&&(e.source&&this.drawingElement.src(e.source),this._diffNumericOptions(e,[g,_,`x`,`y`])&&this.drawingElement.rect(this._rect()),super.redraw(e))}_initImage(){let e=this.options,t=this._rect();this.drawingElement=new ha(e.source,t),this.drawingElement.options.set(`id`,e.id)}_rect(){let e=X(this.options);return new L(new I(e.x,e.y),new Hr(e.width,e.height))}};let dp={leftLineOffsetRatio:.13,topLineOffsetRatio:.23};var fp=class extends zf{constructor(e){super({...dp,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),{leftLineOffsetRatio:r,topLineOffsetRatio:i}=this.options,a=t*r,o=n*i;wf(e,[{x:0,y:0},{x:t,y:0},{x:t,y:n},{x:0,y:n}],this.options.cornerRadius),e.moveTo(a,0).lineTo(a,n).moveTo(0,o).lineTo(t,o)}},pp=class extends lp{constructor(e,t){super(t),this.drawingElement=new Ca(xf(e),t),this._initSize()}rect(e){if(e)this.drawingElement.rect(xf(e));else{let e=this.drawingElement.rect();if(e)return new q(e.origin.x,e.origin.y,e.size.width,e.size.height)}}reflow(){this.drawingElement.reflow()}redraw(e){J(this.drawingElement.options,e),super.redraw.call(this,e)}};let Q={_getPath:function(e){let t=this.drawingElement;if(t instanceof pa&&(t=e===y?t.paths[0]:t.paths[t.paths.length-1]),t&&t.segments.length)return t},_normalizeMarkerOptions:function(e){let t=e.startCap,n=e.endCap;A(t)&&(e.startCap={type:t}),A(n)&&(e.endCap={type:n})},_removeMarker:function(e){let t=this._markers[e];t&&(this.drawingContainer().remove(t.drawingElement),delete this._markers[e])},_createMarkers:function(){let e=this.options;this._normalizeMarkerOptions(e),this._markers={},this._markers[y]=this._createMarker(e.startCap,y),this._markers.end=this._createMarker(e.endCap,`end`)},_createMarker:function(e,t){let n=(e||{}).type,r=this._getPath(t),i,a;if(!r){this._removeMarker(t);return}if(n===C.FilledCircle?i=Rf:n===C.ArrowStart||n===C.ArrowEnd?i=Nf:this._removeMarker(t),i)return a=new i(J({},e,{position:t})),a.positionMarker(r),this.drawingContainer().append(a.drawingElement),a},_positionMarker:function(e){let t=this._markers[e];if(t){let n=this._getPath(e);n?t.positionMarker(n):this._removeMarker(e)}},_capMap:{start:`startCap`,end:`endCap`},_redrawMarker:function(e,t,n){this._normalizeMarkerOptions(n);let r=this.options,i=this._capMap[t],a=(r[i]||{}).type,o=n[i],s=!1;return o?(r[i]=J({},r[i],o),o.type&&a!==o.type?(this._removeMarker(t),this._markers[t]=this._createMarker(r[i],t),s=!0):this._markers[t]&&this._markers[t].redraw(o)):e&&!this._markers[t]&&r[i]&&(this._markers[t]=this._createMarker(r[i],t),s=!0),s},_redrawMarkers:function(e,t){!this._redrawMarker(e,y,t)&&e&&this._positionMarker(y),!this._redrawMarker(e,`end`,t)&&e&&this._positionMarker(`end`)}};var mp=class extends kf{constructor(e){super(e),this._capMap=Q._capMap,this.container=new z,this._getPath=Q._getPath.bind(this),this._normalizeMarkerOptions=Q._normalizeMarkerOptions.bind(this),this._removeMarker=Q._removeMarker.bind(this),this._createMarkers=Q._createMarkers.bind(this),this._createMarker=Q._createMarker.bind(this),this._positionMarker=Q._positionMarker.bind(this),this._redrawMarker=Q._redrawMarker.bind(this),this._redrawMarkers=Q._redrawMarkers.bind(this),this._initPath(),this._createMarkers(),this._initAccessibility()}drawingContainer(){return this.container}redraw(e){if(e){e||={};let t=e.from,n=e.to;t&&(this.options.from=t),n&&(this.options.to=n),t||n?(this._drawPath(),this._redrawMarkers(!0,e)):this._redrawMarkers(!1,e),super.redraw(e)}}_initPath(){let e=this.options,t=this.drawingElement=new R({stroke:e.stroke});this._fill(),this._drawPath(),this.container.append(t)}_drawPath(){let e=this.options,t=this.drawingElement,n=e.from||new K,r=e.to||new K;t.segments.elements([bf(n.x,n.y),bf(r.x,r.y)])}};let hp={topSlantRatio:.2};var gp=class extends Z{constructor(e){super({...hp,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,{topSlantRatio:i,cornerRadius:a}=this.options;wf(e,[{x:0,y:n*i},{x:t,y:0},{x:t,y:n},{x:0,y:n}],a),Ef(e,t,n,r)}};let _p={baseShrinkRatio:.5};var vp=class extends Z{constructor(e){super({..._p,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,i=t*this.options.baseShrinkRatio;wf(e,[{x:0,y:0},{x:t,y:0},{x:t-i/2,y:n},{x:i/2,y:n}],this.options.cornerRadius),Ef(e,t,n,r)}},yp=class extends Z{_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0;wf(e,Df([{x:0,y:0},{x:t,y:0},{x:t/2,y:n}],this.options.cornerRadius),this.options.cornerRadius),Ef(e,t,n,r)}},bp=class extends zf{_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=t/2,i=n/2,a=Math.min(t,n)/2-this.options.stroke.width;e.moveTo(r,0).arcTo([r,n],a,a,!1,!0).arcTo([r,0],a,a,!1,!0).moveTo(0,i).lineTo(t,i).moveTo(r,0).lineTo(r,n)}};let xp={ellipseRxRatio:.5,ellipseRyRatio:.13,bottomEdgeYRatio:.76};var Sp=class extends Z{constructor(e){super({...xp,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,i=t*this.options.ellipseRxRatio,a=n*this.options.ellipseRyRatio,o=a,s=o,c=o,l=n*this.options.bottomEdgeYRatio,u=t/2,d=n;e.moveTo([0,o]).arcTo([t,c],i,a,!1,!1).lineTo([t,l]).lineTo([u,d]).lineTo([0,l]).lineTo([0,s]).close(),Ef(this.drawingElement,t,n,r)}},Cp=class extends kf{constructor(e){e=J({autoSize:!0},e),super(e),this._capMap=Q._capMap,this.container=new z,this._setScale=Ff._setScale.bind(this),this._setTranslate=Ff._setTranslate.bind(this),this._initSize=Ff._initSize.bind(this),this._updateSize=Ff._updateSize.bind(this),this._getPath=Q._getPath.bind(this),this._normalizeMarkerOptions=Q._normalizeMarkerOptions.bind(this),this._removeMarker=Q._removeMarker.bind(this),this._createMarkers=Q._createMarkers.bind(this),this._createMarker=Q._createMarker.bind(this),this._positionMarker=Q._positionMarker.bind(this),this._redrawMarker=Q._redrawMarker.bind(this),this._redrawMarkers=Q._redrawMarkers.bind(this),this._createElements(),this._initSize()}drawingContainer(){return this.container}data(e){let t=this.options;if(e)t.data!==e&&(t.data=e,this._setData(e),this._initSize(),this._redrawMarkers(!0,{}));else return t.data}redraw(e){if(e){super.redraw(e);let t=this.options,n=e.data;O(n)&&t.data!==n?(t.data=n,this._setData(n),this._updateSize(e)||this._initSize(),this._redrawMarkers(!0,e)):(this._updateSize(e),this._redrawMarkers(!1,e))}}_createElements(){let e=this.options;this.drawingElement=R.parse(e.data||``,{stroke:e.stroke}),this._fill(),this.container.append(this.drawingElement),this._createMarkers()}_setData(e){let t=this.drawingElement,n=R.parse(e||``),r=n.paths.slice(0);n.paths.elements([]),t.paths.elements(r)}},wp=class extends kf{constructor(e){e=J({points:[]},e),super(e),this._capMap=Q._capMap,this.container=new z,this._getPath=Q._getPath.bind(this),this._normalizeMarkerOptions=Q._normalizeMarkerOptions.bind(this),this._removeMarker=Q._removeMarker.bind(this),this._createMarkers=Q._createMarkers.bind(this),this._createMarker=Q._createMarker.bind(this),this._positionMarker=Q._positionMarker.bind(this),this._redrawMarker=Q._redrawMarker.bind(this),this._redrawMarkers=Q._redrawMarkers.bind(this),this._initPath(),this._createMarkers(),this._initAccessibility()}drawingContainer(){return this.container}points(e){let t=this.options;if(e)t.points=e,this._updatePath();else return t.points}redraw(e){if(e){let t=e.points;super.redraw.call(this,e),t&&this._pointsDiffer(t)?(this.points(t),this._redrawMarkers(!0,e)):this._redrawMarkers(!1,e)}}_initPath(){let e=this.options;this.drawingElement=new R({stroke:e.stroke,id:e.id}),this._fill(),this.container.append(this.drawingElement),e.points&&this._updatePath()}_pointsDiffer(e){let t=this.options.points,n=t.length!==e.length;if(!n){for(let r=0;r<e.length;r++)if(t[r].x!==e[r].x||t[r].y!==e[r].y){n=!0;break}}return n}_updatePath(){let e=this.drawingElement,t=this.options,n=t.points;if(t.cornerRadius>0)Op(e,n,t.cornerRadius);else{let t=[],r;for(let e=0;e<n.length;e++)r=n[e],t.push(bf(r.x,r.y));e.segments.elements(t)}}};let Tp=1e-6;function Ep(e,t){return Math.hypot(e.x-t.x,e.y-t.y)}function Dp(e,t=Tp){if(e.length===0)return e;let n=[e[0]];for(let r=1;r<e.length;r++)Ep(e[r],n[n.length-1])>t&&n.push(e[r]);return n}function Op(e,t,n){let r=Dp(t);if(r.length<2)return e;if(e.moveTo(r[0].x,r[0].y),r.length===2)return e.lineTo(r[1].x,r[1].y),e;for(let t=1;t<r.length-1;t++){let i=r[t-1],a=r[t],o=r[t+1],s={x:a.x-i.x,y:a.y-i.y},c={x:o.x-a.x,y:o.y-a.y},l=Math.hypot(s.x,s.y),u=Math.hypot(c.x,c.y);if(l<Tp||u<Tp){e.lineTo(a.x,a.y);continue}let d=s.x*c.y-s.y*c.x,f=(s.x*c.x+s.y*c.y)/(l*u);if(Math.abs(d)<Tp&&f>.999)continue;let p=Math.min(n,l/2,u/2);if(p<=Tp){e.lineTo(a.x,a.y);continue}let m={x:s.x/l,y:s.y/l},h={x:c.x/u,y:c.y/u},g={x:a.x-m.x*p,y:a.y-m.y*p},_={x:a.x+h.x*p,y:a.y+h.y*p},v=Math.abs(f)<=.05;if(e.lineTo(g.x,g.y),v){let t=.5522847498307936*p,n={x:g.x+m.x*t,y:g.y+m.y*t},r={x:_.x-h.x*t,y:_.y-h.y*t};e.curveTo(new I(n.x,n.y),new I(r.x,r.y),new I(_.x,_.y))}else e.curveTo(new I(a.x,a.y),new I(a.x,a.y),new I(_.x,_.y))}let i=r[r.length-1];return e.lineTo(i.x,i.y),e}let kp={sideLineOffsetRatio:.1};var Ap=class extends zf{constructor(e){super({...kp,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=t*this.options.sideLineOffsetRatio,i=r,a=t-r;wf(e,[{x:0,y:0},{x:t,y:0},{x:t,y:n},{x:0,y:n}],this.options.cornerRadius),e.moveTo(i,0).lineTo(i,n).moveTo(a,0).lineTo(a,n)}};let jp={horizontalInsetRatio:1/6};var Mp=class extends Z{constructor(e){super({...jp,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,i=t*this.options.horizontalInsetRatio;wf(e,[{x:i,y:0},{x:t-i,y:0},{x:t,y:n/2},{x:t-i,y:n},{x:i,y:n},{x:0,y:n/2}],this.options.cornerRadius),Ef(e,t,n,r)}},Np=class extends Z{};let Pp={shapesOffsetRatio:.015};var Fp=class extends zf{constructor(e){super({...Pp,...e})}_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=this.options.stroke.width||0,i=this.options.cornerRadius,a=this.options.shapesOffsetRatio*n,o=n/2;wf(e,[{x:t/2,y:0},{x:t,y:o-a},{x:0,y:o-a}],[i/3,i,i]),wf(e,[{x:t/2,y:n},{x:0,y:o+a},{x:t,y:o+a}],[i/3,i,i]),Ef(e,t,n,r)}},Ip=class extends zf{_drawPath(){let e=this.drawingElement,{width:t,height:n}=X(this.options),r=t/2,i=n/2,a=Math.min(t,n)*.5,o=i-a,s=i+a,c=r-a/Math.SQRT2,l=i-a/Math.SQRT2,u=r+a/Math.SQRT2,d=i+a/Math.SQRT2;e.moveTo(r,o).arcTo([r,s],a,a,!1,!0).arcTo([r,o],a,a,!1,!0).moveTo(c,l).lineTo(u,d).moveTo(u,l).lineTo(c,d)}};let Lp=e=>(e&&e.color&&(e=J({},e,{fill:{color:e.color}})),e),Rp={fontSize:15,fontFamily:`sans-serif`,lineSpacing:0,textWrap:`nowrap`,padding:Cf(0),relativePadding:Cf(0),stroke:{width:0},fill:{color:`black`},autoSize:!0};var zp=class extends kf{constructor(e){e=J({},Rp,e),e=Lp(e),super(e),this.textElements=[],this.alignable=!0,this.name=`TextBlock`,this._setScale=Ff._setScale.bind(this),this._setTranslate=Ff._setTranslate.bind(this),this._initSize=Ff._initSize.bind(this),this._updateSize=Ff._updateSize.bind(this),this._font(),this._initText(),this._initSize()}_initText(){let e=this.options;this.textElements.length=0,this.drawingElement=new ma(O(e.text)?e.text:``,new I,{font:e.font}),this.textElements.push(this.drawingElement),this._fill(),this._stroke()}_fill(e){let t=this._evalFillOptions(e);if(t.gradient){let e=t.gradient,n=e.type===`radial`?Pa:Na;this.textElements.forEach(t=>{t.fill(new n(e))})}else this._setFill(t)}_setFill(e){this.textElements.forEach(t=>{t.fill(e.color,e.opacity)})}_stroke(e){let t=this._evalStrokeOptions(e);this.textElements.forEach(e=>e.options.set(`stroke`,t))}_font(){let e=this.options;if(e.fontFamily&&O(e.fontSize)){let t=[];e.fontStyle&&t.push(e.fontStyle),e.fontWeight&&t.push(e.fontWeight),t.push(e.fontSize+(Xe(e.fontSize)?`px`:``)),t.push(e.fontFamily),e.font=t.join(` `)}else delete e.font}content(e){return this.drawingElement.content(e)}redraw(e){if(e){let t=!1,n=this.options;e=Lp(e),super.redraw(e),(e.fontFamily||O(e.fontSize)||e.fontStyle||e.fontWeight)&&(J(n,{fontFamily:e.fontFamily,fontSize:e.fontSize,fontStyle:e.fontStyle,fontWeight:e.fontWeight}),this._font(),this.drawingElement.options.set(`font`,n.font),t=!0),e.text&&(this.content(e.text),t=!0),!this._updateSize(e)&&t&&this._initSize()}}},Bp=class extends Ca{measure(){if(!this._rect||this.children.length===0)return new Hr(0,0);this._initMap();let{groups:e,groupsSize:t}=this._initGroups();if(e.length===0)return new Hr(0,0);let{sizeField:n,groupsSizeField:r}=this._fieldMap,i=0;for(let t=0;t<e.length;t++)i=Math.max(i,e[t].size);let a=new Hr;return a[n]=i,a[r]=t,a}rawBBox(){if(!this._rect||this.children.length===0)return new L(this._rect.origin,new Hr);let e=this.measure();return new L(this._rect.origin,e)}bbox(e){if(!this._rect||this.children.length===0){let t=new L(this._rect.origin,new Hr),n=this.currentTransform(e);return n?t.bbox(n.matrix()):t}let t=this.rawBBox(),n=this.currentTransform(e);return n?t.bbox(n.matrix()):t}},Vp=class{constructor(e,t,n,r){this.x1=e,this.y1=t,this.x2=n,this.y2=r}width(){return this.x2-this.x1}height(){return this.y2-this.y1}pad(e){let t={...e};return this.x1-=t.left,this.x2+=t.right,this.y1-=t.top,this.y2+=t.bottom,this}unpad(e){let t={...e};return t.left=-t.left||0,t.top=-t.top||0,t.right=-t.right||0,t.bottom=-t.bottom||0,this.pad(t)}toRect(){return new L([this.x1,this.y1],[this.width(),this.height()])}};let Hp=(e=``)=>{let t={justifyContent:b,alignContent:b};return e.includes(`left`)&&(t.justifyContent=y),e.includes(`right`)&&(t.justifyContent=`end`),e.includes(`top`)&&(t.alignContent=y),e.includes(`bottom`)&&(t.alignContent=`end`),t};function Up(e,t){let n=Cf(t||0,0);return{left:e.width*n.left,top:e.height*n.top,right:e.width*n.right,bottom:e.height*n.bottom}}let Wp=e=>{let t=e.shapeSize,{padding:n,relativePadding:r}=e,i=Cf(n||0,0),a=J({},Rp.padding,i);if(!t){let n=(e.text||``).split(`
`),r=Gp(e),i=n.map(e=>gr(e,r));t={width:i.reduce((e,t)=>Math.max(e,t.width),0),height:i.reduce((e,t)=>e+t.height,0)+(n.length-1)*(e.lineSpacing||0)}}let o=Up(t,r||0),s=J({},Rp.relativePadding,o),c=new Vp(0,0,t.width,t.height);return c.unpad(s),c.unpad(a),c.toRect()},Gp=e=>{let t={fontSize:O(e.fontSize)?e.fontSize:Rp.fontSize,fontFamily:e.fontFamily||Rp.fontFamily};return(e.fontWeight||Rp.fontWeight)&&(t.fontWeight=e.fontWeight||Rp.fontWeight),(e.fontStyle||Rp.fontStyle)&&(t.fontStyle=e.fontStyle||Rp.fontStyle),t};var Kp=class extends zp{constructor(){super(...arguments),this.alignable=!1,this.name=`MultiLineTextBlock`}content(e){return e!==void 0&&(this.options.text=e,this._initText()),this.options.text}_initText(){this.textElements.length=0,this.alignable=!1;let e=this.drawingElement=this.drawingElement||new z;e.children.length&&e.clear();let t=this.options,n=Wp(t),r=new Bp(n,{...Hp(t.align),lineSpacing:t.lineSpacing});this._textLines(n?n.size.width:void 0).forEach(e=>{let n=new ma(e,new I(0,0),{font:t.font});this.textElements.push(n),r.append(n),r.appendBreak()}),r.reflow();let i=t.background!==void 0,a=t.border!==void 0;if(i||a){let n=r.clippedBBox();if(n){this._textOnlyRect=n.clone();let r=t.textPadding===void 0?Se:t.textPadding;r=typeof r==`number`?Cf(r,0):{...Se,...r};let i=new wa(new L([n.origin.x-r.left,n.origin.y-r.top],[n.size.width+r.left+r.right,n.size.height+r.top+r.bottom]),{stroke:{color:v,...t.border},fill:{color:t.background}});e.insert(0,i)}}e.append(r),t.color?this.textElements.forEach(e=>{e.fill(t.color)}):!i&&!a&&(this._fill(),this._stroke())}_textLines(e){let{text:t=``}=this.options;if(e===void 0)return t.split(`
`);let n=Gp(this.options),r=gr,i=[];return t.split(`
`).forEach(t=>{let a=t.split(` `),o=``;a.forEach(t=>{for(;r(t,n).width>e;){let a=``;for(let i=1;i<=t.length;i++){let o=t.substring(0,i);if(r(o,n).width>e)break;a=o}if(!a)break;o&&=(i.push(o),``),i.push(a),t=t.substring(a.length)}let a=o?`${o} ${t}`:t;r(a,n).width>e&&o?(i.push(o),o=t):o=a}),i.push(o||` `)}),i}},qp=class extends Yd{constructor(e){if(super(),k(e))throw Error(`Diagram is not specified.`);this.diagram=e}layout(e){this.transferOptions(e);let t=new ef(this.diagram).convert(e);if(t.isEmpty())return;let n=t.getConnectedComponents();if(Ze(n))return;for(let t=0;t<n.length;t++){let r=n[t];this.layoutGraph(r,e)}let r=this.gridLayoutComponents(n);return new Xd(this.diagram,r)}_initRuntimeProperties(){for(let e=0;e<this.graph.nodes.length;e++){let t=this.graph.nodes[e];t.layer=-1,t.downstreamLinkCount=0,t.upstreamLinkCount=0,t.isVirtual=!1,t.uBaryCenter=0,t.dBaryCenter=0,t.upstreamPriority=0,t.downstreamPriority=0,t.gridPosition=0}}_prepare(e){let t=[],n,r,i,a=new P,o=0,s,c,l;for(j(e.nodes,function(e){e.incoming.length===0&&(a.set(e,0),t.push(e))});t.length>0;)for(c=t.shift(),n=0;n<c.outgoing.length;n++)i=c.outgoing[n],l=i.target,s=a.containsKey(l)?Math.max(a.get(c)+1,a.get(l)):a.get(c)+1,a.set(l,s),s>o&&(o=s),N(t,l)||t.push(l);let u=a.keys();u.sort(function(e,t){let n=a.get(e);return st(a.get(t)-n)});for(let e=0;e<u.length;++e){let t=u[e],n=Number.MAX_VALUE;if(t.outgoing.length!==0){for(r=0;r<t.outgoing.length;++r)i=t.outgoing[r],n=Math.min(n,a.get(i.target));n>1&&a.set(t,n-1)}}this.layers=[];let d;for(n=0;n<o+1;n++)d=[],d.linksTo={},this.layers.push(d);for(a.forEach(function(e,t){e.layer=t,this.layers[t].push(e)},this),r=0;r<this.layers.length;r++)for(d=this.layers[r],n=0;n<d.length;n++)d[n].gridPosition=n}layoutGraph(e,t){if(k(e))throw Error(`No graph given or graph analysis of the diagram failed.`);D(t)&&this.transferOptions(t),this.graph=e,e.setItemIndices();let n=e.makeAcyclic();this._initRuntimeProperties(),this._prepare(e),this._dummify(),this._optimizeCrossings(),this._swapPairs(),this.arrangeNodes(),this._moveThingsAround(),this._dedummify(),j(n,function(e){e.points&&e.points.reverse()})}setMinDist(e,t,n){let r=e.layer,i=e.layerIndex;if(!Number.isInteger(r)||!Number.isInteger(i)||r<0||i<0)throw Error(`Invalid layer or index value.`);this.minDistances[r][i]=n}getMinDist(e,t){let n=0,r=e.layerIndex,i=t.layerIndex,a=e.layer,o=Math.min(r,i),s=Math.max(r,i);for(let e=o;e<s;++e)n+=this.minDistances[a][e];return n}placeLeftToRight(e){let t=new P,n,r;for(let i=0;i<this.layers.length;++i){let a=e[i];if(!a)continue;for(n=0;n<a.length;n++)r=a[n],t.containsKey(r)||this.placeLeft(r,t,i);let o=1/0;for(n=0;n<a.length;n++){r=a[n];let e=this.rightSibling(r);e&&this.nodeLeftClass.get(e)!==i&&(o=Math.min(o,t.get(e)-t.get(r)-this.getMinDist(r,e)))}if(o===1/0){let e=[];for(n=0;n<a.length;n++){r=a[n];let o=[];bt(o,this.upNodes.get(r)),bt(o,this.downNodes.get(r));for(let n=0;n<o.length;n++){let a=o[n];this.nodeLeftClass.get(a)<i&&e.push(t.get(a)-t.get(r))}}e.sort(),o=e.length===0?0:e.length%2==1?e[this.intDiv(e.length,2)]:(e[this.intDiv(e.length,2)-1]+e[this.intDiv(e.length,2)])/2}for(n=0;n<a.length;n++)r=a[n],t.set(r,t.get(r)+o)}return t}placeRightToLeft(e){let t=new P,n,r;for(let i=0;i<this.layers.length;++i){let a=e[i];if(!a)continue;for(n=0;n<a.length;n++)r=a[n],t.containsKey(r)||this.placeRight(r,t,i);let o=-1/0;for(n=0;n<a.length;n++){r=a[n];let e=this.leftSibling(r);e&&this.nodeRightClass.get(e)!==i&&(o=Math.max(o,t.get(e)-t.get(r)+this.getMinDist(e,r)))}if(o===-1/0){let e=[];for(n=0;n<a.length;n++){r=a[n];let o=[];bt(o,this.upNodes.get(r)),bt(o,this.downNodes.get(r));for(let n=0;n<o.length;n++){let a=o[n];this.nodeRightClass.get(a)<i&&e.push(t.get(r)-t.get(a))}}e.sort(),o=e.length===0?0:e.length%2==1?e[this.intDiv(e.length,2)]:(e[this.intDiv(e.length,2)-1]+e[this.intDiv(e.length,2)])/2}for(n=0;n<a.length;n++)r=a[n],t.set(r,t.get(r)+o)}return t}_getLeftWing(){let e={value:null},t=this.computeClasses(e,1);return this.nodeLeftClass=e.value,t}_getRightWing(){let e={value:null},t=this.computeClasses(e,-1);return this.nodeRightClass=e.value,t}computeClasses(e,t){let n=0,r=e.value=new P;for(let e=0;e<this.layers.length;++e){n=e;let i=this.layers[e];for(let e=t===1?0:i.length-1;e>=0&&e<i.length;e+=t){let t=i[e];if(r.containsKey(t))n=r.get(t);else if(r.set(t,n),t.isVirtual){let e=this._nodesInLink(t);for(let t=0;t<e.length;t++){let i=e[t];r.set(i,n)}}}}let i=[];for(let e=0;e<this.layers.length;e++)i.push(null);return r.forEach(function(e,t){i[t]===null&&(i[t]=[]),i[t].push(e)}),i}_isVerticalLayout(){return this.options.subtype.toLowerCase()===`up`||this.options.subtype.toLowerCase()===`down`||this.options.subtype.toLowerCase()===`vertical`}_isHorizontalLayout(){return this.options.subtype.toLowerCase()===`right`||this.options.subtype.toLowerCase()===`left`||this.options.subtype.toLowerCase()===`horizontal`}_isIncreasingLayout(){return this.options.subtype.toLowerCase()===`right`||this.options.subtype.toLowerCase()===`down`}_moveThingsAround(){let e,t,n,r,i,a;for(t=0;t<this.layers.length;++t)r=this.layers[t],r.sort(this._gridPositionComparer.bind(this));for(this.minDistances=[],t=0;t<this.layers.length;++t)for(r=this.layers[t],this.minDistances[t]=[],i=0;i<r.length;++i)n=r[i],n.layerIndex=i,this.minDistances[t][i]=this.options.nodeDistance,i<r.length-1&&(this._isVerticalLayout()?this.minDistances[t][i]+=(n.width+r[i+1].width)/2:this.minDistances[t][i]+=(n.height+r[i+1].height)/2);for(this.downNodes=new P,this.upNodes=new P,j(this.graph.nodes,function(e){this.downNodes.set(e,[]),this.upNodes.set(e,[])},this),j(this.graph.links,function(e){let t=e.source,n=e.target,r=null,i=null;t.layer>n.layer?(r=e.source,i=e.target):(i=e.source,r=e.target),this.downNodes.get(i).push(r),this.upNodes.get(r).push(i)},this),this.downNodes.forEachValue(function(e){e.sort(this._gridPositionComparer)},this),this.upNodes.forEachValue(function(e){e.sort(this._gridPositionComparer)},this),t=0;t<this.layers.length-1;++t)for(r=this.layers[t],a=0;a<r.length-1;a++){let e=r[a];if(!e.isVirtual)continue;let o=this.downNodes.get(e)[0];if(o.isVirtual)for(i=a+1;i<r.length;++i){if(n=r[i],!n.isVirtual)continue;let e=this.downNodes.get(n)[0];if(e.isVirtual&&o.gridPosition>e.gridPosition){let n=o.gridPosition;o.gridPosition=e.gridPosition,e.gridPosition=n;let r=o.layerIndex,i=e.layerIndex;this.layers[t+1][r]=e,this.layers[t+1][i]=o,o.layerIndex=i,e.layerIndex=r}}}let o=this._getLeftWing(),s=this._getRightWing(),c=this.placeLeftToRight(o),l=this.placeRightToLeft(s),u=new P;j(this.graph.nodes,function(e){u.set(e,(c.get(e)+l.get(e))/2)});let d=new P,f=new P;for(t=0;t<this.layers.length;++t){r=this.layers[t];let e=-1;for(i=0;i<r.length;++i)n=r[i],d.set(n,0),f.set(n,!1),n.isVirtual&&(e===-1||e===i-1?e=i:(d.set(r[e],0),u.get(n)-u.get(r[e])===this.getMinDist(r[e],n)?f.set(r[e],!0):f.set(r[e],!1),e=i))}j([1,-1],function(t){let n=t===1?0:this.layers.length-1;for(let r=n;r>=0&&r<this.layers.length;r+=t){let n=this.layers[r],i=this._firstVirtualNode(n),a=null,o=null;if(i!==-1)for(a=n[i],o=[],e=0;e<i;e++)o.push(n[e]);else a=null,o=n;if(o.length>0){for(this._sequencer(u,null,a,t,o),e=0;e<o.length-1;++e)this.setMinDist(o[e],o[e+1],u.get(o[e+1])-u.get(o[e]));a&&this.setMinDist(o[o.length-1],a,u.get(a)-u.get(o[o.length-1]))}for(;a;){let r=this.nextVirtualNode(n,a);if(!r){for(i=a.layerIndex,o=[],e=i+1;e<n.length;e++)o.push(n[e]);if(o.length>0){for(this._sequencer(u,a,null,t,o),e=0;e<o.length-1;++e)this.setMinDist(o[e],o[e+1],u.get(o[e+1])-u.get(o[e]));this.setMinDist(a,o[0],u.get(o[0])-u.get(a))}}else if(d.get(a)===t){i=a.layerIndex;let s=r.layerIndex;for(o=[],e=i+1;e<s;e++)o.push(n[e]);o.length>0&&this._sequencer(u,a,r,t,o),f.set(a,!0)}a=r}this.adjustDirections(r,t,d,f)}},this);let p=this._isIncreasingLayout()?0:this.layers.length-1,m=function(e,t){return t._isIncreasingLayout()?e<t.layers.length:e>=0},h=this._isIncreasingLayout()?1:-1,g=0;function _(e,t){let n=Number.MIN_VALUE;for(let r=0;r<e.length;++r){let i=e[r];n=t._isVerticalLayout()?Math.max(n,i.height):Math.max(n,i.width)}return n}for(e=p;m(e,this);e+=h){r=this.layers[e];let t=_(r,this);for(i=0;i<r.length;++i)n=r[i],this._isVerticalLayout()?(n.x=u.get(n),n.y=g+t/2):(n.x=g+t/2,n.y=u.get(n));g+=this.options.layerSeparation+t}}adjustDirections(e,t,n,r){if(e+t<0||e+t>=this.layers.length)return;let i=null,a=null,o=this.layers[e+t];for(let s=0;s<o.length;++s){let c=o[s];if(c.isVirtual){let s=this.getNeighborOnLayer(c,e);if(s.isVirtual){if(i){let l=r.get(a),u=this.layers[e],d=a.layerIndex,f=s.layerIndex;for(let e=d+1;e<f;++e)u[e].isVirtual&&(l&&=r.get(u[e]));if(l){n.set(i,t);let e=i.layerIndex,r=c.layerIndex;for(let i=e+1;i<r;++i)o[i].isVirtual&&n.set(o[i],t)}}i=c,a=s}}}}getNeighborOnLayer(e,t){let n=this.upNodes.get(e)[0];return n.layer===t||(n=this.downNodes.get(e)[0],n.layer===t)?n:null}_sequencer(e,t,n,r,i){if(i.length===1&&this._sequenceSingle(e,t,n,r,i[0]),i.length>1){let a=i.length,o=this.intDiv(a,2);this._sequencer(e,t,n,r,i.slice(0,o)),this._sequencer(e,t,n,r,i.slice(o)),this.combineSequences(e,t,n,r,i)}}_sequenceSingle(e,t,n,r,i){let a=r===-1?this.downNodes.get(i):this.upNodes.get(i),o=a.length;o!==0&&(o%2==1?e.set(i,e.get(a[this.intDiv(o,2)])):e.set(i,(e.get(a[this.intDiv(o,2)-1])+e.get(a[this.intDiv(o,2)]))/2),t&&e.set(i,Math.max(e.get(i),e.get(t)+this.getMinDist(t,i))),n&&e.set(i,Math.min(e.get(i),e.get(n)-this.getMinDist(i,n))))}combineSequences(e,t,n,r,i){let a=i.length,o=this.intDiv(a,2),s=[],c,l,u,d,f,p;for(c=0;c<o;++c){for(l=0,d=r===-1?this.downNodes.get(i[c]):this.upNodes.get(i[c]),u=0;u<d.length;++u)f=d[u],e.get(f)>=e.get(i[c])?l++:(l--,s.push({k:e.get(f)+this.getMinDist(i[c],i[o-1]),v:2}));s.push({k:e.get(i[c])+this.getMinDist(i[c],i[o-1]),v:l})}t&&s.push({k:e.get(t)+this.getMinDist(t,i[o-1]),v:Number.MAX_VALUE}),s.sort(this._positionDescendingComparer.bind(this));let m=[];for(c=o;c<a;++c){for(l=0,d=r===-1?this.downNodes.get(i[c]):this.upNodes.get(i[c]),u=0;u<d.length;++u)f=d[u],e.get(f)<=e.get(i[c])?l++:(l--,m.push({k:e.get(f)-this.getMinDist(i[c],i[o]),v:2}));m.push({k:e.get(i[c])-this.getMinDist(i[c],i[o]),v:l})}n&&m.push({k:e.get(n)-this.getMinDist(n,i[o]),v:Number.MAX_VALUE}),m.sort(this._positionAscendingComparer.bind(this));let h=0,g=0,_=this.getMinDist(i[o-1],i[o]);for(;e.get(i[o])-e.get(i[o-1])<_;)if(h<g)if(s.length===0){e.set(i[o-1],e.get(i[o])-_);break}else p=s.shift(),h+=p.v,e.set(i[o-1],p.k),e.set(i[o-1],Math.max(e.get(i[o-1]),e.get(i[o])-_));else if(m.length===0){e.set(i[o],e.get(i[o-1])+_);break}else p=m.shift(),g+=p.v,e.set(i[o],p.k),e.set(i[o],Math.min(e.get(i[o]),e.get(i[o-1])+_));for(c=o-2;c>=0;c--)e.set(i[c],Math.min(e.get(i[c]),e.get(i[o-1])-this.getMinDist(i[c],i[o-1])));for(c=o+1;c<a;c++)e.set(i[c],Math.max(e.get(i[c]),e.get(i[o])+this.getMinDist(i[c],i[o])))}placeLeft(e,t,n){let r=-1/0;j(this._getComposite(e),function(e){let i=this.leftSibling(e);i&&this.nodeLeftClass.get(i)===this.nodeLeftClass.get(e)&&(t.containsKey(i)||this.placeLeft(i,t,n),r=Math.max(r,t.get(i)+this.getMinDist(i,e)))},this),r===-1/0&&(r=0),j(this._getComposite(e),function(e){t.set(e,r)})}placeRight(e,t,n){let r=1/0;j(this._getComposite(e),function(e){let i=this.rightSibling(e);i&&this.nodeRightClass.get(i)===this.nodeRightClass.get(e)&&(t.containsKey(i)||this.placeRight(i,t,n),r=Math.min(r,t.get(i)-this.getMinDist(e,i)))},this),r===1/0&&(r=0),j(this._getComposite(e),function(e){t.set(e,r)})}leftSibling(e){let t=this.layers[e.layer],n=e.layerIndex;return n===0?null:t[n-1]}rightSibling(e){let t=this.layers[e.layer],n=e.layerIndex;return n===t.length-1?null:t[n+1]}_getComposite(e){return e.isVirtual?this._nodesInLink(e):[e]}arrangeNodes(){let e,t,n,r,i;for(t=0;t<this.layers.length;t++)for(r=this.layers[t],n=0;n<r.length;n++)i=r[n],i.upstreamPriority=i.upstreamLinkCount,i.downstreamPriority=i.downstreamLinkCount;for(let t=0;t<2;t++){for(e=this.layers.length-1;e>=1;e--)this.layoutLayer(!1,e);for(e=0;e<this.layers.length-1;e++)this.layoutLayer(!0,e)}let a=Number.MAX_VALUE;for(t=0;t<this.layers.length;t++)for(r=this.layers[t],n=0;n<r.length;n++)i=r[n],a=Math.min(a,i.gridPosition);if(a<0)for(t=0;t<this.layers.length;t++)for(r=this.layers[t],n=0;n<r.length;n++)i=r[n],i.gridPosition-=a}layoutLayer(e,t){let n,r;r=e?this.layers[n=t+1]:this.layers[n=t-1];let i=[];for(let e=0;e<r.length;e++)i.push(r[e]);i.sort(function(e,t){let n=(e.upstreamPriority+e.downstreamPriority)/2,r=(t.upstreamPriority+t.downstreamPriority)/2;return Math.abs(n-r)<1e-4?0:n<r?1:-1}),j(i,function(e){let t=e.gridPosition,n=this.calcBaryCenter(e),i=(e.upstreamPriority+e.downstreamPriority)/2;if(!(Math.abs(t-n)<1e-4)&&!(Math.abs(t-n)<.2501))if(t<n)for(;t<n&&this.moveRight(e,r,i);)t=e.gridPosition;else for(;t>n&&this.moveLeft(e,r,i);)t=e.gridPosition},this),n>0&&this.calcDownData(n-1),n<this.layers.length-1&&this.calcUpData(n+1)}moveRight(e,t,n){let r=ut(t,e);if(r===t.length-1)return e.gridPosition+=.5,!0;let i=t[r+1],a=(i.upstreamPriority+i.downstreamPriority)/2;return i.gridPosition>e.gridPosition+1?(e.gridPosition+=.5,!0):a>n||Math.abs(a-n)<1e-4?!1:this.moveRight(i,t,n)?(e.gridPosition+=.5,!0):!1}moveLeft(e,t,n){let r=ut(t,e);if(r===0)return e.gridPosition-=.5,!0;let i=t[r-1],a=(i.upstreamPriority+i.downstreamPriority)/2;return i.gridPosition<e.gridPosition-1?(e.gridPosition-=.5,!0):a>n||Math.abs(a-n)<1e-4?!1:this.moveLeft(i,t,n)?(e.gridPosition-=.5,!0):!1}mapVirtualNode(e,t){this.nodeToLinkMap.set(e,t),this.linkToNodeMap.containsKey(t)||this.linkToNodeMap.set(t,[]),this.linkToNodeMap.get(t).push(e)}_nodesInLink(e){return this.linkToNodeMap.get(this.nodeToLinkMap.get(e))}_dummify(){this.linkToNodeMap=new P,this.nodeToLinkMap=new P;let e=this.graph.links.slice(0),t=this.layers,n,r,i,a,o,s,c,l,u=function(e,n,r){t[e].linksTo[n]=t[e].linksTo[n]||[],t[e].linksTo[n].push(r)};for(l=0;l<e.length;l++){let d=e[l],f=d.source,p=d.target,m=f.layer,h=p.layer,g=f.gridPosition,_=p.gridPosition,v=(_-g)/Math.abs(h-m),y=f;if(m-h>1){for(c=m-1;c>h;c--){for(i=new Zd,i.x=f.x,i.y=f.y,i.width=f.width/100,i.height=f.height/100,n=t[c],r=(c-h)*v+g,r>n.length&&(r=n.length),g>=t[m].length-1&&_>=t[h].length-1?r=n.length:g===0&&_===0&&(r=0),i.layer=c,i.uBaryCenter=0,i.dBaryCenter=0,i.upstreamLinkCount=0,i.downstreamLinkCount=0,i.gridPosition=r,i.isVirtual=!0,gt(n,i,r),o=r+1;o<n.length;o++)a=n[o],a.gridPosition+=1;s=new Qd(y,i),s.depthOfDumminess=0,u(c-1,c,s),y=i,this.graph._addNode(i),this.graph.addLink(s),i.index=this.graph.nodes.length-1,this.mapVirtualNode(i,d)}u(h-1,h,s),d.changeSource(y),d.depthOfDumminess=m-h-1}else if(m-h<-1){for(c=m+1;c<h;c++){for(i=new Zd,i.x=f.x,i.y=f.y,i.width=f.width/100,i.height=f.height/100,n=t[c],r=(c-m)*v+g,r>n.length&&(r=n.length),g>=t[m].length-1&&_>=t[h].length-1?r=n.length:g===0&&_===0&&(r=0),i.layer=c,i.uBaryCenter=0,i.dBaryCenter=0,i.upstreamLinkCount=0,i.downstreamLinkCount=0,i.gridPosition=r,i.isVirtual=!0,r=Math.floor(r),gt(n,i,r),o=r+1;o<n.length;o++)a=n[o],a.gridPosition+=1;s=new Qd(y,i),s.depthOfDumminess=0,u(c-1,c,s),y=i,this.graph._addNode(i),this.graph.addLink(s),i.index=this.graph.nodes.length-1,this.mapVirtualNode(i,d)}u(h-1,h,d),d.changeSource(y),d.depthOfDumminess=h-m-1}else u(m,h,d)}}_dedummify(){let e=!0;for(;e;){e=!1;for(let t=0;t<this.graph.links.length;t++){let n=this.graph.links[t];if(!n.depthOfDumminess)continue;let r=[];r.unshift({x:n.target.x,y:n.target.y}),r.unshift({x:n.source.x,y:n.source.y});let i=n,a=n.depthOfDumminess;for(let e=0;e<a;e++){let e=i.source.incoming[0];r.unshift({x:e.source.x,y:e.source.y}),i=e}n.changeSource(i.source),n.depthOfDumminess=0,r.length>2?(r.splice(0,1),r.splice(r.length-1),n.points=r):n.points=[],e=!0;break}}}_optimizeCrossings(){let e=-1,t,n=0;for(;e!==0&&!(n++>3);){for(e=0,t=this.layers.length-1;t>=1;t--)e+=this.optimizeLayerCrossings(!1,t);for(t=0;t<this.layers.length-1;t++)e+=this.optimizeLayerCrossings(!0,t)}}calcUpData(e){if(e===0)return;let t=this.layers[e],n,r,i,a=new lf,o=this.layers[e-1];for(n=0;n<o.length;n++)a.add(o[n]);for(n=0;n<t.length;n++){let e=t[n],o=0,s=0;for(r=0;r<e.incoming.length;r++)i=e.incoming[r],a.contains(i.source)&&(s++,o+=i.source.gridPosition);for(r=0;r<e.outgoing.length;r++)i=e.outgoing[r],a.contains(i.target)&&(s++,o+=i.target.gridPosition);s>0?(e.uBaryCenter=o/s,e.upstreamLinkCount=s):(e.uBaryCenter=n,e.upstreamLinkCount=0)}}calcDownData(e){if(e===this.layers.length-1)return;let t=this.layers[e],n,r,i,a=new lf,o=this.layers[e+1];for(n=0;n<o.length;n++)a.add(o[n]);for(n=0;n<t.length;n++){let e=t[n],o=0,s=0;for(r=0;r<e.incoming.length;r++)i=e.incoming[r],a.contains(i.source)&&(s++,o+=i.source.gridPosition);for(r=0;r<e.outgoing.length;r++)i=e.outgoing[r],a.contains(i.target)&&(s++,o+=i.target.gridPosition);s>0?(e.dBaryCenter=o/s,e.downstreamLinkCount=s):(e.dBaryCenter=n,e.downstreamLinkCount=0)}}optimizeLayerCrossings(e,t){let n,r;r=e?this.layers[n=t+1]:this.layers[n=t-1];let i=r.slice(0);e?this.calcUpData(n):this.calcDownData(n),r.sort((e,t)=>{let n=this.calcBaryCenter(e),r=this.calcBaryCenter(t);if(Math.abs(n-r)<1e-4)return e.degree()===t.degree()?this.compareByIndex(e,t):e.degree()<t.degree()?1:-1;let i=(r-n)*1e3;return i>0?-1:i<0?1:this.compareByIndex(e,t)});let a,o=0;for(a=0;a<r.length;a++)r[a]!==i[a]&&o++;if(o>0){let e=0;for(a=0;a<r.length;a++){let t=r[a];t.gridPosition=e++}}return o}_swapPairs(){let e=this.options.layeredIterations,t=0;for(;!(t++>e);){let e=t%4<=1,n=t%4==1;for(let t=e?0:this.layers.length-1;e?t<=this.layers.length-1:t>=0;t+=e?1:-1){let r=this.layers[t],i=!1,a=!0,o=0;for(let s=0;s<r.length-1;s++){let c=0,l=0,u=0;if(a?(t!==0&&(c=this.countLinksCrossingBetweenTwoLayers(t-1,t)),t!==this.layers.length-1&&(l=this.countLinksCrossingBetweenTwoLayers(t,t+1)),e?c*=2:l*=2,u=c+l):u=o,u===0)continue;let d=r[s],f=r[s+1],p=d.gridPosition,m=f.gridPosition;r[s]=f,r[s+1]=d,d.gridPosition=m,f.gridPosition=p,c=0,t!==0&&(c=this.countLinksCrossingBetweenTwoLayers(t-1,t)),l=0,t!==this.layers.length-1&&(l=this.countLinksCrossingBetweenTwoLayers(t,t+1)),e?c*=2:l*=2;let h=c+l,g=!1;g=n?h>=u:h>u,g?(d=r[s],f=r[s+1],p=d.gridPosition,m=f.gridPosition,r[s]=f,r[s+1]=d,d.gridPosition=m,f.gridPosition=p,o=u,a=!1):(i=!0,a=!0)}i&&(t!==this.layers.length-1&&this.calcUpData(t+1),t!==0&&this.calcDownData(t-1))}}}countLinksCrossingBetweenTwoLayers(e,t){let n=this.layers[e].linksTo[t],r,i,a,o,s,c,l,u,d=0,f=n.length;for(l=0;l<f;l++)for(r=n[l],u=l+1;u<f;u++){i=n[u],r.target.layer===t?(a=r.source,o=r.target):(a=r.target,o=r.source),i.target.layer===t?(s=i.source,c=i.target):(s=i.target,c=i.source);let e=a.gridPosition,l=o.gridPosition,f=s.gridPosition,p=c.gridPosition;(e-f)*(l-p)<0&&d++}return d}calcBaryCenter(e){let t=e.upstreamLinkCount,n=e.downstreamLinkCount,r=e.uBaryCenter,i=e.dBaryCenter;return t>0&&n>0?(r+i)/2:t>0?r:n>0?i:0}_gridPositionComparer(e,t){return e.gridPosition<t.gridPosition?-1:e.gridPosition>t.gridPosition?1:0}_positionAscendingComparer(e,t){return e.k<t.k?-1:e.k>t.k?1:0}_positionDescendingComparer(e,t){return e.k<t.k?1:e.k>t.k?-1:0}_firstVirtualNode(e){for(let t=0;t<e.length;t++)if(e[t].isVirtual)return t;return-1}compareByIndex(e,t){let n=e.index,r=t.index;return n<r?1:n>r?-1:0}intDiv(e,t){return(e-e%t)/t}nextVirtualNode(e,t){let n=t.layerIndex;for(let t=n+1;t<e.length;++t)if(e[t].isVirtual)return e[t];return null}},Jp=class{constructor(e){this.center=null,this.options=e}layout(e,t){if(this.graph=e,!(!this.graph.nodes||this.graph.nodes.length===0)){if(!N(this.graph.nodes,t))throw Error(`The given root is not in the graph.`);this.center=t,this.graph.cacheRelationships(),this.layoutSwitch()}}layoutLeft(e){this.setChildrenDirection(this.center,`Left`,!1),this.setChildrenLayout(this.center,`Default`,!1);let t=0,n=0,r,i,a;for(i=0;i<e.length;i++){a=e[i],a.TreeDirection=`Left`;let r=this.measure(a,uf.Empty.bind(this));n=Math.max(n,r.width),t+=r.height+this.options.verticalSeparation}t-=this.options.verticalSeparation;let o=this.center.x-this.options.horizontalSeparation;for(r=this.center.y+(this.center.height-t)/2,i=0;i<e.length;i++){a=e[i];let t=new K(o-a.Size.width,r);this.arrange(a,t),r+=a.Size.height+this.options.verticalSeparation}}layoutRight(e){this.setChildrenDirection(this.center,`Right`,!1),this.setChildrenLayout(this.center,`Default`,!1);let t=0,n=0,r,i,a;for(i=0;i<e.length;i++){a=e[i],a.TreeDirection=`Right`;let r=this.measure(a,uf.Empty.bind(this));n=Math.max(n,r.width),t+=r.height+this.options.verticalSeparation}t-=this.options.verticalSeparation;let o=this.center.x+this.options.horizontalSeparation+this.center.width;for(r=this.center.y+(this.center.height-t)/2,i=0;i<e.length;i++){a=e[i];let t=new K(o,r);this.arrange(a,t),r+=a.Size.height+this.options.verticalSeparation}}layoutUp(e){this.setChildrenDirection(this.center,`Up`,!1),this.setChildrenLayout(this.center,`Default`,!1);let t=0,n,r,i;for(i=0;i<e.length;i++){r=e[i],r.TreeDirection=`Up`;let n=this.measure(r,uf.Empty.bind(this));t+=n.width+this.options.horizontalSeparation}t-=this.options.horizontalSeparation;let a=this.center.x+this.center.width/2-t/2;for(i=0;i<e.length;i++){r=e[i],n=this.center.y-this.options.verticalSeparation-r.Size.height;let t=new K(a,n);this.arrange(r,t),a+=r.Size.width+this.options.horizontalSeparation}}layoutDown(e){let t,n;this.setChildrenDirection(this.center,`Down`,!1),this.setChildrenLayout(this.center,`Default`,!1);let r=0;for(n=0;n<e.length;n++){t=e[n],t.treeDirection=`Down`;let i=this.measure(t,uf.Empty.bind(this));r+=i.width+this.options.horizontalSeparation}r-=this.options.horizontalSeparation;let i=this.center.x+this.center.width/2-r/2,a=this.center.y+this.options.verticalSeparation+this.center.height;for(n=0;n<e.length;n++){t=e[n];let r=new K(i,a);this.arrange(t,r),i+=t.Size.width+this.options.horizontalSeparation}}layoutRadialTree(){this.setChildrenDirection(this.center,`Radial`,!1),this.setChildrenLayout(this.center,`Default`,!1),this.previousRoot=null;let e=this.options.startRadialAngle*ee,t=this.options.endRadialAngle*ee;if(t<=e)throw Error(`Final angle should not be less than the start angle.`);this.maxDepth=0,this.origin=new K(this.center.x,this.center.y),this.calculateAngularWidth(this.center,0),this.maxDepth>0&&this.radialLayout(this.center,this.options.radialFirstLevelSeparation,e,t),this.center.Angle=t-e}tipOverTree(e,t){k(t)&&(t=0),this.setChildrenDirection(this.center,`Down`,!1),this.setChildrenLayout(this.center,`Default`,!1),this.setChildrenLayout(this.center,`Underneath`,!1,t);let n=0,r,i;for(i=0;i<e.length;i++){r=e[i],r.TreeDirection=`Down`;let t=this.measure(r,uf.Empty.bind(this));n+=t.width+this.options.horizontalSeparation}n-=this.options.horizontalSeparation,n-=e[e.length-1].width,n+=e[e.length-1].associatedShape.bounds().width;let a=this.center.x+this.center.width/2-n/2,o=this.center.y+this.options.verticalSeparation+this.center.height;for(i=0;i<e.length;i++){r=e[i];let t=new K(a,o);this.arrange(r,t),a+=r.Size.width+this.options.horizontalSeparation}}calculateAngularWidth(e,t){t>this.maxDepth&&(this.maxDepth=t);let n=1e3,r=1e3,i=t===0?0:Math.sqrt(n*n+r*r)/t,a=0;if(e.children.length>0){for(let n=0,r=e.children.length;n<r;n++){let r=e.children[n];a+=this.calculateAngularWidth(r,t+1)}a=Math.max(i,a)}else a=i;return e.sectorAngle=a,a}sortChildren(e){let t=0,n;if(e.parents.length>1)throw Error(`Node is not part of a tree.`);let r=e.parents[0];if(r){let n=new K(r.x,r.y),i=new K(e.x,e.y);t=this.normalizeAngle(Math.atan2(n.y-i.y,n.x-i.x))}let i=e.children.length;if(i===0)return null;let a=[],o=[];for(n=0;n<i;++n){let r=e.children[n],i=new K(r.x,r.y);o[n]=n,a[n]=this.normalizeAngle(-t+Math.atan2(i.y-i.y,i.x-i.x))}yt(a,o);let s=[],c=e.children;for(n=0;n<i;++n)s.push(c[o[n]]);return s}normalizeAngle(e){for(;e>Math.PI*2;)e-=2*Math.PI;for(;e<0;)e+=Math.PI*2;return e}radialLayout(e,t,n,r){let i=r-n,a=i/2,o=e.sectorAngle,s=0,c=this.sortChildren(e);for(let e=0,r=c.length;e<r;e++){let r=c[e],l=r,u=l.sectorAngle/o;r.children.length>0&&this.radialLayout(r,t+this.options.radialSeparation,n+s*i,n+(s+u)*i),this.setPolarLocation(r,t,n+s*i+u*a),l.angle=u*i,s+=u}}setPolarLocation(e,t,n){e.x=this.origin.x+t*Math.cos(n),e.y=this.origin.y+t*Math.sin(n),e.BoundingRectangle=new q(e.x,e.y,e.width,e.height)}setChildrenDirection(e,t,n){let r=e.treeDirection;this.graph.depthFirstTraversal(e,e=>{e.treeDirection=t}),n||(e.treeDirection=r)}setChildrenLayout(e,t,n,r){k(r)&&(r=0);let i=e.childrenLayout;r>0?(this.graph.assignLevels(e),this.graph.depthFirstTraversal(e,e=>{e.level>=r+1&&(e.childrenLayout=t)})):(this.graph.depthFirstTraversal(e,e=>{e.childrenLayout=t}),n||(e.childrenLayout=i))}measure(e,t){let n=0,r=0,i,a=new uf(0,0);if(!e)throw Error(`Node is not defined.`);let o=e.associatedShape.bounds(),s=o.width,c=o.height;if(e.parents.length!==1)throw Error(`Node not in a spanning tree.`);let l=e.parents[0];if(e.treeDirection===`Undefined`&&(e.treeDirection=l.treeDirection),Ze(e.children))a=new uf(Math.abs(s)<te?50:s,Math.abs(c)<te?25:c);else if(e.children.length===1){switch(e.treeDirection){case`Radial`:i=this.measure(e.children[0],t),n=s+this.options.radialSeparation*Math.cos(e.AngleToParent)+i.width,r=c+Math.abs(this.options.radialSeparation*Math.sin(e.AngleToParent))+i.height;break;case`Left`:case`Right`:switch(e.childrenLayout){case`TopAlignedWithParent`:break;case`BottomAlignedWithParent`:break;case`Underneath`:i=this.measure(e.children[0],t),n=s+i.width+this.options.underneathHorizontalOffset,r=c+this.options.underneathVerticalTopOffset+i.height;break;case`Default`:i=this.measure(e.children[0],t),n=s+this.options.horizontalSeparation+i.width,r=Math.max(c,i.height);break;default:throw Error(`Unhandled TreeDirection in the Radial layout measuring.`)}break;case`Up`:case`Down`:switch(e.childrenLayout){case`TopAlignedWithParent`:case`BottomAlignedWithParent`:break;case`Underneath`:i=this.measure(e.children[0],t),n=Math.max(s,i.width+this.options.underneathHorizontalOffset),r=c+this.options.underneathVerticalTopOffset+i.height;break;case`Default`:i=this.measure(e.children[0],t),r=c+this.options.verticalSeparation+i.height,n=Math.max(s,i.width);break;default:throw Error(`Unhandled TreeDirection in the Down layout measuring.`)}break;default:throw Error(`Unhandled TreeDirection in the layout measuring.`)}a=new uf(n,r)}else{let o,l;switch(e.treeDirection){case`Left`:case`Right`:switch(e.childrenLayout){case`TopAlignedWithParent`:case`BottomAlignedWithParent`:break;case`Underneath`:for(n=s,r=c+this.options.underneathVerticalTopOffset,o=0;o<e.children.length;o++)l=e.children[o],i=this.measure(l,t),n=Math.max(n,i.width+this.options.underneathHorizontalOffset),r+=i.height+this.options.underneathVerticalSeparation;r-=this.options.underneathVerticalSeparation;break;case`Default`:for(n=s,r=0,o=0;o<e.children.length;o++)l=e.children[o],i=this.measure(l,t),n=Math.max(n,s+this.options.horizontalSeparation+i.width),r+=i.height+this.options.verticalSeparation;r-=this.options.verticalSeparation;break;default:throw Error(`Unhandled TreeDirection in the Right layout measuring.`)}break;case`Up`:case`Down`:switch(e.childrenLayout){case`TopAlignedWithParent`:case`BottomAlignedWithParent`:break;case`Underneath`:for(n=s,r=c+this.options.underneathVerticalTopOffset,o=0;o<e.children.length;o++)l=e.children[o],i=this.measure(l,t),n=Math.max(n,i.width+this.options.underneathHorizontalOffset),r+=i.height+this.options.underneathVerticalSeparation;r-=this.options.underneathVerticalSeparation;break;case`Default`:for(n=0,r=0,o=0;o<e.children.length;o++)l=e.children[o],i=this.measure(l,t),n+=i.width+this.options.horizontalSeparation,r=Math.max(r,i.height+this.options.verticalSeparation+c);n-=this.options.horizontalSeparation;break;default:throw Error(`Unhandled TreeDirection in the Down layout measuring.`)}break;default:throw Error(`Unhandled TreeDirection in the layout measuring.`)}a=new uf(n,r)}return e.SectorAngle=Math.sqrt(n*n/4+r*r/4),e.Size=a,a}arrange(e,t){let n=e.associatedShape.bounds(),r,i,a,o,s,c=n.width,l=n.height;if(Ze(e.children))e.x=t.x,e.y=t.y,e.BoundingRectangle=new q(t.x,t.y,c,l);else{let n,u,d;switch(e.treeDirection){case`Left`:switch(e.childrenLayout){case`TopAlignedWithParent`:case`BottomAlignedWithParent`:break;case`Underneath`:for(d=t,e.x=d.x,e.y=d.y,e.BoundingRectangle=new q(e.x,e.y,e.width,e.height),u=t.y+l+this.options.underneathVerticalTopOffset,r=0;r<o.children.length;r++)o=o.children[r],n=d.x-o.associatedShape.width-this.options.underneathHorizontalOffset,i=new K(n,u),this.arrange(o,i),u+=o.Size.height+this.options.underneathVerticalSeparation;break;case`Default`:for(d=new K(t.x+e.Size.width-c,t.y+(e.Size.height-l)/2),e.x=d.x,e.y=d.y,e.BoundingRectangle=new q(e.x,e.y,e.width,e.height),n=d.x-this.options.horizontalSeparation,u=t.y,r=0;r<e.children.length;r++)o=e.children[r],i=new K(n-o.Size.width,u),this.arrange(o,i),u+=o.Size.height+this.options.verticalSeparation;break;default:throw Error(`Unsupported TreeDirection`)}break;case`Right`:switch(e.childrenLayout){case`TopAlignedWithParent`:case`BottomAlignedWithParent`:break;case`Underneath`:for(d=t,e.x=d.x,e.y=d.y,e.BoundingRectangle=new q(e.x,e.y,e.width,e.height),n=t.x+c+this.options.underneathHorizontalOffset,u=t.y+l+this.options.underneathVerticalTopOffset,r=0;r<e.children.length;r++)o=e.children[r],i=new K(n,u),this.arrange(o,i),u+=o.Size.height+this.options.underneathVerticalSeparation;break;case`Default`:for(d=new K(t.x,t.y+(e.Size.height-l)/2),e.x=d.x,e.y=d.y,e.BoundingRectangle=new q(e.x,e.y,e.width,e.height),n=t.x+c+this.options.horizontalSeparation,u=t.y,r=0;r<e.children.length;r++)o=e.children[r],i=new K(n,u),this.arrange(o,i),u+=o.Size.height+this.options.verticalSeparation;break;default:throw Error(`Unsupported TreeDirection`)}break;case`Up`:if(d=new K(t.x+(e.Size.width-c)/2,t.y+e.Size.height-l),e.x=d.x,e.y=d.y,e.BoundingRectangle=new q(e.x,e.y,e.width,e.height),Math.abs(d.x-t.x)<te){for(s=0,r=0;r<e.children.length;r++)a=e.children[r],s+=a.Size.width+this.options.horizontalSeparation;s-=this.options.horizontalSeparation,n=t.x+(c-s)/2}else n=t.x;for(r=0;r<e.children.length;r++)o=e.children[r],u=d.y-this.options.verticalSeparation-o.Size.height,i=new K(n,u),this.arrange(o,i),n+=o.Size.width+this.options.horizontalSeparation;break;case`Down`:switch(e.childrenLayout){case`TopAlignedWithParent`:case`BottomAlignedWithParent`:break;case`Underneath`:for(d=t,e.x=d.x,e.y=d.y,e.BoundingRectangle=new q(e.x,e.y,e.width,e.height),n=t.x+this.options.underneathHorizontalOffset,u=t.y+l+this.options.underneathVerticalTopOffset,r=0;r<e.children.length;r++)o=e.children[r],i=new K(n,u),this.arrange(o,i),u+=o.Size.height+this.options.underneathVerticalSeparation;break;case`Default`:if(d=new K(t.x+(e.Size.width-c)/2,t.y),e.x=d.x,e.y=d.y,e.BoundingRectangle=new q(e.x,e.y,e.width,e.height),Math.abs(d.x-t.x)<te){for(s=0,r=0;r<e.children.length;r++)a=e.children[r],s+=a.Size.width+this.options.horizontalSeparation;s-=this.options.horizontalSeparation,n=t.x+(c-s)/2}else n=t.x;for(r=0;r<e.children.length;r++)o=e.children[r],u=d.y+this.options.verticalSeparation+l,i=new K(n,u),this.arrange(o,i),n+=o.Size.width+this.options.horizontalSeparation;break;default:throw Error(`Unsupported TreeDirection`)}break;case`None`:break;default:throw Error(`Unsupported TreeDirection`)}}}layoutSwitch(){if(!this.center||Ze(this.center.children))return;let e=this.options.subtype;k(e)&&(e=`Down`);let t,n,r,i,a=this.center.children;switch(e.toLowerCase()){case`radial`:case`radialtree`:this.layoutRadialTree();break;case`mindmaphorizontal`:case`mindmap`:t=this.center.children,this.center.children.length===1?this.layoutRight(t):(i=a.length/2,n=ft(this.center.children,function(e){return ut(a,e)<i}),r=ft(this.center.children,function(e){return ut(a,e)>=i}),this.layoutLeft(n),this.layoutRight(r));break;case`mindmapvertical`:t=this.center.children,this.center.children.length===1?this.layoutDown(t):(i=a.length/2,n=ft(this.center.children,function(e){return ut(a,e)<i}),r=ft(this.center.children,function(e){return ut(a,e)>=i}),this.layoutUp(n),this.layoutDown(r));break;case`right`:this.layoutRight(this.center.children);break;case`left`:this.layoutLeft(this.center.children);break;case`up`:case`bottom`:this.layoutUp(this.center.children);break;case`down`:case`top`:this.layoutDown(this.center.children);break;case`tipover`:case`tipovertree`:if(this.options.tipOverTreeStartLevel<0)throw Error(`The tip-over level should be a positive integer.`);this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel);break;case`undefined`:case`none`:break;default:break}}},Yp=class extends Yd{constructor(e){if(super(),k(e))throw Error(`No diagram specified.`);this.diagram=e}layout(e){this.transferOptions(e),this.graph=new ef(this.diagram).convert();let t=this.layoutComponents();return new Xd(this.diagram,t)}layoutComponents(){if(this.graph.isEmpty())return;let e=this.graph.getConnectedComponents();if(Ze(e))return;let t=new Jp(this.options),n=[];for(let r=0;r<e.length;r++){let i=e[r],a=this.getTree(i);if(!a)throw Error(`Failed to find a spanning tree for the component.`);let o=a.root,s=a.tree;t.layout(s,o),n.push(s)}return this.gridLayoutComponents(n)}getTree(e){let t=null;if(this.options.roots&&this.options.roots.length>0)for(let n=0,r=e.nodes.length;n<r;n++){let r=e.nodes[n];for(let e=0;e<this.options.roots.length;e++)if(this.options.roots[e]===r.associatedShape){t=r;break}}if(!t&&(t=e.root(),!t))throw Error(`Unable to find a root for the tree.`);return this.getTreeForRoot(e,t)}getTreeForRoot(e,t){let n=e.getSpanningTree(t);return k(n)||n.isEmpty()?null:{tree:n,root:n.root()}}},Xp=class{constructor(e,t){this.diagram=e,this.options=J({},this.options,t),this.visual=new lp,this.diagram._adorners.push(this)}refresh(){}},Zp=class{constructor(e,t,n){this.item=e,this._undoSource=t,this._undoTarget=n,this._redoSource=e.source(),this._redoTarget=e.target(),this.title=be}undo(){this.item._updateConnector(this._undoSource,_e),this.item._updateConnector(this._undoTarget,ve),this.item.updateModel()}redo(){this.item._updateConnector(this._redoSource,_e),this.item._updateConnector(this._redoTarget,ve),this.item.updateModel()}};function Qp(e){let t=0;return e.wheelDelta?(t=-e.wheelDelta/40,t=t>0?Math.ceil(t):Math.floor(t)):e.detail&&(t=e.detail),t}function $p(e){return e.options.name.toLowerCase()===`auto`}function em(e,t){let n=we,r,i;for(let a=0;a<t.length;a++)if(i=t[a],!$p(i)){let t=e.distanceTo(i.position());t<n&&(n=t,r=i)}return r}function tm(e,t){let n=[],r,i,a=e.drawingContainer().children,o=a.length;for(r=0;r<t.length;r++){i=t[r];for(let e=0;e<o;e++)if(a[e]===i.drawingContainer()){n.push(e);break}}return n}function nm(e){let t=e.drawingContainer().clippedBBox(null);(t.origin.x!==0||t.origin.y!==0)&&e.position(-t.origin.x,-t.origin.y)}function rm(e){let t={};return e||={},O(e.text)&&e.text!==null&&(t.text=e.text),O(e.x)&&e.x!==null&&(t.x=e.x),O(e.y)&&e.y!==null&&(t.y=e.y),O(e.width)&&e.width!==null&&(t.width=e.width),O(e.height)&&e.height!==null&&(t.height=e.height),O(e.type)&&e.type!==null&&(t.type=e.type),t}function im(e){let t={};return e||={},O(e.text)&&e.text!==null&&(t.content=e.text),O(e.type)&&e.type!==null&&(t.type=e.type),O(e.from)&&e.from!==null&&(t.from=e.from),O(e.fromConnector)&&e.fromConnector!==null&&(t.fromConnector=e.fromConnector),O(e.fromX)&&e.fromX!==null&&(t.fromX=e.fromX),O(e.fromY)&&e.fromY!==null&&(t.fromY=e.fromY),O(e.to)&&e.to!==null&&(t.to=e.to),O(e.toConnector)&&e.toConnector!==null&&(t.toConnector=e.toConnector),O(e.toX)&&e.toX!==null&&(t.toX=e.toX),O(e.toY)&&e.toY!==null&&(t.toY=e.toY),t}var am;(function(e){e.Terminator=`Terminator`,e.Process=`Process`,e.Decision=`Decision`,e.PredefinedProcess=`PredefinedProcess`,e.Document=`Document`,e.MultipleDocuments=`MultipleDocuments`,e.ManualInputOutput=`ManualInputOutput`,e.Preparation=`Preparation`,e.ManualOperation=`ManualOperation`,e.InternalStorage=`InternalStorage`,e.Display=`Display`,e.DirectAccessStorage=`DirectAccessStorage`,e.Database=`Database`,e.OnPageConnector=`OnPageConnector`,e.OffPageConnector=`OffPageConnector`,e.DataInputOutput=`DataInputOutput`,e.SummingJunction=`SummingJunction`,e.LogicalOr=`LogicalOr`,e.Merge=`Merge`,e.Extract=`Extract`,e.DataStorage=`DataStorage`,e.Delay=`Delay`,e.Sort=`Sort`,e.Collate=`Collate`})(am||={});let om=[{name:`top`},{name:`bottom`,position:function(e){let t=e.bounds().height,n=t*e.shapeVisual.options.waveRatio,r=e.getPosition(`top`);return r.y+=t-n*.4,r}},{name:`left`},{name:`right`},{name:`auto`}],sm=[{name:`top`},{name:`bottom`},{name:`left`,position:function(e){let t=e.getPosition(`left`),n=e.bounds();return t.x+=n.width/4-e.shapeVisual.options.cornerRadius*.6*(n.width/n.height),t}},{name:`right`,position:function(e){let t=e.getPosition(`right`),n=e.bounds();return t.x-=n.width/4-e.shapeVisual.options.cornerRadius*.6*(n.width/n.height),t}},{name:`auto`}],cm={[am.Extract]:sm,[am.Merge]:sm,[am.Document]:om,[am.MultipleDocuments]:om,[am.DataInputOutput]:[{name:`top`},{name:`bottom`},{name:`left`,position:function(e){let t=e.getPosition(`left`);return t.x+=e.bounds().width*e.shapeVisual.options.slantRatio/2-e.shapeVisual.options.cornerRadius/5,t}},{name:`right`,position:function(e){let t=e.getPosition(`right`);return t.x-=e.bounds().width*e.shapeVisual.options.slantRatio/2-e.shapeVisual.options.cornerRadius/5,t}},{name:`auto`}],[am.ManualOperation]:[{name:`top`},{name:`bottom`},{name:`left`,position:function(e){let t=e.getPosition(`left`);return t.x+=e.bounds().width*e.shapeVisual.options.baseShrinkRatio/(4+e.shapeVisual.options.cornerRadius/10),t}},{name:`right`,position:function(e){let t=e.getPosition(`right`);return t.x-=e.bounds().width*e.shapeVisual.options.baseShrinkRatio/(4+e.shapeVisual.options.cornerRadius/10),t}},{name:`auto`}],[am.ManualInputOutput]:[{name:`top`,position:function(e){let t=e.getPosition(`top`);return t.y+=e.bounds().height*e.shapeVisual.options.topSlantRatio/2,t}},{name:`bottom`},{name:`left`},{name:`right`},{name:`auto`}],[am.DataStorage]:[{name:`top`},{name:`bottom`},{name:`left`},{name:`right`,position:function(e){let t=e.bounds().width,n=e.getPosition(`right`);return n.x-=t*e.shapeVisual.options.ellipseRadiusXRatio,n}},{name:`auto`}]};var lm=class{constructor(e,t,n){this.shapes=t,this.undoRotates=n,this.title=`Rotation`,this.redoRotates=[],this.redoAngle=e._angle,this.adorner=e,this.center=e._innerBounds.center();for(let e=0;e<this.shapes.length;e++)this.redoRotates.push(this.redoAngle)}undo(){let e,t;for(e=0;e<this.shapes.length;e++)t=this.shapes[e],t.rotate(this.undoRotates[e],this.center,!1),`layout`in t&&t.layout(t),t.updateModel();this.adorner&&(this.adorner._initialize(),this.adorner.refresh())}redo(){let e,t;for(e=0;e<this.shapes.length;e++)t=this.shapes[e],t.rotate(this.redoRotates[e],this.center,!1),`layout`in t&&t.layout(t),t.updateModel();this.adorner&&(this.adorner._initialize(),this.adorner.refresh())}};let um={width:10,height:10,fill:{color:`Yellow`},hover:{stroke:{width:1}},offset:10};var dm=class{constructor(e,t){this.options=J({},um,t),this.connections=[],this.shape=e}position(){let e;if(e=this.options.position?this.options.position(this.shape):this.shape.getPosition(this.options.name),this.options.offset){let t=this._calculateOffset();e=e.plus(t)}return e}positionWithoutOffset(){return this.options.position?this.options.position(this.shape):this.shape.getPosition(this.options.name)}_calculateOffset(){let e=this.options.offset||0;switch((this.options.name||``).toLowerCase()){case`top`:return new K(0,-e);case`bottom`:return new K(0,e);case`left`:return new K(-e,0);case`right`:return new K(e,0);default:return new K(0,0)}}toJSON(){return{shapeId:this.shape.toString(),connector:this.options.name}}static parse(e,t){let n=t.split(`:`),r=n[0],i=n[1]||E;for(let t=0;t<e.shapes.length;t++){let n=e.shapes[t];if(n.options.id===r)return n.getConnector(i.trim())}}};let fm=[{name:`Top`},{name:ie},{name:re},{name:ne},{name:E,position:function(e){return e.getPosition(`center`)}}],pm=function(e){let t={type:`rectangle`,path:``,autoSize:!0,visual:null,x:0,y:0,minWidth:20,minHeight:20,width:100,height:100,cornerRadius:0,tooltip:{visible:!0},hover:{},accessibility:{role:`graphics-symbol`,ariaRoleDescription:Ve},editable:{connect:!0,tools:[]},connectors:fm,rotation:{angle:0}};return Qe(t,e),t},mm={compile:function(e,t){return e}};var hm=class{static register(e){mm=e}static compile(e,t={}){return mm.compile(e,t)}};function gm(e={}){let t;return e.visual?e.visual=t=hm.compile(e.visual,e):e.template?e.template=t=hm.compile(e.template,e):Ge(e.content)&&(t=e.content),t}function _m(){let e=vm(navigator.userAgent),t={};return t.mobileOS=e,t}function vm(e){let t=!1,n={wp:/(Windows Phone(?: OS)?)\s(\d+)\.(\d+(\.\d+)?)/,fire:/(Silk)\/(\d+)\.(\d+(\.\d+)?)/,android:/(Android|Android.*(?:Opera|Firefox).*?\/)\s*(\d+)\.?(\d+(\.\d+)?)?/,iphone:/(iPhone|iPod).*OS\s+(\d+)[._]([\d._]+)/,ipad:/(iPad).*OS\s+(\d+)[._]([\d_]+)/,playbook:/(PlayBook).*?Tablet\s*OS\s*(\d+)\.(\d+(\.\d+)?)/,windows:/(MSIE)\s+(\d+)\.(\d+(\.\d+)?)/,tizen:/(tizen).*?Version\/(\d+)\.(\d+(\.\d+)?)/i,sailfish:/(sailfish).*rv:(\d+)\.(\d+(\.\d+)?).*firefox/i},r={ios:/^i(phone|pad|pod)$/i,android:/^android|fire$/i,windows:/windows/,wp:/wp/,flat:/sailfish|ffos|tizen/i};for(let i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e.match(n[i])){if(i===`windows`&&`plugins`in navigator)return!1;t={},t.device=i,t.name=ym(i,r),t[t.name]=!0;break}return t}function ym(e,t,n){for(let n in t)if(t[n].test(e))return n;return n===void 0?e:n}let bm=Object.assign,xm=()=>new Date().getTime(),Sm=(e,t)=>{e.classList.add(t)},Cm=e=>{let t=document.createElement(`div`);return t.innerHTML=e,t.firstChild},wm=(e,t)=>{t.insertBefore(e,t.firstChild)},Tm=(e,t)=>{for(e.appendChild(t);e.firstChild!==t;)t.appendChild(e.firstChild)},Em=()=>{let{mobileOS:e}=_m();return e.ios||e.android},Dm=e=>{let t=e.wheelDeltaY,n;return e.wheelDelta?(t===void 0||t)&&(n=e.wheelDelta):e.detail&&e.axis===e.VERTICAL_AXIS&&(n=-e.detail*10),n},Om=e=>{let t=e.textWrap;return t===void 0&&(e.text.includes(`
`)||!km(e,Wp(e).size.width))&&(t=x),(e.border||e.position===xe)&&(t=x),t===x?Kp:zp},km=(e,t)=>{let n=e.text||``,r=Gp(e);return!n.split(`
`).find(e=>gr(e,r).width>t)},Am={hover:{},cursor:T.grip,content:{align:`center middle`},selectable:!0,serializable:!0,enable:!0};var jm=class extends Et{constructor(e){super(),this.dataItem=(e||{}).dataItem,this.options=J({id:jt()},Am,e),this.isSelected=!1,this.visual=new lp({id:this.options.id,autoSize:this.options.autoSize}),this.id=this.options.id,this._template()}_getCursor(e){return this.adorner?this.adorner._getCursor(e):this.options.cursor}visible(e){if(k(e))return this.visual.visible();this.visual.visible(e)}bounds(e){return null}refresh(){this.visual.redraw()}position(e){this.options.x=e.x,this.options.y=e.y,this.visual.position(e)}toString(){return this.options.id}serialize(){let e=J({},{options:this.options});return this.dataItem&&(e.dataItem=this.dataItem.toString()),e}_content(e){if(e!==void 0){let t=this.options;A(e)?t.content.text=e:J(t.content,e);let n=t.content,r=this._contentVisual;if(r&&Om(n).name!==r.name){let e=r.drawingContainer();e.parent.remove(e),this._contentVisual=r=null}r?this._updateContentVisual(n):this._createContentVisual(n)}return this.options.content.text}_createContentVisual(e){e.text&&(e.shapeSize=this.bounds(),this._contentVisual=new(Om(e))(e),this._contentVisual._includeInBBox=!1,this.visual.append(this._contentVisual))}_updateContentVisual(e){this._contentVisual.redraw(e)}_hitTest(e){let t=this.bounds();return this.visible()&&t.contains(e)&&this.options.enable}_template(){if(this.options.content.template){let e=this.dataItem||{},t=gm(bm({},this.options.content,{dataItem:this.dataItem||this.options.dataItem}));Ge(t)?this.options.content.text=t(e):A(t)&&(this.options.content.text=t)}}_canSelect(){return this.options.selectable!==!1}toJSON(){return{id:this.options.id}}};let Mm={Terminator:sp,Process:Np,Decision:Yf,PredefinedProcess:Ap,Document:ap,MultipleDocuments:op,ManualInputOutput:gp,Preparation:Mp,ManualOperation:vp,InternalStorage:fp,Display:tp,DirectAccessStorage:$f,Database:Kf,OnPageConnector:Hf,OffPageConnector:Sp,DataInputOutput:Wf,SummingJunction:Ip,LogicalOr:bp,Merge:yp,Extract:cp,DataStorage:Jf,Delay:Zf,Sort:Fp,Collate:Vf};var $=class e extends jm{constructor(e,t){super(e),this.name=Ve,this._originalWidth=e?.width,this._originalHeight=e?.height,this.options=J({},this.options,pm({connectors:void 0}),e),this.options.type===`text`&&(this.options.content.textWrap=`no-wrap`),this.diagram=t,this.updateOptionsFromModel(),this.connectors=[],this.type=this.options.type,this.createShapeVisual(),this.updateBounds(),this.content(this.content()),this._createConnectors()}_setOptionsFromModel(e){let t=rm(e||this.dataItem);this.options=J({},this.options,t),this.redrawVisual()}updateOptionsFromModel(e,t){if(this.diagram&&this.diagram._isEditable){let n=rm(e||this.dataItem);if(e&&t)if(!N([`x`,`y`,`width`,`height`],t))this.options.visual?this._redrawVisual():n.type&&(this.options=J({},this.options,n),this._redrawVisual()),this.options.content&&(this._template(),this.content(this.options.content));else{let n=this.bounds();n[t]=e[t],this.bounds(n)}else this.options=J({},this.options,n)}}_redrawVisual(){this.visual.clear(),this._contentVisual=null,this.options.dataItem=this.dataItem,this.createShapeVisual(),this.updateBounds()}redrawVisual(){this._redrawVisual(),this.options.content&&(this._template(),this.content(this.options.content))}updateModel(e){let t=this.diagram;t&&t._isEditable&&t.updateShapeModel(this,e)}updateBounds(){let e=this.visual._measure(!0),t=this.options;this.bounds(new q(t.x,t.y,e.width,e.height)),this._rotate(),this._alignContent()}content(e){let t=this._content(e);return this._alignContent(),t}_alignContent(){let e=this.options.content||{},t=this._contentVisual;if(t&&e.align&&t.alignable!==!1){let n=new Ud(this.visual._measure()),r=t.drawingElement.bbox(null),i=new q(0,0,r.width(),r.height()),a=n.align(i,e.align);t.position(a.topLeft())}}_createConnectors(){let e=this.options,t=e.connectors||cm[e.type]||fm,n=t.length,r=e.connectorDefaults,i,a;for(a=0;a<n;a++)i=new dm(this,J({},r,t[a])),this.connectors.push(i)}bounds(e){let t;if(e)if(A(e))switch(e){case ke:t=this._transformedBounds();break;case`absolute`:{t=this._transformedBounds();let e=this.diagram._pan;t.x+=e.x,t.y+=e.y;break}case ge:t=this._rotatedBounds();break;default:t=this._bounds;break}else this._setBounds(e),this._triggerBoundsChange(),this.diagram&&this.diagram._layouting||this.refreshConnections();else t=this._bounds;return t}_setBounds(e){let t=this.options,n=e.topLeft(),r=t.x=n.x,i=t.y=n.y,a=t.width=Math.max(e.width,t.minWidth),o=t.height=Math.max(e.height,t.minHeight);this._bounds=new q(r,i,a,o),this.visual.redraw({x:r,y:i,width:a,height:o})}position(e){if(e)this.bounds(new q(e.x,e.y,this._bounds.width,this._bounds.height));else return this._bounds.topLeft()}clone(){let t=this.serialize();return t.options.id=jt(),this.diagram&&this.diagram._isEditable&&O(this.dataItem)&&(t.options.dataItem=this.diagram.options.cloneDataItem(this.dataItem)),new e(t.options,void 0)}select(e){let t=this.diagram,n,r;if(k(e)&&(e=!0),this._canSelect()&&this.isSelected!==e)return n=[],r=[],this.isSelected=e,this.isSelected?(t._selectedItems.push(this),n.push(this)):(M(t._selectedItems,this),r.push(this)),t._internalSelection||t._selectionChanged(n,r),!0}rotate(e,t,n){let r=this.visual.rotate();if(e!==void 0){n!==!1&&this.diagram&&this.diagram.undoRedoService&&e!==r.angle&&this.diagram.undoRedoService.add(new lm(this.diagram._resizingAdorner,[this],[r.angle]),!1);let i=this.bounds(),a=new K(i.width/2,i.height/2),o,s;t&&(o=e-r.angle,s=i.center().rotate(o,t).minus(a),this._rotationOffset=this._rotationOffset.plus(s.minus(i.topLeft())),this.position(s)),this.visual.rotate(e,a),this.options.rotation.angle=e,this.diagram&&this.diagram._connectorsAdorner&&this.diagram._connectorsAdorner.refresh(),this.refreshConnections(),this.diagram&&this.diagram.trigger(ce,{item:this})}return r}connections(e){let t=[],n,r,i,a,o;for(n=0;n<this.connectors.length;n++)for(o=this.connectors[n],a=o.connections,r=0;r<a.length;r++)if(i=a[r],e===`out`){let e=i.source();e.shape&&e.shape===this&&t.push(i)}else if(e===`in`){let e=i.target();e.shape&&e.shape===this&&t.push(i)}else t.push(i);return t}refreshConnections(){this.connections().forEach(function(e){e.refresh()})}getConnector(e){let t,n;if(A(e)){for(e=e.toLocaleLowerCase(),t=0;t<this.connectors.length;t++)if(n=this.connectors[t],n.options.name.toLocaleLowerCase()===e)return n}else if(e instanceof K)return em(e,this.connectors);else return this.connectors.length?this.connectors[0]:null}getPosition(e){let t=this.bounds(),n=e.charAt(0).toLowerCase()+e.slice(1);return Ge(t[n])?this._transformPoint(t[n]()):t.center()}redraw(e){if(e){let t=this.options,n;this.shapeVisual.redraw(this._visualOptions(e)),this._diffNumericOptions(e,[g,_,`x`,`y`])&&(this.bounds(new q(t.x,t.y,t.width,t.height)),n=!0),e.connectors&&(t.connectors=e.connectors,this._updateConnectors()),t=J(t,e),(e.rotation||n)&&this._rotate(),t.content&&this.content(t.content)}}_updateConnectors(){let e=this.connections();this.connectors=[],this._createConnectors();let t,n,r;for(let i=0;i<e.length;i++)t=e[i],n=t.source(),r=t.target(),n.shape&&n.shape===this?t.source(this.getConnector(n.options.name)||null):r.shape&&r.shape===this&&t.target(this.getConnector(r.options.name)||null),t.updateModel()}_diffNumericOptions(e,t){return hf.call(this,e,t)}_visualOptions(e){return{accessibility:e.accessibility,cornerRadius:e.cornerRadius,data:e.path,source:e.source,hover:e.hover,fill:e.fill,stroke:e.stroke,dataItem:this.dataItem||e?.dataItem,autoSize:e.autoSize,id:e.id}}_triggerBoundsChange(){this.diagram&&this.diagram.trigger(le,{item:this,bounds:this._bounds.clone()})}_transformPoint(e){let t=this.rotate(),n=this.bounds().topLeft();return t.angle&&e.rotate(t.angle,t.center().plus(n)),e}_transformedBounds(){let e=this.bounds(),t=e.topLeft(),n=e.bottomRight();return q.fromPoints(this.diagram.modelToView(t),this.diagram.modelToView(n))}_rotatedBounds(){let e=this.bounds().rotatedBounds(this.rotate().angle),t=e.topLeft(),n=e.bottomRight();return q.fromPoints(t,n)}_rotate(){let e=this.options.rotation;e&&e.angle&&this.rotate(e.angle),this._rotationOffset=new K}_hover(e){let t=this.options,n=t.hover,r=t.stroke,i=t.fill;e&&D(n.stroke)&&(r=J({},r,n.stroke)),e&&D(n.fill)&&(i=n.fill),this.shapeVisual.redraw({stroke:r,fill:i}),t.editable&&t.editable.connect&&this.diagram._showConnectors(this,e)}_getMaxConnectorOffset(){let e=0;for(let t=0;t<this.connectors.length;t++){let n=this.connectors[t],r=n.options.offset||0,i=Math.max(n.options.width||0,n.options.height||0),a=n.options.stroke?.width||0,o=n.options.hover?.stroke?.width||a,s=r+i/2+Math.max(a,o);s>e&&(e=s)}return e}_hitTest(e){if(this.visible()){let t=this.bounds(),n=this.rotate().angle,r=this._getMaxConnectorOffset(),i;if(r>0&&(t=t.clone(),t.inflate(r,r)),e.isEmpty&&!e.isEmpty())return nf.rects(e,t,n||0);if(i=e.clone().rotate(n,t.center()),t.contains(i))return this}}toJSON(){return{shapeId:this.options.id}}createShapeVisual(){let e=this.options,t=this._visualOptions(e),n=e.visual?hm.compile(e.visual,e):e.visual,r=(e.type+``).toLocaleLowerCase(),i;t.width=e.width,t.height=e.height,Ge(n)?i=n.call(this,e):t.data?(i=new Cp(t),nm(i)):i=r===`rectangle`?new Z(t):r===`circle`?new If(t):r===`text`?new zp(t):r===`image`?new up(t):Mm[e.type]?new Mm[e.type](t):new Cp(t),this.shapeVisual=i,this.visual.append(this.shapeVisual)}focus(){this.shapeVisual.drawingElement.options.set(Ue,Ae)}blur(){this.shapeVisual.drawingElement.options.set(Ue,``)}},Nm=class extends Xp{constructor(e,t){t=J({handles:{}},t),super(e.diagram,t),this.connection=e,this._ts=this.connection.diagram.toolService;let n=this.connection.sourcePoint(),r=this.connection.targetPoint();this.spVisual=new If(J(this.options.handles,{center:n})),this.epVisual=new If(J(this.options.handles,{center:r})),this.visual.append(this.spVisual),this.visual.append(this.epVisual)}_getCursor(){return T.move}start(e){switch(this.handle=this._hitTest(e),this.startPoint=e,this._initialSource=this.connection.source(),this._initialTarget=this.connection.target(),this.handle){case-1:this.connection.targetConnector&&this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);break;case 1:this.connection.sourceConnector&&this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape);break;default:break}}move(e,t){let n=this.diagram.toolService,r=t,i=n._hoveredConnector;if(i){let t=e===-1,n=e===1;(t&&i._c!==this.connection.targetConnector||n&&i._c!==this.connection.sourceConnector)&&(r=i._c.position())}switch(e){case-1:this.connection.source(r);break;case 1:this.connection.target(r);break;default:{let e=t.minus(this.startPoint);this.startPoint=t,this.connection.sourceConnector||this.connection.source(this.connection.sourcePoint().plus(e)),this.connection.targetConnector||this.connection.target(this.connection.targetPoint().plus(e));break}}return this.refresh(),!0}stop(e){let t=this.diagram.toolService,n=t.hoveredItem,r;return r=t._hoveredConnector?t._hoveredConnector._c:n&&n instanceof $?n.getConnector(E)||n.getConnector(e):e,this.handle===-1?this.connection.source(r):this.handle===1&&this.connection.target(r),this.handle=void 0,this._ts._connectionManipulation(),new Zp(this.connection,this._initialSource,this._initialTarget)}_hitTest(e){let t=this.connection.sourcePoint(),n=this.connection.targetPoint(),r=this.options.handles.width/2+10,i=this.options.handles.height/2+10,a=t.distanceTo(e),o=n.distanceTo(e),s=new q(t.x,t.y).inflate(r,i).contains(e),c=new q(n.x,n.y).inflate(r,i).contains(e),l=0;return s&&(!c||a<o)?l=-1:c&&(!s||o<a)&&(l=1),l}refresh(){this.spVisual.redraw({center:this.diagram.modelToLayer(this.connection.sourcePoint())}),this.epVisual.redraw({center:this.diagram.modelToLayer(this.connection.targetPoint())})}};let Pm={Left:{x:-1,y:0},Right:{x:1,y:0},Top:{x:0,y:-1},Bottom:{x:0,y:1}};function Fm(e){return e===`Left`||e===`Right`?`H`:`V`}function Im(e,t,n){return new K(e.x+t.x*n,e.y+t.y*n)}function Lm(e,t){return e.x===t.x&&e.y===t.y}function Rm(e,t){return e.y===t.y?`H`:`V`}function zm(e,t){return t.axis===`x`?new K(t.value,e.y):new K(e.x,t.value)}function Bm(e,t,n,r,i,a,o){if(!n||!r)return[];let s=t.x-e.x,c=t.y-e.y,l=n===`Top`||n===`Bottom`,u=r===`Top`||r===`Bottom`,d=i??30;if(l){if(u){if(n===r){let r=a?a.y:e.y,i=o?o.y:t.y,s=n===`Top`?Math.min(r,i)-d:Math.max(r,i)+d;return[new K(e.x,s),new K(t.x,s)]}let i=e.y+c/2;return[new K(e.x,i),new K(t.x,i)]}return[new K(e.x,t.y)]}if(!u){if(n===r){let r=a?a.x:e.x,i=o?o.x:t.x,s=n===`Left`?Math.min(r,i)-d:Math.max(r,i)+d;return[new K(s,e.y),new K(s,t.y)]}let i=e.x+s/2;return[new K(i,e.y),new K(i,t.y)]}return[new K(t.x,e.y)]}function Vm(e,t,n,r){let i=[{mid:new K(t.x,e.y),first:`H`,last:`V`},{mid:new K(e.x,t.y),first:`V`,last:`H`}];if(n){let e=i.filter(e=>e.first===n);e.length&&(i=e)}if(r&&i.length>1){let e=i.filter(e=>e.last===r);e.length&&(i=e)}return i[0].mid}function Hm(e,t,n,r){let i=[e[0].p],a=[],o=e=>e.kind===`connectionStart`?Fm(n):e.kind===`lock`&&e.createdByLockIndex!=null?t[e.createdByLockIndex].axis===`y`?`H`:`V`:null,s=e=>e.kind===`connectionEnd`?Fm(r):null;for(let n=0;n<e.length-1;n++){let r=e[n],c=e[n+1],l=r.p,u=c.p,d=r.createdByLockIndex,f=d==null?null:t[d],p=c.createdByLockIndex==null?t.length:c.createdByLockIndex,m=(e,t,n)=>{if(Lm(e,t))return;let r=Rm(e,t),i=null;n&&d!=null&&f&&(f.axis===`y`&&r===`H`||f.axis===`x`&&r===`V`)&&(i=d),a.push({a:e,b:t,orientation:r,ownerLockIndex:i,insertIndex:p})},h=i[i.length-1],g=Lm(h,l)?l:h;if(g.x===u.x||g.y===u.y)m(g,u,!0),i.push(u);else{let e=Vm(g,u,o(r),s(c));m(g,e,!0),i.push(e),m(e,u,!1),i.push(u)}}let c=[];for(let e of i)(c.length===0||!Lm(c[c.length-1],e))&&c.push(e);return{points:c.slice(1,-1),segmentsMeta:a}}function Um(e){let{source:t,target:n,sourceSide:r,targetSide:i,anchorOffset:a=10,sameSideDistance:o}=e,s=r?Im(t,Pm[r],a):t,c=i?Im(n,Pm[i],a):n,l=Bm(s,c,r,i,o,t,n),u=[{p:t,kind:`source`,createdByLockIndex:null}];for(let e of l)u.push({p:e,kind:`lock`,createdByLockIndex:null});Lm(u[u.length-1].p,n)||u.push({p:n,kind:`target`,createdByLockIndex:null});let{points:d,segmentsMeta:f}=Hm(u,[],r,i);return{points:d,segmentsMeta:f,connectionStart:s,connectionEnd:c}}function Wm(e){let{source:t,target:n,sourceSide:r,targetSide:i,locks:a,anchorOffset:o=10,sameSideDistance:s}=e,c=r?Im(t,Pm[r],o):t,l=i?Im(n,Pm[i],o):n,u=[{p:t,kind:`source`,createdByLockIndex:null},{p:c,kind:`connectionStart`,createdByLockIndex:null}];if(a.length===0){let e=Jm(c,l,r,i,s,t,n);for(let t of e)u.push({p:t,kind:`lock`,createdByLockIndex:null})}else for(let e=0;e<a.length;e++){let t=u[u.length-1].p,n=zm(t,a[e]);u.push({p:n,kind:`lock`,createdByLockIndex:e})}Lm(u[u.length-1].p,l)||u.push({p:l,kind:`connectionEnd`,createdByLockIndex:null}),Lm(u[u.length-1].p,n)||u.push({p:n,kind:`target`,createdByLockIndex:null});let{points:d,segmentsMeta:f}=Hm(u,a,r,i);return{points:d,segmentsMeta:f,connectionStart:c,connectionEnd:l}}function Gm(e,t=!0){if(!t){let{locks:t,...n}=e;return Um(n)}return Wm(e)}function Km(e){return e===0?0:e>0?1:-1}function qm(e){if(!e||e.length<=2)return e?e.slice():[];let t=[];for(let n of e){let e=t[t.length-1];(!e||e.x!==n.x||e.y!==n.y)&&t.push(new K(n.x,n.y))}if(t.length<=2)return t;let n=[];n.push(t[0]);for(let e=1;e<t.length-1;e++){let r=n[n.length-1],i=t[e],a=t[e+1];r.x===i.x&&i.x===a.x||r.y===i.y&&i.y===a.y||n.push(i)}if(n.push(t[t.length-1]),n.length<=2)return n;let r=[n[0]];for(let e=1;e<n.length;e++)for(r.push(n[e]);r.length>=3;){let e=r[r.length-3],t=r[r.length-2],n=r[r.length-1];if(e.y===t.y&&t.y===n.y){let i=Km(t.x-e.x),a=Km(n.x-t.x);if(i!==0&&a!==0&&i!==a){r.splice(r.length-2,1);continue}}if(e.x===t.x&&t.x===n.x){let i=Km(t.y-e.y),a=Km(n.y-t.y);if(i!==0&&a!==0&&i!==a){r.splice(r.length-2,1);continue}}break}let i=[];for(let e of r){let t=i[i.length-1];(!t||!Lm(t,e))&&i.push(e)}return i.length>=2?i:[n[0],n[n.length-1]]}function Jm(e,t,n,r,i=30,a,o){if(!n||!r)return[];let s=Fm(n);if(s===Fm(r)){if(n===r){let r=a||e,c=o||t;if(s===`H`){let a=n===`Left`?Math.min(r.x,c.x)-i:Math.max(r.x,c.x)+i;return[new K(a,e.y),new K(a,t.y)]}else{let a=n===`Top`?Math.min(r.y,c.y)-i:Math.max(r.y,c.y)+i;return[new K(e.x,a),new K(t.x,a)]}}if(s===`H`){let n=(e.x+t.x)/2;return[new K(n,e.y),new K(n,t.y)]}else{let n=(e.y+t.y)/2;return[new K(e.x,n),new K(t.x,n)]}}return e.x===t.x||e.y===t.y?[]:s===`H`?[new K(t.x,e.y)]:[new K(e.x,t.y)]}function Ym(e,t,n,r={}){let i=r.hysteresis??8,a=t.x-e.x,o=t.y-e.y,s=Math.abs(a),c=Math.abs(o),l=(n.lastSide==null?s>=c?`H`:`V`:n.lastSide===`Left`||n.lastSide===`Right`?c>s+i?`V`:`H`:s>c+i?`H`:`V`)==`H`?a>=0?`Left`:`Right`:o>=0?`Top`:`Bottom`;return n.lastSide=l,l}var Xm=class{constructor(e){this._undoSourceSide=null,this._undoTargetSide=null,this._redoSourceSide=null,this._redoTargetSide=null,this.item=e.item,this._undoLocks=e.undoLocks.map(e=>({...e})),this._redoLocks=e.redoLocks.map(e=>({...e})),this._undoPoints=e.undoPoints?e.undoPoints.map(e=>e.clone()):[],this._redoPoints=e.redoPoints?e.redoPoints.map(e=>e.clone()):[],this._undoRoutingMode=e.routingMode,this._undoSourceSide=e.sourceSide,this._undoTargetSide=e.targetSide,this._redoRoutingMode=this.item.routingMode,this._redoSourceSide=this.item.buildOptions?.sourceSide||null,this._redoTargetSide=this.item.buildOptions?.targetSide||null,this.title=`Connection Dragging`}undo(){this.item.locks=this._undoLocks.map(e=>({...e})),this.item.points(this._undoPoints.map(e=>e.clone())),this.item.updateModel(),this.item.type().toLowerCase()===Ce?(this.item.routingMode=this._undoRoutingMode,this._applyConnectionLocks({sourceSide:this._undoSourceSide,targetSide:this._undoTargetSide})):this._updateConnection(this._undoPoints)}redo(){this.item.locks=this._redoLocks.map(e=>({...e})),this.item.points(this._redoPoints.map(e=>e.clone())),this.item.updateModel(),this.item.type().toLowerCase()===Ce?(this.item.routingMode=this._redoRoutingMode,this._applyConnectionLocks({sourceSide:this._redoSourceSide,targetSide:this._redoTargetSide})):this._updateConnection(this._redoPoints)}_applyConnectionLocks(e={}){this.item._resolveConnectors(),this.item.buildOptions={...this.item.buildOptions,...e,source:this.item.sourcePoint(),target:this.item.targetPoint()};let t=Gm({...this.item.buildOptions,locks:this.item.locks});this.item.route=t;let n=qm([this.item.sourcePoint(),...t.points,this.item.targetPoint()]);this._updateConnection(n.slice(1,-1))}_updateConnection(e){this.item.points(e),this.item.refresh(),this.item.resizeAdorner&&this.item.resizeAdorner.refresh()}};function Zm(e,t){if(!e.length)return[];let n=e.some(e=>e.axis===`x`),r=e.some(e=>e.axis===`y`),i=[],a=new K(t.x,t.y);for(let t=0;t<e.length;t++){let n=e[t],r=n.axis===`x`?new K(n.value,a.y):new K(a.x,n.value);if(!(r.x===a.x&&r.y===a.y)){i.push(n),a=r;continue}let o=e.slice(t+1).some(e=>e.axis===n.axis);!i.some(e=>e.axis===n.axis)&&!o&&i.push(n)}if(n&&!i.some(e=>e.axis===`x`)){let t=e.find(e=>e.axis===`x`);t&&i.push(t)}if(r&&!i.some(e=>e.axis===`y`)){let t=e.find(e=>e.axis===`y`);t&&i.unshift(t)}return i}function Qm(e,t,n={}){let r=n.tolerance??6,i=r*r,a=-1,o=1/0;for(let n=0;n<t.length;n++){let r=t[n],i=eh(e,r.a,r.b);i<o&&(o=i,a=n)}if(a===-1||o>i)return-1;let s=[];for(let n=0;n<t.length;n++){let r=eh(e,t[n].a,t[n].b);Math.abs(r-o)<1e-9&&s.push(n)}if(s.length>1){let e=s[0],n=$m(t[e].a,t[e].b);for(let r=1;r<s.length;r++){let i=s[r],a=$m(t[i].a,t[i].b);a>n&&(n=a,e=i)}return e}return a}function $m(e,t){let n=t.x-e.x,r=t.y-e.y;return n*n+r*r}function eh(e,t,n){if(t.y===n.y){let r=t.y,i=Math.min(t.x,n.x),a=Math.max(t.x,n.x);if(e.x>=i&&e.x<=a){let t=e.y-r;return t*t}let o=e.x<i?i:a,s=e.x-o,c=e.y-r;return s*s+c*c}let r=t.x,i=Math.min(t.y,n.y),a=Math.max(t.y,n.y);if(e.y>=i&&e.y<=a){let t=e.x-r;return t*t}let o=e.y<i?i:a,s=e.x-r,c=e.y-o;return s*s+c*c}function th(e,t){let n=e=>Math.round(e/t)*t;return e.map(e=>`${n(e.x)},${n(e.y)}`).join(`;`)}function nh(e,t){let n=Gm({...e,locks:t});return qm([e.source,...n.points,e.target])}function rh(e,t,n={}){let r=n.tolerance??.5;if(!e.length)return e;let i=th(nh(t,e),r),a=e.slice(),o=!0;for(;o&&a.length;){o=!1;for(let e=0;e<a.length;e++){let n=a.slice(0,e).concat(a.slice(e+1));if(th(nh(t,n),r)===i){a=n,o=!0;break}}}return a}function ih(e){return e.orientation===`H`?`y`:`x`}function ah(e,t,n,r){if(t.y===n.y){let i=Math.min(t.x,n.x),a=Math.max(t.x,n.x);return Math.abs(e.y-t.y)<=r&&e.x>=i-r&&e.x<=a+r}let i=Math.min(t.y,n.y),a=Math.max(t.y,n.y);return Math.abs(e.x-t.x)<=r&&e.y>=i-r&&e.y<=a+r}var oh=class extends Xp{constructor(e,t){super(e.diagram,J({},t)),this._sourceSide=null,this._targetSide=null,this.connection=e,this.handles=[],this.activeHandle=null,this._firstMove=!1,t&&this._createHandles(),this.diagram.bind(`dblclick`,this.onDblClick.bind(this))}onDblClick(e){let t=e.item.name===He&&this._hitTest(e.point);if(!t||!t.vertex)return;let n=this.connection.route.segmentsMeta,r=n[Qm(t.point,n,{tolerance:8})];if(r&&r.ownerLockIndex!=null){this.connection.locks.splice(r.ownerLockIndex,1),this.connection.routingMode=this.connection.locks.length?`manual`:`auto`;let e=Gm({...this.connection.buildOptions,locks:this.connection.locks}),t=this.connection.sourcePoint(),n=this.connection.targetPoint(),i=qm([t,...e.points,n]);this.connection.points(i.slice(1,-1)),this.connection.route=e,this.connection.refresh(),this.refresh()}}createMiddlePoints(){let e=this.connection.route,t=[];if(!e)return t;let n=e.points;if(n.length<2)return t;let r=this._axisAligned(n)?[n[0],n[n.length-1]]:n,i=this.connection.allPoints(),a=i[0],o=i[i.length-1],s=i.length>2?i[1]:null,c=i.length>2?i[i.length-2]:null,l=this.connection.options.anchorOffset??0,u=.5;for(let e=0;e<r.length-1;){let n=e+1;for(;n<r.length-1&&this._axisAligned(r.slice(e,n+2));)n++;let i=r[e],d=r[n];if(i.x===d.x&&i.y===d.y){e=n;continue}let f=new K((i.x+d.x)/2,(i.y+d.y)/2),p=e===0,m=n===r.length-1,h=p&&s&&this._axisAligned([a,f,s]),g=m&&c&&this._axisAligned([o,f,c]),_=h&&s&&a.distanceTo(s)<=l+u,v=g&&c&&o.distanceTo(c)<=l+u;if(_||v){e=n;continue}p&&h&&!_&&s?f=new K((a.x+s.x)/2,(a.y+s.y)/2):m&&g&&!v&&c&&(f=new K((o.x+c.x)/2,(o.y+c.y)/2)),t.push(f),e=n}return t}_createHandles(){if(this.handles.forEach(e=>this.visual.remove(e.visual)),this.handles=[],(this.connection.options.type||``).toLowerCase()!==Ce||this.connection.pointsEditable()===!1)return;let e=this.createMiddlePoints(),t=this.options,n=this.connection.route.segmentsMeta.filter(e=>e.ownerLockIndex!==null);e.forEach(e=>{let r=n.some(t=>ah(e,t.a,t.b,.5)),i=new If({center:this.diagram.modelToLayer(e),radius:r?t.vertex.radius:t.midpoint.radius,fill:r?t.vertex.fill:t.midpoint.fill,stroke:r?t.vertex.stroke:t.midpoint.stroke});this.visual.append(i),this.handles.push({visual:i,point:e,vertex:r})})}_axisAligned(e){if(e.length<=1)return!0;let{x:t,y:n}=e[0];return e.every(e=>e.x===t)||e.every(e=>e.y===n)}_getCursor(e){if(this._activeDrag)return this._activeDrag.cursor;let t=e&&this._hitTest(e);if(t){let e=this.connection.route.segmentsMeta,n=e[Qm(t.point,e,{tolerance:8})];return!n||n.orientation===`H`?T.rowresize:T.colresize}}_hitTest(e){let t=this.options;if(!t.midpoint||!t.vertex)return null;let n=(t.vertex.radius+(t.vertex.stroke?.width||1))/this.diagram.zoom();return this.handles.find(t=>t.point.distanceTo(e)<=n)||null}start(e){if(this.activeHandle=this._hitTest(e),this.activeHandle){this._initialLocks=this.connection.locks.map(e=>({...e})),this._routingMode=this.connection.routingMode,this._sourceSide=this.connection.buildOptions.sourceSide,this._targetSide=this.connection.buildOptions.targetSide;let t=this.connection.route.segmentsMeta,n=Qm(e,t,{tolerance:8}),r=t[n];r?this._activeDrag={axis:ih(r),lockIndex:r.ownerLockIndex,insertIndex:r.insertIndex,inserted:!1,cursor:!r||r.orientation===`H`?T.rowresize:T.colresize,segmentIndex:n}:this._activeDrag={axis:`y`,lockIndex:null,insertIndex:this.connection.locks.length,inserted:!1,cursor:T.arrow,segmentIndex:n},this._firstMove=!0}}move(e,t){if(!this.activeHandle)return!1;let n=new K(Math.round(t.x),Math.round(t.y)),r=this.connection,i=this._activeDrag,a=i.axis===`x`?n.x:n.y,o=this._findSnapValue(i.axis,a);o!==null&&(a=o),i.lockIndex==null&&!i.inserted&&(r.locks.splice(i.insertIndex,0,{axis:i.axis,value:a}),i.lockIndex=i.insertIndex,i.inserted=!0),i.lockIndex!=null&&(r.locks[i.lockIndex].value=a);let s=Gm({...this.connection.buildOptions,locks:r.locks});return this.updateConnection(s),!0}updateConnection(e){this.connection.routingMode=`manual`;let t=this.connection.sourcePoint(),n=this.connection.targetPoint(),r=qm([t,...e.points,n]);this.connection.points(r.slice(1,-1)),this.connection.route=e,this.connection.refresh(),this._firstMove&&this.handles&&this.handles.forEach(e=>{e.visual&&e.visual.visible(!1)}),this._firstMove=!1}_findSnapValue(e,t){let n=this.connection.route?.segmentsMeta;if(!n||!this._activeDrag)return null;let r=this._activeDrag.lockIndex,i=null,a=this.options.snap===void 0?6:this.options.snap;for(let o of n){if(r!==null&&o.ownerLockIndex===r||!(e===`y`&&o.orientation===`H`||e===`x`&&o.orientation===`V`))continue;let n=o.orientation===`H`?(o.a.y+o.b.y)/2:(o.a.x+o.b.x)/2,s=Math.abs(n-t);s<a&&(a=s,i=n)}return i}stop(e){if(!this.activeHandle)return;let t=this.connection.locks.map(e=>({...e}));this.connection.locks=Zm(this.connection.locks,this.connection.route.connectionStart);let n=this.connection.sourcePoint(),r=this.connection.targetPoint();this.connection.locks=rh(this.connection.locks,this.connection.buildOptions,{tolerance:.5});let i={...this.connection.buildOptions},a={};this.connection._resolveConnectors(a),(!a._resolvedTargetConnector?.positionWithoutOffset().equals(r)||!a._resolvedSourceConnector?.positionWithoutOffset().equals(n))&&(this.connection.locks=t,this.connection.buildOptions=i);let o=Gm({...this.connection.buildOptions,locks:this.connection.locks});this.updateConnection(o);let s=new Xm({item:this.connection,undoLocks:this._initialLocks||[],redoLocks:this.connection.locks,undoPoints:[],redoPoints:[],routingMode:this._routingMode,sourceSide:this._sourceSide,targetSide:this._targetSide});return this._resetFlags(),this.refresh(),s}refresh(){this._createHandles()}cancel(){this.activeHandle&&this._initialLocks&&(this._initialLocks&&(this.connection.locks=this._initialLocks.map(e=>({...e})),this.updateConnection(Gm({...this.connection.buildOptions,locks:this.connection.locks}))),this.refresh(),this._resetFlags())}_resetFlags(){this.activeHandle=null,this._activeDrag=null,this._firstMove=!1,this._initialLocks&&=void 0}},sh=class extends Xp{constructor(e,t){super(e.diagram,J({},t)),this._handlePoints=[],this.connection=e,this.handles=[],this.activeHandle=null,this._firstMove=!1,t&&this._createHandles(),this.diagram.bind(`dblclick`,this.onDblClick.bind(this))}onDblClick(e){let t=e.item.name===He&&this._hitTest(e.point),n=t&&this._handlePoints.find(e=>e.point.equals(t.point));if(n&&n.vertex){let e=this.connection.allPoints().slice(1,-1),t=e.findIndex(e=>e.equals(n.point));if(t<0)return;e.splice(t,1),this.connection.points(e.map(e=>e.clone())),this.connection.refresh(),this.refresh()}}createHandlePoints(){let e=this.connection.allPoints(),t=[],n=e[0],r=e[e.length-1],i=e.slice(1,-1),a=i.length?[n,...i,r]:[n,r];for(let e=0;e<a.length-1;){let n=e+1,r=a[e],i=a[n];(r.x!==i.x||r.y!==i.y)&&(t.push({vertex:!0,point:r}),t.push({vertex:!1,point:new K((r.x+i.x)/2,(r.y+i.y)/2)}),t.push({vertex:!0,point:i})),e=n}return t.slice(1,-1)}_createHandles(){if(this.handles.forEach(e=>this.visual.remove(e.visual)),this.handles=[],(this.connection.options.type||``).toLowerCase()!==`polyline`||this.connection.pointsEditable()===!1)return;this._handlePoints=this.createHandlePoints();let e=this.options;this._handlePoints.forEach(({point:t,vertex:n})=>{let r=new If({center:this.diagram.modelToLayer(t),radius:n?e.vertex.radius:e.midpoint.radius,fill:n?e.vertex.fill:e.midpoint.fill,stroke:n?e.vertex.stroke:e.midpoint.stroke});this.visual.append(r),this.handles.push({visual:r,point:t})})}_getCursor(e){if(e&&this._hitTest(e))return T.arrow}_hitTest(e){let t=this.options;if(!t.midpoint||!t.vertex)return null;let n=(t.midpoint.radius+(t.midpoint.stroke?.width||1))/this.diagram.zoom();return this.handles.find(t=>t.point.distanceTo(e)<=n)||null}start(e){this.activeHandle=this._hitTest(e),this.activeHandle&&(this._initialPoints=this.connection.points().map(e=>e.clone()),this._firstMove=!0)}move(e,t){if(!this.activeHandle)return!1;let n=this.connection.allPoints().slice(1,-1),r=this.activeHandle.point,i=this._handlePoints.findIndex(e=>e.point.equals(r)),a=this._handlePoints[i];if(!a)return;let o=this._applySnap(t,i);if(a.vertex){let e=n.find(e=>e.equals(a.point));e&&(e.x=o.x,e.y=o.y,this.connection.points(n.map(e=>e.clone())),this.updateConnection(),this.activeHandle.point=e.clone(),a.point=e.clone())}else{let e=this._handlePoints[i-1],t=this._handlePoints[i+1];if(e){let t=n.findIndex(t=>t.equals(e.point));t>=0&&n.splice(t+1,0,o.clone())}else if(t){let e=n.findIndex(e=>e.equals(t.point));e>=0&&n.splice(e,0,o.clone())}else n.length===0&&n.push(o.clone());this.connection.points(n.map(e=>e.clone())),this.updateConnection(),this._handlePoints=this.createHandlePoints();let r=this._handlePoints.findIndex(e=>e.vertex&&e.point.equals(o));r>=0&&(this.activeHandle.point=this._handlePoints[r].point)}return this.connection.refresh(),!0}updateConnection(){let e=this.connection.sourcePoint(),t=this.connection.targetPoint(),n=this.connection.points();this.connection.path.redraw({points:[e,...n,t]}),this.connection._alignContent(),this._firstMove&&this.handles&&this.handles.forEach(e=>{e.visual&&e.visual.visible(!1)}),this._firstMove=!1}_applySnap(e,t){let n=this._handlePoints[t];if(!n)return e;let r=this.options.snap===void 0?6:this.options.snap,i=this.connection.allPoints(),a=null,o=null;if(n.vertex){let e=i.findIndex(e=>e.distanceTo(n.point)<.1);e>=0&&(a=e>0?i[e-1]:null,o=e<i.length-1?i[e+1]:null)}else{let e=this._handlePoints[t-1],n=this._handlePoints[t+1];a=e?.point||null,o=n?.point||null}let s=null,c=null;return a&&Math.abs(e.y-a.y)<r&&(c=a.y),o&&c===null&&Math.abs(e.y-o.y)<r&&(c=o.y),a&&Math.abs(e.x-a.x)<r&&(s=a.x),o&&s===null&&Math.abs(e.x-o.x)<r&&(s=o.x),new K(s===null?e.x:s,c===null?e.y:c)}stop(e){if(!this.activeHandle)return;let t=new Xm({item:this.connection,undoLocks:[],redoLocks:[],undoPoints:this._initialPoints,redoPoints:this.connection.points(),routingMode:`manual`,sourceSide:null,targetSide:null});return this._resetFlags(),this.refresh(),t}refresh(){let e=this.activeHandle?.point.clone();this._createHandles(),e&&(this.activeHandle=this.handles.find(t=>t.point.equals(e))||null)}cancel(){this.activeHandle&&this._initialPoints&&(this._initialPoints&&(this.connection.points(this._initialPoints),this.connection.refresh()),this.refresh(),this._resetFlags())}_resetFlags(){this.activeHandle=null,this._firstMove=!1,this._initialPoints&&=void 0}},ch=class{constructor(e){this.options=J({},e.options),this._c=e,this.visual=new If(this.options),this.refresh()}_hover(e){let t=this.options,n=t.hover,r=t.stroke,i=t.fill;e&&D(n.stroke)&&(r=J({},r,n.stroke)),e&&D(n.fill)&&(i=n.fill),this.visual.redraw({stroke:r,fill:i})}refresh(){let e=this._c.shape.diagram.modelToView(this._c.position()),t=e.minus(this._c.shape.bounds(`transformed`).topLeft()),n=new q(e.x,e.y,0,0),r=(this.options.stroke?.width||0)/2,i=Math.max(this.options.width,this.options.height);n.inflate(this.options.width/2+r+i,this.options.height/2+r+i),this._visualBounds=n,this.visual.redraw({center:new K(t.x,t.y)})}_hitTest(e){let t=this._c.shape.diagram.modelToView(e);return this._visualBounds.contains(t)}},lh=class extends Xp{constructor(e,t){super(e,t),this._refreshHandler=e=>{e.item===this.shape&&this.refresh()}}show(e){this._visible=!0,this.shape=e,this.diagram.bind(le,this._refreshHandler),this.connectors=[],this._clearVisual();let t=e.connectors.length;for(let n=0;n<t;n++){let t=new ch(e.connectors[n]);this.connectors.push(t),this.visual.append(t.visual)}this.visual.visible(!0),this.refresh()}_clearVisual(){this.diagram._cachedTouchTarget?this._keepCachedTouchTarget():this.visual.clear()}_keepCachedTouchTarget(){let e=this.visual.children,t=e.length,n=dt(this.diagram._cachedTouchTarget,e);for(let r=t-1;r>=0;r--)r!==n&&this.visual.remove(e[r])}destroy(){this.diagram.unbind(le,this._refreshHandler),this.shape=void 0,this._visible=void 0,this.visual.visible(!1)}_hitTest(e){let t,n;for(n=0;n<this.connectors.length;n++)if(t=this.connectors[n],t._hitTest(e)){t._hover(!0),this.diagram.toolService._hoveredConnector=t;break}}refresh(){if(this.shape){let e=this.shape.bounds();e=this.diagram.modelToLayer(e),this.visual.position(e.topLeft()),this.connectors.forEach(function(e){e.refresh()})}}};function uh(e){let t=e.options.editable;return t&&t.drag!==!1}var dh=class{constructor(e,t,n){this.shapes=e,this.undoStates=t,this.title=`Transformation`,this.redoStates=[],this.adorner=n;for(let e=0;e<this.shapes.length;e++){let t=this.shapes[e];this.redoStates.push(t.bounds())}}undo(){for(let e=0;e<this.shapes.length;e++){let t=this.shapes[e];t.bounds(this.undoStates[e]),`layout`in t&&t.layout(t,this.redoStates[e],this.undoStates[e]),t.updateModel()}this.adorner&&(this.adorner.refreshBounds(),this.adorner.refresh())}redo(){for(let e=0;e<this.shapes.length;e++){let t=this.shapes[e];t.bounds(this.redoStates[e]),`layout`in t&&t.layout(t,this.undoStates[e],this.redoStates[e]),t.updateModel()}this.adorner&&(this.adorner.refreshBounds(),this.adorner.refresh())}};function fh(e,t){let n;return e.x===-1&&e.y===-1?n=t.bottomRight():e.x===1&&e.y===1?n=t.topLeft():e.x===-1&&e.y===1?n=t.topRight():e.x===1&&e.y===-1?n=t.bottomLeft():e.x===0&&e.y===-1?n=t.bottom():e.x===0&&e.y===1?n=t.top():e.x===1&&e.y===0?n=t.left():e.x===-1&&e.y===0&&(n=t.right()),n}let ph={handles:{fill:{color:`#fff`},stroke:{color:`#282828`},height:7,width:7,hover:{fill:{color:`#282828`},stroke:{color:`#282828`}}},selectable:{stroke:{color:`#778899`,width:1,dashType:`solid`},fill:{color:v},offset:3},offset:1};var mh=class extends Xp{constructor(e,t){t=J({},ph,t);let n=e.options.editable;n&&typeof n!=`boolean`&&n.resize&&typeof n.resize!=`boolean`&&n.resize.offset!==void 0&&(t.offset=n.resize.offset);let r=e.options.selectable;r&&typeof r!=`boolean`&&r.offset!==void 0?t.selectionRectOffset=r.offset:t.selectionRectOffset=ph.selectable.offset,super(e,t),this._manipulating=!1,this.map=[],this.shapes=[],this.shapeStates=[],this._initSelection(),this._createHandles(),this.redraw(),this.diagram.bind(`select`,()=>{this._initialize()}),this._refreshHandler=()=>{this._internalChange||(this.refreshBounds(),this.refresh())},this._rotatedHandler=()=>{this.shapes.length===1&&(this._angle=this.shapes[0].rotate().angle),this._refreshHandler()},this.diagram.bind(le,this._refreshHandler).bind(ce,this._rotatedHandler),this.refreshBounds(),this.refresh()}_initSelection(){let e=this.diagram,t=e.options.editable,n=e.options.selectable;t&&typeof t!=`boolean`&&t.resize&&typeof t.resize!=`boolean`&&t.resize.selectable&&(n=t.resize.selectable),this.rect=new Z(J({},this.options.selectable,n)),this.visual.append(this.rect)}_resizable(){return this.options.editable&&this.options.editable.resize!==!1}_handleOptions(){let e=(this.options.editable.resize||{}).handles;return e?J({},this.options.handles,e):this.options.handles}_createHandles(){let e,t,n,r;if(this._resizable()){for(e=this._handleOptions(),r=-1;r<=1;r++)for(n=-1;n<=1;n++)if(r!==0||n!==0){t=new Z(e);let i=r===0||n===0;t.drawingElement._hover=this._hover.bind(this,i),this.map.push({x:r,y:n,visual:t}),this.visual.append(t)}}}bounds(e){if(e)this._innerBounds=e.clone(),this._bounds=this.diagram.modelToLayer(e).inflate(this.options.offset,this.options.offset);else return this._bounds}_hitTest(e){let t=this.map.length,n=this.diagram.modelToLayer(e),r,i,a,o;if(this._angle&&(n=n.clone().rotate(this._angle,this._bounds.center())),this._resizable()){let e=this.diagram.modelToLayer(this._innerBounds),s=this.diagram.zoom(),c=this.options.selectionRectOffset*s,l=e.x-c,u=e.y-c;for(r=0;r<t;r++)if(o=this.map[r],o.x!==0&&o.y!==0&&(i=new K(o.x,o.y),a=this._getHandleBounds(i),a.offset(l,u),a.contains(n)))return i;for(r=0;r<t;r++)if(o=this.map[r],(o.x===0||o.y===0)&&(i=new K(o.x,o.y),a=this._getHandleBounds(i),a.offset(l,u),a.contains(n)))return i}if(this._bounds.contains(n))return new K(0,0)}_getHandleBounds(e){if(this._resizable()){let t=this._handleOptions(),n=t.width,r=t.height,i=this.diagram.modelToLayer(this._innerBounds),a=this.diagram.zoom(),o=this.options.offset*a,s=this.options.selectionRectOffset*a-o,c=i.width-a,l=i.height-a,u=n*a,d=r*a,f;return e.x!==0&&e.y!==0?(f=new q(0,0,n,r),e.x<0?f.x=s-n/2:e.x>0&&(f.x=c+2*o+s-n/2),e.y<0?f.y=s-r/2:e.y>0&&(f.y=l+2*o+s-r/2)):e.x===0&&e.y!==0?f=new q(s,e.y<0?s-d/2:l+2*o+s-d/2,c+2*o,d):e.y===0&&e.x!==0&&(f=new q(e.x<0?s-u/2:c+2*o+s-u/2,s,u,l+2*o)),f}}_getCursor(e){let t=this._hitTest(e);if(t&&t.x>=-1&&t.x<=1&&t.y>=-1&&t.y<=1&&this._resizable()){let e=this._angle;if(e&&(t.rotate(e,new K(0,0)),t=new K(Math.round(t.x),Math.round(t.y))),t.x===-1&&t.y===-1)return`nw-resize`;if(t.x===1&&t.y===1)return`se-resize`;if(t.x===-1&&t.y===1)return`sw-resize`;if(t.x===1&&t.y===-1)return`ne-resize`;if(t.x===0&&t.y===-1)return`n-resize`;if(t.x===0&&t.y===1)return`s-resize`;if(t.x===1&&t.y===0)return`e-resize`;if(t.x===-1&&t.y===0)return`w-resize`}return this._manipulating?T.move:T.select}_initialize(){let e,t,n=this.diagram.select();for(this.shapes=[],e=0;e<n.length;e++)t=n[e],t instanceof $&&(this.shapes.push(t),t._rotationOffset=new K);this._angle=this.shapes.length===1?this.shapes[0].rotate().angle:0,this._startAngle=this._angle,this._rotates(),this._positions(),this.refreshBounds(),this.refresh(),this.redraw()}_rotates(){let e,t;for(this.initialRotates=[],e=0;e<this.shapes.length;e++)t=this.shapes[e],this.initialRotates.push(t.rotate().angle)}_positions(){let e,t;for(this.initialStates=[],e=0;e<this.shapes.length;e++)t=this.shapes[e],this.initialStates.push(t.bounds())}_hover(e,t,n){if(this._resizable()){if(e){n.fill(`transparent`,0),n.stroke(`transparent`,0,0);return}let r=this._handleOptions(),i=r.hover,a=r.stroke,o=r.fill;t&&D(i.stroke)&&(a=J({},a,i.stroke)),t&&D(i.fill)&&(o=i.fill),n.stroke(a.color,a.width,a.opacity),n.fill(o.color,o.opacity)}}start(e){this._sp=e,this._cp=e,this._lp=e,this._manipulating=!0,this._internalChange=!0,this.shapeStates=[];for(let e=0;e<this.shapes.length;e++){let t=this.shapes[e];this.shapeStates.push(t.bounds())}}redraw(){let e,t,n=this._resizable();for(e=0;e<this.map.length;e++)t=this.map[e],t.visual.visible(n)}angle(e){return O(e)&&(this._angle=e),this._angle}rotate(){let e=this._innerBounds.center(),t=this.angle();this._internalChange=!0;for(let n=0;n<this.shapes.length;n++){let r=this.shapes[n];t=(t+this.initialRotates[n]-this._startAngle)%360,r.rotate(t,e)}this.refresh()}move(e,t){let n,r,i=new K,a=new K,o,s,c,l,u,d,f=0,p,m,h;if(e.y===-2&&e.x===-1){for(s=this._innerBounds.center(),this._angle=this._truncateAngle(ct(s,t)),l=0;l<this.shapes.length;l++)c=this.shapes[l],u=(this._angle+this.initialRotates[l]-this._startAngle)%360,c.rotate(u,s),Object.prototype.hasOwnProperty.call(c,`layout`)&&c.layout(c),this._rotating=!0;this.refresh()}else{if(this.shouldSnap()){let e=this._truncateDistance(t.minus(this._lp));if(e.x===0&&e.y===0){this._cp=t;return}n=e,this._lp=new K(this._lp.x+e.x,this._lp.y+e.y)}else n=t.minus(this._cp);for(this.isDragHandle(e)?(a=i=n,r=!0):(this._angle&&n.rotate(this._angle,new K(0,0)),e.x===-1?i.x=n.x:e.x===1&&(a.x=n.x),e.y===-1?i.y=n.y:e.y===1&&(a.y=n.y)),r||(p=fh(e,this._innerBounds),m=(this._innerBounds.width+n.x*e.x)/this._innerBounds.width,h=(this._innerBounds.height+n.y*e.y)/this._innerBounds.height),l=0;l<this.shapes.length;l++){if(c=this.shapes[l],o=c.bounds(),r){if(!uh(c))continue;d=this._displaceBounds(o,i,a,r)}else{d=o.clone(),d.scale(m,h,p,this._innerBounds.center(),c.rotate().angle);let e=d.center();e.rotate(-this._angle,o.center()),d=new q(e.x-d.width/2,e.y-d.height/2,d.width,d.height)}if(d.width>=c.options.minWidth&&d.height>=c.options.minHeight){let e=o;c.bounds(d),Object.prototype.hasOwnProperty.call(c,`layout`)&&c.layout(c,e,d),(e.width!==d.width||e.height!==d.height)&&c.rotate(c.rotate().angle),f+=1}}f&&(f===l?(d=this._displaceBounds(this._innerBounds,i,a,r),this.bounds(d)):this.refreshBounds(),this.refresh()),this._positions()}this._cp=t}isDragHandle(e){return e.x===0&&e.y===0}cancel(){let e=this.shapes,t=this.shapeStates;for(let n=0;n<e.length;n++)e[n].bounds(t[n]);this.refreshBounds(),this.refresh(),this._manipulating=void 0,this._internalChange=void 0,this._rotating=void 0}_truncatePositionToGuides(e){return this.diagram.ruler?this.diagram.ruler.truncatePositionToGuides(e):e}_truncateSizeToGuides(e){return this.diagram.ruler?this.diagram.ruler.truncateSizeToGuides(e):e}_truncateAngle(e){let t=this.snapOptions(),n=Math.max(t.angle||10,5);return t?Math.floor(e%360/n)*n:e%360}_truncateDistance(e){if(e instanceof K)return new K(this._truncateDistance(e.x),this._truncateDistance(e.y));{let t=this.snapOptions()||{},n=Math.max(t.size||10,5);return t?Math.floor(e/n)*n:e}}snapOptions(){return((this.diagram.options.editable||{}).drag||{}).snap||{}}shouldSnap(){let e=this.diagram.options.editable,t=(e||{}).drag,n=(t||{}).snap;return e!==!1&&t!==!1&&n!==!1}_displaceBounds(e,t,n,r){let i=e.topLeft().plus(t),a=e.bottomRight().plus(n),o=q.fromPoints(i,a),s;return r||(s=o.center(),s.rotate(-this._angle,e.center()),o=new q(s.x-o.width/2,s.y-o.height/2,o.width,o.height)),o}stop(){let e,t,n,r;if(this._cp!==this._sp){if(this._rotating)e=new lm(this,this.shapes,this.initialRotates),this._rotating=!1;else if(this._diffStates()){if(this.diagram.ruler)for(t=0;t<this.shapes.length;t++)n=this.shapes[t],r=n.bounds(),r=this._truncateSizeToGuides(this._truncatePositionToGuides(r)),n.bounds(r),this.refreshBounds(),this.refresh();for(t=0;t<this.shapes.length;t++){n=this.shapes[t],r=n.bounds();let e=n.shapeVisual?.options.stroke?.width||0;n._originalWidth+e!==r.width&&(n._originalWidth=r.width-e),n._originalHeight+e!==r.height&&(n._originalHeight=r.height-e),n.updateModel()}e=new dh(this.shapes,this.shapeStates,this),this.diagram._syncShapeChanges()}}return this._manipulating=void 0,this._internalChange=void 0,this._rotating=void 0,e}_diffStates(){let e=this.shapes,t=this.shapeStates;for(let n=0;n<e.length;n++)if(!e[n].bounds().equals(t[n]))return!0;return!1}refreshBounds(){let e=this.shapes.length===1?this.shapes[0].bounds().clone():this.diagram.boundingBox(this.shapes,!0);this.bounds(e)}refresh(){let e,t;if(this.shapes.length>0){t=this.bounds(),this.visual.visible(!0);let n=this.diagram.modelToLayer(this._innerBounds),r=this.diagram.zoom(),i=this.options.selectionRectOffset*r;this.visual.position(new K(n.x-i,n.y-i)),this.map.forEach(t=>{if(e=this._getHandleBounds(new K(t.x,t.y)),t.visual.position(e.topLeft()),t.visual.redraw({width:e.width,height:e.height}),t.x===0||t.y===0){let e=t.visual.drawingElement;e.fill(`transparent`,0),e.stroke(`transparent`,0,0)}});let a=new K(n.width/2+i,n.height/2+i);if(this.visual.rotate(this._angle,a),this.rect.position(new K(0,0)),this.rect.redraw({width:n.width+2*i-r,height:n.height+2*i-r}),this.rotationThumb){let e=this.options.editable.rotate.thumb;this._rotationThumbBounds=new q(t.center().x,t.y+e.y,0,0).inflate(e.width),this.rotationThumb.redraw({x:t.width/2-e.width/2})}}else this.visual.visible(!1)}};let hh={stroke:{color:`#778899`,width:1,dashType:`dash`},fill:{color:v}};var gh=class{constructor(e){let t=e.options.selectable;this.options=J({},hh,t),this.visual=new Z(this.options),this.diagram=e}start(e){this._sp=this._ep=e,this.refresh(),this.diagram._adorn(this,!0)}end(){this._sp=this._ep=void 0,this.diagram._adorn(this,!1)}bounds(e){return e&&(this._bounds=e),this._bounds}move(e){this._ep=e,this.refresh()}refresh(){if(this._sp){let e=q.fromPoints(this.diagram.modelToLayer(this._sp),this.diagram.modelToLayer(this._ep));this.bounds(q.fromPoints(this._sp,this._ep)),this.visual.position(e.topLeft()),this.visual.redraw({height:e.height+1,width:e.width+1})}}},_h=class{constructor(){}},vh=class extends _h{constructor(e){super(),this.connection=e}hitTest(e){return this.getBounds().inflate(10).contains(e)?Nt.distanceToPolyline(e,this.connection.allPoints())<10:!1}getBounds(){let e=this.connection.allPoints(),t=e[0],n=e[e.length-1],r=Math.max(t.x,n.x),i=Math.min(t.x,n.x),a=Math.min(t.y,n.y),o=Math.max(t.y,n.y);for(let t=1;t<e.length-1;++t)r=Math.max(r,e[t].x),i=Math.min(i,e[t].x),a=Math.min(a,e[t].y),o=Math.max(o,e[t].y);return new q(i,a,r-i,o-a)}};let yh=`topLeft`,bh=`bottomRight`;var xh=class extends vh{constructor(e){super(e),this.SAME_SIDE_DISTANCE_RATIO=5,this._connectorSides=[{name:`Top`,axis:`y`,boundsPoint:yh,secondarySign:1},{name:re,axis:`x`,boundsPoint:yh,secondarySign:1},{name:ie,axis:`y`,boundsPoint:bh,secondarySign:-1},{name:ne,axis:`x`,boundsPoint:bh,secondarySign:-1}],this.connection=e}routePoints(e,t,n,r){let i=n?this._connectorSide(n,t):null,a=r?this._connectorSide(r,e):null;return this._createRoute(e,t,i,a,n)}route(){let e=this.connection._resolvedSourceConnector,t=this.connection._resolvedTargetConnector,n=this.connection.sourcePoint(),r=this.connection.targetPoint(),i=qm([n,...this.routePoints(n,r,e,t),r]);this.connection.points(i.slice(1,-1))}_createRoute(e,t,n,r,i){let a=i||this.connection._resolvedSourceConnector,o={source:e,target:t,sourceSide:n,targetSide:r||Ym(e,t,this.connection.previewState,{hysteresis:8}),locks:this.connection.locks,anchorOffset:this.connection.options.anchorOffset,sameSideDistance:a?this._sameSideDistance(a):void 0},s=Gm(o,this.connection.pointsEditable());return this.connection.route=s,this.connection.buildOptions=o,s.points}_connectorSide(e,t){let n=e.positionWithoutOffset(),r=e.shape.bounds(ge),i={topLeft:r.topLeft(),bottomRight:r.bottomRight()},a=this._connectorSides,o=Number.MAX_VALUE,s,c,l,u;for(let e=0;e<a.length;e++)u=a[e],l=u.axis,s=Math.round(Math.abs(n[l]-i[u.boundsPoint][l])),s<o?(o=s,c=u):s===o&&(n[l]-t[l])*u.secondarySign>(n[c.axis]-t[c.axis])*c.secondarySign&&(c=u);return c.name}_sameSideDistance(e){let t=e.shape.bounds(ge);return Math.min(t.width,t.height)/this.SAME_SIDE_DISTANCE_RATIO}},Sh=class extends vh{constructor(e){super(e),this.connection=e}route(){}_connectorSide(e,t){return null}},Ch=class{constructor(e){this.toolService=e,this.type=`ConnectionTool`}tryActivate(e,t){let n=this.toolService,r=n.diagram.options.selectable,i=n.hoveredItem,a=r!==!1&&i&&i.path&&!(i.isSelected&&t.ctrlKey);return a&&(this._c=i),a}start(e,t,n){let r=this.toolService,i=this._c;r.selectSingle(i,t);let a=i.adorner,o,s;a&&(o=a._hitTest(e),s=ye[o]),uh(i)&&a&&!r.diagram.trigger(ae,{shapes:[],connections:[i],connectionHandle:s,point:e,meta:t,nativeEvent:n})?(this.handle=o,this.handleName=s,a.start(e)):(r.startPoint=e,r.end(e,t,n))}move(e,t,n){let r=this._c.adorner;if(uh(this._c)&&r)return r.move(this.handle,e),this.toolService.diagram.trigger(oe,{shapes:[],connections:[this._c],connectionHandle:this.handleName,point:e,meta:t,nativeEvent:n}),!0}end(e,t,n){let r=this._c,i=r.adorner,a=this.toolService.diagram;if(i&&uh(r)){let o=i.stop(e);a.trigger(se,{shapes:[],connections:[r],connectionHandle:this.handleName,point:e,meta:t,nativeEvent:n})?o.undo():(a.undoRedoService.add(o,!1),r.updateModel(),a._syncConnectionChanges())}}getCursor(){return T.move}},wh=class{constructor(e){this.toolService=e,this.type=`ConnectionTool`}tryActivate(){return this.toolService._hoveredConnector}start(e,t,n){let r=this.toolService,i=r.diagram,a=r._hoveredConnector,o=i._createConnection({},a._c,e);uh(o)&&!i.trigger(ae,{shapes:[],connections:[o],connectionHandle:ve,point:e,meta:t,nativeEvent:n})&&i._addConnection(o)?(r._connectionManipulation(o,a._c.shape,!0),r._removeHover(),r.selectSingle(r.activeConnection,t),t.type===`touchmove`&&(i._cachedTouchTarget=a.visual)):(o.source(null),r.end(e,t,n))}move(e,t,n){let r=this.toolService,i=r.activeConnection,a=e,o=r._hoveredConnector;return o&&o._c!==i.sourceConnector&&(a=o._c.positionWithoutOffset()),i.target(a),r.diagram.trigger(oe,{shapes:[],connections:[i],connectionHandle:ve,point:e,meta:t,nativeEvent:n}),!0}end(e,t,n){let r=this.toolService,i=r.diagram,a=r.activeConnection,o=r.hoveredItem,s=r._hoveredConnector,c=i._cachedTouchTarget,l;a&&(l=s&&s._c!==a.sourceConnector?s._c:o&&o instanceof $?o.getConnector(E)||o.getConnector(e):e,a.target(l),i.trigger(se,{shapes:[],connections:[a],connectionHandle:ve,point:e,meta:t,nativeEvent:n})?(i.remove(a,!1),i.undoRedoService.pop()):(a.updateModel(),i._syncConnectionChanges()),r._connectionManipulation(),c&&(i._connectorsAdorner.visual.remove(c),i._cachedTouchTarget=null))}getCursor(){return T.arrow}},Th=class{constructor(e){this.toolService=e}start(){}move(){}end(){}tryActivate(){return!1}getCursor(){return T.arrow}};function Eh(e){return e.ctrlKey===!1&&e.altKey===!1&&e.shiftKey===!1}var Dh=class{constructor(e){this.toolService=e}tryActivate(){return!0}start(e,t,n){let r=this.toolService,i=r.diagram,a=r.hoveredItem;a&&(r.selectSingle(a,t),a.adorner&&(this.adorner=a.adorner,this.handle=this.adorner._hitTest(e))),this.handle||(this.handle=i._resizingAdorner._hitTest(e),this.handle&&(this.adorner=i._resizingAdorner)),this.adorner&&(!this.adorner.isDragHandle(this.handle)||!i.trigger(ae,{shapes:this.adorner.shapes,connections:[],point:e,nativeEvent:n,meta:t})?this.adorner.start(e):(r.startPoint=e,r.end(e,t,n)))}move(e,t,n){this.adorner&&(this.adorner.move(this.handle,e),this.adorner.isDragHandle(this.handle)&&this.toolService.diagram.trigger(oe,{shapes:this.adorner.shapes,connections:[],point:e,meta:t,nativeEvent:n}))}end(e,t,n){let r=this.toolService.diagram,i=this.adorner,a;i&&(!i.isDragHandle(this.handle)||!r.trigger(se,{shapes:i.shapes,connections:[],point:e,meta:t,nativeEvent:n})?(a=i.stop(),a&&r.undoRedoService.add(a,!1)):i.cancel()),this.adorner=void 0,this.handle=void 0}getCursor(e){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(e):T.arrow}};let Oh={down:`pointerdown`,move:`pointermove`,up:`pointerup`,cancel:`pointercancel pointerleave`};function kh(e){return Oh[e]||e}let Ah=e=>e.replace(/([^ ]+)/g,kh),jh=Jn,Mh=function(e,t,n){return`translate3d(`+e+`px,`+t+`px,0) scale(`+n+`)`};var Nh=class extends Et{constructor(e,t){super();let n=e[0]||e;this.element=n,this.capture=!1,this._pressHandler=this._press.bind(this),this._releaseHandler=this._release.bind(this),Oh.down.split(` `).forEach(e=>{n.addEventListener(e,this._pressHandler,!0)}),Oh.up.split(` `).forEach(e=>{n.addEventListener(e,this._releaseHandler,!0)}),this.bind([`press`,`release`],t||{})}captureNext(){this.capture=!0}cancelCapture(){this.capture=!1}_press(e){this.trigger(`press`),this.capture&&e.preventDefault()}_release(e){this.trigger(`release`),this.capture&&(e.preventDefault(),this.cancelCapture())}destroy(){let e=this.element;Oh.down.split(` `).forEach(t=>{e.removeEventListener(t,this._pressHandler,!0)}),Oh.up.split(` `).forEach(t=>{e.removeEventListener(t,this._releaseHandler,!0)})}},Ph=class extends Et{constructor(e){super(),this.forcedEnabled=!1,bm(this,e),this.scale=1,this.horizontal?(this.measure=`offsetWidth`,this.scrollSize=`scrollWidth`,this.axis=`x`):(this.measure=`offsetHeight`,this.scrollSize=`scrollHeight`,this.axis=`y`)}makeVirtual(){bm(this,{virtual:!0,forcedEnabled:!0,_virtualMin:0,_virtualMax:0})}virtualSize(e,t){(this._virtualMin!==e||this._virtualMax!==t)&&(this._virtualMin=e,this._virtualMax=t,this.update())}outOfBounds(e){return e>this.max||e<this.min}forceEnabled(){this.forcedEnabled=!0}getSize(){return this.container[this.measure]}getTotal(){return this.element[this.scrollSize]}rescale(e){this.scale=e}update(e){let t=this.virtual?this._virtualMax:this.getTotal(),n=t*this.scale,r=this.getSize();t===0&&!this.forcedEnabled||(this.max=this.virtual?-this._virtualMin:0,this.size=r,this.total=n,this.min=Math.min(this.max,r-n),this.minScale=r/t,this.centerOffset=(n-r)/2,this.enabled=this.forcedEnabled||n>r,e||this.trigger(w,this))}},Fh=class extends Et{constructor(e){super(),this.x=new Ph(bm({horizontal:!0},e)),this.y=new Ph(bm({horizontal:!1},e)),this.container=e.container,this.forcedMinScale=e.minScale,this.maxScale=e.maxScale||100,this.bind(w,e)}rescale(e){this.x.rescale(e),this.y.rescale(e),this.refresh()}centerCoordinates(){return{x:Math.min(0,-this.x.centerOffset),y:Math.min(0,-this.y.centerOffset)}}refresh(){this.x.update(),this.y.update(),this.enabled=this.x.enabled||this.y.enabled,this.minScale=this.forcedMinScale||Math.min(this.x.minScale,this.y.minScale),this.fitScale=Math.max(this.x.minScale,this.y.minScale),this.trigger(w)}},Ih=class extends Et{constructor(e){super(),bm(this,e)}outOfBounds(){return this.dimension.outOfBounds(this.movable[this.axis])}dragMove(e){let t=this.dimension,n=this.axis,r=this.movable,i=r[n]+e;if(!t.enabled)return;let a=e;(i<t.min&&e<0||i>t.max&&e>0)&&(a*=this.resistance),r.translateAxis(n,a),this.trigger(w,this)}},Lh=class{constructor(e){let t,n;bm(this,{elastic:!0},e);let r=this.elastic?.5:0,i=this.movable;this.x=t=new Ih({axis:`x`,dimension:this.dimensions.x,resistance:r,movable:i}),this.y=n=new Ih({axis:`y`,dimension:this.dimensions.y,resistance:r,movable:i}),this.userEvents.bind([`press`,`move`,`end`,`gesturestart`,`gesturechange`],{gesturestart(e){this.gesture=e,this.offset=jh(this.dimensions.container)},press(e){let t=e.event.target.closest(`a`);t&&t.matches(`[data-navigate-on-press=true]`)&&e.sender.cancel()},gesturechange(e){let r=this.gesture,a=r.center,o=e.center,s=this.dimensions.minScale,c=this.dimensions.maxScale,l=e.distance/r.distance;i.scale<=s&&l<1&&(l+=(1-l)*.8),i.scale*l>=c&&(l=c/i.scale);let u=i.x+this.offset.left,d=i.y+this.offset.top,f={x:(u-a.x)*l+o.x-u,y:(d-a.y)*l+o.y-d};i.scaleWith(l),t.dragMove(f.x),n.dragMove(f.y),this.dimensions.rescale(i.scale),this.gesture=e,e.preventDefault()},move(e){e.event.target.tagName.match(/textarea|input/i)||(t.dimension.enabled||n.dimension.enabled?(t.dragMove(e.x.delta),n.dragMove(e.y.delta),e.preventDefault()):e.touch.skip())},end(e){e.preventDefault()}})}},Rh=class extends Et{constructor(e){super(),this.element=e,this.element.style.transformOrigin=`left top`,this.x=0,this.y=0,this.scale=1;let t=Mh(this.x,this.y,this.scale);this.element.style.transform=t,this._saveCoordinates(t)}translateAxis(e,t){this[e]+=t,this.refresh()}scaleTo(e){this.scale=e,this.refresh()}scaleWith(e){this.scale*=e,this.refresh()}translate(e){this.x+=e.x,this.y+=e.y,this.refresh()}moveAxis(e,t){this[e]=t,this.refresh()}moveTo(e){bm(this,e),this.refresh()}refresh(){let e=this.x,t=this.y;this.round&&(e=Math.round(e),t=Math.round(t));let n=Mh(e,t,this.scale);n!==this.coordinates&&(this.element.style.transform=n,this._saveCoordinates(n),this.trigger(w))}_saveCoordinates(e){this.coordinates=e}};function zh(e){window.requestAnimationFrame(e)}var Bh=class{constructor(){this._tickProxy=()=>this._tick(),this._started=!1}tick(){}done(){return!1}onEnd(){}onCancel(){}start(){this.enabled()&&(this.done()?this.onEnd():(this._started=!0,zh(this._tickProxy)))}enabled(){return!0}cancel(){this._started=!1,this.onCancel()}_tick(){this._started&&(this.tick(),this.done()?(this._started=!1,this.onEnd()):zh(this._tickProxy))}},Vh=class extends Bh{constructor(e){super(),bm(this,e)}done(){return this.timePassed()>=this.duration}timePassed(){return Math.min(this.duration,xm()-this.startDate)}moveTo(e){this.initial=this.movable[this.axis],this.delta=e.location-this.initial,this.duration=typeof e.duration==`number`?e.duration:300,this.tick=this._easeProxy(e.ease),this.startDate=xm(),this.start()}_easeProxy(e){return function(){this.movable.moveAxis(this.axis,e(this.timePassed(),this.initial,this.delta,this.duration))}}static easeOutExpo(e,t,n,r){return e===r?t+n:n*(-(2**(-10*e/r))+1)+t}};function Hh(){let e=``,t,n;for(t=0;t<32;t++)n=Math.floor(Math.random()*16),(t===8||t===12||t===16||t===20)&&(e+=`-`),e+=(t===12?4:t===16?n%4+8:n).toString(16);return e}let Uh=new WeakMap,Wh=Symbol(`id`);function Gh(e,t,n,r,i){Jh(e,t,n,r,i)}function Kh(e,t,n,r){Xh(e,t,n,r)}function qh(e){return typeof e==`string`}function Jh(e,t,n,r,i){(Array.isArray(t)?t:(t||``).split(` `)).forEach(function(t){Yh(e,t,n,r,i)})}function Yh(e,t,n,r,i){let a=r,o;n&&Ge(n)&&!r?a=n:n&&qh(n)&&Ge(a)&&(o=n);let s=function(t){let n=t.target?t.target.closest(o):null;if(!o||o&&t.target&&n){let r=o?n:t.currentTarget;Object.defineProperty(t,`currentTarget`,{value:r}),Object.defineProperty(t,`delegateTarget`,{value:e}),a(t)}};a[Wh]||(a[Wh]=Hh());let c=Uh.get(e);c||(c=new Map,Uh.set(e,c)),c.set(t+a[Wh],s),e.addEventListener(t,s,!!i)}function Xh(e,t,n,r){(Array.isArray(t)?t:(t||``).split(` `)).forEach(function(t){Zh(e,t,n,r)})}function Zh(e,t,n,r){let i=Uh.get(e);if(i&&n&&n[Wh]){let a=t+n[Wh],o=i.get(a);i.delete(a),o&&e.removeEventListener(t,o,!!r)}}function Qh(e,t){let n=e.length,r=[];for(let i=0;i<n;i++)t(e[i])&&r.push(e[i]);return r}let $h=e=>{e.preventDefault()},eg=()=>{},tg=`press`,ng=`hold`,rg=`select`,ig=`start`,ag=`move`,og=`cancel`,sg=`doubleTap`,cg=`release`,lg=`gesturechange`,ug=`gestureend`,dg=`gesturetap`,fg={api:0,touch:0,mouse:3,pointer:3},pg=800,mg=0;function hg(e,t){let n=e.x.location,r=e.y.location,i=t.x.location,a=t.y.location,o=n-i,s=r-a;return{center:{x:(n+i)/2,y:(r+a)/2},distance:Math.sqrt(o*o+s*s)}}function gg(e){let t=[],n=e.originalEvent||e,r=e.currentTarget;return e.api?t.push({id:2,event:e,target:e.target,currentTarget:e.target,location:e,type:`api`}):t.push({location:n,event:e,target:e.target,currentTarget:r,id:n.pointerId,type:`pointer`}),t}var _g=class{constructor(e,t){this.support=_m(),this.invalidZeroEvents=this.support.mobileOS&&this.support.mobileOS.android,this.axis=e,this._updateLocationData(t),this.startLocation=this.location,this.velocity=this.delta=0,this.timeStamp=xm()}move(e){let t=e[`page`+this.axis],n=xm(),r=n-this.timeStamp||1;!t&&this.invalidZeroEvents||(this.delta=t-this.location,this._updateLocationData(e),this.initialDelta=t-this.startLocation,this.velocity=this.delta/r,this.timeStamp=n)}_updateLocationData(e){let t=this.axis;this.location=e[`page`+t],this.client=e[`client`+t],this.screen=e[`screen`+t]}},vg=class{constructor(e,t,n){bm(this,{x:new _g(`X`,n.location),y:new _g(`Y`,n.location),type:n.type,threshold:e.threshold||fg[n.type],userEvents:e,target:t,currentTarget:n.currentTarget,initialTouch:n.target,id:n.id,pressEvent:n,_clicks:e._clicks,supportDoubleTap:e.supportDoubleTap,_moved:!1,_finished:!1})}press(){this._holdTimeout=setTimeout(()=>this._hold(),this.userEvents.minHold),this._trigger(tg,this.pressEvent)}_tap(e){this.userEvents._clicks++,this.userEvents._clicks===1&&(this._clickTimeout=setTimeout(()=>{this.userEvents._clicks===1?this._trigger(`tap`,e):this._trigger(sg,e),this.userEvents._clicks=0},300))}_hold(){this._trigger(ng,this.pressEvent)}move(e){let t=e.type!==`api`&&this.userEvents._shouldNotMove;if(!(this._finished||t)){if(this.x.move(e.location),this.y.move(e.location),!this._moved){if(this._withinIgnoreThreshold())return;if(!bg.current||bg.current===this.userEvents)this._start(e);else return this.dispose()}this._finished||this._trigger(ag,e)}}end(e){this.endTime=xm(),!this._finished&&(this._finished=!0,this._trigger(cg,e),this._moved?this._trigger(`end`,e):this.supportDoubleTap?this._tap(e):this._trigger(`tap`,e),clearTimeout(this._holdTimeout),this.dispose())}dispose(){let e=this.userEvents.touches||[];this._finished=!0,this.pressEvent=null,clearTimeout(this._holdTimeout);let t=e.indexOf(this);e.splice(t,1)}skip(){this.dispose()}cancel(){this.dispose()}isMoved(){return this._moved}_start(e){clearTimeout(this._holdTimeout),this.startTime=xm(),this._moved=!0,this._trigger(ig,e)}_trigger(e,t){let n=t.event,r={touch:this,x:this.x,y:this.y,target:this.target,event:n};this.userEvents.notify(e,r)&&n.preventDefault()}_withinIgnoreThreshold(){let e=this.x.initialDelta,t=this.y.initialDelta;return Math.sqrt(e*e+t*t)<=this.threshold}};function yg(e){let t=Oh.up.split(` `),n=t.length;for(let r=0;r<n;r++)e(t[r])}var bg=class e extends Et{constructor(e,t){super(),this.support=_m(),t||={},this.options=t;let n=this.filter=t.filter;if(this.threshold=t.threshold||mg,this.minHold=t.minHold||pg,this.touches=[],this._maxTouches=t.multiTouch?2:1,this.allowSelection=t.allowSelection,this.captureUpIfMoved=t.captureUpIfMoved,this._clicks=0,this.supportDoubleTap=t.supportDoubleTap,bm(this,{element:e,surface:t.surface||e,stopPropagation:t.stopPropagation,pressed:!1}),this._surfaceMoveHandler=this._move.bind(this),Gh(this.surface,Ah(`move`),this._surfaceMoveHandler),this._surfaceEndHandler=this._end.bind(this),Gh(this.surface,Ah(`up cancel`),this._surfaceEndHandler),this._elementStartHandler=this._start.bind(this),Gh(e,Ah(`down`),n,this._elementStartHandler),e.style[`touch-action`]=t.touchAction||`none`,t.preventDragEvent&&(this._elementDragStartHandler=$h,Gh(e,Ah(`dragstart`),this._elementDragStartHandler)),this._elementSelectHandler=this._select.bind(this),Gh(e,Ah(`mousedown`),n,this._elementSelectHandler),this.captureUpIfMoved){let e=this.surface;this.preventIfMovingProxy=this.preventIfMoving.bind(this),yg(t=>{e.addEventListener(t,this.preventIfMovingProxy,!0)})}this.bind([tg,ng,`tap`,sg,ig,ag,`end`,cg,og,`gesturestart`,lg,ug,dg,rg],t)}preventIfMoving(e){this._isMoved()&&e.preventDefault()}destroy(){let e=this.options,t=this.element;if(!this._destroyed){if(this._destroyed=!0,this.captureUpIfMoved){let e=this.surface;yg(t=>{e.removeEventListener(t,this.preventIfMovingProxy,!0)})}Kh(this.surface,Ah(`move`),this._surfaceMoveHandler),Kh(this.surface,Ah(`up cancel`),this._surfaceEndHandler),Kh(t,Ah(`down`),this._elementStartHandler),e.preventDragEvent&&Kh(t,Ah(`dragstart`),this._elementDragStartHandler),Kh(t,Ah(`mousedown`),this._elementSelectHandler),this._disposeAll(),this.unbind(),delete this.surface,delete this.element,delete this.currentTarget}}capture(){e.current=this}cancel(){this._disposeAll(),this.trigger(og)}notify(e,t){let n=this.touches,r=e;if(this._isMultiTouch()){switch(r){case ag:r=lg;break;case`end`:r=ug;break;case`tap`:r=dg;break;default:break}bm(t,{touches:n},hg(n[0],n[1]))}return this.trigger(r,bm(t,{type:r}))}press(e,t,n){this._apiCall(`_start`,e,t,n)}move(e,t){this._apiCall(`_move`,e,t)}end(e,t){this._apiCall(`_end`,e,t)}_isMultiTouch(){return this.touches.length>1}_maxTouchesReached(){return this.touches.length>=this._maxTouches}_disposeAll(){let e=this.touches;for(;e.length>0;)e.pop().dispose()}_isMoved(){return Qh(this.touches,function(e){return e.isMoved()}).length}_select(e){(!this.allowSelection||this.trigger(rg,{event:e}))&&e.preventDefault()}_start(t){if(t.which&&t.which>1||this._maxTouchesReached())return;e.current=null,this.currentTarget=t.currentTarget,this.stopPropagation&&t.stopPropagation();let n,r=gg(t);for(let e=0;e<r.length&&!this._maxTouchesReached();e++){let t=r[e];if(n=this.filter?t.currentTarget:this.element,n&&n.length===0)continue;let i=new vg(this,n,t);this.touches.push(i),i.press(),this._isMultiTouch()&&this.notify(`gesturestart`,{})}}_move(e){this._eachTouch(`move`,e)}_end(e){this._eachTouch(`end`,e)}_eachTouch(e,t){let n={},r=gg(t),i=this.touches,a,o,s,c;for(a=0;a<i.length;a++)o=i[a],n[o.id]=o;for(a=0;a<r.length;a++)s=r[a],c=n[s.id],c&&(e===`move`&&s.type===`pointer`&&!this.surface.hasPointerCapture(s.id)&&this.surface.setPointerCapture(s.id),c[e](s))}_apiCall(e,t,n,r){this[e]({api:!0,pageX:t,pageY:n,clientX:t,clientY:n,target:r||this.element,stopPropagation:eg,preventDefault:eg})}static defaultThreshold(e){mg=e}static minHold(e){pg=e}};let xg=Object.assign,Sg=Math.abs,Cg=`change`,wg=`scroll`;var Tg=class extends Bh{constructor(e){super(),xg(this,e),this.userEvents.bind(`gestureend`,this.start.bind(this)),this.tapCapture.bind(`press`,this.cancel.bind(this))}enabled(){return this.movable.scale<this.dimensions.minScale}done(){return this.dimensions.minScale-this.movable.scale<.01}tick(){let e=this.movable;e.scaleWith(1.1),this.dimensions.rescale(e.scale)}onEnd(){let e=this.movable;e.scaleTo(this.dimensions.minScale),this.dimensions.rescale(e.scale)}},Eg=class extends Bh{constructor(e){super(),xg(this,e,{transition:new Vh({axis:e.axis,movable:e.movable,onEnd:()=>{this._end()}})}),this.tapCapture.bind(`press`,()=>{this.cancel()}),this.userEvents.bind(`end`,()=>this.start()),this.userEvents.bind(`gestureend`,()=>this.start()),this.userEvents.bind(`tap`,()=>this.onEnd())}onCancel(){this.transition.cancel()}freeze(e){this.cancel(),this._moveTo(e)}onEnd(){this.paneAxis.outOfBounds()?this._snapBack():this._end()}done(){return Sg(this.velocity)<1}start(e){let t;this.dimension.enabled&&(this.paneAxis.outOfBounds()?this.transition._started?(this.transition.cancel(),this.velocity=Math.min(e.touch[this.axis].velocity*this.velocityMultiplier,55),super.start()):this._snapBack():(t=e?e.touch.id===2?0:e.touch[this.axis].velocity:0,this.velocity=Math.max(Math.min(t*this.velocityMultiplier,55),-55),this.tapCapture.captureNext(),super.start()))}tick(){let e=this.dimension,t=this.paneAxis.outOfBounds()?.5:this.friction,n=this.velocity*=t,r=this.movable[this.axis]+n;!this.elastic&&e.outOfBounds(r)&&(r=Math.max(Math.min(r,e.max),e.min),this.velocity=0),this.movable.moveAxis(this.axis,r)}_end(){this.tapCapture.cancelCapture(),this.end()}end(){}_snapBack(){let e=this.dimension,t=this.movable[this.axis]>e.max?e.max:e.min;this._moveTo(t)}_moveTo(e){this.transition.moveTo({location:e,duration:500,ease:(...e)=>{Vh.easeOutExpo.apply(null,e)}})}},Dg=class extends Bh{constructor(e){super(),xg(this,e,{origin:{},destination:{},offset:{}})}moveTo(e){}tick(){this._updateCoordinates(),this.moveTo(this.origin)}done(){return Sg(this.offset.y)<5&&Sg(this.offset.x)<5}onEnd(){this.moveTo(this.destination),this.callback&&this.callback.call()}setCoordinates(e,t){this.offset={},this.origin=e,this.destination=t}setCallback(e){e&&Ge(e)?this.callback=e:e=void 0}_updateCoordinates(){this.offset={x:(this.destination.x-this.origin.x)/4,y:(this.destination.y-this.origin.y)/4},this.origin={y:this.origin.y+this.offset.y,x:this.origin.x+this.offset.x}}},Og=class{constructor(e){let t=e.axis===`x`,n=Cm(`<div class="km-touch-scrollbar km-`+(t?`horizontal`:`vertical`)+`-scrollbar" />`);xg(this,e,{element:n,elementSize:0,movable:new Rh(n),scrollMovable:e.movable,alwaysVisible:e.alwaysVisible,size:t?`width`:`height`}),this.scrollMovable.bind(Cg,this.refresh.bind(this)),this.container.appendChild(n),e.alwaysVisible&&this.show()}refresh(){let e=this.axis,t=this.dimension,n=t.size,r=this.scrollMovable,i=n/t.total,a=Math.round(n*i),o=Math.round(-r[e]*i);i>=1?this.element.style.display=`none`:this.element.style.display=``,o+a>n?a=n-o:o<0&&(a+=o,o=0),this.elementSize!==a&&(this.element.style[this.size]=a+`px`,this.elementSize=a),this.movable.moveAxis(e,o)}show(){this.element.style.opacity=.7,this.element.style.visibility=`visible`}hide(){this.alwaysVisible||(this.element.style.opacity=0)}};let kg={name:`Scroller`,zoom:!1,pullOffset:140,visibleScrollHints:!1,elastic:!0,useNative:!1,mousewheelScrolling:!0,avoidScrolling:()=>!1,pullToRefresh:!1,messages:{pullTemplate:`Pull to refresh`,releaseTemplate:`Release to refresh`,refreshTemplate:`Refreshing`}};var Ag=class extends Et{constructor(e,t){super(),this.element=e=e[0]||e,this._initOptions(t),this.events.push(`pull`,wg,`resize`);let n=Em();this._native=this.options.useNative&&n;let r=Cm(`<div class="km-scroll-header"/>`);if(this._native){Sm(e,`km-native-scroller`),wm(r,e),xg(this,{scrollElement:e,fixedContainer:e.children[0]});return}e.style.overflow=`hidden`,Sm(e,`km-scroll-wrapper`);let i=Cm(`<div class="km-scroll-container"/>`);Tm(e,i),wm(r,e);let a=e.children[1],o=new Nh(e),s=new Rh(a),c=new Fh({element:a,container:e,forcedEnabled:this.options.zoom}),l=this.options.avoidScrolling,u=new bg(e,{touchAction:`none`,allowSelection:!0,preventDragEvent:!0,captureUpIfMoved:!0,multiTouch:this.options.zoom,supportDoubleTap:this.options.supportDoubleTap,start:e=>{c.refresh();let t=Sg(e.x.velocity),n=Sg(e.y.velocity),r=t*2>=n,i=this.fixedContainer.contains(e.event.target),a=n*2>=t;!i&&!l(e)&&this.enabled&&(c.x.enabled&&r||c.y.enabled&&a)?u.capture():u.cancel()}}),d=new Lh({movable:s,dimensions:c,userEvents:u,elastic:this.options.elastic}),f=new Tg({movable:s,dimensions:c,userEvents:u,tapCapture:o}),p=new Dg({moveTo:e=>{this.scrollTo(e.x,e.y)}});s.bind(Cg,()=>{this.scrollTop=-s.y,this.scrollLeft=-s.x,this.trigger(wg,{scrollTop:this.scrollTop,scrollLeft:this.scrollLeft})}),this.options.mousewheelScrolling&&(this._wheelScrollHandler=this._wheelScroll.bind(this),Gh(e,`wheel`,this._wheelScrollHandler)),xg(this,{movable:s,dimensions:c,zoomSnapBack:f,animatedScroller:p,userEvents:u,pane:d,tapCapture:o,pulled:!1,enabled:!0,scrollElement:a,scrollTop:0,scrollLeft:0,fixedContainer:e.children[0]}),this._initAxis(`x`),this._initAxis(`y`),this._wheelEnd=()=>{this._wheel=!1,this.userEvents.end(0,this._wheelY)},c.refresh(),this.options.pullToRefresh&&this._initPullToRefresh(),this.bind(this.events,this.options)}_initOptions(e){this.options=J({},this.options,kg,e)}_wheelScroll(e){if(e.ctrlKey)return;this._wheel||(this._wheel=!0,this._wheelY=0,this.userEvents.press(0,this._wheelY)),clearTimeout(this._wheelTimeout),this._wheelTimeout=setTimeout(()=>this._wheelEnd(),50);let t=Dm(e);t&&(this._wheelY+=t,this.userEvents.move(0,this._wheelY)),e.preventDefault()}makeVirtual(){this.dimensions.y.makeVirtual()}virtualSize(e,t){this.dimensions.y.virtualSize(e,t)}height(){return this.dimensions.y.size}scrollHeight(){return this.scrollElement.scrollHeight}scrollWidth(){return this.scrollElement.scrollWidth}_resize(){this._native||this.contentResized()}setOptions(e){this._initOptions(e),e.pullToRefresh&&this._initPullToRefresh()}reset(){this._native?this.scrollElement.scrollTop(0):(this.movable.moveTo({x:0,y:0}),this._scale(1))}contentResized(){this.dimensions.refresh(),this.pane.x.outOfBounds()&&this.movable.moveAxis(`x`,this.dimensions.x.min),this.pane.y.outOfBounds()&&this.movable.moveAxis(`y`,this.dimensions.y.min)}zoomOut(){let e=this.dimensions;e.refresh(),this._scale(e.fitScale),this.movable.moveTo(e.centerCoordinates())}enable(){this.enabled=!0}disable(){this.enabled=!1}scrollTo(e,t){this._native?(this.scrollElement.scrollLeft(Sg(e)),this.scrollElement.scrollTop(Sg(t))):(this.dimensions.refresh(),this.movable.moveTo({x:e,y:t}))}animatedScrollTo(e,t,n){let r,i;this._native?this.scrollTo(e,t):(r={x:this.movable.x,y:this.movable.y},i={x:e,y:t},this.animatedScroller.setCoordinates(r,i),this.animatedScroller.setCallback(n),this.animatedScroller.start())}pullHandled(){}destroy(){let e=this.element;Kh(e,`wheel`,this._wheelScrollHandler),this.userEvents&&this.userEvents.destroy(),this.tapCapture&&this.tapCapture.destroy()}_scale(e){this.dimensions.rescale(e),this.movable.scaleTo(e)}_initPullToRefresh(){}_dragEnd(){}_paneChange(){}_initAxis(e){let t=this.movable,n=this.dimensions[e],r=this.tapCapture,i=this.pane[e],a=new Og({axis:e,movable:t,dimension:n,container:this.element,alwaysVisible:this.options.visibleScrollHints});n.bind(Cg,()=>{a.refresh()}),i.bind(Cg,()=>{a.show()}),this[e+`inertia`]=new Eg({axis:e,paneAxis:i,movable:t,tapCapture:r,userEvents:this.userEvents,dimension:n,elastic:this.options.elastic,friction:this.options.friction||.96,velocityMultiplier:this.options.velocityMultiplier||10,end:()=>{a.hide(),this.trigger(`scrollEnd`,{axis:e,scrollTop:this.scrollTop,scrollLeft:this.scrollLeft})}})}};function jg(){return/Macintosh|iPhone|iPad/i.test((window==null?void 0:window.navigator)?.userAgent||``)}var Mg=class extends Th{constructor(e){super(e);let t=this.toolService.diagram,n=t.canvas,r=t._mobileOS()?.93:.9,i=t.scroller=this.scroller=new Ag(t.scrollable,{friction:r,velocityMultiplier:5,mousewheelScrolling:!1,zoom:!1,scroll:this._move.bind(this)});n.translate&&(this.movableCanvas=new Rh(n.element));let a=function(e,t,n){e.makeVirtual(),e.virtualSize(t||-2e4,n||2e4)};a(i.dimensions.x),a(i.dimensions.y),i.disable()}tryActivate(e,t){let n=this.toolService,r=n.diagram.options.pannable,i=t.metaKey&&jg(),a=t.ctrlKey||i;return O(r.key)&&(!r.key||r.key===`none`?a=Eh(t)&&!O(n.hoveredItem):(a=t[r.key+`Key`],a||=r.key===`ctrl`&&i)),r!==!1&&a&&!O(n.hoveredAdorner)&&!O(n._hoveredConnector)}start(){this.scroller.enable()}move(){}_move(e){let t=this.toolService.diagram,n=t.canvas,r=new K(e.scrollLeft,e.scrollTop);n.translate?(t._storePan(r.times(-1)),this.movableCanvas.moveTo(r),n.translate(r.x,r.y)):r=r.plus(t._pan.times(-1)),t.trigger(`pan`,{pan:r})}end(){this.scroller.disable()}getCursor(){return T.move}},Ng=class{constructor(e){this.toolService=e}tryActivate(e,t){let n=this.toolService,r=n.diagram.options.selectable,i=r&&r.multiple!==!1;return i&&=r.key&&r.key!==`none`?t[r.key+`Key`]:Eh(t),i&&!O(n.hoveredItem)&&!O(n.hoveredAdorner)}start(e){let t=this.toolService.diagram;t.deselect(),t.selector.start(e)}move(e){this.toolService.diagram.selector.move(e)}end(e,t){let n=this.toolService.diagram,r=this.toolService.hoveredItem,i=n.selector.bounds();(!r||!r.isSelected)&&!t.ctrlKey&&n.deselect(),i.isEmpty()||n.selectArea(i),n.selector.end()}getCursor(){return T.arrow}};function Pg(e,t){return t.charCodeAt(0)===e||t.toUpperCase().charCodeAt(0)===e}var Fg=class{constructor(e){this.toolService=e,this.type=`ConnectionResizeTool`}tryActivate(e,t){let n=this.toolService.hoveredItem,r=(n&&n.pointsEditable&&n.pointsEditable())!==!1&&n&&n.path&&n.isSelected&&n.resizeAdorner&&n.resizeAdorner._hitTest(e)!==null&&!t.ctrlKey;return r&&(this._c=n,this.handle=n.resizeAdorner._hitTest(e)),!!r}start(e,t,n){let r=this._c,i=r.resizeAdorner,a=uh(r),o=this.toolService.diagram.trigger(ae,{shapes:[],connections:[r],point:e,meta:t,nativeEvent:n});a&&i&&this.handle&&!o?i.start(e):(this.toolService.startPoint=e,this.toolService.end(e,t,n))}move(e,t,n){let r=this._c.resizeAdorner;if(uh(this._c)&&r&&this.handle)return r.move(this.handle,e),this.toolService.diagram.trigger(oe,{shapes:[],connections:[this._c],point:e,meta:t,nativeEvent:n}),!0}end(e,t,n){let r=this._c,i=r.resizeAdorner,a=this.toolService.diagram;if(i&&uh(r)){let o=i.stop(e);o&&!a.trigger(se,{shapes:[],connections:[r],point:e,meta:t,nativeEvent:n})?(a.undoRedoService.add(o,!1),r.updateModel(),a._syncConnectionChanges()):o?o.undo():i.cancel()}}getCursor(e){let t=this._c;return t&&t.resizeAdorner&&this.handle?t.resizeAdorner._getCursor(this.handle.point):T.move}},Ig=class{constructor(e,t,n){this.item=e,this._redoSource=t,this._redoTarget=n,O(t)&&(this._undoSource=e.source()),O(n)&&(this._undoTarget=e.target()),this.title=be}undo(){this._undoSource!==void 0&&this.item._updateConnector(this._undoSource,_e),this._undoTarget!==void 0&&this.item._updateConnector(this._undoTarget,ve),this.item.updateModel()}redo(){this._redoSource!==void 0&&this.item._updateConnector(this._redoSource,_e),this._redoTarget!==void 0&&this.item._updateConnector(this._redoTarget,ve),this.item.updateModel()}};let Lg={hover:{stroke:{}},startCap:Ee,endCap:Ee,cornerRadius:0,anchorOffset:20,points:[],selectable:!0,fromConnector:E,toConnector:E},Rg=e=>({...e,padding:void 0,textPadding:e.padding,background:e.position===xe?e.background||e.bgColor:e.background});var zg=class e extends jm{constructor(e,t,n={}){n=J({},Lg,n),super(n),this.name=He,this.previewState={lastSide:null},this.routingMode=`auto`,this.updateOptionsFromModel(),this._initRouter(),this.path=new wp(this.options),this.path.fill(v),this.visual.append(this.path),this._sourcePoint=this._targetPoint=new K,this._setSource(e),this._setTarget(t),this.content(this.options.content),this.definers=[],n.points&&this.points(n.points),n.locks?this.locks=n.locks.map(e=>({...e})):this.locks=[]}_getCursor(e){if(this.resizeAdorner){let t=this.resizeAdorner._getCursor(e);if(t!==T.select)return t}return this.adorner?this.adorner._getCursor(e):this.options.cursor||T.select}_setOptionsFromModel(e){this.updateOptionsFromModel(e||this.dataItem)}updateOptionsFromModel(e){if(this.diagram&&this.diagram._isEditable){let t=this.diagram._dataMap,n=im(e||this.dataItem);if(e){if(O(n.from)){let e=t[n.from];e&&O(n.fromConnector)&&(e=e.getConnector(n.fromConnector)),this.source(e)}else O(n.fromX)&&O(n.fromY)&&this.source(new K(n.fromX,n.fromY));if(O(n.to)){let e=t[n.to];e&&O(n.toConnector)&&(e=e.getConnector(n.toConnector)),this.target(e)}else O(n.toX)&&O(n.toY)&&this.target(new K(n.toX,n.toY));O(n.type)&&this.type()!==n.type&&(this.points([]),this.type(n.type)),this.dataItem=e,this._template(),this.redraw(this.options)}else this.options=J({},n,this.options)}}updateModel(e){this.diagram&&this.diagram._isEditable&&this.diagram.updateConnectionModel(this,e)}sourcePoint(){return this._resolvedSourceConnector?this._resolvedSourceConnector.positionWithoutOffset():this._sourcePoint}_setSource(e){let t=e instanceof $,n=this.options.fromConnector||E,r;t&&!e.getConnector(n)||(e!==void 0&&(this.from=e),this._removeFromSourceConnector(),e===null?this.sourceConnector&&(this._sourcePoint=(this._resolvedSourceConnector||this.sourceConnector).positionWithoutOffset(),this._clearSourceConnector(),this._setFromOptions(null,this._sourcePoint)):e instanceof dm?(r=e.shape.dataItem,r&&this._setFromOptions(r.id),this.sourceConnector=e,this.sourceConnector.connections.push(this)):e instanceof K?(this._setFromOptions(null,e),this._sourcePoint=e,this.sourceConnector&&this._clearSourceConnector()):t&&(r=e.dataItem,r&&this._setFromOptions(r.id),this.sourceConnector=e.getConnector(n),this.sourceConnector.connections.push(this)))}source(e,t){return D(e)&&(t&&this.diagram&&this.diagram.undoRedoService.addCompositeItem(new Ig(this,e)),this._setSource(e),this.refresh()),this.sourceConnector?this.sourceConnector:this._sourcePoint}_setFromOptions(e,t){this.options.from=e,t?(this.options.fromX=t.x,this.options.fromY=t.y):(this.options.fromX=null,this.options.fromY=null)}sourceDefiner(e){if(e)if(e instanceof cf)e.left=null,this._sourceDefiner=e,this.source(e.point);else throw Error(`The sourceDefiner needs to be a PathDefiner.`);else return this._sourceDefiner||=new cf(this.sourcePoint(),null,null),this._sourceDefiner}targetPoint(){return this._resolvedTargetConnector?this._resolvedTargetConnector.positionWithoutOffset():this._targetPoint}_setTarget(e){let t=e instanceof $,n=this.options.toConnector||E,r;t&&!e.getConnector(n)||(e!==void 0&&(this.to=e),this._removeFromTargetConnector(),e===null?this.targetConnector&&(this._targetPoint=(this._resolvedTargetConnector||this.targetConnector).positionWithoutOffset(),this._clearTargetConnector(),this._setToOptions(null,this._targetPoint)):e instanceof dm?(r=e.shape.dataItem,r&&this._setToOptions(r.id),this.targetConnector=e,this.targetConnector.connections.push(this)):e instanceof K?(this._setToOptions(null,e),this._targetPoint=e,this.targetConnector&&this._clearTargetConnector()):t&&(r=e.dataItem,r&&this._setToOptions(r.id),this.targetConnector=e.getConnector(n),this.targetConnector.connections.push(this)))}target(e,t){return D(e)&&(t&&this.diagram&&this.diagram.undoRedoService.addCompositeItem(new Ig(this,void 0,e)),this._setTarget(e),this.refresh()),this.targetConnector?this.targetConnector:this._targetPoint}_setToOptions(e,t){this.options.to=e,t?(this.options.toX=t.x,this.options.toY=t.y):(this.options.toX=null,this.options.toY=null)}targetDefiner(e){if(e)if(e instanceof cf)e.right=null,this._targetDefiner=e,this.target(e.point);else throw Error(`The sourceDefiner needs to be a PathDefiner.`);else return this._targetDefiner||=new cf(this.targetPoint(),null,null),this._targetDefiner}_updateConnectors(){this._updateConnector(this.source(),_e),this._updateConnector(this.target(),ve)}_updateConnector(e,t){let n=this.diagram;if(e instanceof dm&&!n.getShapeById(e.shape.id)){let r=e.shape.dataItem,i=e.options.name,a=()=>{e=n._dataMap[r.id].getConnector(i),this[t](e,!1),this.updateModel()};if(n._dataMap[r.id])a();else{let e=n._inactiveShapeItems.getByUid(r.uid);e&&n._deferredConnectionUpdates.push(e.onActivate(a))}}else this[t](e,!1)}content(e){let t=this.options.content.text,n=this._content(e);return O(e)&&(t!==n&&(this._contentVisual._measured=!1),this._alignContent()),n}_createContentVisual(e){let t,n=e.visual,r=e.template,i=bm({},e,{dataItem:this.dataItem||e.dataItem}),a=gm(i);if(n)t=Ge(a)?a.call(this,i):null;else if(r){let e=Ge(a)?a.call(this,i.dataItem||{}):null;if(Ge(e))t=e;else if(A(e)){let n={...i,text:e};t=new(Om(n))(Rg(n))}}else e.text&&(t=new(Om(e))(Rg(e)));return t&&(this._contentVisual=t,t._includeInBBox=!1,this.visual.append(t)),t}_updateContentVisual(e){Ge(e.visual)?(this.visual.remove(this._contentVisual),this._createContentVisual(e)):this._contentVisual.redraw(e)}_alignContent(){if(this._contentVisual){let e=this.options.content||{},t=e.offset===void 0?5:e.offset,n=this.allPoints(),r=Math.floor(n.length/2),i=r-1;for(;i>0&&n[i].equals(n[r]);)i--,r++;let a=n[r],o=n[i],s=this._contentVisual._measure(),c=s.width,l=s.height,u=n.length%2==0,d=o.distanceTo(a),f=e.position||{},p=f.vertical||`top`,m=f.horizontal||`right`,h=f===xe,g=0,_=0;if((h||e.border)&&this._contentVisual._textOnlyRect){let e=this._contentVisual._textOnlyRect;c=e.size.width,l=e.size.height,g=e.origin.x,_=e.origin.y}u&&n.length>2&&d>0&&(o.y===a.y&&d<c||o.x===a.x&&d<l)&&(u=!1);let v=`left`,y=`bottom`,b;if(u){let e=Mn(Math.atan2(a.y-o.y,a.x-o.x));b=new K((a.x-o.x)/2+o.x,(a.y-o.y)/2+o.y),h?(b.x-=c/2+g,b.y-=l/2+_):Math.abs(e)===90?(m===v?b.x-=c+t:b.x+=t,b.y-=l/2):e%180==0?(b.x-=c/2,p===y?b.y+=t:b.y-=l+t):e<-90||0<e&&e<90?b.y-=l:(e<0||e>90)&&(b.x-=c,b.y-=l)}else{let e=Math.floor(n.length/2);b=n[e].clone(),o=n[e-1],a=n[e+1];let r=o.x===b.x&&a.x===b.x,i=o.y===b.y&&a.y===b.y,u,d;h?(u=-(c/2+g),d=-(l/2+_)):r?(u=m===v?-s.width-t:t,d=-s.height/2):i?(u=-s.width/2,d=p===y?t:-s.height-t):(u=o.x<=b.x&&a.x<=b.x?t:-s.width-t,d=o.y<=b.y&&a.y<=b.y?t:-s.height-t),b.x+=u,b.y+=d}this._contentVisual.position(b)}}select(e){let t=this.diagram,n,r;if(this._canSelect()&&this.isSelected!==e)return this.isSelected=e,n=[],r=[],this.isSelected?(this.adorner=new Nm(this,this.options.selection),t._adorn(this.adorner,!0),this.resizeAdorner=new((this.options.type||``).toLowerCase()===Ce?oh:sh)(this,this.options.editable?.points),t._adorn(this.resizeAdorner,!0),t._selectedItems.push(this),n.push(this)):(this.adorner&&=(t._adorn(this.adorner,!1),void 0),this.resizeAdorner&&=(t._adorn(this.resizeAdorner,!1),void 0),M(t._selectedItems,this),r.push(this)),this.adorner&&this.adorner.refresh(),this.resizeAdorner&&this.resizeAdorner.refresh(),t._internalSelection||t._selectionChanged(n,r),!0}bounds(e){if(e&&!A(e))this._bounds=e;else return this._bounds}type(e){let t=this.options;if(e)e!==t.type&&(t.type=e,this._initRouter(),this.refresh());else return t.type}_initRouter(){(this.options.type||``).toLowerCase()===Ce?this._router=new xh(this):this._router=new Sh(this)}points(e){if(e){this.definers=[];for(let t=0;t<e.length;t++){let n=e[t];if(n instanceof K)this.definers.push(new cf(n));else if(Object.prototype.hasOwnProperty.call(n,`x`)&&Object.prototype.hasOwnProperty.call(n,`y`))this.definers.push(new cf(new K(n.x,n.y)));else throw Error(`A Connection point needs to be a Point or an object with x and y properties.`)}}else{let e=[];if(D(this.definers))for(let t=0;t<this.definers.length;t++)e.push(this.definers[t].point);return e}}allPoints(){let e=[this.sourcePoint()];if(this.definers)for(let t=0;t<this.definers.length;t++)e.push(this.definers[t].point);return e.push(this.targetPoint()),e}refresh(){this._resolveConnectors(),this._refreshPath(),this._alignContent(),this.adorner&&this.adorner.refresh(),this.resizeAdorner&&this.resizeAdorner.refresh()}_resolveConnectors(e){let t=e||this;t._resolvedSourceConnector=void 0,t._resolvedTargetConnector=void 0;let n=this.source(),r=this.target(),i=r instanceof K?r:null,a=n instanceof K?n:null;if(n instanceof dm){let e=$p(n)?n.shape.connectors:[n];i&&$p(n)?t._resolvedSourceConnector=em(i,e):$p(n)||(t._resolvedSourceConnector=n)}if(r instanceof dm){let e=$p(r)?r.shape.connectors:[r];a&&$p(r)?t._resolvedTargetConnector=em(a,e):$p(r)||(t._resolvedTargetConnector=r)}if(!i&&!a&&n instanceof dm&&r instanceof dm){let t=$p(n)?n.shape.connectors:[n],i=$p(r)?r.shape.connectors:[r];this._resolveAutoConnectors(t,i,e)}}_resolveAutoConnectors(e,t,n){let r=n||this;if(this.pointsEditable()&&(this.routingMode===`manual`||this._hasPolylineEditedPoints())){this._resolveAutoConnectorsWithLocks(e,t,n);return}let i=we,a=we,o,s,c,l,u,d,f,p,m,h,g;for(m=0;m<e.length;m++)if(f=e[m],!$p(f))for(c=f.positionWithoutOffset(),h=0;h<t.length;h++)p=t[h],$p(p)||(l=p.positionWithoutOffset(),g=Math.round(c.distanceTo(l)),g<i&&this.diagram&&this._testRoutePoints(c,l,f,p)&&(i=g,o=f,s=p),g<a&&(u=f,d=p,a=g));o&&(u=o,d=s),r._resolvedSourceConnector=u,r._resolvedTargetConnector=d}_hasPolylineEditedPoints(){return this._router instanceof Sh&&this.definers&&this.definers.length>0}_resolveAutoConnectorsWithLocks(e,t,n){let r=n||this,i=we,a=we,o,s,c,l;for(let n=0;n<e.length;n++){let r=e[n];if($p(r))continue;let u=r.positionWithoutOffset();for(let e=0;e<t.length;e++){let n=t[e];if($p(n))continue;let d=n.positionWithoutOffset(),f=this._calculateRouteLength(u,d,r,n);this.diagram&&this._testRoutePoints(u,d,r,n)&&f<a&&(a=f,c=r,l=n),f<i&&(i=f,o=r,s=n)}}c?(r._resolvedSourceConnector=c,r._resolvedTargetConnector=l):(r._resolvedSourceConnector=o,r._resolvedTargetConnector=s)}_calculateRouteLength(e,t,n,r){let i=this._router;if(i instanceof xh){let a=[e,...i.routePoints(e,t,n,r),t],o=0;for(let e=1;e<a.length;e++)o+=a[e-1].distanceTo(a[e]);return Math.round(o)}else if(this._hasPolylineEditedPoints()){let n=[e,...this.definers.map(e=>e.point),t],r=0;for(let e=1;e<n.length;e++)r+=n[e-1].distanceTo(n[e]);return Math.round(r)}return Math.round(e.distanceTo(t))}_testRoutePoints(e,t,n,r){let i=this._router,a=!0;if(i instanceof xh){let o=i.routePoints(e,t,n,r),s=this._getRouteExclude(e,t,n.shape,r.shape),c,l,u;o.unshift(e),o.push(t);for(let e=1;e<o.length;e++)if(c=o[e-1],l=o[e],u=new q(Math.min(c.x,l.x),Math.min(c.y,l.y),Math.abs(c.x-l.x),Math.abs(c.y-l.y)),u.width>0&&(u.x++,u.width-=2),u.height>0&&(u.y++,u.height-=2),!u.isEmpty()&&this.diagram._shapesQuadTree.hitTestRect(u,s)){a=!1;break}}return a}_getRouteExclude(e,t,n,r){let i=[];return this._isPointInsideShape(e,n)&&i.push(n),this._isPointInsideShape(t,r)&&i.push(r),i}_isPointInsideShape(e,t){let n=t.bounds(),r=t.rotate().angle,i=n.x,a=n.y,o=e.clone().rotate(r,n.center()),s=o.x,c=o.y;return s>i&&s<i+n.width&&c>a&&c<a+n.height}redraw(e){if(e){this.options=J({},this.options,e);let t=this.options.points;O(t)&&t.length>0&&(this.points(t),this._refreshPath()),(e&&e.content||e.text)&&this.content(e.content),this.path.redraw({fill:e.fill,stroke:e.stroke,startCap:e.startCap,endCap:e.endCap})}}clone(){let t=this.serialize();return this.diagram&&this.diagram._isEditable&&O(this.dataItem)&&(t.options.dataItem=this.diagram.options.cloneDataItem(this.dataItem)),new e(this.from,this.to,t.options)}serialize(){let e=this.from.toJSON?this.from.toJSON:this.from.toString(),t=this.to.toJSON?this.to.toJSON:this.to.toString(),n=J({},{options:this.options,from:e,to:t});return O(this.dataItem)&&(n.dataItem=this.dataItem.toString()),n.options.points=this.points(),this.locks&&this.locks.length>0&&(n.options.locks=this.locks.map(e=>({...e}))),n}_hitTest(e){if(this.visible()){let t=new K(e.x,e.y),n=this.sourcePoint(),r=this.targetPoint();if(e.isEmpty&&!e.isEmpty()&&e.contains(n)&&e.contains(r)||this._router.hitTest(t))return this}}_hover(e){let t=(this.options.stroke||{}).color;e&&D(this.options.hover.stroke.color)&&(t=this.options.hover.stroke.color),this.path.redraw({stroke:{color:t}})}_refreshPath(){O(this.path)&&(this._drawPath(),this.bounds(this._router.getBounds()))}_drawPath(){this._router&&this._router.route();let e=this.sourcePoint(),t=this.targetPoint(),n=this.points();this.path.redraw({points:[e].concat(n,[t])})}_clearSourceConnector(){this.sourceConnector=void 0,this._resolvedSourceConnector=void 0}_clearTargetConnector(){this.targetConnector=void 0,this._resolvedTargetConnector=void 0}_removeFromSourceConnector(){this.sourceConnector&&M(this.sourceConnector.connections,this)}_removeFromTargetConnector(){this.targetConnector&&M(this.targetConnector.connections,this)}toJSON(){let e,t,n;return this.from&&this.from.toJSON?e=this.from.toJSON():(n=this._sourcePoint,e={x:n.x,y:n.y}),this.to&&this.to.toJSON?t=this.to.toJSON():(n=this._targetPoint,t={x:n.x,y:n.y}),{from:e,to:t}}focus(){this.path.drawingElement.options.set(Ue,Ae)}blur(){this.path.drawingElement.options.set(Ue,``)}pointsEditable(){let e=this.options.editable;return e&&typeof e!=`boolean`&&(e=e.points),e!==!1}};let Bg=F;function Vg(e,t){let n,r,i;for(let a=0;a<e.connectors.length;a++)if(n=e.connectors[a],r=n.position(),i=new q(r.x,r.y),i.inflate(10,10),i.contains(t))return n}var Hg=class{constructor(e){this.diagram=e,this.tools=[new Mg(this),new Fg(this),new Ch(this),new wh(this),new Ng(this),new Dh(this)],this.activeTool=void 0}start(e,t,n){return t=J({},t),this.activeTool&&this.activeTool.end(e,t),this._updateHoveredItem(e,t,n),this._activateTool(e,t),this.activeTool.start(e,t,n),this._updateCursor(e),this.diagram.focus(),this.diagram.canvas.surface.suspendTracking(),this.startPoint=e,!0}move(e,t,n){t=J({},t);let r=!0;return this.activeTool&&(r=this.activeTool.move(e,t,n)),r&&this._updateHoveredItem(e,t,n),this._updateCursor(e),!0}end(e,t,n){return t=J({},t),this.activeTool&&this.activeTool.end(e,t,n),this.diagram.canvas.surface.resumeTracking(),this.activeTool=void 0,this._updateCursor(e),!0}keyDown(e,t){let n=this.diagram;if(t=J({ctrlKey:!1,metaKey:!1,altKey:!1},t),(t.ctrlKey||t.metaKey)&&!t.altKey){if(Pg(e,`a`))return n.selectAll(),n._destroyToolBar(),!0;if(Pg(e,`z`))return n.undo(),n._destroyToolBar(),!0;if(Pg(e,`y`))return n.redo(),n._destroyToolBar(),!0;Pg(e,`c`)?(n.copy(),n._destroyToolBar()):Pg(e,`x`)?(n.cut(),n._destroyToolBar()):Pg(e,`v`)?(n.paste(),n._destroyToolBar()):Pg(e,`l`)?(n.layout(),n._destroyToolBar()):Pg(e,`d`)&&(n._destroyToolBar(),n.copy(),n.paste())}else if(e===46||e===8){let e=this.diagram._triggerRemove(n.select());return e.length&&(this.diagram.remove(e,!0),this.diagram._syncChanges(),this.diagram._destroyToolBar()),!0}else if(e===27)return this._discardNewConnection(),n.deselect(),n._destroyToolBar(),!0}wheel(e,t,n){let r=this.diagram,i=r.zoom(),a=t.delta,o=r.options,s=o.zoomRate,c={point:e,meta:t,zoom:i,nativeEvent:n};if(!r.trigger(fe,c))return a<0?i+=s:i-=s,i=Bg(Math.max(o.zoomMin,Math.min(o.zoomMax,i)),2),c.zoom=i,r.zoom(i,c),r.trigger(pe,c),!0}setTool(e,t){e.toolService=this,this.tools[t]=e}selectSingle(e,t){let n=this.diagram,r=n.options.selectable;if(r&&!e.isSelected&&e.options.selectable!==!1){let i=t.ctrlKey&&r.multiple!==!1;n.select(e,{addToSelection:i})}}_discardNewConnection(){this.newConnection&&=(this.diagram.remove(this.newConnection),void 0)}_activateTool(e,t){for(let n=0;n<this.tools.length;n++){let r=this.tools[n];if(r.tryActivate(e,t)){this.activeTool=r;break}}}_updateCursor(e){let t=this.diagram.element,n;this.activeTool?n=this.activeTool.getCursor(e):this.hoveredAdorner?(n=this.hoveredAdorner._getCursor(e),!n&&this.hoveredItem&&(n=this.hoveredItem._getCursor(e))):this.hoveredItem&&(n=this.hoveredItem._getCursor(e)),t.style.cursor=n||T.arrow}_connectionManipulation(e,t,n){this.activeConnection=e,this.disabledShape=t,n?this.newConnection=this.activeConnection:this.newConnection=void 0}_updateHoveredItem(e,t,n){let r=this._hitTest(e),i=this.diagram;r!==this.hoveredItem&&(!this.disabledShape||r!==this.disabledShape)&&(this.hoveredItem&&(i.trigger(de,{item:this.hoveredItem,nativeEvent:n,point:e,meta:t}),this.hoveredItem._hover(!1)),r&&r.options.enable?(i.trigger(ue,{item:r,nativeEvent:n,point:e,meta:t}),this.hoveredItem=r,this.hoveredItem._hover(!0)):this.hoveredItem=void 0)}_removeHover(){this.hoveredItem&&=(this.hoveredItem._hover(!1),void 0)}_hitTest(e){let t=this.diagram,n,r,i;if(this._hoveredConnector&&=(this._hoveredConnector._hover(!1),void 0),t._connectorsAdorner._visible&&(n=t._connectorsAdorner._hitTest(e),n))return n;if(n=this.diagram._resizingAdorner._hitTest(e),n){if(this.hoveredAdorner=t._resizingAdorner,n.x!==0||n.y!==0)return;n=void 0}else this.hoveredAdorner=void 0;if(!this.activeTool||this.activeTool.type!==`ConnectionTool`){let a=[];for(i=0;i<t._selectedItems.length;i++)r=t._selectedItems[i],r instanceof zg&&a.push(r);n=this._hitTestItems(a,e)}return n||this._hitTestElements(e)}_hitTestElements(e){let t=this.diagram,n=this._hitTestItems(t.shapes,e),r=this._hitTestItems(t.connections,e),i;if((!this.activeTool||this.activeTool.type!==`ConnectionTool`)&&n&&r&&!Vg(n,e)){let e=t.mainLayer;i=dt(n.visual,e.children)>dt(r.visual,e.children)?n:r}return i||n||r}_hitTestItems(e,t){let n,r,i;for(n=e.length-1;n>=0;n--)if(r=e[n],i=r._hitTest(t),i)return i}},Ug=class{constructor(e,t){this.connection=e,this.diagram=t,this.title=`New connection`}undo(){this.diagram.remove(this.connection,!1)}redo(){this.diagram._addConnection(this.connection,!1)}},Wg=class{constructor(e,t){this.shape=e,this.diagram=t,this.title=`New shape`}undo(){this.diagram.deselect(),this.diagram.remove(this.shape,!1)}redo(){this.diagram._addShape(this.shape,!1)}},Gg=class{constructor(e){this.units=[],this.title=`Composite unit`,e!==void 0&&this.units.push(e)}add(e){this.units.push(e)}undo(){for(let e=0;e<this.units.length;e++)this.units[e].undo()}redo(){for(let e=0;e<this.units.length;e++)this.units[e].redo()}},Kg=class{constructor(e){this.connection=e,this.diagram=e.diagram,this.targetConnector=e.targetConnector,this.title=`Delete connection`}undo(){this.diagram._addConnection(this.connection,!1)}redo(){this.diagram.remove(this.connection,!1)}},qg=class{constructor(e){this.shape=e,this.diagram=e.diagram,this.title=`Deletion`}undo(){this.diagram._addShape(this.shape,!1),this.shape.select(!1)}redo(){this.shape.select(!1),this.diagram.remove(this.shape,!1)}},Jg=class{constructor(e){this.layoutState=e,this.diagram=e.diagram}initState(){this.froms=[],this.tos=[],this.subjects=[],this.layoutState.nodeMap.forEach((e,t)=>{let n=this.diagram.getShapeById(e);n&&(this.subjects.push(n),this.froms.push(n.bounds().topLeft()),this.tos.push(t.topLeft()))},this)}update(e){if(!(this.subjects.length<=0))for(let t=0;t<this.subjects.length;t++)this.subjects[t].position(new K(this.froms[t].x+(this.tos[t].x-this.froms[t].x)*e,this.froms[t].y+(this.tos[t].y-this.froms[t].y)*e))}},Yg=class{constructor(e,t,n){k(n)?this.animate=!1:this.animate=!!n,this._initialState=e,this._finalState=t,this.title=`Diagram layout`}undo(){this.setState(this._initialState)}redo(){this.setState(this._finalState)}setState(e){let t=e.diagram;if(this.animate){e.linkMap.forEach(function(e,n){let r=t.getShapeById(e);r.visible(!1),r&&r.points(n)});let n=new At;n.addAdapter(new Jg(e)),n.onComplete(function(){e.linkMap.forEach(function(e){t.getShapeById(e).visible(!0)})}),n.play()}else e.nodeMap.forEach(function(e,n){let r=t.getShapeById(e);r&&r.position(n.topLeft())}),e.linkMap.forEach(function(e,n){let r=t.getShapeById(e);r&&r.points(n)})}},Xg=class{constructor(e,t,n){this.initial=e,this.finalPos=t,this.diagram=n,this.title=`Pan Unit`}undo(){this.diagram.pan(this.initial)}redo(){this.diagram.pan(this.finalPos)}},Zg=class{constructor(e,t,n){this.diagram=e,this.indices=n,this.items=t,this.title=`Rotate Unit`}undo(){this.diagram._toIndex(this.items,this.indices)}redo(){this.diagram.toBack(this.items,!1)}},Qg=class{constructor(e,t,n){this.diagram=e,this.indices=n,this.items=t,this.title=`Rotate Unit`}undo(){this.diagram._toIndex(this.items,this.indices)}redo(){this.diagram.toFront(this.items,!1)}},$g=class extends Et{constructor(e={}){super(),this.events=[`undone`,`redone`],this.bind(this.events,e),this.stack=[],this.index=0,this.capacity=1e4}begin(){this.composite=new Gg}cancel(){this.composite=void 0}commit(e){this.composite.units.length>0&&this._restart(this.composite,e),this.composite=void 0}addCompositeItem(e){this.composite?this.composite.add(e):this.add(e)}add(e,t){this._restart(e,t)}pop(){this.index>0&&(this.stack.pop(),this.index--)}count(){return this.stack.length}undo(){this.index>0&&!this.trigger(`undo`,{unit:this.stack[this.index-1]})&&(this.index--,this.stack[this.index].undo(),this.trigger(`undone`))}redo(){this.stack.length>0&&this.index<this.stack.length&&!this.trigger(`redo`,{unit:this.stack[this.index]})&&(this.stack[this.index].redo(),this.index++,this.trigger(`redone`))}_restart(e,t){this.stack.splice(this.index,this.stack.length-this.index),this.stack.push(e),t===!1?this.index++:this.redo(),this.stack.length>this.capacity&&(this.stack.splice(0,this.stack.length-this.capacity),this.index=this.capacity)}clear(){this.stack=[],this.index=0}},e_=class{constructor(e){this.dataItem=e,this.callbacks=[]}onActivate(e){return new Promise(t=>{this.callbacks.push({callback:e,resolve:t})})}activate(){let e=this.callbacks,t;for(let n=0;n<e.length;n++)t=this.callbacks[n],t.callback(this.dataItem),t.resolve();this.callbacks=[]}},t_=class{constructor(){this.items={}}add(e){for(let t=0;t<e.length;t++)this.items[e[t].uid]=new e_(e[t])}forEach(e){for(let t in this.items)Object.prototype.hasOwnProperty.call(this.items,t)&&e(this.items[t])}getByUid(e){return this.items[e]}remove(e){delete this.items[e.uid]}destroy(){this.items={}}},n_=class{constructor(){this.shapes=[]}_add(e,t){this.shapes.push({bounds:t,shape:e}),e._quadNode=this}insert(e,t){this._add(e,t)}remove(e){let t=this.shapes,n=t.length;for(let r=0;r<n;r++)if(t[r].shape===e){t.splice(r,1);break}}hitTestRect(e,t){let n=this.shapes,r=n.length;for(let i=0;i<r;i++)if(this._testRect(n[i].shape,e)&&!N(t,n[i].shape))return!0}_testRect(e,t){let n=e.rotate().angle,r=e.bounds(),i;return i=n?nf.rects(t,r,-n):r.overlaps(t),i}},r_=class e extends n_{constructor(e){super(),this.children=[],this.rect=e}inBounds(e){let t=this.rect,n=t.bottomRight(),r=e.bottomRight();return t.x<=e.x&&t.y<=e.y&&r.x<=n.x&&r.y<=n.y}overlapsBounds(e){return this.rect.overlaps(e)}insert(e,t){let n=!1,r=this.children,i=r.length;if(this.inBounds(t)){if(!i&&this.shapes.length<4)this._add(e,t);else{i||this._initChildren();for(let i=0;i<r.length;i++)if(r[i].insert(e,t)){n=!0;break}n||this._add(e,t)}n=!0}return n}_initChildren(){let t=this.rect,n=this.children,r=this.shapes,i=t.center(),a=t.width/2,o=t.height/2,s,c;for(n.push(new e(new q(t.x,t.y,a,o)),new e(new q(i.x,t.y,a,o)),new e(new q(t.x,i.y,a,o)),new e(new q(i.x,i.y,a,o))),c=r.length-1;c>=0;c--)for(s=0;s<n.length;s++)if(n[s].insert(r[c].shape,r[c].bounds)){r.splice(c,1);break}}hitTestRect(e,t){let n,r=this.children,i=r.length,a=!1;if(this.overlapsBounds(e)){if(super.hitTestRect(e,t))a=!0;else for(n=0;n<i;n++)if(r[n].hitTestRect(e,t)){a=!0;break}}return a}},i_=class{constructor(e){this.ROOT_SIZE=1e3;let t=this._boundsChange.bind(this);e.bind(le,t),e.bind(ce,t),this.initRoots()}initRoots(){this.rootMap={},this.root=new n_}clear(){this.initRoots()}_boundsChange(e){e.item._quadNode&&e.item._quadNode.remove(e.item),this.insert(e.item)}insert(e){let t=e.bounds(ge),n=this.ROOT_SIZE,r=this.getSectors(t),i=r[0][0],a=r[1][0];this.inRoot(r)?this.root.insert(e,t):(this.rootMap[i]||(this.rootMap[i]={}),this.rootMap[i][a]||(this.rootMap[i][a]=new r_(new q(i*n,a*n,n,n))),this.rootMap[i][a].insert(e,t))}remove(e){e._quadNode&&e._quadNode.remove(e)}inRoot(e){return e[0].length>1||e[1].length>1}getSectors(e){let t=this.ROOT_SIZE,n=e.bottomRight(),r=Math.floor(n.x/t),i=Math.floor(n.y/t),a=[[],[]];for(let n=Math.floor(e.x/t);n<=r;n++)a[0].push(n);for(let n=Math.floor(e.y/t);n<=i;n++)a[1].push(n);return a}hitTestRect(e,t){let n=this.getSectors(e),r,i,a,o,s;if(this.root.hitTestRect(e,t))return!0;for(r=0;r<n[0].length;r++)for(a=n[0][r],i=0;i<n[1].length;i++)if(o=n[1][i],s=(this.rootMap[a]||{})[o],s&&s.hitTestRect(e,t))return!0;return!1}};function a_(e,t,n){let r;for(let i=0;i<n.length;i++)r=n[i],t&&!O(t[r])&&(t[r]=e[r])}let o_={name:`Diagram`,theme:`sass`,layout:``,zoomRate:.1,zoom:1,zoomMin:0,zoomMax:2,dataSource:{},draggable:!0,template:``,autoBind:!0,editable:{rotate:{},resize:{},text:!0,tools:[],drag:{snap:{size:10,angle:10}},remove:!0},pannable:{},selectable:{key:`none`},tooltip:{delay:200,enabled:!0,format:`{0}`},copy:{enabled:!0,offsetX:20,offsetY:20},tabIndex:0,navigation:{disabled:!1,smallStep:1,largeStep:5},accessibility:{role:`graphics-document`,ariaRoleDescription:`Diagram`},shapeDefaults:pm({undoable:!0,connectors:void 0}),connectionDefaults:{accessibility:{role:`graphics-symbol`,ariaRoleDescription:He},editable:{tools:[],points:{snap:6}},tooltip:{visible:!0},type:Ce},shapes:[],connections:[]},s_=[`contextmenu`,`dblclick`,`pointerdown`,`pointermove`,`pointerup`,`pointercancel`,`pointerleave`,`touchstart`,`touchmove`,`touchend`,`touchcancel`],c_=[pe,fe,`pan`,Te,ce,le,w,`click`,ue,de,me,he,`toolBarClick`,`save`,`cancel`,`edit`,`remove`,`undo`,`redo`,`add`,`dataBound`,...s_,ae,oe,se];function l_(e){let t=[],n=[],r,i;for(i=0;i<e.length;i++)r=e[i],r instanceof $?n.push(r):t.push(r);return{shapes:n,connections:t}}function u_(e){let t=e.getBoundingClientRect(),n=e.ownerDocument,r=n.defaultView.scrollX||n.documentElement.scrollLeft||0,i=n.defaultView.scrollY||n.documentElement.scrollTop||0;return{top:t.top+i,left:t.left+r}}function d_(e,t=!1){let n=e.offsetHeight;if(t){let t=getComputedStyle(e),r=parseFloat(t.marginTop),i=parseFloat(t.marginBottom);n+=r+i}return n}function f_(e){let t=getComputedStyle(e),n=e.clientWidth,r=parseFloat(t.paddingLeft),i=parseFloat(t.paddingRight);return n-r-i}function p_(e){let t=getComputedStyle(e),n=e.clientHeight,r=parseFloat(t.paddingTop),i=parseFloat(t.paddingBottom);return n-r-i}function m_(e,t){let n=[],r=new Set,i=[...e].sort((e,t)=>{let n=e.bounds(),r=t.bounds();return n.y===r.y?n.x-r.x:n.y-r.y}),a=new Map;i.forEach((e,t)=>{a.set(e,t)});for(let e of i){n.push(e);let i=t.filter(t=>t.from===e&&!r.has(t)).sort((e,t)=>(e.to?a.get(e.to)??1/0:1/0)-(t.to?a.get(t.to)??1/0:1/0));for(let e of i)n.push(e),r.add(e)}for(let e of t)r.has(e)||n.push(e);return n}var h_=class{constructor(e){this.elements=[],this._skipAutoFocus=!1,this._selectHandler=e=>{if(!this.isDisabled())if(e.selected&&e.selected.length>0){this.elements=m_(e.sender.shapes,e.sender.connections);let t=this.elements.indexOf(e.selected[0]);t!==-1&&(this.currentIndex=t,e.selected.length===1&&this.focusSelectedElement())}else this.diagram.element.removeAttribute(je),this.blurAll()},this._keydownHandler=e=>{if(this.isDisabled()||!this._hasFocus())return;let t=this.diagram._meta(e),n=t.metaKey&&jg();if(t.ctrlKey||n){let t=this.elements[this.currentIndex];if(!t)return;let n=this.diagram.options.navigation?.smallStep;if(e.shiftKey&&(n=this.diagram.options.navigation?.largeStep),t.name!==Ve||!Xe(n))return;let r=t,i=r.bounds(),a=r.position().clone();switch(e.key){case ze:a.x+=n,e.preventDefault();break;case Be:a.x-=n,e.preventDefault();break;case`ArrowUp`:a.y-=n,e.preventDefault();break;case`ArrowDown`:a.y+=n,e.preventDefault();break;default:break}if(!a.equals(r.position())){r.position(a);let e=new dh([r],[i]);this.diagram.undoRedoService.add(e,!1)}}else switch(e.key){case ze:this.focusNext(),e.preventDefault();break;case Be:this.focusPrevious(),e.preventDefault();break;case`Home`:this.focusFirst(),e.preventDefault();break;case`End`:this.focusLast(),e.preventDefault();break;default:break}},this._downHandler=()=>{this.isDisabled()||this._hasFocus()||(this._skipAutoFocus=!0)},this._focusHandler=()=>{if(!this.isDisabled()){if(this._skipAutoFocus){this._skipAutoFocus=!1,this.elements.length>0&&this.currentIndex>=0&&this.currentIndex<this.elements.length&&this.focusSelectedElement();return}this.elements=m_(this.diagram.shapes,this.diagram.connections),this.updateFocus()}},this._blurHandler=()=>{this.isDisabled()||this.blurAll()},this.currentIndex=0,this.diagram=e,this.attachEvents(),this.setTabIndex()}setTabIndex(){let{options:e,element:t}=this.diagram;!t.hasAttribute(Me)&&!k(e.tabIndex)&&t.setAttribute(Me,String(e.tabIndex))}attachEvents(){this.diagram.element.addEventListener(Ne,this._keydownHandler),this.diagram.element.addEventListener(Pe,this._downHandler),this.diagram.element.addEventListener(Fe,this._downHandler),this.diagram.element.addEventListener(Ie,this._downHandler),this.diagram.element.addEventListener(Le,this._focusHandler),this.diagram.element.addEventListener(Re,this._blurHandler),this.diagram.bind(Te,this._selectHandler)}isDisabled(){return this.diagram?.options.navigation?.disabled}detachEvents(){this.diagram.element.removeEventListener(Ne,this._keydownHandler),this.diagram.element.removeEventListener(Pe,this._downHandler),this.diagram.element.removeEventListener(Fe,this._downHandler),this.diagram.element.removeEventListener(Ie,this._downHandler),this.diagram.element.removeEventListener(Le,this._focusHandler),this.diagram.element.removeEventListener(Re,this._blurHandler),this.diagram.unbind(Te,this._selectHandler)}_hasFocus(){return this.diagram?.element.ownerDocument.activeElement===this.diagram.element}destroy(){this.diagram&&this.detachEvents(),this.elements=[],this.currentIndex=-1,this.diagram=null}focusNext(){this.elements.length!==0&&(this.currentIndex=(this.currentIndex+1)%this.elements.length,this.updateFocus())}focusPrevious(){this.elements.length!==0&&(this.currentIndex=(this.currentIndex-1+this.elements.length)%this.elements.length,this.updateFocus())}focusFirst(){this.elements.length!==0&&(this.currentIndex=0,this.updateFocus())}focusLast(){this.elements.length!==0&&(this.currentIndex=this.elements.length-1,this.updateFocus())}selectCurrent(){this.elements[this.currentIndex].select(!0),this.focusSelectedElement()}deselectAll(){this.elements.forEach(e=>{e.select(!1),e.blur()}),this.diagram.element.removeAttribute(je)}focusSelectedElement(){let e=this.elements[this.currentIndex];this.diagram.element.setAttribute(je,e.options.id),this.blurAll(),e.focus()}blurAll(){this.elements.forEach(e=>e.blur())}updateFocus(){this.elements.length===0||this.currentIndex<0||this.currentIndex>=this.elements.length||(this.deselectAll(),this.selectCurrent())}},g_=class extends Et{constructor(e,t,n){super(),this._clipboard=[],this._connectionsDataMap={},this._dataMap={},this._inactiveShapeItems=new t_,this._selectedItems=[],this.shapes=[],this.connections=[],this._deferredConnectionUpdates=[],this._domEvent=e=>{let t=this._meta(e),n=this._eventPositions(e),r=this.toolService._hitTest(n);this.trigger(e.type,{nativeEvent:e,item:r,point:n,meta:t})},this.element=e,this.options=J({createToolBar:xt,destroyToolBar:xt},o_,t),this.events=c_,this._initTheme(n),this._initElements(),this._extendLayoutOptions(this.options),this._initDefaults(t),this._interactionDefaults(),this._initCanvas(),this.mainLayer=new lp({id:`main-layer`}),this.canvas.append(this.mainLayer),this._shapesQuadTree=new i_(this),this._pan=new K,this._adorners=[],this.adornerLayer=new lp({id:`adorner-layer`}),this.canvas.append(this.adornerLayer),this._createHandlers(),this._initialize(),this._resizingAdorner=new mh(this,{editable:this.options.editable}),this._connectorsAdorner=new lh(this),this._adorn(this._resizingAdorner,!0),this._adorn(this._connectorsAdorner,!0),this.selector=new gh(this),this._clipboard.length=0,this.pauseMouseHandlers=!1,this._navigation=new h_(this)}_createShape(e,t){return t=J({},this.options.shapeDefaults,t),t.dataItem=e,new $(t,this)}_createConnection(e,t,n){let r=J({},this.options.connectionDefaults);return r.dataItem=e,new zg(t||new K,n||new K,r)}_initElements(){this.element.innerHTML=``,this.element.style.position=`relative`,this.element.classList.add(`k-diagram`),this.scrollable=document.createElement(`div`),this.element.appendChild(this.scrollable);let e=this.options.accessibility||{};this._setAttributes(`role`,e.role),this._setAttributes(`aria-label`,e.ariaLabel),this._setAttributes(`aria-roledescription`,e.ariaRoleDescription),this.wrapper=this.element}_setAttributes(e,t){O(t)&&this.element.setAttribute(e,String(t))}_initDefaults(e){let t=this.options,n=t.editable,r=t.shapeDefaults,i=t.connectionDefaults,a=(e||{}).shapeDefaults;n===!1?(r.editable=!1,i.editable=!1):(a_(n,r.editable,[`drag`,`remove`,`connect`]),a_(n,i.editable,[`drag`,`remove`])),a&&a.connectors&&(t.shapeDefaults.connectors=a.connectors)}_interactionDefaults(){let e=this.options,t=e.selectable,n=e.pannable,r=this._mobileOS();t&&!O(t.multiple)&&(e.selectable=J({multiple:!r},e.selectable)),n&&!O(n.key)&&(e.pannable=J({key:r?`none`:`ctrl`},e.pannable))}_initCanvas(){let e=document.createElement(`div`);e.classList.add(`k-layer`),this.scrollable.appendChild(e);let t=this.viewport();this.canvas=new(this.options.Canvas||Pf)(e,{width:t.width||600,height:t.height||600})}_createHandlers(){let e=this.element;this._wheelHandler=this._wheelHandler||this._wheel.bind(this),this._keydownHandler=this._keydownHandler||this._keydown.bind(this),this._mobileOS()&&this._mobileOS().browser.mobilesafari?e.addEventListener(`mousewheel`,this._wheelHandler):e.addEventListener(`wheel`,this._wheelHandler),e.addEventListener(`keydown`,this._keydownHandler),this._userEvents=new bg(this.scrollable,{multiTouch:!0,fastTap:!0,tap:this._tap.bind(this),start:this._dragStart.bind(this),move:this._drag.bind(this),end:this._dragEnd.bind(this),gesturestart:this._gestureStart.bind(this),gesturechange:this._gestureChange.bind(this),gestureend:this._gestureEnd.bind(this),doubleTap:this._doubleTap.bind(this),supportDoubleTap:!0}),this.toolService=new Hg(this),this._mouseoverHandler=this._mouseoverHandler||this._mouseover.bind(this),this._mouseoutHandler=this._mouseoutHandler||this._mouseout.bind(this),this._mouseMoveHandler=this._mouseMoveHandler||this._mouseMove.bind(this),this._mouseDownHandler=this._mouseDownHandler||this._mouseDown.bind(this),this._mouseUpHandler=this._mouseUpHandler||this._mouseUp.bind(this),this.scrollable.addEventListener(`mouseover`,this._mouseoverHandler),this.scrollable.addEventListener(`mouseout`,this._mouseoutHandler),this.scrollable.addEventListener(`mousemove`,this._mouseMoveHandler),this.scrollable.addEventListener(`mousedown`,this._mouseDownHandler),this.scrollable.addEventListener(`mouseup`,this._mouseUpHandler),s_.forEach(e=>{this.scrollable.addEventListener(e,this._domEvent)}),this._initResizeObserver(),this.bind(fe,this._destroyToolBar.bind(this)),this.bind(`pan`,this._destroyToolBar.bind(this)),this.bind(ue,this._onMouseEnter.bind(this)),this.bind(de,this._onMouseLeave.bind(this))}_onMouseEnter(e){let{delay:t}=this.options.tooltip;this._tooltipTimeOut=setTimeout(()=>{this.trigger(me,e),this._tooltipTimeOut=null},t)}_onMouseLeave(e){clearTimeout(this._tooltipTimeOut),this.trigger(he,e)}_initResizeObserver(){let e=new ResizeObserver(e=>{e.forEach(e=>{let{width:t,height:n}=e.contentRect;e.target!==this.element||this.size&&this.size.width===t&&this.size.height===n||(this.size={width:t,height:n},this._resize(),this.trigger(`resize`,this.size))})});this._resizeObserver=e,e.observe(this.element)}_destroyResizeObserver(){this._resizeObserver&&=(this._resizeObserver.disconnect(),null)}_dragStart(e){this._pauseMouseHandlers=!0;let t=this._eventPositions(e,!0);this.toolService.start(t,this._meta(e),e.event)&&(this._destroyToolBar(),e.preventDefault())}_drag(e){let t=this._eventPositions(e);this.toolService.move(t,this._meta(e),e.event)&&e.preventDefault()}_dragEnd(e){this._pauseMouseHandlers=!1;let t=this._eventPositions(e);this.toolService.end(t,this._meta(e),e.event)&&(this.options.createToolBar(),e.preventDefault())}_mouseMove(e){if(!this._pauseMouseHandlers){let t=this._eventPositions(e);this.toolService._updateHoveredItem(t,this._meta(e),e),this.toolService._updateCursor(t)}}_mouseDown(){this._pauseMouseHandlers=!0}_mouseUp(){this._pauseMouseHandlers=!1}_tap(e){let t=this.toolService,n=this.options.selectable,r=this._eventPositions(e),i=this.focus(),a=this._meta(e);if(t._updateHoveredItem(r,a,e.event),t.hoveredItem){let o=t.hoveredItem;if(this.trigger(`click`,{nativeEvent:e.event,item:o,point:r,meta:a}),n&&o.options.selectable!==!1){let e=n.multiple!==!1,t=Dr||a.ctrlKey||a.metaKey&&jg();o.isSelected?t?(this._destroyToolBar(),o.select(!1)):this.options.createToolBar(i):(this._destroyToolBar(),this.select(o,{addToSelection:e&&t}),this.options.createToolBar(i))}}else n&&(this._destroyToolBar(),this.deselect())}_keydown(e){this.toolService.keyDown(e.keyCode,this._meta(e))&&e.preventDefault()}_wheel(e){let t=Qp(e),n=this._eventPositions(e),r=J(this._meta(e),{delta:t});this.toolService.wheel(n,r,e)&&e.preventDefault()}_meta(e){return e=e.event||e,{ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey,shiftKey:e.shiftKey,type:e.type}}_eventPositions(e,t){let n;if(e.touch){let r=t?`startLocation`:`location`;n=new K(e.x[r],e.y[r])}else n=new K(e.pageX,e.pageY);return this.documentToModel(n)}_gestureStart(e){this._destroyToolBar(),this.scroller.disable();let t=this.documentToModel(new K(e.center.x,e.center.y)),n={point:t,zoom:this.zoom()};this.trigger(fe,n)||(this._gesture=e,this._initialCenter=t)}_gestureChange(e){let t=this._gesture,n=this._initialCenter,r=this.documentToView(new K(e.center.x,e.center.y)),i=e.distance/t.distance,a=this._zoom,o=!1;Math.abs(i-1)>=.05&&(this._zoom=a=this._getValidZoom(a*i),this.options.zoom=a,this._gesture=e,o=!0);let s=n.times(a),c=r.minus(s);(o||this._pan.distanceTo(c)>=5)&&(this._panTransform(c),this._updateAdorners()),e.preventDefault()}_doubleTap(e){if(!this._mobileOS())return;let t=this._eventPositions(e),n=this.options,r=n.zoomRate,i=this.zoom()+r,a={point:t,meta:this._meta(e),zoom:i};this.trigger(fe,a)||(i=F(Math.max(n.zoomMin,Math.min(n.zoomMax,i)),2),a.zoom=i,this.zoom(i,a),this.trigger(pe,a))}_gestureEnd(){this.options.pannable!==!1&&this.scroller.enable(),this.trigger(pe,{point:this._initialCenter,zoom:this.zoom()})}_resize(){let e=this.viewport();this.canvas&&this.canvas.size(e),this.scrollable&&this.toolBar&&(this.scrollable.style.height=e.height+`px`)}_mouseover(e){let t=e.target._kendoNode;t&&t.srcElement._hover&&t.srcElement._hover(!0,t.srcElement)}_mouseout(e){let t=e.target._kendoNode;t&&t.srcElement._hover&&t.srcElement._hover(!1,t.srcElement)}_initTheme(e){this.options=J({},e,this.options),this.options.editable===!0?this.options.editable=(e||{}).editable:this.options.editable&&this.options.editable.resize===!0&&(this.options.editable.resize=(e.editable||{}).resize),this.options.connectionDefaults?.editable===!0?this.options.connectionDefaults.editable=e.connectionDefaults.editable:this.options.connectionDefaults?.editable?.points===!0&&(this.options.connectionDefaults.editable.points=e.connectionDefaults.editable.points)}_createOptionElements(){let e=this.options,t=e.shapes.length;t&&this._createShapes(),e.connections.length&&this._createConnections(),t&&e.layout&&this.layout(e.layout),this.undoRedoService.clear()}_createShapes(){let e=this.options.shapes,t,n;for(n=0;n<e.length;n++)t=e[n],this.addShape(t)}_createConnections(){let e=this.options,t=e.connectionDefaults,n=e.connections,r,i,a,o;for(o=0;o<n.length;o++)r=n[o],i=this._findConnectionTarget(r.from),a=this._findConnectionTarget(r.to),this.options.connect?this.options.connect(i,a,J({},t,r)):this.connect(i,a,J({},t,r))}_findConnectionTarget(e){e||={};let t=A(e)?e:e.shapeId||e.id,n;return t?(n=this.getShapeById(t),e.connector&&(n=n.getConnector(e.connector))):n=new K(e.x||0,e.y||0),n}destroy(){super.destroy(),this._destroyResizeObserver(),this._navigation?.destroy(),this._navigation=null,this._userEvents&&this._userEvents.destroy(),this.clear(),this.element.removeEventListener(`mousewheel`,this._wheelHandler),this.element.removeEventListener(`wheel`,this._wheelHandler),this.element.removeEventListener(`keydown`,this._keydownHandler),this.scrollable.removeEventListener(`mouseover`,this._mouseoverHandler),this.scrollable.removeEventListener(`mouseout`,this._mouseoutHandler),this.scrollable.removeEventListener(`mousemove`,this._mouseMoveHandler),this.scrollable.removeEventListener(`mousedown`,this._mouseDownHandler),this.scrollable.removeEventListener(`mouseup`,this._mouseUpHandler),s_.forEach(e=>{this.scrollable.removeEventListener(e,this._domEvent)}),this.canvas.destroy(!0),this.canvas=void 0,this.destroyScroller(),this._destroyGlobalToolBar(),this._destroyToolBar(),this._inactiveShapeItems.destroy()}destroyScroller(){let e=this.scroller;e&&(e.destroy(),e.element.remove(),this.scroller=null)}save(){let e={shapes:[],connections:[]},t,n,r;for(t=0;t<this.shapes.length;t++)if(r=this.shapes[t],r.options.serializable){let t=J({},r.options);r._originalWidth!==void 0&&(t.width=r._originalWidth),r._originalHeight!==void 0&&(t.height=r._originalHeight),e.shapes.push(t)}for(t=0;t<this.connections.length;t++)n=this.connections[t],e.connections.push(J({},n.options,n.toJSON()));return e}focus(){if(this.element!==this.element.ownerDocument.activeElement){let e=this.element,t=[],n=[],r=e.ownerDocument.documentElement,i=e,a;do i=i.parentNode,i.scrollHeight>i.clientHeight&&(t.push(i),n.push(i.scrollTop));while(i!==r);for(e.focus({preventScroll:!0}),a=0;a<t.length;a++)t[a].scrollTop=n[a];return!0}}load(e){this.clear(),this.setOptions(e),this._createShapes(),this._createConnections(),this.undoRedoService.clear()}setOptions(e){J(this.options,e)}clear(){this.select(!1),this.mainLayer.clear(),this._shapesQuadTree.clear(),this._initialize()}connected(e,t){for(let n=0;n<this.connections.length;n++){let r=this.connections[n];if(r.from===e&&r.to===t)return!0}return!1}addConnection(e,t){return t!==!1&&this.undoRedoService.add(new Ug(e,this),!1),e.diagram=this,e._setOptionsFromModel(),e.refresh(),this.mainLayer.append(e.visual),this.connections.push(e),this.trigger(w,{added:[e],removed:[]}),e}addShape(e,t){let n,r=this.options.shapeDefaults;if(e instanceof $)n=e,this._parseBounds(n.bounds());else if(!e.prototype)r=J({},r,e||{}),n=new $(r,this),this._parseBounds(n.bounds());else return;return t!==!1&&this.undoRedoService.add(new Wg(n,this),!1),this.shapes.push(n),n.diagram!==this&&(this._shapesQuadTree.insert(n),n.diagram=this),this.mainLayer.append(n.visual),this.trigger(w,{added:[n],removed:[]}),n}remove(e,t){e=Array.isArray(e)?e.slice(0):[e];let n=l_(e),r=n.shapes,i=n.connections,a;for(O(t)||(t=!0),t&&this.undoRedoService.begin(),this._suspendModelRefresh(),a=r.length-1;a>=0;a--)this._removeItem(r[a],t,i);for(a=i.length-1;a>=0;a--)this._removeItem(i[a],t);this._resumeModelRefresh(),t&&this.undoRedoService.commit(!1),this.trigger(w,{added:[],removed:e})}_addConnection(e,t){if(this.options._addConnection)return this.options._addConnection(e,t);if(!this.trigger(`add`,{connection:e}))return this.addConnection(e,t),e._updateConnectors(),e}_addShape(e,t){if(this.options._addShape)return this.options._addShape(e,t);if(!this.trigger(`add`,{shape:e}))return this.addShape(e,t)}_parseBounds(e){e.x=typeof e.x==`string`?parseFloat(e.x):e.x,e.y=typeof e.y==`string`?parseFloat(e.y):e.y}_shouldRefresh(){return!this._suspended}_suspendModelRefresh(){this._suspended=(this._suspended||0)+1}_resumeModelRefresh(){this._suspended=Math.max((this._suspended||0)-1,0)}_triggerRemove(e){let t=[],n,r,i;for(let a=0;a<e.length;a++)n=e[a],i=n.options.editable,r=n instanceof $?{shape:n}:{connection:n},i&&i.remove!==!1&&!this.trigger(`remove`,r)&&t.push(n);return t}_addConnections(e,t){let n=e.length;for(let r=0;r<n;r++){let n=e[r];this._addConnectionDataItem(n,t)}}_addConnectionDataItem(e,t){if(!this._connectionsDataMap[e.uid]){let n=this._validateConnector(e.from);(!O(n)||n===null)&&(n=new K(e.fromX,e.fromY));let r=this._validateConnector(e.to);if((!O(r)||r===null)&&(r=new K(e.toX,e.toY)),O(n)&&O(r)){let i=J({},this.options.connectionDefaults);i.dataItem=e;let a=new zg(n,r,i);this._connectionsDataMap[e.uid]=a,this.addConnection(a,t)}}}_validateConnector(e){let t;return O(e)&&e!==null&&(t=this._dataMap[e]),t}_addDataItems(e,t){let n,r,i,a;for(r=0;r<e.length;r++)n=e[r],i=this._addDataItemByUid(n),a=this._addDataItemByUid(t),a&&!this.connected(a,i)&&this.connect(a,i)}connect(e,t,n){let r=new zg(e,t,J({},this.options.connectionDefaults,n));return this.addConnection(r)}undo(){this.undoRedoService.undo()}redo(){this.undoRedoService.redo()}select(e,t){if(D(e)){t=J({addToSelection:!1},t);let n=t.addToSelection,r=[],i=[],a,o;for(n||this.deselect(),this._internalSelection=!0,e instanceof Array?i=e:e instanceof jm&&(i=[e]),a=0;a<i.length;a++)o=i[a],o.select(!0)&&r.push(o);this._selectionChanged(r,[]),this._internalSelection=!1}else return this._selectedItems}selectAll(){this.select(this.shapes.concat(this.connections))}selectArea(e){let t,n,r;this._internalSelection=!0;let i=[];if(e instanceof q)for(n=this.shapes.concat(this.connections),t=0;t<n.length;t++)r=n[t],(!e||r._hitTest(e))&&r.options.enable&&r.select(!0)&&i.push(r);this._selectionChanged(i,[]),this._internalSelection=!1}deselect(e){this._internalSelection=!0;let t=[],n=[],r,i;for(e instanceof Array?n=e:e instanceof jm?n.push(e):D(e)||(n=this._selectedItems.slice(0)),i=0;i<n.length;i++)r=n[i],r.select(!1)&&t.push(r);this._selectionChanged([],t),this._internalSelection=!1}toFront(e,t){e||=this._selectedItems.slice();let n=this._getDiagramItems(e),r;if(!O(t)||t){r=tm(this.mainLayer,n.visuals);let t=new Qg(this,e,r);this.undoRedoService.add(t)}else this.mainLayer.toFront(n.visuals),this._fixOrdering(n,!0)}toBack(e,t){e||=this._selectedItems.slice();let n=this._getDiagramItems(e),r;if(!O(t)||t){r=tm(this.mainLayer,n.visuals);let t=new Zg(this,e,r);this.undoRedoService.add(t)}else this.mainLayer.toBack(n.visuals),this._fixOrdering(n,!1)}bringIntoView(e,t){let n=this.viewport(),r=new Ud(n),i;if(n.width===0||n.height===0)return;t=J({animate:!1,align:`center middle`},t),t.align===`none`&&(t.align=`center middle`),e instanceof jm?i=e.bounds(ke):Array.isArray(e)?i=this.boundingBox(e):e instanceof q&&(i=e.clone());let a=i.clone();i.zoom(this._zoom),(i.width>n.width||i.height>n.height)&&(this._zoom=this._getValidZoom(Math.min(n.width/a.width,n.height/a.height)),i=a.clone().zoom(this._zoom)),this._zoomMainLayer();let o=i.clone();r.align(i,t.align);let s=i.topLeft().minus(o.topLeft());this.pan(s.times(-1),t.animate)}alignShapes(e){k(e)&&(e=`Left`);let t,n,r,i=this.select();if(i.length===0)return;switch(e.toLowerCase()){case`left`:case`top`:t=De;break;case`right`:case`bottom`:t=Oe;break;default:break}for(r=0;r<i.length;r++)if(n=i[r],n instanceof $)switch(e.toLowerCase()){case`left`:t=Math.min(t,n.options.x);break;case`top`:t=Math.min(t,n.options.y);break;case`right`:t=Math.max(t,n.options.x);break;case`bottom`:t=Math.max(t,n.options.y);break;default:break}let a=[],o=[];for(r=0;r<i.length;r++)if(n=i[r],n instanceof $)switch(o.push(n),a.push(n.bounds()),e.toLowerCase()){case`left`:case`right`:n.position(new K(t,n.options.y));break;case`top`:case`bottom`:n.position(new K(n.options.x,t));break;default:break}let s=new dh(o,a);this.undoRedoService.add(s,!1)}zoom(e,t){if(e){let n=t?t.point:new K(0,0);if(e=this._zoom=this._getValidZoom(e),!k(n)){n=new K(Math.round(n.x),Math.round(n.y));let t=n.times(e),r=this.modelToView(n).minus(t);this._storePan(new K(Math.round(r.x),Math.round(r.y)))}t&&(t.zoom=e),this._panTransform(),this.canvas.surface.hideTooltip&&this.canvas.surface.hideTooltip(),this._updateAdorners()}return this._zoom}_getPan(e){return this.canvas.translate||(e=e.plus(this._pan)),e}pan(e,t){if(e instanceof K){let n=this.scroller;e=this._getPan(e),e=e.times(-1),t?n.animatedScrollTo(e.x,e.y,()=>{this._updateAdorners()}):(n.scrollTo(e.x,e.y),this._updateAdorners())}else return this._pan.times(-1)}viewport(){let e=this.element,t=f_(e),n=p_(e);return this.toolBar&&(n-=d_(this.toolBar.element)),new q(0,0,t,n)}copy(){if(this.options.copy.enabled){this._clipboard.length=0,this._copyOffset=1;for(let e=0;e<this._selectedItems.length;e++){let t=this._selectedItems[e];this._clipboard.push(t)}}}cut(){if(this.options.copy.enabled){this._clipboard.length=0,this._copyOffset=0;for(let e=0;e<this._selectedItems.length;e++){let t=this._selectedItems[e];this._clipboard.push(t)}this.remove(this._clipboard,!0)}}paste(){if(this._clipboard.length>0){let e,t,n,r={},i=l_(this._clipboard),a=i.connections,o=i.shapes,s={x:this._copyOffset*this.options.copy.offsetX,y:this._copyOffset*this.options.copy.offsetY};for(this.deselect(),n=0;n<o.length;n++)e=o[n],t=e.clone(),r[e.id]=t,t.position(new K(e.options.x+s.x,e.options.y+s.y)),t.diagram=this,t=this._addShape(t),t&&t.select();for(n=0;n<a.length;n++)e=a[n],t=this._addConnection(e.clone()),t&&(this._updateCopiedConnection(t,e,`source`,r,s),this._updateCopiedConnection(t,e,`target`,r,s),t.select(!0),t.updateModel());this._syncChanges(),this._copyOffset+=1}}_syncChanges(){this.options._syncChanges&&this.options._syncChanges()}_syncConnectionChanges(){this.options._syncConnectionChanges&&this.options._syncConnectionChanges()}_syncShapeChanges(){this.options._syncShapeChanges&&this.options._syncShapeChanges()}_updateCopiedConnection(e,t,n,r,i){let a,o,s,c=t[n]();c instanceof dm&&r[c.shape.id]?(s=r[c.shape.id],this.getShapeById(s.id)?e[n](s.getConnector(c.options.name)):(o=this._inactiveShapeItems.getByUid(s.dataItem.uid),o&&(a=t=>{s=this._dataMap[t.id],e[n](s.getConnector(c.options.name)),e.updateModel()},this._deferredConnectionUpdates.push(o.onActivate(a))))):e[n](new K(t[n+`Point`]().x+i.x,t[n+`Point`]().y+i.y))}boundingBox(e,t){let n=q.empty(),r,i=D(e)?this._getDiagramItems(e):{shapes:this.shapes};if(i.shapes.length>0){let e=i.shapes[0];n=e.bounds(ge);for(let a=1;a<i.shapes.length;a++)e=i.shapes[a],r=e.bounds(ge),t===!0&&(r.x-=e._rotationOffset.x,r.y-=e._rotationOffset.y),n=n.union(r)}return n}_containerOffset(){let e=u_(this.element);return this.toolBar&&(e.top+=d_(this.toolBar.element)),e}documentToView(e){let t=this._containerOffset();return new K(e.x-t.left,e.y-t.top)}viewToDocument(e){let t=this._containerOffset();return new K(e.x+t.left,e.y+t.top)}viewToModel(e){return this._transformWithMatrix(e,this._matrixInvert)}modelToView(e){return this._transformWithMatrix(e,this._matrix)}modelToLayer(e){return this._transformWithMatrix(e,this._layerMatrix)}layerToModel(e){return this._transformWithMatrix(e,this._layerMatrixInvert)}documentToModel(e){let t=this.documentToView(e);return this.canvas.translate||(t.x+=this.scroller.scrollLeft,t.y+=this.scroller.scrollTop),this.viewToModel(t)}modelToDocument(e){return this.viewToDocument(this.modelToView(e))}_transformWithMatrix(e,t){let n=e;if(e instanceof K)t&&(n=t.apply(e));else{let r=this._transformWithMatrix(e.topLeft(),t),i=this._transformWithMatrix(e.bottomRight(),t);n=q.fromPoints(r,i)}return n}layout(e){this._layouting=!0;let t;k(e)&&(e=this.options.layout),t=k(e)||k(e.type)?`Tree`:e.type;let n;switch(t.toLowerCase()){case`tree`:n=new Yp(this);break;case`layered`:n=new qp(this);break;case`forcedirected`:case`force`:case`spring`:case`springembedder`:n=new $d(this);break;default:throw Error(`Layout algorithm '`+t+`' is not supported.`)}let r=new Xd(this),i=n.layout(e);if(i){let t=new Yg(r,i,e?e.animate:null);this.undoRedoService.add(t)}this._layouting=!1,this._redrawConnections()}getShapeById(e){let t;return t=ht(this.shapes,function(t){return t.visual.id===e}),t||(t=ht(this.connections,function(t){return t.visual.id===e}),t)}getShapeByModelId(e){let t;return t=this._isEditable?this._dataMap[e]:ht(this.shapes,function(t){return(t.dataItem||{}).id===e}),t}getShapeByModelUid(e){let t;return t=this._isEditable?ht(this.shapes,function(t){return(t.dataItem||{}).uid===e}):this._dataMap[e],t}_extendLayoutOptions(e){e.layout&&=J({},Jd,e.layout)}_selectionChanged(e,t){(e.length||t.length)&&this.trigger(Te,{selected:e,deselected:t})}_getValidZoom(e){return Math.min(Math.max(e,this.options.zoomMin),this.options.zoomMax)}_panTransform(e){let t=e||this._pan;this.canvas.translate?(this.scroller.scrollTo(t.x,t.y),this._zoomMainLayer()):(this._storePan(t),this._transformMainLayer())}_finishPan(){this.trigger(`pan`,{total:this._pan,delta:NaN})}_storePan(e){this._pan=e,this._storeViewMatrix()}_zoomMainLayer(){let e=this._zoom,t=new mf(0,0,e,e);t.render(this.mainLayer),this._storeLayerMatrix(t),this._storeViewMatrix()}_transformMainLayer(){let e=this._pan,t=this._zoom,n=new mf(e.x,e.y,t,t);n.render(this.mainLayer),this._storeLayerMatrix(n),this._storeViewMatrix()}_storeLayerMatrix(e){this._layerMatrix=e.toMatrix(),this._layerMatrixInvert=e.invert().toMatrix()}_storeViewMatrix(){let e=this._pan,t=this._zoom,n=new mf(e.x,e.y,t,t);this._matrix=n.toMatrix(),this._matrixInvert=n.invert().toMatrix()}_toIndex(e,t){let n=this._getDiagramItems(e);this.mainLayer.toIndex(n.visuals,t),this._fixOrdering(n,!1)}_fixOrdering(e,t){let n=t?this.shapes.length-1:0,r=t?this.connections.length-1:0,i,a;for(i=0;i<e.shapes.length;i++)a=e.shapes[i],M(this.shapes,a),gt(this.shapes,a,n);for(i=0;i<e.cons.length;i++)a=e.cons[i],M(this.connections,a),gt(this.connections,a,r)}_getDiagramItems(e){let t,n=e,r={};for(r.visuals=[],r.shapes=[],r.cons=[],e?Array.isArray(e)||(n=[e]):n=this._selectedItems.slice(),t=0;t<n.length;t++){let e=n[t];e instanceof $?(r.shapes.push(e),r.visuals.push(e.visual)):e instanceof zg&&(r.cons.push(e),r.visuals.push(e.visual))}return r}_addDataItemByUid(e){if(!O(e))return;let t=this._dataMap[e.uid];if(t)return t;let n=J({},this.options.shapeDefaults);return n.dataItem=e,t=new $(n,this),this.addShape(t),this._dataMap[e.uid]=t,t}_addItem(e){e instanceof $?this.addShape(e):e instanceof zg&&this.addConnection(e)}_toolBarClick(e){this.trigger(`toolBarClick`,e),this._destroyToolBar()}_normalizePointZoom(e){return e.times(1/this.zoom())}_initialize(){this.shapes.length=0,this.connections.length=0,this._selectedItems.length=0,Object.keys(this._dataMap).forEach(e=>{delete this._dataMap[e]}),Object.keys(this._connectionsDataMap).forEach(e=>{delete this._connectionsDataMap[e]}),this._deferredConnectionUpdates.length=0,this.undoRedoService=new $g({undone:this._syncChanges.bind(this),redone:this._syncChanges.bind(this)}),this.undoRedoService.bind(`undo`,e=>{this.trigger(`undo`,e)}),this.undoRedoService.bind(`redo`,e=>{this.trigger(`redo`,e)}),this.id=jt()}_redrawConnections(){let e=this.connections;for(let t=0;t<e.length;t++)e[t].refresh()}_adorn(e,t){t!==void 0&&e&&(t?(this._adorners.push(e),this.adornerLayer.append(e.visual)):(M(this._adorners,e),this.adornerLayer.remove(e.visual)))}_showConnectors(e,t){t?this._connectorsAdorner.show(e):this._connectorsAdorner.destroy()}_updateAdorners(){let e=this._adorners;for(let t=0;t<e.length;t++){let n=e[t];n.refreshBounds&&n.refreshBounds(),n.refresh()}}_refresh(){for(let e=0;e<this.connections.length;e++)this.connections[e].refresh()}_removeItem(e,t,n){e.select(!1),e instanceof $?(this._removeShapeDataItem(e),this._removeShape(e,t,n)):e instanceof zg&&(this._removeConnectionDataItem(e),this._removeConnection(e,t)),this.mainLayer.remove(e.visual)}_removeConnectionDataItem(e){this._isEditable&&(this.options._removeConnectionDataItem(e.dataItem),delete this._connectionsDataMap[e.dataItem.uid])}_removeShapeDataItem(e){this._isEditable&&(this.options._removeShapeDataItem(e.dataItem),delete this._dataMap[e.dataItem.id])}_removeShape(e,t,n){let r,i,a,o=[],s=[];for(this.toolService._removeHover(),t&&this.undoRedoService.addCompositeItem(new qg(e)),M(this.shapes,e),this._shapesQuadTree.remove(e),r=0;r<e.connectors.length;r++){a=e.connectors[r];for(let e=0;e<a.connections.length;e++)i=a.connections[e],(!n||!N(n,i))&&(i.sourceConnector===a?o.push(i):i.targetConnector===a&&s.push(i))}for(r=0;r<o.length;r++)o[r].source(null,t),o[r].updateModel();for(r=0;r<s.length;r++)s[r].target(null,t),s[r].updateModel()}_removeConnection(e,t){e.sourceConnector&&M(e.sourceConnector.connections,e),e.targetConnector&&M(e.targetConnector.connections,e),t&&this.undoRedoService.addCompositeItem(new Kg(e)),M(this.connections,e)}_removeShapeConnections(e){let t=e.connections(),n;if(t)for(n=0;n<t.length;n++)this._removeItem(t[n],!1)}_destroyToolBar(){this.options.destroyToolBar()}_destroyGlobalToolBar(){this.toolBar&&=null}_mobileOS(){return Dr}exportDOMVisual(){let e=this.canvas._viewBox,t=Wr().translate(-e.x,-e.y),n=new L([0,0],[e.width,e.height]),r=R.fromRect(n),i=new z({transform:t}),a=new z({clip:r}),o=this.canvas.drawingElement.children[0];return a.append(i),i.children.push(o),a}exportVisual(){let e=1/this._zoom,t=new z({transform:Wr().scale(e,e)}),n=this.mainLayer.drawingElement;return t.children.push(n),t}updateConnectionModel(e,t){if(this.options.updateConnectionModel)return this.options.updateConnectionModel(e,t)}updateShapeModel(e,t){if(this.options.updateShapeModel)return this.options.updateShapeModel(e,t)}};let __=e=>e.ownerDocument.defaultView.getComputedStyle(e),v_={},y_=(e,t)=>{if(v_[e])return v_[e];let n=t.style.color;t.style.color=e;let r=__(t).color;return t.style.color=n,v_[e]=r,r},b_=(e,t)=>{let n=__(e).getPropertyValue(t);return/^color-mix/i.test(n)&&(n=y_(n,e)),n},x_=e=>{let t=b_(e,`--kendo-chart-primary-bg`),n=b_(e,`--kendo-chart-primary-contrast`),r=b_(e,`--kendo-chart-text`),i=b_(e,`--kendo-color-surface`),a=`#0B99FF`;return{shapeDefaults:{fill:{color:t},content:{color:n},connectorDefaults:{fill:{color:a},stroke:{color:n},hover:{fill:{color:a},stroke:{color:a}}}},editable:{resize:{handles:{width:10,height:10,stroke:{color:a},fill:{color:i},hover:{stroke:{color:a},fill:{color:a}}}}},selectable:{stroke:{color:a}},connectionDefaults:{stroke:{color:r},content:{color:r,bgColor:n},selection:{handles:{fill:{color:n},stroke:{color:r},width:8,height:8},stroke:{color:r}},editable:{points:{midpoint:{fill:{color:a},stroke:{color:n,width:1},radius:4},vertex:{fill:{color:n},stroke:{color:a,width:2},radius:3}}}}}};function S_(e,t,n,r){return{x:t.left+e.x*n-r.x,y:t.top+e.y*n-r.y}}function C_(e,t,n,r){let i=S_({x:e.x,y:e.y},t,n,r);return new q(i.x,i.y,e.width*n,e.height*n)}function w_(e,t){let n={point:e[0],segIdx:0,t:0,dist2:1/0};for(let r=0;r<e.length-1;r++){let i=e[r],a=e[r+1],o={x:a.x-i.x,y:a.y-i.y},s={x:t.x-i.x,y:t.y-i.y},c=o.x*o.x+o.y*o.y||1e-9,l=Math.max(0,Math.min(1,(s.x*o.x+s.y*o.y)/c)),u={x:i.x+o.x*l,y:i.y+o.y*l},d=t.x-u.x,f=t.y-u.y,p=d*d+f*f;p<n.dist2&&(n={point:u,segIdx:r,t:l,dist2:p})}return n}function T_(e,t,n,r){switch(e){case`right`:return new q(t.x+10,t.y-r/2,n,r);case`left`:return new q(t.x-10-n,t.y-r/2,n,r);case`bottom`:return new q(t.x-n/2,t.y+10,n,r);case`top`:return new q(t.x-n/2,t.y-10-r,n,r)}}function E_(e,t){let n=Math.max(0,t.left-e.x+8),r=Math.max(0,t.top-e.y+8),i=Math.max(0,e.x+e.width-(t.right-8)),a=Math.max(0,e.y+e.height-(t.bottom-8));return n+r+i+a}function D_(e,t,n){let r=Math.min(e.x,t.x),i=Math.max(e.x,t.x),a=Math.min(e.y,t.y),o=Math.max(e.y,t.y);return new q(r-n/2,a-n/2,i-r+n,o-a+n)}let O_=[`right`,`left`,`bottom`,`top`];function k_(e){let{hovered:t,shapes:n,connections:r,diagramRect:i,zoom:a,pan:o,tooltipSize:s,viewportBounds:c,mouse:l}=e,u=c,d,f;if(t.name===Ve){let e=C_(t.bounds(),i,a,o);f={right:{x:e.x+e.width,y:e.y+e.height/2},left:{x:e.x,y:e.y+e.height/2},bottom:{x:e.x+e.width/2,y:e.y+e.height},top:{x:e.x+e.width/2,y:e.y}}}else d=S_(w_(t.allPoints(),l).point,i,a,o);let p=n.map(e=>C_(e,i,a,o)),m=[];for(let e of r)for(let t=0;t<e.length-1;t++){let n=S_(e[t],i,a,o),r=S_(e[t+1],i,a,o);m.push(D_(n,r,10))}let h=[];for(let e of O_){let n=T_(e,t.name===Ve?f[e]:d,s.width,s.height),r=E_(n,u),i=0;for(let e of p)if(n.overlaps(e)){i++;break}for(let e of m)if(n.overlaps(e)){i++;break}h.push({pos:e,rect:n,ov:r,hits:i})}h.sort((e,t)=>e.ov-t.ov||e.hits-t.hits||O_.indexOf(e.pos)-O_.indexOf(t.pos));let g=h[0],_=g.ov===0?g.rect:A_(g.rect,u);return{left:_.x,top:_.y,position:g.pos}}function A_(e,t){let n=e.x,r=e.y;return n<t.left+8&&(n=t.left+8),r<t.top+8&&(r=t.top+8),n+e.width>t.right-8&&(n=t.right-8-e.width),r+e.height>t.bottom-8&&(r=t.bottom-8-e.height),new q(n,r,e.width,e.height)}(function(){var e=window.kendo,t=e.dataviz.diagram={};e.deepExtend(t,{init:function(n){e.init(n,t.ui)},Utils:Dt,Range:Ot,Ticker:At})})(),(function(){var e=window.kendo,t=e.dataviz.diagram;e.deepExtend(t,{init:function(n){e.init(n,t.ui)},Point:K,Intersect:nf,Geometry:Nt,Rect:q,Size:uf,RectAlign:Ud,Matrix:of,MatrixVector:af,normalVariable:sf,randomId:jt,Dictionary:P,HashTable:Mt,Queue:Wd,Set:lf,Node:Zd,Link:Qd,Graph:Y,PathDefiner:cf})})();let{isFunction:j_}=Dt;(function(){var e=window.kendo,t=e.drawing,n=e.dataviz.diagram;class r extends Pf{constructor(e,n){n||={},super(e,n),this.surface=t.Surface.create(e,n),this.translate=j_(this.surface.translate)?this._translate:void 0,this._viewBox=new q(0,0,n.width,n.height),this.size(this._viewBox)}}e.deepExtend(n,{init:function(t){e.init(t,n.ui)},diffNumericOptions:hf,Markers:S,Element:gf,Scale:ff,Translation:pf,Rotation:df,Circle:If,Group:lp,Rectangle:Z,Canvas:r,Path:Cp,Layout:pp,Line:mp,MarkerBase:jf,ArrowMarker:Nf,CircleMarker:Rf,Polyline:wp,CompositeTransform:mf,TextBlock:zp,Terminator:sp,Process:Np,Decision:Yf,PredefinedProcess:Ap,Document:ap,ManualInputOutput:gp,Preparation:Mp,ManualOperation:vp,InternalStorage:fp,Display:tp,DirectAccessStorage:$f,Database:Kf,OnPageConnector:Hf,OffPageConnector:Sp,DataInputOutput:Wf,SummingJunction:Ip,LogicalOr:bp,Merge:yp,Extract:cp,DataStorage:Jf,Delay:Zf,Sort:Fp,Collate:Vf,MultipleDocuments:op,Image:up,VisualBase:kf})})(),(function(){var e=window.kendo,t=e.dataviz.diagram;t.Cursors=T,e.deepExtend(t,{CompositeUnit:Gg,TransformUnit:dh,PanUndoUnit:Xg,AddShapeUnit:Wg,AddConnectionUnit:Ug,DeleteShapeUnit:qg,DeleteConnectionUnit:Kg,ConnectionEditAdorner:Nm,ConnectionTool:wh,ConnectorVisual:ch,UndoRedoService:$g,ResizingAdorner:mh,Selector:gh,ToolService:Hg,ConnectorsAdorner:lh,LayoutUndoUnit:Yg,ConnectionEditUnit:Ig,ToFrontUnit:Qg,ToBackUnit:Zg,ConnectionRouterBase:_h,PolylineRouter:Sh,CascadingRouter:xh,SelectionTool:Ng,ScrollerTool:Mg,PointerTool:Dh,ConnectionEditTool:Ch,RotateUnit:lm})})(),(function(){var e=window.kendo,t=e.dataviz.diagram;e.deepExtend(t,{init:function(n){e.init(n,t.ui)},SpringLayout:$d,TreeLayout:Yp,GraphAdapter:ef,LayeredLayout:qp,LayoutBase:Yd,LayoutState:Xd})})(),(function(){let e=window.kendo.dataviz;e.diagramTheme=x_})(),(function(e,t){var n=kendo.dataviz,r=n.diagram,i=kendo.ui.Widget,a=kendo.deepExtend,o=kendo._outerWidth,s=kendo._outerHeight,c=e.extend,l=kendo.data.HierarchicalDataSource,u=r.Canvas;r.Rect;var d=r.Point,f=kendo.drawing.util.defined,p=e.isPlainObject,m=kendo.data.DataSource;hm.register({compile:function(e){return kendo.template(e,{paramName:`dataItem`})}});var h=`.kendoDiagram`,g=`click`,_=`rotated`,v=`change`,y=`error`,b=({className:e,icon:t,themeColor:n,text:r})=>kendo.html.renderButton(`<button class="${e}" href="#">${r}</button>`,{icon:t,themeColor:n});function x(e){e.preventDefault()}function S(e,t){f(t[e])&&t.set(e,null)}let C=e=>`<div class="k-popup">${e}</div>`,ee=e=>Math.round(e)+`px`;r.DefaultConnectors=fm;var te={cancel:{text:`Cancel`,icon:`cancel-outline`,className:`k-diagram-cancel`},update:{text:`Save`,imageClass:`save`,className:`k-diagram-update`,icon:`save`,themeColor:`primary`}};r.shapeDefaults=pm;var w=i.extend({init:function(n,r={}){var a=this;kendo.destroy(n),i.fn.init.call(a,n,r);let o=a._initTheme(),s=f(r.connectionsDataSource);this._isEditable=s;let c=new g_(n,{...a.options,_syncChanges:a._syncChanges.bind(a),_syncShapeChanges:a._syncShapeChanges.bind(a),_syncConnectionChanges:a._syncConnectionChanges.bind(a),_removeConnectionDataItem:a._removeConnectionDataItem.bind(a),_removeShapeDataItem:a._removeShapeDataItem.bind(a),_addConnection:a._addConnection.bind(a),_addShape:a._addShape.bind(a),updateConnectionModel:a.updateConnectionModel.bind(a),updateShapeModel:a.updateShapeModel.bind(a),cloneDataItem:ie,connect:s?a.connect.bind(a):t,createToolBar:a._createToolBar.bind(a),destroyToolBar:a._destroyToolBar.bind(a),Canvas:u,shapeDefaults:{...r.shapeDefaults},navigation:{...r.navigatable},connectionDefaults:{...r.connectionDefaults}},o);a.events.forEach(function(e){c.bind(e,function(t){if(e===`tooltipShow`){a._clearTooltips();let e=a.options.tooltip||{};t.item.name===`Shape`&&e.shapeTemplate?a._createTooltip(t.item,t.point,e.shapeTemplate,!0):t.item.name===`Connection`&&e.connectionTemplate&&a._createTooltip(t.item,t.point,e.connectionTemplate,!1)}e===`tooltipHide`&&a._clearTooltips(),t.sender=a,a.trigger(e,t)})}),a.widget=c,a.wrapper=e(c.wrapper),a.scrollable=e(c.scrollable),a.shapes=c.shapes,a.connections=c.connections,a._connectionsDataMap=c._connectionsDataMap,a._dataMap=c._dataMap,a._inactiveShapeItems=c._inactiveShapeItems,a._copyOffset=0,a._selectedItems=c._selectedItems,a.options=c.options,a._clipboard=c._clipboard,a.id=c.id,a.undoRedoService=c.undoRedoService,a.toolService=c.toolService,a._resizingAdorner=c._resizingAdorner,a._connectorsAdorner=c._connectorsAdorner,a.selector=c.selector,a.mainLayer=c.mainLayer,a._fetchFreshData(),a._createGlobalToolBar(),a.widget._createOptionElements(),a.widget.zoom(a.options.zoom),a.widget.canvas.draw()},options:a({},o_),events:[...c_],shapes:[],connections:[],dataSource:null,connectionsDataSource:null,connect:function(e,t,n){let r;if(this.connectionsDataSource&&this._isEditable){let i=this.connectionsDataSource.add({});r=this.widget._connectionsDataMap[i.uid],r.source(e),r.target(t),r.redraw(n),r.updateModel()}else r=this.widget.connect(e,t,n);return r},connected:function(e,t){return this.widget.connected(e,t)},addConnection:function(e,t){return this.widget.addConnection(e,t)},addShape:function(e,t){return this.widget.addShape(e,t)},remove:function(e,t){return this.widget.remove(e,t)},undo:function(){return this.widget.undo()},redo:function(){return this.widget.redo()},select:function(e,t){return this.widget.select(e,t)},deselect:function(e){this.widget.deselect(e)},toFront:function(e,t){return this.widget.toFront(e,t)},toBack:function(e,t){return this.widget.toBack(e,t)},bringIntoView:function(e,t){return this.widget.bringIntoView(e,t)},boundingBox:function(e,t){return this.widget.boundingBox(e,t)},layout:function(e){return this.widget.layout(e)},getShapeById:function(e){return this.widget.getShapeById(e)},getConnectionByModelId(e){let t;return this.connectionsDataSource&&(t=ht(this.connections,function(t){return(t.dataItem||{}).id===e})),t},getConnectionByModelUid(e){let t;return this.connectionsDataSource&&(t=this.widget._connectionsDataMap[e]),t},copy:function(){this.widget.copy()},cut:function(){this.widget.cut()},alignShapes:function(e){return this.widget.alignShapes(e)},createShape:function(){if(this.editor&&this.editor.end()||!this.editor){var e=this.dataSource,t=(e.view()||[]).length,n=ae(e,{}),r=this.widget._createShape(n,{});if(!this.trigger(`add`,{shape:r})){e.insert(t,n);var i=this.widget._inactiveShapeItems.getByUid(n.uid);i.element=r,this.edit(r)}}},createConnection:function(){if(this.editor&&this.editor.end()||!this.editor){var e=this.connectionsDataSource,t=(e.view()||[]).length,n=ae(e,{}),r=this.widget._createConnection(n);this.trigger(`add`,{connection:r})||(this.widget._connectionsDataMap[n.uid]=r,e.insert(t,n),this.addConnection(r,!1),this.edit(r))}},exportVisual:function(){return this.widget.exportVisual()},exportDOMVisual:function(){return this.widget.exportDOMVisual()},_syncChanges(){this._syncShapeChanges(),this._syncConnectionChanges()},_syncShapeChanges(){this.dataSource&&this._isEditable&&this.dataSource.sync()},_syncConnectionChanges(){this.connectionsDataSource&&this._isEditable&&Promise.all(this.widget._deferredConnectionUpdates).then(()=>{this.connectionsDataSource.sync(),this.widget._deferredConnectionUpdates.length=0})},editModel:function(e,t){this.cancelEdit();var n,r,i=this.widget.options.editable;if(t==`shape`)n=i.shapeEditors,r=i.shapeTemplate;else if(t==`connection`){var o=re.bind(this);n=a({},{from:o,to:o},i.connectionEditors),r=i.connectionTemplate}else return;this.editor=new ne(this.element,{update:this._update.bind(this),cancel:this._cancel.bind(this),model:e,type:t,target:this,editors:n,template:r}),this.trigger(`edit`,this._editArgs())},edit:function(e){if(e.dataItem){var t=e instanceof $?`shape`:`connection`;this.editModel(e.dataItem,t)}},cancelEdit:function(){this.editor&&(this._getEditDataSource().cancelChanges(this.editor.model),this._destroyEditor())},clear(){this.widget.clear()},saveEdit:function(){this.editor&&this.editor.end()&&!this.trigger(`save`,this._editArgs())&&this._getEditDataSource().sync()},updateConnectionModel:function(e,t){if(this.connectionsDataSource){let n=this.connectionsDataSource.getByUid(e.dataItem.uid);n&&(this._suspendModelRefresh(),f(e.options.fromX)&&e.options.fromX!==null?(S(`from`,n),S(`fromConnector`,n),n.set(`fromX`,e.options.fromX),n.set(`fromY`,e.options.fromY)):(n.set(`from`,e.options.from),f(n.fromConnector)&&n.set(`fromConnector`,e.sourceConnector?e.sourceConnector.options.name:null),S(`fromX`,n),S(`fromY`,n)),f(e.options.toX)&&e.options.toX!==null?(S(`to`,n),S(`toConnector`,n),n.set(`toX`,e.options.toX),n.set(`toY`,e.options.toY)):(n.set(`to`,e.options.to),f(n.toConnector)&&n.set(`toConnector`,e.targetConnector?e.targetConnector.options.name:null),S(`toX`,n),S(`toY`,n)),f(e.options.type)&&f(n.type)&&n.set(`type`,e.options.type),e.dataItem=n,this._resumeModelRefresh(),t&&this._syncConnectionChanges())}},updateShapeModel:function(e,t){let n=e._bounds,r=e.dataItem;r&&(this._suspendModelRefresh(),f(r.x)&&n.x!==r.x&&r.set(`x`,n.x),f(r.y)&&n.y!==r.y&&r.set(`y`,n.y),f(r.width)&&n.width!==r.width&&r.set(`width`,n.width),f(r.height)&&n.height!==r.height&&r.set(`height`,n.height),e.dataItem=r,this._resumeModelRefresh(),t&&this._syncShapeChanges())},destroy:function(){this.diagram=null,this.element=null,this.options=null,this._toolBar&&this._toolBar.destroy(),this._popup&&this._popup.destroy(),this._destroyGlobalToolBar(),this._destroyToolBar(),this.widget&&=(this.widget.destroy(),null)},documentToModel:function(e){return this.widget.documentToModel(e)},documentToView:function(e){return this.widget.documentToView(e)},focus:function(){return this.widget.focus()},getShapeByModelId:function(e){return this.widget.getShapeByModelId(e)},getShapeByModelUid:function(e){return this.widget.getShapeByModelUid(e)},layerToModel:function(e){return this.widget.layerToModel(e)},load:function(e){this.widget.load(e)},modelToDocument:function(e){return this.widget.modelToDocument(e)},modelToLayer:function(e){return this.widget.modelToLayer(e)},modelToView:function(e){return this.widget.modelToView(e)},pan:function(e,t){return this.widget.pan(e,t)},paste:function(){this.widget.paste()},save:function(){return this.widget.save()},selectAll:function(){this.widget.selectAll()},selectArea:function(e){this.widget.selectArea(e)},setDataSource(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind!==!1&&this.dataSource.fetch()},setConnectionsDataSource(e){this.options.connectionsDataSource=e,this._connectionDataSource(),this.options.autoBind!==!1&&this.connectionsDataSource.fetch()},viewToDocument:function(e){return this.widget.viewToDocument(e)},viewToModel:function(e){return this.widget.viewToModel(e)},viewport:function(){return this.widget.viewport()},zoom:function(e,t){return this.widget.zoom(e,t)},_initTheme:function(){var e=this,t=((e.options||{}).theme||``).toLowerCase(),r=n.ui.themes||{},i;return n.SASS_THEMES.indexOf(t)==-1?i=(r[t]||{}).diagram:(e.element.addClass(`k-diagram`),i=n.diagramTheme(e.element[0]),e.element.removeClass(`k-diagram`)),i},items:function(){return e()},_createGlobalToolBar:function(){this.widget;var e=this.widget.options.editable;if(e){var t=e.tools;this._isEditable&&t!==!1&&(!t||t.length===0)&&(t=[`createShape`,`undo`,`redo`,`rotateClockwise`,`rotateAnticlockwise`]),t&&t.length&&(this.toolBar=new T(this,{tools:t||{},click:this._toolBarClick.bind(this),modal:!1}),this.widget.toolBar={element:this.toolBar.element[0]},this.toolBar.element.css({textAlign:`left`}),this.element.prepend(this.toolBar.element),this.widget._resize())}},_toolBarClick:function(e){this.trigger(`toolBarClick`,e),this._destroyToolBar()},_createToolBar:function(e){let t=this,n=this.widget;if(!this.singleToolBar&&t.select().length===1){var r=t.select()[0];if(r&&r.options.editable!==!1){var i=r.options.editable||{},a=i.tools;if(this._isEditable&&a&&a.length===0&&(r instanceof $?a=[`edit`,`rotateClockwise`,`rotateAnticlockwise`]:r instanceof zg&&(a=[`edit`]),i&&i.remove!==!1&&a.push(`delete`)),a&&a.length){var c=20,l;this.singleToolBar=new T(this,{tools:a,click:this._toolBarClick.bind(this),modal:!0,popupZIndex:parseInt(t.element.closest(`.k-window`).css(`zIndex`),10)+10});var u=o(this.singleToolBar._popup.element),f=s(this.singleToolBar._popup.element);if(r instanceof $){var p=n.modelToView(r.bounds(_));l=new d(p.x,p.y).minus(new d((u-p.width)/2,f+c))}else if(r instanceof zg){var m=n.modelToView(r.bounds());l=new d(m.x,m.y).minus(new d((u-m.width-20)/2,f+c))}l?(n.canvas.translate||(l=l.minus(new d(n.scroller.scrollLeft,n.scroller.scrollTop))),l=this.viewToDocument(l),l=new d(Math.max(l.x,0),Math.max(l.y,0)),this.singleToolBar.showAt(l),e&&this.singleToolBar._popup.one(`close`,x)):this._destroyToolBar()}}}},_destroyToolBar:function(){this.singleToolBar&&=(this.singleToolBar.hide(),this.singleToolBar.destroy(),null)},_destroyGlobalToolBar:function(){this.toolBar&&=(this.toolBar.hide(),this.toolBar.destroy(),null)},_update:function(){this.editor&&this.editor.end()&&!this.trigger(`save`,this._editArgs())&&(this._getEditDataSource().sync(),this._destroyEditor())},_cancel:function(){if(this.editor&&!this.trigger(`cancel`,this._editArgs())){var e=this.editor.model;this._getEditDataSource().cancelChanges(e);var t=this.widget._connectionsDataMap[e.uid]||this.widget._dataMap[e.id];t&&t._setOptionsFromModel(e),this._destroyEditor()}},_getEditDataSource:function(){return this.editor.options.type===`shape`?this.dataSource:this.connectionsDataSource},_editArgs:function(){var e={container:this.editor.wrapper};return e[this.editor.options.type]=this.editor.model,e},_fetchFreshData(){this._dataSource(),this._isEditable&&this._connectionDataSource(),this.options.autoBind!==!1&&(this._isEditable?(this._loadingShapes=!0,this._loadingConnections=!0,this.dataSource.fetch(),this.connectionsDataSource.fetch()):this.dataSource.fetch())},_dataSource(){if(f(this.options.connectionsDataSource)){this.widget._isEditable=!0;let e=this.options.dataSource||{},t=Array.isArray(e)?{data:e}:e;this.dataSource&&this._shapesRefreshHandler?this.dataSource.unbind(`change`,this._shapesRefreshHandler).unbind(`requestStart`,this._shapesRequestStartHandler).unbind(`error`,this._shapesErrorHandler):(this._shapesRefreshHandler=this._refreshShapes.bind(this),this._shapesRequestStartHandler=this._shapesRequestStart.bind(this),this._shapesErrorHandler=this._error.bind(this)),this.dataSource=m.create(t).bind(`change`,this._shapesRefreshHandler).bind(`requestStart`,this._shapesRequestStartHandler).bind(`error`,this._shapesErrorHandler)}else this._treeDataSource(),this.widget._isEditable=!1},_connectionDataSource(){let e=this.options.connectionsDataSource;if(e){let t=Array.isArray(e)?{data:e}:e;this.connectionsDataSource&&this._connectionsRefreshHandler?this.connectionsDataSource.unbind(`change`,this._connectionsRefreshHandler).unbind(`requestStart`,this._connectionsRequestStartHandler).unbind(`error`,this._connectionsErrorHandler):(this._connectionsRefreshHandler=this._refreshConnections.bind(this),this._connectionsRequestStartHandler=this._connectionsRequestStart.bind(this),this._connectionsErrorHandler=this._connectionsError.bind(this)),this.connectionsDataSource=m.create(t).bind(`change`,this._connectionsRefreshHandler).bind(`requestStart`,this._connectionsRequestStartHandler).bind(`error`,this._connectionsErrorHandler)}},_shapesRequestStart(e){e.type===`read`&&(this._loadingShapes=!0)},_connectionsRequestStart(e){e.type===`read`&&(this._loadingConnections=!0)},_error(){this._loadingShapes=!1},_connectionsError(){this._loadingConnections=!1},_refreshShapes(e){e.action===`remove`?this._shouldRefresh()&&this._removeShapes(e.items):e.action===`itemchange`?this._shouldRefresh()&&this._updateShapes(e.items,e.field):e.action===`add`?this._inactiveShapeItems.add(e.items):e.action===`sync`?this._syncShapes():this.refresh()},_shouldRefresh(){return this.widget._shouldRefresh()},_suspendModelRefresh(){this.widget._suspendModelRefresh()},_resumeModelRefresh(){this.widget._resumeModelRefresh()},refresh(){this._loadingShapes=!1,this._loadingConnections||this._rebindShapesAndConnections()},_rebindShapesAndConnections(){this.clear(),this._addShapes(this.dataSource.view()),this.connectionsDataSource&&this._addConnections(this.connectionsDataSource.view(),!1),this.options.layout?this.layout(this.options.layout):this._redrawConnections(),this.trigger(`dataBound`)},refreshConnections(){this._loadingConnections=!1,this._loadingShapes||this._rebindShapesAndConnections()},_redrawConnections(){this.widget._redrawConnections()},_removeShapes(e){let t=this.widget._dataMap,n,r;for(r=0;r<e.length;r++)n=e[r],t[n.id]&&(this.remove(t[n.id],!1),t[n.id]=null)},_syncShapes(){let e=this._inactiveShapeItems;e.forEach(t=>{let n=t.dataItem,r=t.element;n.isNew()||(r?(r._setOptionsFromModel(),this.addShape(r,t.undoable),this.widget._dataMap[n.id]=r):this._addDataItem(n),t.activate(),e.remove(n))})},_updateShapes(e,t){for(let n=0;n<e.length;n++){let r=e[n],i=this.widget._dataMap[r.id];i&&i.updateOptionsFromModel(r,t)}},_addShapes(e){for(let t=0;t<e.length;t++)this._addDataItem(e[t],!1)},_addDataItem(e,t){if(!O(e))return;let n=this.widget._dataMap[e.id];if(n)return n;let r=a({},this.widget.options.shapeDefaults);return r.dataItem=e,n=new $(r,this.widget),this.addShape(n,t!==!1),this.widget._dataMap[e.id]=n,n},_refreshConnections(e){e.action===`remove`?this._shouldRefresh()&&this._removeConnections(e.items):e.action===`add`?this._addConnections(e.items):e.action===`sync`||(e.action===`itemchange`?this._shouldRefresh()&&this._updateConnections(e.items):this.refreshConnections())},_removeConnections(e){for(let t=0;t<e.length;t++)this.remove(this.widget._connectionsDataMap[e[t].uid],!1),this.widget._connectionsDataMap[e[t].uid]=null},_updateConnections(e){for(let t=0;t<e.length;t++){let n=e[t];this.widget._connectionsDataMap[n.uid].updateOptionsFromModel(n)}},_addConnections(e,t){this.widget._addConnections(e,t)},_addShape(e,t){let n=this.dataSource,r;if(n&&this._isEditable){if(r=ae(n,ie(e.dataItem)),e.dataItem=r,e.updateModel(),!this.trigger(`add`,{shape:e})){this.dataSource.add(r);let n=this.widget._inactiveShapeItems.getByUid(r.uid);return n.element=e,n.undoable=t,e}}else if(!this.trigger(`add`,{shape:e}))return this.addShape(e,t)},_addConnection(e,t){let n=this.connectionsDataSource,r;if(n&&this._isEditable){if(r=ae(n,ie(e.dataItem)),e.dataItem=r,e.updateModel(),!this.trigger(`add`,{connection:e}))return this.widget._connectionsDataMap[r.uid]=e,n.add(r),this.addConnection(e,t),e._updateConnectors(),e}else if(!this.trigger(`add`,{connection:e}))return this.addConnection(e,t),e._updateConnectors(),e},_treeDataSource(){let e=this.widget.options.dataSource;if(e=Array.isArray(e)?{data:e}:e,e instanceof m&&!(e instanceof l))throw Error(`Incorrect DataSource type. If a single dataSource instance is set to the diagram then it should be a HierarchicalDataSource. You should set only the options instead of an instance or a HierarchicalDataSource instance or supply connectionsDataSource as well.`);e.fields||=[{field:`text`},{field:`url`},{field:`spriteCssClass`},{field:`imageUrl`}],this.dataSource&&this._refreshHandler&&this._unbindDataSource(),this._refreshHandler=this._refreshSource.bind(this),this._errorHandler=this._error.bind(this),this.dataSource=l.create(e).bind(v,this._refreshHandler).bind(y,this._errorHandler)},_unbindDataSource(){this.dataSource.unbind(v,this._refreshHandler).unbind(y,this._errorHandler)},_refreshSource(e){let t=e.node,n=e.action,r=e.items,i=this.options,a,o;if(e.field){for(a=0;a<r.length;a++)this.widget._dataMap[r[a].uid]&&this.widget._dataMap[r[a].uid].redrawVisual();return}if(n===`remove`)this._removeDataItems(e.items,!0);else for((!n||n===`itemloaded`)&&!this._bindingRoots&&(this._bindingRoots=!0,o=!0),!n&&!t&&this.clear(),this.widget._addDataItems(r,t),a=0;a<r.length;a++)r[a].load();i.layout&&(o||n===`remove`||n===`add`)&&this.layout(i.layout),o&&(this.trigger(`dataBound`),this._bindingRoots=!1)},_removeDataItems(e,t){let n,r,i,a;for(e=Array.isArray(e)?e:[e];e.length;)if(n=e.shift(),i=this.widget._dataMap[n.uid],i&&(this.widget._removeShapeConnections(i),this.widget._removeItem(i,!1),delete this.widget._dataMap[n.uid],t&&n.hasChildren&&n.loaded()))for(r=n.children.data(),a=0;a<r.length;a++)e.push(r[a])},_removeConnectionDataItem(e){this.connectionsDataSource.remove(e)},_removeShapeDataItem(e){this.dataSource.remove(e)},_clearTooltips:function(){this._shapeTooltip&&=(this._shapeTooltip.remove(),null),this._connectionTooltip&&=(this._connectionTooltip.remove(),null)},_positionTooltip:function(e,t,n){let r=this.widget,i=r.zoom(),a=r.pan(),o=e[0],s=o.getBoundingClientRect(),c=r.element.getBoundingClientRect(),l=r.element.ownerDocument.defaultView,u=r.connections.map(e=>e.allPoints()),d=k_({hovered:t,mouse:n,shapes:r.shapes.map(e=>e.bounds()),connections:u,diagramRect:c,zoom:i,pan:a,tooltipSize:{width:s.width,height:s.height},viewportBounds:new DOMRect(0,0,l.innerWidth,l.innerHeight)});o.style.left=ee(d.left+l.scrollX),o.style.top=ee(d.top+l.scrollY)},_createTooltip:function(t,n,r,i){let a=this,o=i?`_shapeTooltip`:`_connectionTooltip`;a[o]=e(C(kendo.template(r)(t))).css(`position`,`absolute`),a._positionTooltip(a[o],t,n),a[o].appendTo(`body`)},_destroyEditor:function(){this.editor&&=(this.editor.close(),null)}});n.ExportMixin.extend(w.fn,!0),kendo.PDFMixin&&kendo.PDFMixin.extend(w.fn);var T=kendo.Observable.extend({init:function(e,t){kendo.Observable.fn.init.call(this),this.diagram=e,this.options=a({},this.options,t),this._tools=[],this.createToolBar(),this.createTools(),this.appendTools(),this.options.modal&&this.createPopup(),this.bind(this.events,t)},events:[`click`],createPopup:function(){this.container=e(`<div/>`).append(this.element),this._popup=this.container.kendoPopup({}).getKendoPopup()},appendTools:function(){for(var e=0;e<this._tools.length;e++){var t=this._tools[e];(t.buttons&&t.buttons.length||!f(t.buttons))&&this._toolBar.add(t)}},createToolBar:function(){this.element=e(`<div/>`),this._toolBar=this.element.kendoToolBar({click:this.click.bind(this),resizable:!1}).getKendoToolBar(),this.element.css(`border`,`none`)},createTools:function(){for(var e=0;e<this.options.tools.length;e++)this.createTool(this.options.tools[e])},createTool:function(e){p(e)||(e={name:e});var t=e.name+`Tool`;this[t]?this[t](e):this._tools.push(a({},e,{attributes:this._setAttributes({action:e.name})}))},showAt:function(e){var t=parseInt(this.options.popupZIndex,10);this._popup&&(this._popup.open(e.x,e.y),t&&this._popup.wrapper.css(`zIndex`,t))},hide:function(){this._popup&&this._popup.close()},newGroup:function(){return{type:`buttonGroup`,buttons:[]}},editTool:function(){this._tools.push({icon:`pencil`,showText:`overflow`,type:`button`,text:`Edit`,attributes:this._setAttributes({action:`edit`})})},deleteTool:function(){this._tools.push({icon:`x`,showText:`overflow`,type:`button`,text:`Delete`,attributes:this._setAttributes({action:`delete`})})},rotateAnticlockwiseTool:function(e){this._appendGroup(`rotate`),this._rotateGroup.buttons.push({icon:`rotate-left`,showText:`overflow`,text:`RotateAnticlockwise`,group:`rotate`,attributes:this._setAttributes({action:`rotateAnticlockwise`,step:e.step})})},rotateClockwiseTool:function(e){this._appendGroup(`rotate`),this._rotateGroup.buttons.push({icon:`rotate-right`,attributes:this._setAttributes({action:`rotateClockwise`,step:e.step}),showText:`overflow`,text:`RotateClockwise`,group:`rotate`})},createShapeTool:function(){this._appendGroup(`create`),this._createGroup.buttons.push({icon:`shapes`,showText:`overflow`,text:`CreateShape`,group:`create`,attributes:this._setAttributes({action:`createShape`})})},createConnectionTool:function(){this._appendGroup(`create`),this._createGroup.buttons.push({icon:`connector`,showText:`overflow`,text:`CreateConnection`,group:`create`,attributes:this._setAttributes({action:`createConnection`})})},undoTool:function(){this._appendGroup(`history`),this._historyGroup.buttons.push({icon:`undo`,showText:`overflow`,text:`Undo`,group:`history`,attributes:this._setAttributes({action:`undo`})})},redoTool:function(){this._appendGroup(`history`),this._historyGroup.buttons.push({icon:`redo`,showText:`overflow`,text:`Redo`,group:`history`,attributes:this._setAttributes({action:`redo`})})},_appendGroup:function(e){var t=`_`+e+`Group`;this[t]||(this[t]=this.newGroup(),this._tools.push(this[t]))},_setAttributes:function(e){var t={};return e.action&&(t[kendo.attr(`action`)]=e.action),e.step&&(t[kendo.attr(`step`)]=e.step),t},_getAttributes:function(e){var t={},n=e.attr(kendo.attr(`action`));n&&(t.action=n);var r=e.attr(kendo.attr(`step`));return r&&(t.step=r),t},click:function(t){var n=this._getAttributes(e(t.target)),r=n.action;r&&this[r]&&this[r](n),this.trigger(`click`,this.eventData(r,t.target))},eventData:function(e,t){for(var n=this.selectedElements(),r=n.length,i=[],a=[],o,s=0;s<r;s++)o=n[s],o instanceof $?i.push(o):a.push(o);return{shapes:i,connections:a,action:e,target:t}},delete:function(){var e=this.diagram.widget._triggerRemove(this.selectedElements());e.length&&(this.diagram.remove(e,!0),this.diagram._syncChanges())},edit:function(){var e=this.selectedElements();e.length===1&&this.diagram.edit(e[0])},rotateClockwise:function(e){var t=parseFloat(e.step||90);this._rotate(t)},rotateAnticlockwise:function(e){var t=parseFloat(e.step||90);this._rotate(-t)},_rotate:function(e){var t=this.diagram.widget._resizingAdorner;t.angle(t.angle()+e),t.rotate()},selectedElements:function(){return this.diagram.select()},createShape:function(){this.diagram.createShape()},createConnection:function(){this.diagram.createConnection()},undo:function(){this.diagram.undo()},redo:function(){this.diagram.redo()},destroy:function(){this.diagram=null,this.element=null,this.options=null,this._toolBar&&this._toolBar.destroy(),this._popup&&this._popup.destroy()}}),E=kendo.Observable.extend({init:function(e,t){kendo.Observable.fn.init.call(this),this.options=c(!0,{},this.options,t),this.element=e,this.model=this.options.model,this.fields=this._getFields(),this._initContainer(),this.createEditable()},options:{editors:{}},_initContainer:function(){this.wrapper=this.element},createEditable:function(){var e=this.options;this.editable=new kendo.ui.Editable(this.wrapper,{fields:this.fields,target:e.target,clearContainer:!1,model:this.model})},_isEditable:function(e){return this.model.editable&&this.model.editable(e)},_getFields:function(){var e=[];for(var t in this.model.fields){var n={};if(this._isEditable(t)){var r=this.options.editors[t];r&&(n.editor=r),n.field=t,e.push(n)}}return e},end:function(){return this.editable.end()},destroy:function(){this.editable.destroy(),this.editable.element.find(`[`+kendo.attr(`container-for`)+`]`).empty(),this.model=this.wrapper=this.element=this.columns=this.editable=null}}),ne=E.extend({init:function(e,t){E.fn.init.call(this,e,t),this.bind(this.events,this.options),this.open()},events:[`update`,`cancel`],options:{window:{modal:!0,resizable:!1,draggable:!0,title:`Edit`,visible:!1}},_initContainer:function(){var t=this;this.wrapper=e(`<div class="k-popup-edit-form"/>`).attr(kendo.attr(`uid`),this.model.uid);var n=``;this.options.template?(n+=this._renderTemplate(),this.fields=[]):n+=this._renderFields(),n+=this._renderButtons(),this.wrapper.append(e(`<div class="k-edit-form-container"/>`).append(n)),this.window=new kendo.ui.Window(this.wrapper.appendTo(this.element),this.options.window),this.window.bind(`close`,function(e){e.userTriggered&&(e.sender.element.trigger(`focus`),t._cancelClick(e))}),this._attachButtonEvents()},_renderTemplate:function(){var e=this.options.template;return typeof e==`string`&&(e=kendo.unescape(e)),e=kendo.template(e)(this.model),e},_renderFields:function(){for(var e=``,t=0;t<this.fields.length;t++){var n=this.fields[t];e+=`<div class="k-edit-label"><label for="`+n.field+`">`+(n.field||``)+`</label></div>`,this._isEditable(n.field)&&(e+=`<div `+kendo.attr(`container-for`)+`="`+n.field+`" class="k-edit-field"></div>`)}return e},_renderButtons:function(){var e=`<div class="k-edit-buttons">`;return e+=this._createButton(`update`),e+=this._createButton(`cancel`),e+=`</div>`,e},_createButton:function(e){return kendo.template(b)(te[e])},_attachButtonEvents:function(){this._cancelClickHandler=this._cancelClick.bind(this),this.window.element.on(g+h,`button.k-diagram-cancel`,this._cancelClickHandler),this._updateClickHandler=this._updateClick.bind(this),this.window.element.on(g+h,`button.k-diagram-update`,this._updateClickHandler)},_updateClick:function(e){e.preventDefault(),this.trigger(`update`)},_cancelClick:function(e){e.preventDefault(),this.trigger(`cancel`)},open:function(){this.window.center().open()},close:function(){this.window.bind(`deactivate`,this.destroy.bind(this)).close()},destroy:function(){this.window.close().destroy(),this.window.element.off(g+h,`a.k-diagram-cancel`,this._cancelClickHandler),this.window.element.off(g+h,`a.k-diagram-update`,this._updateClickHandler),this._cancelClickHandler=null,this._editUpdateClickHandler=null,this.window=null,E.fn.destroy.call(this)}});function re(t,n){var r=this.dataSource.reader.model;if(r){var i=r.fn.fields.text?`text`:r.idField;e(`<input name='`+n.field+`' />`).appendTo(t).kendoDropDownList({dataValueField:r.idField,dataTextField:i,dataSource:this.dataSource.data().toJSON(),optionLabel:` `,valuePrimitive:!0})}}function ie(e){var t=e;return e instanceof kendo.data.Model&&(t=e.toJSON(),t[e.idField]=e._defaultId),t}function ae(e,t){return e.reader.model?new e.reader.model(t):new kendo.data.ObservableObject(t)}n.ui.plugin(w),a(r,{Shape:$,Connection:zg,Connector:dm,DiagramToolBar:T,QuadNode:r_,QuadRoot:n_,ShapesQuadTree:i_,PopupEditor:ne})})(window.kendo.jQuery);let M_={id:`dataviz.diagram`,name:`Diagram`,category:`dataviz`,description:`The Kendo DataViz Diagram `,depends:[`data`,`userevents`,`mobile.scroller`,`draganddrop`,`drawing`,`dataviz.core`,`dataviz.themes`,`toolbar`],features:[{id:`dataviz.diagram-pdf-export`,name:`PDF export`,description:`Export Diagram as PDF`,depends:[`pdf`]},{id:`dataviz.diagram-editing`,name:`Editing`,description:`Support for model editing`,depends:[`editable`,`window`,`dropdownlist`]}]};var N_=kendo;e.__meta__=M_,e.default=N_});
//# sourceMappingURL=kendo.dataviz.diagram.min.js.map