/**
 * Kendo UI v2026.1.212 (http://www.telerik.com/kendo-ui)
 * Copyright 2026 Progress Software Corporation and/or one of its subsidiaries or affiliates. All rights reserved.
 *
 * Kendo UI commercial licenses may be obtained at
 * http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
 * If you do not own a commercial license, this file shall be governed by the trial license terms.
 */
(function(e,t){typeof exports==`object`&&typeof module<`u`?t(exports,require(`kendo.mobile.scroller.min.js`),require(`kendo.toolbar.min.js`),require(`kendo.pager.min.js`),require(`kendo.combobox.min.js`),require(`kendo.textbox.min.js`),require(`kendo.core.min.js`),require(`kendo.drawing.min.js`),require(`kendo.upload.min.js`),require(`kendo.dialog.min.js`),require(`kendo.window.min.js`),require(`kendo.binder.min.js`),require(`kendo.numerictextbox.min.js`),require(`kendo.dropdownlist.min.js`),require(`kendo.icons.min.js`),require(`kendo.draganddrop.min.js`),require(`kendo.form.min.js`),require(`kendo.colorpicker.min.js`)):typeof define==`function`&&define.amd?define([`exports`,`kendo.mobile.scroller.min`,`kendo.toolbar.min`,`kendo.pager.min`,`kendo.combobox.min`,`kendo.textbox.min`,`kendo.core.min`,`kendo.drawing.min`,`kendo.upload.min`,`kendo.dialog.min`,`kendo.window.min`,`kendo.binder.min`,`kendo.numerictextbox.min`,`kendo.dropdownlist.min`,`kendo.icons.min`,`kendo.draganddrop.min`,`kendo.form.min`,`kendo.colorpicker.min`],t):(e=typeof globalThis<`u`?globalThis:e||self,t((e.kendo=e.kendo||{},e.kendo._globals=e.kendo._globals||{},e.kendo._globals.Pdfviewer={}),e.kendo._globals.MobileScroller,e.kendo._globals.Toolbar,e.kendo._globals.Pager,e.kendo._globals.Combobox,e.kendo._globals.Textbox,e.kendo._globals.Core,e.kendo._globals.Drawing,e.kendo._globals.Upload,e.kendo._globals.Dialog,e.kendo._globals.Window,e.kendo._globals.Binder,e.kendo._globals.Numerictextbox,e.kendo._globals.Dropdownlist,e.kendo._globals.Icons,e.kendo._globals.Draganddrop,e.kendo._globals.Form,e.kendo._globals.Colorpicker))})(this,function(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,ee,g){Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:`Module`}}),(function(e,t){var n=window.kendo,r=e.extend;r(n,{pdfviewer:{dpl:{processor:n.Class.extend({init:function(e,t){var n=this;n.options=e,n.read=e.read,n.upload=e.upload,n.download=e.download,n.viewer=t},fetchDocument:function(){var t=this,r=e.Deferred(),i=t.viewer.options.messages.errorMessages;return t.read?(e.ajax({type:t.read.type,url:t.read.url,dataType:t.read.dataType,success:function(e){typeof e!=`string`&&(e=n.stringify(e)),r.resolve(JSON.parse(e))},error:function(e){t.viewer._triggerError({error:e.responseText,message:i.parseError})}}),r):r.resolve()},fetchPageData:function(t){var n=this,r=e.Deferred(),i=n.viewer.document.pages[t-1],a={};return a[n.read.pageField]=t,i.geometries.length?r.resolve(i):e.ajax({type:n.read.type,url:n.read.url,data:a,success:function(e){r.resolve(JSON.parse(e))},error:function(e){n.viewer._triggerError({error:e.responseText,message:n.viewer.options.messages.errorMessages.parseError})}}),r},downloadFile:function(e){window.location=this.download.url+`?file=`+e},fromJSON:function(e){var t=this.viewer;t._clearPages(),t.document=e,t.document.total=t.document.pages.length,t._renderPages(),t.resize(!0),t.activatePage(1)}})}}})})(window.kendo.jQuery);function te(){return window.pdfjsLib?!window.pdfjsLib?.GlobalWorkerOptions?.workerSrc&&!window.pdfjsWorker?(console?.error(`The pdf.worker.mjs script is not loaded. The PDF.JS library will not work correctly.
    Either load the script:
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.6.82/pdf.worker.mjs" type="module"><\/script>
    
    Or set it to the GlobalWorkerOptions.workerSrc property:
    
    <script type="module">
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.6.82/pdf.worker.mjs';
    <\/script>`),!1):!0:(console?.error(`PDF.JS library is required. Make sure that it is properly loaded <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.6.82/pdf.mjs" type="module"><\/script>`),!1)}kendo.pdfviewer.pdfjs={lib:window.pdfjsLib},(function(e,t){var n=kendo.Class,r=e.extend,i=JSON.parse,a=kendo.ui.progress,n=kendo.Class,o=`open`,s=n.extend({init:function(e){this.viewer=e,this.errorMessages=this.viewer.options.messages.errorMessages,this.upload=this.viewer.processor&&this.viewer.processor.upload},_initUpload:function(t,n){var i=r({select:this._onSelect.bind(this),success:this._onSuccess.bind(this),error:this._onError.bind(this),complete:this._onComplete.bind(this),showFileList:!1,multiple:!1,validation:{allowedExtensions:[`.pdf`]}},n||{});return this.upload&&r(i,{async:{saveUrl:this.upload.url,autoUpload:!0,saveField:this.upload.saveField}}),(t||e(`<input name="files" accept=".pdf" type="file" />`)).kendoUpload(i).getKendoUpload()},_onComplete:function(){a(this.viewer.pageContainer,!1)},_onSuccess:function(t){var n=i(t.response);e.isPlainObject(n)?this.viewer.processor.fromJSON(n):this.viewer._triggerError({error:n,message:this.errorMessages.parseError})},_onError:function(e){this.viewer._triggerError({error:e.XMLHttpRequest.responseText,message:this.errorMessages.notSupported})},_onSelect:function(e){var t=this,n=e.files[0];if(a(t.viewer.pageContainer,!0),!(t.viewer.trigger(o,{file:n})||t.upload)){if(n.extension.toLowerCase()!==`.pdf`){t.viewer._triggerError({error:n,message:t.errorMessages.notSupported});return}var r=new FileReader;r.onload=function(e){var n=e.target.result;let r=t.viewer._isDPLProcessor()?n:{data:n};t.viewer.fromFile(r)},r.onerror=function(){t.viewer._triggerError({error:n,message:t.errorMessages.parseError})},r.readAsArrayBuffer(n.rawFile)}}});r(kendo.pdfviewer,{UploadHelper:s})})(window.kendo.jQuery),(function(e,t){var n=e.extend,r=e.noop,i=kendo.drawing,a=i.Group,o=i.Surface,s=`render`,c=kendo.Class,l=kendo.pdfviewer.UploadHelper,u={Path:`path`,MultiPath:`multipath`,Rect:`rect`,Image:`image`,Text:`text`},d=e=>`<div class="k-page k-blank-page">
        <div id="${e}" class="k-external-dropzone">
            <div class="k-dropzone-inner">
                <span class="k-dropzone-icon k-icon k-svg-icon k-icon-xxxl k-svg-i-upload">
                    <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M32 384v96h448v-96H32zm192-64h64V192h96L256 32 128 192h96v128z"></path>
                    </svg>
                </span>
                <span class="k-dropzone-hint">Drag and drop files here to upload</span>
            </div>
        </div>
        <input name="files" accept=".pdf" type="file" ref-pdfviewer-blank-page-upload>
    </div>`,f=c.extend({init:function(t,n){this.viewer=n,this.processor=t.processor,this.options=t,this.pageNumber=t.number,this.element=e(`<div class='k-page' />`),this.element.attr(kendo.attr(`number`),this.pageNumber),this._updatePageSize(t),this.width=t.width,this.height=t.height},resize:function(e){var t=this.element;this._updatePageSize({width:Math.min(t.width()*e,this.width),height:Math.min(t.height()*e,this.height)})},_updatePageSize:function(e){this.element.width(e.width).height(e.height)},destroy:function(){kendo.destroy(this.element)},render:r}),p=f.extend({init:function(t,n){this.viewer=n,this.options=t,this._externalDropZoneId=`${n.element.attr(`id`)}-external-dropzone`,this.element=e(d(this._externalDropZoneId)),this._uploadHelper=new l(n)},_initUpload:function(){this._upload=this._uploadHelper._initUpload(this.element.find(`input[ref-pdfviewer-blank-page-upload]`),{dropZone:`#${this._externalDropZoneId}`,showFileList:!1,async:{autoUpload:!1,saveUrl:`save`}})},resize:r,_updatePageSize:r,destroy:function(){this._upload&&this._upload.destroy(),kendo.destroy(this.element)},render:r}),m=f.extend({draw:function(){var e=this,t=e.options.geometries;e.group=new a,e.surface.draw(e.group),e._drawGeometries(t),e.viewer.trigger(s,{page:this}),kendo.ui.progress(e.element,!1)},load:function(){var e=this;e.loaded||!e.processor||(e.processor.fetchPageData(e.pageNumber).then(function(t){e.options=t,e._initSurface(),e.draw()}),e.loaded=!0)},_initSurface:function(){var e={width:this.element.width(),height:this.element.height()},t=n({width:this.width,height:this.height},this.viewer.options.view);this.surface=new o(this.element,t),this._updatePageSize(e)},_drawGeometries:function(e){var t=this,n;if(e)for(var r=0;r<=e.length;r++){var i=e[r];if(i){switch(i.type){case u.Path:case u.MultiPath:n=t._drawPath(i);break;case u.Rect:n=t._drawRect(i);break;case u.Image:n=t._drawImage(i);break;case u.Text:n=t._drawText(i);break;default:n=null;break}n&&t.group.append(n)}}},_drawRect:function(e){var t=new kendo.geometry.Rect(e.point,e.size);return new i.Rect(t,{transform:this._getMatrix(e.transform),fill:e.fillOptions,stroke:e.strokeOptions})},_drawImage:function(e){var t=new kendo.geometry.Rect(e.point,e.size);return new i.Image(e.src,t,{transform:this._getMatrix(e.transform)})},_drawText:function(e){var t={transform:this._getMatrix(e.transform),stroke:e.strokeOptions,fill:e.fillOptions,font:e.font};return new kendo.drawing.Text(e.content,e.point,t)},_drawPath:function(e){for(var t={transform:this._getMatrix(e.transform),stroke:e.strokeOptions,fill:e.fillOptions},n=new i.MultiPath(t),r=0;r<e.paths.length;r++){var a=e.paths[r];if(!a.segments)return;n.moveTo.apply(n,a.point);for(var o=0;o<a.segments.length;o++){var s=a.segments[o];(s.points.length===1?n.lineTo:n.curveTo).apply(n,s.points)}a.closed&&n.close()}return n},_getMatrix:function(e){return new kendo.geometry.Matrix(...e)}});n(kendo.pdfviewer.dpl,{geometryTypes:u,Page:m}),n(kendo.pdfviewer,{BlankPage:p})})(window.kendo.jQuery);let ne=e=>{e.deleteAnnotation()},re=(e,t)=>{e.setHighlightColor(t)},ie=(e,t)=>{e.setFreeTextColor(t)},ae=(e,t)=>{e.setFreeTextFontSize(t)},oe=(e,t)=>{e.interactionMode!==t.mode&&e.setInteractionMode({mode:t.mode}),e.setAnnotationEditorMode(t)},se=e=>{e.resetAnnotationEditorMode()},ce=(e,t)=>{e.setInteractionMode({mode:t})},le=(e,t)=>n=>t(e(n)),_=(e,t,n)=>e.addEventListener&&e.addEventListener(t,n),v=(e,t,n)=>e&&e.removeEventListener&&e.removeEventListener(t,n),ue=()=>{},de=e=>e.preventDefault(),fe=/touch/;function pe(e){return e.type.match(fe)?{pageX:e.changedTouches[0].pageX,pageY:e.changedTouches[0].pageY,clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY,type:e.type,originalEvent:e,isTouch:!0}:{pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,type:e.type,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,originalEvent:e}}var me=class e{static supportPointerEvent(){return typeof window<`u`&&window.PointerEvent}get document(){return this._element?this._element.ownerDocument:document}constructor({press:e=ue,drag:t=ue,release:n=ue,mouseOnly:r=!1}){this._pressHandler=le(pe,e),this._dragHandler=le(pe,t),this._releaseHandler=le(pe,n),this._ignoreMouse=!1,this._mouseOnly=r,this._touchstart=e=>{e.touches.length===1&&this._pressHandler(e)},this._touchmove=e=>{e.touches.length===1&&this._dragHandler(e)},this._touchend=e=>{e.touches.length===0&&e.changedTouches.length===1&&(this._releaseHandler(e),this._ignoreMouse=!0,setTimeout(this._restoreMouse,2e3))},this._restoreMouse=()=>{this._ignoreMouse=!1},this._mousedown=e=>{let{which:t}=e;t&&t>1||this._ignoreMouse||(_(this.document,`mousemove`,this._mousemove),_(this.document,`mouseup`,this._mouseup),this._pressHandler(e))},this._mousemove=e=>{this._dragHandler(e)},this._mouseup=e=>{v(this.document,`mousemove`,this._mousemove),v(this.document,`mouseup`,this._mouseup),this._releaseHandler(e)},this._pointerdown=e=>{e.isPrimary&&e.button===0&&(_(this.document,`pointermove`,this._pointermove),_(this.document,`pointerup`,this._pointerup),_(this.document,`pointercancel`,this._pointerup),_(this.document,`contextmenu`,de),this._pressHandler(e))},this._pointermove=e=>{e.isPrimary&&this._dragHandler(e)},this._pointerup=e=>{e.isPrimary&&(v(this.document,`pointermove`,this._pointermove),v(this.document,`pointerup`,this._pointerup),v(this.document,`pointercancel`,this._pointerup),v(this.document,`contextmenu`,de),this._releaseHandler(e))}}cancelDrag(){v(this.document,`pointermove`,this._pointermove),v(this.document,`pointerup`,this._pointerup),v(this.document,`pointercancel`,this._pointerup)}bindTo(e){e!==this._element&&(this._element&&this._unbindFromCurrent(),this._element=e,this._bindToCurrent())}_bindToCurrent(){let e=this._element;if(this._usePointers()){_(e,`pointerdown`,this._pointerdown);return}_(e,`mousedown`,this._mousedown),this._mouseOnly||(_(e,`touchstart`,this._touchstart),_(e,`touchmove`,this._touchmove),_(e,`touchend`,this._touchend))}_unbindFromCurrent(){let e=this._element;if(this._usePointers()){v(e,`pointerdown`,this._pointerdown),v(this.document,`pointermove`,this._pointermove),v(this.document,`pointerup`,this._pointerup),v(this.document,`contextmenu`,de),v(this.document,`pointercancel`,this._pointerup);return}v(e,`mousedown`,this._mousedown),this._mouseOnly||(v(e,`touchstart`,this._touchstart),v(e,`touchmove`,this._touchmove),v(e,`touchend`,this._touchend))}_usePointers(){return!this._mouseOnly&&e.supportPointerEvent()}update({press:e=ue,drag:t=ue,release:n=ue,mouseOnly:r=!1}){this._pressHandler=le(pe,e),this._dragHandler=le(pe,t),this._releaseHandler=le(pe,n),this._mouseOnly=r}destroy(){this._unbindFromCurrent(),this._element=null}};me.default=me;var he=me;let ge=(...e)=>Object.assign(...e),_e=e=>e&&typeof e==`object`&&!Array.isArray(e),ve=e=>e instanceof HTMLElement,ye=e=>e&&window&&window.DotNet&&window.DotNet.DotNetObject&&e instanceof DotNet.DotNetObject,be=(e,...t)=>{if(!t.length)return e;let n=t.shift();if(_e(e)&&_e(n))for(let t in n)t===`__proto__`||t===`constructor`||(n[t]instanceof Me||ve(n[t])||t===`dotNetInstance`||ye(n[t])||n[t]&&n[t].buffer&&n[t].buffer instanceof ArrayBuffer||_e(n[t])&&Object.getPrototypeOf(n[t])!==Object.prototype?e[t]=n[t]:_e(n[t])?((!e[t]||!_e(e[t]))&&ge(e,{[t]:{}}),be(e[t],n[t])):ge(e,{[t]:n[t]}));return be(e,...t)},xe=e=>typeof e==`function`,Se=e=>typeof e==`string`,Ce=e=>Array.from(e),we=e=>e!==void 0,Te=e=>e!==null,Ee=e=>we(e)&&Te(e),De=function(){},Oe=(e,t)=>{let n=(t||document).createElement(`template`);n.innerHTML=e.trim();let r=n.content;return r.childNodes.length>1?r.childNodes:r.firstChild},ke=e=>e?.startsWith(`.`)?e:`.${e}`,Ae=e=>{let t=0;return e.wheelDelta?t=-e.wheelDelta/120:e.detail&&(t=e.detail/3),t=t>0?Math.ceil(t):Math.floor(t),t},je=()=>{let e,t,n=new Promise(function(n,r){e=n,t=r});return n.resolve=e,n.reject=t,n};var Me=class{constructor(e,t){this.options={events:{}},this.element=e,this.options=t}destroy(){this.element=null}extendOptions(e){this.options=be(this.options,e)}setOptions(e){this.options=e}trigger(e,t={}){let n={defaultPrevented:!1,preventDefault:()=>{n.defaultPrevented=!0}};return this.options.events&&xe(this.options.events[e])&&this.options.events[e](ge(n,t,{sender:this})),n.defaultPrevented}};let Ne=function(e,t,n={}){let r,i,a,o,s=0,c=function(){s=n.leading===!1?0:new Date().getTime(),r=void 0,o=e.apply(i,a),r||(i=a=null)};return function(){let l=new Date().getTime();!s&&n.leading===!1&&(s=l);let u=t-(l-s);return i=void 0,a=arguments,u<=0||u>t?(r&&=(clearTimeout(r),void 0),s=l,o=e.apply(i,a),r||(i=a=null)):!r&&n.trailing!==!1&&(r=window.setTimeout(c,u)),o}},Pe=e=>{e.preventDefault&&e.preventDefault(),e.originalEvent&&e.originalEvent.preventDefault()},Fe=(e,t)=>!e||!t?!1:e.closest(t),Ie=1e3/60,Le=`scroll`;var Re=class extends Me{constructor(e,t){super(e,t),this.options={events:{[Le]:De},filter:``,panScrollThrottleDelay:Ie,scrollDirectionModifier:-1,scrollThrottleDelay:Ie},this.onElementScroll=e=>{let t=this.element;this.shouldTrackScrollEvents()&&(this.state.trackNextElementScroll?this.scrollTo(t.scrollLeft,t.scrollTop):this.state.trackNextElementScroll=!0,this.trigger(Le,{originalEvent:e}))},this.onDragStart=e=>{if(this.state.dragStarted=!1,!this.shouldTrackPanEvents())return;let t=e.target||(e.originalEvent||{}).target;this.options.filter&&!Fe(t,this.options.filter)||(Pe(e),this.setState({dragStarted:!0,location:{pageX:e.pageX,pageY:e.pageY},locationDelta:{x:0,y:0}}))},this.onDrag=e=>{if(!this.shouldTrackPanEvents()||!this.state.dragStarted)return;this.calculateEventLocationDelta(e),this.setState({location:{pageX:e.pageX,pageY:e.pageY}});let t=this.options.scrollDirectionModifier,n=this.element.scrollLeft+t*this.state.locationDelta.x,r=this.element.scrollTop+t*this.state.locationDelta.y;this.scrollTo(n,r)},this.onDragEnd=()=>{},this.extendOptions(t),this.resetState(),this.bindEvents()}destroy(){this.unbindEvents()}initDraggable(){this.destroyDraggable(),this.options.panScrollThrottleDelay>0?this.throttledOnDrag=Ne(this.onDrag,this.options.panScrollThrottleDelay):this.throttledOnDrag=this.onDrag,this.draggable=new he({mouseOnly:!1,press:this.onDragStart,drag:this.throttledOnDrag,release:this.onDragEnd}),this.draggable.bindTo(this.element)}destroyDraggable(){this.draggable&&this.draggable.destroy&&(this.draggable.destroy(),this.throttledOnDrag&&this.throttledOnDrag.cancel&&(this.throttledOnDrag.cancel(),this.throttledOnDrag=null))}bindEvents(){this.bindDraggableEvents(),this.bindElementScroll()}bindDraggableEvents(){this.initDraggable()}bindElementScroll(){this.options.scrollThrottleDelay>0?this.throttledOnElementScroll=Ne(this.onElementScroll,this.options.scrollThrottleDelay):this.throttledOnElementScroll=this.onElementScroll,this.element.addEventListener(Le,this.throttledOnElementScroll)}unbindEvents(){this.unbindElementScroll(),this.unbindDraggableEvents()}unbindDraggableEvents(){this.destroyDraggable()}unbindElementScroll(){this.throttledOnElementScroll&&this.throttledOnElementScroll.cancel&&(this.throttledOnElementScroll.cancel(),this.throttledOnElementScroll=null),this.element.removeEventListener(Le,this.throttledOnElementScroll)}setState(e){this.state=Object.assign({},this.state||{},e)}resetState(){this.setState({trackPanEvents:!1,trackScrollEvents:!1,trackNextElementScroll:!1,location:{pageX:0,pageY:0},locationDelta:{x:0,y:0}})}enablePanEventsTracking(){this.state.trackPanEvents=!0,this.bindDraggableEvents()}disablePanEventsTracking(){this.unbindDraggableEvents(),this.state.trackPanEvents=!1}shouldTrackPanEvents(){return this.state.trackPanEvents}enableScrollEventsTracking(){this.state.trackScrollEvents=!0,this.unbindElementScroll(),this.bindElementScroll()}disableScrollEventsTracking(){this.unbindElementScroll(),this.state.trackScrollEvents=!1}shouldTrackScrollEvents(){return this.state.trackScrollEvents}calculateEventLocationDelta(e){this.state.locationDelta={x:e.pageX-this.state.location.pageX,y:e.pageY-this.state.location.pageY}}scrollTo(e,t,n={trackScrollEvent:!0}){n.trackScrollEvent||(this.state.trackNextElementScroll=!1),this.element.scrollLeft=e,this.element.scrollTop=t}};let ze=e=>{let t=e.parentElement;!e||!t||t.replaceWith(...Array.from(t.childNodes))},Be=e=>{if(!(!e||!e.length||e.length<=0))for(let t=0;t<e.length;t++)ze(e[t])},Ve=(e,t)=>{e.parentNode&&(e.parentNode.insertBefore(t,e),t.appendChild(e))},He=(e,t)=>{if(!(!e||!e.parentNode||!t))for(e.appendChild(t);e.firstChild&&e.firstChild!==t;)t.appendChild(e.firstChild)},Ue=(e,t)=>{t.classList.add(e)},We=(e,t)=>{t.classList.remove(e)},Ge=e=>`.${e}`,Ke=`data-char-index`,qe=`data-match-index`;var Je=class{constructor(e){this.options={highlightClass:`k-search-highlight`,highlightMarkClass:`k-search-highlight-mark`,charClass:`k-text-char`,textContainers:[]},this.extendOptions(e),this.resetState()}destroy(){this.clearSearch(),this.resetState()}extendOptions(e){this.options=Object.assign({},this.options,e)}setState(e){this.state=Object.assign({},this.state||{},e)}resetState(){this.setState({text:``,textNodes:[],charIndex:0,activeMatchIndex:0,matches:[]})}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}search({text:e,matchCase:t}){let n=this.escapeRegExp(e),r=new RegExp(n,t?`g`:`ig`),i;if(this.shouldTransformText()&&this.transformTextForSearch(),this.state.matches=[],this.state.activeMatchIndex=0,this.removeIndicators(),n===``)return[];for(i=r.exec(this.state.text);i;)this.state.matches.push({startOffset:i.index,endOffset:i.index+i[0].length}),i=r.exec(this.state.text);return this.highlightAllMatches(),this.addActiveMatchMark(),this.state.matches}clearSearch(){this.removeIndicators(),this.restoreOriginalText()}restoreOriginalText(){this.forEachTextContainer(e=>{Array.from(e.querySelectorAll(`span:not(.`+this.options.charClass+`)`)).forEach(e=>{let t=e.textContent;Ce(e.childNodes).forEach(t=>{e.removeChild(t)});let n=e.ownerDocument.createTextNode(t);e.appendChild(n)})})}shouldTransformText(){return!this.state.text}transformTextForSearch(){this.state.textNodes=[],this.state.charIndex=0,this.state.text=``,this.forEachTextContainer(e=>{this.extractTextNodes(e)}),this.transformTextNodesForSearch(this.state.textNodes)}extractTextNodes(e){if(e.nodeType===Node.TEXT_NODE)this.state.textNodes.push(e);else for(let t=0;t<e.childNodes.length;t++)this.extractTextNodes(e.childNodes[t])}transformTextNodesForSearch(e){for(let t=0;t<e.length;t++)this.transformTextNodeForSearch(e[t])}transformTextNodeForSearch(e){let t=e.textContent;if(t.length<=0)return;this.state.text=this.state.text+t;let n=document.createElement(`span`);Ve(e,n),e.textContent=``,this.splitTextByChars(t).forEach(e=>{n.appendChild(e)}),ze(n.childNodes[0])}splitTextByChars(e){let t=[];for(let n=0;n<e.length;n++){let r=document.createElement(`span`);Ue(this.options.charClass,r),r.setAttribute(`${Ke}`,`${this.state.charIndex}`),r.textContent=e[n],t.push(r),this.state.charIndex++}return t}forEachTextContainer(e){for(let t=0;t<this.options.textContainers.length;t++){let n=this.options.textContainers[t];e(n,t)}}highlightAllMatches(){this.state.matches.forEach((e,t)=>{this.addMatchHighlight(e.startOffset,e.endOffset,t)})}addMatchHighlight(e,t,n){for(let r=e;r<t;r++)this.forEachTextContainer(e=>{Array.from(e.querySelectorAll(Ge(`${this.options.charClass}[${Ke}='${r}']`))).forEach(e=>{Ue(this.options.highlightClass,e),e.setAttribute(qe,n)})})}removeMatchHighlights(){this.forEachTextContainer(e=>{Array.from(e.querySelectorAll(Ge(this.options.highlightClass))).forEach(e=>{We(this.options.highlightClass,e),e.removeAttribute(qe)})})}addActiveMatchMark(){!this.state.activeMatchIndex&&this.state.activeMatchIndex!==0?this.state.activeMatchIndex=0:this.state.activeMatchIndex>this.state.matches.length?this.state.activeMatchIndex=this.state.matches.length:this.removeActiveMatchMark();let e=document.createElement(`span`);e.classList.add(this.options.highlightMarkClass),this.forEachTextContainer(t=>{Array.from(t.querySelectorAll(Ge(this.options.charClass+`[data-match-index='`+this.state.activeMatchIndex+`']`))).forEach(t=>{He(t,e.cloneNode(!0))})})}removeActiveMatchMark(){this.forEachTextContainer(e=>{Be(Array.from(e.querySelectorAll(Ge(this.options.highlightMarkClass))).flatMap(e=>Array.from(e.childNodes)))})}removeIndicators(){this.removeActiveMatchMark(),this.removeMatchHighlights()}markNextMatch(){this.markNextMatchIndex(),this.addActiveMatchMark()}markPreviousMatch(){this.markPreviousMatchIndex(),this.addActiveMatchMark()}markNextMatchIndex(){this.moveActiveMatchIndex(1)}markPreviousMatchIndex(){this.moveActiveMatchIndex(-1)}moveActiveMatchIndex(e){this.state.activeMatchIndex+=e,this.state.activeMatchIndex<0?this.state.activeMatchIndex=Math.max(this.state.matches.length-1,0):this.state.activeMatchIndex>this.state.matches.length-1&&(this.state.activeMatchIndex=0)}getActiveMatchElement(){let e;return this.forEachTextContainer(t=>{let n=t.querySelector(Ge(this.options.highlightMarkClass));n&&(e=n)}),e}};function Ye(e,t,n={}){let r=et;if(n.forceProxy&&!n.proxyURL)throw Error(`No proxyURL is set, but forceProxy is true`);n.forceProxy||(Ze()&&(r=$e),navigator.msSaveBlob&&(r=Qe)),r(e,t,n)}let Xe=()=>document.createElement(`a`),Ze=()=>`download`in Xe();function Qe(e,t){let n=e;if(typeof e==`string`){let t=e.split(`;base64,`),r=t[0],i=atob(t[1]),a=new Uint8Array(i.length);for(let e=0;e<i.length;e++)a[e]=i.charCodeAt(e);n=new Blob([a.buffer],{type:r})}navigator.msSaveBlob(n,t)}function $e(e,t){let n=e;window.Blob&&e instanceof Blob&&(n=URL.createObjectURL(e));let r=Xe();r.download=t,r.href=n;let i=document.createEvent(`MouseEvents`);i.initMouseEvent(`click`,!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(i),setTimeout(()=>URL.revokeObjectURL(n))}function et(e,t,n){if(!n.proxyURL)return;let r=document.createElement(`form`);r.setAttribute(`action`,n.proxyURL),r.setAttribute(`method`,`POST`),r.setAttribute(`target`,n.proxyTarget||`_self`);let i=n.proxyData||{};i.fileName=t;let a=e.split(`;base64,`);for(let e in i.contentType=a[0].replace(`data:`,``),i.base64=a[1],i)if(i.hasOwnProperty(e)){let t=document.createElement(`input`);t.setAttribute(`type`,`hidden`),t.setAttribute(`name`,e),t.setAttribute(`value`,i[e]),r.appendChild(t)}document.body.appendChild(r),r.submit(),document.body.removeChild(r)}String.fromCharCode;let tt=()=>typeof window<`u`,nt={wp:/(Windows Phone(?: OS)?)\s(\d+)\.(\d+(\.\d+)?)/,fire:/(Silk)\/(\d+)\.(\d+(\.\d+)?)/,android:/(Android|Android.*(?:Opera|Firefox).*?\/)\s*(\d+)(\.(\d+(\.\d+)?))?/,iphone:/(iPhone|iPod).*OS\s+(\d+)[\._]([\d\._]+)/,ipad:/(iPad).*OS\s+(\d+)[\._]([\d_]+)/,meego:/(MeeGo).+NokiaBrowser\/(\d+)\.([\d\._]+)/,webos:/(webOS)\/(\d+)\.(\d+(\.\d+)?)/,blackberry:/(BlackBerry|BB10).*?Version\/(\d+)\.(\d+(\.\d+)?)/,playbook:/(PlayBook).*?Tablet\s*OS\s*(\d+)\.(\d+(\.\d+)?)/,windows:/(MSIE)\s+(\d+)\.(\d+(\.\d+)?)/,tizen:/(tizen).*?Version\/(\d+)\.(\d+(\.\d+)?)/i,sailfish:/(sailfish).*rv:(\d+)\.(\d+(\.\d+)?).*firefox/i,ffos:/(Mobile).*rv:(\d+)\.(\d+(\.\d+)?).*Firefox/},rt={ios:/^i(phone|pad|pod)$/i,android:/^android|fire$/i,blackberry:/^blackberry|playbook/i,windows:/windows/,wp:/wp/,flat:/sailfish|ffos|tizen/i,meego:/meego/},it={edge:/(edge)[ \/]([\w.]+)/i,webkit:/(chrome)[ \/]([\w.]+)/i,safari:/(webkit)[ \/]([\w.]+)/i,opera:/(opera)(?:.*version|)[ \/]([\w.]+)/i,msie:/(msie\s|trident.*? rv:)([\w.]+)/i,mozilla:/(mozilla)(?:.*? rv:([\w.]+)|)/i},at={omini:/Opera\sMini/i,omobile:/Opera\sMobi/i,firefox:/Firefox|Fennec/i,mobilesafari:/version\/.*safari/i,ie:/MSIE|Windows\sPhone/i,chrome:/chrome|crios/i,webkit:/webkit/i},ot=(e,t,n)=>{for(let n in t)if(t.hasOwnProperty(n)&&t[n].test(e))return n;return n===void 0?e:n},st=e=>{let t,n=[];for(let r in nt)if(nt.hasOwnProperty(r)){if(n=e.match(nt[r]),!n)continue;if(r===`windows`&&`plugins`in window.navigator)return null;let i={};return i.device=r,i.browser=ot(e,at,`default`),i.name=ot(r,rt),i[i.name]=!0,i.majorVersion=n[2],i.minorVersion=n[3]?n[3].replace(`_`,`.`):`.0`,t=i.minorVersion.replace(`.`,``).substr(0,2),i.flatVersion=i.majorVersion+t+Array(3-(t.length<3?t.length:2)).join(`0`),i.cordova=!0,i.appMode=window.navigator.standalone||/file|local|wmapp/.test(window.location.protocol)||i.cordova,i}return null},ct=e=>{let t=null,n=[];for(let r in it)if(it.hasOwnProperty(r)&&(n=e.match(it[r]),n)){t={},t[r]=!0,t[n[1].toLowerCase().split(` `)[0].split(`/`)[0]]=!0,t.version=parseInt(document.documentMode||n[2],10);break}return t},lt=tt()&&window.navigator?window.navigator.userAgent:null,ut=lt?ct(lt):null;lt&&st(lt),tt()&&`ontouchstart`in window,ut&&!ut.chrome&&window.MSPointerEvent,ut&&!ut.chrome&&window.PointerEvent;let dt={};dt.undefined=e=>e;let ft={};ft.undefined=e=>e;let{shadow:pt,AnnotationEditorType:y,FeatureTest:mt,setLayerDimensions:ht,AnnotationEditorParamsType:b,PixelsPerInch:gt,DOMSVGFactory:_t,PDFDateString:vt,Util:yt,XfaLayer:bt,getDocument:xt,AnnotationMode:St,AbortException:Ct,TextLayer:wt,fetchData:Tt,noContextMenu:Et}=window.pdfjsLib||{AnnotationEditorType:{DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15}},Dt=65535,Ot=268435456,kt=32767,At=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/Macintosh/i.test(navigator.userAgent),jt=e=>ct(e).safari||st(e)&&st(e).browser===`mobilesafari`,Mt=e=>{let t=ct(e),n=st(e);return t&&t.mozilla||n&&n.browser===`firefox`},Nt=1.25,Pt=(e=3)=>At()?devicePixelRatio:devicePixelRatio*(e||3),Ft=e=>atob(e.replace(/^(data:application\/pdf;base64,)/gi,``)),It=function(e,t,n){let r=document.createElement(e);return t&&(r.className=t),Object.keys(n).forEach(e=>r.style[e]=n[e]),r},Lt=(e,t)=>{let n=e.querySelectorAll(`.k-page`),r=n[0];if(r instanceof HTMLDivElement){let e=(r.offsetHeight+r.offsetTop)*Math.max(0,Math.min(t,n.length-1)),i=r.closest(`.k-pdf-viewer-canvas`);i&&i.scrollTo({top:e,behavior:`auto`})}},Rt=e=>{let t=e.querySelector(`.k-pdf-viewer-canvas`),n=e.querySelector(`.k-page:not(.k-blank-page)`);return t&&n?Math.floor(Math.round(t.scrollTop)/Math.max(1,n.offsetHeight+n.offsetTop)+.01):0},zt=(e,t)=>{let{maxWidth:n,maxHeight:r,maxArea:i}=Mt(navigator.userAgent)?{maxWidth:kt,maxHeight:kt,maxArea:124992400}:jt(navigator.userAgent)?{maxWidth:4194303,maxHeight:8388607,maxArea:Ot}:{maxWidth:Dt,maxHeight:Dt,maxArea:Ot},a=e,o=t,s=e/t;if(e>n&&(a=n,o=t-(e-n)/s),o>r){let e=(o-r)*s;o=r,a-=e}let c=a*o;if(c>i){let e=Math.sqrt(i/c);a*=e,o*=e}let l=a/e;return{adjustedWidth:a===e?e:Math.floor(a/2),adjustedHeight:o===t?t:Math.floor(o/2),adjustRatio:l===1?1:l/2}},Bt=e=>{let t=`.kendo-pdfviewer-common`,n=!1,r=new CSSStyleSheet;r.replaceSync(t+` { } .hiddenCanvasElement {
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 0;
        display: none;
    }`),!(!e||!e.adoptedStyleSheets)&&(e.adoptedStyleSheets.forEach(e=>{if(e.cssRules.length>0){let r=e.cssRules[0];r instanceof CSSStyleRule&&r.selectorText.indexOf(t)===0&&(n=!0)}}),n||e.adoptedStyleSheets.push(r))};var Vt=function(e,t){return Vt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Vt(e,t)},Ht=function(){return Ht=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ht.apply(this,arguments)};function x(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})}Object.create;function Ut(e){return this instanceof Ut?(this.v=e,this):new Ut(e)}Object.create;var Wt=function(e){return Wt=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},Wt(e)};function S(e,t,n,r){if(n===`a`&&!r)throw TypeError(`Private accessor was defined without a getter`);if(typeof t==`function`?e!==t||!r:!t.has(e))throw TypeError(`Cannot read private member from an object whose class did not declare it`);return n===`m`?r:n===`a`?r.call(e):r?r.value:t.get(e)}function C(e,t,n,r,i){if(r===`m`)throw TypeError(`Private method is not writable`);if(r===`a`&&!i)throw TypeError(`Private accessor was defined without a setter`);if(typeof t==`function`?e!==t||!i:!t.has(e))throw TypeError(`Cannot write private member to an object whose class did not declare it`);return r===`a`?i.call(e,n):i?i.value=n:t.set(e,n),n}let Gt=(e,t)=>{t.classList.add(e)},Kt=(e,t)=>{t.classList.remove(e)},qt=(e,t,n)=>Math.min(n,Math.max(t,e)),Jt=1.35;.35/Jt;let Yt={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Xt=`pdfjs_internal_editor_`,Zt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Qt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},$t={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};function en(e,t,n,r=!1){return Object.defineProperty(e,t,{value:n,enumerable:!r,configurable:!0,writable:!1}),n}function tn(e){let t=Object.create(null);for(let[n,r]of e)t[n]=r;return t}let nn=Array.from(Array(256).keys(),e=>e.toString(16).padStart(2,`0`));var rn=class{static makeHexColor(e,t,n){return`${nn[e]}${nn[t]}${nn[n]}`}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}};let an=`pdfjs_internal_id_`;var on,sn=class{constructor(e=Xt){on.set(this,0),this.idPrefix=Xt,Object.defineProperty(this,`reset`,{value:()=>C(this,on,0,`f`)}),this.idPrefix=e}get id(){var e,t;return`${this.idPrefix}${C(this,on,(t=S(this,on,`f`),e=t++,t),`f`),e}`}};on=new WeakMap;var w,cn,ln,T,un=class{constructor(e=128){w.set(this,[]),cn.set(this,!1),ln.set(this,void 0),T.set(this,-1),C(this,ln,e,`f`)}add({cmd:e,undo:t,post:n,mustExec:r,type:i=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(r&&e(),S(this,cn,`f`))return;let s={cmd:e,undo:t,post:n,type:i};if(S(this,T,`f`)===-1){S(this,w,`f`).length>0&&(S(this,w,`f`).length=0),C(this,T,0,`f`),S(this,w,`f`).push(s);return}if(a&&S(this,w,`f`)[S(this,T,`f`)].type===i){o&&(s.undo=S(this,w,`f`)[S(this,T,`f`)].undo),S(this,w,`f`)[S(this,T,`f`)]=s;return}let c=S(this,T,`f`)+1;c===S(this,ln,`f`)?S(this,w,`f`).splice(0,1):(C(this,T,c,`f`),c<S(this,w,`f`).length&&S(this,w,`f`).splice(c)),S(this,w,`f`).push(s)}undo(){if(S(this,T,`f`)===-1)return;C(this,cn,!0,`f`);let{undo:e,post:t}=S(this,w,`f`)[S(this,T,`f`)];e(),t?.(),C(this,cn,!1,`f`),C(this,T,S(this,T,`f`)-1,`f`)}redo(){if(S(this,T,`f`)<S(this,w,`f`).length-1){C(this,T,S(this,T,`f`)+1,`f`),C(this,cn,!0,`f`);let{cmd:e,post:t}=S(this,w,`f`)[S(this,T,`f`)];e(),t?.(),C(this,cn,!1,`f`)}}hasSomethingToUndo(){return S(this,T,`f`)!==-1}hasSomethingToRedo(){return S(this,T,`f`)<S(this,w,`f`).length-1}destroy(){C(this,w,null,`f`)}};w=new WeakMap,cn=new WeakMap,ln=new WeakMap,T=new WeakMap;var E,dn,D,O,k,fn,pn,mn,hn,gn,_n,vn,yn,bn,xn,Sn,Cn,wn,Tn,En,Dn,On,kn,A,j,An,jn,Mn,Nn,Pn,Fn,In,Ln,Rn,zn,Bn,Vn,Hn,Un,Wn,Gn,Kn,qn,Jn,Yn,M,Xn,Zn,Qn,$n,er,tr,nr,rr=class{constructor({container:e=null,viewer:t,pdfViewer:n,eventBus:r,pdfDocument:i,highlightColors:a=``}){E.add(this),this.pdfViewer=null,this.annotationEditorMode=y.NONE,this.viewParameters={},this.isShiftKeyDown=!1,this._eventBus=null,dn.set(this,new AbortController),D.set(this,null),O.set(this,new Map),k.set(this,new Map),fn.set(this,null),pn.set(this,null),mn.set(this,new un),hn.set(this,0),gn.set(this,new Set),_n.set(this,null),vn.set(this,null),yn.set(this,new Set),bn.set(this,!0),xn.set(this,null),Sn.set(this,null),Cn.set(this,``),wn.set(this,!1),Tn.set(this,null),En.set(this,new sn),Dn.set(this,!1),On.set(this,!1),kn.set(this,null),A.set(this,y.NONE),j.set(this,new Set),An.set(this,null),jn.set(this,null),Mn.set(this,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1}),Nn.set(this,[0,0]),Pn.set(this,null),Fn.set(this,null),In.set(this,null);let o=this._signal=S(this,dn,`f`).signal;C(this,Fn,e,`f`),C(this,In,t,`f`),this.pdfViewer=n,this._eventBus=r,this._eventBus._on(`editingaction`,this.onEditingAction.bind(this),{signal:o}),this._eventBus._on(`pagechanging`,this.onPageChanging.bind(this),{signal:o}),this._eventBus._on(`scalechanging`,this.onScaleChanging.bind(this),{signal:o}),this._eventBus._on(`rotationchanging`,this.onRotationChanging.bind(this),{signal:o}),this._eventBus._on(`setpreference`,this.onSetPreference.bind(this),{signal:o}),this._eventBus._on(`namedaction`,this.onNamedAction.bind(this),{signal:o}),S(this,E,`m`,Hn).call(this),S(this,E,`m`,Yn).call(this),S(this,E,`m`,Gn).call(this),C(this,fn,i.annotationStorage,`f`),C(this,Cn,a||``,`f`),this.viewParameters={realScale:gt.PDF_TO_CSS_UNITS,rotation:0}}destroy(){S(this,dn,`f`)?.abort(),C(this,dn,null,`f`),this._signal=null;for(let e of S(this,k,`f`).values())e.destroy();S(this,k,`f`).clear(),S(this,O,`f`).clear(),S(this,yn,`f`).clear(),C(this,D,null,`f`),S(this,j,`f`).clear(),S(this,mn,`f`).destroy(),S(this,xn,`f`)&&(clearTimeout(S(this,xn,`f`)),C(this,xn,null,`f`)),S(this,Pn,`f`)&&(clearTimeout(S(this,Pn,`f`)),C(this,Pn,null,`f`))}getTextLayerForAnchor(e){return e?e.closest(`.textLayer`)||e.closest(`.k-text-layer`):null}combinedSignal(e){return AbortSignal&&AbortSignal.any?AbortSignal.any([this._signal,e.signal]):this._signal||e.signal}get direction(){return pt(this,`direction`,getComputedStyle(S(this,Fn,`f`)).direction)}get highlightColors(){return pt(this,`highlightColors`,S(this,Cn,`f`)?new Map:null)}get highlightColorNames(){return pt(this,`highlightColorNames`,this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}switchToMode(e,t){this._eventBus.on(`annotationeditormodechanged`,t,{once:!0,signal:this._signal,mode:e}),this._eventBus.dispatch(`showannotationeditorui`,{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch(`setpreference`,{source:this,name:e,value:t})}onSetPreference({name:e}){switch(e){case`enableNewAltTextWhenAddingImage`:break;default:break}}onNamedAction(e){switch(e.action){case`Print`:this.triggerPrinting();break;case`SaveAs`:this.downloadOrSave();break}}onPageChanging({pageNumber:e}){C(this,hn,e-1,`f`)}focusMainContainer(){S(this,Fn,`f`)?.focus()}findParent(e,t){for(let n of S(this,k,`f`).values()){let{x:r,y:i,width:a,height:o}=n.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=i&&t<=i+o)return n}return null}triggerPrinting(){this.pdfViewer?.printFile()}downloadOrSave(){this.pdfViewer?.downloadFile({fileName:this.pdfViewer?.options.downloadFileName})}disableUserSelect(e=!1){S(this,In,`f`)?.classList.toggle(`noUserSelect`,e)}addShouldRescale(e){S(this,yn,`f`).add(e)}removeShouldRescale(e){S(this,yn,`f`).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*gt.PDF_TO_CSS_UNITS;for(let e of S(this,yn,`f`))e.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=``){let t=document.getSelection();if(!t||t.isCollapsed)return;let{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a}=t,o=t.toString(),s=S(this,E,`m`,Ln).call(this,t),c=this.getTextLayerForAnchor(s),l=this.getSelectionBoxes(c);if(!l)return;t.empty();let u=S(this,E,`m`,Rn).call(this,c),d=S(this,A,`f`)===y.NONE,f=()=>{u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:l,anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a,text:o}),d&&this.showAllEditors(`highlight`,!0)};if(d){this.switchToMode(y.HIGHLIGHT,f);return}f()}showEditorToolBar(e){if(!e)return;let t=this.getMode();t!==y.HIGHLIGHT&&t!==y.FREETEXT||this._eventBus.dispatch(`kendoAnnotationEditorToolBarShow`,{source:this,anchor:e})}hideEditorToolBar(){this._eventBus.dispatch(`kendoAnnotationEditorToolBarHide`,{source:this})}addToAnnotationStorage(e){!e.isEmpty()&&S(this,fn,`f`)&&!S(this,fn,`f`).has(e.id)&&S(this,fn,`f`).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,S(this,wn,`f`)&&(C(this,wn,!1,`f`),S(this,E,`m`,Vn).call(this,`main_toolbar`)),!this.hasSelection)return;let{activeElement:e}=document;for(let t of S(this,j,`f`))if(t.div.contains(e)){C(this,kn,[t,e],`f`),t._focusEventsAllowed=!1;break}}focus(){if(!S(this,kn,`f`))return;let[e,t]=S(this,kn,`f`);C(this,kn,null,`f`),t.addEventListener(`focusin`,()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){S(this,E,`m`,Gn).call(this),S(this,E,`m`,qn).call(this)}removeEditListeners(){S(this,E,`m`,Kn).call(this),S(this,E,`m`,Jn).call(this)}dragOver(e){for(let{type:t}of e.dataTransfer.items)for(let n of S(this,vn,`f`))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect=`copy`,e.preventDefault();return}}drop(e){for(let t of e.dataTransfer.items)for(let n of S(this,vn,`f`))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),S(this,D,`f`)?.commitOrRemove(),!this.hasSelection)return;let t=[];for(let e of S(this,j,`f`)){let n=e.serialize(!0);n&&t.push(n)}t.length!==0&&e.clipboardData.setData(`application/pdfjs`,JSON.stringify(t))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();let{clipboardData:t}=e;for(let e of t.items)for(let t of S(this,vn,`f`))if(t.isHandlingMimeForPasting(e.type)){t.paste(e,this.currentLayer);return}let n=t.getData(`application/pdfjs`);if(!n)return;try{n=JSON.parse(n)}catch{return}if(!Array.isArray(n))return;this.unselectAll();let r=this.currentLayer;try{let e=[];for(let t of n){let n=r.deserialize(t);if(!n)return;e.push(n)}this.addCommands({cmd:()=>{for(let t of e)S(this,E,`m`,$n).call(this,t);S(this,E,`m`,nr).call(this,e)},undo:()=>{for(let t of e)t.remove()},mustExec:!0})}catch{}}onEditingAction({name:e}){switch(e){case`undo`:case`redo`:case`delete`:case`selectAll`:this[e]();break;case`highlightSelection`:this.highlightSelection(`context_menu`);break;default:break}}setEditingState(e){e?(S(this,E,`m`,Un).call(this),S(this,E,`m`,qn).call(this),S(this,E,`m`,M).call(this,{isEditing:S(this,A,`f`)!==y.NONE,isEmpty:S(this,E,`m`,tr).call(this),hasSomethingToUndo:S(this,mn,`f`).hasSomethingToUndo(),hasSomethingToRedo:S(this,mn,`f`).hasSomethingToRedo(),hasSelectedEditor:!1})):(S(this,E,`m`,Wn).call(this),S(this,E,`m`,Jn).call(this),S(this,E,`m`,M).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!S(this,vn,`f`)){C(this,vn,e,`f`);for(let e of S(this,vn,`f`))S(this,E,`m`,Xn).call(this,e.defaultPropertiesToUpdate)}}getId(){return S(this,En,`f`).id}get currentLayer(){return S(this,k,`f`).get(S(this,hn,`f`))}getLayer(e){return S(this,k,`f`).get(e)}get currentPageIndex(){return S(this,hn,`f`)}addLayer(e){S(this,k,`f`).set(e.pageIndex,e),S(this,Dn,`f`)?e.enable():e.disable()}removeLayer(e){S(this,k,`f`).delete(e.pageIndex)}updateMode(e,t=null,n=!1){if(S(this,A,`f`)!==e){if(C(this,A,e,`f`),e===y.NONE){this.setEditingState(!1),S(this,E,`m`,Qn).call(this);return}this.setEditingState(!0),S(this,E,`m`,Zn).call(this),this.unselectAll();for(let t of S(this,k,`f`).values())t.updateMode(e);if(!t&&n){this.addNewEditorFromKeyboard();return}if(t){for(let e of S(this,O,`f`).values())if(e.annotationElementId===t){this.setSelected(e),e.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==S(this,A,`f`)&&this._eventBus.dispatch(`switchannotationeditormode`,{source:this,mode:e})}updateParams(e,t){if(S(this,vn,`f`)){switch(e){case b.CREATE:this.currentLayer.addNewEditor();return;case b.HIGHLIGHT_DEFAULT_COLOR:break;case b.HIGHLIGHT_SHOW_ALL:C(this,jn,S(this,jn,`f`)||new Map,`f`).set(e,t),this.showAllEditors(`highlight`,t);break;default:break}for(let n of S(this,j,`f`))n.updateParams(e,t);for(let n of S(this,vn,`f`))n.updateDefaultParams(e,t)}}showAllEditors(e,t){for(let n of S(this,O,`f`).values())n.editorType===e&&n.show(t);(S(this,jn,`f`)?.get(b.HIGHLIGHT_SHOW_ALL)??!0)!==t&&S(this,E,`m`,Xn).call(this,[[b.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(S(this,On,`f`)!==e){C(this,On,e,`f`);for(let t of S(this,k,`f`).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle(`waiting`,e)}}getEditors(e){let t=[];for(let n of S(this,O,`f`).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return S(this,O,`f`).get(e)}addEditor(e){S(this,O,`f`).set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(S(this,xn,`f`)&&clearTimeout(S(this,xn,`f`)),C(this,xn,setTimeout(()=>{this.focusMainContainer(),C(this,xn,null,`f`)},0),`f`)),S(this,O,`f`).delete(e.id),this.unselect(e),(!e.annotationElementId||!S(this,gn,`f`).has(e.annotationElementId))&&S(this,fn,`f`)?.remove(e.id)}addDeletedAnnotationElement(e){S(this,gn,`f`).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return S(this,gn,`f`).has(e)}removeDeletedAnnotationElement(e){S(this,gn,`f`).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){S(this,D,`f`)!==e&&(C(this,D,e,`f`),e&&S(this,E,`m`,Xn).call(this,e.propertiesToUpdate))}updateUI(e){S(this,E,`a`,er)===e&&S(this,E,`m`,Xn).call(this,e.propertiesToUpdate)}toggleSelected(e){if(S(this,j,`f`).has(e)){S(this,j,`f`).delete(e),e.unselect(),S(this,E,`m`,M).call(this,{hasSelectedEditor:this.hasSelection});return}S(this,j,`f`).add(e),e.select(),S(this,E,`m`,Xn).call(this,e.propertiesToUpdate),S(this,E,`m`,M).call(this,{hasSelectedEditor:!0})}setSelected(e){for(let t of S(this,j,`f`))t!==e&&t.unselect();S(this,j,`f`).clear(),S(this,j,`f`).add(e),e.select(),S(this,E,`m`,Xn).call(this,e.propertiesToUpdate),S(this,E,`m`,M).call(this,{hasSelectedEditor:!0})}isSelected(e){return S(this,j,`f`).has(e)}get firstSelectedEditor(){return S(this,j,`f`).values().next().value}unselect(e){e.unselect(),S(this,j,`f`).delete(e),S(this,E,`m`,M).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return S(this,j,`f`).size!==0}get isEnterHandled(){return S(this,j,`f`).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){S(this,mn,`f`).undo(),S(this,E,`m`,M).call(this,{hasSomethingToUndo:S(this,mn,`f`).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:S(this,E,`m`,tr).call(this)})}redo(){S(this,mn,`f`).redo(),S(this,E,`m`,M).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:S(this,mn,`f`).hasSomethingToRedo(),isEmpty:S(this,E,`m`,tr).call(this)})}addCommands(e){S(this,mn,`f`).add(e),S(this,E,`m`,M).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:S(this,E,`m`,tr).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;let e=[...S(this,j,`f`)];this.addCommands({cmd:()=>{for(let t of e)t.remove()},undo:()=>{for(let t of e)S(this,E,`m`,$n).call(this,t)},mustExec:!0})}commitOrRemove(){S(this,D,`f`)?.commitOrRemove()}hasSomethingToControl(){return S(this,D,`f`)||this.hasSelection}selectAll(){for(let e of S(this,j,`f`))e.commit();S(this,E,`m`,nr).call(this,S(this,O,`f`).values())}unselectAll(){if(!(S(this,D,`f`)&&(S(this,D,`f`).commitOrRemove(),S(this,A,`f`)!==y.NONE))&&this.hasSelection){for(let e of S(this,j,`f`))e.unselect();S(this,j,`f`).clear(),S(this,E,`m`,M).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;S(this,Nn,`f`)[0]+=e,S(this,Nn,`f`)[1]+=t;let[r,i]=S(this,Nn,`f`),a=[...S(this,j,`f`)];S(this,Pn,`f`)&&clearTimeout(S(this,Pn,`f`)),C(this,Pn,setTimeout(()=>{C(this,Pn,null,`f`),S(this,Nn,`f`)[0]=S(this,Nn,`f`)[1]=0,this.addCommands({cmd:()=>{for(let e of a)S(this,O,`f`).has(e.id)&&e.translateInPage(r,i)},undo:()=>{for(let e of a)S(this,O,`f`).has(e.id)&&e.translateInPage(-r,-i)},mustExec:!1})},1e3),`f`);for(let n of a)n.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),C(this,_n,new Map,`f`);for(let e of S(this,j,`f`))S(this,_n,`f`).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!S(this,_n,`f`))return!1;this.disableUserSelect(!1);let e=S(this,_n,`f`);C(this,_n,null,`f`);let t=!1;for(let[{x:n,y:r,pageIndex:i},a]of e)a.newX=n,a.newY=r,a.newPageIndex=i,t||=n!==a.savedX||r!==a.savedY||i!==a.savedPageIndex;if(!t)return!1;let n=(e,t,n,r)=>{if(S(this,O,`f`).has(e.id)){let i=S(this,k,`f`).get(r);i?e._setParentAndPosition(i,t,n):(e.pageIndex=r,e.x=t,e.y=n)}};return this.addCommands({cmd:()=>{for(let[t,{newX:r,newY:i,newPageIndex:a}]of e)n(t,r,i,a)},undo:()=>{for(let[t,{savedX:r,savedY:i,savedPageIndex:a}]of e)n(t,r,i,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(S(this,_n,`f`))for(let n of S(this,_n,`f`).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){let t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return S(this,D,`f`)===e}getActive(){return S(this,D,`f`)}getActiveEditor(){return S(this,D,`f`)}getMode(){return S(this,A,`f`)}getSelectionBoxes(e){if(!e)return null;let t=document.getSelection();for(let n=0,r=t.rangeCount;n<r;n++)if(!e.contains(t.getRangeAt(n).commonAncestorContainer))return null;let{x:n,y:r,width:i,height:a}=e.getBoundingClientRect(),o;switch(e.getAttribute(`data-main-rotation`)){case`90`:o=(e,t,o,s)=>({x:(t-r)/a,y:1-(e+o-n)/i,width:s/a,height:o/i});break;case`180`:o=(e,t,o,s)=>({x:1-(e+o-n)/i,y:1-(t+s-r)/a,width:o/i,height:s/a});break;case`270`:o=(e,t,o,s)=>({x:1-(t+s-r)/a,y:(e-n)/i,width:s/a,height:o/i});break;default:o=(e,t,o,s)=>({x:(e-n)/i,y:(t-r)/a,width:o/i,height:s/a});break}let s=[];for(let e=0,n=t.rangeCount;e<n;e++){let n=t.getRangeAt(e);if(!n.collapsed)for(let{x:e,y:t,width:r,height:i}of n.getClientRects())r===0||i===0||s.push(o(e,t,r,i))}return s.length===0?null:s}addChangedExistingAnnotation({annotationElementId:e,id:t}){C(this,pn,S(this,pn,`f`)||new Map,`f`).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){S(this,pn,`f`)?.delete(e)}renderAnnotationElement(e){let t=S(this,pn,`f`)?.get(e.data.id);if(!t)return;let n=S(this,fn,`f`).getRawValue(t);n&&(S(this,A,`f`)===y.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}};dn=new WeakMap,D=new WeakMap,O=new WeakMap,k=new WeakMap,fn=new WeakMap,pn=new WeakMap,mn=new WeakMap,hn=new WeakMap,gn=new WeakMap,_n=new WeakMap,vn=new WeakMap,yn=new WeakMap,bn=new WeakMap,xn=new WeakMap,Sn=new WeakMap,Cn=new WeakMap,wn=new WeakMap,Tn=new WeakMap,En=new WeakMap,Dn=new WeakMap,On=new WeakMap,kn=new WeakMap,A=new WeakMap,j=new WeakMap,An=new WeakMap,jn=new WeakMap,Mn=new WeakMap,Nn=new WeakMap,Pn=new WeakMap,Fn=new WeakMap,In=new WeakMap,E=new WeakSet,Ln=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Rn=function(e){let{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(let t of S(this,k,`f`).values())if(t.hasTextLayer(e))return t;return null},zn=function(){let e=document.getSelection();if(!e||e.isCollapsed)return;let t=S(this,E,`m`,Ln).call(this,e),n=this.getTextLayerForAnchor(t);this.getSelectionBoxes(n)&&this.showEditorToolBar(t)},Bn=function(){let e=document.getSelection();if(!e||e.isCollapsed){S(this,An,`f`)&&(C(this,An,null,`f`),S(this,E,`m`,M).call(this,{hasSelectedText:!1}));return}let{anchorNode:t}=e;if(t===S(this,An,`f`))return;let n=S(this,E,`m`,Ln).call(this,e),r=this.getTextLayerForAnchor(n);if(!r){S(this,An,`f`)&&(S(this,Tn,`f`)?.hide(),C(this,An,null,`f`),S(this,E,`m`,M).call(this,{hasSelectedText:!1}));return}if(S(this,Tn,`f`)?.hide(),C(this,An,t,`f`),S(this,E,`m`,M).call(this,{hasSelectedText:!0}),!(S(this,A,`f`)!==y.HIGHLIGHT&&S(this,A,`f`)!==y.NONE)&&(S(this,A,`f`)===y.HIGHLIGHT&&this.showAllEditors(`highlight`,!0),!this.isShiftKeyDown)){let e=S(this,A,`f`)===y.HIGHLIGHT?S(this,E,`m`,Rn).call(this,r):null;e?.toggleDrawing();let t=new AbortController,n=this.combinedSignal(t),i=n=>{n.type===`pointerup`&&n.button!==0||(t.abort(),e?.toggleDrawing(!0),n.type===`pointerup`&&S(this,E,`m`,Vn).call(this,`main_toolbar`))};window.removeEventListener(`pointerup`,i),window.addEventListener(`pointerup`,i,{signal:n}),window.removeEventListener(`blur`,i),window.addEventListener(`blur`,i,{signal:n})}},Vn=function(e=``){S(this,A,`f`)===y.HIGHLIGHT?this.highlightSelection(e):S(this,bn,`f`)&&S(this,E,`m`,zn).call(this)},Hn=function(){document.addEventListener(`selectionchange`,S(this,E,`m`,Bn).bind(this),{signal:this._signal})},Un=function(){if(S(this,Sn,`f`))return;C(this,Sn,new AbortController,`f`);let e=this.combinedSignal(S(this,Sn,`f`));window.addEventListener(`focus`,this.focus.bind(this),{signal:e}),window.addEventListener(`blur`,this.blur.bind(this),{signal:e})},Wn=function(){S(this,Sn,`f`)?.abort(),C(this,Sn,null,`f`)},Gn=function(){},Kn=function(){},qn=function(){},Jn=function(){},Yn=function(){let e=this._signal;document.addEventListener(`dragover`,this.dragOver.bind(this),{signal:e}),document.addEventListener(`drop`,this.drop.bind(this),{signal:e})},M=function(e){e&&Object.entries(e).some(([e,t])=>S(this,Mn,`f`)[e]!==t)&&(this._eventBus.dispatch(`annotationeditorstateschanged`,{source:this,details:Object.assign(S(this,Mn,`f`),e)}),S(this,A,`f`)===y.HIGHLIGHT&&e.hasSelectedEditor===!1&&S(this,E,`m`,Xn).call(this,[[b.HIGHLIGHT_FREE,!0]]))},Xn=function(e){this._eventBus.dispatch(`annotationeditorparamschanged`,{source:this,details:e})},Zn=function(){if(!S(this,Dn,`f`)){C(this,Dn,!0,`f`);for(let e of S(this,k,`f`).values())e.enable();for(let e of S(this,O,`f`).values())e.enable()}},Qn=function(){if(this.unselectAll(),S(this,Dn,`f`)){C(this,Dn,!1,`f`);for(let e of S(this,k,`f`).values())e.disable();for(let e of S(this,O,`f`).values())e.disable()}},$n=function(e){let t=S(this,k,`f`).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},er=function(){let e=null;for(e of S(this,j,`f`));return e},tr=function(){if(S(this,O,`f`).size===0)return!0;if(S(this,O,`f`).size===1)for(let e of S(this,O,`f`).values())return e.isEmpty();return!1},nr=function(e){for(let e of S(this,j,`f`))e.unselect();S(this,j,`f`).clear();for(let t of e)t.isEmpty()||(S(this,j,`f`).add(t),t.select());S(this,E,`m`,M).call(this,{hasSelectedEditor:this.hasSelection})},rr.TRANSLATE_SMALL=1,rr.TRANSLATE_BIG=10;var ir,ar=class{constructor(){ir.set(this,Object.create(null))}getListeners(){return S(this,ir,`f`)}on(e,t,n=null){this._on(e,t,{external:!0,once:n?.once,signal:n?.signal})}off(e,t){this._off(e,t)}dispatch(e,t){let n=S(this,ir,`f`)[e];if(!n||n.length===0)return;let r;for(let{listener:i,external:a,once:o}of n.slice(0)){if(o&&this._off(e,i),a){(r||=[]).push(i);continue}i(t)}if(r){for(let e of r)e(t);r=null}}_on(e,t,n=null){var r;let i=null;if(n?.signal instanceof AbortSignal){let{signal:r}=n;if(r.aborted)return;let a=()=>this._off(e,t);i=()=>r.removeEventListener(`abort`,a),r.addEventListener(`abort`,a)}((r=S(this,ir,`f`))[e]||(r[e]=[])).push({listener:t,external:n?.external===!0,once:n?.once===!0,rmAbort:i})}_off(e,t){let n=S(this,ir,`f`)[e];if(n)for(let e=0,r=n.length;e<r;e++){let r=n[e];if(r.listener===t){r.rmAbort?.call(r),n.splice(e,1);return}}}};ir=new WeakMap;let or={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3},sr={UNKNOWN:0,NORMAL:1,CHANGING:2,FULLSCREEN:3},cr={DISABLE:0,ENABLE:1,ENABLE_PERMISSIONS:2},lr={UNKNOWN:-1,VERTICAL:0,HORIZONTAL:1,WRAPPED:2,PAGE:3};function ur(e,t,n=!1){let r=e.offsetParent;if(!r){console.error(`offsetParent is not set -- cannot scroll`);return}let i=e.offsetTop+e.clientTop,a=e.offsetLeft+e.clientLeft;for(;r.clientHeight===r.scrollHeight&&r.clientWidth===r.scrollWidth||n&&(r.classList.contains(`markedContent`)||r.classList.contains(`k-marked-content`)||getComputedStyle(r).overflow===`hidden`);)if(i+=r.offsetTop,a+=r.offsetLeft,r=r.offsetParent,!r)return;t&&(t.top!==void 0&&(i+=t.top),t.left!==void 0&&(a+=t.left,r.scrollLeft=a)),r.scrollTop=i}function dr(e){let t=new Map,n=new URLSearchParams(e);for(let[e,r]of n)t.set(e.toLowerCase(),r);return t}function fr(e,t,n=0){let r=n,i=e.length-1;if(i<0||!t(e[i]))return e.length;if(t(e[r]))return r;for(;r<i;){let n=r+i>>1,a=e[n];t(a)?i=n:r=n+1}return r}var pr,mr,hr,gr,_r,vr,yr,br,xr=class{constructor(){pr.add(this),hr.set(this,!1),gr.set(this,null),_r.set(this,new Map),vr.set(this,new Map)}setTextMapping(e){C(this,gr,e,`f`)}enable(){if(S(this,hr,`f`),!S(this,gr,`f`))throw Error(`Text divs and strings have not been set.`);if(C(this,hr,!0,`f`),C(this,gr,S(this,gr,`f`).slice(),`f`),S(this,gr,`f`).sort(S(mr,mr,`m`,yr)),S(this,_r,`f`).size>0){let e=S(this,gr,`f`);for(let[t,n]of S(this,_r,`f`)){if(!document.getElementById(t)){S(this,_r,`f`).delete(t);continue}S(this,pr,`m`,br).call(this,t,e[n])}}for(let[e,t]of S(this,vr,`f`))this.addPointerInTextLayer(e,t);S(this,vr,`f`).clear()}disable(){S(this,hr,`f`)&&(S(this,vr,`f`).clear(),C(this,gr,null,`f`),C(this,hr,!1,`f`))}removePointerInTextLayer(e){if(!S(this,hr,`f`)){S(this,vr,`f`).delete(e);return}let t=S(this,gr,`f`);if(!t||t.length===0)return;let{id:n}=e,r=S(this,_r,`f`).get(n);if(r===void 0)return;let i=t[r];S(this,_r,`f`).delete(n);let a=i.getAttribute(`aria-owns`);a?.includes(n)&&(a=a.split(` `).filter(e=>e!==n).join(` `),a?i.setAttribute(`aria-owns`,a):(i.removeAttribute(`aria-owns`),i.setAttribute(`role`,`presentation`)))}addPointerInTextLayer(e,t){if(!e){console.warn(`no element`);return}let{id:n}=e;if(!n)return null;if(!S(this,hr,`f`))return S(this,vr,`f`).set(e,t),null;t&&this.removePointerInTextLayer(e);let r=S(this,gr,`f`);if(!r||r.length===0)return null;let i=fr(r,t=>S(mr,mr,`m`,yr).call(mr,e,t)<0),a=Math.max(0,i-1),o=r[a];S(this,pr,`m`,br).call(this,n,o),S(this,_r,`f`).set(n,a);let s=o.parentNode;return s?.classList.contains(`markedContent`)||s?.classList.contains(`k-marked-content`)?s.id:null}moveElementInDOM(e,t,n,r){let i=this.addPointerInTextLayer(n,r);if(!e.hasChildNodes())return e.append(t),i;let a=Array.from(e.children).filter(e=>e!==t);if(a.length===0)return i;let o=n||t,s=fr(a,e=>S(mr,mr,`m`,yr).call(mr,o,e)<0);return s===0?a[0].before(t):a[s-1].after(t),i}destroy(){C(this,_r,new Map,`f`),C(this,vr,new Map,`f`),C(this,gr,null,`f`)}};mr=xr,hr=new WeakMap,gr=new WeakMap,_r=new WeakMap,vr=new WeakMap,pr=new WeakSet,yr=function(e,t){let n=e.getBoundingClientRect(),r=t.getBoundingClientRect();if(n.width===0&&n.height===0)return 1;if(r.width===0&&r.height===0)return-1;let i=n.y,a=n.y+n.height,o=n.y+n.height/2,s=r.y,c=r.y+r.height,l=r.y+r.height/2;return o<=s&&l>=a?-1:l<=i&&o>=c?1:n.x+n.width/2-(r.x+r.width/2)},br=function(e,t){let n=t.getAttribute(`aria-owns`);n?.includes(e)||t.setAttribute(`aria-owns`,n?`${n} ${e}`:e),t.removeAttribute(`role`)};var Sr,N,Cr,wr,Tr,Er,Dr,Or,kr,Ar=class{constructor({pdfPage:e,accessibilityManager:t,styles:n,onAppend:r=null}){Sr.add(this),this.pdfPage=null,this.div=null,this.accessibilityManager=null,Cr.set(this,null),wr.set(this,null),this.pdfPage=e,this.accessibilityManager=t,C(this,Cr,r,`f`),this.div=document.createElement(`div`),this.div.tabIndex=0,this.div.classList.add(`k-text-layer`),Object.keys(n).forEach(e=>this.div.style[e]=n[e])}render(e){return x(this,arguments,void 0,function*(e,t=null){if(S(this,wr,`f`)){S(this,wr,`f`).update({viewport:e,onBefore:this.hide.bind(this)}),this.show();return}this.cancel(),C(this,wr,new wt({textContentSource:this.pdfPage.streamTextContent(t||{includeMarkedContent:!1,disableNormalization:!0}),container:this.div,viewport:e}),`f`);let{textDivs:n}=S(this,wr,`f`);this.accessibilityManager?.setTextMapping(n),yield S(this,wr,`f`).render();let r=Array.from(this.div.querySelectorAll(`.markedContent`)||[])||[];if(r.forEach(e=>Gt(`k-marked-content`,e)),r&&r.length>0){let e=document.createElement(`div`);e.className=`endOfContent`,this.div.append(e),S(this,Sr,`m`,Dr).call(this,e)}S(this,Cr,`f`)?.call(this,this.div),this.accessibilityManager?.enable()})}hide(){this.div.hidden||(this.div.hidden=!0)}show(){this.div.hidden&&(this.div.hidden=!1)}cancel(){S(this,wr,`f`)?.cancel(),C(this,wr,null,`f`),this.accessibilityManager?.disable(),this.accessibilityManager?.destroy(),S(N,N,`m`,Or).call(N,this.div)}destroy(){wt.cleanup(),this.cancel(),this.pdfPage=null,this.accessibilityManager?.destroy(),this.accessibilityManager=null,this.div?.remove(),this.div=null}};N=Ar,Cr=new WeakMap,wr=new WeakMap,Sr=new WeakSet,Dr=function(e){let{div:t}=this;S(N,N,`f`,Tr).set(t,e),S(N,N,`m`,kr).call(N)},Or=function(e){S(this,N,`f`,Tr).delete(e),S(this,N,`f`,Tr).size===0&&(S(this,N,`f`,Er)?.abort(),C(this,N,null,`f`,Er))},kr=function(){},Tr={value:new Map},Er={value:null};function jr(e){return Math.floor(Math.max(0,Math.min(1,e))*255).toString(16).padStart(2,`0`)}function Mr(e){return Math.max(0,Math.min(255,255*e))}var Nr=class{static CMYK_G([e,t,n,r]){return[`G`,1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return[`CMYK`,0,0,0,1-e]}static G_RGB([e]){return[`RGB`,e,e,e]}static G_rgb([e]){return e=Mr(e),[e,e,e]}static G_HTML([e]){let t=jr(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return[`G`,.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(Mr)}static RGB_HTML(e){return`#${e.map(jr).join(``)}`}static T_HTML(){return`#00000000`}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return[`RGB`,1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[Mr(1-Math.min(1,e+r)),Mr(1-Math.min(1,n+r)),Mr(1-Math.min(1,t+r))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){let r=1-e,i=1-t,a=1-n;return[`CMYK`,r,i,a,Math.min(r,i,a)]}};function Pr(e){if(e.startsWith(`#`)){let t=parseInt(e.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return e.startsWith(`rgb(`)?e.slice(4,-1).split(`,`).map(e=>parseInt(e,10)):e.startsWith(`rgba(`)?e.slice(5,-1).split(`,`).map(e=>parseInt(e,10)).slice(0,3):[0,0,0]}function Fr(e){let t=document.createElement(`span`);t.style.visibility=`hidden`,document.body.append(t);for(let n of e.keys()){t.style.color=n;let r=window.getComputedStyle(t).color;e.set(n,Pr(r))}t.remove()}var Ir=class e{get _colors(){if(typeof document>`u`)return en(this,`_colors`,e._colorsMapping);let t=new Map([[`CanvasText`,null],[`Canvas`,null]]);return Fr(t),en(this,`_colors`,t)}convert(t){let n=Pr(t);if(!window.matchMedia(`(forced-colors: active)`).matches)return n;for(let[t,r]of this._colors)if(r.every((e,t)=>e===n[t]))return e._colorsMapping.get(t);return n}getHexCode(e){let t=this._colors.get(e);return t?rn.makeHexColor(...t):e}};Ir._colorsMapping=new Map([[`CanvasText`,[0,0,0]],[`Canvas`,[255,255,255]]]);function Lr(e,t,n){for(let r of n)t.addEventListener(r,e[r].bind(e))}var Rr,zr,Br,Vr,Hr,Ur,Wr,Gr,Kr,qr,Jr,Yr,Xr,Zr,Qr,$r,ei,ti,ni,ri,ii,ai,P=class{constructor(e){Rr.add(this),this.parent=null,this.id=null,this.width=null,this.height=null,this.pageIndex=0,this.name=``,this.div=null,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._structTreeParentId=null,this.rotation=0,this.pageRotation=0,this.pageDimensions=[],this.pageTranslation=[],Br.set(this,0),Vr.set(this,0),this.isAttachedToDOM=!1,this.deleted=!1,Hr.set(this,!1),Ur.set(this,!1),Wr.set(this,null),Gr.set(this,!1),Kr.set(this,null),qr.set(this,!1),Jr.set(this,!1),Yr.set(this,null),Xr.set(this,0),Zr.set(this,0),this._editToolbar=null,this._initialOptions=Object.create(null),this._isVisible=!0,this._uiManager=null,this._focusEventsAllowed=!0,this._l10nPromise=null,Qr.set(this,!1),$r.set(this,zr._zIndex++),this.parent=e.parent,this.id=e.id||zr.idManager.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:i,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[i,a];let[o,s]=this.parentDimensions;this.x=e.x/o,this.y=e.y/s,this.isAttachedToDOM=!1,this.deleted=!1}get x(){return S(this,Br,`f`)}set x(e){C(this,Br,e,`f`)}get y(){return S(this,Vr,`f`)}set y(e){C(this,Vr,e,`f`)}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return pt(this,`_defaultLineColor`,this._colorManager.getHexCode(`CanvasText`))}static deleteAnnotationElement(e){let t=new oi({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t,n){}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){if(e)return!1}static paste(e,t){}get propertiesToUpdate(){return[]}get _isDraggable(){return S(this,Qr,`f`)}set _isDraggable(e){C(this,Qr,e,`f`),this.div?.classList.toggle(`k-draggable`,e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=S(this,$r,`f`)}setParent(e){e===null?S(this,Rr,`m`,ai).call(this):(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions),this.parent=e}focusin(e){e&&this._focusEventsAllowed&&(S(this,Gr,`f`)?C(this,Gr,!1,`f`):this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){let[i,a]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/i,this.y=(t+r)/a,this.fixAndSetPosition()}translate(e,t){S(this,Rr,`m`,ei).call(this,this.parentDimensions,e,t)}translateInPage(e,t){C(this,Kr,S(this,Kr,`f`)||[this.x,this.y],`f`),S(this,Rr,`m`,ei).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:`nearest`})}drag(e,t){C(this,Kr,S(this,Kr,`f`)||[this.x,this.y],`f`);let[n,r]=this.parentDimensions;if(this.x+=e/n,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:e,y:t}=this.div.getBoundingClientRect();this.parent.findNewParent(this,e,t)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:i,y:a}=this,[o,s]=this.getBaseTranslation();i+=o,a+=s,this.div.style.left=`${(100*i).toFixed(2)}%`,this.div.style.top=`${(100*a).toFixed(2)}%`,this.div.scrollIntoView({block:`nearest`})}get _hasBeenMoved(){return!!S(this,Kr,`f`)&&(S(this,Kr,`f`)[0]!==this.x||S(this,Kr,`f`)[1]!==this.y)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:n}=zr,r=n/e,i=n/t;switch(this.rotation){case 90:return[-r,i];case 180:return[r,i];case 270:return[r,-i];default:return[-r,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){if(e===void 0)return;let[t,n]=this.pageDimensions,{x:r,y:i,width:a,height:o}=this;if(a*=t,o*=n,r*=t,i*=n,this._mustFixPosition)switch(e){case 0:r=Math.max(0,Math.min(t-a,r)),i=Math.max(0,Math.min(n-o,i));break;case 90:r=Math.max(0,Math.min(t-o,r)),i=Math.min(n,Math.max(a,i));break;case 180:r=Math.min(t,Math.max(a,r)),i=Math.min(n,Math.max(o,i));break;case 270:r=Math.min(t,Math.max(o,r)),i=Math.max(0,Math.min(n-a,i));break;default:break}this.x=r/=t,this.y=i/=n;let[s,c]=this.getBaseTranslation();r+=s,i+=c;let{style:l}=this.div;l.left=`${(100*r).toFixed(2)}%`,l.top=`${(100*i).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){return S(zr,zr,`m`,ti).call(zr,e,t,this.parentRotation)}pageTranslationToScreen(e,t){return S(zr,zr,`m`,ti).call(zr,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,n]}=this,r=t*e,i=n*e;return mt.isCSSRoundSupported?[Math.round(r),Math.round(i)]:[r,i]}setDims(e,t){let[n,r]=this.parentDimensions;this.div.style.width=`${(100*e/n).toFixed(2)}%`,S(this,Ur,`f`)||(this.div.style.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){}getInitialTranslation(){return[0,0]}addEditToolbar(){this._uiManager?.showEditorToolBar(this.div)}removeEditToolbar(){this._uiManager.hideEditorToolBar()}getClientDimensions(){return this.div.getBoundingClientRect()}render(){this.div=document.createElement(`div`),this.div.setAttribute(`data-editor-rotation`,(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute(`id`,this.id),this.div.tabIndex=S(this,Hr,`f`)?-1:0,this._isVisible||this.div.classList.add(`k-hidden`),this.setInForeground(),S(this,Rr,`m`,ii).call(this);let[e,t]=this.parentDimensions;this.parentRotation%180!=0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[n,r]=this.getInitialTranslation();return this.translate(n,r),Lr(this,this.div,[`pointerdown`]),this.div}pointerdown(e){let{isMac:t}=mt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(C(this,Gr,!0,`f`),this._isDraggable){this._uiManager?.hideEditorToolBar(),S(this,Rr,`m`,ri).call(this,e);return}S(this,Rr,`m`,ni).call(this,e)}moveInDOM(){S(this,Yr,`f`)&&clearTimeout(S(this,Yr,`f`)),C(this,Yr,setTimeout(()=>{C(this,Yr,null,`f`),this.parent?.moveEditorInDOM(this)},0),`f`)}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition()}getRect(e,t,n=this.rotation){let r=this.parentScale,[i,a]=this.pageDimensions,[o,s]=this.pageTranslation,c=e/r,l=t/r,u=this.x*i,d=this.y*a,f=this.width*i,p=this.height*a;switch(n){case 0:return[u+c+o,a-d-l-p+s,u+c+f+o,a-d-l+s];case 90:return[u+l+o,a-d+c+s,u+l+p+o,a-d+c+f+s];case 180:return[u-c-f+o,a-d+l+s,u-c+o,a-d+l+p+s];case 270:return[u-l-p+o,a-d-c-f+s,u-l+o,a-d-c+s];default:throw Error(`Invalid rotation`)}}getRectInCurrentCoords(e,t){let[n,r,i,a]=e,o=i-n,s=a-r;switch(this.rotation){case 0:return[n,t-a,o,s];case 90:return[n,t-r,s,o];case 180:return[i,t-r,o,s];case 270:return[i,t-a,s,o];default:break}}onceAdded(){}isEmpty(){return!1}enableEditMode(){C(this,Jr,!0,`f`)}disableEditMode(){C(this,Jr,!1,`f`)}isInEditMode(){return S(this,Jr,`f`)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){S(this,Rr,`m`,ii).call(this)}rotate(e){}serialize(e=!1,t=null){}static deserialize(e,t,n){let r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});r.rotation=e.rotation;let[i,a]=r.pageDimensions,[o,s,c,l]=r.getRectInCurrentCoords(e.rect,a);return r.x=o/i,r.y=s/a,r.width=c/i,r.height=l/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){S(this,Wr,`f`)?.abort(),C(this,Wr,null,`f`),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),S(this,Yr,`f`)&&(clearTimeout(S(this,Yr,`f`)),C(this,Yr,null,`f`)),S(this,Rr,`m`,ai).call(this),this.removeEditToolbar(),this.parent=null}get isResizable(){return!1}makeResizable(){}get toolbarPosition(){return null}_stopResizingWithKeyboard(){}select(){this.div?.classList.add(`k-selected`),this.addEditToolbar()}unselect(){this.div?.classList.remove(`k-selected`),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0})}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return S(this,qr,`f`)}set isEditing(e){C(this,qr,e,`f`),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){C(this,Ur,!0,`f`);let n=e/t,{style:r}=this.div;r.aspectRatio=n,r.height=`auto`}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:`added`}}get telemetryFinalData(){return null}_reportTelemetry(){}show(e=this._isVisible){this.div.classList.toggle(`k-hidden`,!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),C(this,Hr,!1,`f`)}disable(){this.div&&(this.div.tabIndex=-1),C(this,Hr,!0,`f`)}renderAnnotationElement(e){let t=e.container.querySelector(`.annotationContent`)||e.container.querySelector(`.k-annotation-content`);if(!t)t=document.createElement(`div`),t.classList.add(`k-annotation-content`,this.editorType),e.container.prepend(t);else if(t.nodeName===`CANVAS`){let e=t;t=document.createElement(`div`),t.classList.add(`k-annotation-content`,this.editorType),e.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;t.nodeName===`DIV`&&(t.classList.contains(`annotationContent`)||t.classList.contains(`k-annotation-content`))&&t.remove()}};zr=P,Br=new WeakMap,Vr=new WeakMap,Hr=new WeakMap,Ur=new WeakMap,Wr=new WeakMap,Gr=new WeakMap,Kr=new WeakMap,qr=new WeakMap,Jr=new WeakMap,Yr=new WeakMap,Xr=new WeakMap,Zr=new WeakMap,Qr=new WeakMap,$r=new WeakMap,Rr=new WeakSet,ei=function([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this.fixAndSetPosition()},ti=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},ni=function(e){let{isMac:t}=mt.platform,n=e.target.closest(`.k-highlight-editor`),r=e.target.closest(`.k-free-text-editor`),i=this._uiManager.getMode();i===Zt.HIGHLIGHT&&!n||i===Zt.FREETEXT&&!r||(e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this))},ri=function(e){let t=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let n=new AbortController,r=this._uiManager.combinedSignal(n);t&&(C(this,Xr,e.clientX,`f`),C(this,Zr,e.clientY,`f`),window.addEventListener(`pointermove`,e=>{let{clientX:t,clientY:n}=e,[r,i]=this.screenToPageTranslation(t-S(this,Xr,`f`),n-S(this,Zr,`f`));C(this,Xr,t,`f`),C(this,Zr,n,`f`),this._uiManager.dragSelectedEditors(r,i)},{passive:!0,capture:!0,signal:r}));let i=()=>{n.abort(),t&&this.div.classList.remove(`moving`),C(this,Gr,!1,`f`),this._uiManager.endDragSession()||S(this,Rr,`m`,ni).call(this,e)};window.addEventListener(`pointerup`,i,{signal:r}),window.addEventListener(`blur`,i,{signal:r})},ii=function(){if(S(this,Wr,`f`)||!this.div)return;C(this,Wr,new AbortController,`f`);let e=this._uiManager.combinedSignal(S(this,Wr,`f`));this.div.addEventListener(`focusin`,this.focusin.bind(this),{signal:e}),this.div.addEventListener(`focusout`,this.focusout.bind(this),{signal:e})},ai=function(){},P.idManager=new sn(`annotation_editor_id_`),P._borderLineWidth=-1,P._colorManager=new Ir,P._zIndex=1,P._telemetryTimeout=1e3;var oi=class extends P{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}};let si=3285377520,F=4294901760,ci=65535;var li=class{constructor(e){this.h1=null,this.h2=null,this.h1=e?e&4294967295:si,this.h2=e?e&4294967295:si}update(e){let t,n;if(typeof e==`string`){t=new Uint8Array(e.length*2),n=0;for(let r=0,i=e.length;r<i;r++){let i=e.charCodeAt(r);i<=255?t[n++]=i:(t[n++]=i>>>8,t[n++]=i&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw Error(`Invalid data format, must be a string or TypedArray.`);let r=n>>2,i=n-r*4,a=new Uint32Array(t.buffer,0,r),o=0,s=0,c=this.h1,l=this.h2,u=3432918353,d=461845907,f=u&ci,p=d&ci;for(let e=0;e<r;e++)e&1?(o=a[e],o=o*u&F|o*f&ci,o=o<<15|o>>>17,o=o*d&F|o*p&ci,c^=o,c=c<<13|c>>>19,c=c*5+3864292196):(s=a[e],s=s*u&F|s*f&ci,s=s<<15|s>>>17,s=s*d&F|s*p&ci,l^=s,l=l<<13|l>>>19,l=l*5+3864292196);switch(o=0,i){case 3:o^=t[r*4+2]<<16;case 2:o^=t[r*4+1]<<8;case 1:o^=t[r*4],o=o*u&F|o*f&ci,o=o<<15|o>>>17,o=o*d&F|o*p&ci,r&1?c^=o:l^=o;break;default:break}this.h1=c,this.h2=l}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&F|e*36045&ci,t=t*4283543511&F|((t<<16|e>>>16)*2950163797&F)>>>16,e^=t>>>1,e=e*444984403&F|e*60499&ci,t=t*3301882366&F|((t<<16|e>>>16)*3120437893&F)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,`0`)+(t>>>0).toString(16).padStart(8,`0`)}},ui,di,fi,I,pi,mi;let hi=Object.freeze({map:null,hash:``,transfer:void 0});var gi=class{constructor(){ui.add(this),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null,di.set(this,!1),fi.set(this,null),I.set(this,new Map),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getStorage(){return S(this,I,`f`)}getModified(){return S(this,di,`f`)}getValue(e,t){let n=S(this,I,`f`).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return S(this,I,`f`).get(e)}remove(e){if(S(this,I,`f`).delete(e),S(this,I,`f`).size===0&&this.resetModified(),typeof this.onAnnotationEditor==`function`){for(let e of S(this,I,`f`).values())if(e instanceof P)return;this.onAnnotationEditor(null)}}setValue(e,t){let n=S(this,I,`f`).get(e),r=!1;if(n!==void 0)for(let[e,i]of Object.entries(t))n[e]!==i&&(r=!0,n[e]=i);else r=!0,S(this,I,`f`).set(e,t);r&&S(this,ui,`m`,pi).call(this),t instanceof P&&typeof this.onAnnotationEditor==`function`&&this.onAnnotationEditor(t.constructor._type)}has(e){return S(this,I,`f`).has(e)}getAll(){return S(this,I,`f`).size>0?tn(S(this,I,`f`)):null}setAll(e){for(let[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return S(this,I,`f`).size}resetModified(){S(this,di,`f`)&&(C(this,di,!1,`f`),typeof this.onResetModified==`function`&&this.onResetModified())}get print(){return new _i(this)}get serializable(){if(S(this,I,`f`).size===0)return hi;let e=new Map,t=new li(null),n=[],r=Object.create(null),i=!1;for(let[n,a]of S(this,I,`f`)){let o=a instanceof P?a.serialize(!1,r):a;o&&(e.set(n,o),t.update(`${n}:${JSON.stringify(o)}`),i||=!!o.bitmap)}if(i)for(let t of e.values())t.bitmap&&n.push(t.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:hi}get editorStats(){let e=null,t=new Map;for(let n of S(this,I,`f`).values()){if(!(n instanceof P))continue;let r=n.telemetryFinalData;if(!r)continue;let{type:i}=r;t.has(i)||t.set(i,Object.getPrototypeOf(n).constructor),e||=Object.create(null);let a=e[i]||(e[i]=new Map);for(let[e,t]of Object.entries(r)){if(e===`type`)continue;let n=a.get(e);n||(n=new Map,a.set(e,n));let r=n.get(t)??0;n.set(t,r+1)}}for(let[n,r]of t)e[n]=r.computeTelemetryFinalData(e[n]);return e}resetModifiedIds(){C(this,fi,null,`f`)}get modifiedIds(){if(S(this,fi,`f`))return S(this,fi,`f`);let e=[];for(let t of S(this,I,`f`).values())!(t instanceof P)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return C(this,fi,{ids:new Set(e),hash:e.join(`,`)},`f`)}};di=new WeakMap,fi=new WeakMap,I=new WeakMap,ui=new WeakSet,pi=function(){S(this,di,`f`)||(C(this,di,!0,`f`),typeof this.onSetModified==`function`&&this.onSetModified())};var _i=class extends gi{constructor(e){super(),mi.set(this,void 0);let{map:t,hash:n,transfer:r}=e.serializable,i=structuredClone(t,r?{transfer:r}:null);C(this,mi,{map:i,hash:n,transfer:r},`f`)}get print(){return null}get serializable(){return S(this,mi,`f`)}get modifiedIds(){return pt(this,`modifiedIds`,{ids:new Set,hash:``})}};mi=new WeakMap;var vi,yi,bi,xi,Si,Ci,wi,Ti,Ei,L,Di,Oi,ki,Ai,ji,R,Mi,Ni,Pi,Fi,Ii,Li,Ri,zi,Bi,Vi,Hi,Ui,Wi,Gi,Ki,qi,Ji,Yi,Xi,Zi,Qi,$i,ea,ta,na,ra,ia,aa;let oa=new WeakSet;function sa(e){return{width:e[2]-e[0],height:e[3]-e[1]}}var ca=class{static create(e){switch(e.data.annotationType){case Qt.LINK:return new ua(e);case Qt.WIDGET:switch(e.data.fieldType){case`Tx`:return new fa(e);case`Btn`:return e.data.radioButton?new ma(e):e.data.checkBox?new pa(e):new ha(e);case`Ch`:return new ga(e);default:break}case Qt.FREETEXT:return new ya(e);case Qt.HIGHLIGHT:return new ba(e);default:return new la(e)}}},la=class e{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){vi.add(this),this.isRenderable=null,this.data=null,this.layer=null,this.linkService=null,this.downloadManager=null,this.imageResourcesPath=null,this.renderForms=null,this.svgFactory=null,this.annotationStorage=null,this.enableScripting=null,this.hasJSActions=null,this._fieldObjects=null,this.parent=null,this.container=null,this.popup=null,this.annotationEditorType=null,yi.set(this,null),bi.set(this,!1),xi.set(this,null),this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:n}){return!!(e?.str||t?.str||n?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return e._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;C(this,yi,S(this,yi,`f`)||{rect:this.data.rect.slice(0)},`f`);let{rect:t}=e;t&&S(this,vi,`m`,Si).call(this,t),S(this,xi,`f`)?.popup.updateEdited(e)}resetEdited(){S(this,yi,`f`)&&(S(this,vi,`m`,Si).call(this,S(this,yi,`f`).rect),S(this,xi,`f`)?.popup.resetEdited(),C(this,yi,null,`f`))}_createContainer(e){let{data:t,parent:{page:n,viewport:r}}=this,i=document.createElement(`section`);i.setAttribute(`data-annotation-id`,t.id),this instanceof da||(i.tabIndex=0);let{style:a}=i;if(a.zIndex=(this.parent.zIndex++).toString(),t.popupRef&&i.setAttribute(`aria-haspopup`,`dialog`),t.alternativeText&&(i.title=t.alternativeText),t.noRotate,!t.rect||this instanceof _a){let{rotation:e}=t;return!t.hasOwnCanvas&&e!==0&&this.setRotation(e,i),i}let{width:o,height:s}=sa(t.rect);if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;let e=t.borderStyle.horizontalCornerRadius,n=t.borderStyle.verticalCornerRadius;switch(e>0||n>0?a.borderRadius=`calc(${e}px * var(--scale-factor)) / calc(${n}px * var(--scale-factor))`:this instanceof ma&&(a.borderRadius=`calc(${o}px * var(--scale-factor)) / calc(${s}px * var(--scale-factor))`),t.borderStyle.style){case $t.SOLID:a.borderStyle=`solid`;break;case $t.DASHED:a.borderStyle=`dashed`;break;case $t.BEVELED:break;case $t.INSET:break;case $t.UNDERLINE:a.borderBottomStyle=`solid`;break;default:break}let r=t.borderColor||null;r?(C(this,bi,!0,`f`),a.borderColor=yt.makeHexColor(r[0]|0,r[1]|0,r[2]|0)):a.borderWidth=`0`}let c=yt.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:l,pageHeight:u,pageX:d,pageY:f}=r.rawDims;a.left=`${100*(c[0]-d)/l}%`,a.top=`${100*(c[1]-f)/u}%`;let{rotation:p}=t;return t.hasOwnCanvas||p===0?(a.width=`${100*o/l}%`,a.height=`${100*s/u}%`):this.setRotation(p,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims,{width:i,height:a}=sa(this.data.rect),o,s;e%180==0?(o=100*i/n,s=100*a/r):(o=100*a/n,s=100*i/r),t.style.width=`${o}%`,t.style.height=`${s}%`,t.setAttribute(`data-main-rotation`,(360-e)%360)}get _commonActions(){let e=(e,t,n)=>{let r=n.detail[e],i=r[0],a=r.slice(1);n.target.style[t]=Nr[`${i}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[t]:Nr[`${i}_rgb`](a)})};return pt(this,`_commonActions`,{display:e=>{let{display:t}=e.detail,n=t%2==1;this.container.style.visibility=n?`hidden`:`visible`,this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:t===1||t===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{let{hidden:t}=e.detail;this.container.style.visibility=t?`hidden`:`visible`,this.annotationStorage.setValue(this.data.id,{noPrint:t,noView:t})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e(`bgColor`,`backgroundColor`,t)},fillColor:t=>{e(`fillColor`,`backgroundColor`,t)},fgColor:t=>{e(`fgColor`,`color`,t)},textColor:t=>{e(`textColor`,`color`,t)},borderColor:t=>{e(`borderColor`,`borderColor`,t)},strokeColor:t=>{e(`strokeColor`,`borderColor`,t)},rotation:e=>{let t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){let n=this._commonActions;for(let r of Object.keys(t.detail))(e[r]||n[r])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let n=this._commonActions;for(let[r,i]of Object.entries(t)){let a=n[r];a&&(a({detail:{[r]:i},target:e}),delete t[r])}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,n,r,i]=this.data.rect.map(e=>Math.fround(e));if(e.length===8){let[a,o,s,c]=e.subarray(2,6);if(r===a&&i===o&&t===s&&n===c)return}let{style:a}=this.container,o;if(S(this,bi,`f`)){let{borderColor:e,borderWidth:t}=a;a.borderWidth=0,o=[`url('data:image/svg+xml;utf8,`,`<svg xmlns="http://www.w3.org/2000/svg"`,` preserveAspectRatio="none" viewBox="0 0 1 1">`,`<g fill="transparent" stroke="${e}" stroke-width="${t}">`]}let s=r-t,c=i-n,{svgFactory:l}=this,u=l.createElement(`svg`);u.setAttribute(`width`,0),u.setAttribute(`height`,0);let d=l.createElement(`defs`);u.append(d);let f=l.createElement(`clipPath`),p=`clippath_${this.data.id}`;f.setAttribute(`id`,p),f.setAttribute(`clipPathUnits`,`objectBoundingBox`),d.append(f);for(let n=2,r=e.length;n<r;n+=8){let r=e[n],a=e[n+1],u=e[n+2],d=e[n+3],p=l.createElement(`rect`),m=(u-t)/s,h=(i-a)/c,ee=(r-u)/s,g=(a-d)/c;p.setAttribute(`x`,m),p.setAttribute(`y`,h),p.setAttribute(`width`,ee),p.setAttribute(`height`,g),f.append(p),o?.push(`<rect vector-effect="non-scaling-stroke" x="${m}" y="${h}" width="${ee}" height="${g}"/>`)}S(this,bi,`f`)&&(o.push(`</g></svg>')`),a.backgroundImage=o.join(``)),this.container.append(u),this.container.style.clipPath=`url(#${p})`}_createPopup(){}render(){}_getElementsByName(e,t=null){let n=[];if(this._fieldObjects){let r=this._fieldObjects[e];if(r)for(let{page:e,id:i,exportValues:a}of r){if(e===-1||i===t)continue;let r=typeof a==`string`?a:null,o=document.querySelector(`[data-element-id="${i}"]`);o&&!oa.has(o)||n.push({id:i,exportValue:r,domElement:o})}return n}for(let r of document.getElementsByName(e)){let{exportValue:e}=r,i=r.getAttribute(`data-element-id`);i!==t&&oa.has(r)&&n.push({id:i,exportValue:e,domElement:r})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){this.getElementsToTriggerPopup()}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener(`dblclick`,()=>{(this.linkService?.eventBus)?.dispatch(`switchannotationeditormode`,{source:this,mode:e,editId:t})})}_setRequired(e,t){t?e.setAttribute(`required`,!0):e.removeAttribute(`required`),e.setAttribute(`aria-required`,t)}};yi=new WeakMap,bi=new WeakMap,xi=new WeakMap,vi=new WeakSet,Si=function(e){let{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:s}}}}=this;n?.splice(0,4,...e);let{width:c,height:l}=sa(e);t.left=`${100*(e[0]-o)/i}%`,t.top=`${100*(a-e[3]+s)/a}%`,r===0?(t.width=`${100*c/i}%`,t.height=`${100*l/a}%`):this.setRotation(r)};var ua=class extends la{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),Ci.add(this),this.isTooltipOnly=!1,this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:t}=this,n=document.createElement(`a`);n.setAttribute(`data-element-id`,e.id);let r=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(n,e.action),r=!0):e.attachment?(S(this,Ci,`m`,Ti).call(this,n,e.attachment,e.attachmentDest),r=!0):e.setOCGState?(S(this,Ci,`m`,Ei).call(this,n,e.setOCGState),r=!0):e.dest?(this._bindLink(n,e.dest),r=!0):(e.actions&&(e.actions.Action||e.actions[`Mouse Up`]||e.actions[`Mouse Down`])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),r=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(n,``),r=!0)),this.container.classList.add(`k-link-annotation`),r&&this.container.append(n),this.container}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t===``)&&S(this,Ci,`m`,wi).call(this)}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(``),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),S(this,Ci,`m`,wi).call(this)}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl(``);let n=new Map([[`Action`,`onclick`],[`Mouse Up`,`onmouseup`],[`Mouse Down`,`onmousedown`]]);for(let r of Object.keys(t.actions)){let i=n.get(r);i&&(e[i]=()=>(this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t.id,name:r}}),!1))}e.onclick||=()=>!1,S(this,Ci,`m`,wi).call(this)}_bindResetFormAction(e,t){let n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl(``)),S(this,Ci,`m`,wi).call(this),!this._fieldObjects){n||(e.onclick=()=>!1);return}e.onclick=()=>{n?.();let{fields:e,refs:r,include:i}=t,a=[];if(e.length!==0||r.length!==0){let t=new Set(r);for(let n of e){let e=this._fieldObjects[n]||[];for(let{id:n}of e)t.add(n)}for(let e of Object.values(this._fieldObjects))for(let n of e)t.has(n.id)===i&&a.push(n)}else for(let e of Object.values(this._fieldObjects))a.push(...e);let o=this.annotationStorage,s=[];for(let e of a){let{id:t}=e;switch(s.push(t),e.type){case`text`:{let n=e.defaultValue||``;o.setValue(t,{value:n});break}case`checkbox`:case`radiobutton`:{let n=e.defaultValue===e.exportValues;o.setValue(t,{value:n});break}case`combobox`:case`listbox`:{let n=e.defaultValue||``;o.setValue(t,{value:n});break}default:continue}let n=document.querySelector(`[data-element-id="${t}"]`);n&&oa.has(n)&&n.dispatchEvent(new Event(`resetform`))}return this.enableScripting&&this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:`app`,ids:s,name:`ResetForm`}}),!1}}};Ci=new WeakSet,wi=function(){this.container.setAttribute(`data-internal-link`,``)},Ti=function(e,t,n=null){e.href=this.linkService.getAnchorUrl(``),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,n),!1),S(this,Ci,`m`,wi).call(this)},Ei=function(e,t){e.href=this.linkService.getAnchorUrl(``),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),S(this,Ci,`m`,wi).call(this)};var da=class extends la{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName===`CANVAS`&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return mt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,i){n.includes(`mouse`)?e.addEventListener(n,e=>{this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:this.data.id,name:r,value:i(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})}):e.addEventListener(n,e=>{if(n===`blur`){if(!t.focused||!e.relatedTarget)return;t.focused=!1}else if(n===`focus`){if(t.focused)return;t.focused=!0}i&&this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:this.data.id,name:r,value:i(e)}})})}_setEventListeners(e,t,n,r){for(let[i,a]of n)(a===`Action`||this.data.actions?.[a])&&((a===`Focus`||a===`Blur`)&&(t||={focused:!1}),this._setEventListener(e,t,i,a,r),a===`Focus`&&!this.data.actions?.Blur?this._setEventListener(e,t,`blur`,`Blur`,null):a===`Blur`&&!this.data.actions?.Focus&&this._setEventListener(e,t,`focus`,`Focus`,null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?`transparent`:yt.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=[`left`,`center`,`right`],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||9,i=e.style,a,o=e=>Math.round(10*e)/10;if(this.data.multiLine){let e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),t=e/(Math.round(e/(Jt*r))||1);a=Math.min(r,o(t/Jt))}else{let e=Math.abs(this.data.rect[3]-this.data.rect[1]-2);a=Math.min(r,o(e/Jt))}i.fontSize=`calc(${a}px * var(--scale-factor))`,i.color=yt.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute(`required`,!0):e.removeAttribute(`required`),e.setAttribute(`aria-required`,t)}},fa=class extends da{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){let i=this.annotationStorage;for(let a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=n),i.setValue(a.id,{[r]:n})}render(){let e=this.annotationStorage,t=this.data.id;this.container.classList.add(`k-text-widget-annotation`);let n=null;if(this.renderForms){let r=e.getValue(t,{value:this.data.fieldValue}),i=r.value||``,a=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;a&&i.length>a&&(i=i.slice(0,a));let o=r.formattedValue||this.data.textContent?.join(`
`)||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,``));let s={userValue:i,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement(`textarea`),n.textContent=o??i,this.data.doNotScroll&&(n.style.overflowY=`hidden`)):(n=document.createElement(`input`),n.type=`text`,n.setAttribute(`value`,o??i),this.data.doNotScroll&&(n.style.overflowX=`hidden`)),this.data.hasOwnCanvas&&(n.hidden=!0),oa.add(n),n.setAttribute(`data-element-id`,t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0,this._setRequired(n,this.data.required),a&&(n.maxLength=a),n.addEventListener(`input`,r=>{e.setValue(t,{value:r.target.value}),this.setPropertyOnSiblings(n,`value`,r.target.value,`value`),s.formattedValue=null}),n.addEventListener(`resetform`,()=>{let e=this.data.defaultFieldValue??``;n.value=s.userValue=e,s.formattedValue=null});let c=e=>{let{formattedValue:t}=s;t!=null&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener(`focus`,e=>{if(s.focused)return;let{target:t}=e;s.userValue&&(t.value=s.userValue),s.lastCommittedValue=t.value,s.commitKey=1,this.data.actions?.Focus||(s.focused=!0)}),n.addEventListener(`updatefromsandbox`,n=>{this.showElementAndHideCanvas(n.target),this._dispatchEventFromSandbox({value(n){s.userValue=n.detail.value??``,e.setValue(t,{value:s.userValue.toString()}),n.target.value=s.userValue},formattedValue(n){let{formattedValue:r}=n.detail;s.formattedValue=r,r!=null&&n.target!==document.activeElement&&(n.target.value=r),e.setValue(t,{formattedValue:r})},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:n=>{let{charLimit:r}=n.detail,{target:i}=n;if(r===0){i.removeAttribute(`maxLength`);return}i.setAttribute(`maxLength`,r);let a=s.userValue;!a||a.length<=r||(a=a.slice(0,r),i.value=s.userValue=a,e.setValue(t,{value:a}),this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:a,willCommit:!0,commitKey:1,selStart:i.selectionStart,selEnd:i.selectionEnd}}))}},n)}),n.addEventListener(`keydown`,e=>{s.commitKey=1;let n=-1;if(e.key===`Escape`?n=0:e.key===`Enter`&&!this.data.multiLine?n=2:e.key===`Tab`&&(s.commitKey=3),n===-1)return;let{value:r}=e.target;s.lastCommittedValue!==r&&(s.lastCommittedValue=r,s.userValue=r,this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:r,willCommit:!0,commitKey:n,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))});let r=c;c=null,n.addEventListener(`blur`,e=>{if(!s.focused||!e.relatedTarget)return;this.data.actions?.Blur||(s.focused=!1);let{value:n}=e.target;s.userValue=n,s.lastCommittedValue!==n&&this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:n,willCommit:!0,commitKey:s.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}),r(e)}),this.data.actions?.Keystroke&&n.addEventListener(`beforeinput`,e=>{s.lastCommittedValue=null;let{data:n,target:r}=e,{value:i,selectionStart:a,selectionEnd:o}=r,c=a,l=o;switch(e.inputType){case`deleteWordBackward`:{let e=i.substring(0,a).match(/\w*[^\w]*$/);e&&(c-=e[0].length);break}case`deleteWordForward`:{let e=i.substring(a).match(/^[^\w]*\w*/);e&&(l+=e[0].length);break}case`deleteContentBackward`:a===o&&--c;break;case`deleteContentForward`:a===o&&(l+=1);break;default:break}e.preventDefault(),this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:i,change:n||``,willCommit:!1,selStart:c,selEnd:l}})}),this._setEventListeners(n,s,[[`focus`,`Focus`],[`blur`,`Blur`],[`mousedown`,`Mouse Down`],[`mouseenter`,`Mouse Enter`],[`mouseleave`,`Mouse Exit`],[`mouseup`,`Mouse Up`]],e=>e.target.value)}if(c&&n.addEventListener(`blur`,c),this.data.comb){let e=(this.data.rect[2]-this.data.rect[0])/a;n.classList.add(`comb`),n.style.letterSpacing=`calc(${e}px * var(--scale-factor) - 1ch)`}}else n=document.createElement(`div`),n.textContent=this.data.fieldValue,n.style.verticalAlign=`middle`,n.style.display=`table-cell`,this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},pa=class extends da{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,n=t.id,r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r==`string`&&(r=r!==`Off`,e.setValue(n,{value:r})),this.container.classList.add(`k-button-widget-annotation`,`k-checkbox-widget-annotation`);let i=document.createElement(`input`);return oa.add(i),i.setAttribute(`data-element-id`,n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type=`checkbox`,i.name=t.fieldName,r&&i.setAttribute(`checked`,`true`),i.setAttribute(`exportValue`,t.exportValue),i.tabIndex=0,i.addEventListener(`change`,r=>{let{name:i,checked:a}=r.target;for(let r of this._getElementsByName(i,n)){let n=a&&r.exportValue===t.exportValue;r.domElement&&(r.domElement.checked=n),e.setValue(r.id,{value:n})}e.setValue(n,{value:a})}),i.addEventListener(`resetform`,e=>{let n=t.defaultFieldValue||`Off`;e.target.checked=n===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener(`updatefromsandbox`,t=>{this._dispatchEventFromSandbox({value(t){t.target.checked=t.detail.value!==`Off`,e.setValue(n,{value:t.target.checked})}},t)}),this._setEventListeners(i,null,[[`change`,`Validate`],[`change`,`Action`],[`focus`,`Focus`],[`blur`,`Blur`],[`mousedown`,`Mouse Down`],[`mouseenter`,`Mouse Enter`],[`mouseleave`,`Mouse Exit`],[`mouseup`,`Mouse Up`]],e=>e.target.checked)),this.enableScripting&&this.hasJSActions&&(i.addEventListener(`updatefromsandbox`,t=>{this._dispatchEventFromSandbox({value(t){t.target.checked=t.detail.value!==`Off`,e.setValue(n,{value:t.target.checked})}},t)}),this._setEventListeners(i,null,[[`change`,`Validate`],[`change`,`Action`],[`focus`,`Focus`],[`blur`,`Blur`],[`mousedown`,`Mouse Down`],[`mouseenter`,`Mouse Enter`],[`mouseleave`,`Mouse Exit`],[`mouseup`,`Mouse Up`]],e=>e.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},ma=class extends da{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add(`k-button-widget-annotation`,`k-radio-button-widget-annotation`);let e=this.annotationStorage,t=this.data,n=t.id,r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r==`string`&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(let r of this._getElementsByName(t.fieldName,n))e.setValue(r.id,{value:!1});let i=document.createElement(`input`);if(oa.add(i),i.setAttribute(`data-element-id`,n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type=`radio`,i.name=t.fieldName,r&&i.setAttribute(`checked`,`true`),i.tabIndex=0,i.addEventListener(`change`,t=>{let{name:r,checked:i}=t.target;for(let t of this._getElementsByName(r,n))e.setValue(t.id,{value:!1});e.setValue(n,{value:i})}),i.addEventListener(`resetform`,e=>{let n=t.defaultFieldValue;e.target.checked=n!=null&&n===t.buttonValue}),this.enableScripting&&this.hasJSActions){let r=t.buttonValue;i.addEventListener(`updatefromsandbox`,t=>{this._dispatchEventFromSandbox({value:t=>{let i=r===t.detail.value;for(let r of this._getElementsByName(t.target.name)){let t=i&&r.id===n;r.domElement&&(r.domElement.checked=t),e.setValue(r.id,{value:t})}}},t)}),this._setEventListeners(i,null,[[`change`,`Validate`],[`change`,`Action`],[`focus`,`Focus`],[`blur`,`Blur`],[`mousedown`,`Mouse Down`],[`mouseenter`,`Mouse Enter`],[`mouseleave`,`Mouse Exit`],[`mouseup`,`Mouse Up`]],e=>e.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},ha=class extends ua{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();this.container.classList.add(`k-button-widget-annotation`,`k-push-button-widget-annotation`);let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener(`updatefromsandbox`,e=>{this._dispatchEventFromSandbox({},e)})),e}},ga=class extends da{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add(`choiceWidgetAnnotation`);let e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement(`select`);oa.add(r),r.setAttribute(`data-element-id`,t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener(`resetform`,()=>{let e=this.data.defaultFieldValue;for(let t of r.options)t.selected=t.value===e});for(let e of this.data.options){let t=document.createElement(`option`);t.textContent=e.displayValue,t.value=e.exportValue,n.value.includes(e.exportValue)&&(t.setAttribute(`selected`,`true`),i=!1),r.append(t)}let a=null;if(i){let e=document.createElement(`option`);e.value=` `,e.setAttribute(`hidden`,`true`),e.setAttribute(`selected`,`true`),r.prepend(e),a=()=>{e.remove(),r.removeEventListener(`input`,a),a=null},r.addEventListener(`input`,a)}let o=e=>{let t=e?`value`:`textContent`,{options:n,multiple:i}=r;return i?Array.prototype.filter.call(n,e=>e.selected).map(e=>e[t]):n.selectedIndex===-1?null:n[n.selectedIndex][t]},s=o(!1),c=e=>{let t=e.target.options;return Array.prototype.map.call(t,e=>({displayValue:e.textContent,exportValue:e.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener(`updatefromsandbox`,n=>{this._dispatchEventFromSandbox({value(n){a?.();let i=n.detail.value,c=new Set(Array.isArray(i)?i:[i]);for(let e of r.options)e.selected=c.has(e.value);e.setValue(t,{value:o(!0)}),s=o(!1)},multipleSelection(){r.multiple=!0},remove(n){let i=r.options,a=n.detail.remove;i[a].selected=!1,r.remove(a),i.length>0&&Array.prototype.findIndex.call(i,e=>e.selected)===-1&&(i[0].selected=!0),e.setValue(t,{value:o(!0),items:c(n)}),s=o(!1)},clear(){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),s=o(!1)},insert(n){let{index:i,displayValue:a,exportValue:l}=n.detail.insert,u=r.children[i],d=document.createElement(`option`);d.textContent=a,d.value=l,u?u.before(d):r.append(d),e.setValue(t,{value:o(!0),items:c(n)}),s=o(!1)},items(n){let{items:i}=n.detail;for(;r.length!==0;)r.remove(0);for(let e of i){let{displayValue:t,exportValue:n}=e,i=document.createElement(`option`);i.textContent=t,i.value=n,r.append(i)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:o(!0),items:c(n)}),s=o(!1)},indices(n){let r=new Set(n.detail.indices);for(let e of n.target.options)e.selected=r.has(e.index);e.setValue(t,{value:o(!0)}),s=o(!1)},editable(e){e.target.disabled=!e.detail.editable}},n)}),r.addEventListener(`input`,n=>{let r=o(!0),i=o(!1);e.setValue(t,{value:r}),n.preventDefault(),this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:s,change:i,changeEx:r,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[[`focus`,`Focus`],[`blur`,`Blur`],[`mousedown`,`Mouse Down`],[`mouseenter`,`Mouse Enter`],[`mouseleave`,`Mouse Exit`],[`mouseup`,`Mouse Up`],[`input`,`Action`],[`input`,`Validate`]],e=>e.target.value)):r.addEventListener(`input`,function(){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},_a=class extends la{constructor(e){let{data:t,elements:n}=e;super(e,{isRenderable:la._hasPopupData(t)}),this.elements=[],this.elements=n,this.popup=null}render(){this.container.classList.add(`popupAnnotation`);let e=this.popup=new va({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let n of this.elements)n.popup=e,t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute(`aria-controls`,t.map(e=>`${an}${e}`).join(`,`)),this.container}},va=class{constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:i,contentsObj:a,richText:o,parent:s,rect:c,parentRect:l,open:u}){L.add(this),this.trigger=null,Di.set(this,S(this,L,`m`,Yi).bind(this)),Oi.set(this,S(this,L,`m`,$i).bind(this)),ki.set(this,S(this,L,`m`,Qi).bind(this)),Ai.set(this,S(this,L,`m`,Zi).bind(this)),ji.set(this,null),R.set(this,null),Mi.set(this,null),Ni.set(this,null),Pi.set(this,null),Fi.set(this,null),Ii.set(this,null),Li.set(this,!1),Ri.set(this,null),zi.set(this,null),Bi.set(this,null),Vi.set(this,null),Hi.set(this,null),Ui.set(this,null),Wi.set(this,!1),C(this,R,e,`f`),C(this,Hi,r,`f`),C(this,Mi,a,`f`),C(this,Vi,o,`f`),C(this,Fi,s,`f`),C(this,ji,t,`f`),C(this,Bi,c,`f`),C(this,Ii,l,`f`),C(this,Pi,n,`f`),C(this,Ni,vt.toDateObject(i),`f`),this.trigger=n.flatMap(e=>e.getElementsToTriggerPopup());for(let e of this.trigger)e.addEventListener(`click`,S(this,Ai,`f`)),e.addEventListener(`mouseenter`,S(this,ki,`f`)),e.addEventListener(`mouseleave`,S(this,Oi,`f`)),e.classList.add(`popupTriggerArea`);for(let e of n)e.container?.addEventListener(`keydown`,S(this,Di,`f`));S(this,R,`f`).hidden=!0,u&&S(this,L,`m`,Zi).call(this),S(this,Fi,`f`).popupShow.push(()=>x(this,void 0,void 0,function*(){S(this,R,`f`).hidden&&S(this,L,`m`,Qi).call(this)}))}render(){if(S(this,Ri,`f`))return;let e=C(this,Ri,document.createElement(`div`),`f`);if(e.className=`popup`,S(this,ji,`f`)){let t=e.style.outlineColor=yt.makeHexColor(...S(this,ji,`f`));CSS.supports(`background-color`,`color-mix(in srgb, red 30%, white)`)?e.style.backgroundColor=`color-mix(in srgb, ${t} 30%, white)`:e.style.backgroundColor=yt.makeHexColor(...S(this,ji,`f`).map(e=>Math.floor(.7*(255-e)+e)))}let t=document.createElement(`span`);t.className=`header`;let n=document.createElement(`h1`);if(t.append(n),{dir:n.dir,str:n.textContent}=S(this,Hi,`f`),e.append(t),S(this,Ni,`f`)){let e=document.createElement(`span`);e.classList.add(`popupDate`),e.setAttribute(`data-l10n-id`,`pdfjs-annotation-date-string`),e.setAttribute(`data-l10n-args`,JSON.stringify({date:S(this,Ni,`f`).toLocaleDateString(),time:S(this,Ni,`f`).toLocaleTimeString()})),t.append(e)}let r=S(this,L,`a`,Gi);if(r)bt.render({xfaHtml:r,intent:`richText`,div:e}),e.lastChild.classList.add(`richText`,`popupContent`);else{let t=this._formatContents(S(this,Mi,`f`));e.append(t)}S(this,R,`f`).append(e)}_formatContents({str:e,dir:t}){let n=document.createElement(`p`);n.classList.add(`popupContent`),n.dir=t;let r=e.split(/(?:\r\n?|\n)/);for(let e=0,t=r.length;e<t;++e){let i=r[e];n.append(document.createTextNode(i)),e<t-1&&n.append(document.createElement(`br`))}return n}updateEdited({rect:e,popupContent:t}){C(this,Ui,S(this,Ui,`f`)||{contentsObj:S(this,Mi,`f`),richText:S(this,Vi,`f`)},`f`),e&&C(this,zi,null,`f`),t&&(C(this,Vi,S(this,L,`m`,Ji).call(this,t),`f`),C(this,Mi,null,`f`)),S(this,Ri,`f`)?.remove(),C(this,Ri,null,`f`)}resetEdited(){var e,t;S(this,Ui,`f`)&&(e=this,t=this,{contentsObj:{set value(t){C(e,Mi,t,`f`)}}.value,richText:{set value(e){C(t,Vi,e,`f`)}}.value}=S(this,Ui,`f`),C(this,Ui,null,`f`),S(this,Ri,`f`)?.remove(),C(this,Ri,null,`f`),C(this,zi,null,`f`))}forceHide(){C(this,Wi,this.isVisible,`f`),S(this,Wi,`f`)&&(S(this,R,`f`).hidden=!0)}maybeShow(){S(this,Wi,`f`)&&(S(this,Ri,`f`)||S(this,L,`m`,Qi).call(this),C(this,Wi,!1,`f`),S(this,R,`f`).hidden=!1)}get isVisible(){return S(this,R,`f`).hidden===!1}};Di=new WeakMap,Oi=new WeakMap,ki=new WeakMap,Ai=new WeakMap,ji=new WeakMap,R=new WeakMap,Mi=new WeakMap,Ni=new WeakMap,Pi=new WeakMap,Fi=new WeakMap,Ii=new WeakMap,Li=new WeakMap,Ri=new WeakMap,zi=new WeakMap,Bi=new WeakMap,Vi=new WeakMap,Hi=new WeakMap,Ui=new WeakMap,Wi=new WeakMap,L=new WeakSet,Gi=function(){let e=S(this,Vi,`f`),t=S(this,Mi,`f`);return e?.str&&(!t?.str||t.str===e.str)&&S(this,Vi,`f`).html||null},Ki=function(){return S(this,L,`a`,Gi)?.attributes?.style?.fontSize||0},qi=function(){return S(this,L,`a`,Gi)?.attributes?.style?.color||null},Ji=function(e){let t=[],n={str:e,html:{name:`div`,attributes:{dir:`auto`},children:[{name:`p`,children:t}]}},r={style:{color:S(this,L,`a`,qi),fontSize:S(this,L,`a`,Ki)?`calc(${S(this,L,`a`,Ki)}px * var(--scale-factor))`:``}};for(let n of e.split(`
`))t.push({name:`span`,value:n,attributes:r});return n},Yi=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key===`Enter`||e.key===`Escape`&&S(this,Li,`f`))&&S(this,L,`m`,Zi).call(this)},Xi=function(){if(S(this,zi,`f`)!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:i}}}=S(this,Fi,`f`),a=!!S(this,Ii,`f`),o=a?S(this,Ii,`f`):S(this,Bi,`f`);for(let e of S(this,Pi,`f`))if(!o||yt.intersect(e.data.rect,o)!==null){o=e.data.rect,a=!0;break}let s=yt.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),c=a?o[2]-o[0]+5:0,l=s[0]+c,u=s[1];C(this,zi,[100*(l-r)/t,100*(u-i)/n],`f`);let{style:d}=S(this,R,`f`);d.left=`${S(this,zi,`f`)[0]}%`,d.top=`${S(this,zi,`f`)[1]}%`},Zi=function(){C(this,Li,!S(this,Li,`f`),`f`),S(this,Li,`f`)?(S(this,L,`m`,Qi).call(this),S(this,R,`f`).addEventListener(`click`,S(this,Ai,`f`)),S(this,R,`f`).addEventListener(`keydown`,S(this,Di,`f`))):(S(this,L,`m`,$i).call(this),S(this,R,`f`).removeEventListener(`click`,S(this,Ai,`f`)),S(this,R,`f`).removeEventListener(`keydown`,S(this,Di,`f`)))},Qi=function(){S(this,Ri,`f`)||this.render(),this.isVisible?S(this,Li,`f`)&&S(this,R,`f`).classList.add(`focused`):(S(this,L,`m`,Xi).call(this),S(this,R,`f`).hidden=!1,S(this,R,`f`).style.zIndex=(parseInt(S(this,R,`f`).style.zIndex,10)+1e3).toString())},$i=function(){S(this,R,`f`).classList.remove(`focused`),!(S(this,Li,`f`)||!this.isVisible)&&(S(this,R,`f`).hidden=!0,S(this,R,`f`).style.zIndex=(parseInt(S(this,R,`f`).style.zIndex,10)-1e3).toString())};var ya=class extends la{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=null,this.textPosition=null,this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=y.FREETEXT}render(){if(this.container.classList.add(`k-free-text-annotation`),this.textContent){let e=document.createElement(`div`);e.classList.add(`k-annotation-text-content`),e.setAttribute(`role`,`comment`);for(let t of this.textContent){let n=document.createElement(`span`);n.textContent=t,e.append(n)}this.container.append(e)}return this._editOnDoubleClick(),this.container}},ba=class extends la{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.container.classList.add(`k-highlight-annotation`),this.container}},xa=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:i,viewport:a}){ea.add(this),this.div=null,this.page=null,this.viewport=null,this.zIndex=null,this._annotationEditorUIManager=null,ta.set(this,null),na.set(this,null),ra.set(this,new Map),this.div=e,C(this,ta,t,`f`),C(this,na,n,`f`),this.page=i,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r}hide(){this.div&&(this.div.hidden=!0)}hasEditableAnnotations(){return S(this,ra,`f`).size>0}render(e){let{annotations:t}=e,n=this.div;ht(n,this.viewport);let r=new Map,i={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||``,renderForms:e.renderForms!==!1,svgFactory:new _t,annotationStorage:e.annotationStorage||new gi,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let e of t){if(e.noHTML)continue;let t=e.annotationType===Qt.POPUP;if(t){let t=r.get(e.id);if(!t)continue;i.elements=t}else{let{width:t,height:n}=sa(e.rect);if(t<=0||n<=0)continue}i.data=e;let n=ca.create(i);if(!n.isRenderable)continue;if(!t&&e.popupRef){let t=r.get(e.popupRef);t?t.push(n):r.set(e.popupRef,[n])}let a=n.render();e.hidden&&(a.style.visibility=`hidden`),S(this,ea,`m`,ia).call(this,a,e.id),n._isEditable&&(S(this,ra,`f`).set(n.data.id,n),this._annotationEditorUIManager?.renderAnnotationElement(n))}S(this,ea,`m`,aa).call(this)}update({viewport:e}){let t=this.div;this.viewport=e,ht(t,e),S(this,ea,`m`,aa).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(S(this,ra,`f`).values())}getEditableAnnotation(e){return S(this,ra,`f`).get(e)}destroy(){S(this,na,`f`)?.clear(),this.div?.remove(),this.div=null}};ta=new WeakMap,na=new WeakMap,ra=new WeakMap,ea=new WeakSet,ia=function(e,t){let n=e.firstChild||e;n.id=`${an}${t}`,this.div.append(e),S(this,ta,`f`)?.moveElementInDOM(this.div,e,n,!1)},aa=function(){if(!S(this,na,`f`))return;let e=this.div;for(let[t,n]of S(this,na,`f`)){let r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;n.className=`annotationContent k-annotation-content`;let{firstChild:i}=r;i?i.nodeName===`CANVAS`?i.replaceWith(n):!i.classList.contains(`annotationContent`)||!i.classList.contains(`k-annotation-content`)?i.before(n):i.after(n):r.append(n)}S(this,na,`f`).clear()};var Sa,Ca,wa,Ta,Ea=class{constructor({pdfPage:e,eventBus:t,linkService:n=null,annotationStorage:r=null,renderForms:i=!0,annotationCanvasMap:a=null,accessibilityManager:o=null,annotationEditorUIManager:s=null,onAppend:c=null}){Sa.add(this),this.annotationLayer=null,this.pdfPage=null,this.linkService=null,this.annotationStorage=null,this._annotationCanvasMap=null,this._annotationEditorUIManager=null,this.div=null,this._cancelled=null,this._eventBus=null,this._accessibilityManager=null,Ca.set(this,null),wa.set(this,null),this.renderForms=null,this.pdfPage=e,this.linkService=n,this.renderForms=i,this.annotationStorage=r,this._annotationCanvasMap=a,this._accessibilityManager=o,this._annotationEditorUIManager=s,C(this,Ca,c,`f`),this.annotationLayer=null,this.div=null,this._cancelled=!1,this._eventBus=n?.eventBus||t}render(e){return x(this,arguments,void 0,function*(e,t=`display`){if(this.div){if(this._cancelled||!this.annotationLayer)return;this.annotationLayer.update({viewport:e.clone({dontFlip:!0})});return}let[n]=yield Promise.all([this.pdfPage.getAnnotations({intent:t})]);if(this._cancelled)return;if(n.length===0){this.hide();return}let r=this.pdfPage._pageInfo?.view,i=Oe(`
            <div class="k-annotation-layer"
                 data-main-rotation="0"
                 style="width: round(var(--scale-factor) * ${(r[2]||0)+`px`}, 1px);
                        height: round(var(--scale-factor) * ${(r[3]||0)+`px`}, 1px);">
            </div>
        `);this.div=i,S(this,Ca,`f`)?.call(this,i),this.annotationLayer=new xa({div:i,accessibilityManager:this._accessibilityManager,annotationCanvasMap:this._annotationCanvasMap,annotationEditorUIManager:this._annotationEditorUIManager,page:this.pdfPage,viewport:e.clone({dontFlip:!0})}),yield this.annotationLayer.render({annotations:n,renderForms:this.renderForms,linkService:this.linkService,annotationStorage:this.annotationStorage}),this.linkService.isInPresentationMode&&S(this,Sa,`m`,Ta).call(this,sr.FULLSCREEN),S(this,wa,`f`)||(C(this,wa,new AbortController,`f`),this._eventBus?._on(`presentationmodechanged`,e=>{S(this,Sa,`m`,Ta).call(this,e.state)},{signal:S(this,wa,`f`).signal}))})}cancel(){this._cancelled=!0,S(this,wa,`f`)?.abort(),C(this,wa,null,`f`)}hide(){this.div&&(this.div.hidden=!0)}hasEditableAnnotations(){return!!this.annotationLayer?.hasEditableAnnotations()}destroy(){this.cancel(),this.annotationLayer?.destroy(),this.annotationLayer=null,S(this,wa,`f`)?.abort(),C(this,wa,null,`f`),this.div?.remove(),this.div=null}};Ca=new WeakMap,wa=new WeakMap,Sa=new WeakSet,Ta=function(e){if(!this.div)return;let t=!1;switch(e){case sr.FULLSCREEN:t=!0;break;case sr.NORMAL:break;default:return}for(let e of this.div.childNodes)e.hasAttribute(`data-internal-link`)||(e.inert=t)};var Da,z,Oa,ka,B,Aa,ja,Ma,Na,Pa=class{constructor({pageIndex:e}){Da.add(this),this.pageIndex=0,Oa.set(this,null),ka.set(this,0),B.set(this,new Map),Aa.set(this,new Map),this.pageIndex=e}setParent(e){if(!S(this,Oa,`f`)){C(this,Oa,e,`f`);return}if(S(this,Oa,`f`)!==e){if(S(this,B,`f`).size>0)for(let t of S(this,B,`f`).values())t.remove(),e.append(t);C(this,Oa,e,`f`)}}static get _svgFactory(){return pt(this,`_svgFactory`,new _t)}highlight(e,t,n,r=!1){var i,a;let o=(C(this,ka,(a=S(this,ka,`f`),i=a++,a),`f`),i),s=S(this,Da,`m`,Ma).call(this,e.box);s.classList.add(`k-highlight`),e.free;let c=z._svgFactory.createElement(`defs`);s.append(c);let l=z._svgFactory.createElement(`path`);c.append(l);let u=`path_p${this.pageIndex}_${o}`;l.setAttribute(`id`,u),l.setAttribute(`d`,e.toSVGPath()),r&&S(this,Aa,`f`).set(o,l);let d=S(this,Da,`m`,Na).call(this,c,u),f=z._svgFactory.createElement(`use`);return s.append(f),s.setAttribute(`fill`,t),s.setAttribute(`fill-opacity`,n),f.setAttribute(`href`,`#${u}`),S(this,B,`f`).set(o,s),{id:o,clipPathId:`url(#${d})`}}highlightOutline(e){var t,n;let r=(C(this,ka,(n=S(this,ka,`f`),t=n++,n),`f`),t),i=S(this,Da,`m`,Ma).call(this,e.box);i.classList.add(`k-highlight-outline`);let a=z._svgFactory.createElement(`defs`);i.append(a);let o=z._svgFactory.createElement(`path`);a.append(o);let s=`path_p${this.pageIndex}_${r}`;o.setAttribute(`id`,s),o.setAttribute(`d`,e.toSVGPath()),o.setAttribute(`vector-effect`,`non-scaling-stroke`);let c;if(e.free){let e=z._svgFactory.createElement(`mask`);a.append(e),c=`mask_p${this.pageIndex}_${r}`,e.setAttribute(`id`,c),e.setAttribute(`maskUnits`,`objectBoundingBox`);let t=z._svgFactory.createElement(`rect`);e.append(t),t.setAttribute(`width`,`1`),t.setAttribute(`height`,`1`),t.setAttribute(`fill`,`white`);let n=z._svgFactory.createElement(`use`);e.append(n),n.setAttribute(`href`,`#${s}`),n.setAttribute(`stroke`,`none`),n.setAttribute(`fill`,`black`),n.setAttribute(`fill-rule`,`nonzero`)}let l=z._svgFactory.createElement(`use`);i.append(l),l.setAttribute(`href`,`#${s}`),c&&l.setAttribute(`mask`,`url(#${c})`);let u=l.cloneNode();return i.append(u),S(this,B,`f`).set(r,i),r}finalizeLine(e,t){let n=S(this,Aa,`f`).get(e);S(this,Aa,`f`).delete(e),this.updateBox(e,t.box),n.setAttribute(`d`,t.toSVGPath())}updateLine(e,t){S(this,B,`f`).get(e).firstChild.firstChild.setAttribute(`d`,t.toSVGPath())}removeFreeHighlight(e){this.remove(e),S(this,Aa,`f`).delete(e)}updatePath(e,t){S(this,Aa,`f`).get(e).setAttribute(`d`,t.toSVGPath())}updateBox(e,t){S(z,z,`m`,ja).call(z,S(this,B,`f`).get(e),t)}show(e,t){S(this,B,`f`).get(e).classList.toggle(`k-hidden`,!t)}rotate(e,t){S(this,B,`f`).get(e).setAttribute(`data-main-rotation`,t)}changeColor(e,t){S(this,B,`f`).get(e).setAttribute(`fill`,t)}changeOpacity(e,t){S(this,B,`f`).get(e).setAttribute(`fill-opacity`,t)}addClass(e,t){S(this,B,`f`).get(e).classList.add(t)}removeClass(e,t){S(this,B,`f`).get(e).classList.remove(t)}remove(e){S(this,Oa,`f`)!==null&&(S(this,B,`f`).get(e).remove(),S(this,B,`f`).delete(e))}destroy(){C(this,Oa,null,`f`);for(let e of S(this,B,`f`).values())e.remove();S(this,B,`f`).clear()}};z=Pa,Oa=new WeakMap,ka=new WeakMap,B=new WeakMap,Aa=new WeakMap,Da=new WeakSet,ja=function(e,{x:t=0,y:n=0,width:r=1,height:i=1}={}){let{style:a}=e;a.top=`${100*n}%`,a.left=`${100*t}%`,a.width=`${100*r-.2}%`,a.height=`${100*i-.2}%`},Ma=function(e){let t=z._svgFactory.create(1,1,!0);return S(this,Oa,`f`).append(t),t.setAttribute(`aria-hidden`,!0),S(z,z,`m`,ja).call(z,t,e),t},Na=function(e,t){let n=z._svgFactory.createElement(`clipPath`);e.append(n);let r=`clip_${t}`;n.setAttribute(`id`,r),n.setAttribute(`clipPathUnits`,`objectBoundingBox`);let i=z._svgFactory.createElement(`use`);return n.append(i),i.setAttribute(`href`,`#${t}`),r};var Fa,Ia=class{constructor(e){this.pageIndex=null,this._cancelled=null,Fa.set(this,null),this.pageIndex=e.pageIndex}render(){return x(this,arguments,void 0,function*(e=`display`){e!==`display`||S(this,Fa,`f`)||C(this,Fa,new Pa({pageIndex:this.pageIndex}),`f`)})}cancel(){S(this,Fa,`f`)&&(S(this,Fa,`f`)?.destroy(),C(this,Fa,null,`f`))}setParent(e){S(this,Fa,`f`)?.setParent(e)}getDrawLayer(){return S(this,Fa,`f`)}destroy(){this.cancel()}};Fa=new WeakMap;var V,H,La,U,Ra,za,W,Ba,Va,Ha,Ua,Wa,Ga,Ka,qa,Ja,Ya;let Xa=/\r\n?|\n/g;var Za=class extends P{constructor(e){super(Object.assign(Object.assign({},e),{name:`k-free-text-editor freeTextEditor`})),V.add(this),this.editorDiv=null,this.overlayDiv=null,La.set(this,void 0),U.set(this,``),Ra.set(this,`${this.id}-editor`),za.set(this,null),W.set(this,void 0),Ba.set(this,null),C(this,La,e.color||H._defaultColor||P._defaultLineColor,`f`),C(this,W,e.fontSize||H._defaultFontSize,`f`)}static initialize(e,t){P.initialize(e,t,{strings:[`pdfjs-free-text-default-content`]});let n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue(`--freetext-padding`))||2}static updateDefaultParams(e,t){switch(e){case b.FREETEXT_SIZE:H._defaultFontSize=t;break;case b.FREETEXT_COLOR:H._defaultColor=t;break;default:break}}updateParams(e,t){switch(e){case b.FREETEXT_SIZE:S(this,V,`m`,Va).call(this,t);break;case b.FREETEXT_COLOR:S(this,V,`m`,Ha).call(this,t);break;default:break}}static get defaultPropertiesToUpdate(){return[[b.FREETEXT_SIZE,H._defaultFontSize],[b.FREETEXT_COLOR,H._defaultColor||P._defaultLineColor]]}get propertiesToUpdate(){return[[b.FREETEXT_SIZE,S(this,W,`f`)],[b.FREETEXT_COLOR,S(this,La,`f`)]]}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){let e=this.parentScale;return[-H._internalPadding*e,-(H._internalPadding+S(this,W,`f`))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(y.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove(`enabled`),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute(`aria-activedescendant`),C(this,za,new AbortController,`f`);let e=this._uiManager.combinedSignal(S(this,za,`f`));this.editorDiv.addEventListener(`keydown`,this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener(`focus`,this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener(`blur`,this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener(`input`,this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener(`paste`,this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.editorDiv.contentEditable=!1,this.div.setAttribute(`aria-activedescendant`,S(this,Ra,`f`)),this._isDraggable=!0,S(this,za,`f`)?.abort(),C(this,za,null,`f`),this.div.focus({preventScroll:!0}),this.isEditing=!1)}focusin(e){this._focusEventsAllowed&&this._uiManager?.getMode()===y.FREETEXT&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||(this.editorDiv?.innerText)?.trim()===``}remove(){this.isEditing=!1,this.parent&&this.parent.setEditingState(!0),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=S(this,U,`f`),t=C(this,U,S(this,V,`m`,Ua).call(this).trimEnd(),`f`);if(e===t)return;let n=e=>{if(C(this,U,e,`f`),!e){this.remove();return}S(this,V,`m`,Ka).call(this),this._uiManager.rebuild(this),S(this,V,`m`,Wa).call(this)};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),S(this,V,`m`,Wa).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){e&&this.enterInEditMode()}keydown(e){e.target===this.div&&e.key===`Enter`&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(){}editorDivFocus(){this.isEditing=!0}editorDivBlur(){this.isEditing=!1}editorDivInput(){}disableEditing(){this.editorDiv.setAttribute(`role`,`comment`),this.editorDiv.removeAttribute(`aria-multiline`)}enableEditing(){this.editorDiv.setAttribute(`role`,`textbox`),this.editorDiv.setAttribute(`aria-multiline`,!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement(`div`),this.editorDiv.className=`k-internal internal`,this.editorDiv.setAttribute(`id`,S(this,Ra,`f`)),this.editorDiv.setAttribute(`data-l10n-id`,`pdfjs-free-text`),this.enableEditing(),this.editorDiv?.setAttribute(`default-content`,this._uiManager.pdfViewer.options.messages.freeTextEditorPlaceholder),this.editorDiv.contentEditable=!0;let{style:n}=this.editorDiv;if(n.fontSize=`calc(${S(this,W,`f`)}px * var(--scale-factor))`,n.color=S(this,La,`f`),this.div.append(this.editorDiv),this.overlayDiv=document.createElement(`div`),this.div.append(this.overlayDiv),Lr(this,this.div,[`dblclick`,`keydown`]),this.width){let[n,r]=this.parentDimensions;if(this.annotationElementId){let{position:i}=S(this,Ba,`f`),[a,o]=this.getInitialTranslation();[a,o]=this.pageTranslationToScreen(a,o);let[s,c]=this.pageDimensions,[l,u]=this.pageTranslation,d,f;switch(this.rotation){case 0:d=e+(i[0]-l)/s,f=t+this.height-(i[1]-u)/c;break;case 90:d=e+(i[0]-l)/s,f=t-(i[1]-u)/c,[a,o]=[o,-a];break;case 180:d=e-this.width+(i[0]-l)/s,f=t-(i[1]-u)/c,[a,o]=[-a,-o];break;case 270:d=e+(i[0]-l-this.height*c)/s,f=t+(i[1]-u-this.width*s)/c,[a,o]=[-o,a];break;default:break}this.setAt(d*n,f*r,a,o)}else this.setAt(e*n,t*r,this.width*n,this.height*r);S(this,V,`m`,Ka).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){let t=e.clipboardData||window.clipboardData,{types:n}=t;if(n.length===1&&n[0]===`text/plain`)return;e.preventDefault();let r=S(H,H,`m`,Ja).call(H,t.getData(`text`)||``).replaceAll(Xa,`
`);if(!r)return;let i=window.getSelection();if(!i.rangeCount)return;this.editorDiv.normalize(),i.deleteFromDocument();let a=i.getRangeAt(0);if(!r.includes(`
`)){a.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),i.collapseToStart();return}let{startContainer:o,startOffset:s}=a,c=[],l=[];if(o.nodeType===Node.TEXT_NODE){let e=o.parentElement;if(l.push(o.nodeValue.slice(s).replaceAll(Xa,``)),e!==this.editorDiv){let t=c;for(let n of this.editorDiv.childNodes){if(n===e){t=l;continue}t.push(S(H,H,`m`,Ga).call(H,n))}}c.push(o.nodeValue.slice(0,s).replaceAll(Xa,``))}else if(o===this.editorDiv){let e=c,t=0;for(let n of this.editorDiv.childNodes)t++===s&&(e=l),e.push(S(H,H,`m`,Ga).call(H,n))}C(this,U,`${c.join(`
`)}${r}${l.join(`
`)}`,`f`),S(this,V,`m`,Ka).call(this);let u=new Range,d=c.reduce((e,t)=>e+t.length,0);for(let{firstChild:e}of this.editorDiv.childNodes)if(e.nodeType===Node.TEXT_NODE){let t=e.nodeValue.length;if(d<=t){u.setStart(e,d),u.setEnd(e,d);break}d-=t}i.removeAllRanges(),i.addRange(u)}get contentDiv(){return this.editorDiv}static deserialize(e,t,n){let r=null;if(e instanceof ya){let{data:{defaultAppearanceData:{fontSize:t,fontColor:n},rect:i,rotation:a,id:o},textContent:s,textPosition:c,parent:{page:{pageNumber:l}}}=e;if(!s||s.length===0)return null;r=e={annotationType:y.FREETEXT,color:Array.from(n),fontSize:t,value:s.join(`
`),position:c,pageIndex:l-1,rect:i.slice(0),rotation:a,id:o,deleted:!1}}let i=super.deserialize(e,t,n);return C(i,W,e.fontSize,`f`),C(i,La,yt.makeHexColor(...e.color),`f`),C(i,U,S(H,H,`m`,Ja).call(H,e.value),`f`),i.annotationElementId=e.id||null,C(i,Ba,r,`f`),i}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};let t=H._internalPadding*this.parentScale,n=this.getRect(t,t),r=P._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:S(this,La,`f`)),i={annotationType:y.FREETEXT,color:r,fontSize:S(this,W,`f`),value:S(this,V,`m`,qa).call(this),pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?i:this.annotationElementId&&!S(this,V,`m`,Ya).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(e){let t=super.renderAnnotationElement(e);if(this.deleted)return t;let{style:n}=t;n.fontSize=`calc(${S(this,W,`f`)}px * var(--scale-factor))`,n.color=S(this,La,`f`),t.replaceChildren();for(let e of S(this,U,`f`).split(`
`)){let n=document.createElement(`div`);n.append(e?document.createTextNode(e):document.createElement(`br`)),t.append(n)}let r=H._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(r,r),popupContent:S(this,U,`f`)}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}toJSON(){return this.serialize()}};H=Za,La=new WeakMap,U=new WeakMap,Ra=new WeakMap,za=new WeakMap,W=new WeakMap,Ba=new WeakMap,V=new WeakSet,Va=function(e){let t=e=>{this.editorDiv.style.fontSize=`calc(${e}px * var(--scale-factor))`,this.translate(0,-(e-S(this,W,`f`))*this.parentScale),C(this,W,e,`f`),S(this,V,`m`,Wa).call(this)},n=S(this,W,`f`);this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Ha=function(e){let t=e=>{C(this,La,this.editorDiv.style.color=e,`f`)},n=S(this,La,`f`);this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Ua=function(){let e=[];this.editorDiv.normalize();for(let t of this.editorDiv.childNodes)e.push(S(H,H,`m`,Ga).call(H,t));return e.join(`
`)},Wa=function(){let[e,t]=this.parentDimensions,n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{let{currentLayer:e,div:t}=this,r=t.style.display,i=t.classList.contains(`hidden`)||t.classList.contains(`k-hidden`);t.classList.remove(`hidden`),t.classList.remove(`k-hidden`),t.style.display=`hidden`,e.div.append(this.div),n=t.getBoundingClientRect(),t.remove(),t.style.display=r,t.classList.toggle(`k-hidden`,i)}this.rotation%180==this.parentRotation%180?(this.width=n.width/e,this.height=n.height/t):(this.width=n.height/e,this.height=n.width/t),this.fixAndSetPosition()},Ga=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Xa,``)},Ka=function(){if(this.editorDiv.replaceChildren(),S(this,U,`f`))for(let e of S(this,U,`f`).split(`
`)){let t=document.createElement(`div`);t.append(e?document.createTextNode(e):document.createElement(`br`)),this.editorDiv.append(t)}},qa=function(){return S(this,U,`f`).replaceAll(`\xA0`,` `)},Ja=function(e){return e.replaceAll(` `,`\xA0`)},Ya=function(e){let{value:t,fontSize:n,color:r,pageIndex:i}=S(this,Ba,`f`);return this._hasBeenMoved||e.value!==t||e.fontSize!==n||e.color.some((e,t)=>e!==r[t])||e.pageIndex!==i},Za._freeTextDefaultContent=``,Za._internalPadding=0,Za._defaultColor=`#000000`,Za._defaultFontSize=10,Za._type=`freetext`,Za._editorType=y.FREETEXT;var Qa,$a,eo,to,no,ro,io,ao,oo,so,co,lo,uo,fo,po,mo,ho,go,G,_o,vo,yo,bo,xo,So,Co,wo,To,Eo,Do,Oo,ko,Ao,jo,Mo,No,Po,K,Fo,Io,Lo,Ro=class{constructor(e,t=0,n=0,r=!0){Qa.add(this),$a.set(this,void 0),eo.set(this,[]),to.set(this,[]);let i=1/0,a=-1/0,o=1/0,s=-1/0,c=10**-4;for(let{x:n,y:r,width:l,height:u}of e){let e=Math.floor((n-t)/c)*c,d=Math.ceil((n+l+t)/c)*c,f=Math.floor((r-t)/c)*c,p=Math.ceil((r+u+t)/c)*c,m=[e,f,p,!0],h=[d,f,p,!1];S(this,eo,`f`).push(m,h),i=Math.min(i,e),a=Math.max(a,d),o=Math.min(o,f),s=Math.max(s,p)}let l=a-i+2*n,u=s-o+2*n,d=i-n,f=o-n,p=S(this,eo,`f`).at(r?-1:-2),m=[p[0],p[2]];for(let e of S(this,eo,`f`)){let[t,n,r]=e;e[0]=(t-d)/l,e[1]=(n-f)/u,e[2]=(r-f)/u}C(this,$a,{x:d,y:f,width:l,height:u,lastPoint:m},`f`)}getOutlines(){S(this,eo,`f`).sort((e,t)=>e[0]-t[0]||e[1]-t[1]||e[2]-t[2]);let e=[];for(let t of S(this,eo,`f`))t[3]?(e.push(...S(this,Qa,`m`,oo).call(this,t)),S(this,Qa,`m`,io).call(this,t)):(S(this,Qa,`m`,ao).call(this,t),e.push(...S(this,Qa,`m`,oo).call(this,t)));return S(this,Qa,`m`,no).call(this,e)}};$a=new WeakMap,eo=new WeakMap,to=new WeakMap,Qa=new WeakSet,no=function(e){let t=[],n=new Set;for(let n of e){let[e,r,i]=n;t.push([e,r,n],[e,i,n])}t.sort((e,t)=>e[1]-t[1]||e[0]-t[0]);for(let e=0,r=t.length;e<r;e+=2){let r=t[e][2],i=t[e+1][2];r.push(i),i.push(r),n.add(r),n.add(i)}let r=[],i;for(;n.size>0;){let e=n.values().next().value,[t,a,o,s,c]=e;n.delete(e);let l=t,u=a;for(i=[t,o],r.push(i);;){let e;if(n.has(s))e=s;else if(n.has(c))e=c;else break;n.delete(e),[t,a,o,s,c]=e,l!==t&&(i.push(l,u,t,u===a?a:o),l=t),u=u===a?o:a}i.push(l,u)}return new Bo(r,S(this,$a,`f`))},ro=function(e){let t=S(this,to,`f`),n=0,r=t.length-1;for(;n<=r;){let i=n+r>>1,a=t[i][0];if(a===e)return i;a<e?n=i+1:r=i-1}return r+1},io=function([,e,t]){let n=S(this,Qa,`m`,ro).call(this,e);S(this,to,`f`).splice(n,0,[e,t])},ao=function([,e,t]){let n=S(this,Qa,`m`,ro).call(this,e);for(let r=n;r<S(this,to,`f`).length;r++){let[n,i]=S(this,to,`f`)[r];if(n!==e)break;if(n===e&&i===t){S(this,to,`f`).splice(r,1);return}}for(let r=n-1;r>=0;r--){let[n,i]=S(this,to,`f`)[r];if(n!==e)break;if(n===e&&i===t){S(this,to,`f`).splice(r,1);return}}},oo=function(e){let[t,n,r]=e,i=[[t,n,r]],a=S(this,Qa,`m`,ro).call(this,r);for(let e=0;e<a;e++){let[n,r]=S(this,to,`f`)[e];for(let e=0,a=i.length;e<a;e++){let[,o,s]=i[e];if(!(r<=o||s<=n)){if(o>=n){if(s>r)i[e][1]=r;else{if(a===1)return[];i.splice(e,1),e--,a--}continue}i[e][2]=n,s>r&&i.push([t,r,s])}}}return i};var zo=class{toSVGPath(){throw Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw Error("Abstract getter `box` must be implemented.")}serialize([e,t,n,r]){}get free(){return this instanceof Ho}},Bo=class extends zo{constructor(e,t){super(),so.set(this,void 0),co.set(this,void 0),C(this,co,e,`f`),C(this,so,t,`f`)}toSVGPath(){let e=[];for(let t of S(this,co,`f`)){let[n,r]=t;e.push(`M${n} ${r}`);for(let i=2;i<t.length;i+=2){let a=t[i],o=t[i+1];a===n?(e.push(`V${o}`),r=o):o===r&&(e.push(`H${a}`),n=a)}e.push(`Z`)}return e.join(` `)}serialize([e,t,n,r]){let i=[],a=n-e,o=r-t;for(let t of S(this,co,`f`)){let n=Array(t.length);for(let i=0;i<t.length;i+=2)n[i]=e+t[i]*a,n[i+1]=r-t[i+1]*o;i.push(n)}return i}get box(){return S(this,so,`f`)}};so=new WeakMap,co=new WeakMap;var Vo=class{constructor({x:e,y:t},n,r,i,a,o=0){lo.add(this),fo.set(this,void 0),po.set(this,[]),mo.set(this,void 0),ho.set(this,void 0),go.set(this,[]),G.set(this,new Float64Array(18)),_o.set(this,void 0),vo.set(this,void 0),yo.set(this,void 0),bo.set(this,void 0),xo.set(this,void 0),So.set(this,void 0),Co.set(this,[]),C(this,fo,n,`f`),C(this,So,i*r,`f`),C(this,ho,a,`f`),S(this,G,`f`).set([NaN,NaN,NaN,NaN,e,t],6),C(this,mo,o,`f`),C(this,bo,S(uo,uo,`f`,wo)*r,`f`),C(this,yo,S(uo,uo,`f`,Eo)*r,`f`),C(this,xo,r,`f`),S(this,Co,`f`).push(e,t)}get free(){return!0}isEmpty(){return isNaN(S(this,G,`f`)[8])}add({x:e,y:t}){C(this,_o,e,`f`),C(this,vo,t,`f`);let[n,r,i,a]=S(this,fo,`f`),[o,s,c,l]=S(this,G,`f`).subarray(8,12),u=e-c,d=t-l,f=Math.hypot(u,d);if(f<S(this,yo,`f`))return!1;let p=f-S(this,bo,`f`),m=p/f,h=m*u,ee=m*d,g=o,te=s;o=c,s=l,c+=h,l+=ee,S(this,Co,`f`)?.push(e,t);let ne=-ee/p,re=h/p,ie=ne*S(this,So,`f`),ae=re*S(this,So,`f`);return S(this,G,`f`).set(S(this,G,`f`).subarray(2,8),0),S(this,G,`f`).set([c+ie,l+ae],4),S(this,G,`f`).set(S(this,G,`f`).subarray(14,18),12),S(this,G,`f`).set([c-ie,l-ae],16),isNaN(S(this,G,`f`)[6])?(S(this,go,`f`).length===0&&(S(this,G,`f`).set([o+ie,s+ae],2),S(this,go,`f`).push(NaN,NaN,NaN,NaN,(o+ie-n)/i,(s+ae-r)/a),S(this,G,`f`).set([o-ie,s-ae],14),S(this,po,`f`).push(NaN,NaN,NaN,NaN,(o-ie-n)/i,(s-ae-r)/a)),S(this,G,`f`).set([g,te,o,s,c,l],6),!this.isEmpty()):(S(this,G,`f`).set([g,te,o,s,c,l],6),Math.abs(Math.atan2(te-s,g-o)-Math.atan2(ee,h))<Math.PI/2?([o,s,c,l]=S(this,G,`f`).subarray(2,6),S(this,go,`f`).push(NaN,NaN,NaN,NaN,((o+c)/2-n)/i,((s+l)/2-r)/a),[o,s,g,te]=S(this,G,`f`).subarray(14,18),S(this,po,`f`).push(NaN,NaN,NaN,NaN,((g+o)/2-n)/i,((te+s)/2-r)/a),!0):([g,te,o,s,c,l]=S(this,G,`f`).subarray(0,6),S(this,go,`f`).push(((g+5*o)/6-n)/i,((te+5*s)/6-r)/a,((5*o+c)/6-n)/i,((5*s+l)/6-r)/a,((o+c)/2-n)/i,((s+l)/2-r)/a),[c,l,o,s,g,te]=S(this,G,`f`).subarray(12,18),S(this,po,`f`).push(((g+5*o)/6-n)/i,((te+5*s)/6-r)/a,((5*o+c)/6-n)/i,((5*s+l)/6-r)/a,((o+c)/2-n)/i,((s+l)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return``;let e=S(this,go,`f`),t=S(this,po,`f`),n=S(this,G,`f`).subarray(4,6),r=S(this,G,`f`).subarray(16,18),[i,a,o,s]=S(this,fo,`f`),[c,l,u,d]=S(this,lo,`m`,Do).call(this);if(isNaN(S(this,G,`f`)[6])&&!this.isEmpty())return`M${(S(this,G,`f`)[2]-i)/o} ${(S(this,G,`f`)[3]-a)/s} L${(S(this,G,`f`)[4]-i)/o} ${(S(this,G,`f`)[5]-a)/s} L${c} ${l} L${u} ${d} L${(S(this,G,`f`)[16]-i)/o} ${(S(this,G,`f`)[17]-a)/s} L${(S(this,G,`f`)[14]-i)/o} ${(S(this,G,`f`)[15]-a)/s} Z`;let f=[];f.push(`M${e[4]} ${e[5]}`);for(let t=6;t<e.length;t+=6)isNaN(e[t])?f.push(`L${e[t+4]} ${e[t+5]}`):f.push(`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} ${e[t+5]}`);f.push(`L${(n[0]-i)/o} ${(n[1]-a)/s} L${c} ${l} L${u} ${d} L${(r[0]-i)/o} ${(r[1]-a)/s}`);for(let e=t.length-6;e>=6;e-=6)isNaN(t[e])?f.push(`L${t[e+4]} ${t[e+5]}`):f.push(`C${t[e]} ${t[e+1]} ${t[e+2]} ${t[e+3]} ${t[e+4]} ${t[e+5]}`);return f.push(`L${t[4]} ${t[5]} Z`),f.join(` `)}getOutlines(){let e=S(this,go,`f`),t=S(this,po,`f`),n=S(this,G,`f`),r=n.subarray(4,6),i=n.subarray(16,18),[a,o,s,c]=S(this,fo,`f`),l=new Float64Array((S(this,Co,`f`)?.length??0)+2);for(let e=0,t=l.length-2;e<t;e+=2)l[e]=(S(this,Co,`f`)[e]-a)/s,l[e+1]=(S(this,Co,`f`)[e+1]-o)/c;l[l.length-2]=(S(this,_o,`f`)-a)/s,l[l.length-1]=(S(this,vo,`f`)-o)/c;let[u,d,f,p]=S(this,lo,`m`,Do).call(this);if(isNaN(n[6])&&!this.isEmpty()){let e=new Float64Array(36);return e.set([NaN,NaN,NaN,NaN,(n[2]-a)/s,(n[3]-o)/c,NaN,NaN,NaN,NaN,(n[4]-a)/s,(n[5]-o)/c,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(n[16]-a)/s,(n[17]-o)/c,NaN,NaN,NaN,NaN,(n[14]-a)/s,(n[15]-o)/c],0),new Ho(e,l,S(this,fo,`f`),S(this,xo,`f`),S(this,mo,`f`),S(this,ho,`f`))}let m=new Float64Array(S(this,go,`f`).length+24+S(this,po,`f`).length),h=e.length;for(let t=0;t<h;t+=2){if(isNaN(e[t])){m[t]=m[t+1]=NaN;continue}m[t]=e[t],m[t+1]=e[t+1]}m.set([NaN,NaN,NaN,NaN,(r[0]-a)/s,(r[1]-o)/c,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(i[0]-a)/s,(i[1]-o)/c],h),h+=24;for(let e=t.length-6;e>=6;e-=6)for(let n=0;n<6;n+=2){if(isNaN(t[e+n])){m[h]=m[h+1]=NaN,h+=2;continue}m[h]=t[e+n],m[h+1]=t[e+n+1],h+=2}return m.set([NaN,NaN,NaN,NaN,t[4],t[5]],h),new Ho(m,l,S(this,fo,`f`),S(this,xo,`f`),S(this,mo,`f`),S(this,ho,`f`))}};uo=Vo,fo=new WeakMap,po=new WeakMap,mo=new WeakMap,ho=new WeakMap,go=new WeakMap,G=new WeakMap,_o=new WeakMap,vo=new WeakMap,yo=new WeakMap,bo=new WeakMap,xo=new WeakMap,So=new WeakMap,Co=new WeakMap,lo=new WeakSet,Do=function(){let e=S(this,G,`f`).subarray(4,6),t=S(this,G,`f`).subarray(16,18),[n,r,i,a]=S(this,fo,`f`);return[(S(this,_o,`f`)+(e[0]-t[0])/2-n)/i,(S(this,vo,`f`)+(e[1]-t[1])/2-r)/a,(S(this,_o,`f`)+(t[0]-e[0])/2-n)/i,(S(this,vo,`f`)+(t[1]-e[1])/2-r)/a]},wo={value:8},To={value:2},Eo={value:S(uo,uo,`f`,wo)+S(uo,uo,`f`,To)};var Ho=class extends zo{constructor(e,t,n,r,i,a){super(),Oo.add(this),ko.set(this,void 0),Ao.set(this,null),jo.set(this,void 0),Mo.set(this,void 0),No.set(this,void 0),Po.set(this,void 0),K.set(this,void 0),C(this,K,e,`f`),C(this,No,t,`f`),C(this,ko,n,`f`),C(this,Po,r,`f`),C(this,jo,i,`f`),C(this,Mo,a,`f`),S(this,Oo,`m`,Lo).call(this,a);let{x:o,y:s,width:c,height:l}=S(this,Ao,`f`);for(let t=0,n=e.length;t<n;t+=2)e[t]=(e[t]-o)/c,e[t+1]=(e[t+1]-s)/l;for(let e=0,n=t.length;e<n;e+=2)t[e]=(t[e]-o)/c,t[e+1]=(t[e+1]-s)/l}toSVGPath(){let e=[`M${S(this,K,`f`)[4]} ${S(this,K,`f`)[5]}`];for(let t=6,n=S(this,K,`f`).length;t<n;t+=6){if(isNaN(S(this,K,`f`)[t])){e.push(`L${S(this,K,`f`)[t+4]} ${S(this,K,`f`)[t+5]}`);continue}e.push(`C${S(this,K,`f`)[t]} ${S(this,K,`f`)[t+1]} ${S(this,K,`f`)[t+2]} ${S(this,K,`f`)[t+3]} ${S(this,K,`f`)[t+4]} ${S(this,K,`f`)[t+5]}`)}return e.push(`Z`),e.join(` `)}serialize([e,t,n,r],i){let a=n-e,o=r-t,s,c;switch(i){case 0:s=S(this,Oo,`m`,Fo).call(this,S(this,K,`f`),e,r,a,-o),c=S(this,Oo,`m`,Fo).call(this,S(this,No,`f`),e,r,a,-o);break;case 90:s=S(this,Oo,`m`,Io).call(this,S(this,K,`f`),e,t,a,o),c=S(this,Oo,`m`,Io).call(this,S(this,No,`f`),e,t,a,o);break;case 180:s=S(this,Oo,`m`,Fo).call(this,S(this,K,`f`),n,t,-a,o),c=S(this,Oo,`m`,Fo).call(this,S(this,No,`f`),n,t,-a,o);break;case 270:s=S(this,Oo,`m`,Io).call(this,S(this,K,`f`),n,r,-a,-o),c=S(this,Oo,`m`,Io).call(this,S(this,No,`f`),n,r,-a,-o);break;default:break}return{outline:Array.from(s),points:[Array.from(c)]}}get box(){return S(this,Ao,`f`)}getNewOutline(e,t){let{x:n,y:r,width:i,height:a}=S(this,Ao,`f`),[o,s,c,l]=S(this,ko,`f`),u=i*c,d=a*l,f=n*c+o,p=r*l+s,m=new Vo({x:S(this,No,`f`)[0]*u+f,y:S(this,No,`f`)[1]*d+p},S(this,ko,`f`),S(this,Po,`f`),e,S(this,Mo,`f`),t??S(this,jo,`f`));for(let e=2;e<S(this,No,`f`).length;e+=2)m.add({x:S(this,No,`f`)[e]*u+f,y:S(this,No,`f`)[e+1]*d+p});return m.getOutlines()}};ko=new WeakMap,Ao=new WeakMap,jo=new WeakMap,Mo=new WeakMap,No=new WeakMap,Po=new WeakMap,K=new WeakMap,Oo=new WeakSet,Fo=function(e,t,n,r,i){let a=new Float64Array(e.length);for(let o=0,s=e.length;o<s;o+=2)a[o]=t+e[o]*r,a[o+1]=n+e[o+1]*i;return a},Io=function(e,t,n,r,i){let a=new Float64Array(e.length);for(let o=0,s=e.length;o<s;o+=2)a[o]=t+e[o+1]*r,a[o+1]=n+e[o]*i;return a},Lo=function(e){let t=S(this,K,`f`),n=t[4],r=t[5],i=n,a=r,o=n,s=r,c=n,l=r,u=e?Math.max:Math.min;for(let e=6,d=t.length;e<d;e+=6){if(isNaN(t[e]))i=Math.min(i,t[e+4]),a=Math.min(a,t[e+5]),o=Math.max(o,t[e+4]),s=Math.max(s,t[e+5]),l<t[e+5]?(c=t[e+4],l=t[e+5]):l===t[e+5]&&(c=u(c,t[e+4]));else{let d=yt.bezierBoundingBox(n,r,...t.slice(e,e+6));i=Math.min(i,d[0]),a=Math.min(a,d[1]),o=Math.max(o,d[2]),s=Math.max(s,d[3]),l<d[3]?(c=d[2],l=d[3]):l===d[3]&&(c=u(c,d[2]))}n=t[e+4],r=t[e+5]}let d=i-S(this,jo,`f`),f=a-S(this,jo,`f`),p=o-i+2*S(this,jo,`f`),m=s-a+2*S(this,jo,`f`);C(this,Ao,{x:d,y:f,width:p,height:m,lastPoint:[c,l]},`f`)};var q,J,Uo,Wo,Go,Ko,qo,Jo,Yo,Xo,Zo,Y,Qo,$o,es,X,ts,ns,rs,is,as,os,ss,cs,ls,us,ds,fs,ps,ms,hs,gs,_s,vs=class extends P{constructor(e){super(Object.assign(Object.assign({},e),{name:`k-highlight-editor`})),q.add(this),this.color=``,Uo.set(this,null),Wo.set(this,0),Go.set(this,void 0),Ko.set(this,null),qo.set(this,null),Jo.set(this,null),Yo.set(this,0),Xo.set(this,null),Zo.set(this,null),Y.set(this,null),Qo.set(this,!1),$o.set(this,null),es.set(this,void 0),X.set(this,null),ts.set(this,``),ns.set(this,void 0),rs.set(this,``),this.color=e.color||J._defaultColor,C(this,ns,e.thickness||J._defaultThickness,`f`),C(this,es,e.opacity||J._defaultOpacity,`f`),C(this,Go,e.boxes||null,`f`),C(this,rs,e.methodOfCreation||``,`f`),C(this,ts,e.text||``,`f`),this._isDraggable=!1,e.highlightId>-1?(C(this,Qo,!0,`f`),S(this,q,`m`,as).call(this,e),S(this,q,`m`,ls).call(this)):(C(this,Uo,e.anchorNode,`f`),C(this,Wo,e.anchorOffset,`f`),C(this,Jo,e.focusNode,`f`),C(this,Yo,e.focusOffset,`f`),S(this,q,`m`,is).call(this),S(this,q,`m`,ls).call(this),this.rotate(this.rotation))}get telemetryInitialData(){return{action:`added`,type:S(this,Qo,`f`)?`free_highlight`:`highlight`,color:this._uiManager.highlightColorNames.get(this.color),thickness:S(this,ns,`f`),methodOfCreation:S(this,rs,`f`)}}get telemetryFinalData(){return{type:`highlight`,color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get(`color`).size}}static initialize(e,t){P.initialize(e,t,{}),J._defaultColor||=t.viewer?.options?.annotations?.highlight?.color||`#ffff00`}static updateDefaultParams(e,t){switch(e){case b.HIGHLIGHT_DEFAULT_COLOR:J._defaultColor=t;break;case b.HIGHLIGHT_THICKNESS:J._defaultThickness=t;break;default:break}}translateInPage(){}get toolbarPosition(){return S(this,$o,`f`)}updateParams(e,t){switch(e){case b.HIGHLIGHT_COLOR:S(this,q,`m`,os).call(this,t);break;case b.HIGHLIGHT_THICKNESS:S(this,q,`m`,ss).call(this,t);break;default:break}}static get defaultPropertiesToUpdate(){return[[b.HIGHLIGHT_DEFAULT_COLOR,J._defaultColor],[b.HIGHLIGHT_THICKNESS,J._defaultThickness]]}get propertiesToUpdate(){return[[b.HIGHLIGHT_COLOR,this.color||J._defaultColor],[b.HIGHLIGHT_THICKNESS,S(this,ns,`f`)||J._defaultThickness],[b.HIGHLIGHT_FREE,S(this,Qo,`f`)]]}disableEditing(){super.disableEditing(),this.div.classList.toggle(`k-highlight-editor-disabled`,!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle(`k-highlight-editor-disabled`,!1)}fixAndSetPosition(){return super.fixAndSetPosition(S(this,q,`m`,ps).call(this))}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,S(this,q,`m`,ps).call(this))}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){S(this,q,`m`,cs).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(S(this,q,`m`,ls).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?S(this,q,`m`,cs).call(this):e&&(S(this,q,`m`,ls).call(this,e),t=!this.parent&&(this.div?.classList.contains(`selectedEditor`)||this.div?.classList.contains(`k-selected`))),super.setParent(e),this.show(this._isVisible),t&&this.select()}rotate(e){let{drawLayer:t}=this.parent,n;S(this,Qo,`f`)?(e=(e-this.rotation+360)%360,n=S(J,J,`m`,us).call(J,S(this,Zo,`f`).box,e)):n=S(J,J,`m`,us).call(J,this,e),t.rotate(S(this,Y,`f`),e),t.rotate(S(this,X,`f`),e),t.updateBox(S(this,Y,`f`),n),t.updateBox(S(this,X,`f`),S(J,J,`m`,us).call(J,S(this,qo,`f`).box,e))}render(){if(this.div)return this.div;let e=super.render();S(this,ts,`f`)&&(e.setAttribute(`aria-label`,S(this,ts,`f`)),e.setAttribute(`role`,`mark`)),S(this,Qo,`f`)?e.classList.add(`free`):this.div.addEventListener(`keydown`,S(this,q,`m`,ds).bind(this),{signal:this._uiManager._signal});let t=C(this,Xo,document.createElement(`div`),`f`);e.append(t),t.setAttribute(`aria-hidden`,`true`),t.className=`k-internal internal`,t.style.clipPath=S(this,Ko,`f`);let[n,r]=this.parentDimensions;return this.setDims(this.width*n,this.height*r),Lr(this,S(this,Xo,`f`),[`pointerover`,`pointerleave`]),this.enableEditing(),e}pointerover(){this.parent.drawLayer.addClass(S(this,X,`f`),`hovered`)}pointerleave(){this.parent.drawLayer.removeClass(S(this,X,`f`),`hovered`)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:S(this,q,`m`,fs).call(this,!0);break;case 1:case 3:S(this,q,`m`,fs).call(this,!1);break;default:break}}select(){super.select(),S(this,X,`f`)&&(this.parent?.drawLayer.removeClass(S(this,X,`f`),`hovered`),this.parent?.drawLayer.addClass(S(this,X,`f`),`selected`),this.parent?.drawLayer.addClass(S(this,X,`f`),`k-selected`))}unselect(){super.unselect(),S(this,X,`f`)&&(this.parent?.drawLayer.removeClass(S(this,X,`f`),`selected`),this.parent?.drawLayer.removeClass(S(this,X,`f`),`k-selected`),S(this,Qo,`f`)||S(this,q,`m`,fs).call(this,!1))}get _mustFixPosition(){return!S(this,Qo,`f`)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.show(S(this,Y,`f`),e),this.parent.drawLayer.show(S(this,X,`f`),e))}static startHighlighting(e,t,{target:n,x:r,y:i}){let{x:a,y:o,width:s,height:c}=n.getBoundingClientRect(),l=new AbortController,u=e.combinedSignal(l),d=e=>{e.preventDefault(),e.stopPropagation()},f=t=>{l.abort(),S(this,J,`m`,_s).call(this,e,t)};window.addEventListener(`blur`,f,{signal:u}),window.addEventListener(`pointerup`,f,{signal:u}),window.addEventListener(`pointerdown`,d,{capture:!0,passive:!1,signal:u}),window.addEventListener(`contextmenu`,Et,{signal:u}),n.addEventListener(`pointermove`,S(this,J,`m`,gs).bind(this,e),{signal:u}),this._freeHighlight=new Vo({x:r,y:i},[a,o,s,c],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static deserialize(e,t,n){let r=super.deserialize(e,t,n),{rect:[i,a,o,s],color:c,quadPoints:l}=e;r.color=yt.makeHexColor(...c),C(r,es,e.opacity,`f`);let[u,d]=r.pageDimensions;r.width=(o-i)/u,r.height=(s-a)/d;let f=C(r,Go,[],`f`);for(let e=0;e<l.length;e+=8)f.push({x:(l[4]-o)/u,y:(s-(1-l[e+5]))/d,width:(l[e+2]-l[e])/u,height:(l[e+5]-l[e+1])/d});return S(r,q,`m`,is).call(r),r}serialize(e=!1){if(this.isEmpty()||e)return null;let t=this.getRect(0,0),n=P._colorManager.convert(this.color);return{annotationType:y.HIGHLIGHT,color:n,opacity:S(this,es,`f`),thickness:S(this,ns,`f`),quadPoints:S(this,q,`m`,ms).call(this),outlines:S(this,q,`m`,hs).call(this,t),pageIndex:this.pageIndex,rect:t,rotation:S(this,q,`m`,ps).call(this),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}toJSON(){return this.serialize()}};J=vs,Uo=new WeakMap,Wo=new WeakMap,Go=new WeakMap,Ko=new WeakMap,qo=new WeakMap,Jo=new WeakMap,Yo=new WeakMap,Xo=new WeakMap,Zo=new WeakMap,Y=new WeakMap,Qo=new WeakMap,$o=new WeakMap,es=new WeakMap,X=new WeakMap,ts=new WeakMap,ns=new WeakMap,rs=new WeakMap,q=new WeakSet,is=function(){let e=new Ro(S(this,Go,`f`),.001);C(this,Zo,e.getOutlines(),`f`),{x:this.x,y:this.y,width:this.width,height:this.height}=S(this,Zo,`f`).box;let t=new Ro(S(this,Go,`f`),.0025,.001,this._uiManager.direction===`ltr`);C(this,qo,t.getOutlines(),`f`);let{lastPoint:n}=S(this,qo,`f`).box;C(this,$o,[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height],`f`)},as=function({highlightOutlines:e,highlightId:t,clipPathId:n}){if(C(this,Zo,e,`f`),C(this,qo,e.getNewOutline(S(this,ns,`f`)/2+1.5,.0025),`f`),t>=0)C(this,Y,t,`f`),C(this,Ko,n,`f`),this.parent.drawLayer.finalizeLine(t,e),C(this,X,this.parent.drawLayer.highlightOutline(S(this,qo,`f`)),`f`);else if(this.parent){let t=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(S(this,Y,`f`),e),this.parent.drawLayer.updateBox(S(this,Y,`f`),S(J,J,`m`,us).call(J,S(this,Zo,`f`).box,(t-this.rotation+360)%360)),this.parent.drawLayer.updateLine(S(this,X,`f`),S(this,qo,`f`)),this.parent.drawLayer.updateBox(S(this,X,`f`),S(J,J,`m`,us).call(J,S(this,qo,`f`).box,t))}let{x:r,y:i,width:a,height:o}=e.box;switch(this.rotation){case 0:this.x=r,this.y=i,this.width=a,this.height=o;break;case 90:{let[e,t]=this.parentDimensions;this.x=i,this.y=1-r,this.width=a*t/e,this.height=o*e/t;break}case 180:this.x=1-r,this.y=1-i,this.width=a,this.height=o;break;case 270:{let[e,t]=this.parentDimensions;this.x=1-i,this.y=r,this.width=a*t/e,this.height=o*e/t;break}default:break}let{lastPoint:s}=S(this,qo,`f`).box;C(this,$o,[(s[0]-r)/a,(s[1]-i)/o],`f`)},os=function(e){if(!e)return;let t=e=>{this.color=e,this.parent?.drawLayer.changeColor(S(this,Y,`f`),e)},n=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:b.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},ss=function(e){},cs=function(){S(this,Y,`f`)===null||!this.parent||(this.parent.drawLayer.remove(S(this,Y,`f`)),C(this,Y,null,`f`),this.parent.drawLayer.remove(S(this,X,`f`)),C(this,X,null,`f`))},ls=function(e=this.parent){var t,n;S(this,Y,`f`)===null&&(t=this,n=this,{id:{set value(e){C(t,Y,e,`f`)}}.value,clipPathId:{set value(e){C(n,Ko,e,`f`)}}.value}=e.drawLayer.highlight(S(this,Zo,`f`),this.color,S(this,es,`f`)),C(this,X,e.drawLayer.highlightOutline(S(this,qo,`f`)),`f`),S(this,Xo,`f`)&&(S(this,Xo,`f`).style.clipPath=S(this,Ko,`f`)))},us=function({x:e,y:t,width:n,height:r},i){switch(i){case 90:return{x:1-t-r,y:e,width:r,height:n};case 180:return{x:1-e-n,y:1-t-r,width:n,height:r};case 270:return{x:t,y:1-e-n,width:r,height:n};default:break}return{x:e,y:t,width:n,height:r}},ds=function(e){},fs=function(e){if(!S(this,Uo,`f`))return;let t=window.getSelection();e?t.setPosition(S(this,Uo,`f`),S(this,Wo,`f`)):t.setPosition(S(this,Jo,`f`),S(this,Yo,`f`))},ps=function(){return S(this,Qo,`f`)?this.rotation:0},ms=function(){if(S(this,Qo,`f`))return null;let[e,t]=this.pageDimensions,[n,r]=this.pageTranslation,i=S(this,Go,`f`),a=new Float32Array(i.length*8),o=0;for(let{x:s,y:c,width:l,height:u}of i){let i=s*e+n,d=(1-c-u)*t+r;a[o]=a[o+4]=i,a[o+1]=a[o+3]=d,a[o+2]=a[o+6]=i+l*e,a[o+5]=a[o+7]=d+u*t,o+=8}return a},hs=function(e){return S(this,Zo,`f`).serialize(e,S(this,q,`m`,ps).call(this))},gs=function(e,t){this._freeHighlight.add(t)&&e.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)},_s=function(e,t){this._freeHighlight.isEmpty()?e.drawLayer.removeFreeHighlight(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:`main_toolbar`}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=``},vs._defaultColor=null,vs._defaultOpacity=1,vs._defaultThickness=12,vs._type=`highlight`,vs._editorType=y.HIGHLIGHT,vs._freeHighlightId=-1,vs._freeHighlight=null,vs._freeHighlightClipId=``;var ys,Z,bs,xs,Ss,Cs,ws,Ts,Es,Ds,Os,ks,As,Q,js,Ms,Ns,Ps,Fs,Is,Ls=class{constructor({uiManager:e,pageIndex:t,div:n,accessibilityManager:r,annotationLayer:i,drawLayer:a,textLayer:o,viewport:s}){ys.add(this),this.drawLayer=null,this.pageIndex=0,this.div=null,this.viewport=null,bs.set(this,void 0),xs.set(this,!1),Ss.set(this,null),Cs.set(this,null),ws.set(this,null),Ts.set(this,new Map),Es.set(this,!1),Ds.set(this,!1),Os.set(this,!1),ks.set(this,null),As.set(this,null),Q.set(this,null);let c=[...S(Z,Z,`f`,js).values()];if(!Z._initialized){Z._initialized=!0;for(let t of c)t.initialize({},e)}e.registerEditorTypes(c),C(this,Q,e,`f`),this.pageIndex=t,this.div=n,C(this,bs,r,`f`),C(this,Ss,i,`f`),this.viewport=s,C(this,ks,o,`f`),this.drawLayer=a,S(this,Q,`f`).addLayer(this)}hide(){this.div&&(this.div.hidden=!0)}show(){!this.div||this.isInvisible||(this.div.hidden=!1)}get isEmpty(){return S(this,Ts,`f`).size===0}get isInvisible(){return this.isEmpty&&S(this,Q,`f`).getMode()===y.NONE}updateToolbar(){}updateMode(e=S(this,Q,`f`).getMode()){switch(S(this,ys,`m`,Is).call(this),e){case y.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case y.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case y.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:t}=this.div;for(let n of S(Z,Z,`f`,js).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){return e===S(this,ks,`f`)?.div}addInkEditorIfNeeded(e){if(S(this,Q,`f`).getMode()===y.INK){if(!e){for(let e of S(this,Ts,`f`).values())if(e.isEmpty()){e.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}}setEditingState(e){S(this,Q,`f`).setEditingState(e)}addCommands(e){S(this,Q,`f`).addCommands(e)}toggleDrawing(e=!1){this.div.classList.toggle(`drawing`,!e)}togglePointerEvents(e=!1){this.div.classList.toggle(`k-annotation-editor-layer-disabled`,!e)}toggleAnnotationLayerPointerEvents(e=!1){S(this,Ss,`f`)?.div.classList.toggle(`k-annotation-editor-layer-disabled`,!e)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);let e=new Set;for(let t of S(this,Ts,`f`).values())t.enableEditing(),t.show(!0),t.annotationElementId&&(S(this,Q,`f`).removeChangedExistingAnnotation(t),e.add(t.annotationElementId));if(!S(this,Ss,`f`))return;let t=S(this,Ss,`f`).getEditableAnnotations();for(let n of t){if(n.hide(),S(this,Q,`f`).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;let t=this.deserialize(n);t&&(this.addOrRebuild(t),t.enableEditing())}}disable(){C(this,Os,!0,`f`),this.div.tabIndex=-1,this.togglePointerEvents(!1);let e=new Map,t=new Map;for(let n of S(this,Ts,`f`).values())if(n.disableEditing(),n.annotationElementId){if(n.serialize()!==null){e.set(n.annotationElementId,n);continue}else t.set(n.annotationElementId,n);this.getEditableAnnotation(n.annotationElementId)?.show(),n.remove()}if(S(this,Ss,`f`)){let n=S(this,Ss,`f`).getEditableAnnotations();for(let r of n){let{id:n}=r.data;if(S(this,Q,`f`).isDeletedAnnotationElement(n))continue;let i=t.get(n);if(i){i.resetAnnotationElement(r),i.show(!1),r.show();continue}i=e.get(n),i&&(S(this,Q,`f`).addChangedExistingAnnotation(i),i.renderAnnotationElement(r),i.show(!1)),r.show()}}S(this,ys,`m`,Is).call(this),this.isEmpty&&(this.div.hidden=!0);let{classList:n}=this.div;for(let e of S(Z,Z,`f`,js).values())n.remove(`${e._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),C(this,Os,!1,`f`)}getEditableAnnotation(e){return S(this,Ss,`f`)?.getEditableAnnotation(e)||null}setActiveEditor(e){S(this,Q,`f`).getActive()!==e&&S(this,Q,`f`).setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,S(this,ks,`f`)?.div&&!S(this,As,`f`)){C(this,As,new AbortController,`f`);let e=S(this,Q,`f`).combinedSignal(S(this,As,`f`));S(this,ks,`f`).div.addEventListener(`pointerdown`,S(this,ys,`m`,Ms).bind(this),{signal:e})}}disableTextSelection(){this.div.tabIndex=0,S(this,ks,`f`)?.div&&S(this,As,`f`)&&(S(this,As,`f`).abort(),C(this,As,null,`f`),S(this,ks,`f`).div.classList.remove(`highlighting`))}enableClick(){if(S(this,Cs,`f`))return;C(this,Cs,new AbortController,`f`);let e=S(this,Q,`f`).combinedSignal(S(this,Cs,`f`));this.div.addEventListener(`pointerdown`,this.pointerdown.bind(this),{signal:e}),this.div.addEventListener(`pointerup`,this.pointerup.bind(this),{signal:e})}disableClick(){S(this,Cs,`f`)?.abort(),C(this,Cs,null,`f`)}attach(e){S(this,Ts,`f`).set(e.id,e);let{annotationElementId:t}=e;t&&S(this,Q,`f`).isDeletedAnnotationElement(t)&&S(this,Q,`f`).removeDeletedAnnotationElement(e)}detach(e){S(this,Ts,`f`).delete(e.id),S(this,bs,`f`)?.removePointerInTextLayer(e.contentDiv),!S(this,Os,`f`)&&e.annotationElementId&&S(this,Q,`f`).addDeletedAnnotationElement(e)}remove(e){this.detach(e),S(this,Q,`f`).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1,S(this,Ds,`f`)||this.addInkEditorIfNeeded(!1)}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(S(this,Q,`f`).addDeletedAnnotationElement(e.annotationElementId),P.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),S(this,Q,`f`).addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(),S(this,Q,`f`).addToAnnotationStorage(e)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;let{activeElement:t}=document;e.div.contains(t)&&!S(this,ws,`f`)&&(e._focusEventsAllowed=!1,C(this,ws,setTimeout(()=>{C(this,ws,null,`f`),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener(`focusin`,()=>{e._focusEventsAllowed=!0},{once:!0,signal:S(this,Q,`f`)._signal}),t.focus())},0),`f`)),e._structTreeParentId=S(this,bs,`f`)?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){this.addCommands({cmd:()=>e._uiManager.rebuild(e),undo:()=>{e.remove()},mustExec:!1})}getNextId(){return S(this,Q,`f`).getId()}combinedSignal(e){return S(this,Q,`f`).combinedSignal(e)}canCreateNewEmptyEditor(){return S(this,ys,`a`,Ns)?.canCreateNewEmptyEditor()}pasteEditor(e,t){S(this,Q,`f`).updateToolbar(e),S(this,Q,`f`).updateMode(e);let{offsetX:n,offsetY:r}=S(this,ys,`m`,Fs).call(this),i=this.getNextId(),a=S(this,ys,`m`,Ps).call(this,Object.assign({parent:this,id:i,x:n,y:r,uiManager:S(this,Q,`f`),isCentered:!0},t));a&&this.add(a)}deserialize(e){return S(Z,Z,`f`,js).get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,S(this,Q,`f`))||null}createAndAddNewEditor(e,t,n={}){let r=this.getNextId(),i=S(this,ys,`m`,Ps).call(this,Object.assign({parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:S(this,Q,`f`),isCentered:t},n));return i&&this.add(i),i}addNewEditor(){this.createAndAddNewEditor(S(this,ys,`m`,Fs).call(this),!0)}setSelected(e){S(this,Q,`f`).setSelected(e)}toggleSelected(e){S(this,Q,`f`).toggleSelected(e)}isSelected(e){return S(this,Q,`f`).isSelected(e)}unselect(e){S(this,Q,`f`).unselect(e)}pointerup(e){let{isMac:t}=mt.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&S(this,Es,`f`)){if(C(this,Es,!1,`f`),!S(this,xs,`f`)){C(this,xs,!0,`f`);return}if(S(this,Q,`f`).getMode()===y.STAMP){S(this,Q,`f`).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){if(S(this,Q,`f`).getMode()===y.HIGHLIGHT&&this.enableTextSelection(),S(this,Es,`f`)){C(this,Es,!1,`f`);return}let{isMac:t}=mt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;C(this,Es,!0,`f`);let n=S(this,Q,`f`).getActive();C(this,xs,!n||n.isEmpty(),`f`)}findNewParent(e,t,n){let r=S(this,Q,`f`).findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}destroy(){S(this,Q,`f`).getActive()?.parent===this&&(S(this,Q,`f`).commitOrRemove(),S(this,Q,`f`).setActiveEditor(null)),S(this,ws,`f`)&&(clearTimeout(S(this,ws,`f`)),C(this,ws,null,`f`));for(let e of S(this,Ts,`f`).values())S(this,bs,`f`)?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,S(this,Ts,`f`).clear(),S(this,Q,`f`).removeLayer(this)}render({viewport:e}){this.viewport=e,ht(this.div,e);for(let e of S(this,Q,`f`).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:e}){S(this,Q,`f`).commitOrRemove(),S(this,ys,`m`,Is).call(this);let t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,ht(this.div,e),t!==n)for(let e of S(this,Ts,`f`).values())e.rotate(n);this.addInkEditorIfNeeded(!1)}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return S(this,Q,`f`).viewParameters.realScale}};Z=Ls,bs=new WeakMap,xs=new WeakMap,Ss=new WeakMap,Cs=new WeakMap,ws=new WeakMap,Ts=new WeakMap,Es=new WeakMap,Ds=new WeakMap,Os=new WeakMap,ks=new WeakMap,As=new WeakMap,Q=new WeakMap,ys=new WeakSet,Ms=function(e){S(this,Q,`f`).unselectAll();let{target:t}=e;if(t===S(this,ks,`f`).div||t.classList.contains(`endOfContent`)&&S(this,ks,`f`).div.contains(t)){let{isMac:t}=mt.platform;if(e.button!==0||e.ctrlKey&&t||(S(this,Q,`f`).showAllEditors(`highlight`,!0),S(this,Q,`f`).getMode()===y.NONE))return;S(this,ks,`f`).div.addEventListener(`pointerup`,()=>{S(this,ks,`f`).div.classList.remove(`free`),this.toggleDrawing(!0)},{once:!0,signal:S(this,Q,`f`)._signal}),e.preventDefault()}},Ns=function(){return S(Z,Z,`f`,js).get(S(this,Q,`f`).getMode())},Ps=function(e){let t=S(this,ys,`a`,Ns);return t?new t(e):null},Fs=function(){let{x:e,y:t,width:n,height:r}=this.div.getBoundingClientRect(),i=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+n),s=Math.min(window.innerHeight,t+r),c=(i+o)/2-e,l=(a+s)/2-t,[u,d]=this.viewport.rotation%180==0?[c,l]:[l,c];return{offsetX:u,offsetY:d}},Is=function(){C(this,Ds,!0,`f`);for(let e of S(this,Ts,`f`).values())e.isEmpty()&&e.remove();C(this,Ds,!1,`f`)},Ls._initialized=!1,js={value:new Map([Za,vs].map(e=>[e._editorType,e]))};var Rs,zs,Bs,Vs,Hs,Us=class{constructor(e){this.pdfPage=null,this.annotationEditorLayer=null,this._cancelled=null,this.div=null,this.accessibilityManager=null,Rs.set(this,null),zs.set(this,null),Bs.set(this,null),Vs.set(this,null),Hs.set(this,null),this.pdfPage=e.pdfPage,this.accessibilityManager=e.accessibilityManager,this.annotationEditorLayer=null,this.div=null,this._cancelled=!1,C(this,Hs,e.uiManager,`f`),C(this,Rs,e.annotationLayer||null,`f`),C(this,Vs,e.textLayer||null,`f`),C(this,zs,e.drawLayer||null,`f`),C(this,Bs,e.onAppend||null,`f`)}render(e){return x(this,arguments,void 0,function*(e,t=`display`){if(t!==`display`||this._cancelled)return;let n=e.clone({dontFlip:!0});if(this.div){this.annotationEditorLayer.update({viewport:n}),this.show();return}let r=this.div=document.createElement(`div`);r.className=`k-annotation-editor-layer`,r.hidden=!0,r.dir=S(this,Hs,`f`).direction,S(this,Bs,`f`)?.call(this,r),this.annotationEditorLayer=new Ls({uiManager:S(this,Hs,`f`),div:r,accessibilityManager:this.accessibilityManager,pageIndex:this.pdfPage.pageNumber-1,viewport:n,annotationLayer:S(this,Rs,`f`),textLayer:S(this,Vs,`f`),drawLayer:S(this,zs,`f`)});let i={viewport:n,div:r,annotations:null,intent:t};this.annotationEditorLayer.render(i),this.show()})}cancel(){this._cancelled=!0,this.div&&this.annotationEditorLayer?.destroy()}hide(){this.div&&(this.div.hidden=!0)}show(){!this.div||this.annotationEditorLayer.isInvisible||(this.div.hidden=!1)}destroy(){this.annotationEditorLayer?.destroy()}};Rs=new WeakMap,zs=new WeakMap,Bs=new WeakMap,Vs=new WeakMap,Hs=new WeakMap;var $,Ws,Gs,Ks,qs,Js,Ys,Xs,Zs,Qs,$s,ec,tc,nc,rc,ic,ac;let oc={annotationEditorUIManager:null,annotationStorage:null,downloadManager:null,enableScripting:!1,fieldObjectsPromise:null,findController:null,hasJSActionsPromise:null,get linkService(){return null}},sc=new Map([[`canvasWrapper`,0],[`textLayer`,1],[`annotationLayer`,2],[`annotationEditorLayer`,3],[`xfaLayer`,3]]);var cc=class extends Me{constructor(e,t){super(e,t),$.add(this),this.eventBus=null,this.zoomLayer=null,this.div=null,this.viewport=null,this.id=1,this._accessibilityManager=null,this._annotationCanvasMap=new Map,this.renderTask=null,this.pdfPageRotate=null,this.rotation=null,this.scale=null,this.pdfViewer=null,this.xfaLayer=null,Ws.set(this,St.ENABLE),Gs.set(this,!1),Ks.set(this,null),qs.set(this,null),Js.set(this,or.INITIAL),Ys.set(this,cr.ENABLE),Xs.set(this,new WeakMap),Zs.set(this,[null,null,null,null]),this.textLayer=null,this.textLayerBuilder=null,this.textAccessibilityManager=null,this.annotationLayer=null,this.drawLayer=null,this.annotationEditorLayer=null,this.options={},this.state={},this.pdfPage=null,this.extendOptions(t),this.div=e,this.viewport=this.options.viewport,this.id=this.options.id||this.options.number||1,C(this,Ks,t.layerProperties||oc,`f`),this.eventBus=t.eventBus,this.initScale(),this.pdfViewer=t.pdfViewer,this.pdfPage=t.pdfPage,C(this,Ws,this.pdfViewer.getAnnotationMode(),`f`),this.resetState()}destroy(){this.destroyTextLayer(),this.canvas&&=(this.canvas.width=0,this.canvas.height=0,this.canvas.remove(),null),this.canvasForPrint&&=(this.canvasForPrint.width=0,this.canvasForPrint.height=0,this.canvasForPrint.remove(),null),this.drawLayer?.destroy(),this.annotationLayer?.destroy(),this.annotationEditorLayer?.destroy(),this.div?.remove(),this.div=null,this.pdfViewer=null,this.pdfPage?.cleanup(),this.pdfPage=null}get isEditing(){return S(this,Gs,`f`)}get rawWidth(){return this.viewport?.rawDims?.pageWidth}get rawHeight(){return this.viewport?.rawDims?.pageWidth}setState(e){this.state=be(this.state||{},e)}resetState(){this.setState({})}initScale(){this.scale=this.options.zoomLevel||this.options.scale||1}createPromise(){return je()}getViewport(e={scale:1}){return this.pdfPage?this.pdfPage.getViewport(e):{width:0,height:0}}destroyTextLayer(){this.textLayer?.cancel(),this.textLayer?.destroy(),this.removeTextLayer(),this.textLayer=null}removeTextLayer(){this.textLayer&&this.textLayer.div?.parentNode&&this.textLayer.div?.parentNode.removeChild(this.textLayer.div)}getPrintContentAsync(){let e=this.canvasForPrint,t=this.createPromise(),n=new Image,r=e.height/this.pdfViewer.getPrintScale()*this.pdfViewer.getPdfToCssUnits(),i=e.width/this.pdfViewer.getPrintScale()*this.pdfViewer.getPdfToCssUnits();return n.src=e.toDataURL(),n.width=i,n.height=r,n.onload=()=>{t.resolve(n)},t}loadForPrintAsync({zoomLevel:e=1.25,force:t=!1}){let n=this,r=this.createPromise(),i=this.pdfViewer.state.zoomLevel;if(this.pdfPage&&i===e&&!t)return r.resolve(n);if(this.pdfPage&&i&&(i!==e||t))return this.renderForPrintAsync().then(()=>{this.setState({isPrintingInProgress:!1}),r.resolve(n)}),r;let a=Math.max(0,this.pdfPage._pageIndex);return this.pdfViewer.state.pdfDocument.getPage(a+1).then(()=>{this.renderForPrintAsync().then(()=>{this.setState({isPrintingInProgress:!1}),r.resolve(n)})}),r}renderForPrintAsync(){let e=this.pdfViewer.getPrintUnits(),{canvasContext:t,canvas:n,viewport:r}=this.pdfViewer.createPageElements({pdfPage:this.pdfPage,printUnits:e});this.canvasForPrint=n,this.setState({isPrintingInProgress:!0});let i=this.pdfViewer.state.pdfDocument.getOptionalContentConfig({intent:`print`}),a={canvasContext:t,viewport:r,intent:`print`,annotationMode:St.ENABLE_STORAGE,optionalContentConfigPromise:i,printAnnotationStorage:this.pdfViewer?.annotationStorage?.print};return this.pdfPage.render(a).promise}isBlank(){return this.element&&this.element.getAttribute(`data-blank`)}setBlank(e){this.element&&(e?this.element.setAttribute(`data-blank`,`true`):this.element.removeAttribute(`data-blank`))}get renderingState(){return S(this,Js,`f`)}setPdfPage(e){this.pdfPage=e,this.pdfPageRotate=e.rotate;let t=(this.rotation+this.pdfPageRotate)%360;this.viewport=e.getViewport({scale:this.scale*gt.PDF_TO_CSS_UNITS,rotation:t}),S(this,$,`m`,$s).call(this),this.reset()}hasEditableAnnotations(){return!!this.annotationLayer?.hasEditableAnnotations()}_resetZoomLayer(e=!1){if(!this.zoomLayer)return;let t=this.zoomLayer.firstChild;S(this,Xs,`f`).delete(t),t.width=0,t.height=0,e&&this.zoomLayer.remove(),this.zoomLayer=null}reset({keepZoomLayer:e=!1,keepAnnotationLayer:t=!1,keepAnnotationEditorLayer:n=!1,keepXfaLayer:r=!1,keepTextLayer:i=!1}={}){let a=this.div;if(!a)return;let o=a.childNodes,s=e&&this.zoomLayer||null,c=t&&this.annotationLayer?.div||null,l=n&&this.annotationEditorLayer?.div||null,u=r&&this.xfaLayer?.div||null,d=i&&this.textLayer?.div||null;for(let e=o.length-1;e>=0;e--){let t=o[e];switch(t){case s:case c:case l:case u:case d:continue;default:break}t.remove();let n=S(this,Zs,`f`).indexOf(t);n>=0&&(S(this,Zs,`f`)[n]=null)}a.removeAttribute(`data-loaded`),c&&this.annotationLayer?.hide(),l&&this.annotationEditorLayer?.hide(),u&&this.xfaLayer?.hide(),d&&this.textLayer?.hide(),s||(this.canvas&&(S(this,Xs,`f`).delete(this.canvas),this.canvas.width=0,this.canvas.height=0,delete this.canvas),this._resetZoomLayer())}toggleEditingMode(e){this.hasEditableAnnotations()&&(C(this,Gs,e,`f`),this.reset({keepZoomLayer:!0,keepAnnotationLayer:!0,keepAnnotationEditorLayer:!0,keepXfaLayer:!0,keepTextLayer:!0}))}draw(){return x(this,void 0,void 0,function*(){let{canvasContext:e,canvas:t,canvasWrapper:n,viewport:r,pageElement:i,styles:a}=this.pdfViewer.createPageElements({pdfPage:this.pdfPage,zoom:this.pdfViewer.options.zoomLevel||1});this.isBlank()?(this.element.replaceWith(i),this.element=this.div=i,this.canvas=t):(this.element=this.div=this.element||this.div||i,this.canvas=this.canvas||t),this.options.styles=a,n.appendChild(t),this.element.appendChild(n),S(this,$,`m`,Qs).call(this,n,`canvasWrapper`);let{div:o,pdfPage:s}=this;if(!this.textLayer&&S(this,Ys,`f`)!==cr.DISABLE&&!s.isPureXfa&&(this._accessibilityManager||=new xr,this.textLayer=new Ar({styles:this.options.styles,pdfPage:s,accessibilityManager:this._accessibilityManager,onAppend:e=>{S(this,$,`m`,Qs).call(this,e,`textLayer`)}})),!this.annotationLayer&&S(this,Ws,`f`)!==St.DISABLE){let{annotationStorage:e,annotationEditorUIManager:t,linkService:n}=S(this,Ks,`f`);this._annotationCanvasMap||=new Map,this.annotationLayer=new Ea({pdfPage:s,eventBus:this.eventBus||this.pdfViewer.eventBus,annotationStorage:e,renderForms:S(this,Ws,`f`)===St.ENABLE_FORMS,linkService:n,annotationCanvasMap:this._annotationCanvasMap,accessibilityManager:this._accessibilityManager,annotationEditorUIManager:t,onAppend:e=>{S(this,$,`m`,Qs).call(this,e,`annotationLayer`)}})}S(this,Xs,`f`).set(t,r);let c={canvasContext:e,viewport:r,annotationMode:S(this,Ws,`f`),annotationCanvasMap:this._annotationCanvasMap,isEditing:S(this,Gs,`f`)},l=this.renderTask=s.render(c),u=l.promise.then(()=>x(this,void 0,void 0,function*(){yield S(this,$,`m`,ac).call(this,l),yield S(this,$,`m`,ic).call(this),this.annotationLayer&&(yield S(this,$,`m`,tc).call(this));let{annotationEditorUIManager:e}=S(this,Ks,`f`);e&&(this.drawLayer||=new Ia({pageIndex:this.id}),yield S(this,$,`m`,rc).call(this),this.drawLayer.setParent(n),this.annotationEditorLayer||=new Us({uiManager:e,pdfPage:s,accessibilityManager:this._accessibilityManager,annotationLayer:this.annotationLayer?.annotationLayer,textLayer:this.textLayer,drawLayer:this.drawLayer.getDrawLayer(),onAppend:e=>{S(this,$,`m`,Qs).call(this,e,`annotationEditorLayer`)}}),S(this,$,`m`,nc).call(this))}),e=>{});return s.isPureXfa,o.setAttribute(`data-loaded`,!0),this.eventBus.dispatch(`pagerender`,{source:this,pageNumber:this.id}),u})}};Ws=new WeakMap,Gs=new WeakMap,Ks=new WeakMap,qs=new WeakMap,Js=new WeakMap,Ys=new WeakMap,Xs=new WeakMap,Zs=new WeakMap,$=new WeakSet,Qs=function(e,t){let n=sc.get(t),r=S(this,Zs,`f`)[n];if(S(this,Zs,`f`)[n]=e,r){r.replaceWith(e);return}for(let t=n-1;t>=0;t--){let n=S(this,Zs,`f`)[t];if(n){n.after(e);return}}this.div.prepend(e)},$s=function(){let{viewport:e}=this;if(this.pdfPage){if(S(this,qs,`f`)===e.rotation)return;C(this,qs,e.rotation,`f`)}!this.div||!e||ht(this.div,e,!0,!1)},ec=function(e,t){this.eventBus.dispatch(e,{source:this,pageNumber:this.id,error:t})},tc=function(){return x(this,void 0,void 0,function*(){let e=null;try{yield this.annotationLayer.render(this.viewport,`display`)}catch(t){console.error(`#renderAnnotationLayer: "${t}".`),e=t}finally{S(this,$,`m`,ec).call(this,`annotationlayerrendered`,e)}})},nc=function(){return x(this,void 0,void 0,function*(){let e=null;try{yield this.annotationEditorLayer.render(this.viewport)}catch(t){e=t}finally{S(this,$,`m`,ec).call(this,`annotationeditorlayerrendered`,e)}})},rc=function(){return x(this,void 0,void 0,function*(){try{yield this.drawLayer.render(`display`)}catch{}})},ic=function(){return x(this,void 0,void 0,function*(){if(!this.textLayer)return;let e=null;try{yield this.textLayer.render(this.viewport)}catch(t){if(t instanceof Ct)return;e=t}S(this,$,`m`,ec).call(this,`textlayerrendered`,e)})},ac=function(e){return x(this,void 0,void 0,function*(){e===this.renderTask&&(this.renderTask=null),this._resetZoomLayer(!0),this.eventBus.dispatch(`pagerendered`,{source:this,pageNumber:this.id,cssTransform:!1,timestamp:performance.now(),error:`page render error`})})};var lc,uc;let dc={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4};var fc=class{constructor({eventBus:e=null,externalLinkTarget:t=null,externalLinkRel:n=null,ignoreDestinationZoom:r=!1}={}){this.eventBus=null,this.externalLinkTarget=null,this.externalLinkRel=null,this._ignoreDestinationZoom=null,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null,this.externalLinkEnabled=!0,this.eventBus=e,this.externalLinkTarget=t,this.externalLinkRel=n,this._ignoreDestinationZoom=r,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null}setDocument(e,t=null){this.baseUrl=t,this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setHistory(e){this.pdfHistory=e}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return this.pdfDocument?this.pdfViewer.currentPageNumber:1}set page(e){this.pdfDocument&&(this.pdfViewer.currentPageNumber=e)}get rotation(){return this.pdfDocument?this.pdfViewer.pagesRotation:0}set rotation(e){this.pdfDocument&&(this.pdfViewer.pagesRotation=e)}get isInPresentationMode(){return this.pdfDocument?this.pdfViewer.isInPresentationMode:!1}goToDestination(e){return x(this,void 0,void 0,function*(){if(!this.pdfDocument)return;let t,n,r;if(typeof e==`string`?(t=e,n=yield this.pdfDocument.getDestination(e)):(t=null,n=yield e),!Array.isArray(n))return;let[i]=n;if(i&&typeof i==`object`){if(r=this.pdfDocument.cachedPageNumber(i),!r)try{r=(yield this.pdfDocument.getPageIndex(i))+1}catch{console.error(`goToDestination: "${i}" is not a valid page reference, for dest="${e}".`);return}}else Number.isInteger(i)&&(r=i+1);if(!r||r<1||r>this.pagesCount){console.error(`goToDestination: "${r}" is not a valid page number, for dest="${e}".`);return}this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.push({namedDest:t,explicitDest:n,pageNumber:r})),this.pdfViewer.scrollPageIntoView({pageNumber:r,destArray:n,ignoreDestinationZoom:this._ignoreDestinationZoom})})}goToPage(e){if(!this.pdfDocument)return;let t=typeof e==`string`&&this.pdfViewer.pageLabelToPageNumber(e)||e|0;if(!(Number.isInteger(t)&&t>0&&t<=this.pagesCount)){console.error(`PDFLinkService.goToPage: "${e}" is not a valid page.`);return}this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.pushPage(t)),this.pdfViewer.scrollPageIntoView({pageNumber:t})}addLinkAttributes(e,t,n=!1){if(!t||typeof t!=`string`)throw Error(`A valid "url" parameter must provided.`);let r=n?dc.BLANK:this.externalLinkTarget,i=this.externalLinkRel;this.externalLinkEnabled?e.href=e.title=t:(e.href=``,e.title=`Disabled: ${t}`,e.onclick=()=>!1);let a=``;switch(r){case dc.NONE:break;case dc.SELF:a=`_self`;break;case dc.BLANK:a=`_blank`;break;case dc.PARENT:a=`_parent`;break;case dc.TOP:a=`_top`;break;default:break}e.target=a,e.rel=typeof i==`string`?i:`noopener noreferrer nofollow`}getDestinationHash(e){if(typeof e==`string`){if(e.length>0)return this.getAnchorUrl(`#`+escape(e))}else if(Array.isArray(e)){let t=JSON.stringify(e);if(t.length>0)return this.getAnchorUrl(`#`+escape(t))}return this.getAnchorUrl(``)}getAnchorUrl(e){return this.baseUrl?this.baseUrl+e:e}setHash(e){if(!this.pdfDocument)return;let t,n;if(e.includes(`=`)){let r=dr(e);if(r.has(`search`)){let e=r.get(`search`).replaceAll(`"`,``),t=r.get(`phrase`)===`true`;this.eventBus.dispatch(`findfromurlhash`,{source:this,query:t?e:e.match(/\S+/g)})}if(r.has(`page`)&&(t=r.get(`page`)|0||1),r.has(`zoom`)){let e=r.get(`zoom`).split(`,`),t=e[0],i=parseFloat(t);t.includes(`Fit`)?t===`Fit`||t===`FitB`?n=[null,{name:t}]:t===`FitH`||t===`FitBH`||t===`FitV`||t===`FitBV`?n=[null,{name:t},e.length>1?e[1]|0:null]:t===`FitR`?e.length===5?n=[null,{name:t},e[1]|0,e[2]|0,e[3]|0,e[4]|0]:console.error(`PDFLinkService.setHash: Not enough parameters for "FitR".`):console.error(`PDFLinkService.setHash: "${t}" is not a valid zoom value.`):n=[null,{name:`XYZ`},e.length>1?e[1]|0:null,e.length>2?e[2]|0:null,i?i/100:t]}n?this.pdfViewer.scrollPageIntoView({pageNumber:t||this.page,destArray:n,allowNegativeOffset:!0}):t&&(this.page=t),r.has(`pagemode`)&&this.eventBus.dispatch(`pagemode`,{source:this,mode:r.get(`pagemode`)}),r.has(`nameddest`)&&this.goToDestination(r.get(`nameddest`));return}n=unescape(e);try{n=JSON.parse(n),Array.isArray(n)||(n=n.toString())}catch(e){if(!e)return}(typeof n==`string`||S(lc,lc,`m`,uc).call(lc,n))&&this.goToDestination(n)}executeNamedAction(e){if(this.pdfDocument){switch(e){case`GoBack`:this.pdfHistory?.back();break;case`GoForward`:this.pdfHistory?.forward();break;case`NextPage`:this.pdfViewer.nextPage();break;case`PrevPage`:this.pdfViewer.previousPage();break;case`LastPage`:this.page=this.pagesCount;break;case`FirstPage`:this.page=1;break;default:break}this.eventBus.dispatch(`namedaction`,{source:this,action:e})}}executeSetOCGState(e){return x(this,void 0,void 0,function*(){if(!this.pdfDocument)return;let t=this.pdfDocument,n=yield this.pdfViewer.optionalContentConfigPromise;t===this.pdfDocument&&(n.setOCGState(e),this.pdfViewer.optionalContentConfigPromise=Promise.resolve(n))})}};lc=fc,uc=function(e){if(!Array.isArray(e)||e.length<2)return!1;let[t,n,...r]=e;if(!(typeof t==`object`&&Number.isInteger(t?.num)&&Number.isInteger(t?.gen))&&!Number.isInteger(t)||!(typeof n==`object`&&typeof n?.name==`string`))return!1;let i=r.length,a=!0;switch(n.name){case`XYZ`:if(i<2||i>3)return!1;break;case`Fit`:case`FitB`:return i===0;case`FitH`:case`FitBH`:case`FitV`:case`FitBV`:if(i>1)return!1;break;case`FitR`:if(i!==4)return!1;a=!1;break;default:return!1}for(let e of r)if(!(typeof e==`number`||a&&e===null))return!1;return!0};var pc;(function(e){e[e.TextSelection=0]=`TextSelection`,e[e.Pan=1]=`Pan`})(pc||={});var mc,hc,gc,_c,vc,yc,bc,xc;let Sc=`error`,Cc=`zoomStart`,wc=`zoomEnd`,Tc=`pageRendered`,Ec=`pagesLoad`,Dc=`printEnd`,Oc=`scroll`,kc=`annotationEditorToolBarShow`,Ac=`annotationEditorToolBarHide`,jc=1.25;var Mc=class extends Me{constructor(e,t){super(e,t),mc.add(this),this.options={pdfServiceType:`pdfjs`,pdfjsSetHiddenCanvasStyles:!0,fileData:[],page:1,fileDescriptor:null,downloadFileName:`Document`,minZoom:.5,maxZoom:4,zoomRate:.25,zoomLevel:jc,zoomBeforePrint:!1,zoomLevelForPrint:3,renderForms:!1,searchMatchScrollLeftOffset:0,searchMatchScrollTopOffset:-64,pageChangeScrollThreshold:.85,pageWheelThrottleDelay:200,printScale:3,renderScale:3,loadOnDemand:!1,loadOnDemandPageSize:2,messages:{freeTextEditorPlaceholder:`Start typing`,errorMessages:{parseError:`PDF file fails to process.`,notFound:`File is not found.`,popupBlocked:`Popup is blocked.`}},annotations:{highlight:{color:`#ffff00`}},elementSelectors:{pageSelector:`k-page:not(.k-blank-page)`,anyPageSelector:`k-page`,pagesContainerClass:`k-pdf-viewer-pages`,pageCanvasWrapper:`k-canvas-wrapper`,documentContainerClass:`k-pdf-viewer-canvas`,textLayerClass:`k-text-layer`,searchHighlightClass:`k-search-highlight`,searchHighlightMarkClass:`k-search-highlight-mark`,charClass:`k-text-char`,textElementSelector:`span[role='presentation']`,renderedPageSelector:`k-page[data-page-number]`,enabledTextSelectionClass:`k-enable-text-select`,enabledPanningClass:`k-enable-panning`},events:{[Tc]:De,[Ec]:De,[Dc]:De,[Cc]:De,[wc]:De,[Sc]:De,[Oc]:De,[kc]:De,[Ac]:De}},this.interactionMode=pc.TextSelection,this.printContainer=null,this._scrollMode=lr.PAGE,this.isInPresentationMode=!1,this._currentPageNumber=1,this.linkService=null,this.annotationStorage=null,this._annotationStorageModified=!1,this._hasAnnotationEditors=!1,hc.set(this,y.NONE),this.annotationEditorUIManager=null,gc.set(this,null),_c.set(this,Yt.ENABLE),vc.set(this,null),yc.set(this,null),this.state={},this.pdfDocument=null,this.pages=[],this.triggerError=e=>{this.trigger(Sc,{error:e})},this.triggerPrintEnd=e=>{this.trigger(Dc,e)},this.onPagesLoad=e=>{this.state.pdfDocument=e.pdfDoc,this.state.pdfPages=e.pdfPages,this.clearSearch(),this.initSearchService(),this.enableDocumentScrollEventsTracking(),this.triggerPagesLoad(e)},this.onDocumentScrollerScroll=e=>{let t=this.getCurrentPageIndex(),n=this.pages,r=n[t],i=n[t+1],a=n[t-1];r&&r.isBlank()&&this.drawPageAsync({pageIndex:t}),i&&i.isBlank()&&this.drawPageAsync({pageIndex:t+1}),a&&a.isBlank()&&this.drawPageAsync({pageIndex:t-1}),this.tryTriggerScroll(e)},this.tryTriggerScroll=e=>{let t=!1,n=this.getCurrentPageIndex()+1;n!==this.state.activePageNumber&&n>=1&&n<=this.state.pdfDocument.numPages&&(t=!0,this.state.activePageNumber=n),this.shouldPreventScroll?this.shouldPreventScroll=!1:this.trigger(Oc,{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop,pageNumber:this.state.activePageNumber,isPageChanged:t})},this.printDocumentAsync=()=>{this.initPrintContainer();let e=this.getPagesPrintContentAsync(this.printContainer),t=je();return Promise.all(e).then(()=>{setTimeout(()=>{this.openPrintDialog(),t.resolve()},16.666666666666668)}),t},this.onDocumentWheel=e=>{if(!e.ctrlKey&&!e.metaKey)return;e.preventDefault(),e.stopPropagation();let t=Ae(e)<0?1:-1,n=this.state.zoomLevel+t*this.options.zoomRate;this.triggerZoomStart({zoomLevel:n}),this.zoom({zoomLevel:n}),this.triggerZoomEnd({zoomLevel:n})},this.extendOptions(t),this.throwIfInvalidOptions(),this.wrapper=this.element,this.initEventBus(),C(this,vc,new AbortController,`f`),this.options.renderForms&&C(this,_c,Yt.ENABLE_FORMS,`f`),this.resetState(),this.bindEvents(),this.initLinkService(),this.initDocumentContainer(),this.setHiddenCanvasStyles(),this.loadFile(this.options.fileDescriptor||{data:this.options.fileData,page:this.options.page})}destroy(){this.destroyEventBus(),this.unbindEvents(),this.clearDocument(),this.destroySearchService(),this.destroyAnnotationEditorUIManager(),this.destroyDocumentScroller()}throwIfInvalidOptions(){if(this.options.minZoom>this.options.maxZoom)throw Error(`The min zoom should be greater than max zoom`)}set annotationEditorParams({type:e,value:t}){this.annotationEditorUIManager&&this.annotationEditorUIManager.updateParams(e,t)}get annotationEditorMode(){return this.annotationEditorUIManager?S(this,hc,`f`):y.DISABLE}set annotationEditorMode({mode:e,editId:t=null,isFromKeyboard:n=!1}){if(this.annotationEditorUIManager,S(this,hc,`f`)===e||!this.isValidAnnotationEditorMode(e)||!this.pdfDocument)return;y.STAMP;let{eventBus:r}=this,i=()=>{this.cleanupSwitchAnnotationEditorMode(),C(this,hc,e,`f`),this.annotationEditorUIManager.updateMode(e,t,n),r.dispatch(`annotationeditormodechanged`,{source:this,mode:e})};if(e===y.NONE||S(this,hc,`f`)===y.NONE){let t=e!==y.NONE;t||this.pdfDocument.annotationStorage.resetModifiedIds();for(let e of this.pages)e.toggleEditingMode(t);let n=S(this,mc,`m`,bc).call(this);if(t&&n){this.cleanupSwitchAnnotationEditorMode(),C(this,yc,({pageNumber:e})=>{n.delete(e),n.size===0&&C(this,gc,setTimeout(i,0),`f`)},`f`);let{signal:e}=S(this,vc,`f`);r._on(`pagerendered`,S(this,yc,`f`),{signal:e})}}i()}getAnnotationMode(){return S(this,_c,`f`)}getPrintUnits(){return this.getPrintScale()}getPdfToCssUnits(){return gt.PDF_TO_CSS_UNITS}getPrintScale(){return this.getPrintResolution()/gt.PDF}getPrintResolution(){return 100*this.options.printScale}getRenderScale(){return Pt(this.options.renderScale)}extendOptions(e){this.options=be(this.options,e)}setOptions(e){this.options=e}bindEvents(){this.bindPagesWheel()}bindPagesWheel(){let e=this.getDocumentContainer();e&&(this.options.pageWheelThrottleDelay>0?this.throttledPagesWheel=Ne(this.onDocumentWheel,this.options.pageWheelThrottleDelay):this.throttledPagesWheel=this.onDocumentWheel,e.addEventListener(`wheel`,this.throttledPagesWheel))}unbindEvents(){this.unbindPagesWheel()}unbindPagesWheel(){let e=this.getDocumentContainer();e&&(this.throttledPagesWheel&&this.throttledPagesWheel.cancel&&this.throttledPagesWheel.cancel(),e.removeEventListener(`wheel`,this.throttledPagesWheel))}setState(e){this.state=be(this.state||{},e)}resetState(){this.setState({activePageNumber:1,visiblePagesCount:1,pagePromises:[],downloadFilePromise:null,pdfDocument:null,zoomLevel:this.options.zoomLevel,zoomLevelType:this.options.zoomLevelType,zoomLevelBeforePrint:null})}initEventBus(){this.eventBus=new ar}destroyEventBus(){}initLinkService(){this.linkService=new fc({eventBus:this.eventBus,externalLinkTarget:dc.BLANK,externalLinkRel:`noopener noreferrer nofollow`,ignoreDestinationZoom:!1}),this.linkService?.setViewer(this)}initAnnotationEditorUIManager(){this.annotationEditorUIManager=new rr({container:this.getDocumentContainer(),viewer:this.element,pdfViewer:this,pdfDocument:this.state.pdfDocument,eventBus:this.eventBus}),this.setAnnotationEditorUIManagerScale()}setAnnotationEditorUIManagerScale(){this.annotationEditorUIManager?.onScaleChanging({scale:this.options.zoomLevel})}destroyAnnotationEditorUIManager(){this.annotationEditorUIManager?.destroy(),this.annotationEditorUIManager=null}bindEventBusAnnotationsEvents(){let e=this.eventBus=this.eventBus||new ar;e._on(`switchannotationeditorparams`,e=>{this.annotationEditorParams=e}),e._on(`switchannotationeditormode`,t=>{this.annotationEditorUIManager.updateParams(t.type,t.value);let{mode:n,editId:r,isFromKeyboard:i}=t;this.annotationEditorUIManager.annotationEditorMode=t,this.annotationEditorUIManager.updateMode(n,r,i),e.dispatch(`annotationeditormodechanged`,{source:this,mode:n})}),e._on(`kendoAnnotationEditorToolBarShow`,e=>{if(!e)return;let t=this.annotationEditorUIManager.getMode();(t===y.HIGHLIGHT||t===y.FREETEXT)&&(t===y.HIGHLIGHT&&this.addHighlightAnnotation(),this.triggerAnnotationEditorToolBarShow(Object.assign(Object.assign({},e),{annotationEditorMode:t===y.HIGHLIGHT?`highlight`:`freeText`,anchor:e.anchor||this.annotationEditorUIManager.firstSelectedEditor?.div})))}),e._on(`kendoAnnotationEditorToolBarHide`,e=>{if(!e)return;let t=this.annotationEditorUIManager.getMode();(t===y.HIGHLIGHT||t===y.FREETEXT)&&this.triggerAnnotationEditorToolBarHide(Object.assign(Object.assign({},e),{annotationEditorMode:t===y.HIGHLIGHT?`highlight`:`freeText`}))}),e._on(`showannotationeditorui`,t=>{switch(t.mode){case y.HIGHLIGHT:e.dispatch(`switchannotationeditormode`,{source:this,mode:y.HIGHLIGHT,isFromKeyboard:!1});break;default:break}})}unbindEventBusAnnotationsEvents(){}loadFile(e){let t=e.data,n={data:null,url:``,arrayBuffer:null,typedArray:null};if(t&&(t.buffer instanceof ArrayBuffer||t instanceof ArrayBuffer)?n.arrayBuffer=t.buffer||t:Se(t)&&t!==``?(n.data=t,n.url=null):Se(e.url)&&e.url!==``?(n.data=null,n.url=e.url):e.typedArray&&(n.typedArray=e.typedArray),e.data||e.url||e.arrayBuffer||e.typedArray){let e=Object.assign({dom:this.getPagesContainer(),zoom:this.options.zoomLevel},n);this.disableDocumentScrollEventsTracking(),this.clearDocument(),this.initEventBus(),C(this,vc,new AbortController,`f`),this.bindEvents(),this.initLinkService(),this.initDocumentContainer(),this.loadDocument(e),this.setScaleFactor(this.options.zoomLevel)}}loadDocument(e){let t=this.getDocumentParameters(e),{zoom:n}=e;this.clearDocumentState(),xt(t).promise.then(e=>{this.linkService?.setDocument(e),this.initDocumentAnnotationStorage(e),this.initAnnotationEditorUIManager(),this.bindEventBusAnnotationsEvents();let t=[];for(let n=1;n<=e.numPages;n++)t.push(e.getPage(n));return{pagesPromises:t,pdfDoc:e}}).then(({pagesPromises:e,pdfDoc:t})=>(this.state.pagesPromises=e,this.destroyPageComponents(),this.drawPagesFromPromisesAsync(e).then(e=>{this.onPagesLoad({pdfPages:e,pdfDoc:t,zoom:n})}).catch(e=>{this.triggerError(e)}))).catch(e=>{this.triggerError(e)}).finally(()=>{this.linkService?.setDocument(this.pdfDocument)})}initDocumentAnnotationStorage(e){this.state.pdfDocument=e,this.pdfDocument=e,this.annotationStorage=new gi,Object.defineProperty(Object.getPrototypeOf(this.pdfDocument._transport),`annotationStorage`,{get:()=>this.state.isPrintingInProgress?this.annotationStorage?.print:this.annotationStorage,set:e=>{this.annotationStorage=e},configurable:!0}),this._initializeAnnotationStorageCallbacks(e)}_initializeAnnotationStorageCallbacks(e){if(e!==this.pdfDocument)return;let{annotationStorage:t}=e;t.onSetModified=()=>{this._annotationStorageModified=!0},t.onResetModified=()=>{delete this._annotationStorageModified},t.onAnnotationEditor=e=>{this._hasAnnotationEditors=!!e}}drawPagesFromPromisesAsync(e){return Promise.all(e).then(e=>x(this,void 0,void 0,function*(){let t=yield Promise.all(this.drawPagesAsync(e));return this.appendPages(t),e}))}drawPagesAsync(e){if(e||=this.state.pdfPages,!((this.pages||[]).length>0))this.initPageComponents(e);else for(let e=0;e<this.pages.length;e++){let t=this.pages[e].getViewport({scale:this.state.zoomLevel});this.pages[e].viewport=t}let t=[];return e.map((e,n)=>x(this,void 0,void 0,function*(){let r=this.pages[n];if(this.options.loadOnDemand&&n>=this.options.loadOnDemandPageSize&&!r.element){let n=this.createBlankPageElements({pdfPage:e,zoom:this.state.zoomLevel});r&&!r.element&&(r.element=n.pageElement,r.setBlank(!0));let i=je();t.push(i),i.then(e=>e),i.resolve(r.element)}else if(this.options.loadOnDemand&&r.isBlank()){let e=je();t.push(e),e.then(e=>e),e.resolve(r.element)}else{let e=this.drawPageAsync({pageIndex:n});t.push(e),e.then(e=>e)}})),t}createBlankPageElements({pdfPage:e,zoom:t}){let n=this.createPageElements({pdfPage:e,zoom:t});return n.canvasWrapper.appendChild(n.canvas),n.pageElement.appendChild(n.canvasWrapper),n}getDocumentParameters(e){let t={verbosity:0,isEvalSupported:!0};return typeof e.data==`string`&&e.data!==``?t.data=Ft(e.data):typeof e.url==`string`&&e.url!==``?t.url=e.url:e.arrayBuffer instanceof ArrayBuffer?t=e.arrayBuffer:e.typedArray&&(t=e.typedArray),t}appendPages(e){e.forEach(e=>this.appendPage(e))}appendPage(e,t=null){let n=this.getPagesContainer();Ee(t)?n?.insertBefore(e,n.children[t]):n?.appendChild(e)}drawPageAsync({pageIndex:e=0}){let t=qt(e,0,Math.max(0,this.state.pdfDocument.numPages-1));return this.pages[t]?.draw().then(()=>(this.triggerPageRendered({page:this.pages[t]}),this.pages[t].element))}createPageElements({pdfPage:e=null,zoom:t=1,printUnits:n=null}){if(t<=0)return;let r=this.getRenderScale();n&&(r=this.getPrintScale());let i=e?.getViewport({scale:r}),{adjustedWidth:a,adjustedHeight:o,adjustRatio:s}=zt(i.width,i.height),c={width:`round(var(--scale-factor) * ${i.width/r}px, 1px)`,height:`round(var(--scale-factor) * ${i.height/r}px, 1px)`},l=It(`div`,`k-page`,c),u=It(`canvas`,``,{});u.height=o,u.width=a,n?(u.style.width=`${i.width/r}px`,u.style.height=`${i.height/r}px`):(u.style.width=`100%`,u.style.height=`100%`);let d=u.getContext(`2d`);n&&(d.imageSmoothingEnabled=!1);let f=Oe(`
            <div class="${this.options.elementSelectors.pageCanvasWrapper}"></div>
        `),p=s*r;return i.width=a,i.height=o,i.scale=p,{canvasContext:d,canvasWrapper:f,canvas:u,viewport:i,scaleNum:r,pageElement:l,styles:c}}triggerPageRendered(e){this.trigger(Tc,e)}triggerPagesLoad(e){this.trigger(Ec,e)}triggerZoomStart(e){this.trigger(Cc,e)}triggerZoomEnd(e){this.trigger(wc,e)}triggerDownload(e){return this.trigger(`download`,e)}triggerAnnotationEditorToolBarShow(e){this.trigger(kc,e)}triggerAnnotationEditorToolBarHide(e){this.trigger(Ac,e)}clearDocument(){this.destroyEventBus(),this.unbindEvents(),this.destroySearchService(),this.destroyAnnotationEditorUIManager(),this.clearDocumentState()}clearDocumentState(){this.clearPagesState(),this.state.pdfDocument=null,this.state.pdfPages=[],this.linkService?.setDocument(null)}clearPagesState(){this.pages.forEach(e=>e.destroy()),this.clearPagesElements(),this.pages=[]}initPageComponents(e){let t=this.options.zoomLevel,n=e[0].getViewport({scale:t*gt.PDF_TO_CSS_UNITS});for(let r=1;r<=e.length;r++){let i=r-1,a=new cc(null,{pdfViewer:this,container:this.element,eventBus:this.eventBus,id:r,scale:t,viewport:n,defaultViewport:n,textLayerMode:cr.ENABLE,annotationMode:this.getAnnotationMode(),layerProperties:this._layerProperties});this.pages.push(a),this.pages[i].setPdfPage(e[i])}}destroyPageComponents(){this.pages.forEach(e=>e.destroy()),this.pages=[]}clearPagesElements(){let e=this.getDocumentContainer(),t=this.getPagesContainer();!e||!t||!this.hasDocument()||this.getPagesElements().forEach(e=>{t.removeChild(e)})}initDocumentContainer(){this.documentContainer||(this.documentContainer=this.getDocumentContainer(),this.initDocumentScroller(this.documentContainer))}initDocumentScroller(e){this.documentScroller||!e||(this.documentScroller=this.createDocumentScroller(e,{filter:ke(this.options.elementSelectors.pageSelector),events:{[Oc]:this.onDocumentScrollerScroll}}))}createDocumentScroller(e,t){return new Re(e,t)}destroyDocumentScroller(){this.documentScroller&&=(this.documentScroller.destroy(),null)}enableDocumentScrollEventsTracking(){this.documentScroller?.enableScrollEventsTracking()}disableDocumentScrollEventsTracking(){this.documentScroller?.disableScrollEventsTracking()}getCurrentPageIndex(){return Rt(this.element)||0}downloadFile({fileName:e,saveOptions:t={}}){this.downloadDocument({options:{pdf:this.state.pdfDocument},fileName:e||this.options.downloadFileName,saveOptions:t})}downloadDocument({options:e,fileName:t=`Document`,saveOptions:n={}}){e.pdf&&this.extractPdfData(e).then(e=>{if(e)return new Blob([e],{type:`application/pdf`})}).then(e=>{e&&!this.triggerDownload({blob:e,fileName:t,saveOptions:n})&&this.saveFile(e,t,n)}).catch(e=>{this.triggerError(e)})}getFileAsByteArray(){return this.extractPdfData({pdf:this.state.pdfDocument})}extractPdfData(e){if(!e.pdf)return Promise.resolve(null);let t=e.pdf.getData.bind(e.pdf),n={},r={};return e.pdf.annotationStorage.size>0&&(t=e.pdf.saveDocument.bind(e.pdf),n={},r=e.pdf.annotationStorage.getAll(),Object.keys(r).forEach(e=>{typeof r[e]?.toJSON==`function`?n[e]=r[e].toJSON():n[e]=r[e]}),Object.keys(r).forEach(t=>{e.pdf.annotationStorage.remove(t)}),Object.keys(n).forEach(t=>{e.pdf.annotationStorage.setValue(t,n[t])})),t().then(e=>e).catch(e=>(this.triggerError(e),null)).finally(()=>{if(e.pdf?.annotationStorage.size<=0)return;let t=e.pdf.annotationStorage.getAll();Object.keys(t).forEach(t=>{e.pdf.annotationStorage.remove(t)}),Object.keys(r).forEach(t=>{e.pdf.annotationStorage.setValue(t,r[t])})})}saveFile(e,t,n){try{Ye(e,t,n)}catch{return!1}return!0}hasDocument(){return Ee(this.state.pdfDocument)}zoom(e){e.zoomLevel=this.calculateZoomLevel({zoomLevel:e.zoomLevel,zoomLevelType:e.zoomLevelType,currentZoom:this.options.zoomLevel}),this.options.zoomLevel=e.zoomLevel,this.state.zoomLevel=e.zoomLevel,this.eventBus.dispatch(`scalechanging`,{source:this,scale:this.options.zoomLevel}),this.reloadFile(this.state.pdfDocument)}calculateZoomLevel({zoomLevel:e,zoomLevelType:t,currentZoom:n}){let r=this.getDocumentContainer(),i=r.querySelector(ke(this.options.elementSelectors.anyPageSelector)),a=qt(e||jc,this.options.minZoom,this.options.maxZoom);if(!Ee(i))return a;let o={width:i.offsetWidth,height:i.offsetHeight};return t===`ActualWidth`||t===`actualWidth`?a=1:t===`FitToWidth`||t===`fitToWidth`?a=r.offsetWidth/(o.width/n):(t===`FitToPage`||t===`fitToPage`)&&(a=r.offsetHeight/(o.height/n)),a}reloadFile(e){let t=[];for(let n=1;n<=e.numPages;n++)t.push(e.getPage(n));this.disableDocumentScrollEventsTracking(),this.drawPagesFromPromisesAsync(t).then(t=>{this.onPagesLoad({pdfPages:t,pdfDoc:e})}).catch(e=>{this.triggerError(e)}),this.setScaleFactor(this.state.zoomLevel)}setHiddenCanvasStyles(){this.options.pdfjsSetHiddenCanvasStyles&&Bt(this.getPagesContainer().ownerDocument)}printFile(){this.hasDocument()&&(this.setState({isPrintingInProgress:!0}),this.options.zoomBeforePrint?(this.cacheZoomLevelBeforePrint(),this.loadDocumentForPrintAsync({zoomLevel:this.options.zoomLevelBeforePrint,force:!0}).then(()=>{this.printDocumentAsync().then(()=>{this.trigger(Dc)})}).catch(this.triggerError).finally(()=>{this.setState({isPrintingInProgress:!1}),this.restoreZoomLevelBeforePrint()})):this.loadDocumentForPrintAsync({zoomLevel:this.state.zoomLevel,force:!0}).then(()=>{this.printDocumentAsync().then(()=>{this.trigger(Dc)})}).catch(this.triggerError).finally(()=>{this.setState({isPrintingInProgress:!1})}))}loadDocumentForPrintAsync({zoomLevel:e=jc,force:t=!1}){let n=this.pages,r=[],i=je();for(let i=0;i<n.length;i++){let a=n[i].loadForPrintAsync({zoomLevel:e,force:t});r.push(a)}return Promise.all(r).then(()=>{i.resolve()}),i}getPagesPrintContentAsync(e){let t=this.pages,n=[];for(let r=0;r<t.length;r++){let i=t[r].getPrintContentAsync();i.then(t=>{let n=Oe(`<div></div>`);n.appendChild(t),e.appendChild(n)}),n.push(i)}return n}initPrintContainer(){this.printContainer=Oe(`<div></div>`)}openPrintDialog(){let e=this.pages,t=e[0].rawWidth*this.getPdfToCssUnits(),n=e[0].rawHeight*this.getPdfToCssUnits(),r=window.open(``,``,`innerWidth=`+t+`,innerHeight=`+n+`location=no,titlebar=no,toolbar=no`);if(!r||!r.document){this.triggerError({message:this.options.messages.errorMessages.popupBlocked});return}r.document.body.style.margin=`0`,r.document.body.appendChild(this.printContainer);let i=()=>{r.removeEventListener(`afterprint`,i),r.close()};r.addEventListener(`afterprint`,i),r.focus(),r.print()}cacheZoomLevelBeforePrint(){this.setState({zoomLevelBeforePrint:this.state.zoomLevel})}restoreZoomLevelBeforePrint(){this.state.zoomLevelBeforePrint!==this.state.zoomLevel&&this.zoom({zoomLevel:this.state.zoomLevelBeforePrint,zoomLevelType:this.state.zoomLevelType,currentZoom:this.state.zoomLevel})}searchText(e={text:``,matchCase:!1}){return this.initSearchService(),this.searchService?.search(e)}clearSearch(){this.destroySearchService()}initSearchService(){let e=Array.from(this.wrapper.querySelectorAll(ke(this.options.elementSelectors.textLayerClass))||[]);if(this.searchService){if(e.every((e,t)=>e===this.searchService.options.textContainers[t]))return;this.destroySearchService()}this.searchService=new Je({textContainers:e,highlightClass:this.options.elementSelectors.searchHighlightClass,highlightMarkClass:this.options.elementSelectors.searchHighlightMarkClass,charClass:this.options.elementSelectors.charClass})}destroySearchService(){this.searchService&&=(this.searchService.destroy(),null)}goToNextSearchMatch(){if(!this.searchService)return;this.searchService.markNextMatch();let e=this.searchService.getActiveMatchElement();this.scrollToSearchMatch(e)}goToPreviousSearchMatch(){if(!this.searchService)return;this.searchService.markPreviousMatch();let e=this.searchService.getActiveMatchElement();this.scrollToSearchMatch(e)}getPagesContainer(){return this.element.querySelector(ke(this.options.elementSelectors.pagesContainerClass))}getDocumentContainer(){return this.wrapper.querySelector(ke(this.options.elementSelectors.documentContainerClass))}getPagesElements(){let e=this.getDocumentContainer();return e?Ce(e.querySelectorAll(ke(this.options.elementSelectors.pageSelector))):[]}scrollToSearchMatch(e){if(!e)return;let t=e.closest(`.k-text-char`),n=t?t.closest(`span[role="presentation"]`):null;if(!n)return;let r=n.closest(`.k-page`);if(!r)return;let i=r.offsetLeft+-1*this.documentScroller.element.offsetLeft+n.offsetLeft+this.options.searchMatchScrollLeftOffset,a=r.offsetTop+-1*this.documentScroller.element.offsetTop+n.offsetTop+this.options.searchMatchScrollTopOffset;this.documentScroller.scrollTo(i,a,{trackScrollEvent:!1})}resetInteractionMode(){this.setInteractionMode({mode:pc.TextSelection})}setInteractionMode(e){this.interactionMode=e.mode,this.interactionMode===pc.TextSelection?(this.disableScrollerEventsTracking(),Gt(this.options.elementSelectors.enabledTextSelectionClass,this.documentScroller.element),Kt(this.options.elementSelectors.enabledPanningClass,this.documentScroller.element)):this.interactionMode===pc.Pan&&(this.enableScrollerEventsTracking(),Kt(this.options.elementSelectors.enabledTextSelectionClass,this.documentScroller.element),Gt(this.options.elementSelectors.enabledPanningClass,this.documentScroller.element))}enableScrollerEventsTracking(){this.documentScroller&&this.documentScroller.enablePanEventsTracking()}disableScrollerEventsTracking(){this.documentScroller&&this.documentScroller.disablePanEventsTracking()}setScaleFactor(e){this.element.style.setProperty(`--scale-factor`,String(e*gt.PDF_TO_CSS_UNITS))}activatePageNumber(e){let t=this.getPageByNumber(e);if(!t)return;let n=e-1;this.state.activePageNumber!==e&&(this.state.activePageNumber=e,t.isBlank()?this.drawPageAsync({pageIndex:n}).then(()=>{this.scrollToPage({pageNumber:e})}):this.scrollToPage({pageNumber:e}))}scrollToPage({pageNumber:e}){let{left:t,top:n}=this.getPageNumberScrollOffset(e);this.scrollDocument({left:t,top:n})}scrollDocument({left:e,top:t}){this.documentScroller?.scrollTo(e,t,{trackScrollEvent:!1})}getPageNumberScrollOffset(e){return this.getPageByNumber(e)?{left:0,top:this.pages.slice(0,Math.max(0,e-1)).map(e=>this.getPageScrollOffset(e)).reduce((e,t)=>e+t,0)}:{left:0,top:0}}getPageScrollOffset(e){let t=(e?.element)?.getBoundingClientRect().height||0,n=getComputedStyle(e.element);return t+(parseFloat(n.marginTop)||0)}getPageByNumber(e){return this.pages&&this.pages[e-1]}addHighlightAnnotation(){this.annotationEditorUIManager?.highlightSelection()}setHighlightColor(e){this.executeAnnotationCommand({commandType:b.HIGHLIGHT_COLOR,commandValue:e})}deleteAnnotation(){this.annotationEditorUIManager?.delete()}resetAnnotationEditorMode(){this.setAnnotationEditorMode({mode:y.NONE,editId:null,isFromKeyboard:!1})}setAnnotationEditorMode(e){this.annotationEditorMode=e}setAnnotationMode(e){C(this,_c,e,`f`)}setEditAnnotationMode(){C(this,_c,Yt.ENABLE_FORMS,`f`)}resetAnnotationMode(){C(this,_c,Yt.ENABLE,`f`)}setFreeTextColor(e){this.executeAnnotationCommand({commandType:b.FREETEXT_COLOR,commandValue:e})}setFreeTextFontSize(e){this.executeAnnotationCommand({commandType:b.FREETEXT_SIZE,commandValue:parseFloat(e)})}executeAnnotationCommand({commandType:e,commandValue:t}){this.eventBus.dispatch(`switchannotationeditorparams`,{source:this,type:e,value:t})}isValidAnnotationEditorMode(e){return Object.values(y).includes(e)&&e!==y.DISABLE}cleanupSwitchAnnotationEditorMode(){S(this,yc,`f`)&&(this.eventBus._off(`pagerendered`,S(this,yc,`f`)),C(this,yc,null,`f`)),S(this,gc,`f`)!==null&&(clearTimeout(S(this,gc,`f`)),C(this,gc,null,`f`))}_getVisiblePages(){return this.pages}get _layerProperties(){let e=this;return pt(this,`_layerProperties`,{get annotationEditorUIManager(){return e.annotationEditorUIManager},get annotationStorage(){return e.pdfDocument?.annotationStorage},get linkService(){return e.linkService}})}scrollPageIntoView({pageNumber:e,destArray:t=null,allowNegativeOffset:n=!1,ignoreDestinationZoom:r=!1}){if(!this.pdfDocument)return;let i=Number.isInteger(e)&&this.pages[e-1];if(!i)return;if(this.isInPresentationMode||!t){this._setCurrentPageNumber(e,!0);return}let a=0,o=0,s=(i.rotation%180==0?i.rawHeight:i.rawWidth)/i.scale/gt.PDF_TO_CSS_UNITS;switch(t[1].name){case`XYZ`:a=t[2],o=t[3],a=a===null?0:a,o=o===null?s:o;break;default:return}let c=[i.viewport.convertToViewportPoint(a,o),i.viewport.convertToViewportPoint(a+0,o+0)],l=Math.min(c[0][0],c[1][0]),u=Math.min(c[0][1],c[1][1]);n||(l=Math.max(l,0),u=Math.max(u,0)),S(this,mc,`m`,xc).call(this,i,{left:l,top:u})}_setCurrentPageNumber(e,t=!1){if(this._currentPageNumber===e)return!0;if(!(0<e&&e<=this.state.pdfDocument.numPages))return!1;let n=this._currentPageNumber;return this._currentPageNumber=e,this.eventBus.dispatch(`pagechanging`,{source:this,pageNumber:e,previous:n}),!0}};hc=new WeakMap,gc=new WeakMap,_c=new WeakMap,vc=new WeakMap,yc=new WeakMap,mc=new WeakSet,bc=function(){let e=[],t=new Set;this.pages.forEach(e=>{t.add(e.id)});for(let n of this.pages){let r=n;if(!r.hasEditableAnnotations()){t.delete(r.id);continue}e.push(n)}return e.length===0?null:(this.drawPagesAsync(this.state.pdfPages),t)},xc=function(e,t=null){let{div:n,id:r}=e;if(this._currentPageNumber!==r&&this._setCurrentPageNumber(r),!t&&!this.isInPresentationMode){let e=n.offsetLeft+n.clientLeft,r=e+n.clientWidth,{scrollLeft:i,clientWidth:a}=this.element;(this._scrollMode===lr.HORIZONTAL||e<i||r>i+a)&&(t={left:0,top:0})}ur(n,t)};let Nc=jQuery,Pc={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9};var Fc=class{constructor(e){this.viewer=e,this.widget=e.pdfViewerCommon,this.init()}init(){let e=this.element=Nc(`<div></div>`);e.insertAfter(this.viewer.toolbar.element);let t=this.toolbar=new kendo.ui.ToolBar(e,{fillMode:`flat`,tools:[{name:`highlight`,command:`highlight`,icon:`highlight`,type:`button`,togglable:!0,showText:`overflow`,group:`annotations`,fillMode:`flat`},{type:`separator`},{name:`freeText`,command:`freeText`,icon:`free-text`,type:`button`,togglable:!0,showText:`overflow`,group:`annotations`,fillMode:`flat`},{type:`spacer`},{name:`close`,command:`close`,icon:`x`,type:`button`,showText:`overflow`,fillMode:`flat`}],parentMessages:{highlight:`Highlight`,freeText:`Free text`,close:`Close`}});t.bind(`click`,this.onToolbarClick.bind(this)),t.bind(`toggle`,this.onToolbarClick.bind(this))}onToolbarClick(e){let t=this.widget,n=Nc(e.target).data(`command`),r=this.viewer.toolbar;switch(n){case`close`:this.destroy(),r.element.find(`[tabindex=0]`).trigger(`focus`);break;case`highlight`:oe(t,{interactionMode:pc.TextSelection,mode:Pc.HIGHLIGHT});break;case`freeText`:oe(t,{interactionMode:pc.TextSelection,mode:Pc.FREETEXT});break}}destroy(){this.toolbar&&(this.viewer.toolbar.toggle(`[title='Annotations']`,!1),this.toolbar.unbind(`click`),this.toolbar.unbind(`toggle`),this.toolbar.destroy(),this.toolbar=null,this.element.remove(),this.element=null,this.viewer.annotationsToolbar=null,se(this.widget))}};(function(e,t){var n=window.kendo,r=e.extend,i=n.ui.progress,a=n.Class,o=n.pdfviewer.UploadHelper,s=`zoomStart`,c=`zoomEnd`,l=a.extend({init:function(e){this.options=e,this.viewer=e.viewer,this.errorMessages=this.viewer.options.messages.errorMessages}}),u=l.extend({init:function(e){l.fn.init.call(this,e),this._uploadHelper=new o(this.viewer)},exec:function(){this.viewer._upload=this.viewer._upload||this._uploadHelper._initUpload(),this.viewer._upload.element.click()}}),d=l.extend({exec:function(){var e=this.options.value,t=this.viewer,n,r;if(isNaN(e))switch(n=t._pageNum,r=t.document.total||t.document.numPages,e){case`first`:e=1;break;case`prev`:e=n>1?n-1:1;break;case`next`:e=n<r?n+1:r;break;case`last`:e=r;break}else e=Number(e);t.activatePage(e,!1)}}),f=l.extend({exec:function(){let e=this;if(!e.viewer.document){e.viewer._triggerError({message:e.errorMessages.notFound});return}let t=e.viewer.document.info&&e.viewer.document.info.title||e.viewer.options.messages.defaultFileName;e.viewer._isDPLProcessor()?e.viewer.processor.downloadFile(t):e.viewer.pdfViewerCommon.downloadFile({fileName:t})}}),p=l.extend({init:function(t){t=e.extend(t,this.options),l.fn.init.call(this,t)},exec:function(){var e=this.viewer._saveDialog||this._initDialog();e._updateModel({pagesCount:this.viewer.document&&this.viewer.document.total||1,page:this.viewer.options.page}),e.open()},apply:function(e){var t=e.extension;t===`.png`?this.viewer.exportImage(e):t===`.svg`&&this.viewer.exportSVG(e)},_initDialog:function(){return this.viewer._saveDialog=new n.pdfviewer.dialogs.ExportAsDialog({apply:this.apply.bind(this),pagesCount:this.viewer.document&&this.viewer.document.total||1,messages:this.viewer.options.messages}),this.viewer._saveDialog}}),m=l.extend({exec:function(){let e=this.viewer;e.toolbar.enable(e.toolbar.element.find(`[data-command=AnnotationsCommand]`),!0),ce(e.pdfViewerCommon,pc.TextSelection)}}),h=l.extend({exec:function(){let e=this.viewer;e.toolbar.enable(e.toolbar.element.find(`[data-command=AnnotationsCommand]`),!1),e.annotationsToolbar&&e.annotationsToolbar.destroy(),se(e.pdfViewerCommon),ce(e.pdfViewerCommon,pc.Pan)}});let ee=l.extend({init:function(e){let t=this;t.viewer=e.viewer,t.viewer.searchDialog||(t.viewer.searchDialog=new n.pdfviewer.dialogs.SearchDialog({pageContainer:t.viewer.pageContainerWrapper,position:{top:t.viewer.pageContainer.offset().top,left:t.viewer.pageContainer.offset().left},messages:t.viewer.options.messages.dialogs.search,open:t._open.bind(t),next:t._next.bind(t),prev:t._prev.bind(t),close:t._close.bind(t)})),l.fn.init.call(t,e)},exec:function(){this.viewer.searchDialog.open()},_open:function(){let e=this;e.changeHandler=e._change.bind(e),e.viewer.searchDialog.searchModel.bind(`change`,e.changeHandler)},_close:function(){let e=this;e.viewer.pdfViewerCommon.clearSearch(),e.viewer.toolbar.element.find(`[tabindex=0]`).trigger(`focus`),e.viewer.searchDialog.searchModel.unbind(`change`,e.changeHandler),e.matches=[],e.matchIndex=null,e._updateSearchModel()},_change:function(e){let t=this,n=t.viewer.searchDialog.searchModel.searchText,r=t.viewer.searchDialog.searchModel.matchCase;(e.field===`searchText`||e.field===`matchCase`)&&(t.matches=t.viewer.pdfViewerCommon.searchText({text:n,matchCase:r}),t.matchIndex=t.matches.length?1:0,t._updateSearchModel())},_next:function(){let e=this;e.viewer.pdfViewerCommon.goToNextSearchMatch(),e.matchIndex=e.matchIndex+1>e.matches.length?1:e.matchIndex+1,e._updateSearchModel()},_prev:function(){let e=this;e.viewer.pdfViewerCommon.goToPreviousSearchMatch(),e.matchIndex=e.matchIndex-1<1?e.matches.length:e.matchIndex-1,e._updateSearchModel()},_updateSearchModel:function(){let e=this,t=e.viewer.searchDialog.searchModel;e.matches&&e.matches.length?(t.set(`matches`,e.matches.length),t.set(`matchIndex`,e.matchIndex)):(t.set(`searchText`,``),t.set(`matches`,0),t.set(`matchIndex`,0))},_closeDialog:function(){this.viewer.searchDialog.close()}});var g=l.extend({exec:function(){let e=this,n=e._calculateZoom();if(n===t)return;let r=n.zoomLevel;e.viewer.zoomScale!==n.zoomLevel&&(e.viewer._preventRenderEvent=!0,e.viewer._currentPage=e.viewer.pdfViewerCommon.getCurrentPageIndex()+1,e.viewer.pdfViewerCommon.zoom({zoomLevel:n.zoomLevel,zoomLevelType:n.zoomLevelType}),r=e.viewer.pdfViewerCommon.options.zoomLevel,e._triggerZoomEnd(r)),e.viewer.zoomScale=r},_calculateZoom:function(){var e=this.options,t=this.viewer,r=t.options,i=e.value||e.scale,a=i,o=``,c;if(t._allowResize=!1,t._autoFit=!1,e.zoomIn?a=i=t.zoomScale+r.zoomRate:e.zoomOut?a=i=t.zoomScale-r.zoomRate:i===`auto`?(t._allowResize=!0,a=t._autoZoomScale):typeof i==`string`&&!n.parseFloat(i)?o=i:i&&i.toString().match(/^[0-9]+%?$/)?(i=parseInt(i.replace(`%`,``),10)/100,a=i):c=isNaN(i),c||=i<r.zoomMin||i>r.zoomMax,!(c||t.trigger(s,{scale:i})))return e.updateComboBox&&t.toolbar&&t._updateZoomComboBox(i),{zoomLevel:a,zoomLevelType:o}},_triggerZoomEnd:function(e){this.viewer.trigger(c,{scale:e})}}),te=l.extend({init:function(e){l.fn.init.call(this,e)},exec:function(){let e=this;if(!e.viewer.document){e.viewer._triggerError({message:this.errorMessages.notFound});return}i(e.viewer.pageContainerWrapper,!0),setTimeout(()=>{e.viewer.pdfViewerCommon.printFile()},100)}});let ne=l.extend({init:function(e){l.fn.init.call(this,e)},exec:function(){let e=this.viewer;e.annotationsToolbar?e.annotationsToolbar.destroy():e.annotationsToolbar=new Fc(e)}});r(n.pdfviewer,{OpenCommand:u,PageChangeCommand:d,DownloadCommand:f,EnableSelectionCommand:m,EnablePanCommand:h,ExportCommand:p,PrintCommand:te,OpenSearchCommand:ee,ZoomCommand:g,AnnotationsCommand:ne})})(window.kendo.jQuery),(function(e,t){var n=window.kendo,r=n.htmlEncode,i=e.extend,a=n.Class,o=n.ui.Draggable,s=n._outerWidth,c={svg:`.svg`,png:`.png`},l=n.keys,u=a.extend({init:function(t){this.options=i(t,{actions:[{text:t.messages.dialogs.okText}]}),this._dialog=e(`<div />`).kendoDialog(this.options).getKendoDialog()},open:function(){this._dialog.center().open()}}),d=a.extend({init:function(e){return this.options=i(e,this.options,{fileFormats:[{description:e.messages.dialogs.exportAsDialog.png,extension:c.png},{description:e.messages.dialogs.exportAsDialog.svg,extension:c.svg}],title:e.messages.dialogs.exportAsDialog.title,open:function(){this.center()}}),this._initializeDialog(),this},options:{extension:c.png,autoFocus:!0,resizable:!1,modal:{preventScroll:!0},width:`90%`,maxWidth:520,template:({messages:e,total:t})=>`<div class='k-edit-label'><label>${r(e.exportAsDialog.labels.fileName)}:</label></div><div class='k-edit-field'><span class='k-textbox k-input'><input class='k-input-inner' data-bind='value: name' /></span></div><div><div class='k-edit-label'><label>${r(e.exportAsDialog.labels.saveAsType)}:</label></div><div class='k-edit-field'><select data-role='dropdownlist' class='k-file-format' data-text-field='description' data-value-field='extension' data-bind='value: extension, source: fileFormats'></select></div></div><div class='k-edit-label'><label>${r(e.exportAsDialog.labels.page)}:</label></div><div class='k-edit-field'><input data-role='numerictextbox' data-format='n0' data-min='1' data-max='${r(t)}' data-bind='value: page' /></div><div class='k-actions'><button class='k-button k-button-primary' data-bind='click: apply'><span class='k-button-text'>${r(e.save)}</span></button><button class='k-button' data-bind='click: close'><span class='k-button-text'>${r(e.cancel)}</span></button></div>`},_updateModel:function(e){e.pagesCount&&this.viewModel.set(`pagesCount`,e.pagesCount),e.page&&this.viewModel.set(`page`,e.page)},_initializeDialog:function(){var t=this,r=t.options,i=r.messages.dialogs,a=e(`<div class='k-pdf-viewer-window k-action-window k-popup-edit-form' />`).append(n.template(r.template)({total:r.pagesCount,messages:i})).kendoWindow(r).getKendoWindow();return t.viewModel=n.observable({title:i.exportAsDialog.title,name:i.exportAsDialog.defaultFileName,extension:r.extension,fileFormats:r.fileFormats,pagesCount:r.pagesCount,page:1,apply:t.apply.bind(this),close:function(){a.close()}}),t._dialog=a,n.bind(a.element,t.viewModel),a},open:function(){this._dialog.center().open()},apply:function(){this._dialog.close(),this.options.apply({fileName:this.viewModel.name+this.viewModel.extension,extension:this.viewModel.extension,page:this.viewModel.page})}}),f=a.extend({init:function(e){var t=this;t.options=i({},e,t.options)},options:{resizable:!1,template:({messages:e})=>`<div class="k-search-panel k-pos-sticky k-top-center"><button aria-label='${r(e.dragHandle)}' class='k-button k-button-flat k-icon-button k-search-dialog-draghandle'>${n.ui.icon({icon:`handle-drag`,iconClass:`k-button-icon`})}</button><span class='k-textbox k-input'><input class='k-search-dialog-input k-input-inner' data-bind='value: boundValue, events: { keyup: onKeyup, input: onInput }' aria-label='${r(e.inputLabel)}' title='${r(e.inputLabel)}' /><span class='k-input-suffix'><button class='k-button k-button-flat k-icon-button k-match-case-button k-match-case-button' data-bind='css: {k-selected: matchCase}, click: matchCaseClick' aria-label='${r(e.matchCase)}' title='${r(e.matchCase)}'>${n.ui.icon({icon:`convert-lowercase`,iconClass:`k-button-icon`})}</button></span></span><span class='k-search-matches'><span data-bind='text: matchIndex'></span> ${r(e.of)} <span data-bind='text: matches'></span></span><button class='k-button k-button-flat k-icon-button' data-bind='click: prev' aria-label='${r(e.previous)}' title='${r(e.previous)}'>${n.ui.icon({icon:`arrow-up`,iconClass:`k-button-icon`})}</button><button class='k-button k-button-flat k-icon-button' data-bind='click: next' aria-label='${r(e.next)}' title='${r(e.next)}'>${n.ui.icon({icon:`arrow-down`,iconClass:`k-button-icon`})}</button><button class='k-button k-button-flat k-icon-button' data-bind='click: close' aria-label='${r(e.close)}' title='${r(e.close)}'>${n.ui.icon({icon:`x`,iconClass:`k-button-icon`})}</button></div>`},open:function(){var e=this;e.dialog||e._initializeDialog(),e.options.open(),e._showSearchDialog()},close:function(){var e=this;e.options.close(),e._hideSearchDialog()},_showSearchDialog:function(){var e=this;e.dialog.css(`left`,`${e.options.pageContainer.innerWidth()/2-s(e.dialog,!0)/2}px`),e.dialog.kendoStop().kendoAnimate({effects:{zoom:{direction:`in`},fade:{direction:`in`}},duration:350,complete:function(t){e.dialog.find(`.k-search-dialog-input`).trigger(`focus`)}})},_hideSearchDialog:function(){this.dialog.kendoStop().kendoAnimate({effects:{zoom:{direction:`out`,properties:{scale:.7}},fade:{direction:`out`}},duration:350,hide:!0})},_initializeDialog:function(){var t=this,r=e(n.template(t.options.template)({messages:t.options.messages}));t.options.pageContainer.prepend(r),t.dialog=r,t._draggable=new o(r,{filter:`.k-search-dialog-draghandle`,axis:`x`,dragstart:function(e){var r=t.dialog,i=t.options.pageContainer;if(r.startPosition={left:e.x.client-n.getOffset(r,`position`).left},!i)return null;i._innerWidth=i.innerWidth(),parseInt(i._innerWidth,10)>i[0].clientWidth&&(i._innerWidth-=n.support.scrollbar()),r.maxLeft=i._innerWidth-s(r,!0)},drag:function(e){var n=t.dialog,r={},i=e.x.client-n.startPosition.left;i&&isNaN(i)&&i.toString().indexOf(`px`)<0?r.left=i:r.left=Math.max(Math.min(parseInt(i,10),parseInt(n.maxLeft,10)),0),n.css(r)}}),t._draggable.userEvents.stopPropagation=!1,t.searchModel=n.observable({boundValue:``,searchText:``,matchCase:!1,matchIndex:0,matches:0,matchCaseClick:function(){this.set(`matchCase`,!this.matchCase)},next:t.options.next,prev:t.options.prev,close:function(){this.set(`boundValue`,``),t.close()},onKeyup:function(e){var t=e.keyCode,n=e.shiftKey?this.prev:this.next;t===l.ENTER?(n(),e.preventDefault()):t==l.ESC&&this.close()},onInput:function(e){this.set(`searchText`,e.target.value)}}),n.bind(r,t.searchModel)}});i(n.pdfviewer,{dialogs:{ErrorDialog:u,ExportAsDialog:d,SearchDialog:f}})})(window.kendo.jQuery);let Ic=jQuery;var Lc=class{constructor(e,t,n){this.viewer=e,this.widget=e.pdfViewerCommon,this.anchor=t,this.editor=n,this.popupOpenHandler=this.onPopupOpen.bind(this),this.init()}init(){let e=this.anchor,t=Ic(`<div data-uid="${kendo.guid()}"></div>`);this.popup=new kendo.ui.Popup(Ic(`<div class="k-pdf-viewer-annotation-editor-toolbar"></div>`),{anchor:e}),this.popup.element.html(t),(this.popupToolbar=new kendo.ui.ToolBar(t,{fillMode:`flat`,tools:[{name:`palette`,command:`palette`,icon:`palette`,type:`button`,showText:`overflow`,fillMode:`flat`},{name:`remove`,command:`remove`,icon:`trash`,type:`button`,showText:`overflow`,fillMode:`flat`}],parentMessages:{palette:`Palette`,remove:`Remove`}})).bind(`click`,this.onAnnotationPopupToolbarClick.bind(this)),this.popup.open()}initEditor(){}onAnnotationPopupToolbarClick(e){let t=this.widget;switch(Ic(e.target).data(`command`)){case`palette`:this.initEditor();break;case`remove`:ne(t),this.destroyPopup();break;default:break}}onPopupOpen(){this.flatColorPicker._view._hueSlider.resize(),this.flatColorPicker._view._opacitySlider.resize()}anchorExists(){return document.getElementById(this.anchor.id)}destroyPopup(){this.popup&&=(this.popup.destroy(),null)}destroyEditor(){this.editorPopup&&=(this.editorPopup.destroy(),null)}destroy(){this.popupToolbar&&=(this.popupToolbar.unbind(`click`),this.popupToolbar.unbind(`toggle`),this.popupToolbar.destroy(),null),this.destroyPopup()}},Rc=class extends Lc{constructor(e,t,n){super(e,t,n)}initEditor(){let e=this.anchor;if(!this.anchorExists()){this.destroy();return}this.destroyEditor(),this.editorPopup=new kendo.ui.Popup(Ic(`
            <div class="k-pdf-viewer-annotation-editor">
                <span class="k-column-menu-group-header">
                    <span class="k-column-menu-group-header-text">Color</span>
                </span>
                <div ref-annotation-editor-flat-color-picker></div>
            </div>
`),{anchor:e,activate:this.popupOpenHandler}),this.initFlatColorPicker(),this.editorPopup.open(),this.destroy()}initFlatColorPicker(){this.flatColorPicker=new kendo.ui.FlatColorPicker(this.editorPopup.element.find(`[ref-annotation-editor-flat-color-picker]`),{format:`rgb`,opacity:!0,change:e=>re(this.widget,e.value)})}onPopupOpen(){let e=this.editor.color;super.onPopupOpen(),this.flatColorPicker.value(e)}},zc=class extends Lc{constructor(e,t,n){super(e,t,n)}initEditor(){let e=this.anchor;if(!this.anchorExists()){this.destroy();return}this.destroyEditor(),this.editorPopup=new kendo.ui.Popup(Ic(`
            <div class="k-pdf-viewer-annotation-editor">
                <span class="k-column-menu-group-header">
                        <span class="k-column-menu-group-header-text">Text style</span>
                    </span>
                    <form ref-annotation-text-editor-popup-form></form>
                <span class="k-column-menu-group-header">
                    <span class="k-column-menu-group-header-text">Color</span>
                </span>
                <div ref-annotation-editor-flat-color-picker></div>
            </div>
`),{anchor:e,activate:this.popupOpenHandler}),this.initFontSizeForm(),this.initFlatColorPicker(),this.editorPopup.open(),this.destroy()}initFontSizeForm(){let e=this.editor.propertiesToUpdate[0][1];this.fontSizeForm=new kendo.ui.Form(Ic(`[ref-annotation-text-editor-popup-form]`),{buttonsTemplate:()=>``,formData:{fontSize:e},layout:`grid`,grid:{cols:3},items:[{field:`fontSize`,label:`Font size`,editor:`DropDownList`,colSpan:1,editorOptions:{fillMode:`flat`,dataSource:[8,9,10,11,12,13,14,16,20,22,24,26,28,36,48,72],change:e=>{let t=e.sender.value();ae(this.widget,t)}}}]}),this.fontSizeForm.element.find(`.k-form-buttons`).remove()}initFlatColorPicker(){this.flatColorPicker=new kendo.ui.FlatColorPicker(this.editorPopup.element.find(`[ref-annotation-editor-flat-color-picker]`),{format:`rgb`,opacity:!0,change:e=>ie(this.widget,e.value)})}onPopupOpen(){let e=this.editor.propertiesToUpdate[1][1];super.onPopupOpen(),this.flatColorPicker.value(e)}};let Bc={id:`pdfviewer`,name:`PDFViewer`,category:`web`,description:`PDFViewer to display pdfs in the browser`,depends:[`core`,`window`,`dialog`,`toolbar`,`draganddrop`,`upload`,`combobox`,`drawing`,`binder`,`dropdownlist`,`numerictextbox`,`textbox`,`pager`,`form`,`colorpicker`]};(function(e,t){var n=`.kendoPDFViewer`,r=window.kendo,i=r.ui,a=e.extend,o=r.drawing,s=e.extend({PLUS:187,MINUS:189,ZERO:48,NUMPAD_ZERO:96},r.keys),c,l=r.pdfviewer.BlankPage,u=i.Widget,d=r.ui.progress,f=`scroll`,p=`render`,m=`open`,h=`error`,ee=`keydown`+n;``+n+n;var g=`update`,ne=`pagechange`,re=`zoomStart`,ie=`zoomEnd`,ae=`ZoomCommand`,oe=`#ffffff`,le=`tabindex`,_=`click`,v=`change`,ue=`toggle`,de=`k-disabled`,fe={pdfjs:`pdfjs`,dpl:`dpl`},pe={viewer:`k-pdf-viewer`,scroller:`k-canvas k-pdf-viewer-canvas k-pos-relative k-overflow-auto`,enableTextSelection:`k-enable-text-select`,enablePanning:`k-enable-panning`,highlightClass:`k-search-highlight`,highlightMarkClass:`k-search-highlight-mark`,charClass:`k-text-char`},me={auto:`auto`,actual:`ActualWidth`,fitToWidth:`FitToWidth`,fitToPage:`FitToPage`},he=u.extend({init:function(e,t){var n=this;u.fn.init.call(n,e,r.deepExtend({},this.options,t)),n._processMessages(),n._wrapper(),n.options.toolbar&&n._renderToolbar(),n._initProcessor(t||{}),n._renderPageContainer(),n._isDPLProcessor()?n._loadDPLDocument():n._loadPdfJSDocument(),r.notify(n,r.ui),n._showWatermarkOverlay&&n._showWatermarkOverlay(n.wrapper[0])},events:[p,m,h,re,ie],options:{name:`PDFViewer`,view:{type:`canvas`},pdfjsProcessing:{file:null,renderForms:!1,loadOnDemand:!0},dplProcessing:{read:{url:null,type:`GET`,dataType:`json`,pageField:`pageNumber`},upload:{url:null,saveField:`file`},download:{url:null},loadOnDemand:!1},toolbar:{items:[],contextMenu:!1},width:1e3,height:1200,page:1,defaultPageSize:{width:794,height:1123},scale:null,zoomMin:.5,zoomMax:4,zoomRate:.25,messages:{defaultFileName:`Document`,toolbar:{zoom:{zoomLevel:`zoom level`,zoomOut:`Zoom Out`,zoomIn:`Zoom In`,actualWidth:`Actual Width`,autoWidth:`Automatic Width`,fitToWidth:`Fit to Width`,fitToPage:`Fit to Page`},contextMenu:`Menu`,open:`Open`,exportAs:`Export`,download:`Download`,print:`Print`,toggleSelection:`Enable Selection`,togglePan:`Enable Panning`,search:`Search`,annotations:`Annotations`},errorMessages:{notSupported:`Only pdf files allowed.`,parseError:`PDF file fails to process.`,notFound:`File is not found.`,popupBlocked:`Popup is blocked.`},dialogs:{exportAsDialog:{title:`Export...`,defaultFileName:`Document`,pdf:`Portable Document Format (.pdf)`,png:`Portable Network Graphics (.png)`,svg:`Scalable Vector Graphics (.svg)`,labels:{fileName:`File name`,saveAsType:`Save as`,page:`Page`}},okText:`OK`,save:`Save`,cancel:`Cancel`,search:{inputLabel:`Search Text`,matchCase:`Match Case`,next:`Next Match`,previous:`Previous Match`,close:`Close`,of:`of`,dragHandle:`Drag search`}}}},defaultTools:{contextMenu:{type:`dropDownButton`,name:`contextMenu`,showText:`overflow`,id:`pdfviewer-toolbar-context-menu`,overflow:`never`,icon:`menu`,fillMode:`flat`,menuButtons:[{id:`open`,text:`Open`,icon:`folder-open`,attributes:{"data-command":`OpenCommand`}},{id:`download`,text:`Download`,icon:`download`,attributes:{"data-command":`DownloadCommand`},enable:!1},{id:`print`,text:`Print`,icon:`print`,attributes:{"data-command":`PrintCommand`},enable:!1}]},separator:{type:`separator`},pager:{type:`component`,name:`pager`,overflow:`never`,component:`Pager`,element:`<div></div>`,componentOptions:{navigatable:!0,_isToolbarItem:!0}},spacer:{type:`spacer`},zoomInOut:{type:`buttonGroup`,fillMode:`flat`,buttons:[{type:`button`,icon:`zoom-out`,name:`zoomOut`,command:`ZoomCommand`,showText:`overflow`,options:`{ "zoomOut": true, "updateComboBox": true }`,fillMode:`flat`},{type:`button`,icon:`zoom-in`,name:`zoomIn`,command:`ZoomCommand`,showText:`overflow`,options:`{ "zoomIn": true, "updateComboBox": true }`,fillMode:`flat`}]},zoom:{type:`component`,name:`zoom`,command:`ZoomCommand`,overflow:`never`,component:`ComboBox`,data:[50,100,150,200,300,400],componentOptions:{enable:!1,dataTextField:`text`,dataValueField:`percent`,valuePrimitive:!0,clearOnEscape:!1,commandOn:`change`,fillMode:`flat`}},toggleSelection:{type:`buttonGroup`,fillMode:`flat`,buttons:[{togglable:!0,command:`EnableSelectionCommand`,icon:`pointer`,showText:`overflow`,name:`toggleSelection`,group:`toggle-pan`,fillMode:`flat`},{togglable:!0,command:`EnablePanCommand`,icon:`hand`,showText:`overflow`,name:`togglePan`,group:`toggle-pan`,selected:!0,fillMode:`flat`}]},spacer2:{type:`spacer`},search:{type:`button`,command:`OpenSearchCommand`,icon:`search`,name:`search`,showText:`overflow`,enable:!1,fillMode:`flat`},open:{type:`button`,showText:`overflow`,name:`open`,icon:`folder-open`,command:`OpenCommand`,fillMode:`flat`},download:{type:`button`,showText:`overflow`,name:`download`,icon:`download`,command:`DownloadCommand`,enable:!1,fillMode:`flat`},print:{type:`button`,showText:`overflow`,name:`print`,icon:`print`,command:`PrintCommand`,enable:!1,fillMode:`flat`},annotations:{togglable:!0,type:`button`,showText:`overflow`,name:`annotations`,icon:`edit-annotations`,command:`AnnotationsCommand`,enable:!1,fillMode:`flat`}},exportAsTool:{exportAs:{type:`button`,showText:`overflow`,name:`exportAs`,icon:`image-export`,command:`ExportCommand`,fillMode:`flat`}},_processMessages:function(){var t=this.options.messages.toolbar.zoom;e.isPlainObject(t)&&(this.options.messages.toolbar=e.extend({},this.options.messages.toolbar,t),this.options.messages.toolbar.zoom=t.zoomLevel||this.options.messages.toolbar.zoom)},_wrapper:function(){var e=this,t=e.options;e.wrapper=e.element,e.wrapper.width(t.width).height(t.height).addClass(pe.viewer).on(ee,e._keydown.bind(e)),e._allowResize=e.options.scale===null,e._autoZoomScale=Nt,e.zoomScale=e.options.scale||e._autoZoomScale,e._resizeHandler=r.onResize(function(){e.resize()}),e._pageNum=e.options.page},_keydown:function(e){var t=[s.PLUS,s.NUMPAD_PLUS],n=[s.MINUS,s.NUMPAD_MINUS],r=[s.ZERO,s.NUMPAD_ZERO],i=!1,a={command:ae,options:{updateComboBox:!0}};!e.ctrlKey||this._blankPage||this.processingLib===fe.dpl||(t.includes(e.keyCode)?(a.options.zoomIn=!0,i=!0):n.includes(e.keyCode)?(a.options.zoomOut=!0,i=!0):r.includes(e.keyCode)&&(a.options.value=Nt,i=!0),i&&(this.execute(a),e.preventDefault()))},_handlePageChangeEvent:function(e){let t=this;t._pageChangeFromScroll||(this.activatePage(e.index,!1),t._showPagerInputLabels()),delete t._pageChangeFromScroll},_showPagerInputLabels:function(){let t=this.pager.element.find(`.k-pager-input`).children();if(t){let n=t.eq(0).add(t.eq(2));e(n).is(`:visible`)||n.show()}},_resizePager:function(){let e=this;if(!e.pager||!e.pager.options.responsive)return;let t=r._outerWidth(e.pager.element),n=Array.from(e.toolbar.element.children(`:not(.k-hidden):not(:has(.k-pager))`)),i=r._outerWidth(e.element),a=0,o=Number(e.toolbar.element.css(`gap`).replace(/(em|ex|%|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin|vmax)$/,``));if(n.length>0){let e=0;for(let t=0;t<n.length;t++)e+=r._outerWidth(n[t])+o;e&&(a=e)}let s=e.pager.element.find(`.k-pager-nav`);if(t+a+o>i)for(var c=s.length-1;c>=0;c--)s.eq(c).addClass(`k-hidden`);if(t+a+o<i){let t=e.pager.element.find(`.k-hidden:not(.k-input-validation-icon)`);for(var c=0;c<t.length;c++)t.eq(c).removeClass(`k-hidden`)}e.pager.options.input&&e._showPagerInputLabels()},_initProcessor:function(e){var t=this,n=e.dplProcessing?t.options.dplProcessing:t.options.pdfjsProcessing;t.processingLib=e.dplProcessing?fe.dpl:fe.pdfjs,t._isDPLProcessor()?(t.processor=new r.pdfviewer[t.processingLib].processor(n,t),c=r.pdfviewer[t.processingLib].Page):te()},_isDPLProcessor:function(){return this.processingLib===fe.dpl},_hasPagerTool:function(e){let t=!1,n;for(let r=0;r<e.length;r++){let i=e[r];if(typeof i==`string`?(t=i.toLowerCase()===`pager`,n=r):i.type?(t=i.type.toLowerCase()===`pager`,n=r):i.name&&(t=i.name.toLowerCase()===`pager`,t&&delete i.name,n=r),t)break}return{hasPager:t,index:n}},_renderToolbar:function(){var t=this,n=t.options,i=a({},n.toolbar),o=i.items&&i.items.length?i.items:Object.keys(t.defaultTools);if(t.options.pdfjsProcessing.renderForms&&!i.items.length){let[e,n]=[...t.defaultTools.toggleSelection.buttons];e.selected=!0,n.selected=!1}let{hasPager:s,index:c}=t._hasPagerTool(o);if(o=t._processTools(o),s){let r=t.options.messages.toolbar.pager;r&&r.of&&(r.of=`${r.of} {0}`,r.pages&&(r.of=r.of+` `+r.pages,delete r.pages)),t.defaultTools.pager.componentOptions.messages=r,n.messages.toolbar.pager=`Pager`;let i=t.defaultTools.pager.componentOptions;typeof o[c]!=`string`&&(t.defaultTools.pager.componentOptions=e.extend(o[c],i),o[c]=t.defaultTools.pager)}i={defaultTools:e.extend({},t.defaultTools,t.exportAsTool),parentMessages:n.messages.toolbar,tools:o,resizable:!0,fillMode:`flat`,overflow:i.overflow};var l=e(`<div />`);return l.appendTo(t.element),t.toolbar=new r.ui.ToolBar(l,i),t.options.toolbar=t.toolbar.options,t.toolbar.bind(ue,t._toolbarClick.bind(t)),t.toolbar.bind(_,t._toolbarClick.bind(t)),t.toolbar.bind(v,t._toolbarClick.bind(t)),i.contextMenu&&t.toolbar.element.find(`[data-role=dropdownbutton]`).on(_,t._toolbarClick.bind(t)),s&&(t.pager=t.toolbar.element.find(`.k-pager`),t.pager.length>0&&(t.pager=t.pager.data(`kendoPager`)),t.pager.bind(v,t._handlePageChangeEvent.bind(t))),t.bind({update:t._updateToolbar.bind(t)}),t.toolbar},_processTools:function(t){var n=this,r=n.options.toolbar,i=n.options.messages.toolbar;if(t=t.flatMap(t=>{if(t===`zoom`&&(t=n.defaultTools.zoom),t.name===`zoom`){t=e.extend({},n.defaultTools.zoom,t);var r=[{percent:me.auto,text:i.autoWidth},{percent:me.actual,text:i.actualWidth},{percent:me.fitToWidth,text:i.fitToWidth},{percent:me.fitToPage,text:i.fitToPage}],a=t.data.map(e=>({percent:e,text:e+`%`})),o=n.options.scale?n.options.scale*100+`%`:`auto`;r=r.concat(a),t.componentOptions.dataSource=r,t.componentOptions.value=o}return t}),r.contextMenu)t=t.filter(e=>e!==`open`&&e!==`download`&&e!==`print`);else{let e=t.findIndex(e=>e===`contextMenu`);e!==-1&&t.splice(e,1);let n=t.findIndex(e=>e===`separator`);n!==-1&&t.splice(n,1)}return t},_updateToolbar:function(e){var t={page:e.page||1,total:e.total||1},n=this.toolbar,r=n.element,i=r.find(`[data-command=ZoomCommand][data-role=combobox]`).data(`kendoComboBox`),a=r.find(`.k-focus`);a.length===0&&(a=r.find(`[tabindex=0]`).first(),a.length===0&&(a=n._getAllItems().first())),i&&(i.enable(!e.isBlank),e.action===`zoom`&&this._updateZoomComboBox(e.zoom)),(e.action===`pagechange`&&e.updatePager!==!1||e.isBlank)&&this.pager&&(e.updatePager&&(t.updatePager=!0),e.pageChangeFromScroll&&(t.pageChangeFromScroll=!0),this._updatePager(t)),this._updateOnBlank(e.isBlank),n._resetTabIndex(a)},_updateOnBlank:function(t){let n=this.toolbar,r=n.element,i=e(`#pdfviewer-toolbar-context-menu_buttonmenu`),a=r.find(`[data-command='DownloadCommand']`),o=r.find(`[data-command='PrintCommand']`);i.length&&(a=i.find(`[data-command='DownloadCommand']`),o=i.find(`[data-command='PrintCommand']`)),n.enable(r.find(`[data-command=EnableSelectionCommand]`).parent(),!t),n.enable(r.find(`[data-command=ZoomCommand][role=button]`).parent(),!t),n.enable(r.find(`[data-command='OpenSearchCommand']`),!t),n.enable(a,!t),n.enable(o,!t)},_updatePager:function(e){let t=this;if(e.updatePager){let n=t.processingLib===`dpl`?t.document&&t.document.pages?t.document.pages:[]:t.pages??[],i=new r.data.DataSource({data:n??[],pageSize:1,page:e.page});t.pager.setDataSource(i),t._resizePager()}else t.pager.page()!==e.page&&(e.pageChangeFromScroll&&(t._pageChangeFromScroll=!0),t.pager.page(e.page));t._showPagerInputLabels(),t._togglePagerDisabledClass()},_togglePagerDisabledClass:function(){let e=this.pager;e.totalPages()<=1?e.element.addClass(de):e.element.hasClass(de)&&e.element.removeClass(de)},_updateZoomComboBox:function(e){var t=e===me.auto||e===me.actual||e===me.fitToPage||e===me.fitToWidth,n=this.toolbar.element.find(`[data-command=ZoomCommand][data-role=combobox]`).data(`kendoComboBox`);t||(e=Math.round(e*100)+`%`),n&&n.value(e)},_toolbarClick:function(t){let n=e(t.target),r=n.data(`command`),i=n.data(`options`);!r&&!i&&(n=e(t.currentTarget),r=n.data(`command`),i=n.data(`options`)),i=a({},{value:n.val()},i),r&&this.execute({command:r,options:i})},_initErrorDialog:function(e){var t=this;return t._errorDialog||=(e=a(e,{messages:t.options.messages}),new r.pdfviewer.dialogs.ErrorDialog(e)._dialog),t._errorDialog},_renderPageContainer:function(){var t=this;t.pageContainer||(t.pageContainerWrapper=e(`<div />`),t.pageContainerWrapper.addClass(pe.scroller),t.pageContainer=e(`<div class="k-pdf-viewer-pages" />`),t.pageContainer.attr(le,0),t.pageContainerWrapper.append(t.pageContainer),t.wrapper.append(t.pageContainerWrapper))},_triggerError:function(e){var t=this._initErrorDialog();a(e,{dialog:t}),this.pageContainer&&d(this.pageContainer,!1),!this.trigger(h,e)&&t.open().content(e.message)},_renderPages:function(){var e=this,t=e.document,n;if(e.pages=[],!t||!t.total){e._renderBlankPage();return}n=t.pages;for(var r=1;r<=t.total;r++){var i,o={processor:e.processor,number:r};n&&n.length&&(o=a(o,n[r-1])),i=new c(o,e),e.pages.push(i),e.pageContainer.append(i.element)}e.pdfScroller&&e.pdfScroller.enablePanEventsTracking(),e._attachContainerEvents(),e._getVisiblePagesCount(),e._updatePager({updatePager:!0})},_renderBlankPage:function(){this._blankPage=new l(this.options.defaultPageSize,this),this.pageContainer.append(this._blankPage.element),this._blankPage._initUpload(),this.trigger(g,{isBlank:!0})},_removeBlankPage:function(){this._blankPage&&=(this._blankPage.destroy(),this._blankPage.element.remove(),null)},_resize:function(){var e=this,t,n;if(e._allowResize){if(!e.pages||!e.pages.length){e._blankPage&&(n=t/e._blankPage.element.width(),e._blankPage.resize(n));return}e.toolbar&&e.toolbar.resize(!0),e._resizeHandler&&clearTimeout(e._resizeHandler),e._resizeHandler=setTimeout(e._resizePages.bind(e),100)}},_resizePages:function(){let t=this,n=t.pageContainer[0].clientWidth,r=t.pdfViewerCommon?.getPagesElements(),i=0;if(t.pages.forEach(function(t){let a=n/(t.element?t.element.width():e(r[t._pageIndex]).width());a>i&&(i=a)}),t._autoFit){t.zoom(t._autoFit,!0);return}i=Math.min(Math.max(i,t.options.zoomMin),Nt),i!=t.zoomScale&&(t.zoom(i,!0),t.zoomScale=i,t._allowResize=!0),t.pager&&t.pager.element&&t._resizePager()},_attachContainerEvents:function(){let e=this;e.pageContainer.addClass(pe.enablePanning),e.pageContainerWrapper.bind(f,e._scroll.bind(e))},_scroll:function(e){var t=this,n=t.pageContainerWrapper.height(),r=t.pages.length,i=t._pageNum,a=i-1,o=i,s;if(t._preventScroll||!r){t._preventScroll=!1;return}t._scrollingStarted=!0;let c=Rt(t.element[0]);if(t.pages[a],o=i+c-a,i!==o&&o>=1&&o<=r){if(s=t.pages[o-1].element,s.offset().top>n)return;t._pageNum=o,t._loadVisiblePages(),t.trigger(g,{action:ne,page:o,total:r,pageChangeFromScroll:!0})}},zoom:function(e,t){var n=this;if(!n._isDPLProcessor())return e?n.execute({command:ae,options:{value:e,updateComboBox:!t}}):n.zoomScale},execute:function(e){var t=a({viewer:this},e.options);return new r.pdfviewer[e.command](t).exec()},_loadDPLDocument:function(){var e=this,t=e.options.page;d(e.pageContainer,!0),e.processor.fetchDocument().done(function(n){e._clearPages(),e.document=n,e._renderPages(),e.resize(!0),n&&(t=t>=1&&t<=n.total?t:1,e.activatePage(t,!0)),e.pdfScroller&&e.pdfScroller.destroy(),e.pdfScroller=new Re(e.pageContainer[0].parentNode,{filter:`.k-page`,events:{}}),e.pdfScroller.enablePanEventsTracking(),d(e.pageContainer,!1)})},_loadPdfJSDocument:function(e){let t=this,n=t.options,r=n.page,i;if(i=e||n.pdfjsProcessing.file,!i){t._renderBlankPage();return}typeof i==`string`?i={url:i}:i instanceof ArrayBuffer&&(i={data:i}),t._removeBlankPage(),d(t.pageContainer,!0),t.pdfViewerCommon=new Mc(t.element[0],{loadOnDemand:t.options.pdfjsProcessing.loadOnDemand,loadOnDemandPageSize:1,zoomLevel:t.zoomScale,renderForms:t.options.pdfjsProcessing.renderForms,fileDescriptor:i,events:{pagesLoad:e=>{t.document=e.pdfDoc,t.pages=e.pdfPages,t.options.pdfjsProcessing.renderForms?ce(t.pdfViewerCommon,0):ce(t.pdfViewerCommon,1),t.activatePage(r,!0),t.trigger(g),t._currentPage>-1&&(t.pdfViewerCommon.scrollToPage({pageNumber:t._currentPage}),t._currentPage=null),d(t.pageContainer,!1)},pageRendered:e=>{t._preventRenderEvent||t.trigger(p,{page:e.page.pdfPage}),t._setPageNumberAttributes(),t._preventRenderEvent=!1},zoomStart:e=>{t._currentPage=t.pdfViewerCommon.getCurrentPageIndex()+1},zoomEnd:e=>{t.zoomScale=e.zoomLevel,t._updateZoomComboBox(e.zoomLevel),t.trigger(ie,{scale:e.zoomLevel})},printEnd:e=>{d(t.pageContainerWrapper,!1)},scroll:e=>{e.isPageChanged&&t.trigger(g,{action:ne,page:e.pageNumber,total:t.pages.length,pageChangeFromScroll:!0})},error:e=>{t._triggerError({error:e.message,message:t.options.messages.errorMessages.parseError})},annotationEditorToolBarShow:t.onAnnotationEditorToolBarShow.bind(t)}})},_enablePanning:function(){this.pdfViewerCommon.documentScroller.enablePanEventsTracking()},_disablePanning:function(){this.pdfViewerCommon.documentScroller.disablePanEventsTracking()},_setPageNumberAttributes:function(){this.pageContainer.find(`.k-page`).each((t,n)=>{e(n).attr(r.attr(`number`),t+1)})},loadPage:function(e){let t=this,n=t.pages&&t.pages[e-1];if(n)return t._isDPLProcessor()?n.load(t.zoomScale):Promise.resolve()},activatePage:function(e,t){let n=this;n.pages&&n.pages[e-1]&&(n._pageNum=e,n._isDPLProcessor()?(n._loadVisiblePages(),n._scrollToActivatedPage(e,t)):(n.pdfViewerCommon.activatePageNumber(e),n.trigger(g,{action:ne,page:e,total:n.pages.length,updatePager:t})))},_scrollToActivatedPage:function(e,t){let n=this,r=n.pageContainerWrapper;n._preventScroll=!0,Lt(r[0],e-1),n.trigger(g,{action:ne,page:e,total:n.pages.length,updatePager:t})},_getVisiblePagesCount:function(){for(var e=this,t=0,n=0,r=e.pageContainer[0].clientHeight,i=0;t<=r&&i<e.pages.length;)t+=e.pages[i].element.height(),n++,i++;e._visiblePagesCount=n},_loadVisiblePages:function(){var e=this.pages&&this.pages.length,t=Math.max(this._pageNum-this._visiblePagesCount,1),n=Math.min(this._pageNum+this._visiblePagesCount,e);this._visiblePages=this.pages.slice(t-1,n);for(var r=t;r<=n;r++)this.loadPage(r)},_loadAllPages:function(){let e=this.pages&&this.pages.length,t=[];for(var n=0;n<=e;n++)t.push(this.loadPage(n));return t},fromFile:function(t){let n=this;if(n._isDPLProcessor())n.zoomScale=n.options.scale||Nt,n.zoom(n.zoomScale,!0),n.trigger(g,{action:`zoom`,zoom:n.options.scale||`auto`}),n.processor._updateDocument(t),n._loadDPLDocument();else if(n.pdfViewerCommon){n.annotationsToolbar?.destroy(),se(n.pdfViewerCommon),n.toolbar.toggle(`[title='Annotations']`,!1),n.toolbar.toggle(`[title='Enable Selection']`,!1),n.toolbar.toggle(`[title='Enable Panning']`,!0);let r=e.isPlainObject(t)?t:{url:t};n.pdfViewerCommon.loadFile(r)}else n._loadPdfJSDocument(t)},exportImage:function(e){var t=this,n=e.page,i=t.pages[n-1]||t._blankPage,a=new o.Group;i.load();var s=r.drawing.Path.fromRect(new r.geometry.Rect([0,0],[i.width,i.height]),{fill:{color:oe},stroke:null});d(t.pageContainer,!0),a.append(s,i.group),o.exportImage(a).done(function(n){d(t.pageContainer,!1),r.saveAs({dataURI:n,fileName:e.fileName,proxyURL:e.proxyURL||``,forceProxy:e.forceProxy,proxyTarget:e.proxyTarget})})},exportSVG:function(e){var t=this,n=e.page,i=t.pages[n-1]||t._blankPage;d(t.pageContainer,!0),i.load(),o.exportSVG(i.group).done(function(n){d(t.pageContainer,!1),r.saveAs({dataURI:n,fileName:e.fileName,proxyURL:e.proxyURL||``,forceProxy:e.forceProxy,proxyTarget:e.proxyTarget})})},setOptions:function(t){var n=this;(t.pdfjsProcessing||t.dplProcessing)&&n._initProcessor(t||{}),t=e.extend(n.options,t),u.fn.setOptions.call(n,t),t.page&&(n._pageNum=t.page,n.activatePage(t.page,!1)),t.width&&n.element.width(t.width),t.height&&n.element.height(t.height)},destroy:function(){this._resizeHandler&&r.unbindResize(this._resizeHandler),this._errorDialog&&this._errorDialog.destroy(),this._saveDialog&&this._saveDialog.destroy(),this._upload&&this._upload.destroy(),this.pager&&this.pager.destroy(),this.toolbar&&=(this.toolbar.unbind(),this.toolbar.destroy(),null),this.pages&&this.pages.length&&this._isDPLProcessor()&&(this.pages.forEach(function(e){e.destroy()}),this.pages=[]),this.pdfScroller&&this.pdfScroller.destroy(),this.pageContainer.off(n),this.pageContainerWrapper.off(n),u.fn.destroy.call(this)},_clearPages:function(){this.pages=[],this.document=null,this._pageNum=1,this.pageContainer.off(n),this.pageContainer.empty(),this.pdfScroller&&this.pdfScroller.destroy()},onAnnotationEditorToolBarShow:function(e){let t=this,n=e.annotationEditorMode,r=e.anchor,i=t.annotationPopup?.popup,a=e.source.firstSelectedEditor;if(!(i&&i.visible()&&!i._closing&&n===`freeText`))switch(t.annotationPopup&&=(t.annotationPopup.destroy(),t.annotationPopup.destroyEditor(),null),n){case`highlight`:t.annotationPopup=new Rc(t,r,a);break;case`freeText`:t.annotationPopup=new zc(t,r,a);break}}});i.plugin(he)})(window.kendo.jQuery);var Vc=kendo;e.__meta__=Bc,e.default=Vc});
//# sourceMappingURL=kendo.pdfviewer.min.js.map